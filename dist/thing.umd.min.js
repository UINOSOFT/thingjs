!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THING={})}(this,(function(t){"use strict";function r(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}function n(e,t,r,n,i,a,s){try{var o=e[a](s),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var s=e.apply(t,r);function o(e){n(s,i,a,o,l,"next",e)}function l(e){n(s,i,a,o,l,"throw",e)}o(void 0)}))}}function s(e,t){if("string"!=typeof e)throw new TypeError("expected path to be a string");if("\\"===e||"/"===e)return"/";var r=e.length;if(r<=1)return e;var n="";if(r>4&&"\\"===e[3]){var i=e[2];"?"!==i&&"."!==i||"\\\\"!==e.slice(0,2)||(e=e.slice(2),n="//")}var a=e.split(/[/\\]+/);return!1!==t&&""===a[a.length-1]&&a.pop(),n+a.join("/")}var o,l=new Map,u=new Map;function c(e,t,r){var n=e.get(t);return n||(n=new RegExp(t,r),e.set(t,n)),n}function h(e,t){if(t){var r=u.get(t);return r||(r=new Map,u.set(t,r)),c(r,e,t)}return c(l,e)}Array.prototype._insert=function(e,t){return this.splice(e,0,t)},Array.prototype._removeAt=function(e){return this.splice(e,1)},Array.prototype._swap=function(e,t){var r=this[e];return this[e]=this[t],this[t]=r,this},Object.defineProperties(Array.prototype,{_insert:{enumerable:!1},_removeAt:{enumerable:!1},_swap:{enumerable:!1},_copy:{enumerable:!1},forEachAsync:{writable:!0,enumerable:!1,configurable:!0,value:(o=a((function*(e,t){try{for(var r=0;r<this.length;r++){var n=e(this[r],r,this);n&&(yield n.catch((e=>(t&&t(e),!1))))}return!0}catch(e){return console.error(e),t&&t(e),!1}})),function(e,t){return o.apply(this,arguments)})},waitForEachAsync:{writable:!0,enumerable:!1,configurable:!0,value:function(e){var t=this;return new Promise(a((function*(r,n){(yield t.forEachAsync(e,n))&&r()})))}}}),Map.prototype.toObject=function(){var e={};for(var[t,r]of this)e[t]=r;return e},Map.prototype.fromObject=function(e){for(var t in this.clear(),e)this.set(t,e[t]);return this},String.prototype._getNormalize=function(){var e=this.indexOf("://");return-1!==e?this.substring(0,e+3)+s(this.substring(e+3)):s(this.substring())},String.prototype._startsWith=function(e){return this.slice(0,e.length)===e},String.prototype._endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},String.prototype._isBlank=function(){for(var e=0;e<this.length;e++)if(" "!=this[e]&&"\t"!=this[e])return!1;return!0},String.prototype._getFileName=function(e){void 0===e&&(e=!0);var t,r=this,n=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");-1===n?e||-1!=(t=this.indexOf("."))&&(r=this.substring(0,t)):(0!==(r=this.substring(n)).indexOf("\\")&&0!==r.indexOf("/")||(r=r.substring(1)),e||-1!=(t=r.indexOf("."))&&(r=r.substring(0,t)));return r},String.prototype._getRootPath=function(){var e=this.indexOf("\\");return-1===e&&(e=this.indexOf("/")),-1==e?this:this.substring(0,e)},String.prototype._getPath=function(){var e=this.lastIndexOf("\\"),t=this.lastIndexOf("/"),r=e>t?e:t;return this.substring(0,r)},String.prototype._getSearchName=function(){var e=this._getFileName(),t=e.indexOf("?");return-1===t?"":e.substring(t)},String.prototype._removeSearchName=function(){var e=this._getFileName(),t=e.indexOf("?");return-1===t?this:e.substring(0,t)},String.prototype._getExtension=function(){var e=this.split("/"),t=e[e.length-1];if(t&&(e=t.split(".")).length>1){var r=e.pop(),n=r.indexOf("?");return-1!==n?r.substring(0,n):r}return""},String.prototype._trimLeft=function(e){void 0===e&&(e="s");var t=h("^["+e+"]+");return this.replace(t,"")},String.prototype._trimRight=function(e){void 0===e&&(e="s");var t=h("["+e+"]+$");return this.replace(t,"")},String.prototype._trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype._appendPath=function(e){return e._startsWith("/")&&(e=e.substring(1)),e._endsWith("/")&&(e=e.substring(0,e.length-1)),this._endsWith("/")?this+e:this+"/"+e},String.prototype._appendURL=function(e){var t=this._getFileName();return t._startsWith("?")?this._getPath()._appendPath(e)+t:this._appendPath(e)},String.prototype._appendRandomSuffix=function(){return this.substring(0)+"?t="+(new Date).getTime()},String.prototype._equals=function(e,t){return void 0===t&&(t=!0),null!=e&&(t?this.toUpperCase()==e.toUpperCase():this==e)},String.prototype._replaceAll=function(e,t){"\\"!=e&&"."!=e||(e="\\"+e);var r=h(e,"gm");return this.replace(r,t)},String.prototype._removeAt=function(e,t){return void 0===t&&(t=1),e>=this.length?this:this.slice(0,e)+this.slice(e+t)},String.prototype._insert=function(e,t){return this.slice(0,e)+t+this.slice(e)},String.prototype._isNumeric=function(){return!!/^(\+|-)?\d+($|\.\d+$)/.test(this)},String.prototype._contains=function(e){for(var t=0,r=this.length;t<r;t++){var n=this[t];if(-1!==e.indexOf(n))return!0}return!1},String.prototype._cleanup=function(){for(var e=this.split("/"),t=0;t<e.length;)".."==e[t]&&t>0?e.splice(t-1,t+1):t++;for(t=0;t<e.length;)"."==e[t]?e.splice(t,1):t++;var r="";for(t=0;t<e.length;t++)r+=e[t],t!=e.length-1&&(r+="/");return r},"undefined"!=typeof window&&(window.global=window);var d=Object.freeze({__proto__:null}),p={None:0,All:4294967295,Debug:1,Log:2,Warn:4,Error:8},f={Left:"Left",Right:"Right",Top:"Top",Bottom:"Bottom",Front:"Front",Back:"Back",Center:"Center"};function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function _(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,y(e,t,"get"))}function v(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,y(e,t,"set"),r),r}function y(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}var x="undefined"!=typeof Symbol?Symbol.toStringTag:"@@toStringTag",b=new WeakMap,A=new WeakMap;class S{constructor(e){var{executor:t=(()=>{}),internals:r=P(),promise:n=new Promise(((e,n)=>t(e,n,(e=>{r.onCancelList.push(e)}))))}=e;g(this,b,{writable:!0,value:void 0}),g(this,A,{writable:!0,value:void 0}),m(this,x,"CancelablePromise"),this.cancel=this.cancel.bind(this),v(this,b,r),v(this,A,n||new Promise(((e,n)=>t(e,n,(e=>{r.onCancelList.push(e)})))))}then(e,t){return D(_(this,A).then(T(e,_(this,b)),T(t,_(this,b))),_(this,b))}catch(e){return D(_(this,A).catch(T(e,_(this,b))),_(this,b))}finally(e,t){return t&&_(this,b).onCancelList.push(e),D(_(this,A).finally(T((()=>{if(e)return t&&(_(this,b).onCancelList=_(this,b).onCancelList.filter((t=>t!==e))),e()}),_(this,b))),_(this,b))}cancel(){_(this,b).isCanceled=!0;var e=_(this,b).onCancelList;for(var t of(_(this,b).onCancelList=[],e))if("function"==typeof t)try{t()}catch(e){console.error(e)}}isCanceled(){return!0===_(this,b).isCanceled}}class E extends S{constructor(e){super({executor:e})}}function w(e){return D(e,P())}function C(e){return e instanceof E||e instanceof S}function T(e,t){if(e)return r=>{if(!t.isCanceled){var n=e(r);return C(n)&&t.onCancelList.push(n.cancel),n}return r}}function D(e,t){return new S({internals:t,promise:e})}function M(e,t){var r=P();return r.onCancelList.push((()=>{for(var t of e)C(t)&&t.cancel()})),new S({internals:r,promise:t})}function P(){return{isCanceled:!1,onCancelList:[]}}m(E,"all",(function(e){return M(e,Promise.all(e))})),m(E,"allSettled",(function(e){return M(e,Promise.allSettled(e))})),m(E,"any",(function(e){return M(e,Promise.any(e))})),m(E,"race",(function(e){return M(e,Promise.race(e))})),m(E,"resolve",(function(e){return w(Promise.resolve(e))})),m(E,"reject",(function(e){return w(Promise.reject(e))})),m(E,"isCancelable",C);var F="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function R(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){if(this instanceof e){var r=[null];return r.push.apply(r,arguments),new(Function.bind.apply(t,r))}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var N={};!function(e,t){e.exports=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],i=e[2],a=e[3];n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|a>>>20)+r|0)&r|~a&n)+t[2]+606105819|0)<<17|i>>>15)+a|0)&a|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|a>>>20)+r|0)&r|~a&n)+t[6]-1473231341|0)<<17|i>>>15)+a|0)&a|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|a>>>20)+r|0)&r|~a&n)+t[10]-42063|0)<<17|i>>>15)+a|0)&a|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|a>>>20)+r|0)&r|~a&n)+t[14]-1502002290|0)<<17|i>>>15)+a|0)&a|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|a>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+a|0)&r|a&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|a>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+a|0)&r|a&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|a>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+a|0)&r|a&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|a>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+a|0)&r|a&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|a>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+a|0)^a^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|a>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+a|0)^a^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|a>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+a|0)^a^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|a>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+a|0)^a^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[14]-1416354905|0)<<15|i>>>17)+a|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[10]-1051523|0)<<15|i>>>17)+a|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[6]-1560198380|0)<<15|i>>>17)+a|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[2]+718787259|0)<<15|i>>>17)+a|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=a+e[3]|0}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function i(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function a(e){var t,i,a,s,o,l,u=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)r(c,n(e.substring(t-64,t)));for(i=(e=e.substring(t-64)).length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(r(c,a),t=0;t<16;t+=1)a[t]=0;return s=(s=8*u).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(s[2],16),l=parseInt(s[1],16)||0,a[14]=o,a[15]=l,r(c,a),c}function s(e){var t,n,a,s,o,l,u=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)r(c,i(e.subarray(t-64,t)));for(n=(e=t-64<u?e.subarray(t-64):new Uint8Array(0)).length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)a[t>>2]|=e[t]<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(r(c,a),t=0;t<16;t+=1)a[t]=0;return s=(s=8*u).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(s[2],16),l=parseInt(s[1],16)||0,a[14]=o,a[15]=l,r(c,a),c}function o(e){var r,n="";for(r=0;r<4;r+=1)n+=t[e>>8*r+4&15]+t[e>>8*r&15];return n}function l(e){var t;for(t=0;t<e.length;t+=1)e[t]=o(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e,t){var r,n=e.length,i=new ArrayBuffer(n),a=new Uint8Array(i);for(r=0;r<n;r+=1)a[r]=e.charCodeAt(r);return t?a:i}function h(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function d(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function p(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function f(){this.reset()}return l(a("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,a,s,o,l=this.byteLength,u=t(r,l),c=l;return n!==e&&(c=t(n,l)),u>c?new ArrayBuffer(0):(i=c-u,a=new ArrayBuffer(i),s=new Uint8Array(a),o=new Uint8Array(this,u,i),s.set(o),a)}}(),f.prototype.append=function(e){return this.appendBinary(u(e)),this},f.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)r(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},f.prototype.end=function(e){var t,r,n=this._buff,i=n.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)a[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(a,i),r=l(this._hash),e&&(r=p(r)),this.reset(),r},f.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},f.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},f.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},f.prototype._finish=function(e,t){var n,i,a,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(r(this._hash,e),s=0;s<16;s+=1)e[s]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),a=parseInt(n[1],16)||0,e[14]=i,e[15]=a,r(this._hash,e)},f.hash=function(e,t){return f.hashBinary(u(e),t)},f.hashBinary=function(e,t){var r=l(a(e));return t?p(r):r},f.ArrayBuffer=function(){this.reset()},f.ArrayBuffer.prototype.append=function(e){var t,n=d(this._buff.buffer,e,!0),a=n.length;for(this._length+=e.byteLength,t=64;t<=a;t+=64)r(this._hash,i(n.subarray(t-64,t)));return this._buff=t-64<a?new Uint8Array(n.buffer.slice(t-64)):new Uint8Array(0),this},f.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)a[t>>2]|=n[t]<<(t%4<<3);return this._finish(a,i),r=l(this._hash),e&&(r=p(r)),this.reset(),r},f.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.ArrayBuffer.prototype.getState=function(){var e=f.prototype.getState.call(this);return e.buff=h(e.buff),e},f.ArrayBuffer.prototype.setState=function(e){return e.buff=c(e.buff,!0),f.prototype.setState.call(this,e)},f.ArrayBuffer.prototype.destroy=f.prototype.destroy,f.ArrayBuffer.prototype._finish=f.prototype._finish,f.ArrayBuffer.hash=function(e,t){var r=l(s(new Uint8Array(e)));return t?p(r):r},f}()}({get exports(){return N},set exports(e){N=e}});var B=r({__proto__:null,default:N},[N]),I="a".charCodeAt(),O="f".charCodeAt(),k="A".charCodeAt(),L="F".charCodeAt(),U="0".charCodeAt(),z="7".charCodeAt(),j="9".charCodeAt(),V=function(e,t){var r=null,n=e.charCodeAt();if(I<=n&&n<=O)r=n-I+10;else if(k<=n&&n<=L)r=n-k+10;else{if(!(U<=n&&n<=j))throw new Error("Invalid ascii ["+e+"]");r=n-U}for(;t--;)r*=16;return r},G=function(e){for(var t=0,r=0,n=(e=e.replace(/^0[Oo]?/,"")).length-1;n>=0;n--)t+=W(e[n],r++);return t},W=function(e,t){var r=null,n=e.charCodeAt();if(!(n>=U&&n<=z))throw new Error("Invalid char to Octal ["+e+"]");for(r=n-U;t--;)r*=8;return r},H=function(e){var t=G(e);return String.fromCharCode(t)},q=function(e){switch(e.toLowerCase()){case"b":return"\b";case"f":return"\f";case"n":return"\n";case"r":return"\r";case"t":return"\t";case"v":return"\v";default:return e}},X=function(e){return e.replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\|/g,"\\|")},Q=function(e){return e.replace(/\\([\sA-Za-z\\]|[0-7]{1,3})/g,(function(e,t){switch(t){case"\\":return"\\";case"0":return"\0";default:return/^\w$/.test(t)?q(t):/^\s$/.test(t)?t:/([0-7]{1,3})/.test(t)?H(t):e}}))},K=function(e){for(var t=0,r=0,n=(e=e.replace(/^[0Oo][Xx]/,"")).length-1;n>=0;n--)t+=V(e[n],r++);return t},Y=G,Z="",J=!1,$=function(e){var t=new RegExp("[^%]*%[0-9]*[A-Za-z][^%]*","g"),r=e.match(t);if(null===r)throw new Error("Unable to parse scanf selector.");var n,i=r.length,a=!1,s=0,o=Array.prototype.slice.call(arguments,1);if(this.sscanf||(J||(Z=""),J=!0),o.length>0)n={},a=!0;else{if(!(i>1))return te(r[0]);n=[]}return r.forEach((function(e){a?n[o.shift()||s++]=te(e):n.push(te(e))})),n};var ee=function(e,t,r,n){var i;if(!Z.length||"\r"===Z){if(!J)return null;Z=gets()}var a="("+r+")",s=Z;if("STR"===n&&t.trim().length>0){var o=X(e),l=X(t)+"[\\w\\W]*";o.length&&(s=s.replace(new RegExp(o),"")),s=s.replace(new RegExp(l),"")}else a=X(e)+a;var u=s.match(new RegExp(a));return u?(i=u[1],Z=Z.substr(Z.indexOf(i)).replace(i,"").replace(t,""),"HEXFLOAT"===n?u:i):null},te=function(e){var r,n=e.match(/%(0[1-9]+)?[A-Za-z]+/),i=e.match(/[^%]*/);if(!n)return console.warn("Invalid scanf selector: [%s]",e),null;var a=n[0].replace(n[1],""),s=i?i[0]:null,o=e.substr(e.indexOf(a)+a.length);switch(a){case"%d":case"%ld":case"%llu":case"%lu":case"%u":r=function(e,r){var n=ee(e,r,"[-]?[A-Za-z0-9]+");if(!n)return null;if(n.length>2&&"0"===n[0]){if("x"===n[1].toLowerCase())try{return K(n)}catch(e){return t.throw?NaN:null}if("o"===n[1].toLowerCase())try{return Y(n)}catch(e){return t.throw?NaN:null}}return parseInt(n)}(s,o);break;case"%c":case"%s":r=function(e,t){var r=ee(e,t,"([\\w\\]=-]|\\S+[^\\ ])+(\\\\[\\w\\ ][\\w\\:]*)*","STR");return/\\/.test(r)&&(r=Q(r)),r}(s,o);break;case"%S":r=function(e,t){var r=ee(e,t,"[^\n\r]*");return/\\/.test(r)&&(r=Q(r)),r}(s,o);break;case"%X":case"%x":r=function(e,r){var n=ee(e,r,"[A-Za-z0-9]+");try{return K(n)}catch(e){return t.throw?NaN:null}}(s,o);break;case"%O":case"%o":r=function(e,r){var n=ee(e,r,"[A-Za-z0-9]+");try{return Y(n)}catch(e){return t.throw?NaN:null}}(s,o);break;case"%a":r=function(e,t){var r=ee(e,t,"^([+-]?)0x([0-9a-f]*)(.[0-9a-f]*)?(p[+-]?[0-9a-f]+)?","HEXFLOAT"),n=r[2],i=r[3],a=r[4],s=r[5]||"p0",o=parseInt(n+i+(void 0!==a?a.slice(1):""),16),l=parseInt(s.slice(1),16)-4*(void 0!==a?a.length-1:0);return o*Math.pow(2,l)}(s,o);break;case"%f":r=function(e,t){var r=ee(e,t,"[-]?[0-9]+[.]?[0-9]*");return parseFloat(r)}(s,o);break;default:throw new Error('Unknown type "'+a+'"')}return r};function re(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],s=0;s<n;s++){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&((t-=3)>-1&&a.push(239,191,189),i=null);if(r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<2097152))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}var ne=Object.prototype.toString,ie=function(e){var t="[object "+e+"]";return function(e){return ne.call(e)==t}};class ae{static isBoolean(e){return"boolean"==typeof e}static isNull(e){return null==e}static isValid(e){return null!=e}static isNumberString(e){return!!/^(\+|-)?\d+($|\.\d+$)/.test(e)}static isBooleanString(e){var t=e.toLowerCase();return"true"==t||"false"==t}static parseValue(e,t){return null==e?t:e}static parseArray(e,t){return null==e?t:e.slice(0)}static parseBoolean(e,t){return null==e||isNaN(e)?t:!(!e||"0"==e)}static parseNumber(e,t){return null==e||isNaN(e)?t:e}static parseFloat(e,t,r){return ae.isNumber(r)?parseFloat(parseFloat(e).toFixed(r)):ae.isNumber(e)||ae.isNumberString(e)?parseFloat(e):t}static debug(){console.debug.apply(console,arguments)}static log(){console.log.apply(console,arguments)}static warn(){console.warn.apply(console,arguments)}static error(){console.error.apply(console,arguments)}}ae.isType=ie,ae.isArray=ie("Array"),ae.isSet=ie("Set"),ae.isObject=ie("Object"),ae.isString=ie("String"),ae.isNumber=ie("Number"),ae.isFunction=function(e){var t=e.map((e=>"[object "+e+"]"));return function(e){var r=ne.call(e);return-1!==t.indexOf(r)}}(["Function","AsyncFunction"]),ae.isAsyncFunction=ie("AsyncFunction"),ae.isRegExp=ie("RegExp"),ae.isInt8Array=ie("Int8Array"),ae.isInt16Array=ie("Int16Array"),ae.isInt32Array=ie("Int32Array"),ae.isUint8Array=ie("Uint8Array"),ae.isUint16Array=ie("Uint16Array"),ae.isUint32Array=ie("Uint32Array"),ae.isUndefined=ie("Undefined"),ae.isArrayBuffer=function(e){return e&&"ArrayBuffer"==e.constructor.name};var se={},oe=[],le=[],ue={},ce={},he={};new TextDecoder("utf8");var de="undefined"==typeof performance?Date:performance,pe="undefined"!=typeof window?window:"undefined"!=typeof global?global:null,fe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function me(e,t){var r=Math.floor(e);return t[0]=(r>>16&255)/255,t[1]=(r>>8&255)/255,t[2]=(255&r)/255,t}var ge=eval,_e=function(e){try{return ge(e)}catch(e){}},ve=function e(t,r,n){var i,a,s,o,l,u,c,h;if(u=e,"undefined"===(c=typeof r)||null===r||0===r||!1===r)r=0;else if("object"===c){if(!(r instanceof u))throw new TypeError('Expected "deep" to be a special object')}else if(!0===r)r=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(r)||r<0)throw new RangeError('Expected "deep" to be a positive number, got '+r)}if(null===t||"object"!=typeof t)throw new TypeError('Expected "input" to be an object');if(c=typeof n,null!==n&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(n=n||null,o=(s=Object.keys(t)).length-1,l={},r){if("number"==typeof r)r=Object.seal(Object.create(u.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:r,writable:!1}}));else if(~(i=r.input.indexOf(t)))return r.output[i];for(r.level+=1,r.input.push(t),r.output.push(l),i=o+1;i--;){"object"==typeof(h=t[a=s[o-i]])&&h&&r.level<r.max&&h.constructor===Object&&(h=u(h,r,n)),(n||function(){return!0})(a,h)?l[a.toLowerCase()]=h:l[a]=h}r.level-=1}else for(i=o+1;i--;){(n||function(){return!0})(a=s[o-i],h)?l[a.toLowerCase()]=t[a]:l[a]=t[a]}return l},ye=function(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1)},xe=[],be={RegExp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t="";return t+=e.global?"g":"",t+=e.multiline?"m":"",t+=e.ignoreCase?"i":"",new RegExp(e.source,t)})),Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return new Date(+e)})),Array:function(e,t,r,n){var i,a=[];for(i=0;i<e.length;i++)if(t)a[i]=e[i];else{if(-1!==xe.indexOf(e[i]))continue;if(n&&e[i]){var s=n(e[i]);if(s){a[i]=s;continue}}var o=be[ye(e[i])];o?(xe.push(e[i]),a[i]=o(e[i],!1)):a[i]=e[i]}return a},Object:function(e,t,r,n){var i,a,s={};for(i in e)if(!r||r(i))if(t)s[i]=e[i];else{if(-1!==xe.indexOf(e[i]))continue;if(n&&e[i]){var o=n(e[i],i);if(o){s[i]=o;continue}}(a=be[ye(e[i])])?(xe.push(e[i]),s[i]=a(e[i],!1,r,n)):s[i]=e[i]}return s}};function Ae(e,t,r){var n=t[0],i=t.slice(1),a=e[n],s=[];function o(){i.length>0&&a&&s.push(Ae(a,i,r))}o(),Object.defineProperty(e,n,{get:function(){return a}.bind(this),set:function(e){if(!i.length){var t=!1,n=r.onCompareValue;n&&n(a,e)&&(_e("debugger"),t=!0)}if(a=e,o(),t){var s=r.onValueChanged;s&&s(e)}}.bind(this),enumerable:!0,configurable:!0})}var Se=null;let Ee=class{static setBatchTimeout(e){Ee.batchTimeoutCallbacks.push(e)}static setTimeout(e,t){if(void 0!==t){var r=++Ee.id;return Ee.timeoutCallbacks.push({id:r,callback:e,time:t/1e3}),r}Ee.directTimeoutCallbacks.push(e)}static clearTimeout(e){!function(e,t){if(e){var r=we.binarySearch(t,(t=>t.id-e));-1!==r&&t.splice(r,1)}}(e,Ee.timeoutCallbacks)}static update(e){var t=Ee.directTimeoutCallbacks.length;if(t){var r=Ee.directTimeoutCallbacks.slice(0);Ee.directTimeoutCallbacks.splice(0,t);for(var n=0;n<t;n++)r[n]()}for(var i=Ee.timeoutCallbacks,a=0;a<i.length;a++){var s=i[a];s.time-=e,s.time>0||(i.splice(a--,1),s.callback())}if(Ee.batchTimeoutCallbacks.length){for(var o=Math.min(Ee.batchTimeoutCallbacks.length,Ee.batchNumber),l=0;l<o;l++)Ee.batchTimeoutCallbacks[l]();Ee.batchTimeoutCallbacks.splice(0,o)}Ee.updateCallbacks.length&&Ee.updateCallbacks.forEach((t=>{t(e)}))}static addUpdateCallback(e){Ee.updateCallbacks.push(e)}static removeUpdateCallback(e){var t=Ee.updateCallbacks.indexOf(e);-1!=t&&Ee.updateCallbacks.splice(t,1)}};Ee.id=0,Ee.batchNumber=100,Ee.batchTimeoutCallbacks=[],Ee.updateCallbacks=[],Ee.timeoutCallbacks=[],Ee.directTimeoutCallbacks=[];let we=class extends ae{static setBatchTimeoutNumber(e){Ee.batchNumber=e}static getBatchTimeoutNumber(){return Ee.batchNumber}static setBatchTimeout(e){Ee.setBatchTimeout(e)}static setTimeout(e,t){return Ee.setTimeout(e,t)}static clearTimeout(e){Ee.clearTimeout(e)}static addUpdateCallback(e){Ee.addUpdateCallback(e)}static removeUpdateCallback(e){Ee.removeUpdateCallback(e)}static update(e){Ee.update(e)}static get disableDebug(){return console.debug!=Ce}static set disableDebug(e){console.debug=e?function(){}:Ce}static get disableLog(){return console.log!=Te}static set disableLog(e){console.log=e?function(){}:Te}static get disableWarn(){return console.warn!=De}static set disableWarn(e){console.warn=e?function(){}:De}static get disableError(){return console.error!=Me}static set disableError(e){console.error=e?function(){}:Me}static get disableDebug(){return console.debug!=Ce}static set disableDebug(e){console.debug=e?function(){}:Ce}static get disableTime(){return console.time!=Pe}static set disableTime(e){e?(console.time=function(){},console.timeEnd=function(){}):(console.time=Pe,console.timeEnd=Fe)}static parseObject(e,t){return void 0===t&&(t={}),we.isObject(e)?we.mergeObject({},e,!0):we.mergeObject({},t)}static parseJSON(e){try{return we.isArrayBuffer(e)?JSON.parse(we.arrayBufferToString(e)):we.isArray(e)||we.isUint8Array(e)?JSON.parse(we.bufferToString(e)):JSON.parse(e)}catch(e){return we.error(e),{}}}static getFunctionsFromObject(e){var t=[],r=Object.getOwnPropertyNames(Object.getPrototypeOf(e)),n=Object.getOwnPropertyNames(Object.getPrototypeOf(e.__proto__)),i=r.concat(n);for(var a of i){e[a]instanceof Function&&("constructor"!=a&&t.push(a))}return t.sort()}static getFunctionsFromClassType(e){return we.getFunctionsFromObject(new e)}static getStaticFunctionsFromClassType(e){return Object.getOwnPropertyNames(e).filter((t=>we.isFunction(e[t])))}static getClassNameFromProto(e){return e.constructor.className||e.constructor.name}static getClassNamesFromProto(e){for(var t=[];e;){var r=we.getClassNameFromProto(e);"Object"!=r&&-1===t.indexOf(r)&&t.push(r),e=e.__proto__}return t}static debug(){we.logLevelType&p.Debug&&console.debug.apply(console,arguments)}static log(){we.logLevelType&p.Log&&console.log.apply(console,arguments)}static warn(){we.logLevelType&p.Warn&&console.warn.apply(console,arguments)}static error(){we.logLevelType&p.Error&&console.error.apply(console,arguments)}static getCurrentTime(){return de.now()/1e3}static getElapsedTime(e){return we.getCurrentTime()-e}static getCurrentTimeMilliseconds(){return de.now()}static getElapsedTimeMilliseconds(e){return we.getCurrentTimeMilliseconds()-e}static setValueBreakpoint(e,t,r){void 0===r&&(r=(e,t)=>e!=t);var n={onCompareValue:r,onValueChanged:function(){}},i={onValueChanged:function(e){n.onValueChanged=e}};return we.isArray(t)?t.forEach((t=>{Ae(e,[t],n)})):we.isString(t)&&Ae(e,[t],n),i}static enableNaNCatch(e){void 0===e&&(e=!0),function(e){e&&!Se?(Se=Object.prototype.valueOf,Object.prototype.valueOf=function(){if("number"!=typeof this)throw new Error("Object is not a Number");return Se.call(this)}):(Object.prototype.valueOf=Se,Se=null)}(e)}static getUnionKeys(e,t){for(var r=Object.keys(e),n=Object.keys(t),i=0,a=n.length;i<a;i++){var s=n[i];-1==r.indexOf(s)&&r.push(s)}return r}static formatMoney(e,t){return void 0===t&&(t=0),e.toFixed(t).replace(/\B(?=(\d{3})+(?!\d))/g,",")}static formatByteSize(e,t,r){return void 0===t&&(t=2),void 0===r&&(r="B"),e>1e12?we.formatMoney(e/1e12,t)+" T"+r:e>1e9?we.formatMoney(e/1e9,t)+" G"+r:e>1e6?we.formatMoney(e/1e6,t)+" M"+r:e>1e3?we.formatMoney(e/1e3,t)+" K"+r:r?we.formatMoney(e,t)+" "+r:we.formatMoney(e,t)}static allocateArray(e,t){if(e)return null;for(var r=[],n=0;n<t;n++)r.push(new e);return r}static getArrayLength(e){return we.isArray(e)?e.length:0}static isEmptyArray(e){return we.isType("Array")(e)&&0==e.length}static pushToArray(e,t){t&&(-1===e.indexOf(t)&&e.push(t))}static removeFromArray(e,t){if(!e)return!1;var r=e.indexOf(t);return-1!==r&&(e._removeAt(r),!0)}static getIndexFromArrays(e,t){for(var r=0;r<t.length;r++){var n=t[r].indexOf(e);if(-1!==n)return n}return-1}static combineArray(e,t,r){e[t]=e[t]||[],we.isArray(r)?e[t].concat(r):e[t].push(r)}static toLowerCase(e){return e?e.toLowerCase():""}static toUpperCase(e){return e?e.toUpperCase():""}static isBase64Url(e){return!(!e._startsWith("data:")||-1===e.indexOf("base64,"))}static isVideoUrl(e){return/\.(mp4|m4v|webm|flv|f4v|mov|avi|wmv|mpeg|mpg|mkv|ts)$/i.test(e)}static isBlobUrl(e){return!!e._startsWith("blob:")}static beautySub(e,t){var r=/[\u4e00-\u9fa5]/g,n=e.substring(0,t),i=~~(n.match(r)&&n.match(r).length),a=2*n.length-i;return e.substr(0,a)+(a<e.length?"...":"")}static objectKeysToLowerCase(e,t,r){return ve(e,t,r)}static fontSizeToPixelSize(e){return e/72*96}static pixelSizeToFontSize(e){return e/96*72}static isClass(e){if("function"!=typeof e)return!1;var t=e.toString();return void 0!==e.prototype&&(e.prototype.constructor===e&&("class"==t.slice(0,5)||(Object.getOwnPropertyNames(e.prototype).length>=2||(/^function\s+\(|^function\s+anonymous\(/.test(t),!1))))}static isImagePath(e){return/\.(tga|png|gif|jpe?g|tiff?|webp|bmp)$/i.test(e)}static isEmptyObject(e){return!Object.keys(e).length}static equalsObject(e,t){for(var r in e)if(e[r]!=t[r])return!1;return!0}static clearObject(e){for(var t in e)delete e[t]}static cloneObject(e,t,r,n){void 0===t&&(t=!0),void 0===r&&(r=null),void 0===n&&(n=null),xe.length=0;var i=be[ye(e)];return i?i(e,t,r,n):e}static copyObject(e,t){if(e===t)return e;if(t)for(var r in we.clearObject(e),t){var n=t[r];n&&we.isObject(n)?(e[r]={},we.copyObject(e[r],n)):e[r]=n}return e}static copyUint8Array(e){var t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e))}static mergeObject(e,t,r){if(!t)return we.cloneObject(e);if(!we.isObject(t)||!we.isObject(e))return r?we.cloneObject(t):e;for(var n in t){var i=e[n],a=t[n];we.isObject(a)&&we.isObject(i)?we.mergeObject(i,a,r):!r&&n in e||(e[n]=we.cloneObject(t[n],!0))}return e}static assignValues(e,t){if(we.isArray(t))t.forEach((t=>{we.assignValues(e,t)}));else for(var r in t)void 0===e[r]&&(e[r]=t[r])}static colorToHex(e){return 255*e[0]<<16^255*e[1]<<8^255*e[2]<<0}static colorToHexString(e){return e?"#"+("000000"+we.colorToHex(e).toString(16)).slice(-6):null}static equalsColor(e,t,r){return void 0===r&&(r=1e-4),!(!we.isArray(e)||!we.isArray(t))&&(!(Math.abs(e[0]-t[0])>r)&&(!(Math.abs(e[1]-t[1])>r)&&!(Math.abs(e[2]-t[2])>r)))}static isColorString(e){if(we.isArray(e))return!0;if(we.isNumber(e))return!0;if(we.isString(e)){if("#"==e[0])return!0;if(e.startsWith("rgb("))return!0;if(e.startsWith("rgba("))return!0}return void 0!==fe[e.toLowerCase()]}static parseColor(e,t,r){if(r=r||[],we.isArray(e))return r[0]=e[0],r[1]=e[1],r[2]=e[2],void 0!==e[3]&&(r[3]=e[3]),r;if(we.isNumber(e))return me(e,r);if(we.isString(e)){if("#"==e[0])return me(parseInt(e.substr(1),16),r);if(e.startsWith("rgb(")){if(3===(s=e.substring(4).split(",")).length){var n=parseInt(s[0]),i=parseInt(s[1]),a=parseInt(s[2]._trimRight(" )"));return r[0]=n/255,r[1]=i/255,r[2]=a/255,r}}else if(e.startsWith("rgba(")){var s;if(4===(s=e.substring(5).split(",")).length){var o=parseInt(s[0]),l=parseInt(s[1]),u=parseInt(s[2]),c=parseFloat(s[3]._trimRight(" )"));return r[0]=o/255,r[1]=l/255,r[2]=u/255,r[3]=c,r}}else{if(!isNaN(e))return me(parseInt(e),r);var h=fe[e.toLowerCase()];if(void 0!==h)return me(h,r)}}return t}static parseValueFromTypes(e,t,r){for(var n=Object.keys(e),i=0;i<n.length;i++){var a=n[i];if(e[a]==t)return a}return void 0!==r?r:t}static toColorHexString(e,t){var r=we.parseColor(e,t);return"#"+Number(Math.round(255*r[0])).toString(16).padStart(2,"0")+Number(Math.round(255*r[1])).toString(16).padStart(2,"0")+Number(Math.round(255*r[2])).toString(16).padStart(2,"0")}static hasAttribute(e,t,r){return void 0===r&&(r="/"),void 0!==we.getAttribute(e,t,r)}static getAttribute(e,t,r){if(void 0===r&&(r="/"),e&&t){var n=t.split(r);if(n.length)for(var i=0,a=n.length;i<a;i++){var s=e[n[i]];if(void 0===s)return;e=s}return e}}static setAttribute(e,t,r,n){return void 0===n&&(n="/"),function(t){if(!e||!t)return null;for(var i=t.split(n),a=0;a<i.length;a++){t=i[a];if(a==i.length-1){e[t]=r;break}we.isNull(e[t])&&(e[t]={}),e=e[t]}return r}(t)}static setAttributes(e,t,r){void 0===r&&(r=!0);var n={};for(var i in t){var a=e[i];if(void 0!==a){if(!r)continue;n[i]=a}e[i]=t[i]}return n}static setAttributeIfExist(e,t,r,n,i){void 0===n&&(n=e=>void 0!==e),void 0===i&&(i=t);var a=r[i];void 0!==a&&n(a)&&(e[t]=a)}static swapObjectAttribute(e,t,r){var n=e[t];return e[t]=e[r],e[r]=n,e}static binarySearch(e,t){var r=0,n=e.length-1;if(we.isFunction(t))for(;r<=n;){if(0===t(e[i=Math.floor((r+n)/2)]))return i;t(e[i])>0?n=i-1:r=i+1}else for(;r<=n;){var i;if(t===e[i=Math.floor((r+n)/2)])return i;t<e[i]?n=i-1:r=i+1}return-1}static binaryBound(e,t,r){if(!e.length)return 0;var n=0,i=e.length-1;if(r){for(;n<i-1;){var a=r(e[s=Math.floor((n+i)/2)],t);if(0==a)return s;a<0?n=s:i=s}if(r(e[n],t)>0)return n;if(r(e[i],t)>0)return i}else{for(;n<i-1;){var s;if(e[s=Math.floor((n+i)/2)]===t)return s;e[s]<t?n=s:i=s}if(e[n]>t)return n;if(e[i]>t)return i}return-1}static insertBinaryBound(e,t,r){var n=we.binaryBound(e,t,r);return-1===n?e.push(t):e.splice(n,0,t),e}static throttling(e,t){var r,n,i,a=()=>{r=setTimeout((()=>{e.apply(n,i),clearTimeout(r),r=null}),t)};return function(){n=this,i=arguments,r||a()}}static getMD5CodeFromString(e){return N.hash(e)}static getMD5CodeFromBuffer(e,t){return new Promise(((r,n)=>{var i=new B;!function(e,t,r){var n=e.size,i=4194304,a=0,s=new FileReader;function o(){var t=e.slice(a,a+i);s.readAsBinaryString(t)}s.onload=function(){s.error?r(s.error||{}):(a+=s.result.length,t(s.result,a,n),a>=n?r(null):o())},s.onerror=function(e){r(e||{})},o()}(e,((e,r,n)=>{i.appendBinary(e),t&&t(r/n)}),(e=>{if(e)n(e);else{var t=i.end();r(t)}}))}))}static applyNew(e,t){if(!e)return null;var r=[{}].concat(t||[]);return new(Function.prototype.bind.apply(e,r))}static itoa(e){return String.fromCharCode(e)}static atoi(e){return e.charCodeAt()}static base64ToBlob(e){for(var t=atob(e),r=t.length,n=new Uint8Array(r);r--;)n[r]=t.charCodeAt(r);return n}static blobToBase64(e){for(var t="",r=0,n=e.length;r<n;++r)t+=String.fromCharCode(e[r]);return btoa(t)}static arrayBufferToString(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}static uint8ArrayToString(e){for(var t=new TextDecoder,r=0,n="";r<e.length;){var i=e.subarray(r,r+128);n+=t.decode(i,{stream:!0}),r+=128}return n+=t.decode()}static stringToArrayBuffer(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return t}static arrayBufferToUtf16(e){return String.fromCharCode.apply(null,new Uint16Array(e))}static utf16ToArrayBuffer(e){for(var t=new ArrayBuffer(2*e.length),r=new Uint16Array(t),n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return t}static arrayBufferToBlob(e,t){return new Blob([new Uint8Array(e,0,e.byteLength)],t)}static blobToArrayBuffer(e){return new Response(e).arrayBuffer()}static bufferToBlob(e,t){return new Blob([e],t)}static blobToBuffer(e){return new Promise(((t,r)=>{new Response(e).arrayBuffer().then((e=>{t(new Uint8Array(e))}))}))}static stringToBuffer(e){return"undefined"==typeof Uint8Array?re(e):new Uint8Array(re(e))}static bufferToString(e){return we.uint8ArrayToString(e)}static syncOptions(e,t,r){if(void 0===r&&(r={}),!t)return!1;for(var n in r){var i=we.parseValue(t[n],r[n]);we.isNull(i)||(e[n]=i)}return!0}static _break(){_e("debugger")}static eval(e){_e(e)}static scanf(e,t){return function(e,t){return"string"==typeof e&&e.length?(J&&(Z=""),Z=e,J=!1,$.apply({sscanf:!0},Array.prototype.slice.call(arguments,1))):null}(e,t)}static getMacros(){return ue}static addFactory(e,t,r){void 0===t&&(t=""),void 0===r&&(r=0),e&&(le.push({factory:e,name:t,priority:r,index:le.length}),le.sort(((e,t)=>e.priority!=t.priority?e.priority>t.priority:e.index>t.index)))}static addFactories(e){e.forEach((e=>{we.addFactory(e)}))}static getFactories(){return le.map((e=>e.factory))}static setFactory(e,t){for(var r=0;r<le.length;r++)if(le[r].name==t)return le[r].factory=e,!0;return!1}static createObject(e,t){void 0===t&&(t=se);for(var r=0,n=le.length;r<n;r++){var i=le[r].factory.createObject(e,t);if(i)return i}return we.error("Create (type: '"+e+"') object failed",t),null}static getGlobal(){return pe}static registerClass(e,t,r,n){return!!e&&(we.isClass(t)&&(void 0===t.className&&(t.className=e),ce[e]=t),r&&(!n&&r[e]||(r[e]=t)),!0)}static registerClasses(e,t,r){for(var n in e)this.registerClass(n,e[n],t,r)}static getRegisteredClass(e){var t=ce[e];return t||null}static getRegisteredClasses(){return ce}static regsiterVariable(e,t){he[e]=t}static unregsiterVariable(e){delete he[e]}static getRegsiteredVariable(e){return he[e]}static makeCancelablePromise(e){return w(e)}static isNativeFunction(e){return!!we.isFunction(e)&&"function toString() { [native code] }"===e.toString()}static bindObjectProperty(e,t,r){Object.defineProperty(e,r,{get:function(){return t[r]},set:function(e){t[r]=e}})}static getProgressByLayout(e){var t=0;if(we.isString(e))switch(e){case f.Left:case f.Bottom:case f.Back:t=0;break;case f.Right:case f.Top:case f.Front:t=1;break;case f.Center:t=.5}else we.isNumber(e)&&(t=e);return t}static mergeSet(e,t){we.isSet(e)||we.isArray(e)||(e=oe),we.isSet(t)||we.isArray(t)||(t=oe);var r=[...e,...t];return new Set(r)}};we.logLevelType=p.All;var Ce=console.debug,Te=console.log,De=console.warn,Me=console.error,Pe=console.time,Fe=console.timeEnd;Object.defineProperties(we,{});var Re,Ne,Be=we.stringToBuffer("iedkd*3349k3^d0343j8193<L-&"),Ie=[],Oe=0;for(Re=0;Re<256;Re++)Ie[Re]=Re;for(Re=0;Re<256;Re++)Oe=(Oe+Ie[Re]+Be[Re%Be.length])%256,Ne=Ie[Re],Ie[Re]=Ie[Oe],Ie[Oe]=Ne;var ke=Ie;class Le{static toArray(e){var t=e;return we.isType("String")(e)&&(t=we.bufferToString(e)),we.isType("Array")(e)&&(t=new Uint8Array(e)),we.isType("Uint8Array")(t)?function(e){var t,r,n,i=e.length,a=new Uint8Array(i),s=0,o=0,l=ke.slice(0);for(n=0;n<i;n++)r=l[o=(o+(t=l[s=(s+1)%256]))%256],l[s]=r,l[o]=t,a[n]=e[n]^l[(t+r)%256];return a}(t):null}static toText(e){we.isString(e)&&(e=e.split(",").map((e=>parseInt(e))));var t=Le.toArray(e);return t?we.bufferToString(t):null}}var Ue={};!function(e,t){!function(t,r){e.exports=r()}(0,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}return r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(3),a=r(8),s=r(15);function o(e,t,r){var s=null,o=function(e,t){r&&r(e,t),s&&s.visit(e,t)},l="function"==typeof r?o:null,u=!1;if(t){u="boolean"==typeof t.comment&&t.comment;var c="boolean"==typeof t.attachComment&&t.attachComment;(u||c)&&((s=new n.CommentHandler).attach=c,t.comment=!0,l=o)}var h,d=!1;t&&"string"==typeof t.sourceType&&(d="module"===t.sourceType),h=t&&"boolean"==typeof t.jsx&&t.jsx?new i.JSXParser(e,t,l):new a.Parser(e,t,l);var p=d?h.parseModule():h.parseScript();return u&&s&&(p.comments=s.comments),h.config.tokens&&(p.tokens=h.tokens),h.config.tolerant&&(p.errors=h.errorHandler.errors),p}t.parse=o,t.parseModule=function(e,t,r){var n=t||{};return n.sourceType="module",o(e,n,r)},t.parseScript=function(e,t,r){var n=t||{};return n.sourceType="script",o(e,n,r)},t.tokenize=function(e,t,r){var n,i=new s.Tokenizer(e,t);n=[];try{for(;;){var a=i.getNextToken();if(!a)break;r&&(a=r(a)),n.push(a)}}catch(e){i.errorHandler.tolerate(e)}return i.errorHandler.tolerant&&(n.errors=i.errors()),n};var l=r(2);t.Syntax=l.Syntax,t.version="4.0.1"},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=function(){function e(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return e.prototype.insertInnerComments=function(e,t){if(e.type===n.Syntax.BlockStatement&&0===e.body.length){for(var r=[],i=this.leading.length-1;i>=0;--i){var a=this.leading[i];t.end.offset>=a.start&&(r.unshift(a.comment),this.leading.splice(i,1),this.trailing.splice(i,1))}r.length&&(e.innerComments=r)}},e.prototype.findTrailingComments=function(e){var t=[];if(this.trailing.length>0){for(var r=this.trailing.length-1;r>=0;--r){var n=this.trailing[r];n.start>=e.end.offset&&t.unshift(n.comment)}return this.trailing.length=0,t}var i=this.stack[this.stack.length-1];if(i&&i.node.trailingComments){var a=i.node.trailingComments[0];a&&a.range[0]>=e.end.offset&&(t=i.node.trailingComments,delete i.node.trailingComments)}return t},e.prototype.findLeadingComments=function(e){for(var t,r=[];this.stack.length>0;){if(!((a=this.stack[this.stack.length-1])&&a.start>=e.start.offset))break;t=a.node,this.stack.pop()}if(t){for(var n=(t.leadingComments?t.leadingComments.length:0)-1;n>=0;--n){var i=t.leadingComments[n];i.range[1]<=e.start.offset&&(r.unshift(i),t.leadingComments.splice(n,1))}return t.leadingComments&&0===t.leadingComments.length&&delete t.leadingComments,r}for(n=this.leading.length-1;n>=0;--n){var a;(a=this.leading[n]).start<=e.start.offset&&(r.unshift(a.comment),this.leading.splice(n,1))}return r},e.prototype.visitNode=function(e,t){if(!(e.type===n.Syntax.Program&&e.body.length>0)){this.insertInnerComments(e,t);var r=this.findTrailingComments(t),i=this.findLeadingComments(t);i.length>0&&(e.leadingComments=i),r.length>0&&(e.trailingComments=r),this.stack.push({node:e,start:t.start.offset})}},e.prototype.visitComment=function(e,t){var r="L"===e.type[0]?"Line":"Block",n={type:r,value:e.value};if(e.range&&(n.range=e.range),e.loc&&(n.loc=e.loc),this.comments.push(n),this.attach){var i={comment:{type:r,value:e.value,range:[t.start.offset,t.end.offset]},start:t.start.offset};e.loc&&(i.comment.loc=e.loc),e.type=r,this.leading.push(i),this.trailing.push(i)}},e.prototype.visit=function(e,t){"LineComment"===e.type||"BlockComment"===e.type?this.visitComment(e,t):this.attach&&this.visitNode(e,t)},e}();t.CommentHandler=i},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),a=r(5),s=r(6),o=r(7),l=r(8),u=r(13),c=r(14);function h(e){var t;switch(e.type){case s.JSXSyntax.JSXIdentifier:t=e.name;break;case s.JSXSyntax.JSXNamespacedName:var r=e;t=h(r.namespace)+":"+h(r.name);break;case s.JSXSyntax.JSXMemberExpression:var n=e;t=h(n.object)+"."+h(n.property)}return t}u.TokenName[100]="JSXIdentifier",u.TokenName[101]="JSXText";var d=function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return n(t,e),t.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():e.prototype.parsePrimaryExpression.call(this)},t.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},t.prototype.finishJSX=function(){this.nextToken()},t.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},t.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.scanXHTMLEntity=function(e){for(var t="&",r=!0,n=!1,a=!1,s=!1;!this.scanner.eof()&&r&&!n;){var o=this.scanner.source[this.scanner.index];if(o===e)break;if(n=";"===o,t+=o,++this.scanner.index,!n)switch(t.length){case 2:a="#"===o;break;case 3:a&&(r=(s="x"===o)||i.Character.isDecimalDigit(o.charCodeAt(0)),a=a&&!s);break;default:r=(r=r&&!(a&&!i.Character.isDecimalDigit(o.charCodeAt(0))))&&!(s&&!i.Character.isHexDigit(o.charCodeAt(0)))}}if(r&&n&&t.length>2){var l=t.substr(1,t.length-2);a&&l.length>1?t=String.fromCharCode(parseInt(l.substr(1),10)):s&&l.length>2?t=String.fromCharCode(parseInt("0"+l.substr(1),16)):a||s||!c.XHTMLEntities[l]||(t=c.XHTMLEntities[l])}return t},t.prototype.lexJSX=function(){var e=this.scanner.source.charCodeAt(this.scanner.index);if(60===e||62===e||47===e||58===e||61===e||123===e||125===e)return{type:7,value:o=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(34===e||39===e){for(var t=this.scanner.index,r=this.scanner.source[this.scanner.index++],n="";!this.scanner.eof();){if((l=this.scanner.source[this.scanner.index++])===r)break;n+="&"===l?this.scanXHTMLEntity(r):l}return{type:8,value:n,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(46===e){var a=this.scanner.source.charCodeAt(this.scanner.index+1),s=this.scanner.source.charCodeAt(this.scanner.index+2),o=46===a&&46===s?"...":".";t=this.scanner.index;return this.scanner.index+=o.length,{type:7,value:o,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(96===e)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(i.Character.isIdentifierStart(e)&&92!==e){t=this.scanner.index;for(++this.scanner.index;!this.scanner.eof();){var l=this.scanner.source.charCodeAt(this.scanner.index);if(i.Character.isIdentifierPart(l)&&92!==l)++this.scanner.index;else{if(45!==l)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(t,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}return this.scanner.lex()},t.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var e=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(e)),e},t.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var e=this.scanner.index,t="";!this.scanner.eof();){var r=this.scanner.source[this.scanner.index];if("{"===r||"<"===r)break;++this.scanner.index,t+=r,i.Character.isLineTerminator(r.charCodeAt(0))&&(++this.scanner.lineNumber,"\r"===r&&"\n"===this.scanner.source[this.scanner.index]&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var n={type:101,value:t,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:e,end:this.scanner.index};return t.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(n)),n},t.prototype.peekJSXToken=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.lexJSX();return this.scanner.restoreState(e),t},t.prototype.expectJSX=function(e){var t=this.nextJSXToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},t.prototype.matchJSX=function(e){var t=this.peekJSXToken();return 7===t.type&&t.value===e},t.prototype.parseJSXIdentifier=function(){var e=this.createJSXNode(),t=this.nextJSXToken();return 100!==t.type&&this.throwUnexpectedToken(t),this.finalize(e,new a.JSXIdentifier(t.value))},t.prototype.parseJSXElementName=function(){var e=this.createJSXNode(),t=this.parseJSXIdentifier();if(this.matchJSX(":")){var r=t;this.expectJSX(":");var n=this.parseJSXIdentifier();t=this.finalize(e,new a.JSXNamespacedName(r,n))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var i=t;this.expectJSX(".");var s=this.parseJSXIdentifier();t=this.finalize(e,new a.JSXMemberExpression(i,s))}return t},t.prototype.parseJSXAttributeName=function(){var e,t=this.createJSXNode(),r=this.parseJSXIdentifier();if(this.matchJSX(":")){var n=r;this.expectJSX(":");var i=this.parseJSXIdentifier();e=this.finalize(t,new a.JSXNamespacedName(n,i))}else e=r;return e},t.prototype.parseJSXStringLiteralAttribute=function(){var e=this.createJSXNode(),t=this.nextJSXToken();8!==t.type&&this.throwUnexpectedToken(t);var r=this.getTokenRaw(t);return this.finalize(e,new o.Literal(t.value,r))},t.prototype.parseJSXExpressionAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new a.JSXExpressionContainer(t))},t.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},t.prototype.parseJSXNameValueAttribute=function(){var e=this.createJSXNode(),t=this.parseJSXAttributeName(),r=null;return this.matchJSX("=")&&(this.expectJSX("="),r=this.parseJSXAttributeValue()),this.finalize(e,new a.JSXAttribute(t,r))},t.prototype.parseJSXSpreadAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new a.JSXSpreadAttribute(t))},t.prototype.parseJSXAttributes=function(){for(var e=[];!this.matchJSX("/")&&!this.matchJSX(">");){var t=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();e.push(t)}return e},t.prototype.parseJSXOpeningElement=function(){var e=this.createJSXNode();this.expectJSX("<");var t=this.parseJSXElementName(),r=this.parseJSXAttributes(),n=this.matchJSX("/");return n&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new a.JSXOpeningElement(t,n,r))},t.prototype.parseJSXBoundaryElement=function(){var e=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var t=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(e,new a.JSXClosingElement(t))}var r=this.parseJSXElementName(),n=this.parseJSXAttributes(),i=this.matchJSX("/");return i&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new a.JSXOpeningElement(r,i,n))},t.prototype.parseJSXEmptyExpression=function(){var e=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(e,new a.JSXEmptyExpression)},t.prototype.parseJSXExpressionContainer=function(){var e,t=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(e=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),e=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(t,new a.JSXExpressionContainer(e))},t.prototype.parseJSXChildren=function(){for(var e=[];!this.scanner.eof();){var t=this.createJSXChildNode(),r=this.nextJSXText();if(r.start<r.end){var n=this.getTokenRaw(r),i=this.finalize(t,new a.JSXText(r.value,n));e.push(i)}if("{"!==this.scanner.source[this.scanner.index])break;var s=this.parseJSXExpressionContainer();e.push(s)}return e},t.prototype.parseComplexJSXElement=function(e){for(var t=[];!this.scanner.eof();){e.children=e.children.concat(this.parseJSXChildren());var r=this.createJSXChildNode(),n=this.parseJSXBoundaryElement();if(n.type===s.JSXSyntax.JSXOpeningElement){var i=n;if(i.selfClosing){var o=this.finalize(r,new a.JSXElement(i,[],null));e.children.push(o)}else t.push(e),e={node:r,opening:i,closing:null,children:[]}}if(n.type===s.JSXSyntax.JSXClosingElement){e.closing=n;var l=h(e.opening.name);if(l!==h(e.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",l),!(t.length>0))break;o=this.finalize(e.node,new a.JSXElement(e.opening,e.children,e.closing));(e=t[t.length-1]).children.push(o),t.pop()}}return e},t.prototype.parseJSXElement=function(){var e=this.createJSXNode(),t=this.parseJSXOpeningElement(),r=[],n=null;if(!t.selfClosing){var i=this.parseComplexJSXElement({node:e,opening:t,closing:n,children:r});r=i.children,n=i.closing}return this.finalize(e,new a.JSXElement(t,r,n))},t.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var e=this.parseJSXElement();return this.finishJSX(),e},t.prototype.isStartOfExpression=function(){return e.prototype.isStartOfExpression.call(this)||this.match("<")},t}(l.Parser);t.JSXParser=d},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};t.Character={fromCodePoint:function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10))+String.fromCharCode(56320+(e-65536&1023))},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&r.NonAsciiIdentifierStart.test(t.Character.fromCodePoint(e))},isIdentifierPart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&r.NonAsciiIdentifierPart.test(t.Character.fromCodePoint(e))},isDecimalDigit:function(e){return e>=48&&e<=57},isHexDigit:function(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},isOctalDigit:function(e){return e>=48&&e<=55}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=function(e){this.type=n.JSXSyntax.JSXClosingElement,this.name=e};t.JSXClosingElement=i;var a=function(e,t,r){this.type=n.JSXSyntax.JSXElement,this.openingElement=e,this.children=t,this.closingElement=r};t.JSXElement=a;var s=function(){this.type=n.JSXSyntax.JSXEmptyExpression};t.JSXEmptyExpression=s;var o=function(e){this.type=n.JSXSyntax.JSXExpressionContainer,this.expression=e};t.JSXExpressionContainer=o;var l=function(e){this.type=n.JSXSyntax.JSXIdentifier,this.name=e};t.JSXIdentifier=l;var u=function(e,t){this.type=n.JSXSyntax.JSXMemberExpression,this.object=e,this.property=t};t.JSXMemberExpression=u;var c=function(e,t){this.type=n.JSXSyntax.JSXAttribute,this.name=e,this.value=t};t.JSXAttribute=c;var h=function(e,t){this.type=n.JSXSyntax.JSXNamespacedName,this.namespace=e,this.name=t};t.JSXNamespacedName=h;var d=function(e,t,r){this.type=n.JSXSyntax.JSXOpeningElement,this.name=e,this.selfClosing=t,this.attributes=r};t.JSXOpeningElement=d;var p=function(e){this.type=n.JSXSyntax.JSXSpreadAttribute,this.argument=e};t.JSXSpreadAttribute=p;var f=function(e,t){this.type=n.JSXSyntax.JSXText,this.value=e,this.raw=t};t.JSXText=f},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=function(e){this.type=n.Syntax.ArrayExpression,this.elements=e};t.ArrayExpression=i;var a=function(e){this.type=n.Syntax.ArrayPattern,this.elements=e};t.ArrayPattern=a;var s=function(e,t,r){this.type=n.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=r,this.async=!1};t.ArrowFunctionExpression=s;var o=function(e,t,r){this.type=n.Syntax.AssignmentExpression,this.operator=e,this.left=t,this.right=r};t.AssignmentExpression=o;var l=function(e,t){this.type=n.Syntax.AssignmentPattern,this.left=e,this.right=t};t.AssignmentPattern=l;var u=function(e,t,r){this.type=n.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=r,this.async=!0};t.AsyncArrowFunctionExpression=u;var c=function(e,t,r){this.type=n.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=r,this.generator=!1,this.expression=!1,this.async=!0};t.AsyncFunctionDeclaration=c;var h=function(e,t,r){this.type=n.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=r,this.generator=!1,this.expression=!1,this.async=!0};t.AsyncFunctionExpression=h;var d=function(e){this.type=n.Syntax.AwaitExpression,this.argument=e};t.AwaitExpression=d;var p=function(e,t,r){var i="||"===e||"&&"===e;this.type=i?n.Syntax.LogicalExpression:n.Syntax.BinaryExpression,this.operator=e,this.left=t,this.right=r};t.BinaryExpression=p;var f=function(e){this.type=n.Syntax.BlockStatement,this.body=e};t.BlockStatement=f;var m=function(e){this.type=n.Syntax.BreakStatement,this.label=e};t.BreakStatement=m;var g=function(e,t){this.type=n.Syntax.CallExpression,this.callee=e,this.arguments=t};t.CallExpression=g;var _=function(e,t){this.type=n.Syntax.CatchClause,this.param=e,this.body=t};t.CatchClause=_;var v=function(e){this.type=n.Syntax.ClassBody,this.body=e};t.ClassBody=v;var y=function(e,t,r){this.type=n.Syntax.ClassDeclaration,this.id=e,this.superClass=t,this.body=r};t.ClassDeclaration=y;var x=function(e,t,r){this.type=n.Syntax.ClassExpression,this.id=e,this.superClass=t,this.body=r};t.ClassExpression=x;var b=function(e,t){this.type=n.Syntax.MemberExpression,this.computed=!0,this.object=e,this.property=t};t.ComputedMemberExpression=b;var A=function(e,t,r){this.type=n.Syntax.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=r};t.ConditionalExpression=A;var S=function(e){this.type=n.Syntax.ContinueStatement,this.label=e};t.ContinueStatement=S;var E=function(){this.type=n.Syntax.DebuggerStatement};t.DebuggerStatement=E;var w=function(e,t){this.type=n.Syntax.ExpressionStatement,this.expression=e,this.directive=t};t.Directive=w;var C=function(e,t){this.type=n.Syntax.DoWhileStatement,this.body=e,this.test=t};t.DoWhileStatement=C;var T=function(){this.type=n.Syntax.EmptyStatement};t.EmptyStatement=T;var D=function(e){this.type=n.Syntax.ExportAllDeclaration,this.source=e};t.ExportAllDeclaration=D;var M=function(e){this.type=n.Syntax.ExportDefaultDeclaration,this.declaration=e};t.ExportDefaultDeclaration=M;var P=function(e,t,r){this.type=n.Syntax.ExportNamedDeclaration,this.declaration=e,this.specifiers=t,this.source=r};t.ExportNamedDeclaration=P;var F=function(e,t){this.type=n.Syntax.ExportSpecifier,this.exported=t,this.local=e};t.ExportSpecifier=F;var R=function(e){this.type=n.Syntax.ExpressionStatement,this.expression=e};t.ExpressionStatement=R;var N=function(e,t,r){this.type=n.Syntax.ForInStatement,this.left=e,this.right=t,this.body=r,this.each=!1};t.ForInStatement=N;var B=function(e,t,r){this.type=n.Syntax.ForOfStatement,this.left=e,this.right=t,this.body=r};t.ForOfStatement=B;var I=function(e,t,r,i){this.type=n.Syntax.ForStatement,this.init=e,this.test=t,this.update=r,this.body=i};t.ForStatement=I;var O=function(e,t,r,i){this.type=n.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=r,this.generator=i,this.expression=!1,this.async=!1};t.FunctionDeclaration=O;var k=function(e,t,r,i){this.type=n.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=r,this.generator=i,this.expression=!1,this.async=!1};t.FunctionExpression=k;var L=function(e){this.type=n.Syntax.Identifier,this.name=e};t.Identifier=L;var U=function(e,t,r){this.type=n.Syntax.IfStatement,this.test=e,this.consequent=t,this.alternate=r};t.IfStatement=U;var z=function(e,t){this.type=n.Syntax.ImportDeclaration,this.specifiers=e,this.source=t};t.ImportDeclaration=z;var j=function(e){this.type=n.Syntax.ImportDefaultSpecifier,this.local=e};t.ImportDefaultSpecifier=j;var V=function(e){this.type=n.Syntax.ImportNamespaceSpecifier,this.local=e};t.ImportNamespaceSpecifier=V;var G=function(e,t){this.type=n.Syntax.ImportSpecifier,this.local=e,this.imported=t};t.ImportSpecifier=G;var W=function(e,t){this.type=n.Syntax.LabeledStatement,this.label=e,this.body=t};t.LabeledStatement=W;var H=function(e,t){this.type=n.Syntax.Literal,this.value=e,this.raw=t};t.Literal=H;var q=function(e,t){this.type=n.Syntax.MetaProperty,this.meta=e,this.property=t};t.MetaProperty=q;var X=function(e,t,r,i,a){this.type=n.Syntax.MethodDefinition,this.key=e,this.computed=t,this.value=r,this.kind=i,this.static=a};t.MethodDefinition=X;var Q=function(e){this.type=n.Syntax.Program,this.body=e,this.sourceType="module"};t.Module=Q;var K=function(e,t){this.type=n.Syntax.NewExpression,this.callee=e,this.arguments=t};t.NewExpression=K;var Y=function(e){this.type=n.Syntax.ObjectExpression,this.properties=e};t.ObjectExpression=Y;var Z=function(e){this.type=n.Syntax.ObjectPattern,this.properties=e};t.ObjectPattern=Z;var J=function(e,t,r,i,a,s){this.type=n.Syntax.Property,this.key=t,this.computed=r,this.value=i,this.kind=e,this.method=a,this.shorthand=s};t.Property=J;var $=function(e,t,r,i){this.type=n.Syntax.Literal,this.value=e,this.raw=t,this.regex={pattern:r,flags:i}};t.RegexLiteral=$;var ee=function(e){this.type=n.Syntax.RestElement,this.argument=e};t.RestElement=ee;var te=function(e){this.type=n.Syntax.ReturnStatement,this.argument=e};t.ReturnStatement=te;var re=function(e){this.type=n.Syntax.Program,this.body=e,this.sourceType="script"};t.Script=re;var ne=function(e){this.type=n.Syntax.SequenceExpression,this.expressions=e};t.SequenceExpression=ne;var ie=function(e){this.type=n.Syntax.SpreadElement,this.argument=e};t.SpreadElement=ie;var ae=function(e,t){this.type=n.Syntax.MemberExpression,this.computed=!1,this.object=e,this.property=t};t.StaticMemberExpression=ae;var se=function(){this.type=n.Syntax.Super};t.Super=se;var oe=function(e,t){this.type=n.Syntax.SwitchCase,this.test=e,this.consequent=t};t.SwitchCase=oe;var le=function(e,t){this.type=n.Syntax.SwitchStatement,this.discriminant=e,this.cases=t};t.SwitchStatement=le;var ue=function(e,t){this.type=n.Syntax.TaggedTemplateExpression,this.tag=e,this.quasi=t};t.TaggedTemplateExpression=ue;var ce=function(e,t){this.type=n.Syntax.TemplateElement,this.value=e,this.tail=t};t.TemplateElement=ce;var he=function(e,t){this.type=n.Syntax.TemplateLiteral,this.quasis=e,this.expressions=t};t.TemplateLiteral=he;var de=function(){this.type=n.Syntax.ThisExpression};t.ThisExpression=de;var pe=function(e){this.type=n.Syntax.ThrowStatement,this.argument=e};t.ThrowStatement=pe;var fe=function(e,t,r){this.type=n.Syntax.TryStatement,this.block=e,this.handler=t,this.finalizer=r};t.TryStatement=fe;var me=function(e,t){this.type=n.Syntax.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0};t.UnaryExpression=me;var ge=function(e,t,r){this.type=n.Syntax.UpdateExpression,this.operator=e,this.argument=t,this.prefix=r};t.UpdateExpression=ge;var _e=function(e,t){this.type=n.Syntax.VariableDeclaration,this.declarations=e,this.kind=t};t.VariableDeclaration=_e;var ve=function(e,t){this.type=n.Syntax.VariableDeclarator,this.id=e,this.init=t};t.VariableDeclarator=ve;var ye=function(e,t){this.type=n.Syntax.WhileStatement,this.test=e,this.body=t};t.WhileStatement=ye;var xe=function(e,t){this.type=n.Syntax.WithStatement,this.object=e,this.body=t};t.WithStatement=xe;var be=function(e,t){this.type=n.Syntax.YieldExpression,this.argument=e,this.delegate=t};t.YieldExpression=be},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(9),i=r(10),a=r(11),s=r(7),o=r(12),l=r(2),u=r(13),c="ArrowParameterPlaceHolder",h=function(){function e(e,t,r){void 0===t&&(t={}),this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant},this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=r,this.errorHandler=new i.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new o.Scanner(e,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return e.prototype.throwError=function(e){var t=Array.prototype.slice.call(arguments,1),r=e.replace(/%(\d)/g,(function(e,r){return n.assert(r<t.length,"Message reference must be in range"),t[r]})),i=this.lastMarker.index,a=this.lastMarker.line,s=this.lastMarker.column+1;throw this.errorHandler.createError(i,a,s,r)},e.prototype.tolerateError=function(e){var t=Array.prototype.slice.call(arguments,1),r=e.replace(/%(\d)/g,(function(e,r){return n.assert(r<t.length,"Message reference must be in range"),t[r]})),i=this.lastMarker.index,a=this.scanner.lineNumber,s=this.lastMarker.column+1;this.errorHandler.tolerateError(i,a,s,r)},e.prototype.unexpectedTokenError=function(e,t){var r,n=t||a.Messages.UnexpectedToken;if(e?(t||(n=2===e.type?a.Messages.UnexpectedEOS:3===e.type?a.Messages.UnexpectedIdentifier:6===e.type?a.Messages.UnexpectedNumber:8===e.type?a.Messages.UnexpectedString:10===e.type?a.Messages.UnexpectedTemplate:a.Messages.UnexpectedToken,4===e.type&&(this.scanner.isFutureReservedWord(e.value)?n=a.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(e.value)&&(n=a.Messages.StrictReservedWord))),r=e.value):r="ILLEGAL",n=n.replace("%0",r),e&&"number"==typeof e.lineNumber){var i=e.start,s=e.lineNumber,o=this.lastMarker.index-this.lastMarker.column,l=e.start-o+1;return this.errorHandler.createError(i,s,l,n)}i=this.lastMarker.index,s=this.lastMarker.line,l=this.lastMarker.column+1;return this.errorHandler.createError(i,s,l,n)},e.prototype.throwUnexpectedToken=function(e,t){throw this.unexpectedTokenError(e,t)},e.prototype.tolerateUnexpectedToken=function(e,t){this.errorHandler.tolerate(this.unexpectedTokenError(e,t))},e.prototype.collectComments=function(){if(this.config.comment){var e=this.scanner.scanComments();if(e.length>0&&this.delegate)for(var t=0;t<e.length;++t){var r=e[t],n=void 0;n={type:r.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(r.slice[0],r.slice[1])},this.config.range&&(n.range=r.range),this.config.loc&&(n.loc=r.loc);var i={start:{line:r.loc.start.line,column:r.loc.start.column,offset:r.range[0]},end:{line:r.loc.end.line,column:r.loc.end.column,offset:r.range[1]}};this.delegate(n,i)}}else this.scanner.scanComments()},e.prototype.getTokenRaw=function(e){return this.scanner.source.slice(e.start,e.end)},e.prototype.convertToken=function(e){var t={type:u.TokenName[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),9===e.type){var r=e.pattern,n=e.flags;t.regex={pattern:r,flags:n}}return t},e.prototype.nextToken=function(){var e=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,t&&this.context.strict&&3===t.type&&this.scanner.isStrictModeReservedWord(t.value)&&(t.type=4),this.lookahead=t,this.config.tokens&&2!==t.type&&this.tokens.push(this.convertToken(t)),e},e.prototype.nextRegexToken=function(){this.collectComments();var e=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(e))),this.lookahead=e,this.nextToken(),e},e.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},e.prototype.startNode=function(e,t){void 0===t&&(t=0);var r=e.start-e.lineStart,n=e.lineNumber;return r<0&&(r+=t,n--),{index:e.start,line:n,column:r}},e.prototype.finalize=function(e,t){if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),this.delegate){var r={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,r)}return t},e.prototype.expect=function(e){var t=this.nextToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var e=this.lookahead;7===e.type&&","===e.value?this.nextToken():7===e.type&&";"===e.value?(this.nextToken(),this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,a.Messages.UnexpectedToken)}else this.expect(",")},e.prototype.expectKeyword=function(e){var t=this.nextToken();4===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.match=function(e){return 7===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchKeyword=function(e){return 4===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchContextualKeyword=function(e){return 3===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchAssign=function(){if(7!==this.lookahead.type)return!1;var e=this.lookahead.value;return"="===e||"*="===e||"**="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e},e.prototype.isolateCoverGrammar=function(e){var t=this.context.isBindingElement,r=this.context.isAssignmentTarget,n=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var i=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=r,this.context.firstCoverInitializedNameError=n,i},e.prototype.inheritCoverGrammar=function(e){var t=this.context.isBindingElement,r=this.context.isAssignmentTarget,n=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var i=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&r,this.context.firstCoverInitializedNameError=n||this.context.firstCoverInitializedNameError,i},e.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},e.prototype.parsePrimaryExpression=function(){var e,t,r,n=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&"await"===this.lookahead.value&&this.tolerateUnexpectedToken(this.lookahead),e=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(n,new s.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,a.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),r=this.getTokenRaw(t),e=this.finalize(n,new s.Literal(t.value,r));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),r=this.getTokenRaw(t),e=this.finalize(n,new s.Literal("true"===t.value,r));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),r=this.getTokenRaw(t),e=this.finalize(n,new s.Literal(null,r));break;case 10:e=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,e=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":e=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":e=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,t=this.nextRegexToken(),r=this.getTokenRaw(t),e=this.finalize(n,new s.RegexLiteral(t.regex,r,t.pattern,t.flags));break;default:e=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?e=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?e=this.finalize(n,new s.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?e=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),e=this.finalize(n,new s.ThisExpression)):e=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:e=this.throwUnexpectedToken(this.nextToken())}return e},e.prototype.parseSpreadElement=function(){var e=this.createNode();this.expect("...");var t=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(e,new s.SpreadElement(t))},e.prototype.parseArrayInitializer=function(){var e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),t.push(null);else if(this.match("...")){var r=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),t.push(r)}else t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(e,new s.ArrayExpression(t))},e.prototype.parsePropertyMethod=function(e){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var t=this.context.strict,r=this.context.allowStrictDirective;this.context.allowStrictDirective=e.simple;var n=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&e.firstRestricted&&this.tolerateUnexpectedToken(e.firstRestricted,e.message),this.context.strict&&e.stricted&&this.tolerateUnexpectedToken(e.stricted,e.message),this.context.strict=t,this.context.allowStrictDirective=r,n},e.prototype.parsePropertyMethodFunction=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var r=this.parseFormalParameters(),n=this.parsePropertyMethod(r);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,r.params,n,!1))},e.prototype.parsePropertyMethodAsyncFunction=function(){var e=this.createNode(),t=this.context.allowYield,r=this.context.await;this.context.allowYield=!1,this.context.await=!0;var n=this.parseFormalParameters(),i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.context.await=r,this.finalize(e,new s.AsyncFunctionExpression(null,n.params,i))},e.prototype.parseObjectPropertyKey=function(){var e,t=this.createNode(),r=this.nextToken();switch(r.type){case 8:case 6:this.context.strict&&r.octal&&this.tolerateUnexpectedToken(r,a.Messages.StrictOctalLiteral);var n=this.getTokenRaw(r);e=this.finalize(t,new s.Literal(r.value,n));break;case 3:case 1:case 5:case 4:e=this.finalize(t,new s.Identifier(r.value));break;case 7:"["===r.value?(e=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):e=this.throwUnexpectedToken(r);break;default:e=this.throwUnexpectedToken(r)}return e},e.prototype.isPropertyKey=function(e,t){return e.type===l.Syntax.Identifier&&e.name===t||e.type===l.Syntax.Literal&&e.value===t},e.prototype.parseObjectProperty=function(e){var t,r=this.createNode(),n=this.lookahead,i=null,o=null,l=!1,u=!1,c=!1,h=!1;if(3===n.type){var d=n.value;this.nextToken(),l=this.match("["),i=(h=!(this.hasLineTerminator||"async"!==d||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(r,new s.Identifier(d))}else this.match("*")?this.nextToken():(l=this.match("["),i=this.parseObjectPropertyKey());var p=this.qualifiedPropertyName(this.lookahead);if(3===n.type&&!h&&"get"===n.value&&p)t="get",l=this.match("["),i=this.parseObjectPropertyKey(),this.context.allowYield=!1,o=this.parseGetterMethod();else if(3===n.type&&!h&&"set"===n.value&&p)t="set",l=this.match("["),i=this.parseObjectPropertyKey(),o=this.parseSetterMethod();else if(7===n.type&&"*"===n.value&&p)t="init",l=this.match("["),i=this.parseObjectPropertyKey(),o=this.parseGeneratorMethod(),u=!0;else if(i||this.throwUnexpectedToken(this.lookahead),t="init",this.match(":")&&!h)!l&&this.isPropertyKey(i,"__proto__")&&(e.value&&this.tolerateError(a.Messages.DuplicateProtoProperty),e.value=!0),this.nextToken(),o=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))o=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),u=!0;else if(3===n.type){d=this.finalize(r,new s.Identifier(n.value));if(this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),c=!0;var f=this.isolateCoverGrammar(this.parseAssignmentExpression);o=this.finalize(r,new s.AssignmentPattern(d,f))}else c=!0,o=d}else this.throwUnexpectedToken(this.nextToken());return this.finalize(r,new s.Property(t,i,l,o,u,c))},e.prototype.parseObjectInitializer=function(){var e=this.createNode();this.expect("{");for(var t=[],r={value:!1};!this.match("}");)t.push(this.parseObjectProperty(r)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new s.ObjectExpression(t))},e.prototype.parseTemplateHead=function(){n.assert(this.lookahead.head,"Template literal must start with a template head");var e=this.createNode(),t=this.nextToken(),r=t.value,i=t.cooked;return this.finalize(e,new s.TemplateElement({raw:r,cooked:i},t.tail))},e.prototype.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();var e=this.createNode(),t=this.nextToken(),r=t.value,n=t.cooked;return this.finalize(e,new s.TemplateElement({raw:r,cooked:n},t.tail))},e.prototype.parseTemplateLiteral=function(){var e=this.createNode(),t=[],r=[],n=this.parseTemplateHead();for(r.push(n);!n.tail;)t.push(this.parseExpression()),n=this.parseTemplateElement(),r.push(n);return this.finalize(e,new s.TemplateLiteral(r,t))},e.prototype.reinterpretExpressionAsPattern=function(e){switch(e.type){case l.Syntax.Identifier:case l.Syntax.MemberExpression:case l.Syntax.RestElement:case l.Syntax.AssignmentPattern:break;case l.Syntax.SpreadElement:e.type=l.Syntax.RestElement,this.reinterpretExpressionAsPattern(e.argument);break;case l.Syntax.ArrayExpression:e.type=l.Syntax.ArrayPattern;for(var t=0;t<e.elements.length;t++)null!==e.elements[t]&&this.reinterpretExpressionAsPattern(e.elements[t]);break;case l.Syntax.ObjectExpression:e.type=l.Syntax.ObjectPattern;for(t=0;t<e.properties.length;t++)this.reinterpretExpressionAsPattern(e.properties[t].value);break;case l.Syntax.AssignmentExpression:e.type=l.Syntax.AssignmentPattern,delete e.operator,this.reinterpretExpressionAsPattern(e.left)}},e.prototype.parseGroupExpression=function(){var e;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),e={type:c,params:[],async:!1};else{var t=this.lookahead,r=[];if(this.match("..."))e=this.parseRestElement(r),this.expect(")"),this.match("=>")||this.expect("=>"),e={type:c,params:[e],async:!1};else{var n=!1;if(this.context.isBindingElement=!0,e=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var i=[];for(this.context.isAssignmentTarget=!1,i.push(e);2!==this.lookahead.type&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var a=0;a<i.length;a++)this.reinterpretExpressionAsPattern(i[a]);n=!0,e={type:c,params:i,async:!1}}else if(this.match("...")){this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),i.push(this.parseRestElement(r)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1;for(a=0;a<i.length;a++)this.reinterpretExpressionAsPattern(i[a]);n=!0,e={type:c,params:i,async:!1}}else i.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(n)break}n||(e=this.finalize(this.startNode(t),new s.SequenceExpression(i)))}if(!n){if(this.expect(")"),this.match("=>")&&(e.type===l.Syntax.Identifier&&"yield"===e.name&&(n=!0,e={type:c,params:[e],async:!1}),!n)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),e.type===l.Syntax.SequenceExpression)for(a=0;a<e.expressions.length;a++)this.reinterpretExpressionAsPattern(e.expressions[a]);else this.reinterpretExpressionAsPattern(e);var o=e.type===l.Syntax.SequenceExpression?e.expressions:[e];e={type:c,params:o,async:!1}}this.context.isBindingElement=!1}}}return e},e.prototype.parseArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.isIdentifierName=function(e){return 3===e.type||4===e.type||1===e.type||5===e.type},e.prototype.parseIdentifierName=function(){var e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),this.finalize(e,new s.Identifier(t.value))},e.prototype.parseNewExpression=function(){var e,t=this.createNode(),r=this.parseIdentifierName();if(n.assert("new"===r.name,"New expression must start with `new`"),this.match("."))if(this.nextToken(),3===this.lookahead.type&&this.context.inFunctionBody&&"target"===this.lookahead.value){var i=this.parseIdentifierName();e=new s.MetaProperty(r,i)}else this.throwUnexpectedToken(this.lookahead);else{var a=this.isolateCoverGrammar(this.parseLeftHandSideExpression),o=this.match("(")?this.parseArguments():[];e=new s.NewExpression(a,o),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(t,e)},e.prototype.parseAsyncArgument=function(){var e=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,e},e.prototype.parseAsyncArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.parseLeftHandSideExpressionAllowCall=function(){var e,t=this.lookahead,r=this.matchContextualKeyword("async"),n=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(e=this.createNode(),this.nextToken(),e=this.finalize(e,new s.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):e=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var i=this.parseIdentifierName();e=this.finalize(this.startNode(t),new s.StaticMemberExpression(e,i))}else if(this.match("(")){var a=r&&t.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var o=a?this.parseAsyncArguments():this.parseArguments();if(e=this.finalize(this.startNode(t),new s.CallExpression(e,o)),a&&this.match("=>")){for(var l=0;l<o.length;++l)this.reinterpretExpressionAsPattern(o[l]);e={type:c,params:o,async:!0}}}else if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");i=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),e=this.finalize(this.startNode(t),new s.ComputedMemberExpression(e,i))}else{if(10!==this.lookahead.type||!this.lookahead.head)break;var u=this.parseTemplateLiteral();e=this.finalize(this.startNode(t),new s.TaggedTemplateExpression(e,u))}return this.context.allowIn=n,e},e.prototype.parseSuper=function(){var e=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(e,new s.Super)},e.prototype.parseLeftHandSideExpression=function(){n.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var e=this.startNode(this.lookahead),t=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var r=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),t=this.finalize(e,new s.ComputedMemberExpression(t,r))}else if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");r=this.parseIdentifierName();t=this.finalize(e,new s.StaticMemberExpression(t,r))}else{if(10!==this.lookahead.type||!this.lookahead.head)break;var i=this.parseTemplateLiteral();t=this.finalize(e,new s.TaggedTemplateExpression(t,i))}return t},e.prototype.parseUpdateExpression=function(){var e,t=this.lookahead;if(this.match("++")||this.match("--")){var r=this.startNode(t),n=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(a.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(a.Messages.InvalidLHSInAssignment);var i=!0;e=this.finalize(r,new s.UpdateExpression(n.value,e,i)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(a.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(a.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var o=this.nextToken().value;i=!1;e=this.finalize(this.startNode(t),new s.UpdateExpression(o,e,i))}return e},e.prototype.parseAwaitExpression=function(){var e=this.createNode();this.nextToken();var t=this.parseUnaryExpression();return this.finalize(e,new s.AwaitExpression(t))},e.prototype.parseUnaryExpression=function(){var e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var t=this.startNode(this.lookahead),r=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new s.UnaryExpression(r.value,e)),this.context.strict&&"delete"===e.operator&&e.argument.type===l.Syntax.Identifier&&this.tolerateError(a.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else e=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return e},e.prototype.parseExponentiationExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseUnaryExpression);if(t.type!==l.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var r=t,n=this.isolateCoverGrammar(this.parseExponentiationExpression);t=this.finalize(this.startNode(e),new s.BinaryExpression("**",r,n))}return t},e.prototype.binaryPrecedence=function(e){var t=e.value;return 7===e.type?this.operatorPrecedence[t]||0:4===e.type&&("instanceof"===t||this.context.allowIn&&"in"===t)?7:0},e.prototype.parseBinaryExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseExponentiationExpression),r=this.lookahead,n=this.binaryPrecedence(r);if(n>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var i=[e,this.lookahead],a=t,o=this.isolateCoverGrammar(this.parseExponentiationExpression),l=[a,r.value,o],u=[n];!((n=this.binaryPrecedence(this.lookahead))<=0);){for(;l.length>2&&n<=u[u.length-1];){o=l.pop();var c=l.pop();u.pop(),a=l.pop(),i.pop();var h=this.startNode(i[i.length-1]);l.push(this.finalize(h,new s.BinaryExpression(c,a,o)))}l.push(this.nextToken().value),u.push(n),i.push(this.lookahead),l.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var d=l.length-1;t=l[d];for(var p=i.pop();d>1;){var f=i.pop(),m=p&&p.lineStart;h=this.startNode(f,m),c=l[d-1];t=this.finalize(h,new s.BinaryExpression(c,l[d-2],t)),d-=2,p=f}}return t},e.prototype.parseConditionalExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var r=this.context.allowIn;this.context.allowIn=!0;var n=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=r,this.expect(":");var i=this.isolateCoverGrammar(this.parseAssignmentExpression);t=this.finalize(this.startNode(e),new s.ConditionalExpression(t,n,i)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return t},e.prototype.checkPatternParam=function(e,t){switch(t.type){case l.Syntax.Identifier:this.validateParam(e,t,t.name);break;case l.Syntax.RestElement:this.checkPatternParam(e,t.argument);break;case l.Syntax.AssignmentPattern:this.checkPatternParam(e,t.left);break;case l.Syntax.ArrayPattern:for(var r=0;r<t.elements.length;r++)null!==t.elements[r]&&this.checkPatternParam(e,t.elements[r]);break;case l.Syntax.ObjectPattern:for(r=0;r<t.properties.length;r++)this.checkPatternParam(e,t.properties[r].value)}e.simple=e.simple&&t instanceof s.Identifier},e.prototype.reinterpretAsCoverFormalsList=function(e){var t,r=[e],n=!1;switch(e.type){case l.Syntax.Identifier:break;case c:r=e.params,n=e.async;break;default:return null}t={simple:!0,paramSet:{}};for(var i=0;i<r.length;++i){(s=r[i]).type===l.Syntax.AssignmentPattern?s.right.type===l.Syntax.YieldExpression&&(s.right.argument&&this.throwUnexpectedToken(this.lookahead),s.right.type=l.Syntax.Identifier,s.right.name="yield",delete s.right.argument,delete s.right.delegate):n&&s.type===l.Syntax.Identifier&&"await"===s.name&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(t,s),r[i]=s}if(this.context.strict||!this.context.allowYield)for(i=0;i<r.length;++i){var s;(s=r[i]).type===l.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(t.message===a.Messages.StrictParamDupe){var o=this.context.strict?t.stricted:t.firstRestricted;this.throwUnexpectedToken(o,t.message)}return{simple:t.simple,params:r,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.parseAssignmentExpression=function(){var e;if(!this.context.allowYield&&this.matchKeyword("yield"))e=this.parseYieldExpression();else{var t=this.lookahead,r=t;if(e=this.parseConditionalExpression(),3===r.type&&r.lineNumber===this.lookahead.lineNumber&&"async"===r.value&&(3===this.lookahead.type||this.matchKeyword("yield"))){var n=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(n),e={type:c,params:[n],async:!0}}if(e.type===c||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var i=e.async,o=this.reinterpretAsCoverFormalsList(e);if(o){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var u=this.context.strict,h=this.context.allowStrictDirective;this.context.allowStrictDirective=o.simple;var d=this.context.allowYield,p=this.context.await;this.context.allowYield=!0,this.context.await=i;var f=this.startNode(t);this.expect("=>");var m=void 0;if(this.match("{")){var g=this.context.allowIn;this.context.allowIn=!0,m=this.parseFunctionSourceElements(),this.context.allowIn=g}else m=this.isolateCoverGrammar(this.parseAssignmentExpression);var _=m.type!==l.Syntax.BlockStatement;this.context.strict&&o.firstRestricted&&this.throwUnexpectedToken(o.firstRestricted,o.message),this.context.strict&&o.stricted&&this.tolerateUnexpectedToken(o.stricted,o.message),e=i?this.finalize(f,new s.AsyncArrowFunctionExpression(o.params,m,_)):this.finalize(f,new s.ArrowFunctionExpression(o.params,m,_)),this.context.strict=u,this.context.allowStrictDirective=h,this.context.allowYield=d,this.context.await=p}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(a.Messages.InvalidLHSInAssignment),this.context.strict&&e.type===l.Syntax.Identifier){var v=e;this.scanner.isRestrictedWord(v.name)&&this.tolerateUnexpectedToken(r,a.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(v.name)&&this.tolerateUnexpectedToken(r,a.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(e):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var y=(r=this.nextToken()).value,x=this.isolateCoverGrammar(this.parseAssignmentExpression);e=this.finalize(this.startNode(t),new s.AssignmentExpression(y,e,x)),this.context.firstCoverInitializedNameError=null}}return e},e.prototype.parseExpression=function(){var e=this.lookahead,t=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var r=[];for(r.push(t);2!==this.lookahead.type&&this.match(",");)this.nextToken(),r.push(this.isolateCoverGrammar(this.parseAssignmentExpression));t=this.finalize(this.startNode(e),new s.SequenceExpression(r))}return t},e.prototype.parseStatementListItem=function(){var e;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,a.Messages.IllegalExportDeclaration),e=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,a.Messages.IllegalImportDeclaration),e=this.parseImportDeclaration();break;case"const":e=this.parseLexicalDeclaration({inFor:!1});break;case"function":e=this.parseFunctionDeclaration();break;case"class":e=this.parseClassDeclaration();break;case"let":e=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:e=this.parseStatement()}else e=this.parseStatement();return e},e.prototype.parseBlock=function(){var e=this.createNode();this.expect("{");for(var t=[];!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new s.BlockStatement(t))},e.prototype.parseLexicalBinding=function(e,t){var r=this.createNode(),n=this.parsePattern([],e);this.context.strict&&n.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(n.name)&&this.tolerateError(a.Messages.StrictVarName);var i=null;return"const"===e?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),i=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(a.Messages.DeclarationMissingInitializer,"const")):(!t.inFor&&n.type!==l.Syntax.Identifier||this.match("="))&&(this.expect("="),i=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(r,new s.VariableDeclarator(n,i))},e.prototype.parseBindingList=function(e,t){for(var r=[this.parseLexicalBinding(e,t)];this.match(",");)this.nextToken(),r.push(this.parseLexicalBinding(e,t));return r},e.prototype.isLexicalDeclaration=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.scanner.lex();return this.scanner.restoreState(e),3===t.type||7===t.type&&"["===t.value||7===t.type&&"{"===t.value||4===t.type&&"let"===t.value||4===t.type&&"yield"===t.value},e.prototype.parseLexicalDeclaration=function(e){var t=this.createNode(),r=this.nextToken().value;n.assert("let"===r||"const"===r,"Lexical declaration must be either let or const");var i=this.parseBindingList(r,e);return this.consumeSemicolon(),this.finalize(t,new s.VariableDeclaration(i,r))},e.prototype.parseBindingRestElement=function(e,t){var r=this.createNode();this.expect("...");var n=this.parsePattern(e,t);return this.finalize(r,new s.RestElement(n))},e.prototype.parseArrayPattern=function(e,t){var r=this.createNode();this.expect("[");for(var n=[];!this.match("]");)if(this.match(","))this.nextToken(),n.push(null);else{if(this.match("...")){n.push(this.parseBindingRestElement(e,t));break}n.push(this.parsePatternWithDefault(e,t)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(r,new s.ArrayPattern(n))},e.prototype.parsePropertyPattern=function(e,t){var r,n,i=this.createNode(),a=!1,o=!1;if(3===this.lookahead.type){var l=this.lookahead;r=this.parseVariableIdentifier();var u=this.finalize(i,new s.Identifier(l.value));if(this.match("=")){e.push(l),o=!0,this.nextToken();var c=this.parseAssignmentExpression();n=this.finalize(this.startNode(l),new s.AssignmentPattern(u,c))}else this.match(":")?(this.expect(":"),n=this.parsePatternWithDefault(e,t)):(e.push(l),o=!0,n=u)}else a=this.match("["),r=this.parseObjectPropertyKey(),this.expect(":"),n=this.parsePatternWithDefault(e,t);return this.finalize(i,new s.Property("init",r,a,n,!1,o))},e.prototype.parseObjectPattern=function(e,t){var r=this.createNode(),n=[];for(this.expect("{");!this.match("}");)n.push(this.parsePropertyPattern(e,t)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(r,new s.ObjectPattern(n))},e.prototype.parsePattern=function(e,t){var r;return this.match("[")?r=this.parseArrayPattern(e,t):this.match("{")?r=this.parseObjectPattern(e,t):(!this.matchKeyword("let")||"const"!==t&&"let"!==t||this.tolerateUnexpectedToken(this.lookahead,a.Messages.LetInLexicalBinding),e.push(this.lookahead),r=this.parseVariableIdentifier(t)),r},e.prototype.parsePatternWithDefault=function(e,t){var r=this.lookahead,n=this.parsePattern(e,t);if(this.match("=")){this.nextToken();var i=this.context.allowYield;this.context.allowYield=!0;var a=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=i,n=this.finalize(this.startNode(r),new s.AssignmentPattern(n,a))}return n},e.prototype.parseVariableIdentifier=function(e){var t=this.createNode(),r=this.nextToken();return 4===r.type&&"yield"===r.value?this.context.strict?this.tolerateUnexpectedToken(r,a.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(r):3!==r.type?this.context.strict&&4===r.type&&this.scanner.isStrictModeReservedWord(r.value)?this.tolerateUnexpectedToken(r,a.Messages.StrictReservedWord):(this.context.strict||"let"!==r.value||"var"!==e)&&this.throwUnexpectedToken(r):(this.context.isModule||this.context.await)&&3===r.type&&"await"===r.value&&this.tolerateUnexpectedToken(r),this.finalize(t,new s.Identifier(r.value))},e.prototype.parseVariableDeclaration=function(e){var t=this.createNode(),r=this.parsePattern([],"var");this.context.strict&&r.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(r.name)&&this.tolerateError(a.Messages.StrictVarName);var n=null;return this.match("=")?(this.nextToken(),n=this.isolateCoverGrammar(this.parseAssignmentExpression)):r.type===l.Syntax.Identifier||e.inFor||this.expect("="),this.finalize(t,new s.VariableDeclarator(r,n))},e.prototype.parseVariableDeclarationList=function(e){var t={inFor:e.inFor},r=[];for(r.push(this.parseVariableDeclaration(t));this.match(",");)this.nextToken(),r.push(this.parseVariableDeclaration(t));return r},e.prototype.parseVariableStatement=function(){var e=this.createNode();this.expectKeyword("var");var t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new s.VariableDeclaration(t,"var"))},e.prototype.parseEmptyStatement=function(){var e=this.createNode();return this.expect(";"),this.finalize(e,new s.EmptyStatement)},e.prototype.parseExpressionStatement=function(){var e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ExpressionStatement(t))},e.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(a.Messages.StrictFunction),this.parseStatement()},e.prototype.parseIfStatement=function(){var e,t=this.createNode(),r=null;this.expectKeyword("if"),this.expect("(");var n=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement)):(this.expect(")"),e=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),r=this.parseIfClause())),this.finalize(t,new s.IfStatement(n,e,r))},e.prototype.parseDoWhileStatement=function(){var e=this.createNode();this.expectKeyword("do");var t=this.context.inIteration;this.context.inIteration=!0;var r=this.parseStatement();this.context.inIteration=t,this.expectKeyword("while"),this.expect("(");var n=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(e,new s.DoWhileStatement(r,n))},e.prototype.parseWhileStatement=function(){var e,t=this.createNode();this.expectKeyword("while"),this.expect("(");var r=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement);else{this.expect(")");var n=this.context.inIteration;this.context.inIteration=!0,e=this.parseStatement(),this.context.inIteration=n}return this.finalize(t,new s.WhileStatement(r,e))},e.prototype.parseForStatement=function(){var e,t,r,n=null,i=null,o=null,u=!0,c=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){n=this.createNode(),this.nextToken();var h=this.context.allowIn;this.context.allowIn=!1;var d=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=h,1===d.length&&this.matchKeyword("in")){var p=d[0];p.init&&(p.id.type===l.Syntax.ArrayPattern||p.id.type===l.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(a.Messages.ForInOfLoopInitializer,"for-in"),n=this.finalize(n,new s.VariableDeclaration(d,"var")),this.nextToken(),e=n,t=this.parseExpression(),n=null}else 1===d.length&&null===d[0].init&&this.matchContextualKeyword("of")?(n=this.finalize(n,new s.VariableDeclaration(d,"var")),this.nextToken(),e=n,t=this.parseAssignmentExpression(),n=null,u=!1):(n=this.finalize(n,new s.VariableDeclaration(d,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){n=this.createNode();var f=this.nextToken().value;if(this.context.strict||"in"!==this.lookahead.value){h=this.context.allowIn;this.context.allowIn=!1;d=this.parseBindingList(f,{inFor:!0});this.context.allowIn=h,1===d.length&&null===d[0].init&&this.matchKeyword("in")?(n=this.finalize(n,new s.VariableDeclaration(d,f)),this.nextToken(),e=n,t=this.parseExpression(),n=null):1===d.length&&null===d[0].init&&this.matchContextualKeyword("of")?(n=this.finalize(n,new s.VariableDeclaration(d,f)),this.nextToken(),e=n,t=this.parseAssignmentExpression(),n=null,u=!1):(this.consumeSemicolon(),n=this.finalize(n,new s.VariableDeclaration(d,f)))}else n=this.finalize(n,new s.Identifier(f)),this.nextToken(),e=n,t=this.parseExpression(),n=null}else{var m=this.lookahead;h=this.context.allowIn;if(this.context.allowIn=!1,n=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=h,this.matchKeyword("in"))this.context.isAssignmentTarget&&n.type!==l.Syntax.AssignmentExpression||this.tolerateError(a.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(n),e=n,t=this.parseExpression(),n=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&n.type!==l.Syntax.AssignmentExpression||this.tolerateError(a.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(n),e=n,t=this.parseAssignmentExpression(),n=null,u=!1;else{if(this.match(",")){for(var g=[n];this.match(",");)this.nextToken(),g.push(this.isolateCoverGrammar(this.parseAssignmentExpression));n=this.finalize(this.startNode(m),new s.SequenceExpression(g))}this.expect(";")}}if(void 0===e&&(this.match(";")||(i=this.parseExpression()),this.expect(";"),this.match(")")||(o=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),r=this.finalize(this.createNode(),new s.EmptyStatement);else{this.expect(")");var _=this.context.inIteration;this.context.inIteration=!0,r=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=_}return void 0===e?this.finalize(c,new s.ForStatement(n,i,o,r)):u?this.finalize(c,new s.ForInStatement(e,t,r)):this.finalize(c,new s.ForOfStatement(e,t,r))},e.prototype.parseContinueStatement=function(){var e=this.createNode();this.expectKeyword("continue");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var r=this.parseVariableIdentifier();t=r;var n="$"+r.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,n)||this.throwError(a.Messages.UnknownLabel,r.name)}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.throwError(a.Messages.IllegalContinue),this.finalize(e,new s.ContinueStatement(t))},e.prototype.parseBreakStatement=function(){var e=this.createNode();this.expectKeyword("break");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var r=this.parseVariableIdentifier(),n="$"+r.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,n)||this.throwError(a.Messages.UnknownLabel,r.name),t=r}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.context.inSwitch||this.throwError(a.Messages.IllegalBreak),this.finalize(e,new s.BreakStatement(t))},e.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(a.Messages.IllegalReturn);var e=this.createNode();this.expectKeyword("return");var t=!this.match(";")&&!this.match("}")&&!this.hasLineTerminator&&2!==this.lookahead.type||8===this.lookahead.type||10===this.lookahead.type?this.parseExpression():null;return this.consumeSemicolon(),this.finalize(e,new s.ReturnStatement(t))},e.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(a.Messages.StrictModeWith);var e,t=this.createNode();this.expectKeyword("with"),this.expect("(");var r=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement)):(this.expect(")"),e=this.parseStatement()),this.finalize(t,new s.WithStatement(r,e))},e.prototype.parseSwitchCase=function(){var e,t=this.createNode();this.matchKeyword("default")?(this.nextToken(),e=null):(this.expectKeyword("case"),e=this.parseExpression()),this.expect(":");for(var r=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)r.push(this.parseStatementListItem());return this.finalize(t,new s.SwitchCase(e,r))},e.prototype.parseSwitchStatement=function(){var e=this.createNode();this.expectKeyword("switch"),this.expect("(");var t=this.parseExpression();this.expect(")");var r=this.context.inSwitch;this.context.inSwitch=!0;var n=[],i=!1;for(this.expect("{");!this.match("}");){var o=this.parseSwitchCase();null===o.test&&(i&&this.throwError(a.Messages.MultipleDefaultsInSwitch),i=!0),n.push(o)}return this.expect("}"),this.context.inSwitch=r,this.finalize(e,new s.SwitchStatement(t,n))},e.prototype.parseLabelledStatement=function(){var e,t=this.createNode(),r=this.parseExpression();if(r.type===l.Syntax.Identifier&&this.match(":")){this.nextToken();var n=r,i="$"+n.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,i)&&this.throwError(a.Messages.Redeclaration,"Label",n.name),this.context.labelSet[i]=!0;var o=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),o=this.parseClassDeclaration();else if(this.matchKeyword("function")){var u=this.lookahead,c=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(u,a.Messages.StrictFunction):c.generator&&this.tolerateUnexpectedToken(u,a.Messages.GeneratorInLegacyContext),o=c}else o=this.parseStatement();delete this.context.labelSet[i],e=new s.LabeledStatement(n,o)}else this.consumeSemicolon(),e=new s.ExpressionStatement(r);return this.finalize(t,e)},e.prototype.parseThrowStatement=function(){var e=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(a.Messages.NewlineAfterThrow);var t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ThrowStatement(t))},e.prototype.parseCatchClause=function(){var e=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var t=[],r=this.parsePattern(t),n={},i=0;i<t.length;i++){var o="$"+t[i].value;Object.prototype.hasOwnProperty.call(n,o)&&this.tolerateError(a.Messages.DuplicateBinding,t[i].value),n[o]=!0}this.context.strict&&r.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(r.name)&&this.tolerateError(a.Messages.StrictCatchVariable),this.expect(")");var u=this.parseBlock();return this.finalize(e,new s.CatchClause(r,u))},e.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},e.prototype.parseTryStatement=function(){var e=this.createNode();this.expectKeyword("try");var t=this.parseBlock(),r=this.matchKeyword("catch")?this.parseCatchClause():null,n=this.matchKeyword("finally")?this.parseFinallyClause():null;return r||n||this.throwError(a.Messages.NoCatchOrFinally),this.finalize(e,new s.TryStatement(t,r,n))},e.prototype.parseDebuggerStatement=function(){var e=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(e,new s.DebuggerStatement)},e.prototype.parseStatement=function(){var e;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:e=this.parseExpressionStatement();break;case 7:var t=this.lookahead.value;e="{"===t?this.parseBlock():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:e=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"debugger":e=this.parseDebuggerStatement();break;case"do":e=this.parseDoWhileStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"switch":e=this.parseSwitchStatement();break;case"throw":e=this.parseThrowStatement();break;case"try":e=this.parseTryStatement();break;case"var":e=this.parseVariableStatement();break;case"while":e=this.parseWhileStatement();break;case"with":e=this.parseWithStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},e.prototype.parseFunctionSourceElements=function(){var e=this.createNode();this.expect("{");var t=this.parseDirectivePrologues(),r=this.context.labelSet,n=this.context.inIteration,i=this.context.inSwitch,a=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;2!==this.lookahead.type&&!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=r,this.context.inIteration=n,this.context.inSwitch=i,this.context.inFunctionBody=a,this.finalize(e,new s.BlockStatement(t))},e.prototype.validateParam=function(e,t,r){var n="$"+r;this.context.strict?(this.scanner.isRestrictedWord(r)&&(e.stricted=t,e.message=a.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(e.paramSet,n)&&(e.stricted=t,e.message=a.Messages.StrictParamDupe)):e.firstRestricted||(this.scanner.isRestrictedWord(r)?(e.firstRestricted=t,e.message=a.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(r)?(e.firstRestricted=t,e.message=a.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(e.paramSet,n)&&(e.stricted=t,e.message=a.Messages.StrictParamDupe)),"function"==typeof Object.defineProperty?Object.defineProperty(e.paramSet,n,{value:!0,enumerable:!0,writable:!0,configurable:!0}):e.paramSet[n]=!0},e.prototype.parseRestElement=function(e){var t=this.createNode();this.expect("...");var r=this.parsePattern(e);return this.match("=")&&this.throwError(a.Messages.DefaultRestParameter),this.match(")")||this.throwError(a.Messages.ParameterAfterRestParameter),this.finalize(t,new s.RestElement(r))},e.prototype.parseFormalParameter=function(e){for(var t=[],r=this.match("...")?this.parseRestElement(t):this.parsePatternWithDefault(t),n=0;n<t.length;n++)this.validateParam(e,t[n],t[n].value);e.simple=e.simple&&r instanceof s.Identifier,e.params.push(r)},e.prototype.parseFormalParameters=function(e){var t;if(t={simple:!0,params:[],firstRestricted:e},this.expect("("),!this.match(")"))for(t.paramSet={};2!==this.lookahead.type&&(this.parseFormalParameter(t),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:t.simple,params:t.params,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.matchAsyncFunction=function(){var e=this.matchContextualKeyword("async");if(e){var t=this.scanner.saveState();this.scanner.scanComments();var r=this.scanner.lex();this.scanner.restoreState(t),e=t.lineNumber===r.lineNumber&&4===r.type&&"function"===r.value}return e},e.prototype.parseFunctionDeclaration=function(e){var t=this.createNode(),r=this.matchContextualKeyword("async");r&&this.nextToken(),this.expectKeyword("function");var n,i=!r&&this.match("*");i&&this.nextToken();var o=null,l=null;if(!e||!this.match("(")){var u=this.lookahead;o=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(u.value)&&this.tolerateUnexpectedToken(u,a.Messages.StrictFunctionName):this.scanner.isRestrictedWord(u.value)?(l=u,n=a.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(u.value)&&(l=u,n=a.Messages.StrictReservedWord)}var c=this.context.await,h=this.context.allowYield;this.context.await=r,this.context.allowYield=!i;var d=this.parseFormalParameters(l),p=d.params,f=d.stricted;l=d.firstRestricted,d.message&&(n=d.message);var m=this.context.strict,g=this.context.allowStrictDirective;this.context.allowStrictDirective=d.simple;var _=this.parseFunctionSourceElements();return this.context.strict&&l&&this.throwUnexpectedToken(l,n),this.context.strict&&f&&this.tolerateUnexpectedToken(f,n),this.context.strict=m,this.context.allowStrictDirective=g,this.context.await=c,this.context.allowYield=h,r?this.finalize(t,new s.AsyncFunctionDeclaration(o,p,_)):this.finalize(t,new s.FunctionDeclaration(o,p,_,i))},e.prototype.parseFunctionExpression=function(){var e=this.createNode(),t=this.matchContextualKeyword("async");t&&this.nextToken(),this.expectKeyword("function");var r,n=!t&&this.match("*");n&&this.nextToken();var i,o=null,l=this.context.await,u=this.context.allowYield;if(this.context.await=t,this.context.allowYield=!n,!this.match("(")){var c=this.lookahead;o=this.context.strict||n||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(c.value)&&this.tolerateUnexpectedToken(c,a.Messages.StrictFunctionName):this.scanner.isRestrictedWord(c.value)?(i=c,r=a.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(c.value)&&(i=c,r=a.Messages.StrictReservedWord)}var h=this.parseFormalParameters(i),d=h.params,p=h.stricted;i=h.firstRestricted,h.message&&(r=h.message);var f=this.context.strict,m=this.context.allowStrictDirective;this.context.allowStrictDirective=h.simple;var g=this.parseFunctionSourceElements();return this.context.strict&&i&&this.throwUnexpectedToken(i,r),this.context.strict&&p&&this.tolerateUnexpectedToken(p,r),this.context.strict=f,this.context.allowStrictDirective=m,this.context.await=l,this.context.allowYield=u,t?this.finalize(e,new s.AsyncFunctionExpression(o,d,g)):this.finalize(e,new s.FunctionExpression(o,d,g,n))},e.prototype.parseDirective=function(){var e=this.lookahead,t=this.createNode(),r=this.parseExpression(),n=r.type===l.Syntax.Literal?this.getTokenRaw(e).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(t,n?new s.Directive(r,n):new s.ExpressionStatement(r))},e.prototype.parseDirectivePrologues=function(){for(var e=null,t=[];;){var r=this.lookahead;if(8!==r.type)break;var n=this.parseDirective();t.push(n);var i=n.directive;if("string"!=typeof i)break;"use strict"===i?(this.context.strict=!0,e&&this.tolerateUnexpectedToken(e,a.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(r,a.Messages.IllegalLanguageModeDirective)):!e&&r.octal&&(e=r)}return t},e.prototype.qualifiedPropertyName=function(e){switch(e.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return"["===e.value}return!1},e.prototype.parseGetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var r=this.parseFormalParameters();r.params.length>0&&this.tolerateError(a.Messages.BadGetterArity);var n=this.parsePropertyMethod(r);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,r.params,n,false))},e.prototype.parseSetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var r=this.parseFormalParameters();1!==r.params.length?this.tolerateError(a.Messages.BadSetterArity):r.params[0]instanceof s.RestElement&&this.tolerateError(a.Messages.BadSetterRestParameter);var n=this.parsePropertyMethod(r);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,r.params,n,false))},e.prototype.parseGeneratorMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var r=this.parseFormalParameters();this.context.allowYield=!1;var n=this.parsePropertyMethod(r);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,r.params,n,!0))},e.prototype.isStartOfExpression=function(){var e=!0,t=this.lookahead.value;switch(this.lookahead.type){case 7:e="["===t||"("===t||"{"===t||"+"===t||"-"===t||"!"===t||"~"===t||"++"===t||"--"===t||"/"===t||"/="===t;break;case 4:e="class"===t||"delete"===t||"function"===t||"let"===t||"new"===t||"super"===t||"this"===t||"typeof"===t||"void"===t||"yield"===t}return e},e.prototype.parseYieldExpression=function(){var e=this.createNode();this.expectKeyword("yield");var t=null,r=!1;if(!this.hasLineTerminator){var n=this.context.allowYield;this.context.allowYield=!1,(r=this.match("*"))?(this.nextToken(),t=this.parseAssignmentExpression()):this.isStartOfExpression()&&(t=this.parseAssignmentExpression()),this.context.allowYield=n}return this.finalize(e,new s.YieldExpression(t,r))},e.prototype.parseClassElement=function(e){var t=this.lookahead,r=this.createNode(),n="",i=null,o=null,l=!1,u=!1,c=!1,h=!1;if(this.match("*"))this.nextToken();else if(l=this.match("["),"static"===(i=this.parseObjectPropertyKey()).name&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(t=this.lookahead,c=!0,l=this.match("["),this.match("*")?this.nextToken():i=this.parseObjectPropertyKey()),3===t.type&&!this.hasLineTerminator&&"async"===t.value){var d=this.lookahead.value;":"!==d&&"("!==d&&"*"!==d&&(h=!0,t=this.lookahead,i=this.parseObjectPropertyKey(),3===t.type&&"constructor"===t.value&&this.tolerateUnexpectedToken(t,a.Messages.ConstructorIsAsync))}var p=this.qualifiedPropertyName(this.lookahead);return 3===t.type?"get"===t.value&&p?(n="get",l=this.match("["),i=this.parseObjectPropertyKey(),this.context.allowYield=!1,o=this.parseGetterMethod()):"set"===t.value&&p&&(n="set",l=this.match("["),i=this.parseObjectPropertyKey(),o=this.parseSetterMethod()):7===t.type&&"*"===t.value&&p&&(n="init",l=this.match("["),i=this.parseObjectPropertyKey(),o=this.parseGeneratorMethod(),u=!0),!n&&i&&this.match("(")&&(n="init",o=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),u=!0),n||this.throwUnexpectedToken(this.lookahead),"init"===n&&(n="method"),l||(c&&this.isPropertyKey(i,"prototype")&&this.throwUnexpectedToken(t,a.Messages.StaticPrototype),!c&&this.isPropertyKey(i,"constructor")&&(("method"!==n||!u||o&&o.generator)&&this.throwUnexpectedToken(t,a.Messages.ConstructorSpecialMethod),e.value?this.throwUnexpectedToken(t,a.Messages.DuplicateConstructor):e.value=!0,n="constructor")),this.finalize(r,new s.MethodDefinition(i,l,o,n,c))},e.prototype.parseClassElementList=function(){var e=[],t={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():e.push(this.parseClassElement(t));return this.expect("}"),e},e.prototype.parseClassBody=function(){var e=this.createNode(),t=this.parseClassElementList();return this.finalize(e,new s.ClassBody(t))},e.prototype.parseClassDeclaration=function(e){var t=this.createNode(),r=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var n=e&&3!==this.lookahead.type?null:this.parseVariableIdentifier(),i=null;this.matchKeyword("extends")&&(this.nextToken(),i=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var a=this.parseClassBody();return this.context.strict=r,this.finalize(t,new s.ClassDeclaration(n,i,a))},e.prototype.parseClassExpression=function(){var e=this.createNode(),t=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var r=3===this.lookahead.type?this.parseVariableIdentifier():null,n=null;this.matchKeyword("extends")&&(this.nextToken(),n=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var i=this.parseClassBody();return this.context.strict=t,this.finalize(e,new s.ClassExpression(r,n,i))},e.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new s.Module(t))},e.prototype.parseScript=function(){for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new s.Script(t))},e.prototype.parseModuleSpecifier=function(){var e=this.createNode();8!==this.lookahead.type&&this.throwError(a.Messages.InvalidModuleSpecifier);var t=this.nextToken(),r=this.getTokenRaw(t);return this.finalize(e,new s.Literal(t.value,r))},e.prototype.parseImportSpecifier=function(){var e,t,r=this.createNode();return 3===this.lookahead.type?(t=e=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),t=this.parseVariableIdentifier())):(t=e=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),t=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(r,new s.ImportSpecifier(t,e))},e.prototype.parseNamedImports=function(){this.expect("{");for(var e=[];!this.match("}");)e.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),e},e.prototype.parseImportDefaultSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName();return this.finalize(e,new s.ImportDefaultSpecifier(t))},e.prototype.parseImportNamespaceSpecifier=function(){var e=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(a.Messages.NoAsAfterImportNamespace),this.nextToken();var t=this.parseIdentifierName();return this.finalize(e,new s.ImportNamespaceSpecifier(t))},e.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(a.Messages.IllegalImportDeclaration);var e,t=this.createNode();this.expectKeyword("import");var r=[];if(8===this.lookahead.type)e=this.parseModuleSpecifier();else{if(this.match("{")?r=r.concat(this.parseNamedImports()):this.match("*")?r.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(r.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?r.push(this.parseImportNamespaceSpecifier()):this.match("{")?r=r.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var n=this.lookahead.value?a.Messages.UnexpectedToken:a.Messages.MissingFromClause;this.throwError(n,this.lookahead.value)}this.nextToken(),e=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(t,new s.ImportDeclaration(r,e))},e.prototype.parseExportSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName(),r=t;return this.matchContextualKeyword("as")&&(this.nextToken(),r=this.parseIdentifierName()),this.finalize(e,new s.ExportSpecifier(t,r))},e.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(a.Messages.IllegalExportDeclaration);var e,t=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var r=this.parseFunctionDeclaration(!0);e=this.finalize(t,new s.ExportDefaultDeclaration(r))}else if(this.matchKeyword("class")){r=this.parseClassDeclaration(!0);e=this.finalize(t,new s.ExportDefaultDeclaration(r))}else if(this.matchContextualKeyword("async")){r=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression();e=this.finalize(t,new s.ExportDefaultDeclaration(r))}else{this.matchContextualKeyword("from")&&this.throwError(a.Messages.UnexpectedToken,this.lookahead.value);r=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression();this.consumeSemicolon(),e=this.finalize(t,new s.ExportDefaultDeclaration(r))}else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var n=this.lookahead.value?a.Messages.UnexpectedToken:a.Messages.MissingFromClause;this.throwError(n,this.lookahead.value)}this.nextToken();var i=this.parseModuleSpecifier();this.consumeSemicolon(),e=this.finalize(t,new s.ExportAllDeclaration(i))}else if(4===this.lookahead.type){r=void 0;switch(this.lookahead.value){case"let":case"const":r=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":r=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}e=this.finalize(t,new s.ExportNamedDeclaration(r,[],null))}else if(this.matchAsyncFunction()){r=this.parseFunctionDeclaration();e=this.finalize(t,new s.ExportNamedDeclaration(r,[],null))}else{var o=[],l=null,u=!1;for(this.expect("{");!this.match("}");)u=u||this.matchKeyword("default"),o.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");if(this.expect("}"),this.matchContextualKeyword("from"))this.nextToken(),l=this.parseModuleSpecifier(),this.consumeSemicolon();else if(u){n=this.lookahead.value?a.Messages.UnexpectedToken:a.Messages.MissingFromClause;this.throwError(n,this.lookahead.value)}else this.consumeSemicolon();e=this.finalize(t,new s.ExportNamedDeclaration(null,o,l))}return e},e}();t.Parser=h},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error("ASSERT: "+t)}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.errors=[],this.tolerant=!1}return e.prototype.recordError=function(e){this.errors.push(e)},e.prototype.tolerate=function(e){if(!this.tolerant)throw e;this.recordError(e)},e.prototype.constructError=function(e,t){var r=new Error(e);try{throw r}catch(e){Object.create&&Object.defineProperty&&(r=Object.create(e),Object.defineProperty(r,"column",{value:t}))}return r},e.prototype.createError=function(e,t,r,n){var i="Line "+t+": "+n,a=this.constructError(i,r);return a.index=e,a.lineNumber=t,a.description=n,a},e.prototype.throwError=function(e,t,r,n){throw this.createError(e,t,r,n)},e.prototype.tolerateError=function(e,t,r,n){var i=this.createError(e,t,r,n);if(!this.tolerant)throw i;this.recordError(i)},e}();t.ErrorHandler=r},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(9),i=r(4),a=r(11);function s(e){return"0123456789abcdef".indexOf(e.toLowerCase())}function o(e){return"01234567".indexOf(e)}var l=function(){function e(e,t){this.source=e,this.errorHandler=t,this.trackComment=!1,this.isModule=!1,this.length=e.length,this.index=0,this.lineNumber=e.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return e.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},e.prototype.restoreState=function(e){this.index=e.index,this.lineNumber=e.lineNumber,this.lineStart=e.lineStart},e.prototype.eof=function(){return this.index>=this.length},e.prototype.throwUnexpectedToken=function(e){return void 0===e&&(e=a.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.tolerateUnexpectedToken=function(e){void 0===e&&(e=a.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.skipSingleLineComment=function(e){var t,r,n=[];for(this.trackComment&&(n=[],t=this.index-e,r={start:{line:this.lineNumber,column:this.index-this.lineStart-e},end:{}});!this.eof();){var a=this.source.charCodeAt(this.index);if(++this.index,i.Character.isLineTerminator(a)){if(this.trackComment){r.end={line:this.lineNumber,column:this.index-this.lineStart-1};var s={multiLine:!1,slice:[t+e,this.index-1],range:[t,this.index-1],loc:r};n.push(s)}return 13===a&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,n}}if(this.trackComment){r.end={line:this.lineNumber,column:this.index-this.lineStart};s={multiLine:!1,slice:[t+e,this.index],range:[t,this.index],loc:r};n.push(s)}return n},e.prototype.skipMultiLineComment=function(){var e,t,r=[];for(this.trackComment&&(r=[],e=this.index-2,t={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var n=this.source.charCodeAt(this.index);if(i.Character.isLineTerminator(n))13===n&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(42===n){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,this.trackComment){t.end={line:this.lineNumber,column:this.index-this.lineStart};var a={multiLine:!0,slice:[e+2,this.index-2],range:[e,this.index],loc:t};r.push(a)}return r}++this.index}else++this.index}if(this.trackComment){t.end={line:this.lineNumber,column:this.index-this.lineStart};a={multiLine:!0,slice:[e+2,this.index],range:[e,this.index],loc:t};r.push(a)}return this.tolerateUnexpectedToken(),r},e.prototype.scanComments=function(){var e;this.trackComment&&(e=[]);for(var t=0===this.index;!this.eof();){var r=this.source.charCodeAt(this.index);if(i.Character.isWhiteSpace(r))++this.index;else if(i.Character.isLineTerminator(r))++this.index,13===r&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,t=!0;else if(47===r)if(47===(r=this.source.charCodeAt(this.index+1))){this.index+=2;var n=this.skipSingleLineComment(2);this.trackComment&&(e=e.concat(n)),t=!0}else{if(42!==r)break;this.index+=2;n=this.skipMultiLineComment();this.trackComment&&(e=e.concat(n))}else if(t&&45===r){if(45!==this.source.charCodeAt(this.index+1)||62!==this.source.charCodeAt(this.index+2))break;this.index+=3;n=this.skipSingleLineComment(3);this.trackComment&&(e=e.concat(n))}else{if(60!==r||this.isModule)break;if("!--"!==this.source.slice(this.index+1,this.index+4))break;this.index+=4;n=this.skipSingleLineComment(4);this.trackComment&&(e=e.concat(n))}}return e},e.prototype.isFutureReservedWord=function(e){switch(e){case"enum":case"export":case"import":case"super":return!0;default:return!1}},e.prototype.isStrictModeReservedWord=function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},e.prototype.isRestrictedWord=function(e){return"eval"===e||"arguments"===e},e.prototype.isKeyword=function(e){switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}},e.prototype.codePointAt=function(e){var t=this.source.charCodeAt(e);if(t>=55296&&t<=56319){var r=this.source.charCodeAt(e+1);if(r>=56320&&r<=57343)t=1024*(t-55296)+r-56320+65536}return t},e.prototype.scanHexEscape=function(e){for(var t="u"===e?4:2,r=0,n=0;n<t;++n){if(this.eof()||!i.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;r=16*r+s(this.source[this.index++])}return String.fromCharCode(r)},e.prototype.scanUnicodeCodePointEscape=function(){var e=this.source[this.index],t=0;for("}"===e&&this.throwUnexpectedToken();!this.eof()&&(e=this.source[this.index++],i.Character.isHexDigit(e.charCodeAt(0)));)t=16*t+s(e);return(t>1114111||"}"!==e)&&this.throwUnexpectedToken(),i.Character.fromCodePoint(t)},e.prototype.getIdentifier=function(){for(var e=this.index++;!this.eof();){var t=this.source.charCodeAt(this.index);if(92===t)return this.index=e,this.getComplexIdentifier();if(t>=55296&&t<57343)return this.index=e,this.getComplexIdentifier();if(!i.Character.isIdentifierPart(t))break;++this.index}return this.source.slice(e,this.index)},e.prototype.getComplexIdentifier=function(){var e,t=this.codePointAt(this.index),r=i.Character.fromCodePoint(t);for(this.index+=r.length,92===t&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&i.Character.isIdentifierStart(e.charCodeAt(0))||this.throwUnexpectedToken(),r=e);!this.eof()&&(t=this.codePointAt(this.index),i.Character.isIdentifierPart(t));)r+=e=i.Character.fromCodePoint(t),this.index+=e.length,92===t&&(r=r.substr(0,r.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):null!==(e=this.scanHexEscape("u"))&&"\\"!==e&&i.Character.isIdentifierPart(e.charCodeAt(0))||this.throwUnexpectedToken(),r+=e);return r},e.prototype.octalToDecimal=function(e){var t="0"!==e,r=o(e);return!this.eof()&&i.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(t=!0,r=8*r+o(this.source[this.index++]),"0123".indexOf(e)>=0&&!this.eof()&&i.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(r=8*r+o(this.source[this.index++]))),{code:r,octal:t}},e.prototype.scanIdentifier=function(){var e,t=this.index,r=92===this.source.charCodeAt(t)?this.getComplexIdentifier():this.getIdentifier();if(3!==(e=1===r.length?3:this.isKeyword(r)?4:"null"===r?5:"true"===r||"false"===r?1:3)&&t+r.length!==this.index){var n=this.index;this.index=t,this.tolerateUnexpectedToken(a.Messages.InvalidEscapedReservedWord),this.index=n}return{type:e,value:r,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.scanPunctuator=function(){var e=this.index,t=this.source[this.index];switch(t){case"(":case"{":"{"===t&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,"."===this.source[this.index]&&"."===this.source[this.index+1]&&(this.index+=2,t="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:">>>="===(t=this.source.substr(this.index,4))?this.index+=4:"==="===(t=t.substr(0,3))||"!=="===t||">>>"===t||"<<="===t||">>="===t||"**="===t?this.index+=3:"&&"===(t=t.substr(0,2))||"||"===t||"=="===t||"!="===t||"+="===t||"-="===t||"*="===t||"/="===t||"++"===t||"--"===t||"<<"===t||">>"===t||"&="===t||"|="===t||"^="===t||"%="===t||"<="===t||">="===t||"=>"===t||"**"===t?this.index+=2:(t=this.source[this.index],"<>=!+-*%&|^/".indexOf(t)>=0&&++this.index)}return this.index===e&&this.throwUnexpectedToken(),{type:7,value:t,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanHexLiteral=function(e){for(var t="";!this.eof()&&i.Character.isHexDigit(this.source.charCodeAt(this.index));)t+=this.source[this.index++];return 0===t.length&&this.throwUnexpectedToken(),i.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+t,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanBinaryLiteral=function(e){for(var t,r="";!this.eof()&&("0"===(t=this.source[this.index])||"1"===t);)r+=this.source[this.index++];return 0===r.length&&this.throwUnexpectedToken(),this.eof()||(t=this.source.charCodeAt(this.index),(i.Character.isIdentifierStart(t)||i.Character.isDecimalDigit(t))&&this.throwUnexpectedToken()),{type:6,value:parseInt(r,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanOctalLiteral=function(e,t){var r="",n=!1;for(i.Character.isOctalDigit(e.charCodeAt(0))?(n=!0,r="0"+this.source[this.index++]):++this.index;!this.eof()&&i.Character.isOctalDigit(this.source.charCodeAt(this.index));)r+=this.source[this.index++];return n||0!==r.length||this.throwUnexpectedToken(),(i.Character.isIdentifierStart(this.source.charCodeAt(this.index))||i.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(r,8),octal:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.isImplicitOctalLiteral=function(){for(var e=this.index+1;e<this.length;++e){var t=this.source[e];if("8"===t||"9"===t)return!1;if(!i.Character.isOctalDigit(t.charCodeAt(0)))return!0}return!0},e.prototype.scanNumericLiteral=function(){var e=this.index,t=this.source[e];n.assert(i.Character.isDecimalDigit(t.charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point");var r="";if("."!==t){if(r=this.source[this.index++],t=this.source[this.index],"0"===r){if("x"===t||"X"===t)return++this.index,this.scanHexLiteral(e);if("b"===t||"B"===t)return++this.index,this.scanBinaryLiteral(e);if("o"===t||"O"===t)return this.scanOctalLiteral(t,e);if(t&&i.Character.isOctalDigit(t.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(t,e)}for(;i.Character.isDecimalDigit(this.source.charCodeAt(this.index));)r+=this.source[this.index++];t=this.source[this.index]}if("."===t){for(r+=this.source[this.index++];i.Character.isDecimalDigit(this.source.charCodeAt(this.index));)r+=this.source[this.index++];t=this.source[this.index]}if("e"===t||"E"===t)if(r+=this.source[this.index++],"+"!==(t=this.source[this.index])&&"-"!==t||(r+=this.source[this.index++]),i.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;i.Character.isDecimalDigit(this.source.charCodeAt(this.index));)r+=this.source[this.index++];else this.throwUnexpectedToken();return i.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(r),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanStringLiteral=function(){var e=this.index,t=this.source[e];n.assert("'"===t||'"'===t,"String literal must starts with a quote"),++this.index;for(var r=!1,s="";!this.eof();){var o=this.source[this.index++];if(o===t){t="";break}if("\\"===o)if((o=this.source[this.index++])&&i.Character.isLineTerminator(o.charCodeAt(0)))++this.lineNumber,"\r"===o&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(o){case"u":if("{"===this.source[this.index])++this.index,s+=this.scanUnicodeCodePointEscape();else{var l=this.scanHexEscape(o);null===l&&this.throwUnexpectedToken(),s+=l}break;case"x":var u=this.scanHexEscape(o);null===u&&this.throwUnexpectedToken(a.Messages.InvalidHexEscapeSequence),s+=u;break;case"n":s+="\n";break;case"r":s+="\r";break;case"t":s+="\t";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;case"8":case"9":s+=o,this.tolerateUnexpectedToken();break;default:if(o&&i.Character.isOctalDigit(o.charCodeAt(0))){var c=this.octalToDecimal(o);r=c.octal||r,s+=String.fromCharCode(c.code)}else s+=o}else{if(i.Character.isLineTerminator(o.charCodeAt(0)))break;s+=o}}return""!==t&&(this.index=e,this.throwUnexpectedToken()),{type:8,value:s,octal:r,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanTemplate=function(){var e="",t=!1,r=this.index,n="`"===this.source[r],s=!1,o=2;for(++this.index;!this.eof();){var l=this.source[this.index++];if("`"===l){o=1,s=!0,t=!0;break}if("$"===l){if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,t=!0;break}e+=l}else if("\\"===l)if(l=this.source[this.index++],i.Character.isLineTerminator(l.charCodeAt(0)))++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(l){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"u":if("{"===this.source[this.index])++this.index,e+=this.scanUnicodeCodePointEscape();else{var u=this.index,c=this.scanHexEscape(l);null!==c?e+=c:(this.index=u,e+=l)}break;case"x":var h=this.scanHexEscape(l);null===h&&this.throwUnexpectedToken(a.Messages.InvalidHexEscapeSequence),e+=h;break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:"0"===l?(i.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(a.Messages.TemplateOctalLiteral),e+="\0"):i.Character.isOctalDigit(l.charCodeAt(0))?this.throwUnexpectedToken(a.Messages.TemplateOctalLiteral):e+=l}else i.Character.isLineTerminator(l.charCodeAt(0))?(++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,e+="\n"):e+=l}return t||this.throwUnexpectedToken(),n||this.curlyStack.pop(),{type:10,value:this.source.slice(r+1,this.index-o),cooked:e,head:n,tail:s,lineNumber:this.lineNumber,lineStart:this.lineStart,start:r,end:this.index}},e.prototype.testRegExp=function(e,t){var r=e,n=this;t.indexOf("u")>=0&&(r=r.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,(function(e,t,r){var i=parseInt(t||r,16);return i>1114111&&n.throwUnexpectedToken(a.Messages.InvalidRegExp),i<=65535?String.fromCharCode(i):"￿"})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"￿"));try{RegExp(r)}catch(e){this.throwUnexpectedToken(a.Messages.InvalidRegExp)}try{return new RegExp(e,t)}catch(e){return null}},e.prototype.scanRegExpBody=function(){var e=this.source[this.index];n.assert("/"===e,"Regular expression literal must start with a slash");for(var t=this.source[this.index++],r=!1,s=!1;!this.eof();)if(t+=e=this.source[this.index++],"\\"===e)e=this.source[this.index++],i.Character.isLineTerminator(e.charCodeAt(0))&&this.throwUnexpectedToken(a.Messages.UnterminatedRegExp),t+=e;else if(i.Character.isLineTerminator(e.charCodeAt(0)))this.throwUnexpectedToken(a.Messages.UnterminatedRegExp);else if(r)"]"===e&&(r=!1);else{if("/"===e){s=!0;break}"["===e&&(r=!0)}return s||this.throwUnexpectedToken(a.Messages.UnterminatedRegExp),t.substr(1,t.length-2)},e.prototype.scanRegExpFlags=function(){for(var e="";!this.eof();){var t=this.source[this.index];if(!i.Character.isIdentifierPart(t.charCodeAt(0)))break;if(++this.index,"\\"!==t||this.eof())e+=t,t;else if("u"===(t=this.source[this.index])){++this.index;var r=this.index,n=this.scanHexEscape("u");if(null!==n)for(e+=n,"\\u";r<this.index;++r)this.source[r];else this.index=r,e+="u","\\u";this.tolerateUnexpectedToken()}else"\\",this.tolerateUnexpectedToken()}return e},e.prototype.scanRegExp=function(){var e=this.index,t=this.scanRegExpBody(),r=this.scanRegExpFlags();return{type:9,value:"",pattern:t,flags:r,regex:this.testRegExp(t,r),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var e=this.source.charCodeAt(this.index);return i.Character.isIdentifierStart(e)?this.scanIdentifier():40===e||41===e||59===e?this.scanPunctuator():39===e||34===e?this.scanStringLiteral():46===e?i.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():i.Character.isDecimalDigit(e)?this.scanNumericLiteral():96===e||125===e&&"${"===this.curlyStack[this.curlyStack.length-1]?this.scanTemplate():e>=55296&&e<57343&&i.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},e}();t.Scanner=l},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TokenName={},t.TokenName[1]="Boolean",t.TokenName[2]="<end>",t.TokenName[3]="Identifier",t.TokenName[4]="Keyword",t.TokenName[5]="Null",t.TokenName[6]="Numeric",t.TokenName[7]="Punctuator",t.TokenName[8]="String",t.TokenName[9]="RegularExpression",t.TokenName[10]="Template"},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",times:"×",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",divide:"÷",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",frasl:"⁄",euro:"€",image:"ℑ",weierp:"℘",real:"ℜ",trade:"™",alefsym:"ℵ",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lArr:"⇐",uArr:"⇑",rArr:"⇒",dArr:"⇓",hArr:"⇔",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦",lang:"⟨",rang:"⟩"}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(10),i=r(12),a=r(13),s=function(){function e(){this.values=[],this.curly=this.paren=-1}return e.prototype.beforeFunctionExpression=function(e){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(e)>=0},e.prototype.isRegexStart=function(){var e=this.values[this.values.length-1],t=null!==e;switch(e){case"this":case"]":t=!1;break;case")":var r=this.values[this.paren-1];t="if"===r||"while"===r||"for"===r||"with"===r;break;case"}":if(t=!1,"function"===this.values[this.curly-3])t=!!(n=this.values[this.curly-4])&&!this.beforeFunctionExpression(n);else if("function"===this.values[this.curly-4]){var n;t=!(n=this.values[this.curly-5])||!this.beforeFunctionExpression(n)}}return t},e.prototype.push=function(e){7===e.type||4===e.type?("{"===e.value?this.curly=this.values.length:"("===e.value&&(this.paren=this.values.length),this.values.push(e.value)):this.values.push(null)},e}(),o=function(){function e(e,t){this.errorHandler=new n.ErrorHandler,this.errorHandler.tolerant=!!t&&("boolean"==typeof t.tolerant&&t.tolerant),this.scanner=new i.Scanner(e,this.errorHandler),this.scanner.trackComment=!!t&&("boolean"==typeof t.comment&&t.comment),this.trackRange=!!t&&("boolean"==typeof t.range&&t.range),this.trackLoc=!!t&&("boolean"==typeof t.loc&&t.loc),this.buffer=[],this.reader=new s}return e.prototype.errors=function(){return this.errorHandler.errors},e.prototype.getNextToken=function(){if(0===this.buffer.length){var e=this.scanner.scanComments();if(this.scanner.trackComment)for(var t=0;t<e.length;++t){var r=e[t],n=this.scanner.source.slice(r.slice[0],r.slice[1]),i={type:r.multiLine?"BlockComment":"LineComment",value:n};this.trackRange&&(i.range=r.range),this.trackLoc&&(i.loc=r.loc),this.buffer.push(i)}if(!this.scanner.eof()){var s=void 0;this.trackLoc&&(s={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var o="/"===this.scanner.source[this.scanner.index]&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(o);var l={type:a.TokenName[o.type],value:this.scanner.source.slice(o.start,o.end)};if(this.trackRange&&(l.range=[o.start,o.end]),this.trackLoc&&(s.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},l.loc=s),9===o.type){var u=o.pattern,c=o.flags;l.regex={pattern:u,flags:c}}this.buffer.push(l)}}return this.buffer.shift()},e}();t.Tokenizer=o}])}))}({get exports(){return Ue},set exports(e){Ue=e}});var ze={},je={};!function(e){!function e(t){var r,n,i,a,s,o;function l(e){var t,r,n={};for(t in e)e.hasOwnProperty(t)&&(r=e[t],n[t]="object"==typeof r&&null!==r?l(r):r);return n}function u(e,t){this.parent=e,this.key=t}function c(e,t,r,n){this.node=e,this.path=t,this.wrap=r,this.ref=n}function h(){}function d(e){return null!=e&&("object"==typeof e&&"string"==typeof e.type)}function p(e,t){return(e===r.ObjectExpression||e===r.ObjectPattern)&&"properties"===t}function f(e,t){for(var r=e.length-1;r>=0;--r)if(e[r].node===t)return!0;return!1}function m(e,t){return(new h).traverse(e,t)}function g(e,t){var r;return r=function(e,t){var r,n,i,a;for(n=e.length,i=0;n;)t(e[a=i+(r=n>>>1)])?n=r:(i=a+1,n-=r+1);return i}(t,(function(t){return t.range[0]>e.range[0]})),e.extendedRange=[e.range[0],e.range[1]],r!==t.length&&(e.extendedRange[1]=t[r].range[0]),(r-=1)>=0&&(e.extendedRange[0]=t[r].range[1]),e}return r={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ChainExpression:"ChainExpression",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportExpression:"ImportExpression",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",PrivateIdentifier:"PrivateIdentifier",Program:"Program",Property:"Property",PropertyDefinition:"PropertyDefinition",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},i={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ChainExpression:["expression"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportExpression:["source"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],PrivateIdentifier:[],Program:["body"],Property:["key","value"],PropertyDefinition:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},n={Break:a={},Skip:s={},Remove:o={}},u.prototype.replace=function(e){this.parent[this.key]=e},u.prototype.remove=function(){return Array.isArray(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)},h.prototype.path=function(){var e,t,r,n,i;function a(e,t){if(Array.isArray(t))for(r=0,n=t.length;r<n;++r)e.push(t[r]);else e.push(t)}if(!this.__current.path)return null;for(i=[],e=2,t=this.__leavelist.length;e<t;++e)a(i,this.__leavelist[e].path);return a(i,this.__current.path),i},h.prototype.type=function(){return this.current().type||this.__current.wrap},h.prototype.parents=function(){var e,t,r;for(r=[],e=1,t=this.__leavelist.length;e<t;++e)r.push(this.__leavelist[e].node);return r},h.prototype.current=function(){return this.__current.node},h.prototype.__execute=function(e,t){var r,n;return n=void 0,r=this.__current,this.__current=t,this.__state=null,e&&(n=e.call(this,t.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=r,n},h.prototype.notify=function(e){this.__state=e},h.prototype.skip=function(){this.notify(s)},h.prototype.break=function(){this.notify(a)},h.prototype.remove=function(){this.notify(o)},h.prototype.__initialize=function(e,t){this.visitor=t,this.root=e,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback=null,"iteration"===t.fallback?this.__fallback=Object.keys:"function"==typeof t.fallback&&(this.__fallback=t.fallback),this.__keys=i,t.keys&&(this.__keys=Object.assign(Object.create(this.__keys),t.keys))},h.prototype.traverse=function(e,t){var r,n,i,o,l,u,h,m,g,_,v,y;for(this.__initialize(e,t),y={},r=this.__worklist,n=this.__leavelist,r.push(new c(e,null,null,null)),n.push(new c(null,null,null,null));r.length;)if((i=r.pop())!==y){if(i.node){if(u=this.__execute(t.enter,i),this.__state===a||u===a)return;if(r.push(y),n.push(i),this.__state===s||u===s)continue;if(l=(o=i.node).type||i.wrap,!(_=this.__keys[l])){if(!this.__fallback)throw new Error("Unknown node type "+l+".");_=this.__fallback(o)}for(m=_.length;(m-=1)>=0;)if(v=o[h=_[m]])if(Array.isArray(v)){for(g=v.length;(g-=1)>=0;)if(v[g]&&!f(n,v[g])){if(p(l,_[m]))i=new c(v[g],[h,g],"Property",null);else{if(!d(v[g]))continue;i=new c(v[g],[h,g],null,null)}r.push(i)}}else if(d(v)){if(f(n,v))continue;r.push(new c(v,h,null,null))}}}else if(i=n.pop(),u=this.__execute(t.leave,i),this.__state===a||u===a)return},h.prototype.replace=function(e,t){var r,n,i,l,h,f,m,g,_,v,y,x,b;function A(e){var t,n,i,a;if(e.ref.remove())for(n=e.ref.key,a=e.ref.parent,t=r.length;t--;)if((i=r[t]).ref&&i.ref.parent===a){if(i.ref.key<n)break;--i.ref.key}}for(this.__initialize(e,t),y={},r=this.__worklist,n=this.__leavelist,f=new c(e,null,null,new u(x={root:e},"root")),r.push(f),n.push(f);r.length;)if((f=r.pop())!==y){if(void 0!==(h=this.__execute(t.enter,f))&&h!==a&&h!==s&&h!==o&&(f.ref.replace(h),f.node=h),this.__state!==o&&h!==o||(A(f),f.node=null),this.__state===a||h===a)return x.root;if((i=f.node)&&(r.push(y),n.push(f),this.__state!==s&&h!==s)){if(l=i.type||f.wrap,!(_=this.__keys[l])){if(!this.__fallback)throw new Error("Unknown node type "+l+".");_=this.__fallback(i)}for(m=_.length;(m-=1)>=0;)if(v=i[b=_[m]])if(Array.isArray(v)){for(g=v.length;(g-=1)>=0;)if(v[g]){if(p(l,_[m]))f=new c(v[g],[b,g],"Property",new u(v,g));else{if(!d(v[g]))continue;f=new c(v[g],[b,g],null,new u(v,g))}r.push(f)}}else d(v)&&r.push(new c(v,b,null,new u(i,b)))}}else if(f=n.pop(),void 0!==(h=this.__execute(t.leave,f))&&h!==a&&h!==s&&h!==o&&f.ref.replace(h),this.__state!==o&&h!==o||A(f),this.__state===a||h===a)return x.root;return x.root},t.Syntax=r,t.traverse=m,t.replace=function(e,t){return(new h).replace(e,t)},t.attachComments=function(e,t,r){var i,a,s,o,u=[];if(!e.range)throw new Error("attachComments needs range information");if(!r.length){if(t.length){for(s=0,a=t.length;s<a;s+=1)(i=l(t[s])).extendedRange=[0,e.range[0]],u.push(i);e.leadingComments=u}return e}for(s=0,a=t.length;s<a;s+=1)u.push(g(l(t[s]),r));return o=0,m(e,{enter:function(e){for(var t;o<u.length&&!((t=u[o]).extendedRange[1]>e.range[0]);)t.extendedRange[1]===e.range[0]?(e.leadingComments||(e.leadingComments=[]),e.leadingComments.push(t),u.splice(o,1)):o+=1;return o===u.length?n.Break:u[o].extendedRange[0]>e.range[1]?n.Skip:void 0}}),o=0,m(e,{leave:function(e){for(var t;o<u.length&&(t=u[o],!(e.range[1]<t.extendedRange[0]));)e.range[1]===t.extendedRange[0]?(e.trailingComments||(e.trailingComments=[]),e.trailingComments.push(t),u.splice(o,1)):o+=1;return o===u.length?n.Break:u[o].extendedRange[0]>e.range[1]?n.Skip:void 0}}),e},t.VisitorKeys=i,t.VisitorOption=n,t.Controller=h,t.cloneEnvironment=function(){return e({})},t}(e)}(je);var Ve={},Ge={},We={get exports(){return Ge},set exports(e){Ge=e}};!function(){function e(e){if(null==e)return!1;switch(e.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function t(e){switch(e.type){case"IfStatement":return null!=e.alternate?e.alternate:e.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return e.body}return null}We.exports={isExpression:function(e){if(null==e)return!1;switch(e.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1},isStatement:e,isIterationStatement:function(e){if(null==e)return!1;switch(e.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1},isSourceElement:function(t){return e(t)||null!=t&&"FunctionDeclaration"===t.type},isProblematicIfStatement:function(e){var r;if("IfStatement"!==e.type)return!1;if(null==e.alternate)return!1;r=e.consequent;do{if("IfStatement"===r.type&&null==r.alternate)return!0;r=t(r)}while(r);return!1},trailingStatement:t}}();var He={},qe={get exports(){return He},set exports(e){He=e}};!function(){var e,t,r,n,i,a;function s(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(Math.floor((e-65536)/1024)+55296)+String.fromCharCode((e-65536)%1024+56320)}for(t={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},e={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},r=[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279],n=new Array(128),a=0;a<128;++a)n[a]=a>=97&&a<=122||a>=65&&a<=90||36===a||95===a;for(i=new Array(128),a=0;a<128;++a)i[a]=a>=97&&a<=122||a>=65&&a<=90||a>=48&&a<=57||36===a||95===a;qe.exports={isDecimalDigit:function(e){return 48<=e&&e<=57},isHexDigit:function(e){return 48<=e&&e<=57||97<=e&&e<=102||65<=e&&e<=70},isOctalDigit:function(e){return e>=48&&e<=55},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&r.indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStartES5:function(e){return e<128?n[e]:t.NonAsciiIdentifierStart.test(s(e))},isIdentifierPartES5:function(e){return e<128?i[e]:t.NonAsciiIdentifierPart.test(s(e))},isIdentifierStartES6:function(t){return t<128?n[t]:e.NonAsciiIdentifierStart.test(s(t))},isIdentifierPartES6:function(t){return t<128?i[t]:e.NonAsciiIdentifierPart.test(s(t))}}}();var Xe={},Qe={get exports(){return Xe},set exports(e){Xe=e}};!function(){var e=He;function t(e,t){return!(!t&&"yield"===e)&&r(e,t)}function r(e,t){if(t&&function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function n(e,r){return"null"===e||"true"===e||"false"===e||t(e,r)}function i(e,t){return"null"===e||"true"===e||"false"===e||r(e,t)}function a(t){var r,n,i;if(0===t.length)return!1;if(i=t.charCodeAt(0),!e.isIdentifierStartES5(i))return!1;for(r=1,n=t.length;r<n;++r)if(i=t.charCodeAt(r),!e.isIdentifierPartES5(i))return!1;return!0}function s(t){var r,n,i,a,s;if(0===t.length)return!1;for(s=e.isIdentifierStartES6,r=0,n=t.length;r<n;++r){if(55296<=(i=t.charCodeAt(r))&&i<=56319){if(++r>=n)return!1;if(!(56320<=(a=t.charCodeAt(r))&&a<=57343))return!1;i=1024*(i-55296)+(a-56320)+65536}if(!s(i))return!1;s=e.isIdentifierPartES6}return!0}Qe.exports={isKeywordES5:t,isKeywordES6:r,isReservedWordES5:n,isReservedWordES6:i,isRestrictedWord:function(e){return"eval"===e||"arguments"===e},isIdentifierNameES5:a,isIdentifierNameES6:s,isIdentifierES5:function(e,t){return a(e)&&!n(e,t)},isIdentifierES6:function(e,t){return s(e)&&!i(e,t)}}}(),Ve.ast=Ge,Ve.code=He,Ve.keyword=Xe;var Ke,Ye,Ze={},Je={},$e={},et={};function tt(){if(Ke)return et;Ke=1;var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return et.encode=function(t){if(0<=t&&t<e.length)return e[t];throw new TypeError("Must be between 0 and 63: "+t)},et.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1},et}function rt(){if(Ye)return $e;Ye=1;var e=tt();return $e.encode=function(t){var r,n="",i=function(e){return e<0?1+(-e<<1):0+(e<<1)}(t);do{r=31&i,(i>>>=5)>0&&(r|=32),n+=e.encode(r)}while(i>0);return n},$e.decode=function(t,r,n){var i,a,s,o,l=t.length,u=0,c=0;do{if(r>=l)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(a=e.decode(t.charCodeAt(r++))))throw new Error("Invalid base64 digit: "+t.charAt(r-1));i=!!(32&a),u+=(a&=31)<<c,c+=5}while(i);n.value=(o=(s=u)>>1,1==(1&s)?-o:o),n.rest=r},$e}var nt,it={};function at(){return nt||(nt=1,function(e){e.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};var t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function n(e){var r=e.match(t);return r?{scheme:r[1],auth:r[2],host:r[3],port:r[4],path:r[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function a(t){var r=t,a=n(t);if(a){if(!a.path)return t;r=a.path}for(var s,o=e.isAbsolute(r),l=r.split(/\/+/),u=0,c=l.length-1;c>=0;c--)"."===(s=l[c])?l.splice(c,1):".."===s?u++:u>0&&(""===s?(l.splice(c+1,u),u=0):(l.splice(c,2),u--));return""===(r=l.join("/"))&&(r=o?"/":"."),a?(a.path=r,i(a)):r}function s(e,t){""===e&&(e="."),""===t&&(t=".");var s=n(t),o=n(e);if(o&&(e=o.path||"/"),s&&!s.scheme)return o&&(s.scheme=o.scheme),i(s);if(s||t.match(r))return t;if(o&&!o.host&&!o.path)return o.host=t,i(o);var l="/"===t.charAt(0)?t:a(e.replace(/\/+$/,"")+"/"+t);return o?(o.path=l,i(o)):l}e.urlParse=n,e.urlGenerate=i,e.normalize=a,e.join=s,e.isAbsolute=function(e){return"/"===e.charAt(0)||t.test(e)},e.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var r=0;0!==t.indexOf(e+"/");){var n=e.lastIndexOf("/");if(n<0)return t;if((e=e.slice(0,n)).match(/^([^\/]+:\/)?\/*$/))return t;++r}return Array(r+1).join("../")+t.substr(e.length+1)};var o=!("__proto__"in Object.create(null));function l(e){return e}function u(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function c(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}e.toSetString=o?l:function(e){return u(e)?"$"+e:e},e.fromSetString=o?l:function(e){return u(e)?e.slice(1):e},e.compareByOriginalPositions=function(e,t,r){var n=c(e.source,t.source);return 0!==n||0!==(n=e.originalLine-t.originalLine)||0!==(n=e.originalColumn-t.originalColumn)||r||0!==(n=e.generatedColumn-t.generatedColumn)||0!==(n=e.generatedLine-t.generatedLine)?n:c(e.name,t.name)},e.compareByGeneratedPositionsDeflated=function(e,t,r){var n=e.generatedLine-t.generatedLine;return 0!==n||0!==(n=e.generatedColumn-t.generatedColumn)||r||0!==(n=c(e.source,t.source))||0!==(n=e.originalLine-t.originalLine)||0!==(n=e.originalColumn-t.originalColumn)?n:c(e.name,t.name)},e.compareByGeneratedPositionsInflated=function(e,t){var r=e.generatedLine-t.generatedLine;return 0!==r||0!==(r=e.generatedColumn-t.generatedColumn)||0!==(r=c(e.source,t.source))||0!==(r=e.originalLine-t.originalLine)||0!==(r=e.originalColumn-t.originalColumn)?r:c(e.name,t.name)},e.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},e.computeSourceURL=function(e,t,r){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),r){var o=n(r);if(!o)throw new Error("sourceMapURL could not be parsed");if(o.path){var l=o.path.lastIndexOf("/");l>=0&&(o.path=o.path.substring(0,l+1))}t=s(i(o),t)}return a(t)}}(it)),it}var st,ot={};function lt(){if(st)return ot;st=1;var e=at(),t=Object.prototype.hasOwnProperty,r="undefined"!=typeof Map;function n(){this._array=[],this._set=r?new Map:Object.create(null)}return n.fromArray=function(e,t){for(var r=new n,i=0,a=e.length;i<a;i++)r.add(e[i],t);return r},n.prototype.size=function(){return r?this._set.size:Object.getOwnPropertyNames(this._set).length},n.prototype.add=function(n,i){var a=r?n:e.toSetString(n),s=r?this.has(n):t.call(this._set,a),o=this._array.length;s&&!i||this._array.push(n),s||(r?this._set.set(n,o):this._set[a]=o)},n.prototype.has=function(n){if(r)return this._set.has(n);var i=e.toSetString(n);return t.call(this._set,i)},n.prototype.indexOf=function(n){if(r){var i=this._set.get(n);if(i>=0)return i}else{var a=e.toSetString(n);if(t.call(this._set,a))return this._set[a]}throw new Error('"'+n+'" is not in the set.')},n.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},n.prototype.toArray=function(){return this._array.slice()},ot.ArraySet=n,ot}var ut,ct,ht={};function dt(){if(ut)return ht;ut=1;var e=at();function t(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return t.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},t.prototype.add=function(t){var r,n,i,a,s,o;r=this._last,n=t,i=r.generatedLine,a=n.generatedLine,s=r.generatedColumn,o=n.generatedColumn,a>i||a==i&&o>=s||e.compareByGeneratedPositionsInflated(r,n)<=0?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))},t.prototype.toArray=function(){return this._sorted||(this._array.sort(e.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},ht.MappingList=t,ht}function pt(){if(ct)return Je;ct=1;var e=rt(),t=at(),r=lt().ArraySet,n=dt().MappingList;function i(e){e||(e={}),this._file=t.getArg(e,"file",null),this._sourceRoot=t.getArg(e,"sourceRoot",null),this._skipValidation=t.getArg(e,"skipValidation",!1),this._sources=new r,this._names=new r,this._mappings=new n,this._sourcesContents=null}return i.prototype._version=3,i.fromSourceMap=function(e){var r=e.sourceRoot,n=new i({file:e.file,sourceRoot:r});return e.eachMapping((function(e){var i={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(i.source=e.source,null!=r&&(i.source=t.relative(r,i.source)),i.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(i.name=e.name)),n.addMapping(i)})),e.sources.forEach((function(i){var a=i;null!==r&&(a=t.relative(r,i)),n._sources.has(a)||n._sources.add(a);var s=e.sourceContentFor(i);null!=s&&n.setSourceContent(i,s)})),n},i.prototype.addMapping=function(e){var r=t.getArg(e,"generated"),n=t.getArg(e,"original",null),i=t.getArg(e,"source",null),a=t.getArg(e,"name",null);this._skipValidation||this._validateMapping(r,n,i,a),null!=i&&(i=String(i),this._sources.has(i)||this._sources.add(i)),null!=a&&(a=String(a),this._names.has(a)||this._names.add(a)),this._mappings.add({generatedLine:r.line,generatedColumn:r.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:i,name:a})},i.prototype.setSourceContent=function(e,r){var n=e;null!=this._sourceRoot&&(n=t.relative(this._sourceRoot,n)),null!=r?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[t.toSetString(n)]=r):this._sourcesContents&&(delete this._sourcesContents[t.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},i.prototype.applySourceMap=function(e,n,i){var a=n;if(null==n){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');a=e.file}var s=this._sourceRoot;null!=s&&(a=t.relative(s,a));var o=new r,l=new r;this._mappings.unsortedForEach((function(r){if(r.source===a&&null!=r.originalLine){var n=e.originalPositionFor({line:r.originalLine,column:r.originalColumn});null!=n.source&&(r.source=n.source,null!=i&&(r.source=t.join(i,r.source)),null!=s&&(r.source=t.relative(s,r.source)),r.originalLine=n.line,r.originalColumn=n.column,null!=n.name&&(r.name=n.name))}var u=r.source;null==u||o.has(u)||o.add(u);var c=r.name;null==c||l.has(c)||l.add(c)}),this),this._sources=o,this._names=l,e.sources.forEach((function(r){var n=e.sourceContentFor(r);null!=n&&(null!=i&&(r=t.join(i,r)),null!=s&&(r=t.relative(s,r)),this.setSourceContent(r,n))}),this)},i.prototype._validateMapping=function(e,t,r,n){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||r||n)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:n}))},i.prototype._serializeMappings=function(){for(var r,n,i,a,s=0,o=1,l=0,u=0,c=0,h=0,d="",p=this._mappings.toArray(),f=0,m=p.length;f<m;f++){if(r="",(n=p[f]).generatedLine!==o)for(s=0;n.generatedLine!==o;)r+=";",o++;else if(f>0){if(!t.compareByGeneratedPositionsInflated(n,p[f-1]))continue;r+=","}r+=e.encode(n.generatedColumn-s),s=n.generatedColumn,null!=n.source&&(a=this._sources.indexOf(n.source),r+=e.encode(a-h),h=a,r+=e.encode(n.originalLine-1-u),u=n.originalLine-1,r+=e.encode(n.originalColumn-l),l=n.originalColumn,null!=n.name&&(i=this._names.indexOf(n.name),r+=e.encode(i-c),c=i)),d+=r}return d},i.prototype._generateSourcesContent=function(e,r){return e.map((function(e){if(!this._sourcesContents)return null;null!=r&&(e=t.relative(r,e));var n=t.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null}),this)},i.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},i.prototype.toString=function(){return JSON.stringify(this.toJSON())},Je.SourceMapGenerator=i,Je}var ft,mt={},gt={};function _t(){return ft||(ft=1,function(e){function t(r,n,i,a,s,o){var l=Math.floor((n-r)/2)+r,u=s(i,a[l],!0);return 0===u?l:u>0?n-l>1?t(l,n,i,a,s,o):o==e.LEAST_UPPER_BOUND?n<a.length?n:-1:l:l-r>1?t(r,l,i,a,s,o):o==e.LEAST_UPPER_BOUND?l:r<0?-1:r}e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(r,n,i,a){if(0===n.length)return-1;var s=t(-1,n.length,r,n,i,a||e.GREATEST_LOWER_BOUND);if(s<0)return-1;for(;s-1>=0&&0===i(n[s],n[s-1],!0);)--s;return s}}(gt)),gt}var vt,yt,xt={};function bt(){if(vt)return xt;function e(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function t(r,n,i,a){if(i<a){var s=i-1;e(r,(c=i,h=a,Math.round(c+Math.random()*(h-c))),a);for(var o=r[a],l=i;l<a;l++)n(r[l],o)<=0&&e(r,s+=1,l);e(r,s+1,l);var u=s+1;t(r,n,i,u-1),t(r,n,u+1,a)}var c,h}return vt=1,xt.quickSort=function(e,r){t(e,r,0,e.length-1)},xt}var At,St,Et={};function wt(){return St||(St=1,Ze.SourceMapGenerator=pt().SourceMapGenerator,Ze.SourceMapConsumer=function(){if(yt)return mt;yt=1;var e=at(),t=_t(),r=lt().ArraySet,n=rt(),i=bt().quickSort;function a(t,r){var n=t;return"string"==typeof t&&(n=e.parseSourceMapInput(t)),null!=n.sections?new l(n,r):new s(n,r)}function s(t,n){var i=t;"string"==typeof t&&(i=e.parseSourceMapInput(t));var a=e.getArg(i,"version"),s=e.getArg(i,"sources"),o=e.getArg(i,"names",[]),l=e.getArg(i,"sourceRoot",null),u=e.getArg(i,"sourcesContent",null),c=e.getArg(i,"mappings"),h=e.getArg(i,"file",null);if(a!=this._version)throw new Error("Unsupported version: "+a);l&&(l=e.normalize(l)),s=s.map(String).map(e.normalize).map((function(t){return l&&e.isAbsolute(l)&&e.isAbsolute(t)?e.relative(l,t):t})),this._names=r.fromArray(o.map(String),!0),this._sources=r.fromArray(s,!0),this._absoluteSources=this._sources.toArray().map((function(t){return e.computeSourceURL(l,t,n)})),this.sourceRoot=l,this.sourcesContent=u,this._mappings=c,this._sourceMapURL=n,this.file=h}function o(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function l(t,n){var i=t;"string"==typeof t&&(i=e.parseSourceMapInput(t));var s=e.getArg(i,"version"),o=e.getArg(i,"sections");if(s!=this._version)throw new Error("Unsupported version: "+s);this._sources=new r,this._names=new r;var l={line:-1,column:0};this._sections=o.map((function(t){if(t.url)throw new Error("Support for url field in sections not implemented.");var r=e.getArg(t,"offset"),i=e.getArg(r,"line"),s=e.getArg(r,"column");if(i<l.line||i===l.line&&s<l.column)throw new Error("Section offsets must be ordered and non-overlapping.");return l=r,{generatedOffset:{generatedLine:i+1,generatedColumn:s+1},consumer:new a(e.getArg(t,"map"),n)}}))}return a.fromSourceMap=function(e,t){return s.fromSourceMap(e,t)},a.prototype._version=3,a.prototype.__generatedMappings=null,Object.defineProperty(a.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),a.prototype.__originalMappings=null,Object.defineProperty(a.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),a.prototype._charIsMappingSeparator=function(e,t){var r=e.charAt(t);return";"===r||","===r},a.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},a.GENERATED_ORDER=1,a.ORIGINAL_ORDER=2,a.GREATEST_LOWER_BOUND=1,a.LEAST_UPPER_BOUND=2,a.prototype.eachMapping=function(t,r,n){var i,s=r||null;switch(n||a.GENERATED_ORDER){case a.GENERATED_ORDER:i=this._generatedMappings;break;case a.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var o=this.sourceRoot;i.map((function(t){var r=null===t.source?null:this._sources.at(t.source);return{source:r=e.computeSourceURL(o,r,this._sourceMapURL),generatedLine:t.generatedLine,generatedColumn:t.generatedColumn,originalLine:t.originalLine,originalColumn:t.originalColumn,name:null===t.name?null:this._names.at(t.name)}}),this).forEach(t,s)},a.prototype.allGeneratedPositionsFor=function(r){var n=e.getArg(r,"line"),i={source:e.getArg(r,"source"),originalLine:n,originalColumn:e.getArg(r,"column",0)};if(i.source=this._findSourceIndex(i.source),i.source<0)return[];var a=[],s=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",e.compareByOriginalPositions,t.LEAST_UPPER_BOUND);if(s>=0){var o=this._originalMappings[s];if(void 0===r.column)for(var l=o.originalLine;o&&o.originalLine===l;)a.push({line:e.getArg(o,"generatedLine",null),column:e.getArg(o,"generatedColumn",null),lastColumn:e.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++s];else for(var u=o.originalColumn;o&&o.originalLine===n&&o.originalColumn==u;)a.push({line:e.getArg(o,"generatedLine",null),column:e.getArg(o,"generatedColumn",null),lastColumn:e.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++s]}return a},mt.SourceMapConsumer=a,s.prototype=Object.create(a.prototype),s.prototype.consumer=a,s.prototype._findSourceIndex=function(t){var r,n=t;if(null!=this.sourceRoot&&(n=e.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1},s.fromSourceMap=function(t,n){var a=Object.create(s.prototype),l=a._names=r.fromArray(t._names.toArray(),!0),u=a._sources=r.fromArray(t._sources.toArray(),!0);a.sourceRoot=t._sourceRoot,a.sourcesContent=t._generateSourcesContent(a._sources.toArray(),a.sourceRoot),a.file=t._file,a._sourceMapURL=n,a._absoluteSources=a._sources.toArray().map((function(t){return e.computeSourceURL(a.sourceRoot,t,n)}));for(var c=t._mappings.toArray().slice(),h=a.__generatedMappings=[],d=a.__originalMappings=[],p=0,f=c.length;p<f;p++){var m=c[p],g=new o;g.generatedLine=m.generatedLine,g.generatedColumn=m.generatedColumn,m.source&&(g.source=u.indexOf(m.source),g.originalLine=m.originalLine,g.originalColumn=m.originalColumn,m.name&&(g.name=l.indexOf(m.name)),d.push(g)),h.push(g)}return i(a.__originalMappings,e.compareByOriginalPositions),a},s.prototype._version=3,Object.defineProperty(s.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),s.prototype._parseMappings=function(t,r){for(var a,s,l,u,c,h=1,d=0,p=0,f=0,m=0,g=0,_=t.length,v=0,y={},x={},b=[],A=[];v<_;)if(";"===t.charAt(v))h++,v++,d=0;else if(","===t.charAt(v))v++;else{for((a=new o).generatedLine=h,u=v;u<_&&!this._charIsMappingSeparator(t,u);u++);if(l=y[s=t.slice(v,u)])v+=s.length;else{for(l=[];v<u;)n.decode(t,v,x),c=x.value,v=x.rest,l.push(c);if(2===l.length)throw new Error("Found a source, but no line and column");if(3===l.length)throw new Error("Found a source and line, but no column");y[s]=l}a.generatedColumn=d+l[0],d=a.generatedColumn,l.length>1&&(a.source=m+l[1],m+=l[1],a.originalLine=p+l[2],p=a.originalLine,a.originalLine+=1,a.originalColumn=f+l[3],f=a.originalColumn,l.length>4&&(a.name=g+l[4],g+=l[4])),A.push(a),"number"==typeof a.originalLine&&b.push(a)}i(A,e.compareByGeneratedPositionsDeflated),this.__generatedMappings=A,i(b,e.compareByOriginalPositions),this.__originalMappings=b},s.prototype._findMapping=function(e,r,n,i,a,s){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return t.search(e,r,a,s)},s.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var r=this._generatedMappings[e+1];if(t.generatedLine===r.generatedLine){t.lastGeneratedColumn=r.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},s.prototype.originalPositionFor=function(t){var r={generatedLine:e.getArg(t,"line"),generatedColumn:e.getArg(t,"column")},n=this._findMapping(r,this._generatedMappings,"generatedLine","generatedColumn",e.compareByGeneratedPositionsDeflated,e.getArg(t,"bias",a.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===r.generatedLine){var s=e.getArg(i,"source",null);null!==s&&(s=this._sources.at(s),s=e.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));var o=e.getArg(i,"name",null);return null!==o&&(o=this._names.at(o)),{source:s,line:e.getArg(i,"originalLine",null),column:e.getArg(i,"originalColumn",null),name:o}}}return{source:null,line:null,column:null,name:null}},s.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e}))},s.prototype.sourceContentFor=function(t,r){if(!this.sourcesContent)return null;var n=this._findSourceIndex(t);if(n>=0)return this.sourcesContent[n];var i,a=t;if(null!=this.sourceRoot&&(a=e.relative(this.sourceRoot,a)),null!=this.sourceRoot&&(i=e.urlParse(this.sourceRoot))){var s=a.replace(/^file:\/\//,"");if("file"==i.scheme&&this._sources.has(s))return this.sourcesContent[this._sources.indexOf(s)];if((!i.path||"/"==i.path)&&this._sources.has("/"+a))return this.sourcesContent[this._sources.indexOf("/"+a)]}if(r)return null;throw new Error('"'+a+'" is not in the SourceMap.')},s.prototype.generatedPositionFor=function(t){var r=e.getArg(t,"source");if((r=this._findSourceIndex(r))<0)return{line:null,column:null,lastColumn:null};var n={source:r,originalLine:e.getArg(t,"line"),originalColumn:e.getArg(t,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",e.compareByOriginalPositions,e.getArg(t,"bias",a.GREATEST_LOWER_BOUND));if(i>=0){var s=this._originalMappings[i];if(s.source===n.source)return{line:e.getArg(s,"generatedLine",null),column:e.getArg(s,"generatedColumn",null),lastColumn:e.getArg(s,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},mt.BasicSourceMapConsumer=s,l.prototype=Object.create(a.prototype),l.prototype.constructor=a,l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}}),l.prototype.originalPositionFor=function(r){var n={generatedLine:e.getArg(r,"line"),generatedColumn:e.getArg(r,"column")},i=t.search(n,this._sections,(function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn})),a=this._sections[i];return a?a.consumer.originalPositionFor({line:n.generatedLine-(a.generatedOffset.generatedLine-1),column:n.generatedColumn-(a.generatedOffset.generatedLine===n.generatedLine?a.generatedOffset.generatedColumn-1:0),bias:r.bias}):{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))},l.prototype.sourceContentFor=function(e,t){for(var r=0;r<this._sections.length;r++){var n=this._sections[r].consumer.sourceContentFor(e,!0);if(n)return n}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(t){for(var r=0;r<this._sections.length;r++){var n=this._sections[r];if(-1!==n.consumer._findSourceIndex(e.getArg(t,"source"))){var i=n.consumer.generatedPositionFor(t);if(i)return{line:i.line+(n.generatedOffset.generatedLine-1),column:i.column+(n.generatedOffset.generatedLine===i.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},l.prototype._parseMappings=function(t,r){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var a=this._sections[n],s=a.consumer._generatedMappings,o=0;o<s.length;o++){var l=s[o],u=a.consumer._sources.at(l.source);u=e.computeSourceURL(a.consumer.sourceRoot,u,this._sourceMapURL),this._sources.add(u),u=this._sources.indexOf(u);var c=null;l.name&&(c=a.consumer._names.at(l.name),this._names.add(c),c=this._names.indexOf(c));var h={source:u,generatedLine:l.generatedLine+(a.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(a.generatedOffset.generatedLine===l.generatedLine?a.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:c};this.__generatedMappings.push(h),"number"==typeof h.originalLine&&this.__originalMappings.push(h)}i(this.__generatedMappings,e.compareByGeneratedPositionsDeflated),i(this.__originalMappings,e.compareByOriginalPositions)},mt.IndexedSourceMapConsumer=l,mt}().SourceMapConsumer,Ze.SourceNode=function(){if(At)return Et;At=1;var e=pt().SourceMapGenerator,t=at(),r=/(\r?\n)/,n="$$$isSourceNode$$$";function i(e,t,r,i,a){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==a?null:a,this[n]=!0,null!=i&&this.add(i)}return i.fromStringWithSourceMap=function(e,n,a){var s=new i,o=e.split(r),l=0,u=function(){return e()+(e()||"");function e(){return l<o.length?o[l++]:void 0}},c=1,h=0,d=null;return n.eachMapping((function(e){if(null!==d){if(!(c<e.generatedLine)){var t=(r=o[l]||"").substr(0,e.generatedColumn-h);return o[l]=r.substr(e.generatedColumn-h),h=e.generatedColumn,p(d,t),void(d=e)}p(d,u()),c++,h=0}for(;c<e.generatedLine;)s.add(u()),c++;if(h<e.generatedColumn){var r=o[l]||"";s.add(r.substr(0,e.generatedColumn)),o[l]=r.substr(e.generatedColumn),h=e.generatedColumn}d=e}),this),l<o.length&&(d&&p(d,u()),s.add(o.splice(l).join(""))),n.sources.forEach((function(e){var r=n.sourceContentFor(e);null!=r&&(null!=a&&(e=t.join(a,e)),s.setSourceContent(e,r))})),s;function p(e,r){if(null===e||void 0===e.source)s.add(r);else{var n=a?t.join(a,e.source):e.source;s.add(new i(e.originalLine,e.originalColumn,n,r,e.name))}}},i.prototype.add=function(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[n]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},i.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[n]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},i.prototype.walk=function(e){for(var t,r=0,i=this.children.length;r<i;r++)(t=this.children[r])[n]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},i.prototype.join=function(e){var t,r,n=this.children.length;if(n>0){for(t=[],r=0;r<n-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this},i.prototype.replaceRight=function(e,t){var r=this.children[this.children.length-1];return r[n]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this},i.prototype.setSourceContent=function(e,r){this.sourceContents[t.toSetString(e)]=r},i.prototype.walkSourceContents=function(e){for(var r=0,i=this.children.length;r<i;r++)this.children[r][n]&&this.children[r].walkSourceContents(e);var a=Object.keys(this.sourceContents);for(r=0,i=a.length;r<i;r++)e(t.fromSetString(a[r]),this.sourceContents[a[r]])},i.prototype.toString=function(){var e="";return this.walk((function(t){e+=t})),e},i.prototype.toStringWithSourceMap=function(t){var r={code:"",line:1,column:0},n=new e(t),i=!1,a=null,s=null,o=null,l=null;return this.walk((function(e,t){r.code+=e,null!==t.source&&null!==t.line&&null!==t.column?(a===t.source&&s===t.line&&o===t.column&&l===t.name||n.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:r.line,column:r.column},name:t.name}),a=t.source,s=t.line,o=t.column,l=t.name,i=!0):i&&(n.addMapping({generated:{line:r.line,column:r.column}}),a=null,i=!1);for(var u=0,c=e.length;u<c;u++)10===e.charCodeAt(u)?(r.line++,r.column=0,u+1===c?(a=null,i=!1):i&&n.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:r.line,column:r.column},name:t.name})):r.column++})),this.walkSourceContents((function(e,t){n.setSourceContent(e,t)})),{code:r.code,map:n}},Et.SourceNode=i,Et}().SourceNode),Ze}var Ct="2.0.0";!function(e){!function(){var t,r,n,i,a,s,o,l,u,c,h,d,p,f,m,g,_,v,y,x,b,A,S,E,w,C;function T(e){return Z.Statement.hasOwnProperty(e.type)}s=Ve,t=(a=je).Syntax,n={"||":(r={Sequence:0,Yield:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Exponentiation:13,Await:14,Unary:14,Postfix:15,OptionalChaining:16,Call:17,New:18,TaggedTemplate:19,Member:20,Primary:21}).LogicalOR,"&&":r.LogicalAND,"|":r.BitwiseOR,"^":r.BitwiseXOR,"&":r.BitwiseAND,"==":r.Equality,"!=":r.Equality,"===":r.Equality,"!==":r.Equality,is:r.Equality,isnt:r.Equality,"<":r.Relational,">":r.Relational,"<=":r.Relational,">=":r.Relational,in:r.Relational,instanceof:r.Relational,"<<":r.BitwiseSHIFT,">>":r.BitwiseSHIFT,">>>":r.BitwiseSHIFT,"+":r.Additive,"-":r.Additive,"*":r.Multiplicative,"%":r.Multiplicative,"/":r.Multiplicative,"**":r.Exponentiation};var D=32,M=7,P=1,R=33;function N(e,t){var r="";for(t|=0;t>0;t>>>=1,e+=e)1&t&&(r+=e);return r}function B(e){var t=e.length;return t&&s.code.isLineTerminator(e.charCodeAt(t-1))}function I(e,t){var r;for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function O(e,t){var r,n;function i(e){return"object"==typeof e&&e instanceof Object&&!(e instanceof RegExp)}for(r in t)t.hasOwnProperty(r)&&(i(n=t[r])?i(e[r])?O(e[r],n):e[r]=O({},n):e[r]=n);return e}function k(e,t){return 8232==(-2&e)?(t?"u":"\\u")+(8232===e?"2028":"2029"):10===e||13===e?(t?"":"\\")+(10===e?"n":"r"):String.fromCharCode(e)}function L(e,t){var r;return 8===e?"\\b":12===e?"\\f":9===e?"\\t":(r=e.toString(16).toUpperCase(),u||e>255?"\\u"+"0000".slice(r.length)+r:0!==e||s.code.isDecimalDigit(t)?11===e?"\\x0B":"\\x"+"00".slice(r.length)+r:"\\0")}function U(e){if(92===e)return"\\\\";if(10===e)return"\\n";if(13===e)return"\\r";if(8232===e)return"\\u2028";if(8233===e)return"\\u2029";throw new Error("Incorrectly classified character")}function z(e){var t,r,n,i="";for(t=0,r=e.length;t<r;++t)n=e[t],i+=Array.isArray(n)?z(n):n;return i}function j(e,t){if(!A)return Array.isArray(e)?z(e):e;if(null==t){if(e instanceof i)return e;t={}}return null==t.loc?new i(null,null,A,e,t.name||null):new i(t.loc.start.line,t.loc.start.column,!0===A?t.loc.source||null:A,e,t.name||null)}function V(){return m||" "}function G(e,t){var r,n,i,a;return 0===(r=j(e).toString()).length?[t]:0===(n=j(t).toString()).length?[e]:(i=r.charCodeAt(r.length-1),a=n.charCodeAt(0),(43===i||45===i)&&i===a||s.code.isIdentifierPartES5(i)&&s.code.isIdentifierPartES5(a)||47===i&&105===a?[e,V(),t]:s.code.isWhiteSpace(i)||s.code.isLineTerminator(i)||s.code.isWhiteSpace(a)||s.code.isLineTerminator(a)?[e,t]:[e,m,t])}function W(e){return[o,e]}function H(e){var t;t=o,e(o+=l),o=t}function q(e,t){if("Line"===e.type){if(B(e.value))return"//"+e.value;var r="//"+e.value;return E||(r+="\n"),r}return x.format.indent.adjustMultilineComment&&/[\n\r]/.test(e.value)?function(e,t){var r,n,i,a,l,u,c,h;for(r=e.split(/\r\n|[\r\n]/),u=Number.MAX_VALUE,n=1,i=r.length;n<i;++n){for(a=r[n],l=0;l<a.length&&s.code.isWhiteSpace(a.charCodeAt(l));)++l;u>l&&(u=l)}for(void 0!==t?(c=o,"*"===r[1][u]&&(t+=" "),o=t):(1&u&&--u,c=o),n=1,i=r.length;n<i;++n)h=j(W(r[n].slice(u))),r[n]=A?h.join(""):h;return o=c,r.join("\n")}("/*"+e.value+"*/",t):"/*"+e.value+"*/"}function X(e,r){var n,i,a,u,c,h,d,p,f,m,g,_;if(e.leadingComments&&e.leadingComments.length>0){if(u=r,E){for(r=[],p=(a=e.leadingComments[0]).extendedRange,f=a.range,(_=((g=S.substring(p[0],f[0])).match(/\n/g)||[]).length)>0?(r.push(N("\n",_)),r.push(W(q(a)))):(r.push(g),r.push(q(a))),m=f,n=1,i=e.leadingComments.length;n<i;n++)f=(a=e.leadingComments[n]).range,_=(S.substring(m[1],f[0]).match(/\n/g)||[]).length,r.push(N("\n",_)),r.push(W(q(a))),m=f;_=(S.substring(f[1],p[1]).match(/\n/g)||[]).length,r.push(N("\n",_))}else for(a=e.leadingComments[0],r=[],v&&e.type===t.Program&&0===e.body.length&&r.push("\n"),r.push(q(a)),B(j(r).toString())||r.push("\n"),n=1,i=e.leadingComments.length;n<i;++n)B(j(d=[q(a=e.leadingComments[n])]).toString())||d.push("\n"),r.push(W(d));r.push(W(u))}if(e.trailingComments)if(E)p=(a=e.trailingComments[0]).extendedRange,f=a.range,(_=((g=S.substring(p[0],f[0])).match(/\n/g)||[]).length)>0?(r.push(N("\n",_)),r.push(W(q(a)))):(r.push(g),r.push(q(a)));else for(c=!B(j(r).toString()),h=N(" ",function(e){var t;for(t=e.length-1;t>=0&&!s.code.isLineTerminator(e.charCodeAt(t));--t);return e.length-1-t}(j([o,r,l]).toString())),n=0,i=e.trailingComments.length;n<i;++n)a=e.trailingComments[n],c?(r=0===n?[r,l]:[r,h]).push(q(a,h)):r=[r,W(q(a))],n===i-1||B(j(r).toString())||(r=[r,"\n"]);return r}function Q(e,t,r){var n,i=0;for(n=e;n<t;n++)"\n"===S[n]&&i++;for(n=1;n<i;n++)r.push(f)}function K(e,t,r){return t<r?["(",e,")"]:e}function Y(e){var t,r,n;for(t=1,r=(n=e.split(/\r\n|\n/)).length;t<r;t++)n[t]=f+o+n[t];return n}function Z(){}function J(e){return j(e.name,e)}function $(e,t){return e.async?"async"+(t?V():m):""}function ee(e){return e.generator&&!x.moz.starlessGenerator?"*"+m:""}function te(e){var t=e.value,r="";return t.async&&(r+=$(t,!e.computed)),t.generator&&(r+=ee(t)?"*":""),r}function re(e){var t;if(t=new Z,T(e))return t.generateStatement(e,P);if(function(e){return Z.Expression.hasOwnProperty(e.type)}(e))return t.generateExpression(e,r.Sequence,M);throw new Error("Unknown node type: "+e.type)}Z.prototype.maybeBlock=function(e,r){var n,i,a=this;return i=!x.comment||!e.leadingComments,e.type===t.BlockStatement&&i?[m,this.generateStatement(e,r)]:e.type===t.EmptyStatement&&i?";":(H((function(){n=[f,W(a.generateStatement(e,r))]})),n)},Z.prototype.maybeBlockSuffix=function(e,r){var n=B(j(r).toString());return e.type!==t.BlockStatement||x.comment&&e.leadingComments||n?n?[r,o]:[r,f,o]:[r,m]},Z.prototype.generatePattern=function(e,r,n){return e.type===t.Identifier?J(e):this.generateExpression(e,r,n)},Z.prototype.generateFunctionParams=function(e){var n,i,a,s;if(s=!1,e.type!==t.ArrowFunctionExpression||e.rest||e.defaults&&0!==e.defaults.length||1!==e.params.length||e.params[0].type!==t.Identifier){for((a=e.type===t.ArrowFunctionExpression?[$(e,!1)]:[]).push("("),e.defaults&&(s=!0),n=0,i=e.params.length;n<i;++n)s&&e.defaults[n]?a.push(this.generateAssignment(e.params[n],e.defaults[n],"=",r.Assignment,M)):a.push(this.generatePattern(e.params[n],r.Assignment,M)),n+1<i&&a.push(","+m);e.rest&&(e.params.length&&a.push(","+m),a.push("..."),a.push(J(e.rest))),a.push(")")}else a=[$(e,!0),J(e.params[0])];return a},Z.prototype.generateFunctionBody=function(e){var n,i;return n=this.generateFunctionParams(e),e.type===t.ArrowFunctionExpression&&(n.push(m),n.push("=>")),e.expression?(n.push(m),"{"===(i=this.generateExpression(e.body,r.Assignment,M)).toString().charAt(0)&&(i=["(",i,")"]),n.push(i)):n.push(this.maybeBlock(e.body,9)),n},Z.prototype.generateIterationForStatement=function(e,n,i){var a=["for"+(n.await?V()+"await":"")+m+"("],s=this;return H((function(){n.left.type===t.VariableDeclaration?H((function(){a.push(n.left.kind+V()),a.push(s.generateStatement(n.left.declarations[0],0))})):a.push(s.generateExpression(n.left,r.Call,M)),a=G(a,e),a=[G(a,s.generateExpression(n.right,r.Assignment,M)),")"]})),a.push(this.maybeBlock(n.body,i)),a},Z.prototype.generatePropertyKey=function(e,t){var n=[];return t&&n.push("["),n.push(this.generateExpression(e,r.Assignment,M)),t&&n.push("]"),n},Z.prototype.generateAssignment=function(e,t,n,i,a){return r.Assignment<i&&(a|=1),K([this.generateExpression(e,r.Call,a),m+n+m,this.generateExpression(t,r.Assignment,a)],r.Assignment,i)},Z.prototype.semicolon=function(e){return!_&&e&D?"":";"},Z.Statement={BlockStatement:function(e,t){var r,n,i=["{",f],a=this;return H((function(){var s,o,l,u;for(0===e.body.length&&E&&(r=e.range)[1]-r[0]>2&&("\n"===(n=S.substring(r[0]+1,r[1]-1))[0]&&(i=["{"]),i.push(n)),u=P,8&t&&(u|=16),s=0,o=e.body.length;s<o;++s)E&&(0===s&&(e.body[0].leadingComments&&(r=e.body[0].leadingComments[0].extendedRange,"\n"===(n=S.substring(r[0],r[1]))[0]&&(i=["{"])),e.body[0].leadingComments||Q(e.range[0],e.body[0].range[0],i)),s>0&&(e.body[s-1].trailingComments||e.body[s].leadingComments||Q(e.body[s-1].range[1],e.body[s].range[0],i))),s===o-1&&(u|=D),l=e.body[s].leadingComments&&E?a.generateStatement(e.body[s],u):W(a.generateStatement(e.body[s],u)),i.push(l),B(j(l).toString())||E&&s<o-1&&e.body[s+1].leadingComments||i.push(f),E&&s===o-1&&(e.body[s].trailingComments||Q(e.body[s].range[1],e.range[1],i))})),i.push(W("}")),i},BreakStatement:function(e,t){return e.label?"break "+e.label.name+this.semicolon(t):"break"+this.semicolon(t)},ContinueStatement:function(e,t){return e.label?"continue "+e.label.name+this.semicolon(t):"continue"+this.semicolon(t)},ClassBody:function(e,t){var n=["{",f],i=this;return H((function(t){var a,s;for(a=0,s=e.body.length;a<s;++a)n.push(t),n.push(i.generateExpression(e.body[a],r.Sequence,M)),a+1<s&&n.push(f)})),B(j(n).toString())||n.push(f),n.push(o),n.push("}"),n},ClassDeclaration:function(e,t){var n,i;return n=["class"],e.id&&(n=G(n,this.generateExpression(e.id,r.Sequence,M))),e.superClass&&(i=G("extends",this.generateExpression(e.superClass,r.Unary,M)),n=G(n,i)),n.push(m),n.push(this.generateStatement(e.body,R)),n},DirectiveStatement:function(e,t){return x.raw&&e.raw?e.raw+this.semicolon(t):function(e){var t,r,n,i;for(i="double"===d?'"':"'",t=0,r=e.length;t<r;++t){if(39===(n=e.charCodeAt(t))){i='"';break}if(34===n){i="'";break}92===n&&++t}return i+e+i}(e.directive)+this.semicolon(t)},DoWhileStatement:function(e,t){var n=G("do",this.maybeBlock(e.body,P));return G(n=this.maybeBlockSuffix(e.body,n),["while"+m+"(",this.generateExpression(e.test,r.Sequence,M),")"+this.semicolon(t)])},CatchClause:function(e,t){var n,i=this;return H((function(){var t;e.param?(n=["catch"+m+"(",i.generateExpression(e.param,r.Sequence,M),")"],e.guard&&(t=i.generateExpression(e.guard,r.Sequence,M),n.splice(2,0," if ",t))):n=["catch"]})),n.push(this.maybeBlock(e.body,P)),n},DebuggerStatement:function(e,t){return"debugger"+this.semicolon(t)},EmptyStatement:function(e,t){return";"},ExportDefaultDeclaration:function(e,t){var n,i=["export"];return n=t&D?R:P,i=G(i,"default"),i=T(e.declaration)?G(i,this.generateStatement(e.declaration,n)):G(i,this.generateExpression(e.declaration,r.Assignment,M)+this.semicolon(t))},ExportNamedDeclaration:function(e,n){var i,a=["export"],s=this;return i=n&D?R:P,e.declaration?G(a,this.generateStatement(e.declaration,i)):(e.specifiers&&(0===e.specifiers.length?a=G(a,"{"+m+"}"):e.specifiers[0].type===t.ExportBatchSpecifier?a=G(a,this.generateExpression(e.specifiers[0],r.Sequence,M)):(a=G(a,"{"),H((function(t){var n,i;for(a.push(f),n=0,i=e.specifiers.length;n<i;++n)a.push(t),a.push(s.generateExpression(e.specifiers[n],r.Sequence,M)),n+1<i&&a.push(","+f)})),B(j(a).toString())||a.push(f),a.push(o+"}")),e.source?a=G(a,["from"+m,this.generateExpression(e.source,r.Sequence,M),this.semicolon(n)]):a.push(this.semicolon(n))),a)},ExportAllDeclaration:function(e,t){return["export"+m,"*"+m,"from"+m,this.generateExpression(e.source,r.Sequence,M),this.semicolon(t)]},ExpressionStatement:function(e,n){var i,a;return 123===(a=j(i=[this.generateExpression(e.expression,r.Sequence,M)]).toString()).charCodeAt(0)||function(e){var t;return"class"===e.slice(0,5)&&(123===(t=e.charCodeAt(5))||s.code.isWhiteSpace(t)||s.code.isLineTerminator(t))}(a)||function(e){var t;return"function"===e.slice(0,8)&&(40===(t=e.charCodeAt(8))||s.code.isWhiteSpace(t)||42===t||s.code.isLineTerminator(t))}(a)||function(e){var t,r,n;if("async"!==e.slice(0,5))return!1;if(!s.code.isWhiteSpace(e.charCodeAt(5)))return!1;for(r=6,n=e.length;r<n&&s.code.isWhiteSpace(e.charCodeAt(r));++r);return r!==n&&("function"===e.slice(r,r+8)&&(40===(t=e.charCodeAt(r+8))||s.code.isWhiteSpace(t)||42===t||s.code.isLineTerminator(t)))}(a)||y&&16&n&&e.expression.type===t.Literal&&"string"==typeof e.expression.value?i=["(",i,")"+this.semicolon(n)]:i.push(this.semicolon(n)),i},ImportDeclaration:function(e,n){var i,a,s=this;return 0===e.specifiers.length?["import",m,this.generateExpression(e.source,r.Sequence,M),this.semicolon(n)]:(i=["import"],a=0,e.specifiers[a].type===t.ImportDefaultSpecifier&&(i=G(i,[this.generateExpression(e.specifiers[a],r.Sequence,M)]),++a),e.specifiers[a]&&(0!==a&&i.push(","),e.specifiers[a].type===t.ImportNamespaceSpecifier?i=G(i,[m,this.generateExpression(e.specifiers[a],r.Sequence,M)]):(i.push(m+"{"),e.specifiers.length-a==1?(i.push(m),i.push(this.generateExpression(e.specifiers[a],r.Sequence,M)),i.push(m+"}"+m)):(H((function(t){var n,o;for(i.push(f),n=a,o=e.specifiers.length;n<o;++n)i.push(t),i.push(s.generateExpression(e.specifiers[n],r.Sequence,M)),n+1<o&&i.push(","+f)})),B(j(i).toString())||i.push(f),i.push(o+"}"+m)))),i=G(i,["from"+m,this.generateExpression(e.source,r.Sequence,M),this.semicolon(n)]))},VariableDeclarator:function(e,t){var n=1&t?M:6;return e.init?[this.generateExpression(e.id,r.Assignment,n),m,"=",m,this.generateExpression(e.init,r.Assignment,n)]:this.generatePattern(e.id,r.Assignment,n)},VariableDeclaration:function(e,t){var r,n,i,a,s,o=this;function l(){for(a=e.declarations[0],x.comment&&a.leadingComments?(r.push("\n"),r.push(W(o.generateStatement(a,s)))):(r.push(V()),r.push(o.generateStatement(a,s))),n=1,i=e.declarations.length;n<i;++n)a=e.declarations[n],x.comment&&a.leadingComments?(r.push(","+f),r.push(W(o.generateStatement(a,s)))):(r.push(","+m),r.push(o.generateStatement(a,s)))}return r=[e.kind],s=1&t?P:0,e.declarations.length>1?H(l):l(),r.push(this.semicolon(t)),r},ThrowStatement:function(e,t){return[G("throw",this.generateExpression(e.argument,r.Sequence,M)),this.semicolon(t)]},TryStatement:function(e,t){var r,n,i,a;if(r=["try",this.maybeBlock(e.block,P)],r=this.maybeBlockSuffix(e.block,r),e.handlers)for(n=0,i=e.handlers.length;n<i;++n)r=G(r,this.generateStatement(e.handlers[n],P)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(e.handlers[n].body,r));else{for(n=0,i=(a=e.guardedHandlers||[]).length;n<i;++n)r=G(r,this.generateStatement(a[n],P)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(a[n].body,r));if(e.handler)if(Array.isArray(e.handler))for(n=0,i=e.handler.length;n<i;++n)r=G(r,this.generateStatement(e.handler[n],P)),(e.finalizer||n+1!==i)&&(r=this.maybeBlockSuffix(e.handler[n].body,r));else r=G(r,this.generateStatement(e.handler,P)),e.finalizer&&(r=this.maybeBlockSuffix(e.handler.body,r))}return e.finalizer&&(r=G(r,["finally",this.maybeBlock(e.finalizer,P)])),r},SwitchStatement:function(e,t){var n,i,a,s,o,l=this;if(H((function(){n=["switch"+m+"(",l.generateExpression(e.discriminant,r.Sequence,M),")"+m+"{"+f]})),e.cases)for(o=P,a=0,s=e.cases.length;a<s;++a)a===s-1&&(o|=D),i=W(this.generateStatement(e.cases[a],o)),n.push(i),B(j(i).toString())||n.push(f);return n.push(W("}")),n},SwitchCase:function(e,n){var i,a,s,o,l,u=this;return H((function(){for(i=e.test?[G("case",u.generateExpression(e.test,r.Sequence,M)),":"]:["default:"],s=0,(o=e.consequent.length)&&e.consequent[0].type===t.BlockStatement&&(a=u.maybeBlock(e.consequent[0],P),i.push(a),s=1),s===o||B(j(i).toString())||i.push(f),l=P;s<o;++s)s===o-1&&n&D&&(l|=D),a=W(u.generateStatement(e.consequent[s],l)),i.push(a),s+1===o||B(j(a).toString())||i.push(f)})),i},IfStatement:function(e,n){var i,a,s=this;return H((function(){i=["if"+m+"(",s.generateExpression(e.test,r.Sequence,M),")"]})),a=P,n&D&&(a|=D),e.alternate?(i.push(this.maybeBlock(e.consequent,P)),i=this.maybeBlockSuffix(e.consequent,i),i=e.alternate.type===t.IfStatement?G(i,["else ",this.generateStatement(e.alternate,a)]):G(i,G("else",this.maybeBlock(e.alternate,a)))):i.push(this.maybeBlock(e.consequent,a)),i},ForStatement:function(e,n){var i,a=this;return H((function(){i=["for"+m+"("],e.init?e.init.type===t.VariableDeclaration?i.push(a.generateStatement(e.init,0)):(i.push(a.generateExpression(e.init,r.Sequence,6)),i.push(";")):i.push(";"),e.test?(i.push(m),i.push(a.generateExpression(e.test,r.Sequence,M)),i.push(";")):i.push(";"),e.update?(i.push(m),i.push(a.generateExpression(e.update,r.Sequence,M)),i.push(")")):i.push(")")})),i.push(this.maybeBlock(e.body,n&D?R:P)),i},ForInStatement:function(e,t){return this.generateIterationForStatement("in",e,t&D?R:P)},ForOfStatement:function(e,t){return this.generateIterationForStatement("of",e,t&D?R:P)},LabeledStatement:function(e,t){return[e.label.name+":",this.maybeBlock(e.body,t&D?R:P)]},Program:function(e,t){var r,n,i,a,s;for(a=e.body.length,r=[v&&a>0?"\n":""],s=17,i=0;i<a;++i)v||i!==a-1||(s|=D),E&&(0===i&&(e.body[0].leadingComments||Q(e.range[0],e.body[i].range[0],r)),i>0&&(e.body[i-1].trailingComments||e.body[i].leadingComments||Q(e.body[i-1].range[1],e.body[i].range[0],r))),n=W(this.generateStatement(e.body[i],s)),r.push(n),i+1<a&&!B(j(n).toString())&&(E&&e.body[i+1].leadingComments||r.push(f)),E&&i===a-1&&(e.body[i].trailingComments||Q(e.body[i].range[1],e.range[1],r));return r},FunctionDeclaration:function(e,t){return[$(e,!0),"function",ee(e)||V(),e.id?J(e.id):"",this.generateFunctionBody(e)]},ReturnStatement:function(e,t){return e.argument?[G("return",this.generateExpression(e.argument,r.Sequence,M)),this.semicolon(t)]:["return"+this.semicolon(t)]},WhileStatement:function(e,t){var n,i=this;return H((function(){n=["while"+m+"(",i.generateExpression(e.test,r.Sequence,M),")"]})),n.push(this.maybeBlock(e.body,t&D?R:P)),n},WithStatement:function(e,t){var n,i=this;return H((function(){n=["with"+m+"(",i.generateExpression(e.object,r.Sequence,M),")"]})),n.push(this.maybeBlock(e.body,t&D?R:P)),n}},I(Z.prototype,Z.Statement),Z.Expression={SequenceExpression:function(e,t,n){var i,a,s;for(r.Sequence<t&&(n|=1),i=[],a=0,s=e.expressions.length;a<s;++a)i.push(this.generateExpression(e.expressions[a],r.Assignment,n)),a+1<s&&i.push(","+m);return K(i,r.Sequence,t)},AssignmentExpression:function(e,t,r){return this.generateAssignment(e.left,e.right,e.operator,t,r)},ArrowFunctionExpression:function(e,t,n){return K(this.generateFunctionBody(e),r.ArrowFunction,t)},ConditionalExpression:function(e,t,n){return r.Conditional<t&&(n|=1),K([this.generateExpression(e.test,r.LogicalOR,n),m+"?"+m,this.generateExpression(e.consequent,r.Assignment,n),m+":"+m,this.generateExpression(e.alternate,r.Assignment,n)],r.Conditional,t)},LogicalExpression:function(e,t,r){return this.BinaryExpression(e,t,r)},BinaryExpression:function(e,t,i){var a,o,l,u,c,h;return u=n[e.operator],o="**"===e.operator?r.Postfix:u,l="**"===e.operator?u:u+1,u<t&&(i|=1),a=47===(h=(c=this.generateExpression(e.left,o,i)).toString()).charCodeAt(h.length-1)&&s.code.isIdentifierPartES5(e.operator.charCodeAt(0))?[c,V(),e.operator]:G(c,e.operator),c=this.generateExpression(e.right,l,i),"/"===e.operator&&"/"===c.toString().charAt(0)||"<"===e.operator.slice(-1)&&"!--"===c.toString().slice(0,3)?(a.push(V()),a.push(c)):a=G(a,c),"in"!==e.operator||1&i?K(a,u,t):["(",a,")"]},CallExpression:function(e,t,n){var i,a,s;for(i=[this.generateExpression(e.callee,r.Call,3)],e.optional&&i.push("?."),i.push("("),a=0,s=e.arguments.length;a<s;++a)i.push(this.generateExpression(e.arguments[a],r.Assignment,M)),a+1<s&&i.push(","+m);return i.push(")"),2&n?K(i,r.Call,t):["(",i,")"]},ChainExpression:function(e,t,n){return r.OptionalChaining<t&&(n|=2),K(this.generateExpression(e.expression,r.OptionalChaining,n),r.OptionalChaining,t)},NewExpression:function(e,t,n){var i,a,s,o,l;if(a=e.arguments.length,l=4&n&&!g&&0===a?5:1,i=G("new",this.generateExpression(e.callee,r.New,l)),!(4&n)||g||a>0){for(i.push("("),s=0,o=a;s<o;++s)i.push(this.generateExpression(e.arguments[s],r.Assignment,M)),s+1<o&&i.push(","+m);i.push(")")}return K(i,r.New,t)},MemberExpression:function(e,n,i){var a,o;return a=[this.generateExpression(e.object,r.Call,2&i?3:1)],e.computed?(e.optional&&a.push("?."),a.push("["),a.push(this.generateExpression(e.property,r.Sequence,2&i?M:5)),a.push("]")):(e.optional||e.object.type!==t.Literal||"number"!=typeof e.object.value||(o=j(a).toString()).indexOf(".")<0&&!/[eExX]/.test(o)&&s.code.isDecimalDigit(o.charCodeAt(o.length-1))&&!(o.length>=2&&48===o.charCodeAt(0))&&a.push(" "),a.push(e.optional?"?.":"."),a.push(J(e.property))),K(a,r.Member,n)},MetaProperty:function(e,t,n){var i;return(i=[]).push("string"==typeof e.meta?e.meta:J(e.meta)),i.push("."),i.push("string"==typeof e.property?e.property:J(e.property)),K(i,r.Member,t)},UnaryExpression:function(e,t,n){var i,a,o,l,u;return a=this.generateExpression(e.argument,r.Unary,M),""===m?i=G(e.operator,a):(i=[e.operator],e.operator.length>2?i=G(i,a):(u=(l=j(i).toString()).charCodeAt(l.length-1),o=a.toString().charCodeAt(0),(43===u||45===u)&&u===o||s.code.isIdentifierPartES5(u)&&s.code.isIdentifierPartES5(o)?(i.push(V()),i.push(a)):i.push(a))),K(i,r.Unary,t)},YieldExpression:function(e,t,n){var i;return i=e.delegate?"yield*":"yield",e.argument&&(i=G(i,this.generateExpression(e.argument,r.Yield,M))),K(i,r.Yield,t)},AwaitExpression:function(e,t,n){return K(G(e.all?"await*":"await",this.generateExpression(e.argument,r.Await,M)),r.Await,t)},UpdateExpression:function(e,t,n){return e.prefix?K([e.operator,this.generateExpression(e.argument,r.Unary,M)],r.Unary,t):K([this.generateExpression(e.argument,r.Postfix,M),e.operator],r.Postfix,t)},FunctionExpression:function(e,t,r){var n=[$(e,!0),"function"];return e.id?(n.push(ee(e)||V()),n.push(J(e.id))):n.push(ee(e)||m),n.push(this.generateFunctionBody(e)),n},ArrayPattern:function(e,t,r){return this.ArrayExpression(e,t,r,!0)},ArrayExpression:function(e,t,n,i){var a,s,l=this;return e.elements.length?(s=!i&&e.elements.length>1,a=["[",s?f:""],H((function(t){var n,i;for(n=0,i=e.elements.length;n<i;++n)e.elements[n]?(a.push(s?t:""),a.push(l.generateExpression(e.elements[n],r.Assignment,M))):(s&&a.push(t),n+1===i&&a.push(",")),n+1<i&&a.push(","+(s?f:m))})),s&&!B(j(a).toString())&&a.push(f),a.push(s?o:""),a.push("]"),a):"[]"},RestElement:function(e,t,r){return"..."+this.generatePattern(e.argument)},ClassExpression:function(e,t,n){var i,a;return i=["class"],e.id&&(i=G(i,this.generateExpression(e.id,r.Sequence,M))),e.superClass&&(a=G("extends",this.generateExpression(e.superClass,r.Unary,M)),i=G(i,a)),i.push(m),i.push(this.generateStatement(e.body,R)),i},MethodDefinition:function(e,t,r){var n,i;return n=e.static?["static"+m]:[],i="get"===e.kind||"set"===e.kind?[G(e.kind,this.generatePropertyKey(e.key,e.computed)),this.generateFunctionBody(e.value)]:[te(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)],G(n,i)},Property:function(e,t,n){return"get"===e.kind||"set"===e.kind?[e.kind,V(),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:e.shorthand?"AssignmentPattern"===e.value.type?this.AssignmentPattern(e.value,r.Sequence,M):this.generatePropertyKey(e.key,e.computed):e.method?[te(e),this.generatePropertyKey(e.key,e.computed),this.generateFunctionBody(e.value)]:[this.generatePropertyKey(e.key,e.computed),":"+m,this.generateExpression(e.value,r.Assignment,M)]},ObjectExpression:function(e,t,n){var i,a,s,l=this;return e.properties.length?(i=e.properties.length>1,H((function(){s=l.generateExpression(e.properties[0],r.Sequence,M)})),i||function(e){return/[\r\n]/g.test(e)}(j(s).toString())?(H((function(t){var n,o;if(a=["{",f,t,s],i)for(a.push(","+f),n=1,o=e.properties.length;n<o;++n)a.push(t),a.push(l.generateExpression(e.properties[n],r.Sequence,M)),n+1<o&&a.push(","+f)})),B(j(a).toString())||a.push(f),a.push(o),a.push("}"),a):["{",m,s,m,"}"]):"{}"},AssignmentPattern:function(e,t,r){return this.generateAssignment(e.left,e.right,"=",t,r)},ObjectPattern:function(e,n,i){var a,s,l,u,c,h=this;if(!e.properties.length)return"{}";if(u=!1,1===e.properties.length)(c=e.properties[0]).type===t.Property&&c.value.type!==t.Identifier&&(u=!0);else for(s=0,l=e.properties.length;s<l;++s)if((c=e.properties[s]).type===t.Property&&!c.shorthand){u=!0;break}return a=["{",u?f:""],H((function(t){var n,i;for(n=0,i=e.properties.length;n<i;++n)a.push(u?t:""),a.push(h.generateExpression(e.properties[n],r.Sequence,M)),n+1<i&&a.push(","+(u?f:m))})),u&&!B(j(a).toString())&&a.push(f),a.push(u?o:""),a.push("}"),a},ThisExpression:function(e,t,r){return"this"},Super:function(e,t,r){return"super"},Identifier:function(e,t,r){return J(e)},ImportDefaultSpecifier:function(e,t,r){return J(e.id||e.local)},ImportNamespaceSpecifier:function(e,t,r){var n=["*"],i=e.id||e.local;return i&&n.push(m+"as"+V()+J(i)),n},ImportSpecifier:function(e,t,r){var n=e.imported,i=[n.name],a=e.local;return a&&a.name!==n.name&&i.push(V()+"as"+V()+J(a)),i},ExportSpecifier:function(e,t,r){var n=e.local,i=[n.name],a=e.exported;return a&&a.name!==n.name&&i.push(V()+"as"+V()+J(a)),i},Literal:function(e,r,n){var i;if(e.hasOwnProperty("raw")&&b&&x.raw)try{if((i=b(e.raw).body[0].expression).type===t.Literal&&i.value===e.value)return e.raw}catch(e){}return e.regex?"/"+e.regex.pattern+"/"+e.regex.flags:null===e.value?"null":"string"==typeof e.value?function(e){var t,r,n,i,a,o="",l=0,c=0;for(t=0,r=e.length;t<r;++t){if(39===(n=e.charCodeAt(t)))++l;else if(34===n)++c;else if(47===n&&u)o+="\\";else{if(s.code.isLineTerminator(n)||92===n){o+=U(n);continue}if(!s.code.isIdentifierPartES5(n)&&(u&&n<32||!u&&!p&&(n<32||n>126))){o+=L(n,e.charCodeAt(t+1));continue}}o+=String.fromCharCode(n)}if(a=(i=!("double"===d||"auto"===d&&c<l))?"'":'"',!(i?l:c))return a+o+a;for(e=o,o=a,t=0,r=e.length;t<r;++t)(39===(n=e.charCodeAt(t))&&i||34===n&&!i)&&(o+="\\"),o+=String.fromCharCode(n);return o+a}(e.value):"number"==typeof e.value?function(e){var t,r,n,i,a;if(e!=e)throw new Error("Numeric literal whose value is NaN");if(e<0||0===e&&1/e<0)throw new Error("Numeric literal whose value is negative");if(e===1/0)return u?"null":c?"1e400":"1e+400";if(t=""+e,!c||t.length<3)return t;for(r=t.indexOf("."),u||48!==t.charCodeAt(0)||1!==r||(r=0,t=t.slice(1)),n=t,t=t.replace("e+","e"),i=0,(a=n.indexOf("e"))>0&&(i=+n.slice(a+1),n=n.slice(0,a)),r>=0&&(i-=n.length-r-1,n=+(n.slice(0,r)+n.slice(r+1))+""),a=0;48===n.charCodeAt(n.length+a-1);)--a;return 0!==a&&(i-=a,n=n.slice(0,a)),0!==i&&(n+="e"+i),(n.length<t.length||h&&e>1e12&&Math.floor(e)===e&&(n="0x"+e.toString(16)).length<t.length)&&+n===e&&(t=n),t}(e.value):"boolean"==typeof e.value?e.value?"true":"false":function(e){var t,r,n,i,a,s,o,l;if(r=e.toString(),e.source){if(!(t=r.match(/\/([^/]*)$/)))return r;for(n=t[1],r="",o=!1,l=!1,i=0,a=e.source.length;i<a;++i)s=e.source.charCodeAt(i),l?(r+=k(s,l),l=!1):(o?93===s&&(o=!1):47===s?r+="\\":91===s&&(o=!0),r+=k(s,l),l=92===s);return"/"+r+"/"+n}return r}(e.value)},GeneratorExpression:function(e,t,r){return this.ComprehensionExpression(e,t,r)},ComprehensionExpression:function(e,n,i){var a,s,o,l,u=this;return a=e.type===t.GeneratorExpression?["("]:["["],x.moz.comprehensionExpressionStartsWithAssignment&&(l=this.generateExpression(e.body,r.Assignment,M),a.push(l)),e.blocks&&H((function(){for(s=0,o=e.blocks.length;s<o;++s)l=u.generateExpression(e.blocks[s],r.Sequence,M),s>0||x.moz.comprehensionExpressionStartsWithAssignment?a=G(a,l):a.push(l)})),e.filter&&(a=G(a,"if"+m),l=this.generateExpression(e.filter,r.Sequence,M),a=G(a,["(",l,")"])),x.moz.comprehensionExpressionStartsWithAssignment||(l=this.generateExpression(e.body,r.Assignment,M),a=G(a,l)),a.push(e.type===t.GeneratorExpression?")":"]"),a},ComprehensionBlock:function(e,n,i){var a;return a=G(a=e.left.type===t.VariableDeclaration?[e.left.kind,V(),this.generateStatement(e.left.declarations[0],0)]:this.generateExpression(e.left,r.Call,M),e.of?"of":"in"),a=G(a,this.generateExpression(e.right,r.Sequence,M)),["for"+m+"(",a,")"]},SpreadElement:function(e,t,n){return["...",this.generateExpression(e.argument,r.Assignment,M)]},TaggedTemplateExpression:function(e,t,n){var i=3;return 2&n||(i=1),K([this.generateExpression(e.tag,r.Call,i),this.generateExpression(e.quasi,r.Primary,4)],r.TaggedTemplate,t)},TemplateElement:function(e,t,r){return e.value.raw},TemplateLiteral:function(e,t,n){var i,a,s;for(i=["`"],a=0,s=e.quasis.length;a<s;++a)i.push(this.generateExpression(e.quasis[a],r.Primary,M)),a+1<s&&(i.push("${"+m),i.push(this.generateExpression(e.expressions[a],r.Sequence,M)),i.push(m+"}"));return i.push("`"),i},ModuleSpecifier:function(e,t,r){return this.Literal(e,t,r)},ImportExpression:function(e,t,n){return K(["import(",this.generateExpression(e.source,r.Assignment,M),")"],r.Call,t)}},I(Z.prototype,Z.Expression),Z.prototype.generateExpression=function(e,n,i){var a,s;return s=e.type||t.Property,x.verbatim&&e.hasOwnProperty(x.verbatim)?function(e,t){var n;return j("string"==typeof(n=e[x.verbatim])?K(Y(n),r.Sequence,t):K(Y(n.content),null!=n.precedence?n.precedence:r.Sequence,t),e)}(e,n):(a=this[s](e,n,i),x.comment&&(a=X(e,a)),j(a,e))},Z.prototype.generateStatement=function(e,r){var n,i;return n=this[e.type](e,r),x.comment&&(n=X(e,n)),i=j(n).toString(),e.type!==t.Program||v||""!==f||"\n"!==i.charAt(i.length-1)||(n=A?j(n).replaceRight(/\s+$/,""):i.replace(/\s+$/,"")),j(n,e)},w={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},C={indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},e.version=Ct,e.generate=function(t,r){var n,a,s={indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:"\n",space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null};return null!=r?("string"==typeof r.indent&&(s.format.indent.style=r.indent),"number"==typeof r.base&&(s.format.indent.base=r.base),r=O(s,r),l=r.format.indent.style,o="string"==typeof r.base?r.base:N(l,r.format.indent.base)):(l=(r=s).format.indent.style,o=N(l,r.format.indent.base)),u=r.format.json,c=r.format.renumber,h=!u&&r.format.hexadecimal,d=u?"double":r.format.quotes,p=r.format.escapeless,f=r.format.newline,m=r.format.space,r.format.compact&&(f=m=l=o=""),g=r.format.parentheses,_=r.format.semicolons,v=r.format.safeConcatenation,y=r.directive,b=u?null:r.parse,A=r.sourceMap,S=r.sourceCode,E=r.format.preserveBlankLines&&null!==S,x=r,A&&(i=e.browser?F.sourceMap.SourceNode:wt().SourceNode),n=re(t),A?(a=n.toStringWithSourceMap({file:r.file,sourceRoot:r.sourceMapRoot}),r.sourceContent&&a.map.setSourceContent(r.sourceMap,r.sourceContent),r.sourceMapWithCode?a:a.map.toString()):(a={code:n.toString(),map:null},r.sourceMapWithCode?a:a.code)},e.attachComments=a.attachComments,e.Precedence=O({},r),e.browser=!1,e.FORMAT_MINIFY=w,e.FORMAT_DEFAULTS=C}()}(ze);var Tt={},Dt={},Mt=[],Pt=function(e,t,r){t||(t=Dt);var n=function e(n,i){switch(n.type){case"Literal":return r?r(n.raw):n.value;case"UnaryExpression":var a=e(n.argument);switch(n.operator){case"+":return+a;case"-":return-a;case"~":return~a;case"!":return!a;default:return Tt}case"ArrayExpression":for(var s=[],o=0,l=n.elements.length;o<l;o++){if((m=e(n.elements[o]))===Tt)return Tt;s.push(m)}return s;case"ObjectExpression":var u={};for(o=0;o<n.properties.length;o++){var c=null===(g=n.properties[o]).value?g.value:e(g.value);if(c===Tt)return Tt;u[g.key.value||g.key.name]=c}return u;case"BinaryExpression":case"LogicalExpression":if((l=e(n.left))===Tt)return Tt;var h=e(n.right);if(h===Tt)return Tt;switch(n.operator){case"==":return""===l&&0===h||""===h&&0===l?Tt:l==h;case"===":return l===h;case"!=":return l!=h;case"!==":return l!==h;case"+":return l+h;case"-":return l-h;case"*":return l*h;case"/":return l/h;case"%":return l%h;case"<":return l<h;case"<=":return l<=h;case">":return l>h;case">=":return l>=h;case"|":return l|h;case"&":return l&h;case"^":return l^h;case"&&":return l&&h;case"||":return l||h}return Tt;case"Identifier":return t instanceof Set?t.has(n.name):void 0!==t[n.name]?t[n.name]:Tt;case"ThisExpression":return void 0!==t.this?t.this:Tt;case"CallExpression":var d=e(n.callee);if(d===Tt)return Tt;if("function"!=typeof d)return Tt;var p=n.callee.object?e(n.callee.object):Tt;p===Tt&&(p=null),Mt.length=0;var f=Mt;for(o=0,l=n.arguments.length;o<l;o++){var m;if((m=e(n.arguments[o]))===Tt)return Tt;f.push(m)}return d.apply(p,f);case"MemberExpression":var g;return(u=e(n.object))===Tt||"function"==typeof u?Tt:"Identifier"===n.property.type?u[n.property.name]:(g=e(n.property))===Tt?Tt:u[g];case"ConditionalExpression":return(a=e(n.test))===Tt?Tt:e(a?n.consequent:n.alternate);case"ExpressionStatement":return(a=e(n.expression))===Tt?Tt:a;case"ReturnStatement":return e(n.argument);case"FunctionExpression":var _=n.body.body,v={};Object.keys(t).forEach((function(e){v[e]=t[e]}));for(o=0;o<n.params.length;o++){var y=n.params[o];if("Identifier"!=y.type)return Tt;t[y.name]=null}for(var o in _)if(e(_[o])===Tt)return Tt;t=v;var x=Object.keys(t),b=x.map((function(e){return t[e]}));return Function(x.join(", "),"return "+ze.generate(n)).apply(null,b);case"TemplateLiteral":var A="";for(o=0;o<n.expressions.length;o++)A+=e(n.quasis[o]),A+=e(n.expressions[o]);return A+=e(n.quasis[o]);case"TaggedTemplateExpression":var S=e(n.tag),E=n.quasi,w=E.quasis.map(e),C=E.expressions.map(e);return S.apply(null,[w].concat(C));case"TemplateElement":return n.value.cooked;default:return Tt}}(e);return n===Tt?void 0:n};class Ft{constructor(e){return this.expression=Ue.parse(e).body[0].expression,this}evaluate(e,t){return e=e||{},t=t||void 0,Pt(this.expression,e,t)}}class Rt{constructor(e){var t=this;this._resolved=!1,this._rejected=!1,this._promise=new Promise(((r,n)=>{t._resolved?r():t._rejected?n():(this._resolve=r,this._reject=n),e&&e((function(){t._resolved=!0,r.apply(t._promise,arguments)}),(function(){t._rejected=!0,n.apply(t._promise,arguments)}))}))}resolve(){this._resolve?this._resolve.apply(this._promise,arguments):this._resolved=!0}reject(){this._reject?this._reject.apply(this._promise,arguments):this._rejected=!0}then(){return this._promise.then.apply(this._promise,arguments)}catch(){return this._promise.catch.apply(this._promise,arguments)}finally(){return this._promise.finally.apply(this._promise,arguments)}get pending(){return!this._resolved&&!this._resolved}get resolved(){return this._resolved}get rejected(){return this._rejected}}var Nt=Symbol("private");class Bt{constructor(){this[Nt]={},this[Nt].objects=new Map}clear(e){e&&this.forEach(((t,r)=>{e(t,r,this)})),this[Nt].objects.clear()}delete(e){this[Nt].objects.delete(e)}forEach(e){this[Nt].objects.forEach(((t,r)=>{e(t,r,this)}))}has(e){return this[Nt].objects.has(e)}keys(){return this[Nt].objects.keys()}get(e){return this[Nt].objects.get(e)}set(e,t){return this[Nt].objects.set(e,t),t}get objects(){return this[Nt].objects}}class It extends Bt{constructor(){super()}set(e,t){var r=this.objects.get(e);return r||(r={pendingPromise:new Rt},t&&Object.assign(r,t),super.set(e,r)),r}}var Ot=Symbol("private");class kt extends Bt{constructor(e){void 0===e&&(e={}),super(),this[Ot]={};var t=this[Ot];t.time=0,t.cleanupTime=ae.parseValue(e.cleanupTime,60),t.liveTime=ae.parseValue(e.liveTime,120)}update(e){var t=this[Ot];t.time+=e,t.time>=t.cleanupTime&&(this.objects.forEach(((e,r)=>{e.liveTime>t.time?e.liveTime-=t.time:this.objects.delete(r)})),t.time=0)}get(e){var t=this[Ot],r=super.get(e);if(r)return r.liveTime=t.liveTime,r.value}set(e,t){var r=this[Ot];return super.set(e,{value:t,liveTime:r.liveTime}),t}active(e){var t=this[Ot],r=this.objects.get(e);return!!r&&(r.liveTime=t.liveTime,!0)}}class Lt{constructor(e){this._capacity=Math.max(e,0)||10,this._list=Array.from({length:this._capacity}),this._tail=-1,this._head=-1,this._size=0}clear(){this._list=Array.from({length:this._capacity}),this._tail=-1,this._head=-1,this._size=0}enqueue(e){return this._size!==this._capacity&&(this._tail=(this._tail+1)%this._capacity,this._list[this._tail]=e,this._size+=1,-1===this._head&&(this._head=this._tail)),this.size}dequeue(){var e=null;return this._size&&(e=this._list[this._head],this._head=(this._head+1)%this._capacity,this._size--,this._size||(this._head=-1,this._tail=-1)),e}toString(){return this._list.filter((e=>void 0!==e)).toString()}get size(){return this._size}get front(){return this._list[this._head]}get tail(){return this._list[this._tail]}get isFull(){return this._size===this._capacity}get isEmpty(){return 0===this._size}}let Ut=class{constructor(){this._listeners={}}clear(){this._listeners={}}addEventListener(e,t){if(-1!==e.indexOf(" "))e.split(" ").forEach((e=>{this.addEventListener(e,t)}));else{var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}}removeEventListener(e,t){if(-1!==e.indexOf(" "))e.split(" ").forEach((e=>{this.removeEventListener(e,t)}));else{var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}}dispatchEvent(e){var t=this._listeners,r=t[e.type];if(r)for(var n=r.slice(0),i=0,a=n.length;i<a;i++)n[i].call(this,e);var s=t["*"];if(s)for(var o=s.slice(0),l=0,u=o.length;l<u;l++)o[l].call(this,e)}triggerEvent(e,t){var r=this._listeners,n=r[e];if(n)for(var i=n.slice(0),a=0,s=i.length;a<s;a++)i[a].call(this,t);var o=r["*"];if(o)for(var l=o.slice(0),u=0,c=l.length;u<c;u++)l[u].call(this,t)}};var zt={private:Symbol("private")};class jt{constructor(){this[zt.private]={};var e=this[zt.private];e.onFilter=null,e.result=null,Array.apply(this,arguments),this.length=0,Object.defineProperties(this,{length:{enumerable:!1}})}}for(var Vt in Array.prototype)jt.prototype[Vt]=Array.prototype[Vt];["push","pop","splice","shift"].forEach((e=>{jt.prototype[e]=function(){return this[zt.private].result=null,Array.prototype[e].apply(this,arguments)}})),jt.prototype.concat=function(){return[].concat(this.map((e=>e)))},jt.prototype.clear=function(){this.length=0},jt.prototype.clearResult=function(){this[zt.private].result=null},Object.defineProperties(jt.prototype,{push:{enumerable:!1},pop:{enumerable:!1},splice:{enumerable:!1},shift:{enumerable:!1},concat:{enumerable:!1},clear:{enumerable:!1},clearResult:{enumerable:!1},onFilter:{get:function(){return this[zt.private].onFilter},set:function(e){this[zt.private].onFilter=e},enumerable:!1,configurable:!1},result:{get:function(){var e=this[zt.private];return e.result?e.result:e.onFilter?(e.result=this.filter(e.onFilter),e.result):this},enumerable:!1,configurable:!1}});class Gt{constructor(){this._callbacks=[]}add(e){this._callbacks.push(e)}remove(e){we.removeFromArray(this._callbacks,e)}clear(){this._callbacks.length=0}invoke(){for(var e=this._callbacks,t=0,r=e.length;t<r;t++){e[t].apply(this,arguments)}}has(e){return this._callbacks.includes(e)}}let Wt=class e{constructor(){this._values=0}copy(e){return this._values=e._values,this}clone(){var t=new e;return t.copy(this),t}enable(e,t){void 0===t&&(t=!0);var r=this._values;return t?this._values|=e:this._values&e&&(this._values^=e),r!=this._values}check(e,t){return!!(this._values&e)==t}set(e){this._values=e}get(e){return!!(this._values&e)}combine(e){this._values|=e}clear(e){e?this._values&=~e:this._values=0}has(e){return!!(this._values&e)}get values(){return this._values}};var Ht=Symbol("private");var qt=Symbol("private");class Xt{constructor(e){this[qt]={};var t=this[qt];t.maxCount=e.maxCount,t.maxCount?(t.curIndex=0,t.deletedIndexs=[]):Utils.error("Initialize index buffer failed, due to maxCount: '"+maxCount+"' is invalid")}resize(e){this[qt].maxCount=e}allocate(){var e=this[qt];return e.deletedIndexs.length>0?e.deletedIndexs.shift():this.isFull()?-1:e.curIndex++}free(e){this[qt].deletedIndexs.push(e)}isFull(){var e=this[qt];return!(e.deletedIndexs.length>0)&&e.curIndex>=e.maxCount}get freeNumber(){var e=this[qt];return e.deletedIndexs.length+(e.maxCount-e.curIndex)}get allocatedNumber(){var e=this[qt];return e.curIndex-e.deletedIndexs.length}}function Qt(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Kt=0;function Yt(e){return"__private_"+Kt+++"_"+e}var Zt={private:Symbol("private")};var Jt=Yt("grow"),$t=Yt("tryAllocate"),er=Yt("sortBlocks");class tr{constructor(e){void 0===e&&(e={}),Object.defineProperty(this,er,{value:ir}),Object.defineProperty(this,$t,{value:nr}),Object.defineProperty(this,Jt,{value:rr}),this[Zt.private]={};var t=this[Zt.private];t.memory=e.memory,t.heap=new Uint8Array(t.memory.buffer),t.blocks=[]}malloc(e){for(var t=this[Zt.private],r=function(e,t){return e%t?(e&~(t-1))+t:e}(e,8);;){var n=Qt(this,$t)[$t](r);if(-1!==n)return t.blocks.push({offset:n,size:e,alignedSize:r}),Qt(this,er)[er](),n;Qt(this,Jt)[Jt]()}}free(e){for(var t=this[Zt.private].blocks,r=0;r<t.length;r++){if(t[r].offset==e){t.splice(r,1),Qt(this,er)[er]();break}}}getBlockSize(e){for(var t=this[Zt.private].blocks,r=0;r<t.length;r++){var n=t[r];if(n.offset==e)return n.size}return 0}}function rr(){var e=this[Zt.private],t=e.memory;t.grow(2),e.heap=new Uint8Array(t.buffer)}function nr(e){for(var t=this[Zt.private],r=t.blocks,n=32,i=0;i<r.length;i++){var a=r[i];if(n+e<a.offset)return n;n=a.offset+a.alignedSize}return n+e>=t.memory.buffer.byteLength?-1:n}function ir(){this[Zt.private].blocks.sort((function(e,t){return e.offset-t.offset}))}class ar{constructor(e){this._dataStore={},this._onConvertValue=e.onConvertValue;var t=e.values;this._keys=Object.getOwnPropertyNames(t),this._keys.forEach((e=>{if(this._dataStore[e]=t[e],"function"==typeof t[e])throw new TypeError("Can't define property <TypedObject>."+e+", methods are not permitted on typed objects.");Object.defineProperty(this,e,{enumerable:!0,get:function(){return this._dataStore[e]},set:function(r){this._onConvertValue&&(r=we.parseValue(this._onConvertValue(e,r),r)),this._set(t,e,r)}})}))}_err(e,t,r){throw new TypeError("Can't set property <TypedObject>."+e+', type "'+r+'" is not assignable to type "'+t+'"')}_set(e,t,r){var n=typeof e[t];if("object"===n)"object"!=typeof r&&(void 0!==e[t].length?this._err(t,"array",typeof r):this._err(t,"object",typeof r)),void 0!==e[t].length&&void 0===r.length&&this._err(t,"array","object"),void 0!==r.length&&void 0===e[t].length&&this._err(t,"object","array");else typeof r!==n&&this._err(t,n,typeof r);this._dataStore[t]=r}toObject(){var e={};return this._keys.forEach((function(t){e[t]=self[t]})),e}}var sr=Symbol("private");var or={},lr={};class ur{constructor(e){void 0===e&&(e=lr),this._propName=e.propName||"",this._data=e.data||{},this._proxyProperties=new WeakMap,this._onConvertValue=e.onConvertValue,this._onChange=e.onChange,this._onNeedProxy=e.onNeedProxy,this._onGetValue=e.onGetValue,this._dataProxy=null}_clear(){for(var e in this._data)delete this._data[e]}_setValue(e,t,r){if(this._onConvertValue&&(r=we.parseValue(this._onConvertValue(t,r),r)),we.isNull(r)){var n=this._proxyProperties.get(e);n&&n.delete(t)}var i=void 0===e[t];if(e[t]&&we.isArray(r))for(var a=e[t],s=0,o=r.length;s<o;s++)a[s]=r[s];else e[t]=r;var l=this._onChange;l&&(or.data=this._data,or.propName=e.__name__||this._propName,or.key=t,or.value=r,or.newKey=i,l(or))}_getValue(e,t,r){var n=e[t];if(null===n||"object"!=typeof n)return n;if("customFormatters"==t)return n;if(this._onFilterProperty&&this._onFilterProperty(t),this._onNeedProxy&&!1===this._onNeedProxy(t,n))return n;var i=this._proxyProperties,a=i.get(e);if(a){var s=a.get(t);if(s)return s}else a=new Map,i.set(e,a);var o=new Proxy(n,r);return o.customFormatters||Object.defineProperties(o,{customFormatters:{enumerable:!1,configurable:!1,get:function(){return["object",{object:JSON.parse(JSON.stringify(n))}]}},__name__:{enumerable:!1,configurable:!1,get:function(){return t}}}),a.set(t,o),o}_createDataProxy(){var e=this,t={set:function(t,r,n){return e._setValue(t,r,n),!0},get:function(t,r){return e._onGetValue&&"customFormatters"!=r?e._onGetValue(t,r):e._getValue(t,r,this)},deleteProperty:function(t,r){return r in t&&(delete t[r],e.notifyChange(),!0)}};this._dataProxy=new Proxy(this._data,t),Object.defineProperty(this._dataProxy,"customFormatters",{enumerable:!1,configurable:!1,get:function(){return["object",{object:JSON.parse(JSON.stringify(e._data))}]}})}dispose(){this._data={},this._dataProxy=null,this._proxyProperties=null,this._onChange=null}notifyChange(){var e=this._onChange;e&&e({data:this._data})}merge(e){if(e){var t=this._data,r=e.isObjectProxy?e.data:e;for(var n in r)t[n]=r[n];return this.notifyChange(),this}}copy(e){if(e)return this._clear(),this.merge(e)}get data(){return this._data}get dataProxy(){return this._dataProxy||this._createDataProxy(),this._dataProxy}get isObjectProxy(){return!0}}var cr={},hr={},dr=1,pr=2;function fr(e,t){if(we.isArray(e)&&we.isArray(t)){if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!1}else if(we.isObject(e)&&we.isObject(t)){for(var n in e)if(!fr(e[n],t[n]))return!1}else if(e!=t)return!1;return!0}function mr(e){return we.cloneObject(e,!1)}class gr{constructor(e){void 0===e&&(e=hr),this._flags=new Wt,this._onChange=e.onChange,this._onConvertValue=e.onConvertValue,this._onCloneObject=e.onCloneObject||mr,this._onEquals=e.onEquals||fr;var t=e.data;t?(this._baseValues=Object.assign({},t),this._values=this._createObjectProxy(this._onCloneObject(t),e),this._defaultValues=this._createObjectProxy(this._onCloneObject(t),e),this._keys=e.keys||Object.keys(t)):(this._baseValues={},this._values=this._createObjectProxy({},e),this._defaultValues=this._createObjectProxy({},e),this._keys={})}_refreshKeys(){var e=this._values.data,t=this._defaultValues.data;this._keys=we.getUnionKeys(e,t)}_createObjectProxy(e,t){var r={data:e,onConvertValue:this._onConvertValue};return t.propName&&(r.propName=t.propName),t.onNeedProxy&&(r.onNeedProxy=t.onNeedProxy),t.onGetValue&&(r.onGetValue=t.onGetValue),this._onChange&&(r.onChange=e=>{cr.key=e.key,cr.propName=e.propName,cr.value=e.value,e.newKey&&this._refreshKeys(),this._flags.has(pr)?cr.data=this.getValuesWithDefaults():cr.data=this._values.data,this._onChange(cr)}),new ur(r)}dispose(){this._baseValues=null,this._values.dispose(),this._defaultValues.dispose(),this._flags=null,this._onChange=null,this._onConvertValue=null}beginDefaultValues(){this._flags.enable(dr,!0),this._flags.enable(pr,!0)}endDefaultValues(){this._flags.enable(dr,!1)}defineProperties(e){Object.defineProperties(this._baseValues,e),Object.defineProperties(this._values.data,e),Object.defineProperties(this._defaultValues.data,e)}updateBaseValues(e){this._onCloneObject(e,this._baseValues)}updateBaseValue(e,t){this._baseValues[e]=t}makeCurrentAsBaseValue(){this._onCloneObject(this._values.data,this._baseValues)}hasValue(e,t){var r=this._values.dataProxy[e];if(!we.isNull(r))return!0;if(!t){var n=this._defaultValues.dataProxy[e];if(!we.isNull(n))return!0}return!1}getValue(e){var t=this._values.dataProxy[e];if(!we.isNull(t))return t;var r=this._defaultValues.dataProxy[e];return we.isNull(r)?null:r}getValueByDefault(e){if(!this.isChangingDefaultValues()){var t=this._values.dataProxy[e];if(!we.isNull(t))return t}var r=this._defaultValues.dataProxy[e];return we.isNull(r)?null:r}setValue(e,t,r,n,i){var a=this.values;if(r){if(r(a[e],t))return!1}else if(this._onEquals(a[e],t))return!1;return n&&n(e,t),we.isArray(t)?a[e]=i?i(t):t.slice(0):a[e]=t,!0}updateValue(e,t){var r=t;r=we.isArray(t)?t.slice(0):t,this.values[e]=r}mergeValues(e){var t=this.values;for(var r in e)t[r]=e[r]}isBaseValue(e,t){var r=this.getValue(e),n=this._baseValues[e];return t?t(r,n):this._onEquals(r,n)}isChanged(){return!we.equalsObject(this.values,this._baseValues)}isChangingDefaultValues(){return this._flags.has(dr)}getDiffValues(){var e=this._values.data,t=this._baseValues,r={};for(var n in e)this._onEquals(e[n],t[n])||(r[n]=e[n]);return r}getValuesWithDefaults(e){e=e||this._onEquals;var t={},r=this._baseValues,n=this._values.data,i=this._defaultValues.data;return this._keys.forEach((a=>{var s;void 0!==(s=e(n[a],r[a])?we.parseValue(i[a],r[a]):n[a])&&(t[a]=s)})),t}getValues(){return this._values}get baseValues(){return this._baseValues}get defaultValues(){return this._defaultValues.data}get values(){return this._flags.has(dr)?this._defaultValues.dataProxy:this._values.dataProxy}set values(e){this._flags.has(dr)?this._defaultValues.copy(e):this._values.copy(e)}get data(){return this._flags.has(dr)?this._defaultValues.data:this._values.data}get isObjectAttributes(){return!0}}var _r=Yt("refCount");class vr{constructor(){Object.defineProperty(this,_r,{writable:!0,value:1})}addRef(){Qt(this,_r)[_r]++}release(){0!==Qt(this,_r)[_r]&&(Qt(this,_r)[_r]--,0===Qt(this,_r)[_r]&&this.onDispose&&this.onDispose())}get refCount(){return Qt(this,_r)[_r]}}var yr={private:Symbol("private")},xr=Yt("updateStates");class br{constructor(e){void 0===e&&(e={}),Object.defineProperty(this,xr,{value:Ar}),this[yr.private]={};var t=this[yr.private];t.id=1,t.states=[],t.latestState=!1,t.onChange=e.onChange||function(){}}has(e){for(var t=this[yr.private].states,r=0;r<t.length;r++){if(t[r].name==e)return!0}return!1}isAnyEnable(){for(var e=this[yr.private].states,t=0;t<e.length;t++)if(e[t].value)return!0;return!1}isEnable(e){var t=this[yr.private].states;if(e)for(var r=0;r<t.length;r++){var n=t[r];if(n.name==e)return n.value}else if(t.length)return t[0].value;return!1}isEnableByFilter(e){for(var t=this[yr.private].states,r=0,n=t.length;r<n;r++){var i=t[r];if(!e||!1!==e(i.name))return i.value}return!1}enable(e,t,r){void 0===r&&(r=0);for(var n=this[yr.private],i=n.states,a=0;a<i.length;a++){var s=i[a];if(s.name==t)return s.value=e,s.priority=r,Qt(this,xr)[xr]()}return i.push({id:n.id++,value:e,name:t,priority:r}),Qt(this,xr)[xr]()}getValue(e){for(var t=this[yr.private].states,r=0;r<t.length;r++){var n=t[r];if(n.name==e)return n.value}return null}clear(){this[yr.private].states=[]}get states(){return this[yr.private].states}}function Ar(){var e=this[yr.private];e.states.sort(((e,t)=>e.priority!==t.priority?t.priority-e.priority:t.id-e.id));var t=e.states[0].value;return t!=e.latestState&&e.onChange({state:t}),e.latestState=t,t}class Sr{constructor(){this._commands=[]}addCommand(e,t){this._commands.push({funcName:e,args:t})}runCommands(e,t){void 0===t&&(t=!0),this._commands.forEach((t=>{e[t.funcName].apply(e,t.args)})),t&&this.clearCommands()}clearCommands(){this._commands=[]}get commands(){return this._commands}}var Er={private:Symbol("private")},wr=Yt("notifyChangeEvent"),Cr=Yt("enable"),Tr=Yt("getLockStateByName");function Dr(){var e=this[Er.private],t=e.onChange;t&&t(e.enable)}function Mr(e){var t=this[Er.private],r=t.enable;t.enable=e,r!=t.enable&&Qt(this,wr)[wr]()}function Pr(e){for(var t=this[Er.private].lockQueue,r=0;r<t.length;r++){var n=t[r];if(n.name==e)return{prevEnableState:n.prevEnableState,enable:n.enable,name:n.name,index:r}}return null}var Fr={},Rr=function(e,t){return Rr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Rr(e,t)};var Nr=function(){return Nr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Nr.apply(this,arguments)};var Br=Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function Ir(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Or(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return s}function kr(e){return this instanceof kr?(this.v=e,this):new kr(e)}var Lr=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};var Ur,zr=Object.freeze({__proto__:null,get __assign(){return Nr},__asyncDelegator:function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:kr(e[n](t)),done:"return"===n}:i?i(t):t}:i}},__asyncGenerator:function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||o(e,t)}))})}function o(e,t){try{(r=i[e](t)).value instanceof kr?Promise.resolve(r.value.v).then(l,u):c(a[0][2],r)}catch(e){c(a[0][3],e)}var r}function l(e){o("next",e)}function u(e){o("throw",e)}function c(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}},__asyncValues:function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=Ir(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}},__await:kr,__awaiter:function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))},__classPrivateFieldGet:function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},__classPrivateFieldIn:function(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)},__classPrivateFieldSet:function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},__createBinding:Br,__decorate:function(e,t,r,n){var i,a=arguments.length,s=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,r,s):i(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},__exportStar:function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||Br(t,e,r)},__extends:function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Rr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__generator:function(e,t){var r,n,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},__importDefault:function(e){return e&&e.__esModule?e:{default:e}},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Br(t,e,r);return Lr(t,e),t},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__metadata:function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param:function(e,t){return function(r,n){t(r,n,e)}},__read:Or,__rest:function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Or(arguments[t]));return e},__spreadArray:function(e,t,r){if(r||2===arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},__spreadArrays:function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var a=arguments[t],s=0,o=a.length;s<o;s++,i++)n[i]=a[s];return n},__values:Ir}),jr=R(zr),Vr=R(Object.freeze({__proto__:null,default:{}})),Gr={},Wr={},Hr={get exports(){return Wr},set exports(e){Wr=e}},qr={};function Xr(){if(Ur)return qr;Ur=1,Object.defineProperty(qr,"__esModule",{value:!0}),qr.Def=void 0;var e=jr,t=Object.prototype,r=t.toString,n=t.hasOwnProperty,i=function(){function e(){}return e.prototype.assert=function(e,t){if(!this.check(e,t)){var r=d(e);throw new Error(r+" does not match type "+this)}return!0},e.prototype.arrayOf=function(){return new a(this)},e}(),a=function(t){function r(e){var r=t.call(this)||this;return r.elemType=e,r.kind="ArrayType",r}return(0,e.__extends)(r,t),r.prototype.toString=function(){return"["+this.elemType+"]"},r.prototype.check=function(e,t){var r=this;return Array.isArray(e)&&e.every((function(e){return r.elemType.check(e,t)}))},r}(i),s=function(t){function r(e){var r=t.call(this)||this;return r.value=e,r.kind="IdentityType",r}return(0,e.__extends)(r,t),r.prototype.toString=function(){return String(this.value)},r.prototype.check=function(e,t){var r=e===this.value;return r||"function"!=typeof t||t(this,e),r},r}(i),o=function(t){function n(e){var r=t.call(this)||this;return r.fields=e,r.kind="ObjectType",r}return(0,e.__extends)(n,t),n.prototype.toString=function(){return"{ "+this.fields.join(", ")+" }"},n.prototype.check=function(e,t){return r.call(e)===r.call({})&&this.fields.every((function(r){return r.type.check(e[r.name],t)}))},n}(i),l=function(t){function r(e){var r=t.call(this)||this;return r.types=e,r.kind="OrType",r}return(0,e.__extends)(r,t),r.prototype.toString=function(){return this.types.join(" | ")},r.prototype.check=function(e,t){return this.types.some((function(r){return r.check(e,t)}))},r}(i),u=function(t){function r(e,r){var n=t.call(this)||this;return n.name=e,n.predicate=r,n.kind="PredicateType",n}return(0,e.__extends)(r,t),r.prototype.toString=function(){return this.name},r.prototype.check=function(e,t){var r=this.predicate(e,t);return r||"function"!=typeof t||t(this,e),r},r}(i),c=function(){function e(e,t){this.type=e,this.typeName=t,this.baseNames=[],this.ownFields=Object.create(null),this.allSupertypes=Object.create(null),this.supertypeList=[],this.allFields=Object.create(null),this.fieldNames=[],this.finalized=!1,this.buildable=!1,this.buildParams=[]}return e.prototype.isSupertypeOf=function(t){if(t instanceof e){if(!0!==this.finalized||!0!==t.finalized)throw new Error("");return n.call(t.allSupertypes,this.typeName)}throw new Error(t+" is not a Def")},e.prototype.checkAllFields=function(e,t){var r=this.allFields;if(!0!==this.finalized)throw new Error(""+this.typeName);return null!==e&&"object"==typeof e&&Object.keys(r).every((function(n){var i=r[n],a=i.type,s=i.getValue(e);return a.check(s,t)}))},e.prototype.bases=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.baseNames;if(this.finalized){if(e.length!==r.length)throw new Error("");for(var n=0;n<e.length;n++)if(e[n]!==r[n])throw new Error("");return this}return e.forEach((function(e){r.indexOf(e)<0&&r.push(e)})),this},e}();qr.Def=c;var h=function(){function e(e,t,r,n){this.name=e,this.type=t,this.defaultFn=r,this.hidden=!!n}return e.prototype.toString=function(){return JSON.stringify(this.name)+": "+this.type},e.prototype.getValue=function(e){var t=e[this.name];return void 0!==t||"function"==typeof this.defaultFn&&(t=this.defaultFn.call(e)),t},e}();function d(e){return Array.isArray(e)?"["+e.map(d).join(", ")+"]":e&&"object"==typeof e?"{ "+Object.keys(e).map((function(t){return t+": "+e[t]})).join(", ")+" }":JSON.stringify(e)}return qr.default=function(t){var i={or:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new l(e.map((function(e){return i.from(e)})))},from:function(e,t){if(e instanceof a||e instanceof s||e instanceof o||e instanceof l||e instanceof u)return e;if(e instanceof c)return e.type;if(v.check(e)){if(1!==e.length)throw new Error("only one element type is permitted for typed arrays");return new a(i.from(e[0]))}if(y.check(e))return new o(Object.keys(e).map((function(t){return new h(t,i.from(e[t],t))})));if("function"==typeof e){var r=p.indexOf(e);if(r>=0)return f[r];if("string"!=typeof t)throw new Error("missing name");return new u(t,e)}return new s(e)},def:function(e){return n.call(D,e)?D[e]:D[e]=new P(e)},hasDef:function(e){return n.call(D,e)}},p=[],f=[];function m(e,t){var n=r.call(t),i=new u(e,(function(e){return r.call(e)===n}));return t&&"function"==typeof t.constructor&&(p.push(t.constructor),f.push(i)),i}var g=m("string","truthy"),_=m("function",(function(){})),v=m("array",[]),y=m("object",{}),x=m("RegExp",/./),b=m("Date",new Date),A=m("number",3),S=m("boolean",!0),E=m("null",null),w=m("undefined",void 0),C="function"==typeof BigInt?m("BigInt",BigInt(1234)):new u("BigInt",(function(){return!1})),T={string:g,function:_,array:v,object:y,RegExp:x,Date:b,number:A,boolean:S,null:E,undefined:w,BigInt:C},D=Object.create(null);function M(e){if(e&&"object"==typeof e){var t=e.type;if("string"==typeof t&&n.call(D,t)){var r=D[t];if(r.finalized)return r}}return null}var P=function(t){function r(e){var r=t.call(this,new u(e,(function(e,t){return r.check(e,t)})),e)||this;return r}return(0,e.__extends)(r,t),r.prototype.check=function(e,t){if(!0!==this.finalized)throw new Error("prematurely checking unfinalized type "+this.typeName);if(null===e||"object"!=typeof e)return!1;var r=M(e);return r?t&&r===this?this.checkAllFields(e,t):!!this.isSupertypeOf(r)&&(!t||r.checkAllFields(e,t)&&this.checkAllFields(e,!1)):("SourceLocation"===this.typeName||"Position"===this.typeName)&&this.checkAllFields(e,t)},r.prototype.build=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(this.buildParams=t,this.buildable)return this;this.field("type",String,(function(){return e.typeName})),this.buildable=!0;var i=function(t,r,i,a){if(!n.call(t,r)){var s=e.allFields;if(!n.call(s,r))throw new Error(""+r);var o,l=s[r],u=l.type;if(a)o=i;else{if(!l.defaultFn){var c="no value or default function given for field "+JSON.stringify(r)+" of "+e.typeName+"("+e.buildParams.map((function(e){return s[e]})).join(", ")+")";throw new Error(c)}o=l.defaultFn.call(t)}if(!u.check(o))throw new Error(d(o)+" does not match field "+l+" of type "+e.typeName);t[r]=o}},a=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t.length;if(!e.finalized)throw new Error("attempting to instantiate unfinalized type "+e.typeName);var a=Object.create(R);if(e.buildParams.forEach((function(e,r){r<n?i(a,e,t[r],!0):i(a,e,null,!1)})),Object.keys(e.allFields).forEach((function(e){i(a,e,null,!1)})),a.type!==e.typeName)throw new Error("");return a};return a.from=function(t){if(!e.finalized)throw new Error("attempting to instantiate unfinalized type "+e.typeName);var r=Object.create(R);if(Object.keys(e.allFields).forEach((function(e){n.call(t,e)?i(r,e,t[e],!0):i(r,e,null,!1)})),r.type!==e.typeName)throw new Error("");return r},Object.defineProperty(F,N(this.typeName),{enumerable:!0,value:a}),this},r.prototype.field=function(e,t,r,n){return this.finalized?(console.error("Ignoring attempt to redefine field "+JSON.stringify(e)+" of finalized type "+JSON.stringify(this.typeName)),this):(this.ownFields[e]=new h(e,i.from(t),r,n),this)},r.prototype.finalize=function(){var e=this;if(!this.finalized){var t=this.allFields,r=this.allSupertypes;for(var i in this.baseNames.forEach((function(n){var i=D[n];if(!(i instanceof c)){var a="unknown supertype name "+JSON.stringify(n)+" for subtype "+JSON.stringify(e.typeName);throw new Error(a)}i.finalize(),L(t,i.allFields),L(r,i.allSupertypes)})),L(t,this.ownFields),r[this.typeName]=this,this.fieldNames.length=0,t)n.call(t,i)&&!t[i].hidden&&this.fieldNames.push(i);Object.defineProperty(I,this.typeName,{enumerable:!0,value:this.type}),this.finalized=!0,function(e,t){t.length=0,t.push(e);for(var r=Object.create(null),i=0;i<t.length;++i){e=t[i];var a=D[e];if(!0!==a.finalized)throw new Error("");n.call(r,e)&&delete t[r[e]],r[e]=i,t.push.apply(t,a.baseNames)}for(var s=0,o=s,l=t.length;o<l;++o)n.call(t,o)&&(t[s++]=t[o]);t.length=s}(this.typeName,this.supertypeList),this.buildable&&this.supertypeList.lastIndexOf("Expression")>=0&&function(e){var t=B(e);if(F[t])return;var r=F[N(e)];if(!r)return;var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return F.expressionStatement(r.apply(F,e))};n.from=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return F.expressionStatement(r.from.apply(F,e))},F[t]=n}(this.typeName)}},r}(c),F=Object.create(null),R={};function N(e){return e.replace(/^[A-Z]+/,(function(e){var t=e.length;switch(t){case 0:return"";case 1:return e.toLowerCase();default:return e.slice(0,t-1).toLowerCase()+e.charAt(t-1)}}))}function B(e){return(e=N(e)).replace(/(Expression)?$/,"Statement")}var I={};function O(e){var t=M(e);if(t)return t.fieldNames.slice(0);if("type"in e)throw new Error("did not recognize object of type "+JSON.stringify(e.type));return Object.keys(e)}function k(e,t){var r=M(e);if(r){var n=r.allFields[t];if(n)return n.getValue(e)}return e&&e[t]}function L(e,t){return Object.keys(t).forEach((function(r){e[r]=t[r]})),e}return{Type:i,builtInTypes:T,getSupertypeNames:function(e){if(!n.call(D,e))throw new Error("");var t=D[e];if(!0!==t.finalized)throw new Error("");return t.supertypeList.slice(1)},computeSupertypeLookupTable:function(e){for(var t={},r=Object.keys(D),i=r.length,a=0;a<i;++a){var s=r[a],o=D[s];if(!0!==o.finalized)throw new Error(""+s);for(var l=0;l<o.supertypeList.length;++l){var u=o.supertypeList[l];if(n.call(e,u)){t[s]=u;break}}}return t},builders:F,defineMethod:function(e,t){var r=R[e];return w.check(t)?delete R[e]:(_.assert(t),Object.defineProperty(R,e,{enumerable:!0,configurable:!0,value:t})),r},getBuilderName:N,getStatementBuilderName:B,namedTypes:I,getFieldNames:O,getFieldValue:k,eachField:function(e,t,r){O(e).forEach((function(r){t.call(this,r,k(e,r))}),r)},someField:function(e,t,r){return O(e).some((function(r){return t.call(this,r,k(e,r))}),r)},finalize:function(){Object.keys(D).forEach((function(e){D[e].finalize()}))}}},qr}var Qr,Kr={},Yr={get exports(){return Kr},set exports(e){Kr=e}},Zr={},Jr={get exports(){return Zr},set exports(e){Zr=e}},$r={},en={get exports(){return $r},set exports(e){$r=e}};function tn(){return Qr||(Qr=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(0,jr.__importDefault)(Xr()),n=Object.prototype.hasOwnProperty;t.default=function(e){var t=e.use(r.default),i=t.builtInTypes.array,a=t.builtInTypes.number,s=function e(t,r,n){if(!(this instanceof e))throw new Error("Path constructor cannot be invoked without 'new'");if(r){if(!(r instanceof e))throw new Error("")}else r=null,n=null;this.value=t,this.parentPath=r,this.name=n,this.__childCache=null},o=s.prototype;function l(e){return e.__childCache||(e.__childCache=Object.create(null))}function u(e,t){var r=l(e),i=e.getValueProperty(t),a=r[t];return n.call(r,t)&&a.value===i||(a=r[t]=new e.constructor(i,e,t)),a}function c(){}function h(e,t,r,s){if(i.assert(e.value),0===t)return c;var o=e.value.length;if(o<1)return c;var u=arguments.length;2===u?(r=0,s=o):3===u?(r=Math.max(r,0),s=o):(r=Math.max(r,0),s=Math.min(s,o)),a.assert(r),a.assert(s);for(var h=Object.create(null),d=l(e),p=r;p<s;++p)if(n.call(e.value,p)){var f=e.get(p);if(f.name!==p)throw new Error("");var m=p+t;f.name=m,h[m]=f,delete d[p]}return delete d.length,function(){for(var t in h){var r=h[t];if(r.name!==+t)throw new Error("");d[t]=r,e.value[t]=r.value}}}return o.getValueProperty=function(e){return this.value[e]},o.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=this,n=e.length,i=0;i<n;++i)r=u(r,e[i]);return r},o.each=function(e,t){var r=[],i=this.value.length,a=0;for(a=0;a<i;++a)n.call(this.value,a)&&(r[a]=this.get(a));for(t=t||this,a=0;a<i;++a)n.call(r,a)&&e.call(t,r[a])},o.map=function(e,t){var r=[];return this.each((function(t){r.push(e.call(this,t))}),t),r},o.filter=function(e,t){var r=[];return this.each((function(t){e.call(this,t)&&r.push(t)}),t),r},o.shift=function(){var e=h(this,-1),t=this.value.shift();return e(),t},o.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=h(this,e.length),n=this.value.unshift.apply(this.value,e);return r(),n},o.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.assert(this.value),delete l(this).length,this.value.push.apply(this.value,e)},o.pop=function(){i.assert(this.value);var e=l(this);return delete e[this.value.length-1],delete e.length,this.value.pop()},o.insertAt=function(e){var t=arguments.length,r=h(this,t-1,e);if(r===c&&t<=1)return this;e=Math.max(e,0);for(var n=1;n<t;++n)this.value[e+n-1]=arguments[n];return r(),this},o.insertBefore=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=this.parentPath,n=e.length,i=[this.name],a=0;a<n;++a)i.push(e[a]);return r.insertAt.apply(r,i)},o.insertAfter=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=this.parentPath,n=e.length,i=[this.name+1],a=0;a<n;++a)i.push(e[a]);return r.insertAt.apply(r,i)},o.replace=function(e){var t=[],r=this.parentPath.value,n=l(this.parentPath),a=arguments.length;if(function(e){if(!(e instanceof s))throw new Error("");var t=e.parentPath;if(!t)return e;var r=t.value,n=l(t);if(r[e.name]===e.value)n[e.name]=e;else if(i.check(r)){var a=r.indexOf(e.value);a>=0&&(n[e.name=a]=e)}else r[e.name]=e.value,n[e.name]=e;if(r[e.name]!==e.value)throw new Error("");if(e.parentPath.get(e.name)!==e)throw new Error("")}(this),i.check(r)){for(var o=r.length,u=h(this.parentPath,a-1,this.name+1),c=[this.name,1],d=0;d<a;++d)c.push(arguments[d]);if(r.splice.apply(r,c)[0]!==this.value)throw new Error("");if(r.length!==o-1+a)throw new Error("");if(u(),0===a)delete this.value,delete n[this.name],this.__childCache=null;else{if(r[this.name]!==e)throw new Error("");for(this.value!==e&&(this.value=e,this.__childCache=null),d=0;d<a;++d)t.push(this.parentPath.get(this.name+d));if(t[0]!==this)throw new Error("")}}else if(1===a)this.value!==e&&(this.__childCache=null),this.value=r[this.name]=e,t.push(this);else{if(0!==a)throw new Error("Could not replace path");delete r[this.name],delete this.value,this.__childCache=null}return t},s},e.exports=t.default}(en,$r)),$r}var rn,nn,an,sn={},on={get exports(){return sn},set exports(e){sn=e}};function ln(){return rn||(rn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(0,jr.__importDefault)(Xr()),n=Object.prototype.hasOwnProperty;t.default=function(e){var t=e.use(r.default),i=t.Type,a=t.namedTypes,s=a.Node,o=a.Expression,l=t.builtInTypes.array,u=t.builders,c=function e(t,r){if(!(this instanceof e))throw new Error("Scope constructor cannot be invoked without 'new'");var n;if(d.check(t.value)||h.assert(t.value),r){if(!(r instanceof e))throw new Error("");n=r.depth+1}else r=null,n=0;Object.defineProperties(this,{path:{value:t},node:{value:t.value},isGlobal:{value:!r,enumerable:!0},depth:{value:n},parent:{value:r},bindings:{value:{}},types:{value:{}}})},h=i.or(a.Program,a.Function,a.CatchClause),d=i.or(a.Function,a.ClassDeclaration,a.ClassExpression,a.InterfaceDeclaration,a.TSInterfaceDeclaration,a.TypeAlias,a.TSTypeAliasDeclaration),p=i.or(a.TypeParameter,a.TSTypeParameter);c.isEstablishedBy=function(e){return h.check(e)||d.check(e)};var f=c.prototype;function m(e,r,n){var i=e.value;e.parent&&a.FunctionExpression.check(e.parent.node)&&e.parent.node.id&&_(e.parent.get("id"),r),i&&(l.check(i)?e.each((function(e){g(e,r,n)})):a.Function.check(i)?(e.get("params").each((function(e){_(e,r)})),g(e.get("body"),r,n),m(e.get("typeParameters"),r,n)):a.TypeAlias&&a.TypeAlias.check(i)||a.InterfaceDeclaration&&a.InterfaceDeclaration.check(i)||a.TSTypeAliasDeclaration&&a.TSTypeAliasDeclaration.check(i)||a.TSInterfaceDeclaration&&a.TSInterfaceDeclaration.check(i)?v(e.get("id"),n):a.VariableDeclarator.check(i)?(_(e.get("id"),r),g(e.get("init"),r,n)):"ImportSpecifier"===i.type||"ImportNamespaceSpecifier"===i.type||"ImportDefaultSpecifier"===i.type?_(e.get(i.local?"local":i.name?"name":"id"),r):s.check(i)&&!o.check(i)&&t.eachField(i,(function(t,i){var a=e.get(t);if(!function(e,t){if(e.value===t)return!0;if(Array.isArray(e.value)&&0===e.value.length&&Array.isArray(t)&&0===t.length)return!0;return!1}(a,i))throw new Error("");g(a,r,n)})))}function g(e,t,r){var i=e.value;if(!i||o.check(i));else if(a.FunctionDeclaration.check(i)&&null!==i.id)_(e.get("id"),t);else if(a.ClassDeclaration&&a.ClassDeclaration.check(i)&&null!==i.id)_(e.get("id"),t),m(e.get("typeParameters"),t,r);else if(a.InterfaceDeclaration&&a.InterfaceDeclaration.check(i)||a.TSInterfaceDeclaration&&a.TSInterfaceDeclaration.check(i))v(e.get("id"),r);else if(h.check(i)){if(a.CatchClause.check(i)&&a.Identifier.check(i.param)){var s=i.param.name,l=n.call(t,s);m(e.get("body"),t,r),l||delete t[s]}}else m(e,t,r)}function _(e,t){var r=e.value;a.Pattern.assert(r),a.Identifier.check(r)?n.call(t,r.name)?t[r.name].push(e):t[r.name]=[e]:a.AssignmentPattern&&a.AssignmentPattern.check(r)?_(e.get("left"),t):a.ObjectPattern&&a.ObjectPattern.check(r)?e.get("properties").each((function(e){var r=e.value;a.Pattern.check(r)?_(e,t):a.Property.check(r)||a.ObjectProperty&&a.ObjectProperty.check(r)?_(e.get("value"),t):a.SpreadProperty&&a.SpreadProperty.check(r)&&_(e.get("argument"),t)})):a.ArrayPattern&&a.ArrayPattern.check(r)?e.get("elements").each((function(e){var r=e.value;a.Pattern.check(r)?_(e,t):a.SpreadElement&&a.SpreadElement.check(r)&&_(e.get("argument"),t)})):a.PropertyPattern&&a.PropertyPattern.check(r)?_(e.get("pattern"),t):(a.SpreadElementPattern&&a.SpreadElementPattern.check(r)||a.RestElement&&a.RestElement.check(r)||a.SpreadPropertyPattern&&a.SpreadPropertyPattern.check(r))&&_(e.get("argument"),t)}function v(e,t){var r=e.value;a.Pattern.assert(r),a.Identifier.check(r)&&(n.call(t,r.name)?t[r.name].push(e):t[r.name]=[e])}return f.didScan=!1,f.declares=function(e){return this.scan(),n.call(this.bindings,e)},f.declaresType=function(e){return this.scan(),n.call(this.types,e)},f.declareTemporary=function(e){if(e){if(!/^[a-z$_]/i.test(e))throw new Error("")}else e="t$";e+=this.depth.toString(36)+"$",this.scan();for(var r=0;this.declares(e+r);)++r;var n=e+r;return this.bindings[n]=t.builders.identifier(n)},f.injectTemporary=function(e,t){e||(e=this.declareTemporary());var r=this.path.get("body");return a.BlockStatement.check(r.value)&&(r=r.get("body")),r.unshift(u.variableDeclaration("var",[u.variableDeclarator(e,t||null)])),e},f.scan=function(e){if(e||!this.didScan){for(var t in this.bindings)delete this.bindings[t];for(var t in this.types)delete this.types[t];!function(e,t,r){var i=e.value;if(d.check(i)){var s=e.get("typeParameters","params");l.check(s.value)&&s.each((function(e){!function(e,t){var r=e.value;p.assert(r),n.call(t,r.name)?t[r.name].push(e):t[r.name]=[e]}(e,r)}))}h.check(i)&&(a.CatchClause.check(i)?_(e.get("param"),t):m(e,t,r))}(this.path,this.bindings,this.types),this.didScan=!0}},f.getBindings=function(){return this.scan(),this.bindings},f.getTypes=function(){return this.scan(),this.types},f.lookup=function(e){for(var t=this;t&&!t.declares(e);t=t.parent);return t},f.lookupType=function(e){for(var t=this;t&&!t.declaresType(e);t=t.parent);return t},f.getGlobalScope=function(){for(var e=this;!e.isGlobal;)e=e.parent;return e},c},e.exports=t.default}(on,sn)),sn}function un(){return nn||(nn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(Xr()),i=(0,r.__importDefault)(tn()),a=(0,r.__importDefault)(ln());t.default=function(e){var t=e.use(n.default),r=t.namedTypes,s=t.builders,o=t.builtInTypes.number,l=t.builtInTypes.array,u=e.use(i.default),c=e.use(a.default),h=function e(t,r,n){if(!(this instanceof e))throw new Error("NodePath constructor cannot be invoked without 'new'");u.call(this,t,r,n)},d=h.prototype=Object.create(u.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}});function p(e){return r.BinaryExpression.check(e)||r.LogicalExpression.check(e)}Object.defineProperties(d,{node:{get:function(){return Object.defineProperty(this,"node",{configurable:!0,value:this._computeNode()}),this.node}},parent:{get:function(){return Object.defineProperty(this,"parent",{configurable:!0,value:this._computeParent()}),this.parent}},scope:{get:function(){return Object.defineProperty(this,"scope",{configurable:!0,value:this._computeScope()}),this.scope}}}),d.replace=function(){return delete this.node,delete this.parent,delete this.scope,u.prototype.replace.apply(this,arguments)},d.prune=function(){var e=this.parent;return this.replace(),function(e){if(r.VariableDeclaration.check(e.node)){var t=e.get("declarations").value;if(!t||0===t.length)return e.prune()}else if(r.ExpressionStatement.check(e.node)){if(!e.get("expression").value)return e.prune()}else r.IfStatement.check(e.node)&&function(e){var t=e.get("test").value,n=e.get("alternate").value,i=e.get("consequent").value;if(i||n){if(!i&&n){var a=s.unaryExpression("!",t,!0);r.UnaryExpression.check(t)&&"!"===t.operator&&(a=t.argument),e.get("test").replace(a),e.get("consequent").replace(n),e.get("alternate").replace()}}else{var o=s.expressionStatement(t);e.replace(o)}}(e);return e}(e)},d._computeNode=function(){var e=this.value;if(r.Node.check(e))return e;var t=this.parentPath;return t&&t.node||null},d._computeParent=function(){var e=this.value,t=this.parentPath;if(!r.Node.check(e)){for(;t&&!r.Node.check(t.value);)t=t.parentPath;t&&(t=t.parentPath)}for(;t&&!r.Node.check(t.value);)t=t.parentPath;return t||null},d._computeScope=function(){var e=this.value,t=this.parentPath,n=t&&t.scope;return r.Node.check(e)&&c.isEstablishedBy(e)&&(n=new c(this,n)),n||null},d.getValueProperty=function(e){return t.getFieldValue(this.value,e)},d.needsParens=function(e){var t=this.parentPath;if(!t)return!1;var n=this.value;if(!r.Expression.check(n))return!1;if("Identifier"===n.type)return!1;for(;!r.Node.check(t.value);)if(!(t=t.parentPath))return!1;var i=t.value;switch(n.type){case"UnaryExpression":case"SpreadElement":case"SpreadProperty":return"MemberExpression"===i.type&&"object"===this.name&&i.object===n;case"BinaryExpression":case"LogicalExpression":switch(i.type){case"CallExpression":return"callee"===this.name&&i.callee===n;case"UnaryExpression":case"SpreadElement":case"SpreadProperty":return!0;case"MemberExpression":return"object"===this.name&&i.object===n;case"BinaryExpression":case"LogicalExpression":var a=n,s=i.operator,l=f[s],u=a.operator,c=f[u];if(l>c)return!0;if(l===c&&"right"===this.name){if(i.right!==a)throw new Error("Nodes must be equal");return!0}default:return!1}case"SequenceExpression":switch(i.type){case"ForStatement":return!1;case"ExpressionStatement":return"expression"!==this.name;default:return!0}case"YieldExpression":switch(i.type){case"BinaryExpression":case"LogicalExpression":case"UnaryExpression":case"SpreadElement":case"SpreadProperty":case"CallExpression":case"MemberExpression":case"NewExpression":case"ConditionalExpression":case"YieldExpression":return!0;default:return!1}case"Literal":return"MemberExpression"===i.type&&o.check(n.value)&&"object"===this.name&&i.object===n;case"AssignmentExpression":case"ConditionalExpression":switch(i.type){case"UnaryExpression":case"SpreadElement":case"SpreadProperty":case"BinaryExpression":case"LogicalExpression":return!0;case"CallExpression":return"callee"===this.name&&i.callee===n;case"ConditionalExpression":return"test"===this.name&&i.test===n;case"MemberExpression":return"object"===this.name&&i.object===n;default:return!1}default:if("NewExpression"===i.type&&"callee"===this.name&&i.callee===n)return m(n)}return!(!0===e||this.canBeFirstInStatement()||!this.firstInStatement())};var f={};function m(e){return!!r.CallExpression.check(e)||(l.check(e)?e.some(m):!!r.Node.check(e)&&t.someField(e,(function(e,t){return m(t)})))}return[["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"]].forEach((function(e,t){e.forEach((function(e){f[e]=t}))})),d.canBeFirstInStatement=function(){var e=this.node;return!r.FunctionExpression.check(e)&&!r.ObjectExpression.check(e)},d.firstInStatement=function(){return function(e){for(var t,n;e.parent;e=e.parent){if(t=e.node,n=e.parent.node,r.BlockStatement.check(n)&&"body"===e.parent.name&&0===e.name){if(n.body[0]!==t)throw new Error("Nodes must be equal");return!0}if(r.ExpressionStatement.check(n)&&"expression"===e.name){if(n.expression!==t)throw new Error("Nodes must be equal");return!0}if(r.SequenceExpression.check(n)&&"expressions"===e.parent.name&&0===e.name){if(n.expressions[0]!==t)throw new Error("Nodes must be equal")}else if(r.CallExpression.check(n)&&"callee"===e.name){if(n.callee!==t)throw new Error("Nodes must be equal")}else if(r.MemberExpression.check(n)&&"object"===e.name){if(n.object!==t)throw new Error("Nodes must be equal")}else if(r.ConditionalExpression.check(n)&&"test"===e.name){if(n.test!==t)throw new Error("Nodes must be equal")}else if(p(n)&&"left"===e.name){if(n.left!==t)throw new Error("Nodes must be equal")}else{if(!r.UnaryExpression.check(n)||n.prefix||"argument"!==e.name)return!1;if(n.argument!==t)throw new Error("Nodes must be equal")}}return!0}(this)},h},e.exports=t.default}(Jr,Zr)),Zr}function cn(){return an||(an=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(Xr()),i=(0,r.__importDefault)(un()),a=Object.prototype.hasOwnProperty;t.default=function(e){var t=e.use(n.default),r=e.use(i.default),s=t.builtInTypes.array,o=t.builtInTypes.object,l=t.builtInTypes.function,u=function e(){if(!(this instanceof e))throw new Error("PathVisitor constructor cannot be invoked without 'new'");this._reusableContextStack=[],this._methodNameTable=function(e){var r=Object.create(null);for(var n in e)/^visit[A-Z]/.test(n)&&(r[n.slice("visit".length)]=!0);for(var i=t.computeSupertypeLookupTable(r),a=Object.create(null),s=Object.keys(i),o=s.length,u=0;u<o;++u){var c=s[u];n="visit"+i[c],l.check(e[n])&&(a[c]=n)}return a}(this),this._shouldVisitComments=a.call(this._methodNameTable,"Block")||a.call(this._methodNameTable,"Line"),this.Context=p(this),this._visiting=!1,this._changeReported=!1};function c(e,t){for(var r in t)a.call(t,r)&&(e[r]=t[r]);return e}u.fromMethodsObject=function(e){if(e instanceof u)return e;if(!o.check(e))return new u;var t=function e(){if(!(this instanceof e))throw new Error("Visitor constructor cannot be invoked without 'new'");u.call(this)},r=t.prototype=Object.create(h);return r.constructor=t,c(r,e),c(t,u),l.assert(t.fromMethodsObject),l.assert(t.visit),new t},u.visit=function(e,t){return u.fromMethodsObject(t).visit(e)};var h=u.prototype;function d(e,n){if(!(e instanceof r))throw new Error("");if(!(n instanceof u))throw new Error("");var i=e.value;if(s.check(i))e.each(n.visitWithoutReset,n);else if(o.check(i)){var l=t.getFieldNames(i);n._shouldVisitComments&&i.comments&&l.indexOf("comments")<0&&l.push("comments");for(var c=l.length,h=[],d=0;d<c;++d){var p=l[d];a.call(i,p)||(i[p]=t.getFieldValue(i,p)),h.push(e.get(p))}for(d=0;d<c;++d)n.visitWithoutReset(h[d])}else;return e.value}function p(e){function t(n){if(!(this instanceof t))throw new Error("");if(!(this instanceof u))throw new Error("");if(!(n instanceof r))throw new Error("");Object.defineProperty(this,"visitor",{value:e,writable:!1,enumerable:!0,configurable:!1}),this.currentPath=n,this.needToCallTraverse=!0,Object.seal(this)}if(!(e instanceof u))throw new Error("");var n=t.prototype=Object.create(e);return n.constructor=t,c(n,f),t}h.visit=function(){if(this._visiting)throw new Error("Recursively calling visitor.visit(path) resets visitor state. Try this.visit(path) or this.traverse(path) instead.");this._visiting=!0,this._changeReported=!1,this._abortRequested=!1;for(var e,t=arguments.length,n=new Array(t),i=0;i<t;++i)n[i]=arguments[i];n[0]instanceof r||(n[0]=new r({root:n[0]}).get("root")),this.reset.apply(this,n);try{var a=this.visitWithoutReset(n[0]);e=!0}finally{if(this._visiting=!1,!e&&this._abortRequested)return n[0].value}return a},h.AbortRequest=function(){},h.abort=function(){var e=this;e._abortRequested=!0;var t=new e.AbortRequest;throw t.cancel=function(){e._abortRequested=!1},t},h.reset=function(e){},h.visitWithoutReset=function(e){if(this instanceof this.Context)return this.visitor.visitWithoutReset(e);if(!(e instanceof r))throw new Error("");var t=e.value,n=t&&"object"==typeof t&&"string"==typeof t.type&&this._methodNameTable[t.type];if(!n)return d(e,this);var i=this.acquireContext(e);try{return i.invokeVisitorMethod(n)}finally{this.releaseContext(i)}},h.acquireContext=function(e){return 0===this._reusableContextStack.length?new this.Context(e):this._reusableContextStack.pop().reset(e)},h.releaseContext=function(e){if(!(e instanceof this.Context))throw new Error("");this._reusableContextStack.push(e),e.currentPath=null},h.reportChanged=function(){this._changeReported=!0},h.wasChangeReported=function(){return this._changeReported};var f=Object.create(null);return f.reset=function(e){if(!(this instanceof this.Context))throw new Error("");if(!(e instanceof r))throw new Error("");return this.currentPath=e,this.needToCallTraverse=!0,this},f.invokeVisitorMethod=function(e){if(!(this instanceof this.Context))throw new Error("");if(!(this.currentPath instanceof r))throw new Error("");var t=this.visitor[e].call(this,this.currentPath);if(!1===t?this.needToCallTraverse=!1:undefined!==t&&(this.currentPath=this.currentPath.replace(t)[0],this.needToCallTraverse&&this.traverse(this.currentPath)),!1!==this.needToCallTraverse)throw new Error("Must either call this.traverse or return false in "+e);var n=this.currentPath;return n&&n.value},f.traverse=function(e,t){if(!(this instanceof this.Context))throw new Error("");if(!(e instanceof r))throw new Error("");if(!(this.currentPath instanceof r))throw new Error("");return this.needToCallTraverse=!1,d(e,u.fromMethodsObject(t||this.visitor))},f.visit=function(e,t){if(!(this instanceof this.Context))throw new Error("");if(!(e instanceof r))throw new Error("");if(!(this.currentPath instanceof r))throw new Error("");return this.needToCallTraverse=!1,u.fromMethodsObject(t||this.visitor).visitWithoutReset(e)},f.reportChanged=function(){this.visitor.reportChanged()},f.abort=function(){this.needToCallTraverse=!1,this.visitor.abort()},u},e.exports=t.default}(Yr,Kr)),Kr}var hn,dn,pn={},fn={get exports(){return pn},set exports(e){pn=e}};function mn(){return hn||(hn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(0,jr.__importDefault)(Xr());t.default=function(e){var t=e.use(r.default),n=t.getFieldNames,i=t.getFieldValue,a=t.builtInTypes.array,s=t.builtInTypes.object,o=t.builtInTypes.Date,l=t.builtInTypes.RegExp,u=Object.prototype.hasOwnProperty;function c(e,t,r){return a.check(r)?r.length=0:r=null,d(e,t,r)}function h(e){return/[_$a-z][_$a-z0-9]*/i.test(e)?"."+e:"["+JSON.stringify(e)+"]"}function d(e,t,r){return e===t||(a.check(e)?function(e,t,r){a.assert(e);var n=e.length;if(!a.check(t)||t.length!==n)return r&&r.push("length"),!1;for(var i=0;i<n;++i){if(r&&r.push(i),i in e!=i in t)return!1;if(!d(e[i],t[i],r))return!1;if(r){var s=r.pop();if(s!==i)throw new Error(""+s)}}return!0}(e,t,r):s.check(e)?function(e,t,r){if(s.assert(e),!s.check(t))return!1;if(e.type!==t.type)return r&&r.push("type"),!1;var a=n(e),o=a.length,l=n(t),c=l.length;if(o===c){for(var h=0;h<o;++h){var p=a[h],f=i(e,p),m=i(t,p);if(r&&r.push(p),!d(f,m,r))return!1;if(r){var g=r.pop();if(g!==p)throw new Error(""+g)}}return!0}if(!r)return!1;var _=Object.create(null);for(h=0;h<o;++h)_[a[h]]=!0;for(h=0;h<c;++h){if(p=l[h],!u.call(_,p))return r.push(p),!1;delete _[p]}for(p in _){r.push(p);break}return!1}(e,t,r):o.check(e)?o.check(t)&&+e==+t:l.check(e)?l.check(t)&&e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.ignoreCase===t.ignoreCase:e==t)}return c.assert=function(e,t){var r=[];if(!c(e,t,r)){if(0!==r.length)throw new Error("Nodes differ in the following path: "+r.map(h).join(""));if(e!==t)throw new Error("Nodes must be equal")}},c},e.exports=t.default}(fn,pn)),pn}var gn,_n={},vn={get exports(){return _n},set exports(e){_n=e}},yn={},xn={get exports(){return yn},set exports(e){yn=e}};function bn(){return gn||(gn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(0,jr.__importDefault)(Xr());t.default=function(e){var t=e.use(r.default),n=t.Type,i=t.builtInTypes,a=i.number,s=n.or(i.string,i.number,i.boolean,i.null,i.undefined),o=n.from((function(e){if(null===e)return!0;var t=typeof e;return"object"!==t&&"function"!==t}),s.toString());return{geq:function(e){return n.from((function(t){return a.check(t)&&t>=e}),a+" >= "+e)},defaults:{null:function(){return null},emptyArray:function(){return[]},false:function(){return!1},true:function(){return!0},undefined:function(){},"use strict":function(){return"use strict"}},isPrimitive:o}},e.exports=t.default}(xn,yn)),yn}var An,Sn,En,wn,Cn={},Tn={get exports(){return Cn},set exports(e){Cn=e}},Dn={},Mn={get exports(){return Dn},set exports(e){Dn=e}},Pn={},Fn={get exports(){return Pn},set exports(e){Pn=e}},Rn={},Nn={get exports(){return Rn},set exports(e){Rn=e}},Bn={},In={get exports(){return Bn},set exports(e){Bn=e}},On={},kn={get exports(){return On},set exports(e){On=e}};function Ln(){return An||(An=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{BinaryOperators:["==","!=","===","!==","<","<=",">",">=","<<",">>",">>>","+","-","*","/","%","&","|","^","in","instanceof"],AssignmentOperators:["=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","|=","^=","&="],LogicalOperators:["||","&&"]}},e.exports=t.default}(kn,On)),On}function Un(){return Sn||(Sn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(0,jr.__importDefault)(Ln());t.default=function(e){var t=e.use(r.default);return t.BinaryOperators.indexOf("**")<0&&t.BinaryOperators.push("**"),t.AssignmentOperators.indexOf("**=")<0&&t.AssignmentOperators.push("**="),t},e.exports=t.default}(In,Bn)),Bn}function zn(){return En||(En=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(0,jr.__importDefault)(Un());t.default=function(e){var t=e.use(r.default);return t.LogicalOperators.indexOf("??")<0&&t.LogicalOperators.push("??"),t},e.exports=t.default}(Nn,Rn)),Rn}var jn,Vn,Gn,Wn,Hn,qn,Xn,Qn,Kn,Yn,Zn={},Jn={get exports(){return Zn},set exports(e){Zn=e}},$n={},ei={get exports(){return $n},set exports(e){$n=e}},ti={},ri={get exports(){return ti},set exports(e){ti=e}},ni={},ii={get exports(){return ni},set exports(e){ni=e}},ai={},si={get exports(){return ai},set exports(e){ai=e}},oi={},li={get exports(){return oi},set exports(e){oi=e}},ui={},ci={get exports(){return ui},set exports(e){ui=e}};function hi(){return Vn||(Vn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)((jn||(jn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(Ln()),i=(0,r.__importDefault)(Xr()),a=(0,r.__importDefault)(bn());t.default=function(e){var t=e.use(i.default).Type,r=t.def,s=t.or,o=e.use(a.default),l=o.defaults,u=o.geq,c=e.use(n.default),h=c.BinaryOperators,d=c.AssignmentOperators,p=c.LogicalOperators;r("Printable").field("loc",s(r("SourceLocation"),null),l.null,!0),r("Node").bases("Printable").field("type",String).field("comments",s([r("Comment")],null),l.null,!0),r("SourceLocation").field("start",r("Position")).field("end",r("Position")).field("source",s(String,null),l.null),r("Position").field("line",u(1)).field("column",u(0)),r("File").bases("Node").build("program","name").field("program",r("Program")).field("name",s(String,null),l.null),r("Program").bases("Node").build("body").field("body",[r("Statement")]),r("Function").bases("Node").field("id",s(r("Identifier"),null),l.null).field("params",[r("Pattern")]).field("body",r("BlockStatement")).field("generator",Boolean,l.false).field("async",Boolean,l.false),r("Statement").bases("Node"),r("EmptyStatement").bases("Statement").build(),r("BlockStatement").bases("Statement").build("body").field("body",[r("Statement")]),r("ExpressionStatement").bases("Statement").build("expression").field("expression",r("Expression")),r("IfStatement").bases("Statement").build("test","consequent","alternate").field("test",r("Expression")).field("consequent",r("Statement")).field("alternate",s(r("Statement"),null),l.null),r("LabeledStatement").bases("Statement").build("label","body").field("label",r("Identifier")).field("body",r("Statement")),r("BreakStatement").bases("Statement").build("label").field("label",s(r("Identifier"),null),l.null),r("ContinueStatement").bases("Statement").build("label").field("label",s(r("Identifier"),null),l.null),r("WithStatement").bases("Statement").build("object","body").field("object",r("Expression")).field("body",r("Statement")),r("SwitchStatement").bases("Statement").build("discriminant","cases","lexical").field("discriminant",r("Expression")).field("cases",[r("SwitchCase")]).field("lexical",Boolean,l.false),r("ReturnStatement").bases("Statement").build("argument").field("argument",s(r("Expression"),null)),r("ThrowStatement").bases("Statement").build("argument").field("argument",r("Expression")),r("TryStatement").bases("Statement").build("block","handler","finalizer").field("block",r("BlockStatement")).field("handler",s(r("CatchClause"),null),(function(){return this.handlers&&this.handlers[0]||null})).field("handlers",[r("CatchClause")],(function(){return this.handler?[this.handler]:[]}),!0).field("guardedHandlers",[r("CatchClause")],l.emptyArray).field("finalizer",s(r("BlockStatement"),null),l.null),r("CatchClause").bases("Node").build("param","guard","body").field("param",r("Pattern")).field("guard",s(r("Expression"),null),l.null).field("body",r("BlockStatement")),r("WhileStatement").bases("Statement").build("test","body").field("test",r("Expression")).field("body",r("Statement")),r("DoWhileStatement").bases("Statement").build("body","test").field("body",r("Statement")).field("test",r("Expression")),r("ForStatement").bases("Statement").build("init","test","update","body").field("init",s(r("VariableDeclaration"),r("Expression"),null)).field("test",s(r("Expression"),null)).field("update",s(r("Expression"),null)).field("body",r("Statement")),r("ForInStatement").bases("Statement").build("left","right","body").field("left",s(r("VariableDeclaration"),r("Expression"))).field("right",r("Expression")).field("body",r("Statement")),r("DebuggerStatement").bases("Statement").build(),r("Declaration").bases("Statement"),r("FunctionDeclaration").bases("Function","Declaration").build("id","params","body").field("id",r("Identifier")),r("FunctionExpression").bases("Function","Expression").build("id","params","body"),r("VariableDeclaration").bases("Declaration").build("kind","declarations").field("kind",s("var","let","const")).field("declarations",[r("VariableDeclarator")]),r("VariableDeclarator").bases("Node").build("id","init").field("id",r("Pattern")).field("init",s(r("Expression"),null),l.null),r("Expression").bases("Node"),r("ThisExpression").bases("Expression").build(),r("ArrayExpression").bases("Expression").build("elements").field("elements",[s(r("Expression"),null)]),r("ObjectExpression").bases("Expression").build("properties").field("properties",[r("Property")]),r("Property").bases("Node").build("kind","key","value").field("kind",s("init","get","set")).field("key",s(r("Literal"),r("Identifier"))).field("value",r("Expression")),r("SequenceExpression").bases("Expression").build("expressions").field("expressions",[r("Expression")]);var f=s("-","+","!","~","typeof","void","delete");r("UnaryExpression").bases("Expression").build("operator","argument","prefix").field("operator",f).field("argument",r("Expression")).field("prefix",Boolean,l.true);var m=s.apply(void 0,h);r("BinaryExpression").bases("Expression").build("operator","left","right").field("operator",m).field("left",r("Expression")).field("right",r("Expression"));var g=s.apply(void 0,d);r("AssignmentExpression").bases("Expression").build("operator","left","right").field("operator",g).field("left",s(r("Pattern"),r("MemberExpression"))).field("right",r("Expression"));var _=s("++","--");r("UpdateExpression").bases("Expression").build("operator","argument","prefix").field("operator",_).field("argument",r("Expression")).field("prefix",Boolean);var v=s.apply(void 0,p);r("LogicalExpression").bases("Expression").build("operator","left","right").field("operator",v).field("left",r("Expression")).field("right",r("Expression")),r("ConditionalExpression").bases("Expression").build("test","consequent","alternate").field("test",r("Expression")).field("consequent",r("Expression")).field("alternate",r("Expression")),r("NewExpression").bases("Expression").build("callee","arguments").field("callee",r("Expression")).field("arguments",[r("Expression")]),r("CallExpression").bases("Expression").build("callee","arguments").field("callee",r("Expression")).field("arguments",[r("Expression")]),r("MemberExpression").bases("Expression").build("object","property","computed").field("object",r("Expression")).field("property",s(r("Identifier"),r("Expression"))).field("computed",Boolean,(function(){var e=this.property.type;return"Literal"===e||"MemberExpression"===e||"BinaryExpression"===e})),r("Pattern").bases("Node"),r("SwitchCase").bases("Node").build("test","consequent").field("test",s(r("Expression"),null)).field("consequent",[r("Statement")]),r("Identifier").bases("Expression","Pattern").build("name").field("name",String).field("optional",Boolean,l.false),r("Literal").bases("Expression").build("value").field("value",s(String,Boolean,null,Number,RegExp,BigInt)),r("Comment").bases("Printable").field("value",String).field("leading",Boolean,l.true).field("trailing",Boolean,l.false)},e.exports=t.default}(ci,ui)),ui)),i=(0,r.__importDefault)(Xr()),a=(0,r.__importDefault)(bn());t.default=function(e){e.use(n.default);var t=e.use(i.default),r=t.Type.def,s=t.Type.or,o=e.use(a.default).defaults;r("Function").field("generator",Boolean,o.false).field("expression",Boolean,o.false).field("defaults",[s(r("Expression"),null)],o.emptyArray).field("rest",s(r("Identifier"),null),o.null),r("RestElement").bases("Pattern").build("argument").field("argument",r("Pattern")).field("typeAnnotation",s(r("TypeAnnotation"),r("TSTypeAnnotation"),null),o.null),r("SpreadElementPattern").bases("Pattern").build("argument").field("argument",r("Pattern")),r("FunctionDeclaration").build("id","params","body","generator","expression").field("id",s(r("Identifier"),null)),r("FunctionExpression").build("id","params","body","generator","expression"),r("ArrowFunctionExpression").bases("Function","Expression").build("params","body","expression").field("id",null,o.null).field("body",s(r("BlockStatement"),r("Expression"))).field("generator",!1,o.false),r("ForOfStatement").bases("Statement").build("left","right","body").field("left",s(r("VariableDeclaration"),r("Pattern"))).field("right",r("Expression")).field("body",r("Statement")),r("YieldExpression").bases("Expression").build("argument","delegate").field("argument",s(r("Expression"),null)).field("delegate",Boolean,o.false),r("GeneratorExpression").bases("Expression").build("body","blocks","filter").field("body",r("Expression")).field("blocks",[r("ComprehensionBlock")]).field("filter",s(r("Expression"),null)),r("ComprehensionExpression").bases("Expression").build("body","blocks","filter").field("body",r("Expression")).field("blocks",[r("ComprehensionBlock")]).field("filter",s(r("Expression"),null)),r("ComprehensionBlock").bases("Node").build("left","right","each").field("left",r("Pattern")).field("right",r("Expression")).field("each",Boolean),r("Property").field("key",s(r("Literal"),r("Identifier"),r("Expression"))).field("value",s(r("Expression"),r("Pattern"))).field("method",Boolean,o.false).field("shorthand",Boolean,o.false).field("computed",Boolean,o.false),r("ObjectProperty").field("shorthand",Boolean,o.false),r("PropertyPattern").bases("Pattern").build("key","pattern").field("key",s(r("Literal"),r("Identifier"),r("Expression"))).field("pattern",r("Pattern")).field("computed",Boolean,o.false),r("ObjectPattern").bases("Pattern").build("properties").field("properties",[s(r("PropertyPattern"),r("Property"))]),r("ArrayPattern").bases("Pattern").build("elements").field("elements",[s(r("Pattern"),null)]),r("SpreadElement").bases("Node").build("argument").field("argument",r("Expression")),r("ArrayExpression").field("elements",[s(r("Expression"),r("SpreadElement"),r("RestElement"),null)]),r("NewExpression").field("arguments",[s(r("Expression"),r("SpreadElement"))]),r("CallExpression").field("arguments",[s(r("Expression"),r("SpreadElement"))]),r("AssignmentPattern").bases("Pattern").build("left","right").field("left",r("Pattern")).field("right",r("Expression")),r("MethodDefinition").bases("Declaration").build("kind","key","value","static").field("kind",s("constructor","method","get","set")).field("key",r("Expression")).field("value",r("Function")).field("computed",Boolean,o.false).field("static",Boolean,o.false);var l=s(r("MethodDefinition"),r("VariableDeclarator"),r("ClassPropertyDefinition"),r("ClassProperty"));r("ClassProperty").bases("Declaration").build("key").field("key",s(r("Literal"),r("Identifier"),r("Expression"))).field("computed",Boolean,o.false),r("ClassPropertyDefinition").bases("Declaration").build("definition").field("definition",l),r("ClassBody").bases("Declaration").build("body").field("body",[l]),r("ClassDeclaration").bases("Declaration").build("id","body","superClass").field("id",s(r("Identifier"),null)).field("body",r("ClassBody")).field("superClass",s(r("Expression"),null),o.null),r("ClassExpression").bases("Expression").build("id","body","superClass").field("id",s(r("Identifier"),null),o.null).field("body",r("ClassBody")).field("superClass",s(r("Expression"),null),o.null),r("Super").bases("Expression").build(),r("Specifier").bases("Node"),r("ModuleSpecifier").bases("Specifier").field("local",s(r("Identifier"),null),o.null).field("id",s(r("Identifier"),null),o.null).field("name",s(r("Identifier"),null),o.null),r("ImportSpecifier").bases("ModuleSpecifier").build("imported","local").field("imported",r("Identifier")),r("ImportDefaultSpecifier").bases("ModuleSpecifier").build("local"),r("ImportNamespaceSpecifier").bases("ModuleSpecifier").build("local"),r("ImportDeclaration").bases("Declaration").build("specifiers","source","importKind").field("specifiers",[s(r("ImportSpecifier"),r("ImportNamespaceSpecifier"),r("ImportDefaultSpecifier"))],o.emptyArray).field("source",r("Literal")).field("importKind",s("value","type"),(function(){return"value"})),r("ExportNamedDeclaration").bases("Declaration").build("declaration","specifiers","source").field("declaration",s(r("Declaration"),null)).field("specifiers",[r("ExportSpecifier")],o.emptyArray).field("source",s(r("Literal"),null),o.null),r("ExportSpecifier").bases("ModuleSpecifier").build("local","exported").field("exported",r("Identifier")),r("ExportDefaultDeclaration").bases("Declaration").build("declaration").field("declaration",s(r("Declaration"),r("Expression"))),r("ExportAllDeclaration").bases("Declaration").build("source").field("source",r("Literal")),r("TaggedTemplateExpression").bases("Expression").build("tag","quasi").field("tag",r("Expression")).field("quasi",r("TemplateLiteral")),r("TemplateLiteral").bases("Expression").build("quasis","expressions").field("quasis",[r("TemplateElement")]).field("expressions",[r("Expression")]),r("TemplateElement").bases("Node").build("value","tail").field("value",{cooked:String,raw:String}).field("tail",Boolean),r("MetaProperty").bases("Expression").build("meta","property").field("meta",r("Identifier")).field("property",r("Identifier"))},e.exports=t.default}(li,oi)),oi}function di(){return Wn||(Wn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)((Gn||(Gn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(Un()),i=(0,r.__importDefault)(hi());t.default=function(e){e.use(n.default),e.use(i.default)},e.exports=t.default}(si,ai)),ai)),i=(0,r.__importDefault)(Xr()),a=(0,r.__importDefault)(bn());t.default=function(e){e.use(n.default);var t=e.use(i.default).Type.def,r=e.use(a.default).defaults;t("Function").field("async",Boolean,r.false),t("AwaitExpression").bases("Expression").build("argument").field("argument",t("Expression"))},e.exports=t.default}(ii,ni)),ni}function pi(){return qn||(qn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)((Hn||(Hn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(di()),i=(0,r.__importDefault)(Xr()),a=(0,r.__importDefault)(bn());t.default=function(e){e.use(n.default);var t=e.use(i.default),r=t.Type.def,s=t.Type.or,o=e.use(a.default).defaults;r("ForOfStatement").field("await",Boolean,o.false),r("SpreadProperty").bases("Node").build("argument").field("argument",r("Expression")),r("ObjectExpression").field("properties",[s(r("Property"),r("SpreadProperty"),r("SpreadElement"))]),r("TemplateElement").field("value",{cooked:s(String,null),raw:String}),r("SpreadPropertyPattern").bases("Pattern").build("argument").field("argument",r("Pattern")),r("ObjectPattern").field("properties",[s(r("PropertyPattern"),r("Property"),r("RestElement"),r("SpreadPropertyPattern"))])},e.exports=t.default}(ri,ti)),ti)),i=(0,r.__importDefault)(Xr()),a=(0,r.__importDefault)(bn());t.default=function(e){e.use(n.default);var t=e.use(i.default),r=t.Type.def,s=t.Type.or,o=e.use(a.default).defaults;r("CatchClause").field("param",s(r("Pattern"),null),o.null)},e.exports=t.default}(ei,$n)),$n}function fi(){return Qn||(Qn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)((wn||(wn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=(0,jr.__importDefault)(zn());t.default=function(e){var t=e.use(r.default);return t.LogicalOperators.forEach((function(e){var r=e+"=";t.AssignmentOperators.indexOf(r)<0&&t.AssignmentOperators.push(r)})),t},e.exports=t.default}(Fn,Pn)),Pn)),i=(0,r.__importDefault)((Xn||(Xn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(zn()),i=(0,r.__importDefault)(pi()),a=(0,r.__importDefault)(Xr()),s=(0,r.__importDefault)(bn());t.default=function(e){e.use(n.default),e.use(i.default);var t=e.use(a.default),r=t.Type.def,o=t.Type.or,l=e.use(s.default).defaults;r("ImportExpression").bases("Expression").build("source").field("source",r("Expression")),r("ExportAllDeclaration").build("source","exported").field("source",r("Literal")).field("exported",o(r("Identifier"),null)),r("ChainElement").bases("Node").field("optional",Boolean,l.false),r("CallExpression").bases("Expression","ChainElement"),r("MemberExpression").bases("Expression","ChainElement"),r("ChainExpression").bases("Expression").build("expression").field("expression",r("ChainElement")),r("OptionalCallExpression").bases("CallExpression").build("callee","arguments","optional").field("optional",Boolean,l.true),r("OptionalMemberExpression").bases("MemberExpression").build("object","property","computed","optional").field("optional",Boolean,l.true)},e.exports=t.default}(Jn,Zn)),Zn));t.default=function(e){e.use(n.default),e.use(i.default)},e.exports=t.default}(Mn,Dn)),Dn}function mi(){return Yn||(Yn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(Xr()),i=(0,r.__importDefault)(bn()),a=(0,r.__importDefault)((Kn||(Kn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(fi()),i=(0,r.__importDefault)(Xr());t.default=function(e){e.use(n.default);var t=e.use(i.default).Type.def;t("StaticBlock").bases("Declaration").build("body").field("body",[t("Statement")])},e.exports=t.default}(Tn,Cn)),Cn));t.default=function(e){e.use(a.default);var t=e.use(n.default),r=t.Type,s=t.Type.def,o=r.or,l=e.use(i.default).defaults;s("AwaitExpression").build("argument","all").field("argument",o(s("Expression"),null)).field("all",Boolean,l.false),s("Decorator").bases("Node").build("expression").field("expression",s("Expression")),s("Property").field("decorators",o([s("Decorator")],null),l.null),s("MethodDefinition").field("decorators",o([s("Decorator")],null),l.null),s("PrivateName").bases("Expression","Pattern").build("id").field("id",s("Identifier")),s("ClassPrivateProperty").bases("ClassProperty").build("key","value").field("key",s("PrivateName")).field("value",o(s("Expression"),null),l.null),s("ImportAttribute").bases("Node").build("key","value").field("key",o(s("Identifier"),s("Literal"))).field("value",s("Expression")),["ImportDeclaration","ExportAllDeclaration","ExportNamedDeclaration"].forEach((function(e){s(e).field("assertions",[s("ImportAttribute")],l.emptyArray)})),s("RecordExpression").bases("Expression").build("properties").field("properties",[o(s("ObjectProperty"),s("ObjectMethod"),s("SpreadElement"))]),s("TupleExpression").bases("Expression").build("elements").field("elements",[o(s("Expression"),s("SpreadElement"),null)]),s("ModuleExpression").bases("Node").build("body").field("body",s("Program"))},e.exports=t.default}(vn,_n)),_n}var gi,_i={},vi={get exports(){return _i},set exports(e){_i=e}};var yi,xi,bi={},Ai={get exports(){return bi},set exports(e){bi=e}},Si={},Ei={get exports(){return Si},set exports(e){Si=e}};function wi(){return yi||(yi=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(Xr()),i=(0,r.__importDefault)(bn());t.default=function(e){var t=e.use(n.default),r=t.Type.def,a=t.Type.or,s=e.use(i.default).defaults,o=a(r("TypeAnnotation"),r("TSTypeAnnotation"),null),l=a(r("TypeParameterDeclaration"),r("TSTypeParameterDeclaration"),null);r("Identifier").field("typeAnnotation",o,s.null),r("ObjectPattern").field("typeAnnotation",o,s.null),r("Function").field("returnType",o,s.null).field("typeParameters",l,s.null),r("ClassProperty").build("key","value","typeAnnotation","static").field("value",a(r("Expression"),null)).field("static",Boolean,s.false).field("typeAnnotation",o,s.null),["ClassDeclaration","ClassExpression"].forEach((function(e){r(e).field("typeParameters",l,s.null).field("superTypeParameters",a(r("TypeParameterInstantiation"),r("TSTypeParameterInstantiation"),null),s.null).field("implements",a([r("ClassImplements")],[r("TSExpressionWithTypeArguments")]),s.emptyArray)}))},e.exports=t.default}(Ei,Si)),Si}function Ci(){return xi||(xi=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(mi()),i=(0,r.__importDefault)(wi()),a=(0,r.__importDefault)(Xr()),s=(0,r.__importDefault)(bn());t.default=function(e){e.use(n.default),e.use(i.default);var t=e.use(a.default),r=t.Type.def,o=t.Type.or,l=e.use(s.default).defaults;r("Flow").bases("Node"),r("FlowType").bases("Flow"),r("AnyTypeAnnotation").bases("FlowType").build(),r("EmptyTypeAnnotation").bases("FlowType").build(),r("MixedTypeAnnotation").bases("FlowType").build(),r("VoidTypeAnnotation").bases("FlowType").build(),r("SymbolTypeAnnotation").bases("FlowType").build(),r("NumberTypeAnnotation").bases("FlowType").build(),r("BigIntTypeAnnotation").bases("FlowType").build(),r("NumberLiteralTypeAnnotation").bases("FlowType").build("value","raw").field("value",Number).field("raw",String),r("NumericLiteralTypeAnnotation").bases("FlowType").build("value","raw").field("value",Number).field("raw",String),r("BigIntLiteralTypeAnnotation").bases("FlowType").build("value","raw").field("value",null).field("raw",String),r("StringTypeAnnotation").bases("FlowType").build(),r("StringLiteralTypeAnnotation").bases("FlowType").build("value","raw").field("value",String).field("raw",String),r("BooleanTypeAnnotation").bases("FlowType").build(),r("BooleanLiteralTypeAnnotation").bases("FlowType").build("value","raw").field("value",Boolean).field("raw",String),r("TypeAnnotation").bases("Node").build("typeAnnotation").field("typeAnnotation",r("FlowType")),r("NullableTypeAnnotation").bases("FlowType").build("typeAnnotation").field("typeAnnotation",r("FlowType")),r("NullLiteralTypeAnnotation").bases("FlowType").build(),r("NullTypeAnnotation").bases("FlowType").build(),r("ThisTypeAnnotation").bases("FlowType").build(),r("ExistsTypeAnnotation").bases("FlowType").build(),r("ExistentialTypeParam").bases("FlowType").build(),r("FunctionTypeAnnotation").bases("FlowType").build("params","returnType","rest","typeParameters").field("params",[r("FunctionTypeParam")]).field("returnType",r("FlowType")).field("rest",o(r("FunctionTypeParam"),null)).field("typeParameters",o(r("TypeParameterDeclaration"),null)),r("FunctionTypeParam").bases("Node").build("name","typeAnnotation","optional").field("name",o(r("Identifier"),null)).field("typeAnnotation",r("FlowType")).field("optional",Boolean),r("ArrayTypeAnnotation").bases("FlowType").build("elementType").field("elementType",r("FlowType")),r("ObjectTypeAnnotation").bases("FlowType").build("properties","indexers","callProperties").field("properties",[o(r("ObjectTypeProperty"),r("ObjectTypeSpreadProperty"))]).field("indexers",[r("ObjectTypeIndexer")],l.emptyArray).field("callProperties",[r("ObjectTypeCallProperty")],l.emptyArray).field("inexact",o(Boolean,void 0),l[void 0]).field("exact",Boolean,l.false).field("internalSlots",[r("ObjectTypeInternalSlot")],l.emptyArray),r("Variance").bases("Node").build("kind").field("kind",o("plus","minus"));var u=o(r("Variance"),"plus","minus",null);r("ObjectTypeProperty").bases("Node").build("key","value","optional").field("key",o(r("Literal"),r("Identifier"))).field("value",r("FlowType")).field("optional",Boolean).field("variance",u,l.null),r("ObjectTypeIndexer").bases("Node").build("id","key","value").field("id",r("Identifier")).field("key",r("FlowType")).field("value",r("FlowType")).field("variance",u,l.null).field("static",Boolean,l.false),r("ObjectTypeCallProperty").bases("Node").build("value").field("value",r("FunctionTypeAnnotation")).field("static",Boolean,l.false),r("QualifiedTypeIdentifier").bases("Node").build("qualification","id").field("qualification",o(r("Identifier"),r("QualifiedTypeIdentifier"))).field("id",r("Identifier")),r("GenericTypeAnnotation").bases("FlowType").build("id","typeParameters").field("id",o(r("Identifier"),r("QualifiedTypeIdentifier"))).field("typeParameters",o(r("TypeParameterInstantiation"),null)),r("MemberTypeAnnotation").bases("FlowType").build("object","property").field("object",r("Identifier")).field("property",o(r("MemberTypeAnnotation"),r("GenericTypeAnnotation"))),r("IndexedAccessType").bases("FlowType").build("objectType","indexType").field("objectType",r("FlowType")).field("indexType",r("FlowType")),r("OptionalIndexedAccessType").bases("FlowType").build("objectType","indexType","optional").field("objectType",r("FlowType")).field("indexType",r("FlowType")).field("optional",Boolean),r("UnionTypeAnnotation").bases("FlowType").build("types").field("types",[r("FlowType")]),r("IntersectionTypeAnnotation").bases("FlowType").build("types").field("types",[r("FlowType")]),r("TypeofTypeAnnotation").bases("FlowType").build("argument").field("argument",r("FlowType")),r("ObjectTypeSpreadProperty").bases("Node").build("argument").field("argument",r("FlowType")),r("ObjectTypeInternalSlot").bases("Node").build("id","value","optional","static","method").field("id",r("Identifier")).field("value",r("FlowType")).field("optional",Boolean).field("static",Boolean).field("method",Boolean),r("TypeParameterDeclaration").bases("Node").build("params").field("params",[r("TypeParameter")]),r("TypeParameterInstantiation").bases("Node").build("params").field("params",[r("FlowType")]),r("TypeParameter").bases("FlowType").build("name","variance","bound","default").field("name",String).field("variance",u,l.null).field("bound",o(r("TypeAnnotation"),null),l.null).field("default",o(r("FlowType"),null),l.null),r("ClassProperty").field("variance",u,l.null),r("ClassImplements").bases("Node").build("id").field("id",r("Identifier")).field("superClass",o(r("Expression"),null),l.null).field("typeParameters",o(r("TypeParameterInstantiation"),null),l.null),r("InterfaceTypeAnnotation").bases("FlowType").build("body","extends").field("body",r("ObjectTypeAnnotation")).field("extends",o([r("InterfaceExtends")],null),l.null),r("InterfaceDeclaration").bases("Declaration").build("id","body","extends").field("id",r("Identifier")).field("typeParameters",o(r("TypeParameterDeclaration"),null),l.null).field("body",r("ObjectTypeAnnotation")).field("extends",[r("InterfaceExtends")]),r("DeclareInterface").bases("InterfaceDeclaration").build("id","body","extends"),r("InterfaceExtends").bases("Node").build("id").field("id",r("Identifier")).field("typeParameters",o(r("TypeParameterInstantiation"),null),l.null),r("TypeAlias").bases("Declaration").build("id","typeParameters","right").field("id",r("Identifier")).field("typeParameters",o(r("TypeParameterDeclaration"),null)).field("right",r("FlowType")),r("DeclareTypeAlias").bases("TypeAlias").build("id","typeParameters","right"),r("OpaqueType").bases("Declaration").build("id","typeParameters","impltype","supertype").field("id",r("Identifier")).field("typeParameters",o(r("TypeParameterDeclaration"),null)).field("impltype",r("FlowType")).field("supertype",o(r("FlowType"),null)),r("DeclareOpaqueType").bases("OpaqueType").build("id","typeParameters","supertype").field("impltype",o(r("FlowType"),null)),r("TypeCastExpression").bases("Expression").build("expression","typeAnnotation").field("expression",r("Expression")).field("typeAnnotation",r("TypeAnnotation")),r("TupleTypeAnnotation").bases("FlowType").build("types").field("types",[r("FlowType")]),r("DeclareVariable").bases("Statement").build("id").field("id",r("Identifier")),r("DeclareFunction").bases("Statement").build("id").field("id",r("Identifier")).field("predicate",o(r("FlowPredicate"),null),l.null),r("DeclareClass").bases("InterfaceDeclaration").build("id"),r("DeclareModule").bases("Statement").build("id","body").field("id",o(r("Identifier"),r("Literal"))).field("body",r("BlockStatement")),r("DeclareModuleExports").bases("Statement").build("typeAnnotation").field("typeAnnotation",r("TypeAnnotation")),r("DeclareExportDeclaration").bases("Declaration").build("default","declaration","specifiers","source").field("default",Boolean).field("declaration",o(r("DeclareVariable"),r("DeclareFunction"),r("DeclareClass"),r("FlowType"),r("TypeAlias"),r("DeclareOpaqueType"),r("InterfaceDeclaration"),null)).field("specifiers",[o(r("ExportSpecifier"),r("ExportBatchSpecifier"))],l.emptyArray).field("source",o(r("Literal"),null),l.null),r("DeclareExportAllDeclaration").bases("Declaration").build("source").field("source",o(r("Literal"),null),l.null),r("ImportDeclaration").field("importKind",o("value","type","typeof"),(function(){return"value"})),r("FlowPredicate").bases("Flow"),r("InferredPredicate").bases("FlowPredicate").build(),r("DeclaredPredicate").bases("FlowPredicate").build("value").field("value",r("Expression")),r("Function").field("predicate",o(r("FlowPredicate"),null),l.null),r("CallExpression").field("typeArguments",o(null,r("TypeParameterInstantiation")),l.null),r("NewExpression").field("typeArguments",o(null,r("TypeParameterInstantiation")),l.null),r("EnumDeclaration").bases("Declaration").build("id","body").field("id",r("Identifier")).field("body",o(r("EnumBooleanBody"),r("EnumNumberBody"),r("EnumStringBody"),r("EnumSymbolBody"))),r("EnumBooleanBody").build("members","explicitType").field("members",[r("EnumBooleanMember")]).field("explicitType",Boolean),r("EnumNumberBody").build("members","explicitType").field("members",[r("EnumNumberMember")]).field("explicitType",Boolean),r("EnumStringBody").build("members","explicitType").field("members",o([r("EnumStringMember")],[r("EnumDefaultedMember")])).field("explicitType",Boolean),r("EnumSymbolBody").build("members").field("members",[r("EnumDefaultedMember")]),r("EnumBooleanMember").build("id","init").field("id",r("Identifier")).field("init",o(r("Literal"),Boolean)),r("EnumNumberMember").build("id","init").field("id",r("Identifier")).field("init",r("Literal")),r("EnumStringMember").build("id","init").field("id",r("Identifier")).field("init",r("Literal")),r("EnumDefaultedMember").build("id").field("id",r("Identifier"))},e.exports=t.default}(Ai,bi)),bi}var Ti,Di={},Mi={get exports(){return Di},set exports(e){Di=e}};var Pi,Fi,Ri={},Ni={get exports(){return Ri},set exports(e){Ri=e}},Bi={},Ii={get exports(){return Bi},set exports(e){Bi=e}};function Oi(){return Pi||(Pi=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(mi()),i=(0,r.__importDefault)(Xr()),a=(0,r.__importDefault)(bn());t.default=function(e){var t,r,s,o,l;e.use(n.default);var u=e.use(i.default),c=e.use(a.default).defaults,h=u.Type.def,d=u.Type.or,p=u.builtInTypes.undefined;function f(e,t){return void 0===e&&(e=String),["extra",{rawValue:e,raw:String},function(){var e=u.getFieldValue(this,"value");return{rawValue:e,raw:t?t(e):String(e)}}]}h("Noop").bases("Statement").build(),h("DoExpression").bases("Expression").build("body").field("body",[h("Statement")]),h("BindExpression").bases("Expression").build("object","callee").field("object",d(h("Expression"),null)).field("callee",h("Expression")),h("ParenthesizedExpression").bases("Expression").build("expression").field("expression",h("Expression")),h("ExportNamespaceSpecifier").bases("Specifier").build("exported").field("exported",h("Identifier")),h("ExportDefaultSpecifier").bases("Specifier").build("exported").field("exported",h("Identifier")),h("CommentBlock").bases("Comment").build("value","leading","trailing"),h("CommentLine").bases("Comment").build("value","leading","trailing"),h("Directive").bases("Node").build("value").field("value",h("DirectiveLiteral")),h("DirectiveLiteral").bases("Node","Expression").build("value").field("value",String,c["use strict"]),h("InterpreterDirective").bases("Node").build("value").field("value",String),h("BlockStatement").bases("Statement").build("body").field("body",[h("Statement")]).field("directives",[h("Directive")],c.emptyArray),h("Program").bases("Node").build("body").field("body",[h("Statement")]).field("directives",[h("Directive")],c.emptyArray).field("interpreter",d(h("InterpreterDirective"),null),c.null),(t=h("StringLiteral").bases("Literal").build("value").field("value",String)).field.apply(t,f(String,(function(e){return JSON.stringify(e)}))),(r=h("NumericLiteral").bases("Literal").build("value").field("value",Number).field("raw",d(String,null),c.null)).field.apply(r,f(Number)),(s=h("BigIntLiteral").bases("Literal").build("value").field("value",d(String,Number))).field.apply(s,f(String,(function(e){return e+"n"}))),(o=h("DecimalLiteral").bases("Literal").build("value").field("value",String)).field.apply(o,f(String,(function(e){return e+"m"}))),h("NullLiteral").bases("Literal").build().field("value",null,c.null),h("BooleanLiteral").bases("Literal").build("value").field("value",Boolean),(l=h("RegExpLiteral").bases("Literal").build("pattern","flags").field("pattern",String).field("flags",String).field("value",RegExp,(function(){return new RegExp(this.pattern,this.flags)}))).field.apply(l,f(d(RegExp,p),(function(e){return"/".concat(e.pattern,"/").concat(e.flags||"")}))).field("regex",{pattern:String,flags:String},(function(){return{pattern:this.pattern,flags:this.flags}}));var m=d(h("Property"),h("ObjectMethod"),h("ObjectProperty"),h("SpreadProperty"),h("SpreadElement"));h("ObjectExpression").bases("Expression").build("properties").field("properties",[m]),h("ObjectMethod").bases("Node","Function").build("kind","key","params","body","computed").field("kind",d("method","get","set")).field("key",d(h("Literal"),h("Identifier"),h("Expression"))).field("params",[h("Pattern")]).field("body",h("BlockStatement")).field("computed",Boolean,c.false).field("generator",Boolean,c.false).field("async",Boolean,c.false).field("accessibility",d(h("Literal"),null),c.null).field("decorators",d([h("Decorator")],null),c.null),h("ObjectProperty").bases("Node").build("key","value").field("key",d(h("Literal"),h("Identifier"),h("Expression"))).field("value",d(h("Expression"),h("Pattern"))).field("accessibility",d(h("Literal"),null),c.null).field("computed",Boolean,c.false);var g=d(h("MethodDefinition"),h("VariableDeclarator"),h("ClassPropertyDefinition"),h("ClassProperty"),h("ClassPrivateProperty"),h("ClassMethod"),h("ClassPrivateMethod"));h("ClassBody").bases("Declaration").build("body").field("body",[g]),h("ClassMethod").bases("Declaration","Function").build("kind","key","params","body","computed","static").field("key",d(h("Literal"),h("Identifier"),h("Expression"))),h("ClassPrivateMethod").bases("Declaration","Function").build("key","params","body","kind","computed","static").field("key",h("PrivateName")),["ClassMethod","ClassPrivateMethod"].forEach((function(e){h(e).field("kind",d("get","set","method","constructor"),(function(){return"method"})).field("body",h("BlockStatement")).field("computed",Boolean,c.false).field("static",d(Boolean,null),c.null).field("abstract",d(Boolean,null),c.null).field("access",d("public","private","protected",null),c.null).field("accessibility",d("public","private","protected",null),c.null).field("decorators",d([h("Decorator")],null),c.null).field("optional",d(Boolean,null),c.null)}));var _=d(h("Property"),h("PropertyPattern"),h("SpreadPropertyPattern"),h("SpreadProperty"),h("ObjectProperty"),h("RestProperty"));h("ObjectPattern").bases("Pattern").build("properties").field("properties",[_]).field("decorators",d([h("Decorator")],null),c.null),h("SpreadProperty").bases("Node").build("argument").field("argument",h("Expression")),h("RestProperty").bases("Node").build("argument").field("argument",h("Expression")),h("ForAwaitStatement").bases("Statement").build("left","right","body").field("left",d(h("VariableDeclaration"),h("Expression"))).field("right",h("Expression")).field("body",h("Statement")),h("Import").bases("Expression").build()},e.exports=t.default}(Ii,Bi)),Bi}var ki,Li={},Ui={get exports(){return Li},set exports(e){Li=e}};var zi,ji,Vi={};function Gi(){return ji||(ji=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.visit=e.use=e.Type=e.someField=e.PathVisitor=e.Path=e.NodePath=e.namedTypes=e.getSupertypeNames=e.getFieldValue=e.getFieldNames=e.getBuilderName=e.finalize=e.eachField=e.defineMethod=e.builtInTypes=e.builders=e.astNodesAreEquivalent=void 0;var t=jr,r=(0,t.__importDefault)((dn||(dn=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(Xr()),i=(0,r.__importDefault)(cn()),a=(0,r.__importDefault)(mn()),s=(0,r.__importDefault)(tn()),o=(0,r.__importDefault)(un());t.default=function(e){var t=function(){var e=[],t=[];function r(r){var i=e.indexOf(r);return-1===i&&(i=e.length,e.push(r),t[i]=r(n)),t[i]}var n={use:r};return n}(),r=t.use(n.default);e.forEach(t.use),r.finalize();var l=t.use(i.default);return{Type:r.Type,builtInTypes:r.builtInTypes,namedTypes:r.namedTypes,builders:r.builders,defineMethod:r.defineMethod,getFieldNames:r.getFieldNames,getFieldValue:r.getFieldValue,eachField:r.eachField,someField:r.someField,getSupertypeNames:r.getSupertypeNames,getBuilderName:r.getBuilderName,astNodesAreEquivalent:t.use(a.default),finalize:r.finalize,Path:t.use(s.default),NodePath:t.use(o.default),PathVisitor:l,use:t.use,visit:l.visit}},e.exports=t.default}(Hr,Wr)),Wr)),n=(0,t.__importDefault)(mi()),i=(0,t.__importDefault)((gi||(gi=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(mi()),i=(0,r.__importDefault)(Xr()),a=(0,r.__importDefault)(bn());t.default=function(e){e.use(n.default);var t=e.use(i.default),r=t.Type.def,s=t.Type.or,o=e.use(a.default).defaults;r("JSXAttribute").bases("Node").build("name","value").field("name",s(r("JSXIdentifier"),r("JSXNamespacedName"))).field("value",s(r("Literal"),r("JSXExpressionContainer"),r("JSXElement"),r("JSXFragment"),null),o.null),r("JSXIdentifier").bases("Identifier").build("name").field("name",String),r("JSXNamespacedName").bases("Node").build("namespace","name").field("namespace",r("JSXIdentifier")).field("name",r("JSXIdentifier")),r("JSXMemberExpression").bases("MemberExpression").build("object","property").field("object",s(r("JSXIdentifier"),r("JSXMemberExpression"))).field("property",r("JSXIdentifier")).field("computed",Boolean,o.false);var l=s(r("JSXIdentifier"),r("JSXNamespacedName"),r("JSXMemberExpression"));r("JSXSpreadAttribute").bases("Node").build("argument").field("argument",r("Expression"));var u=[s(r("JSXAttribute"),r("JSXSpreadAttribute"))];r("JSXExpressionContainer").bases("Expression").build("expression").field("expression",s(r("Expression"),r("JSXEmptyExpression")));var c=[s(r("JSXText"),r("JSXExpressionContainer"),r("JSXSpreadChild"),r("JSXElement"),r("JSXFragment"),r("Literal"))];r("JSXElement").bases("Expression").build("openingElement","closingElement","children").field("openingElement",r("JSXOpeningElement")).field("closingElement",s(r("JSXClosingElement"),null),o.null).field("children",c,o.emptyArray).field("name",l,(function(){return this.openingElement.name}),!0).field("selfClosing",Boolean,(function(){return this.openingElement.selfClosing}),!0).field("attributes",u,(function(){return this.openingElement.attributes}),!0),r("JSXOpeningElement").bases("Node").build("name","attributes","selfClosing").field("name",l).field("attributes",u,o.emptyArray).field("selfClosing",Boolean,o.false),r("JSXClosingElement").bases("Node").build("name").field("name",l),r("JSXFragment").bases("Expression").build("openingFragment","closingFragment","children").field("openingFragment",r("JSXOpeningFragment")).field("closingFragment",r("JSXClosingFragment")).field("children",c,o.emptyArray),r("JSXOpeningFragment").bases("Node").build(),r("JSXClosingFragment").bases("Node").build(),r("JSXText").bases("Literal").build("value","raw").field("value",String).field("raw",String,(function(){return this.value})),r("JSXEmptyExpression").bases("Node").build(),r("JSXSpreadChild").bases("Node").build("expression").field("expression",r("Expression"))},e.exports=t.default}(vi,_i)),_i)),a=(0,t.__importDefault)(Ci()),s=(0,t.__importDefault)((Ti||(Ti=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(mi()),i=(0,r.__importDefault)(Xr()),a=(0,r.__importDefault)(bn());t.default=function(e){e.use(n.default);var t=e.use(i.default),r=e.use(a.default).defaults,s=t.Type.def,o=t.Type.or;s("VariableDeclaration").field("declarations",[o(s("VariableDeclarator"),s("Identifier"))]),s("Property").field("value",o(s("Expression"),s("Pattern"))),s("ArrayPattern").field("elements",[o(s("Pattern"),s("SpreadElement"),null)]),s("ObjectPattern").field("properties",[o(s("Property"),s("PropertyPattern"),s("SpreadPropertyPattern"),s("SpreadProperty"))]),s("ExportSpecifier").bases("ModuleSpecifier").build("id","name"),s("ExportBatchSpecifier").bases("Specifier").build(),s("ExportDeclaration").bases("Declaration").build("default","declaration","specifiers","source").field("default",Boolean).field("declaration",o(s("Declaration"),s("Expression"),null)).field("specifiers",[o(s("ExportSpecifier"),s("ExportBatchSpecifier"))],r.emptyArray).field("source",o(s("Literal"),null),r.null),s("Block").bases("Comment").build("value","leading","trailing"),s("Line").bases("Comment").build("value","leading","trailing")},e.exports=t.default}(Mi,Di)),Di)),o=(0,t.__importDefault)((Fi||(Fi=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(Xr()),i=(0,r.__importDefault)(Oi()),a=(0,r.__importDefault)(Ci());t.default=function(e){var t=e.use(n.default).Type.def;e.use(i.default),e.use(a.default),t("V8IntrinsicIdentifier").bases("Expression").build("name").field("name",String),t("TopicReference").bases("Expression").build()},e.exports=t.default}(Ni,Ri)),Ri)),l=(0,t.__importDefault)((ki||(ki=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=jr,n=(0,r.__importDefault)(Oi()),i=(0,r.__importDefault)(wi()),a=(0,r.__importDefault)(Xr()),s=(0,r.__importDefault)(bn());t.default=function(e){e.use(n.default),e.use(i.default);var t=e.use(a.default),r=t.namedTypes,o=t.Type.def,l=t.Type.or,u=e.use(s.default).defaults,c=t.Type.from((function(e,t){return!(!r.StringLiteral||!r.StringLiteral.check(e,t))||!(!r.Literal||!r.Literal.check(e,t)||"string"!=typeof e.value)}),"StringLiteral");o("TSType").bases("Node");var h=l(o("Identifier"),o("TSQualifiedName"));o("TSTypeReference").bases("TSType","TSHasOptionalTypeParameterInstantiation").build("typeName","typeParameters").field("typeName",h),o("TSHasOptionalTypeParameterInstantiation").field("typeParameters",l(o("TSTypeParameterInstantiation"),null),u.null),o("TSHasOptionalTypeParameters").field("typeParameters",l(o("TSTypeParameterDeclaration"),null,void 0),u.null),o("TSHasOptionalTypeAnnotation").field("typeAnnotation",l(o("TSTypeAnnotation"),null),u.null),o("TSQualifiedName").bases("Node").build("left","right").field("left",h).field("right",h),o("TSAsExpression").bases("Expression","Pattern").build("expression","typeAnnotation").field("expression",o("Expression")).field("typeAnnotation",o("TSType")).field("extra",l({parenthesized:Boolean},null),u.null),o("TSNonNullExpression").bases("Expression","Pattern").build("expression").field("expression",o("Expression")),["TSAnyKeyword","TSBigIntKeyword","TSBooleanKeyword","TSNeverKeyword","TSNullKeyword","TSNumberKeyword","TSObjectKeyword","TSStringKeyword","TSSymbolKeyword","TSUndefinedKeyword","TSUnknownKeyword","TSVoidKeyword","TSIntrinsicKeyword","TSThisType"].forEach((function(e){o(e).bases("TSType").build()})),o("TSArrayType").bases("TSType").build("elementType").field("elementType",o("TSType")),o("TSLiteralType").bases("TSType").build("literal").field("literal",l(o("NumericLiteral"),o("StringLiteral"),o("BooleanLiteral"),o("TemplateLiteral"),o("UnaryExpression"))),o("TemplateLiteral").field("expressions",l([o("Expression")],[o("TSType")])),["TSUnionType","TSIntersectionType"].forEach((function(e){o(e).bases("TSType").build("types").field("types",[o("TSType")])})),o("TSConditionalType").bases("TSType").build("checkType","extendsType","trueType","falseType").field("checkType",o("TSType")).field("extendsType",o("TSType")).field("trueType",o("TSType")).field("falseType",o("TSType")),o("TSInferType").bases("TSType").build("typeParameter").field("typeParameter",o("TSTypeParameter")),o("TSParenthesizedType").bases("TSType").build("typeAnnotation").field("typeAnnotation",o("TSType"));var d=[l(o("Identifier"),o("RestElement"),o("ArrayPattern"),o("ObjectPattern"))];["TSFunctionType","TSConstructorType"].forEach((function(e){o(e).bases("TSType","TSHasOptionalTypeParameters","TSHasOptionalTypeAnnotation").build("parameters").field("parameters",d)})),o("TSDeclareFunction").bases("Declaration","TSHasOptionalTypeParameters").build("id","params","returnType").field("declare",Boolean,u.false).field("async",Boolean,u.false).field("generator",Boolean,u.false).field("id",l(o("Identifier"),null),u.null).field("params",[o("Pattern")]).field("returnType",l(o("TSTypeAnnotation"),o("Noop"),null),u.null),o("TSDeclareMethod").bases("Declaration","TSHasOptionalTypeParameters").build("key","params","returnType").field("async",Boolean,u.false).field("generator",Boolean,u.false).field("params",[o("Pattern")]).field("abstract",Boolean,u.false).field("accessibility",l("public","private","protected",void 0),u[void 0]).field("static",Boolean,u.false).field("computed",Boolean,u.false).field("optional",Boolean,u.false).field("key",l(o("Identifier"),o("StringLiteral"),o("NumericLiteral"),o("Expression"))).field("kind",l("get","set","method","constructor"),(function(){return"method"})).field("access",l("public","private","protected",void 0),u[void 0]).field("decorators",l([o("Decorator")],null),u.null).field("returnType",l(o("TSTypeAnnotation"),o("Noop"),null),u.null),o("TSMappedType").bases("TSType").build("typeParameter","typeAnnotation").field("readonly",l(Boolean,"+","-"),u.false).field("typeParameter",o("TSTypeParameter")).field("optional",l(Boolean,"+","-"),u.false).field("typeAnnotation",l(o("TSType"),null),u.null),o("TSTupleType").bases("TSType").build("elementTypes").field("elementTypes",[l(o("TSType"),o("TSNamedTupleMember"))]),o("TSNamedTupleMember").bases("TSType").build("label","elementType","optional").field("label",o("Identifier")).field("optional",Boolean,u.false).field("elementType",o("TSType")),o("TSRestType").bases("TSType").build("typeAnnotation").field("typeAnnotation",o("TSType")),o("TSOptionalType").bases("TSType").build("typeAnnotation").field("typeAnnotation",o("TSType")),o("TSIndexedAccessType").bases("TSType").build("objectType","indexType").field("objectType",o("TSType")).field("indexType",o("TSType")),o("TSTypeOperator").bases("TSType").build("operator").field("operator",String).field("typeAnnotation",o("TSType")),o("TSTypeAnnotation").bases("Node").build("typeAnnotation").field("typeAnnotation",l(o("TSType"),o("TSTypeAnnotation"))),o("TSIndexSignature").bases("Declaration","TSHasOptionalTypeAnnotation").build("parameters","typeAnnotation").field("parameters",[o("Identifier")]).field("readonly",Boolean,u.false),o("TSPropertySignature").bases("Declaration","TSHasOptionalTypeAnnotation").build("key","typeAnnotation","optional").field("key",o("Expression")).field("computed",Boolean,u.false).field("readonly",Boolean,u.false).field("optional",Boolean,u.false).field("initializer",l(o("Expression"),null),u.null),o("TSMethodSignature").bases("Declaration","TSHasOptionalTypeParameters","TSHasOptionalTypeAnnotation").build("key","parameters","typeAnnotation").field("key",o("Expression")).field("computed",Boolean,u.false).field("optional",Boolean,u.false).field("parameters",d),o("TSTypePredicate").bases("TSTypeAnnotation","TSType").build("parameterName","typeAnnotation","asserts").field("parameterName",l(o("Identifier"),o("TSThisType"))).field("typeAnnotation",l(o("TSTypeAnnotation"),null),u.null).field("asserts",Boolean,u.false),["TSCallSignatureDeclaration","TSConstructSignatureDeclaration"].forEach((function(e){o(e).bases("Declaration","TSHasOptionalTypeParameters","TSHasOptionalTypeAnnotation").build("parameters","typeAnnotation").field("parameters",d)})),o("TSEnumMember").bases("Node").build("id","initializer").field("id",l(o("Identifier"),c)).field("initializer",l(o("Expression"),null),u.null),o("TSTypeQuery").bases("TSType").build("exprName").field("exprName",l(h,o("TSImportType")));var p=l(o("TSCallSignatureDeclaration"),o("TSConstructSignatureDeclaration"),o("TSIndexSignature"),o("TSMethodSignature"),o("TSPropertySignature"));o("TSTypeLiteral").bases("TSType").build("members").field("members",[p]),o("TSTypeParameter").bases("Identifier").build("name","constraint","default").field("name",String).field("constraint",l(o("TSType"),void 0),u[void 0]).field("default",l(o("TSType"),void 0),u[void 0]),o("TSTypeAssertion").bases("Expression","Pattern").build("typeAnnotation","expression").field("typeAnnotation",o("TSType")).field("expression",o("Expression")).field("extra",l({parenthesized:Boolean},null),u.null),o("TSTypeParameterDeclaration").bases("Declaration").build("params").field("params",[o("TSTypeParameter")]),o("TSTypeParameterInstantiation").bases("Node").build("params").field("params",[o("TSType")]),o("TSEnumDeclaration").bases("Declaration").build("id","members").field("id",o("Identifier")).field("const",Boolean,u.false).field("declare",Boolean,u.false).field("members",[o("TSEnumMember")]).field("initializer",l(o("Expression"),null),u.null),o("TSTypeAliasDeclaration").bases("Declaration","TSHasOptionalTypeParameters").build("id","typeAnnotation").field("id",o("Identifier")).field("declare",Boolean,u.false).field("typeAnnotation",o("TSType")),o("TSModuleBlock").bases("Node").build("body").field("body",[o("Statement")]),o("TSModuleDeclaration").bases("Declaration").build("id","body").field("id",l(c,h)).field("declare",Boolean,u.false).field("global",Boolean,u.false).field("body",l(o("TSModuleBlock"),o("TSModuleDeclaration"),null),u.null),o("TSImportType").bases("TSType","TSHasOptionalTypeParameterInstantiation").build("argument","qualifier","typeParameters").field("argument",c).field("qualifier",l(h,void 0),u[void 0]),o("TSImportEqualsDeclaration").bases("Declaration").build("id","moduleReference").field("id",o("Identifier")).field("isExport",Boolean,u.false).field("moduleReference",l(h,o("TSExternalModuleReference"))),o("TSExternalModuleReference").bases("Declaration").build("expression").field("expression",c),o("TSExportAssignment").bases("Statement").build("expression").field("expression",o("Expression")),o("TSNamespaceExportDeclaration").bases("Declaration").build("id").field("id",o("Identifier")),o("TSInterfaceBody").bases("Node").build("body").field("body",[p]),o("TSExpressionWithTypeArguments").bases("TSType","TSHasOptionalTypeParameterInstantiation").build("expression","typeParameters").field("expression",h),o("TSInterfaceDeclaration").bases("Declaration","TSHasOptionalTypeParameters").build("id","body").field("id",h).field("declare",Boolean,u.false).field("extends",l([o("TSExpressionWithTypeArguments")],null),u.null).field("body",o("TSInterfaceBody")),o("TSParameterProperty").bases("Pattern").build("parameter").field("accessibility",l("public","private","protected",void 0),u[void 0]).field("readonly",Boolean,u.false).field("parameter",l(o("Identifier"),o("AssignmentPattern"))),o("ClassProperty").field("access",l("public","private","protected",void 0),u[void 0]),o("ClassBody").field("body",[l(o("MethodDefinition"),o("VariableDeclarator"),o("ClassPropertyDefinition"),o("ClassProperty"),o("ClassPrivateProperty"),o("ClassMethod"),o("ClassPrivateMethod"),o("TSDeclareMethod"),p)])},e.exports=t.default}(Ui,Li)),Li)),u=(zi||(zi=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.namedTypes=void 0,e.namedTypes||(e.namedTypes={})}(Vi)),Vi);Object.defineProperty(e,"namedTypes",{enumerable:!0,get:function(){return u.namedTypes}});var c=(0,r.default)([n.default,i.default,a.default,s.default,o.default,l.default]),h=c.astNodesAreEquivalent,d=c.builders,p=c.builtInTypes,f=c.defineMethod,m=c.eachField,g=c.finalize,_=c.getBuilderName,v=c.getFieldNames,y=c.getFieldValue,x=c.getSupertypeNames,b=c.namedTypes,A=c.NodePath,S=c.Path,E=c.PathVisitor,w=c.someField,C=c.Type,T=c.use,D=c.visit;e.astNodesAreEquivalent=h,e.builders=d,e.builtInTypes=p,e.defineMethod=f,e.eachField=m,e.finalize=g,e.getBuilderName=_,e.getFieldNames=v,e.getFieldValue=y,e.getSupertypeNames=x,e.NodePath=A,e.Path=S,e.PathVisitor=E,e.someField=w,e.Type=C,e.use=T,e.visit=D,Object.assign(u.namedTypes,b)}(Gr)),Gr}var Wi={},Hi=[],qi=[],Xi="undefined"!=typeof Uint8Array?Uint8Array:Array,Qi=!1;function Ki(){Qi=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)Hi[t]=e[t],qi[e.charCodeAt(t)]=t;qi["-".charCodeAt(0)]=62,qi["_".charCodeAt(0)]=63}function Yi(e,t,r){for(var n,i,a=[],s=t;s<r;s+=3)n=(e[s]<<16)+(e[s+1]<<8)+e[s+2],a.push(Hi[(i=n)>>18&63]+Hi[i>>12&63]+Hi[i>>6&63]+Hi[63&i]);return a.join("")}function Zi(e){var t;Qi||Ki();for(var r=e.length,n=r%3,i="",a=[],s=16383,o=0,l=r-n;o<l;o+=s)a.push(Yi(e,o,o+s>l?l:o+s));return 1===n?(t=e[r-1],i+=Hi[t>>2],i+=Hi[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=Hi[t>>10],i+=Hi[t>>4&63],i+=Hi[t<<2&63],i+="="),a.push(i),a.join("")}function Ji(e,t,r,n,i){var a,s,o=8*i-n-1,l=(1<<o)-1,u=l>>1,c=-7,h=r?i-1:0,d=r?-1:1,p=e[t+h];for(h+=d,a=p&(1<<-c)-1,p>>=-c,c+=o;c>0;a=256*a+e[t+h],h+=d,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=n;c>0;s=256*s+e[t+h],h+=d,c-=8);if(0===a)a=1-u;else{if(a===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),a-=u}return(p?-1:1)*s*Math.pow(2,a-n)}function $i(e,t,r,n,i,a){var s,o,l,u=8*a-i-1,c=(1<<u)-1,h=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:a-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=c?(o=0,s=c):s+h>=1?(o=(t*l-1)*Math.pow(2,i),s+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&o,p+=f,o/=256,i-=8);for(s=s<<i|o,u+=i;u>0;e[r+p]=255&s,p+=f,s/=256,u-=8);e[r+p-f]|=128*m}var ea={}.toString,ta=Array.isArray||function(e){return"[object Array]"==ea.call(e)};function ra(){return ia.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function na(e,t){if(ra()<t)throw new RangeError("Invalid typed array length");return ia.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=ia.prototype:(null===e&&(e=new ia(t)),e.length=t),e}function ia(e,t,r){if(!(ia.TYPED_ARRAY_SUPPORT||this instanceof ia))return new ia(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return oa(this,e)}return aa(this,e,t,r)}function aa(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);ia.TYPED_ARRAY_SUPPORT?(e=t).__proto__=ia.prototype:e=la(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!ia.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|ha(t,r);e=na(e,n);var i=e.write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(ca(t)){var r=0|ua(t.length);return 0===(e=na(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?na(e,0):la(e,t);if("Buffer"===t.type&&ta(t.data))return la(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function sa(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function oa(e,t){if(sa(t),e=na(e,t<0?0:0|ua(t)),!ia.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function la(e,t){var r=t.length<0?0:0|ua(t.length);e=na(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function ua(e){if(e>=ra())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ra().toString(16)+" bytes");return 0|e}function ca(e){return!(null==e||!e._isBuffer)}function ha(e,t){if(ca(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return La(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Ua(e).length;default:if(n)return La(e).length;t=(""+t).toLowerCase(),n=!0}}function da(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Ta(this,t,r);case"utf8":case"utf-8":return Sa(this,t,r);case"ascii":return wa(this,t,r);case"latin1":case"binary":return Ca(this,t,r);case"base64":return Aa(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Da(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function pa(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function fa(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=ia.from(t,n)),ca(t))return 0===t.length?-1:ma(e,t,r,n,i);if("number"==typeof t)return t&=255,ia.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):ma(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function ma(e,t,r,n,i){var a,s=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,o/=2,l/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var c=-1;for(a=r;a<o;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*s}else-1!==c&&(a-=a-c),c=-1}else for(r+l>o&&(r=o-l),a=r;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(u(e,a+d)!==u(t,d)){h=!1;break}if(h)return a}return-1}function ga(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var s=0;s<n;++s){var o=parseInt(t.substr(2*s,2),16);if(isNaN(o))return s;e[r+s]=o}return s}function _a(e,t,r,n){return za(La(t,e.length-r),e,r,n)}function va(e,t,r,n){return za(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function ya(e,t,r,n){return va(e,t,r,n)}function xa(e,t,r,n){return za(Ua(t),e,r,n)}function ba(e,t,r,n){return za(function(e,t){for(var r,n,i,a=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function Aa(e,t,r){return 0===t&&r===e.length?Zi(e):Zi(e.slice(t,r))}function Sa(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,s,o,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:a=e[i+1],s=e[i+2],128==(192&a)&&128==(192&s)&&(l=(15&u)<<12|(63&a)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[i+1],s=e[i+2],o=e[i+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(l=(15&u)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(e){var t=e.length;if(t<=Ea)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Ea));return r}(n)}ia.TYPED_ARRAY_SUPPORT=void 0===global.TYPED_ARRAY_SUPPORT||global.TYPED_ARRAY_SUPPORT,ra(),ia.poolSize=8192,ia._augment=function(e){return e.__proto__=ia.prototype,e},ia.from=function(e,t,r){return aa(null,e,t,r)},ia.TYPED_ARRAY_SUPPORT&&(ia.prototype.__proto__=Uint8Array.prototype,ia.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&ia[Symbol.species]),ia.alloc=function(e,t,r){return function(e,t,r,n){return sa(t),t<=0?na(e,t):void 0!==r?"string"==typeof n?na(e,t).fill(r,n):na(e,t).fill(r):na(e,t)}(null,e,t,r)},ia.allocUnsafe=function(e){return oa(null,e)},ia.allocUnsafeSlow=function(e){return oa(null,e)},ia.isBuffer=ja,ia.compare=function(e,t){if(!ca(e)||!ca(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},ia.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ia.concat=function(e,t){if(!ta(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return ia.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=ia.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(!ca(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},ia.byteLength=ha,ia.prototype._isBuffer=!0,ia.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)pa(this,t,t+1);return this},ia.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)pa(this,t,t+3),pa(this,t+1,t+2);return this},ia.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)pa(this,t,t+7),pa(this,t+1,t+6),pa(this,t+2,t+5),pa(this,t+3,t+4);return this},ia.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Sa(this,0,e):da.apply(this,arguments)},ia.prototype.equals=function(e){if(!ca(e))throw new TypeError("Argument must be a Buffer");return this===e||0===ia.compare(this,e)},ia.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},ia.prototype.compare=function(e,t,r,n,i){if(!ca(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),o=Math.min(a,s),l=this.slice(n,i),u=e.slice(t,r),c=0;c<o;++c)if(l[c]!==u[c]){a=l[c],s=u[c];break}return a<s?-1:s<a?1:0},ia.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},ia.prototype.indexOf=function(e,t,r){return fa(this,e,t,r,!0)},ia.prototype.lastIndexOf=function(e,t,r){return fa(this,e,t,r,!1)},ia.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return ga(this,e,t,r);case"utf8":case"utf-8":return _a(this,e,t,r);case"ascii":return va(this,e,t,r);case"latin1":case"binary":return ya(this,e,t,r);case"base64":return xa(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ba(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},ia.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Ea=4096;function wa(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function Ca(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function Ta(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=ka(e[a]);return i}function Da(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function Ma(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function Pa(e,t,r,n,i,a){if(!ca(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function Fa(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function Ra(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function Na(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function Ba(e,t,r,n,i){return i||Na(e,0,r,4),$i(e,t,r,n,23,4),r+4}function Ia(e,t,r,n,i){return i||Na(e,0,r,8),$i(e,t,r,n,52,8),r+8}ia.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),ia.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=ia.prototype;else{var i=t-e;r=new ia(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},ia.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||Ma(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},ia.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||Ma(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},ia.prototype.readUInt8=function(e,t){return t||Ma(e,1,this.length),this[e]},ia.prototype.readUInt16LE=function(e,t){return t||Ma(e,2,this.length),this[e]|this[e+1]<<8},ia.prototype.readUInt16BE=function(e,t){return t||Ma(e,2,this.length),this[e]<<8|this[e+1]},ia.prototype.readUInt32LE=function(e,t){return t||Ma(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},ia.prototype.readUInt32BE=function(e,t){return t||Ma(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},ia.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||Ma(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},ia.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||Ma(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},ia.prototype.readInt8=function(e,t){return t||Ma(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},ia.prototype.readInt16LE=function(e,t){t||Ma(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},ia.prototype.readInt16BE=function(e,t){t||Ma(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},ia.prototype.readInt32LE=function(e,t){return t||Ma(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},ia.prototype.readInt32BE=function(e,t){return t||Ma(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},ia.prototype.readFloatLE=function(e,t){return t||Ma(e,4,this.length),Ji(this,e,!0,23,4)},ia.prototype.readFloatBE=function(e,t){return t||Ma(e,4,this.length),Ji(this,e,!1,23,4)},ia.prototype.readDoubleLE=function(e,t){return t||Ma(e,8,this.length),Ji(this,e,!0,52,8)},ia.prototype.readDoubleBE=function(e,t){return t||Ma(e,8,this.length),Ji(this,e,!1,52,8)},ia.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||Pa(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},ia.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||Pa(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},ia.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||Pa(this,e,t,1,255,0),ia.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},ia.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||Pa(this,e,t,2,65535,0),ia.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Fa(this,e,t,!0),t+2},ia.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||Pa(this,e,t,2,65535,0),ia.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Fa(this,e,t,!1),t+2},ia.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||Pa(this,e,t,4,4294967295,0),ia.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Ra(this,e,t,!0),t+4},ia.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||Pa(this,e,t,4,4294967295,0),ia.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Ra(this,e,t,!1),t+4},ia.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);Pa(this,e,t,r,i-1,-i)}var a=0,s=1,o=0;for(this[t]=255&e;++a<r&&(s*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+r},ia.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);Pa(this,e,t,r,i-1,-i)}var a=r-1,s=1,o=0;for(this[t+a]=255&e;--a>=0&&(s*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+r},ia.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||Pa(this,e,t,1,127,-128),ia.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},ia.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||Pa(this,e,t,2,32767,-32768),ia.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Fa(this,e,t,!0),t+2},ia.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||Pa(this,e,t,2,32767,-32768),ia.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Fa(this,e,t,!1),t+2},ia.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||Pa(this,e,t,4,2147483647,-2147483648),ia.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Ra(this,e,t,!0),t+4},ia.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||Pa(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),ia.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Ra(this,e,t,!1),t+4},ia.prototype.writeFloatLE=function(e,t,r){return Ba(this,e,t,!0,r)},ia.prototype.writeFloatBE=function(e,t,r){return Ba(this,e,t,!1,r)},ia.prototype.writeDoubleLE=function(e,t,r){return Ia(this,e,t,!0,r)},ia.prototype.writeDoubleBE=function(e,t,r){return Ia(this,e,t,!1,r)},ia.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!ia.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},ia.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!ia.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=ca(e)?e:La(new ia(e,n).toString()),o=s.length;for(a=0;a<r-t;++a)this[a+t]=s[a%o]}return this};var Oa=/[^+\/0-9A-Za-z-_]/g;function ka(e){return e<16?"0"+e.toString(16):e.toString(16)}function La(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function Ua(e){return function(e){var t,r,n,i,a,s;Qi||Ki();var o=e.length;if(o%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a="="===e[o-2]?2:"="===e[o-1]?1:0,s=new Xi(3*o/4-a),n=a>0?o-4:o;var l=0;for(t=0,r=0;t<n;t+=4,r+=3)i=qi[e.charCodeAt(t)]<<18|qi[e.charCodeAt(t+1)]<<12|qi[e.charCodeAt(t+2)]<<6|qi[e.charCodeAt(t+3)],s[l++]=i>>16&255,s[l++]=i>>8&255,s[l++]=255&i;return 2===a?(i=qi[e.charCodeAt(t)]<<2|qi[e.charCodeAt(t+1)]>>4,s[l++]=255&i):1===a&&(i=qi[e.charCodeAt(t)]<<10|qi[e.charCodeAt(t+1)]<<4|qi[e.charCodeAt(t+2)]>>2,s[l++]=i>>8&255,s[l++]=255&i),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(Oa,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function za(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function ja(e){return null!=e&&(!!e._isBuffer||Va(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Va(e.slice(0,0))}(e))}function Va(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var Ga=global.performance||{};Ga.now||Ga.mozNow||Ga.msNow||Ga.oNow||Ga.webkitNow;var Wa="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e};function Ha(e,t){var r={seen:[],stylize:Xa};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),Za(t)?r.showHidden=t:t&&function(e,t){if(!t||!rs(t))return e;var r=Object.keys(t),n=r.length;for(;n--;)e[r[n]]=t[r[n]]}(r,t),es(r.showHidden)&&(r.showHidden=!1),es(r.depth)&&(r.depth=2),es(r.colors)&&(r.colors=!1),es(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=qa),Qa(r,e,r.depth)}function qa(e,t){var r=Ha.styles[t];return r?"["+Ha.colors[r][0]+"m"+e+"["+Ha.colors[r][1]+"m":e}function Xa(e,t){return e}function Qa(e,t,r){if(e.customInspect&&t&&as(t.inspect)&&t.inspect!==Ha&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return $a(n)||(n=Qa(e,n,r)),n}var i=function(e,t){if(es(t))return e.stylize("undefined","undefined");if($a(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(n=t,"number"==typeof n)return e.stylize(""+t,"number");var n;if(Za(t))return e.stylize(""+t,"boolean");if(Ja(t))return e.stylize("null","null")}(e,t);if(i)return i;var a=Object.keys(t),s=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),is(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return Ka(t);if(0===a.length){if(as(t)){var o=t.name?": "+t.name:"";return e.stylize("[Function"+o+"]","special")}if(ts(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(ns(t))return e.stylize(Date.prototype.toString.call(t),"date");if(is(t))return Ka(t)}var l,u,c="",h=!1,d=["{","}"];(l=t,Array.isArray(l)&&(h=!0,d=["[","]"]),as(t))&&(c=" [Function"+(t.name?": "+t.name:"")+"]");return ts(t)&&(c=" "+RegExp.prototype.toString.call(t)),ns(t)&&(c=" "+Date.prototype.toUTCString.call(t)),is(t)&&(c=" "+Ka(t)),0!==a.length||h&&0!=t.length?r<0?ts(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=h?function(e,t,r,n,i){for(var a=[],s=0,o=t.length;s<o;++s)ls(t,String(s))?a.push(Ya(e,t,r,n,String(s),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(Ya(e,t,r,n,i,!0))})),a}(e,t,r,s,a):a.map((function(n){return Ya(e,t,r,s,n,h)})),e.seen.pop(),function(e,t,r){var n=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(n>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,c,d)):d[0]+c+d[1]}function Ka(e){return"["+Error.prototype.toString.call(e)+"]"}function Ya(e,t,r,n,i,a){var s,o,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?o=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(o=e.stylize("[Setter]","special")),ls(n,i)||(s="["+i+"]"),o||(e.seen.indexOf(l.value)<0?(o=Ja(r)?Qa(e,l.value,null):Qa(e,l.value,r-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+o.split("\n").map((function(e){return"   "+e})).join("\n")):o=e.stylize("[Circular]","special")),es(s)){if(a&&i.match(/^\d+$/))return o;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+o}function Za(e){return"boolean"==typeof e}function Ja(e){return null===e}function $a(e){return"string"==typeof e}function es(e){return void 0===e}function ts(e){return rs(e)&&"[object RegExp]"===os(e)}function rs(e){return"object"==typeof e&&null!==e}function ns(e){return rs(e)&&"[object Date]"===os(e)}function is(e){return rs(e)&&("[object Error]"===os(e)||e instanceof Error)}function as(e){return"function"==typeof e}function ss(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function os(e){return Object.prototype.toString.call(e)}function ls(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function us(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}Ha.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Ha.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var cs,hs=Object.prototype.hasOwnProperty,ds=Object.keys||function(e){var t=[];for(var r in e)hs.call(e,r)&&t.push(r);return t},ps=Array.prototype.slice;function fs(){return void 0!==cs?cs:cs="foo"===function(){}.name}function ms(e){return Object.prototype.toString.call(e)}function gs(e){return!ja(e)&&("function"==typeof global.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}function _s(e,t){e||Ss(e,!0,t,"==",Es)}var vs=/\s*function\s+([^\(\s]*)\s*/;function ys(e){if(as(e)){if(fs())return e.name;var t=e.toString().match(vs);return t&&t[1]}}function xs(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return bs(As(e.actual),128)+" "+e.operator+" "+bs(As(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||Ss;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,i=ys(t),a=n.indexOf("\n"+i);if(a>=0){var s=n.indexOf("\n",a+1);n=n.substring(s+1)}this.stack=n}}}function bs(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function As(e){if(fs()||!as(e))return Ha(e);var t=ys(e);return"[Function"+(t?": "+t:"")+"]"}function Ss(e,t,r,n,i){throw new xs({message:r,actual:e,expected:t,operator:n,stackStartFunction:i})}function Es(e,t){e||Ss(e,!0,t,"==",Es)}function ws(e,t,r){e!=t&&Ss(e,t,r,"==",ws)}function Cs(e,t,r){e==t&&Ss(e,t,r,"!=",Cs)}function Ts(e,t,r){Ms(e,t,!1)||Ss(e,t,r,"deepEqual",Ts)}function Ds(e,t,r){Ms(e,t,!0)||Ss(e,t,r,"deepStrictEqual",Ds)}function Ms(e,t,r,n){if(e===t)return!0;if(ja(e)&&ja(t))return 0===us(e,t);if(ns(e)&&ns(t))return e.getTime()===t.getTime();if(ts(e)&&ts(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(gs(e)&&gs(t)&&ms(e)===ms(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===us(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(ja(e)!==ja(t))return!1;var i=(n=n||{actual:[],expected:[]}).actual.indexOf(e);return-1!==i&&i===n.expected.indexOf(t)||(n.actual.push(e),n.expected.push(t),function(e,t,r,n){if(null==e||null==t)return!1;if(ss(e)||ss(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=Ps(e),a=Ps(t);if(i&&!a||!i&&a)return!1;if(i)return Ms(e=ps.call(e),t=ps.call(t),r);var s,o,l=ds(e),u=ds(t);if(l.length!==u.length)return!1;for(l.sort(),u.sort(),o=l.length-1;o>=0;o--)if(l[o]!==u[o])return!1;for(o=l.length-1;o>=0;o--)if(!Ms(e[s=l[o]],t[s],r,n))return!1;return!0}(e,t,r,n))}return r?e===t:e==t}function Ps(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function Fs(e,t,r){Ms(e,t,!1)&&Ss(e,t,r,"notDeepEqual",Fs)}function Rs(e,t,r){Ms(e,t,!0)&&Ss(e,t,r,"notDeepStrictEqual",Rs)}function Ns(e,t,r){e!==t&&Ss(e,t,r,"===",Ns)}function Bs(e,t,r){e===t&&Ss(e,t,r,"!==",Bs)}function Is(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function Os(e,t,r,n){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!i&&Ss(i,r,"Missing expected exception"+n);var a="string"==typeof n,s=!e&&i&&!r;if((!e&&is(i)&&a&&Is(i,r)||s)&&Ss(i,r,"Got unwanted exception"+n),e&&i&&r&&!Is(i,r)||!e&&i)throw i}function ks(e,t,r){Os(!0,e,t,r)}function Ls(e,t,r){Os(!1,e,t,r)}function Us(e){if(e)throw e}_s.AssertionError=xs,Wa(xs,Error),_s.fail=Ss,_s.ok=Es,_s.equal=ws,_s.notEqual=Cs,_s.deepEqual=Ts,_s.deepStrictEqual=Ds,_s.notDeepEqual=Fs,_s.notDeepStrictEqual=Rs,_s.strictEqual=Ns,_s.notStrictEqual=Bs,_s.throws=ks,_s.doesNotThrow=Ls,_s.ifError=Us;var zs,js=R(Object.freeze({__proto__:null,AssertionError:xs,assert:Es,deepEqual:Ts,deepStrictEqual:Ds,default:_s,doesNotThrow:Ls,equal:ws,fail:Ss,ifError:Us,notDeepEqual:Fs,notDeepStrictEqual:Rs,notEqual:Cs,notStrictEqual:Bs,ok:Es,strictEqual:Ns,throws:ks})),Vs={},Gs={};function Ws(){if(void 0===zs){var e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e);if(t[0]=1,t[1]=2,258===r[0])zs="BE";else{if(513!==r[0])throw new Error("unable to figure out endianess");zs="LE"}}return zs}function Hs(){return void 0!==global.location?global.location.hostname:""}function qs(){return[]}function Xs(){return 0}function Qs(){return Number.MAX_VALUE}function Ks(){return Number.MAX_VALUE}function Ys(){return[]}function Zs(){return"Browser"}function Js(){return void 0!==global.navigator?global.navigator.appVersion:""}function $s(){}function eo(){}function to(){return"/tmp"}var ro,no=to,io={EOL:"\n",tmpdir:no,tmpDir:to,networkInterfaces:$s,getNetworkInterfaces:eo,release:Js,type:Zs,cpus:Ys,totalmem:Ks,freemem:Qs,uptime:Xs,loadavg:qs,hostname:Hs,endianness:Ws},ao=R(Object.freeze({__proto__:null,EOL:"\n",arch:function(){return"javascript"},cpus:Ys,default:io,endianness:Ws,freemem:Qs,getNetworkInterfaces:eo,hostname:Hs,loadavg:qs,networkInterfaces:$s,platform:function(){return"browser"},release:Js,tmpDir:to,tmpdir:no,totalmem:Ks,type:Zs,uptime:Xs}));function so(){if(ro)return Gs;ro=1,Object.defineProperty(Gs,"__esModule",{value:!0}),Gs.isTrailingCommaEnabled=Gs.getParentExportDeclaration=Gs.isExportDeclaration=Gs.fixFaultyLocations=Gs.getTrueLoc=Gs.composeSourceMaps=Gs.copyPos=Gs.comparePos=Gs.getUnionOfKeys=Gs.getOption=Gs.isBrowser=Gs.getLineTerminator=void 0;var e=jr,t=e.__importDefault(js),r=e.__importStar(Gi()).namedTypes,n=e.__importDefault(wt()),i=n.default.SourceMapConsumer,a=n.default.SourceMapGenerator,s=Object.prototype.hasOwnProperty;function o(){return"undefined"!=typeof window&&void 0!==window.document}function l(e,t){return e.line-t.line||e.column-t.column}function u(e){return{line:e.line,column:e.column}}function c(e,t){e&&t&&(l(t.start,e.start)<0&&(e.start=t.start),l(e.end,t.end)<0&&(e.end=t.end))}function h(e){if(e)switch(e.type){case"ExportDeclaration":case"ExportDefaultDeclaration":case"ExportDefaultSpecifier":case"DeclareExportDeclaration":case"ExportNamedDeclaration":case"ExportAllDeclaration":return!0}return!1}return Gs.getLineTerminator=function(){return o()?"\n":ao.EOL||"\n"},Gs.isBrowser=o,Gs.getOption=function(e,t,r){return e&&s.call(e,t)?e[t]:r},Gs.getUnionOfKeys=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r={},n=e.length,i=0;i<n;++i)for(var a=Object.keys(e[i]),s=a.length,o=0;o<s;++o)r[a[o]]=!0;return r},Gs.comparePos=l,Gs.copyPos=u,Gs.composeSourceMaps=function(e,t){if(!e)return t||null;if(!t)return e;var r=new i(e),n=new i(t),o=new a({file:t.file,sourceRoot:t.sourceRoot}),l={};return n.eachMapping((function(e){var t=r.originalPositionFor({line:e.originalLine,column:e.originalColumn}),n=t.source;if(null!==n){o.addMapping({source:n,original:u(t),generated:{line:e.generatedLine,column:e.generatedColumn},name:e.name});var i=r.sourceContentFor(n);i&&!s.call(l,n)&&(l[n]=i,o.setSourceContent(n,i))}})),o.toJSON()},Gs.getTrueLoc=function(e,t){if(!e.loc)return null;var r={start:e.loc.start,end:e.loc.end};function n(e){c(r,e.loc)}return e.declaration&&e.declaration.decorators&&h(e)&&e.declaration.decorators.forEach(n),l(r.start,r.end)<0&&(r.start=u(r.start),t.skipSpaces(r.start,!1,!0),l(r.start,r.end)<0&&(r.end=u(r.end),t.skipSpaces(r.end,!0,!0))),e.comments&&e.comments.forEach(n),r},Gs.fixFaultyLocations=function(e,n){var i=e.loc;if(i&&(i.start.line<1&&(i.start.line=1),i.end.line<1&&(i.end.line=1)),"File"===e.type&&(i.start=n.firstPos(),i.end=n.lastPos()),function(e,t){if("ForStatement"!==e.type)return;function r(e){for(var r=e&&e.loc,n=r&&r.start,i=r&&u(r.end);n&&i&&l(n,i)<0&&(t.prevPos(i),";"===t.charAt(i));)r.end.line=i.line,r.end.column=i.column}r(e.init),r(e.test),r(e.update)}(e,n),function(e,r){if("TemplateLiteral"!==e.type)return;if(0===e.quasis.length)return;if(e.loc){var n=u(e.loc.start);t.default.strictEqual(r.charAt(n),"`"),t.default.ok(r.nextPos(n));var i=e.quasis[0];l(i.loc.start,n)<0&&(i.loc.start=n);var a=u(e.loc.end);t.default.ok(r.prevPos(a)),t.default.strictEqual(r.charAt(a),"`");var s=e.quasis[e.quasis.length-1];l(a,s.loc.end)<0&&(s.loc.end=a)}e.expressions.forEach((function(n,i){var a=r.skipSpaces(n.loc.start,!0,!1);if(r.prevPos(a)&&"{"===r.charAt(a)&&r.prevPos(a)&&"$"===r.charAt(a)){var s=e.quasis[i];l(a,s.loc.end)<0&&(s.loc.end=a)}var o=r.skipSpaces(n.loc.end,!1,!1);if("}"===r.charAt(o)){t.default.ok(r.nextPos(o));var u=e.quasis[i+1];l(u.loc.start,o)<0&&(u.loc.start=o)}}))}(e,n),i&&e.decorators)e.decorators.forEach((function(e){c(i,e.loc)}));else if(e.declaration&&h(e)){e.declaration.loc=null;var a=e.declaration.decorators;a&&a.forEach((function(e){c(i,e.loc)}))}else if(r.MethodDefinition&&r.MethodDefinition.check(e)||r.Property.check(e)&&(e.method||e.shorthand))e.value.loc=null,r.FunctionExpression.check(e.value)&&(e.value.id=null);else if("ObjectTypeProperty"===e.type){var s=e.loc,o=s&&s.end;o&&(o=u(o),n.prevPos(o)&&","===n.charAt(o)&&(o=n.skipSpaces(o,!0,!0))&&(s.end=o))}},Gs.isExportDeclaration=h,Gs.getParentExportDeclaration=function(e){var t=e.getParentNode();return"declaration"===e.getName()&&h(t)?t:null},Gs.isTrailingCommaEnabled=function(e,t){var r=e.trailingComma;return"object"==typeof r?!!r[t]:!!r},Gs}var oo,lo,uo={};function co(){if(oo)return uo;oo=1,Object.defineProperty(uo,"__esModule",{value:!0}),uo.parse=void 0;var e=so();return uo.parse=function(t,r){var n=[],i=Ue.parse(t,{loc:!0,locations:!0,comment:!0,onComment:n,range:e.getOption(r,"range",!1),tolerant:e.getOption(r,"tolerant",!0),tokens:!0,jsx:e.getOption(r,"jsx",!1),sourceType:e.getOption(r,"sourceType","module")});return Array.isArray(i.comments)||(i.comments=n),i},uo}function ho(){if(lo)return Vs;lo=1,Object.defineProperty(Vs,"__esModule",{value:!0}),Vs.normalize=void 0;var e=so(),t={parser:co(),tabWidth:4,useTabs:!1,reuseWhitespace:!0,lineTerminator:e.getLineTerminator(),wrapColumn:74,sourceFileName:null,sourceMapName:null,sourceRoot:null,inputSourceMap:null,range:!1,tolerant:!0,quote:null,trailingComma:!1,arrayBracketSpacing:!1,objectCurlySpacing:!0,arrowParensAlways:!1,flowObjectCommas:!0,tokens:!0},r=t.hasOwnProperty;return Vs.normalize=function(e){var n=e||t;function i(e){return r.call(n,e)?n[e]:t[e]}return{tabWidth:+i("tabWidth"),useTabs:!!i("useTabs"),reuseWhitespace:!!i("reuseWhitespace"),lineTerminator:i("lineTerminator"),wrapColumn:Math.max(i("wrapColumn"),0),sourceFileName:i("sourceFileName"),sourceMapName:i("sourceMapName"),sourceRoot:i("sourceRoot"),inputSourceMap:i("inputSourceMap"),parser:i("esprima")||i("parser"),range:i("range"),tolerant:i("tolerant"),quote:i("quote"),trailingComma:i("trailingComma"),arrayBracketSpacing:i("arrayBracketSpacing"),objectCurlySpacing:i("objectCurlySpacing"),arrowParensAlways:i("arrowParensAlways"),flowObjectCommas:i("flowObjectCommas"),tokens:!!i("tokens")}},Vs}var po,fo,mo={},go={};function _o(){if(po)return go;po=1,Object.defineProperty(go,"__esModule",{value:!0});var e=jr.__importDefault(js),t=so(),r=function(){function r(e,t,r){void 0===r&&(r=t),this.sourceLines=e,this.sourceLoc=t,this.targetLoc=r}return r.prototype.slice=function(n,a,s){void 0===s&&(s=n.lastPos());var o=this.sourceLines,l=this.sourceLoc,u=this.targetLoc;function c(r){var i=l[r],c=u[r],h=a;return"end"===r?h=s:e.default.strictEqual(r,"start"),function(r,n,i,a,s){var o,l,u=t.comparePos(a,s);if(0===u)return n;if(u<0){o=r.skipSpaces(n)||r.lastPos(),l=i.skipSpaces(a)||i.lastPos();var c=s.line-l.line;for(o.line+=c,l.line+=c,c>0?(o.column=0,l.column=0):e.default.strictEqual(c,0);t.comparePos(l,s)<0&&i.nextPos(l,!0);)e.default.ok(r.nextPos(o,!0)),e.default.strictEqual(r.charAt(o),i.charAt(l))}else{o=r.skipSpaces(n,!0)||r.firstPos(),l=i.skipSpaces(a,!0)||i.firstPos();c=s.line-l.line;for(o.line+=c,l.line+=c,c<0?(o.column=r.getLineLength(o.line),l.column=i.getLineLength(l.line)):e.default.strictEqual(c,0);t.comparePos(s,l)<0&&i.prevPos(l,!0);)e.default.ok(r.prevPos(o,!0)),e.default.strictEqual(r.charAt(o),i.charAt(l))}return o}(o,i,n,c,h)}if(t.comparePos(a,u.start)<=0)if(t.comparePos(u.end,s)<=0)u={start:i(u.start,a.line,a.column),end:i(u.end,a.line,a.column)};else{if(t.comparePos(s,u.start)<=0)return null;l={start:l.start,end:c("end")},u={start:i(u.start,a.line,a.column),end:i(s,a.line,a.column)}}else{if(t.comparePos(u.end,a)<=0)return null;t.comparePos(u.end,s)<=0?(l={start:c("start"),end:l.end},u={start:{line:1,column:0},end:i(u.end,a.line,a.column)}):(l={start:c("start"),end:c("end")},u={start:{line:1,column:0},end:i(s,a.line,a.column)})}return new r(this.sourceLines,l,u)},r.prototype.add=function(e,t){return new r(this.sourceLines,this.sourceLoc,{start:n(this.targetLoc.start,e,t),end:n(this.targetLoc.end,e,t)})},r.prototype.subtract=function(e,t){return new r(this.sourceLines,this.sourceLoc,{start:i(this.targetLoc.start,e,t),end:i(this.targetLoc.end,e,t)})},r.prototype.indent=function(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!1),0===e)return this;var i=this.targetLoc,a=i.start.line,s=i.end.line;if(t&&1===a&&1===s)return this;if(i={start:i.start,end:i.end},!t||a>1){var o=i.start.column+e;i.start={line:a,column:n?Math.max(0,o):o}}if(!t||s>1){var l=i.end.column+e;i.end={line:s,column:n?Math.max(0,l):l}}return new r(this.sourceLines,this.sourceLoc,i)},r}();function n(e,t,r){return{line:e.line+t-1,column:1===e.line?e.column+r:e.column}}function i(e,t,r){return{line:e.line-t+1,column:e.line===t?e.column-r:e.column}}return go.default=r,go}function vo(){if(fo)return mo;fo=1,Object.defineProperty(mo,"__esModule",{value:!0}),mo.concat=mo.fromString=mo.countSpaces=mo.Lines=void 0;var e=jr,t=e.__importDefault(js),r=e.__importDefault(wt()),n=ho(),i=so(),a=e.__importDefault(_o()),s=function(){function s(e,r){void 0===r&&(r=null),this.infos=e,this.mappings=[],this.cachedSourceMap=null,this.cachedTabWidth=void 0,t.default.ok(e.length>0),this.length=e.length,this.name=r||null,this.name&&this.mappings.push(new a.default(this,{start:this.firstPos(),end:this.lastPos()}))}return s.prototype.toString=function(e){return this.sliceString(this.firstPos(),this.lastPos(),e)},s.prototype.getSourceMap=function(e,n){if(!e)return null;var a=this;function s(t){return(t=t||{}).file=e,n&&(t.sourceRoot=n),t}if(a.cachedSourceMap)return s(a.cachedSourceMap.toJSON());var o=new r.default.SourceMapGenerator(s()),u={};return a.mappings.forEach((function(e){for(var r=e.sourceLines.skipSpaces(e.sourceLoc.start)||e.sourceLines.lastPos(),n=a.skipSpaces(e.targetLoc.start)||a.lastPos();i.comparePos(r,e.sourceLoc.end)<0&&i.comparePos(n,e.targetLoc.end)<0;){var s=e.sourceLines.charAt(r),c=a.charAt(n);t.default.strictEqual(s,c);var h=e.sourceLines.name;if(o.addMapping({source:h,original:{line:r.line,column:r.column},generated:{line:n.line,column:n.column}}),!l.call(u,h)){var d=e.sourceLines.toString();o.setSourceContent(h,d),u[h]=d}a.nextPos(n,!0),e.sourceLines.nextPos(r,!0)}})),a.cachedSourceMap=o,o.toJSON()},s.prototype.bootstrapCharAt=function(e){t.default.strictEqual(typeof e,"object"),t.default.strictEqual(typeof e.line,"number"),t.default.strictEqual(typeof e.column,"number");var r=e.line,n=e.column,i=this.toString().split(d),a=i[r-1];return void 0===a?"":n===a.length&&r<i.length?"\n":n>=a.length?"":a.charAt(n)},s.prototype.charAt=function(e){t.default.strictEqual(typeof e,"object"),t.default.strictEqual(typeof e.line,"number"),t.default.strictEqual(typeof e.column,"number");var r=e.line,n=e.column,i=this.infos[r-1],a=n;if(void 0===i||a<0)return"";var s=this.getIndentAt(r);return a<s?" ":(a+=i.sliceStart-s)===i.sliceEnd&&r<this.length?"\n":a>=i.sliceEnd?"":i.line.charAt(a)},s.prototype.stripMargin=function(r,n){if(0===r)return this;if(t.default.ok(r>0,"negative margin: "+r),n&&1===this.length)return this;var i=new s(this.infos.map((function(t,i){return t.line&&(i>0||!n)&&(t=e.__assign(e.__assign({},t),{indent:Math.max(0,t.indent-r)})),t})));if(this.mappings.length>0){var a=i.mappings;t.default.strictEqual(a.length,0),this.mappings.forEach((function(e){a.push(e.indent(r,n,!0))}))}return i},s.prototype.indent=function(r){if(0===r)return this;var n=new s(this.infos.map((function(t){return t.line&&!t.locked&&(t=e.__assign(e.__assign({},t),{indent:t.indent+r})),t})));if(this.mappings.length>0){var i=n.mappings;t.default.strictEqual(i.length,0),this.mappings.forEach((function(e){i.push(e.indent(r))}))}return n},s.prototype.indentTail=function(r){if(0===r)return this;if(this.length<2)return this;var n=new s(this.infos.map((function(t,n){return n>0&&t.line&&!t.locked&&(t=e.__assign(e.__assign({},t),{indent:t.indent+r})),t})));if(this.mappings.length>0){var i=n.mappings;t.default.strictEqual(i.length,0),this.mappings.forEach((function(e){i.push(e.indent(r,!0))}))}return n},s.prototype.lockIndentTail=function(){return this.length<2?this:new s(this.infos.map((function(t,r){return e.__assign(e.__assign({},t),{locked:r>0})})))},s.prototype.getIndentAt=function(e){return t.default.ok(e>=1,"no line "+e+" (line numbers start from 1)"),Math.max(this.infos[e-1].indent,0)},s.prototype.guessTabWidth=function(){if("number"==typeof this.cachedTabWidth)return this.cachedTabWidth;for(var e=[],t=0,r=1,n=this.length;r<=n;++r){var i=this.infos[r-1];if(!f(i.line.slice(i.sliceStart,i.sliceEnd))){var a=Math.abs(i.indent-t);e[a]=1+~~e[a],t=i.indent}}for(var s=-1,o=2,u=1;u<e.length;u+=1)l.call(e,u)&&e[u]>s&&(s=e[u],o=u);return this.cachedTabWidth=o},s.prototype.startsWithComment=function(){if(0===this.infos.length)return!1;var e=this.infos[0],t=e.sliceStart,r=e.sliceEnd,n=e.line.slice(t,r).trim();return 0===n.length||"//"===n.slice(0,2)||"/*"===n.slice(0,2)},s.prototype.isOnlyWhitespace=function(){return f(this.toString())},s.prototype.isPrecededOnlyByWhitespace=function(e){var t=this.infos[e.line-1],r=Math.max(t.indent,0),n=e.column-r;if(n<=0)return!0;var i=t.sliceStart,a=Math.min(i+n,t.sliceEnd);return f(t.line.slice(i,a))},s.prototype.getLineLength=function(e){var t=this.infos[e-1];return this.getIndentAt(e)+t.sliceEnd-t.sliceStart},s.prototype.nextPos=function(e,t){void 0===t&&(t=!1);var r=Math.max(e.line,0);return Math.max(e.column,0)<this.getLineLength(r)?(e.column+=1,!t||!!this.skipSpaces(e,!1,!0)):r<this.length&&(e.line+=1,e.column=0,!t||!!this.skipSpaces(e,!1,!0))},s.prototype.prevPos=function(e,t){void 0===t&&(t=!1);var r=e.line,n=e.column;if(n<1){if((r-=1)<1)return!1;n=this.getLineLength(r)}else n=Math.min(n-1,this.getLineLength(r));return e.line=r,e.column=n,!t||!!this.skipSpaces(e,!0,!0)},s.prototype.firstPos=function(){return{line:1,column:0}},s.prototype.lastPos=function(){return{line:this.length,column:this.getLineLength(this.length)}},s.prototype.skipSpaces=function(e,t,r){if(void 0===t&&(t=!1),void 0===r&&(r=!1),e=e?r?e:{line:e.line,column:e.column}:t?this.lastPos():this.firstPos(),t){for(;this.prevPos(e);)if(!f(this.charAt(e))&&this.nextPos(e))return e;return null}for(;f(this.charAt(e));)if(!this.nextPos(e))return null;return e},s.prototype.trimLeft=function(){var e=this.skipSpaces(this.firstPos(),!1,!0);return e?this.slice(e):g},s.prototype.trimRight=function(){var e=this.skipSpaces(this.lastPos(),!0,!0);return e?this.slice(this.firstPos(),e):g},s.prototype.trim=function(){var e=this.skipSpaces(this.firstPos(),!1,!0);if(null===e)return g;var t=this.skipSpaces(this.lastPos(),!0,!0);return null===t?g:this.slice(e,t)},s.prototype.eachPos=function(e,t,r){void 0===t&&(t=this.firstPos()),void 0===r&&(r=!1);var n=this.firstPos();if(t&&(n.line=t.line,n.column=t.column),!r||this.skipSpaces(n,!1,!0))do{e.call(this,n)}while(this.nextPos(n,r))},s.prototype.bootstrapSlice=function(e,t){var r=this.toString().split(d).slice(e.line-1,t.line);return r.length>0&&(r.push(r.pop().slice(0,t.column)),r[0]=r[0].slice(e.column)),p(r.join("\n"))},s.prototype.slice=function(e,r){if(!r){if(!e)return this;r=this.lastPos()}if(!e)throw new Error("cannot slice with end but not start");var n=this.infos.slice(e.line-1,r.line);e.line===r.line?n[0]=m(n[0],e.column,r.column):(t.default.ok(e.line<r.line),n[0]=m(n[0],e.column),n.push(m(n.pop(),0,r.column)));var i=new s(n);if(this.mappings.length>0){var a=i.mappings;t.default.strictEqual(a.length,0),this.mappings.forEach((function(t){var n=t.slice(this,e,r);n&&a.push(n)}),this)}return i},s.prototype.bootstrapSliceString=function(e,t,r){return this.slice(e,t).toString(r)},s.prototype.sliceString=function(e,t,r){void 0===e&&(e=this.firstPos()),void 0===t&&(t=this.lastPos());for(var i=n.normalize(r),a=i.tabWidth,s=i.useTabs,o=i.reuseWhitespace,l=i.lineTerminator,u=[],h=e.line;h<=t.line;++h){var d=this.infos[h-1];h===e.line?d=h===t.line?m(d,e.column,t.column):m(d,e.column):h===t.line&&(d=m(d,0,t.column));var p=Math.max(d.indent,0),g=d.line.slice(0,d.sliceStart);if(o&&f(g)&&c(g,a)===p)u.push(d.line.slice(0,d.sliceEnd));else{var _=0,v=p;s&&(v-=(_=Math.floor(p/a))*a);var y="";_>0&&(y+=new Array(_+1).join("\t")),v>0&&(y+=new Array(v+1).join(" ")),y+=d.line.slice(d.sliceStart,d.sliceEnd),u.push(y)}}return u.join(l)},s.prototype.isEmpty=function(){return this.length<2&&this.getLineLength(1)<1},s.prototype.join=function(t){var r,n=this,i=[],a=[];function o(t){if(null!==t){if(r){var n=t.infos[0],s=new Array(n.indent+1).join(" "),o=i.length,l=Math.max(r.indent,0)+r.sliceEnd-r.sliceStart;r.line=r.line.slice(0,r.sliceEnd)+s+n.line.slice(n.sliceStart,n.sliceEnd),r.locked=r.locked||n.locked,r.sliceEnd=r.line.length,t.mappings.length>0&&t.mappings.forEach((function(e){a.push(e.add(o,l))}))}else t.mappings.length>0&&a.push.apply(a,t.mappings);t.infos.forEach((function(t,n){(!r||n>0)&&(r=e.__assign({},t),i.push(r))}))}}if(t.map((function(e){var t=p(e);return t.isEmpty()?null:t})).forEach((function(e,t){n.isEmpty()?o(e):function(e,t){t>0&&o(n),o(e)}(e,t)})),i.length<1)return g;var l=new s(i);return l.mappings=a,l},s.prototype.concat=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=[this];return n.push.apply(n,e),t.default.strictEqual(n.length,e.length+1),g.join(n)},s}();mo.Lines=s;var o={},l=o.hasOwnProperty,u=10;function c(e,r){for(var n=0,i=e.length,a=0;a<i;++a)switch(e.charCodeAt(a)){case 9:t.default.strictEqual(typeof r,"number"),t.default.ok(r>0);var s=Math.ceil(n/r)*r;s===n?n+=r:n=s;break;case 11:case 12:case 13:case 65279:break;default:n+=1}return n}mo.countSpaces=c;var h=/^\s*/,d=/\u000D\u000A|\u000D(?!\u000A)|\u000A|\u2028|\u2029/;function p(e,r){if(e instanceof s)return e;e+="";var i=r&&r.tabWidth,a=e.indexOf("\t")<0,p=!r&&a&&e.length<=u;if(t.default.ok(i||a,"No tab width specified but encountered tabs in string\n"+e),p&&l.call(o,e))return o[e];var f=new s(e.split(d).map((function(e){var t=h.exec(e)[0];return{line:e,indent:c(t,i),locked:!1,sliceStart:t.length,sliceEnd:e.length}})),n.normalize(r).sourceFileName);return p&&(o[e]=f),f}function f(e){return!/\S/.test(e)}function m(e,r,n){var i=e.sliceStart,a=e.sliceEnd,s=Math.max(e.indent,0),o=s+a-i;return void 0===n&&(n=o),r=Math.max(r,0),n=Math.min(n,o),(n=Math.max(n,r))<s?(s=n,a=i):a-=o-n,o=n,o-=r,r<s?s-=r:(r-=s,s=0,i+=r),t.default.ok(s>=0),t.default.ok(i<=a),t.default.strictEqual(o,s+a-i),e.indent===s&&e.sliceStart===i&&e.sliceEnd===a?e:{line:e.line,indent:s,locked:!1,sliceStart:i,sliceEnd:a}}mo.fromString=p,mo.concat=function(e){return g.join(e)};var g=p("");return mo}var yo,xo,bo={};function Ao(){if(yo)return bo;yo=1,Object.defineProperty(bo,"__esModule",{value:!0}),bo.printComments=bo.attach=void 0;var e=jr,t=e.__importDefault(js),r=e.__importStar(Gi()),n=r.namedTypes,i=r.builtInTypes.array,a=r.builtInTypes.object,s=vo(),o=so(),l=new WeakMap;function u(e,t,s){if(!e)return s;if(o.fixFaultyLocations(e,t),s){if(n.Node.check(e)&&n.SourceLocation.check(e.loc)){for(var c=s.length-1;c>=0;--c){var h=s[c];if(h&&h.loc&&o.comparePos(h.loc.end,e.loc.start)<=0)break}return s.splice(c+1,0,e),s}}else{var d=l.get(e);if(d)return d}var p;if(i.check(e))p=Object.keys(e);else{if(!a.check(e))return s;p=r.getFieldNames(e)}s||l.set(e,s=[]);c=0;for(var f=p.length;c<f;++c)u(e[p[c]],t,s);return s}function c(e,t,r){for(var n,i,a=u(e,r),s=0,l=a&&a.length;"number"==typeof l&&s<l;){var h=s+l>>1,d=a[h];if(o.comparePos(d.loc.start,t.loc.start)<=0&&o.comparePos(t.loc.end,d.loc.end)<=0)return void c(t.enclosingNode=d,t,r);if(o.comparePos(d.loc.end,t.loc.start)<=0)n=d,s=h+1;else{if(!(o.comparePos(t.loc.end,d.loc.start)<=0))throw new Error("Comment location overlaps with node location");i=d,l=h}}n&&(t.precedingNode=n),i&&(t.followingNode=i)}function h(e,r){var n=e.length;if(0!==n){for(var i,a=e[0].precedingNode,s=e[0].followingNode,o=s.loc.start,l=n;l>0;--l){i=e[l-1],t.default.strictEqual(i.precedingNode,a),t.default.strictEqual(i.followingNode,s);var u=r.sliceString(i.loc.end,o);if(/\S/.test(u))break;o=i.loc.start}for(;l<=n&&(i=e[l])&&("Line"===i.type||"CommentLine"===i.type)&&i.loc.start.column>s.loc.start.column;)++l;e.forEach((function(e,t){t<l?f(a,e):p(s,e)})),e.length=0}}function d(e,t){(e.comments||(e.comments=[])).push(t)}function p(e,t){t.leading=!0,t.trailing=!1,d(e,t)}function f(e,t){t.leading=!1,t.trailing=!0,d(e,t)}return bo.attach=function(e,r,n){if(i.check(e)){var a=[];e.forEach((function(e){e.loc.lines=n,c(r,e,n);var i=e.precedingNode,s=e.enclosingNode,o=e.followingNode;if(i&&o){var l=a.length;if(l>0){var u=a[l-1];t.default.strictEqual(u.precedingNode===e.precedingNode,u.followingNode===e.followingNode),u.followingNode!==e.followingNode&&h(a,n)}a.push(e)}else if(i)h(a,n),f(i,e);else if(o)h(a,n),p(o,e);else{if(!s)throw new Error("AST contains no nodes at all?");h(a,n),function(e,t){t.leading=!1,t.trailing=!1,d(e,t)}(s,e)}})),h(a,n),e.forEach((function(e){delete e.precedingNode,delete e.enclosingNode,delete e.followingNode}))}},bo.printComments=function(e,t){var i=e.getValue(),a=t(e),o=n.Node.check(i)&&r.getFieldValue(i,"comments");if(!o||0===o.length)return a;var l=[],u=[a];return e.each((function(e){var a=e.getValue(),o=r.getFieldValue(a,"leading"),c=r.getFieldValue(a,"trailing");o||c&&!n.Statement.check(i)&&"Block"!==a.type&&"CommentBlock"!==a.type?l.push(function(e,t){var r=e.getValue();n.Comment.assert(r);var i=r.loc,a=i&&i.lines,o=[t(e)];if(r.trailing)o.push("\n");else if(a instanceof s.Lines){var l=a.slice(i.end,a.skipSpaces(i.end)||a.lastPos());1===l.length?o.push(l):o.push(new Array(l.length).join("\n"))}else o.push("\n");return s.concat(o)}(e,t)):c&&u.push(function(e,t){var r=e.getValue(e);n.Comment.assert(r);var i=r.loc,a=i&&i.lines,o=[];if(a instanceof s.Lines){var l=a.skipSpaces(i.start,!0)||a.firstPos(),u=a.slice(l,i.start);1===u.length?o.push(u):o.push(new Array(u.length).join("\n"))}return o.push(t(e)),s.concat(o)}(e,t))}),"comments"),l.push.apply(l,u),s.concat(l)},bo}var So,Eo,wo,Co={},To={},Do={};function Mo(){if(So)return Do;So=1,Object.defineProperty(Do,"__esModule",{value:!0});var e=jr,t=e.__importDefault(js),r=e.__importStar(Gi()),n=e.__importStar(so()),i=r.namedTypes,a=r.builtInTypes.array,s=r.builtInTypes.number,o={};[["??"],["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"],["**"]].forEach((function(e,t){e.forEach((function(e){o[e]=t}))}));var l=function e(r){t.default.ok(this instanceof e),this.stack=[r]},u=l.prototype;function c(e,t){for(var r=e.stack,n=r.length-1;n>=0;n-=2){var a=r[n];if(i.Node.check(a)&&--t<0)return a}return null}function h(e){return i.BinaryExpression.check(e)||i.LogicalExpression.check(e)}function d(e){return!!i.CallExpression.check(e)||(a.check(e)?e.some(d):!!i.Node.check(e)&&r.someField(e,(function(e,t){return d(t)})))}return l.from=function(e){if(e instanceof l)return e.copy();if(e instanceof r.NodePath){for(var t=Object.create(l.prototype),n=[e.value],i=void 0;i=e.parentPath;e=i)n.push(e.name,i.value);return t.stack=n.reverse(),t}return new l(e)},u.copy=function(){var e=Object.create(l.prototype);return e.stack=this.stack.slice(0),e},u.getName=function(){var e=this.stack,t=e.length;return t>1?e[t-2]:null},u.getValue=function(){var e=this.stack;return e[e.length-1]},u.valueIsDuplicate=function(){var e=this.stack,t=e.length-1;return e.lastIndexOf(e[t],t-1)>=0},u.getNode=function(e){return void 0===e&&(e=0),c(this,~~e)},u.getParentNode=function(e){return void 0===e&&(e=0),c(this,1+~~e)},u.getRootValue=function(){var e=this.stack;return e.length%2==0?e[1]:e[0]},u.call=function(e){for(var t=this.stack,r=t.length,n=t[r-1],i=arguments.length,a=1;a<i;++a){var s=arguments[a];n=n[s],t.push(s,n)}var o=e(this);return t.length=r,o},u.each=function(e){for(var t=this.stack,r=t.length,n=t[r-1],i=arguments.length,a=1;a<i;++a){var s=arguments[a];n=n[s],t.push(s,n)}for(a=0;a<n.length;++a)a in n&&(t.push(a,n[a]),e(this),t.length-=2);t.length=r},u.map=function(e){for(var t=this.stack,r=t.length,n=t[r-1],i=arguments.length,a=1;a<i;++a){var s=arguments[a];n=n[s],t.push(s,n)}var o=new Array(n.length);for(a=0;a<n.length;++a)a in n&&(t.push(a,n[a]),o[a]=e(this,a),t.length-=2);return t.length=r,o},u.hasParens=function(){var e=this.getNode(),t=this.getPrevToken(e);if(!t)return!1;var r=this.getNextToken(e);if(!r)return!1;if("("===t.value){if(")"===r.value)return!0;if(!this.canBeFirstInStatement()&&this.firstInStatement()&&!this.needsParens(!0))return!0}return!1},u.getPrevToken=function(e){var t=(e=e||this.getNode())&&e.loc,r=t&&t.tokens;if(r&&t.start.token>0){var i=r[t.start.token-1];if(i){var a=this.getRootValue().loc;if(n.comparePos(a.start,i.loc.start)<=0)return i}}return null},u.getNextToken=function(e){var t=(e=e||this.getNode())&&e.loc,r=t&&t.tokens;if(r&&t.end.token<r.length){var i=r[t.end.token];if(i){var a=this.getRootValue().loc;if(n.comparePos(i.loc.end,a.end)<=0)return i}}return null},u.needsParens=function(e){var r=this.getNode();if("AssignmentExpression"===r.type&&"ObjectPattern"===r.left.type)return!0;var n=this.getParentNode(),a=this.getName();if(this.getValue()!==r)return!1;if(i.Statement.check(r))return!1;if("Identifier"===r.type)return!1;if(n&&"ParenthesizedExpression"===n.type)return!1;if(r.extra&&r.extra.parenthesized)return!0;if(!n)return!1;switch(r.type){case"UnaryExpression":case"SpreadElement":case"SpreadProperty":return"MemberExpression"===n.type&&"object"===a&&n.object===r;case"BinaryExpression":case"LogicalExpression":switch(n.type){case"CallExpression":return"callee"===a&&n.callee===r;case"UnaryExpression":case"SpreadElement":case"SpreadProperty":return!0;case"MemberExpression":return"object"===a&&n.object===r;case"BinaryExpression":case"LogicalExpression":var l=n.operator,u=o[l],c=r.operator,p=o[c];if(u>p)return!0;if(u===p&&"right"===a)return t.default.strictEqual(n.right,r),!0;break;default:return!1}break;case"SequenceExpression":switch(n.type){case"ReturnStatement":case"ForStatement":return!1;case"ExpressionStatement":return"expression"!==a;default:return!0}case"OptionalIndexedAccessType":return r.optional&&"IndexedAccessType"===n.type;case"IntersectionTypeAnnotation":case"UnionTypeAnnotation":return"NullableTypeAnnotation"===n.type;case"Literal":return"MemberExpression"===n.type&&s.check(r.value)&&"object"===a&&n.object===r;case"NumericLiteral":return"MemberExpression"===n.type&&"object"===a&&n.object===r;case"YieldExpression":case"AwaitExpression":case"AssignmentExpression":case"ConditionalExpression":switch(n.type){case"UnaryExpression":case"SpreadElement":case"SpreadProperty":case"BinaryExpression":case"LogicalExpression":return!0;case"CallExpression":case"NewExpression":return"callee"===a&&n.callee===r;case"ConditionalExpression":return"test"===a&&n.test===r;case"MemberExpression":return"object"===a&&n.object===r;default:return!1}case"ArrowFunctionExpression":return!(!i.CallExpression.check(n)||"callee"!==a||n.callee!==r)||(!(!i.MemberExpression.check(n)||"object"!==a||n.object!==r)||(!(!i.TSAsExpression||!i.TSAsExpression.check(n)||"expression"!==a||n.expression!==r)||h(n)));case"ObjectExpression":if("ArrowFunctionExpression"===n.type&&"body"===a&&n.body===r)return!0;break;case"TSAsExpression":if("ArrowFunctionExpression"===n.type&&"body"===a&&n.body===r&&"ObjectExpression"===r.expression.type)return!0;break;case"CallExpression":if("declaration"===a&&i.ExportDefaultDeclaration.check(n)&&i.FunctionExpression.check(r.callee))return!0}return"NewExpression"===n.type&&"callee"===a&&n.callee===r?d(r):!(!0===e||this.canBeFirstInStatement()||!this.firstInStatement())},u.canBeFirstInStatement=function(){var e=this.getNode();return!i.FunctionExpression.check(e)&&(!i.ObjectExpression.check(e)&&!i.ClassExpression.check(e))},u.firstInStatement=function(){for(var e,r,n,a,s=this.stack,o=s.length-1;o>=0;o-=2)if(i.Node.check(s[o])&&(n=e,a=r,e=s[o-1],r=s[o]),r&&a){if(i.BlockStatement.check(r)&&"body"===e&&0===n)return t.default.strictEqual(r.body[0],a),!0;if(i.ExpressionStatement.check(r)&&"expression"===n)return t.default.strictEqual(r.expression,a),!0;if(i.AssignmentExpression.check(r)&&"left"===n)return t.default.strictEqual(r.left,a),!0;if(i.ArrowFunctionExpression.check(r)&&"body"===n)return t.default.strictEqual(r.body,a),!0;if(i.SequenceExpression.check(r)&&"expressions"===s[o+1]&&0===n)t.default.strictEqual(r.expressions[0],a);else if(i.CallExpression.check(r)&&"callee"===n)t.default.strictEqual(r.callee,a);else if(i.MemberExpression.check(r)&&"object"===n)t.default.strictEqual(r.object,a);else if(i.ConditionalExpression.check(r)&&"test"===n)t.default.strictEqual(r.test,a);else if(h(r)&&"left"===n)t.default.strictEqual(r.left,a);else{if(!i.UnaryExpression.check(r)||r.prefix||"argument"!==n)return!1;t.default.strictEqual(r.argument,a)}}return!0},Do.default=l,Do}function Po(){if(Eo)return To;Eo=1,Object.defineProperty(To,"__esModule",{value:!0}),To.getReprinter=To.Patcher=void 0;var e=jr,t=e.__importDefault(js),r=e.__importStar(vo()),n=e.__importStar(Gi()),i=n.namedTypes.Printable,a=n.namedTypes.Expression,s=n.namedTypes.ReturnStatement,o=n.namedTypes.SourceLocation,l=so(),u=e.__importDefault(Mo()),c=n.builtInTypes.object,h=n.builtInTypes.array,d=n.builtInTypes.string,p=/[0-9a-z_$]/i,f=function e(n){t.default.ok(this instanceof e),t.default.ok(n instanceof r.Lines);var i=[];this.replace=function(e,t){d.check(t)&&(t=r.fromString(t)),i.push({lines:t,start:e.start,end:e.end})},this.get=function(e){var a=(e=e||{start:{line:1,column:0},end:{line:n.length,column:n.getLineLength(n.length)}}).start,s=[];function o(e,r){t.default.ok(l.comparePos(e,r)<=0),s.push(n.slice(e,r))}return i.sort((function(e,t){return l.comparePos(e.start,t.start)})).forEach((function(e){l.comparePos(a,e.start)>0||(o(a,e.start),s.push(e.lines),a=e.end)})),o(a,e.end),r.concat(s)}};To.Patcher=f;var m=f.prototype;function g(e){var t=[];return e.comments&&e.comments.length>0&&e.comments.forEach((function(e){(e.leading||e.trailing)&&t.push(e)})),t}function _(e,t,r){var n=e.getValue();return n===t.getValue()||(h.check(n)?v(e,t,r):!!c.check(n)&&function(e,t,r){var n=e.getValue();if(c.assert(n),null===n.original)return!1;var s=t.getValue();if(!c.check(s))return!1;if(n===s||e.valueIsDuplicate()||t.valueIsDuplicate())return!0;if(i.check(n)){if(!i.check(s))return!1;var o=e.getParentNode(),l=t.getParentNode();if(null!==l&&"FunctionTypeAnnotation"===l.type&&null!==o&&"FunctionTypeAnnotation"===o.type){var u=1!==l.params.length||!!l.params[0].name,h=1!==o.params.length||!!o.params[0].name;if(!u&&h)return!1}if(n.type===s.type){var d=[];if(y(e,t,d))r.push.apply(r,d);else{if(!s.loc)return!1;r.push({oldPath:t.copy(),newPath:e.copy()})}return!0}return!!(a.check(n)&&a.check(s)&&s.loc)&&(r.push({oldPath:t.copy(),newPath:e.copy()}),!0)}return y(e,t,r)}(e,t,r))}function v(e,t,r){var n=e.getValue(),i=t.getValue();if(n===i||e.valueIsDuplicate()||t.valueIsDuplicate())return!0;h.assert(n);var a=n.length;if(!h.check(i)||i.length!==a)return!1;for(var s=0;s<a;++s){e.stack.push(s,n[s]),t.stack.push(s,i[s]);var o=_(e,t,r);if(e.stack.length-=2,t.stack.length-=2,!o)return!1}return!0}function y(e,t,r){var i=e.getValue(),a=t.getValue();if(c.assert(i),c.assert(a),null===i.original)return!1;if(e.needsParens()&&!t.hasParens())return!1;var o=l.getUnionOfKeys(a,i);"File"!==a.type&&"File"!==i.type||delete o.tokens,delete o.loc;var u=r.length;for(var h in o)if("_"!==h.charAt(0)){e.stack.push(h,n.getFieldValue(i,h)),t.stack.push(h,n.getFieldValue(a,h));var d=_(e,t,r);if(e.stack.length-=2,t.stack.length-=2,!d)return!1}return!(s.check(e.getNode())&&r.length>u)}return m.tryToReprintComments=function(e,r,n){var i=this;if(!e.comments&&!r.comments)return!0;var a=u.default.from(e),s=u.default.from(r);a.stack.push("comments",g(e)),s.stack.push("comments",g(r));var o=[],l=v(a,s,o);return l&&o.length>0&&o.forEach((function(e){var r=e.oldPath.getValue();t.default.ok(r.leading||r.trailing),i.replace(r.loc,n(e.newPath).indentTail(r.loc.indent))})),l},m.deleteComments=function(e){if(e.comments){var t=this;e.comments.forEach((function(r){r.leading?t.replace({start:r.loc.start,end:e.loc.lines.skipSpaces(r.loc.end,!1,!1)},""):r.trailing&&t.replace({start:e.loc.lines.skipSpaces(r.loc.start,!0,!1),end:r.loc.end},"")}))}},To.getReprinter=function(e){t.default.ok(e instanceof u.default);var n=e.getValue();if(i.check(n)){var a=n.original,s=a&&a.loc,c=s&&s.lines,h=[];if(c&&function(e,r){var n=e.getValue();i.assert(n);var a=n.original;if(i.assert(a),t.default.deepEqual(r,[]),n.type!==a.type)return!1;var s=new u.default(a),o=y(e,s,r);o||(r.length=0);return o}(e,h))return function(t){var n=new f(c);h.forEach((function(e){var i=e.newPath.getValue(),a=e.oldPath.getValue();o.assert(a.loc,!0);var s=!n.tryToReprintComments(i,a,t);s&&n.deleteComments(a);var u=t(e.newPath,{includeComments:s,avoidRootParens:a.type===i.type&&e.oldPath.hasParens()}).indentTail(a.loc.indent),h=function(e,t,r){var n=l.copyPos(t.start),i=e.prevPos(n)&&e.charAt(n),a=r.charAt(r.firstPos());return i&&p.test(i)&&a&&p.test(a)}(c,a.loc,u),d=function(e,t,r){var n=e.charAt(t.end),i=r.lastPos(),a=r.prevPos(i)&&r.charAt(i);return a&&p.test(a)&&n&&p.test(n)}(c,a.loc,u);if(h||d){var f=[];h&&f.push(" "),f.push(u),d&&f.push(" "),u=r.concat(f)}n.replace(a.loc,u)}));var i=n.get(s).indentTail(-a.loc.indent);return e.needsParens()?r.concat(["(",i,")"]):i}}},To}function Fo(){if(wo)return Co;wo=1,Object.defineProperty(Co,"__esModule",{value:!0}),Co.Printer=void 0;var e=jr,t=e.__importDefault(js),r=Ao(),n=vo(),i=ho(),a=Po(),s=e.__importStar(Gi()),o=s.namedTypes,l=s.builtInTypes.string,u=s.builtInTypes.object,c=e.__importDefault(Mo()),h=e.__importStar(so()),d=function e(r,n){t.default.ok(this instanceof e),l.assert(r),this.code=r,n&&(u.assert(n),this.map=n)},p=!1;d.prototype.toString=function(){return p||(console.warn("Deprecation warning: recast.print now returns an object with a .code property. You appear to be treating the object as a string, which might still work but is strongly discouraged."),p=!0),this.code};var f=new d("");function m(e,r,i,a){t.default.ok(e instanceof c.default);var l=e.getValue(),u=[],d=function(e,r,i){var a=e.getValue();if(!a)return n.fromString("");if("string"==typeof a)return n.fromString(a,r);o.Printable.assert(a);var l=[];switch(a.type){case"File":return e.call(i,"program");case"Program":return a.directives&&e.each((function(e){l.push(i(e),";\n")}),"directives"),a.interpreter&&l.push(e.call(i,"interpreter")),l.push(e.call((function(e){return g(e,r,i)}),"body")),n.concat(l);case"Noop":case"EmptyStatement":return n.fromString("");case"ExpressionStatement":return n.concat([e.call(i,"expression"),";"]);case"ParenthesizedExpression":return n.concat(["(",e.call(i,"expression"),")"]);case"BinaryExpression":case"LogicalExpression":case"AssignmentExpression":return n.fromString(" ").join([e.call(i,"left"),a.operator,e.call(i,"right")]);case"AssignmentPattern":return n.concat([e.call(i,"left")," = ",e.call(i,"right")]);case"MemberExpression":case"OptionalMemberExpression":l.push(e.call(i,"object"));var u=e.call(i,"property"),c=s.getFieldValue(a,"optional");return a.computed?l.push(c?"?.[":"[",u,"]"):l.push(c?"?.":".",u),n.concat(l);case"ChainExpression":return e.call(i,"expression");case"MetaProperty":return n.concat([e.call(i,"meta"),".",e.call(i,"property")]);case"BindExpression":return a.object&&l.push(e.call(i,"object")),l.push("::",e.call(i,"callee")),n.concat(l);case"Path":return n.fromString(".").join(a.body);case"Identifier":return n.concat([n.fromString(a.name,r),a.optional?"?":"",e.call(i,"typeAnnotation")]);case"SpreadElement":case"SpreadElementPattern":case"RestProperty":case"SpreadProperty":case"SpreadPropertyPattern":case"ObjectTypeSpreadProperty":case"RestElement":return n.concat(["...",e.call(i,"argument"),e.call(i,"typeAnnotation")]);case"FunctionDeclaration":case"FunctionExpression":case"TSDeclareFunction":return a.declare&&l.push("declare "),a.async&&l.push("async "),l.push("function"),a.generator&&l.push("*"),a.id?l.push(" ",e.call(i,"id"),e.call(i,"typeParameters")):a.typeParameters&&l.push(e.call(i,"typeParameters")),l.push("(",y(e,r,i),")",e.call(i,"returnType")),a.body&&l.push(" ",e.call(i,"body")),n.concat(l);case"ArrowFunctionExpression":return a.async&&l.push("async "),a.typeParameters&&l.push(e.call(i,"typeParameters")),r.arrowParensAlways||1!==a.params.length||a.rest||"Identifier"!==a.params[0].type||a.params[0].typeAnnotation||a.returnType?l.push("(",y(e,r,i),")",e.call(i,"returnType")):l.push(e.call(i,"params",0)),l.push(" => ",e.call(i,"body")),n.concat(l);case"MethodDefinition":return _(e,r,i);case"YieldExpression":return l.push("yield"),a.delegate&&l.push("*"),a.argument&&l.push(" ",e.call(i,"argument")),n.concat(l);case"AwaitExpression":return l.push("await"),a.all&&l.push("*"),a.argument&&l.push(" ",e.call(i,"argument")),n.concat(l);case"ModuleExpression":return n.concat(["module {\n",e.call(i,"body").indent(r.tabWidth),"\n}"]);case"ModuleDeclaration":return l.push("module",e.call(i,"id")),a.source?(t.default.ok(!a.body),l.push("from",e.call(i,"source"))):l.push(e.call(i,"body")),n.fromString(" ").join(l);case"ImportSpecifier":return a.importKind&&"value"!==a.importKind&&l.push(a.importKind+" "),a.imported?(l.push(e.call(i,"imported")),a.local&&a.local.name!==a.imported.name&&l.push(" as ",e.call(i,"local"))):a.id&&(l.push(e.call(i,"id")),a.name&&l.push(" as ",e.call(i,"name"))),n.concat(l);case"ExportSpecifier":return a.local?(l.push(e.call(i,"local")),a.exported&&a.exported.name!==a.local.name&&l.push(" as ",e.call(i,"exported"))):a.id&&(l.push(e.call(i,"id")),a.name&&l.push(" as ",e.call(i,"name"))),n.concat(l);case"ExportBatchSpecifier":return n.fromString("*");case"ImportNamespaceSpecifier":return l.push("* as "),a.local?l.push(e.call(i,"local")):a.id&&l.push(e.call(i,"id")),n.concat(l);case"ImportDefaultSpecifier":return a.local?e.call(i,"local"):e.call(i,"id");case"TSExportAssignment":return n.concat(["export = ",e.call(i,"expression")]);case"ExportDeclaration":case"ExportDefaultDeclaration":case"ExportNamedDeclaration":return b(e,r,i);case"ExportAllDeclaration":return l.push("export *"),a.exported&&l.push(" as ",e.call(i,"exported")),l.push(" from ",e.call(i,"source"),";"),n.concat(l);case"TSNamespaceExportDeclaration":return l.push("export as namespace ",e.call(i,"id")),F(n.concat(l));case"ExportNamespaceSpecifier":return n.concat(["* as ",e.call(i,"exported")]);case"ExportDefaultSpecifier":return e.call(i,"exported");case"Import":return n.fromString("import",r);case"ImportExpression":return n.concat(["import(",e.call(i,"source"),")"]);case"ImportDeclaration":if(l.push("import "),a.importKind&&"value"!==a.importKind&&l.push(a.importKind+" "),a.specifiers&&a.specifiers.length>0){var d=[],p=[];if(e.each((function(e){var t=e.getValue();"ImportSpecifier"===t.type?p.push(i(e)):"ImportDefaultSpecifier"!==t.type&&"ImportNamespaceSpecifier"!==t.type||d.push(i(e))}),"specifiers"),d.forEach((function(e,t){t>0&&l.push(", "),l.push(e)})),p.length>0)(be=n.fromString(", ").join(p)).getLineLength(1)>r.wrapColumn&&(be=n.concat([n.fromString(",\n").join(p).indent(r.tabWidth),","])),d.length>0&&l.push(", "),be.length>1?l.push("{\n",be,"\n}"):r.objectCurlySpacing?l.push("{ ",be," }"):l.push("{",be,"}");l.push(" from ")}return l.push(e.call(i,"source"),x(e,r,i),";"),n.concat(l);case"ImportAttribute":return n.concat([e.call(i,"key"),": ",e.call(i,"value")]);case"StaticBlock":l.push("static ");case"BlockStatement":var f=e.call((function(e){return g(e,r,i)}),"body");return!f.isEmpty()||a.directives&&0!==a.directives.length?(l.push("{\n"),a.directives&&e.each((function(e){l.push(F(i(e).indent(r.tabWidth)),a.directives.length>1||!f.isEmpty()?"\n":"")}),"directives"),l.push(f.indent(r.tabWidth)),l.push("\n}"),n.concat(l)):(l.push("{}"),n.concat(l));case"ReturnStatement":if(l.push("return"),a.argument){var m=e.call(i,"argument");m.startsWithComment()||m.length>1&&o.JSXElement&&o.JSXElement.check(a.argument)?l.push(" (\n",m.indent(r.tabWidth),"\n)"):l.push(" ",m)}return l.push(";"),n.concat(l);case"CallExpression":case"OptionalCallExpression":return l.push(e.call(i,"callee")),a.typeParameters&&l.push(e.call(i,"typeParameters")),a.typeArguments&&l.push(e.call(i,"typeArguments")),s.getFieldValue(a,"optional")&&l.push("?."),l.push(v(e,r,i)),n.concat(l);case"RecordExpression":l.push("#");case"ObjectExpression":case"ObjectPattern":case"ObjectTypeAnnotation":var w="ObjectTypeAnnotation"===a.type,T=r.flowObjectCommas?",":w?";":",",M=[],R=!1;w&&(M.push("indexers","callProperties"),null!=a.internalSlots&&M.push("internalSlots")),M.push("properties");var N=0;M.forEach((function(e){N+=a[e].length}));var B=w&&1===N||0===N,I=a.exact?"{|":"{",O=a.exact?"|}":"}";l.push(B?I:I+"\n");var k=l.length-1,L=0;if(M.forEach((function(t){e.each((function(e){var t=i(e);B||(t=t.indent(r.tabWidth));var n=!w&&t.length>1;n&&R&&l.push("\n"),l.push(t),L<N-1?(l.push(T+(n?"\n\n":"\n")),R=!n):(1!==N&&w||!B&&h.isTrailingCommaEnabled(r,"objects")&&"RestElement"!==e.getValue().type)&&l.push(T),L++}),t)})),a.inexact){var U=n.fromString("...",r);B?(N>0&&l.push(T," "),l.push(U)):l.push("\n",U.indent(r.tabWidth))}return l.push(B?O:"\n"+O),0!==L&&B&&r.objectCurlySpacing&&(l[k]=I+" ",l[l.length-1]=" "+O),a.typeAnnotation&&l.push(e.call(i,"typeAnnotation")),n.concat(l);case"PropertyPattern":return n.concat([e.call(i,"key"),": ",e.call(i,"pattern")]);case"ObjectProperty":case"Property":if(a.method||"get"===a.kind||"set"===a.kind)return _(e,r,i);if(a.shorthand&&"AssignmentPattern"===a.value.type)return e.call(i,"value");var z=e.call(i,"key");return a.computed?l.push("[",z,"]"):l.push(z),a.shorthand&&a.key.name===a.value.name||l.push(": ",e.call(i,"value")),n.concat(l);case"ClassMethod":case"ObjectMethod":case"ClassPrivateMethod":case"TSDeclareMethod":return _(e,r,i);case"PrivateName":return n.concat(["#",e.call(i,"id")]);case"Decorator":return n.concat(["@",e.call(i,"expression")]);case"TupleExpression":l.push("#");case"ArrayExpression":case"ArrayPattern":var j=a.elements.length,V=e.map(i,"elements"),G=n.fromString(", ").join(V).getLineLength(1)<=r.wrapColumn;return G?r.arrayBracketSpacing?l.push("[ "):l.push("["):l.push("[\n"),e.each((function(e){var t=e.getName();if(e.getValue()){var n=V[t];G?t>0&&l.push(" "):n=n.indent(r.tabWidth),l.push(n),(t<j-1||!G&&h.isTrailingCommaEnabled(r,"arrays"))&&l.push(","),G||l.push("\n")}else l.push(",")}),"elements"),G&&r.arrayBracketSpacing?l.push(" ]"):l.push("]"),a.typeAnnotation&&l.push(e.call(i,"typeAnnotation")),n.concat(l);case"SequenceExpression":return n.fromString(", ").join(e.map(i,"expressions"));case"ThisExpression":return n.fromString("this");case"Super":return n.fromString("super");case"NullLiteral":return n.fromString("null");case"RegExpLiteral":return n.fromString(D(a)||"/"+a.pattern+"/"+(a.flags||""),r);case"BigIntLiteral":return n.fromString(D(a)||a.value+"n",r);case"NumericLiteral":return n.fromString(D(a)||a.value,r);case"DecimalLiteral":return n.fromString(D(a)||a.value+"m",r);case"StringLiteral":return n.fromString(P(a.value,r));case"BooleanLiteral":case"Literal":return n.fromString(D(a)||("string"==typeof a.value?P(a.value,r):a.value),r);case"Directive":return e.call(i,"value");case"DirectiveLiteral":return n.fromString(D(a)||P(a.value,r),r);case"InterpreterDirective":return n.fromString("#!"+a.value+"\n",r);case"ModuleSpecifier":if(a.local)throw new Error("The ESTree ModuleSpecifier type should be abstract");return n.fromString(P(a.value,r),r);case"UnaryExpression":return l.push(a.operator),/[a-z]$/.test(a.operator)&&l.push(" "),l.push(e.call(i,"argument")),n.concat(l);case"UpdateExpression":return l.push(e.call(i,"argument"),a.operator),a.prefix&&l.reverse(),n.concat(l);case"ConditionalExpression":return n.concat([e.call(i,"test")," ? ",e.call(i,"consequent")," : ",e.call(i,"alternate")]);case"NewExpression":return l.push("new ",e.call(i,"callee")),a.typeParameters&&l.push(e.call(i,"typeParameters")),a.typeArguments&&l.push(e.call(i,"typeArguments")),a.arguments&&l.push(v(e,r,i)),n.concat(l);case"VariableDeclaration":a.declare&&l.push("declare "),l.push(a.kind," ");var W=0,H=e.map((function(e){var t=i(e);return W=Math.max(t.length,W),t}),"declarations");1===W?l.push(n.fromString(", ").join(H)):H.length>1?l.push(n.fromString(",\n").join(H).indentTail(a.kind.length+1)):l.push(H[0]);var q=e.getParentNode();return o.ForStatement.check(q)||o.ForInStatement.check(q)||o.ForOfStatement&&o.ForOfStatement.check(q)||o.ForAwaitStatement&&o.ForAwaitStatement.check(q)||l.push(";"),n.concat(l);case"VariableDeclarator":return a.init?n.fromString(" = ").join([e.call(i,"id"),e.call(i,"init")]):e.call(i,"id");case"WithStatement":return n.concat(["with (",e.call(i,"object"),") ",e.call(i,"body")]);case"IfStatement":var X=E(e.call(i,"consequent"),r);return l.push("if (",e.call(i,"test"),")",X),a.alternate&&l.push(C(X)?" else":"\nelse",E(e.call(i,"alternate"),r)),n.concat(l);case"ForStatement":var Q=e.call(i,"init"),K=Q.length>1?";\n":"; ",Y="for (",Z=n.fromString(K).join([Q,e.call(i,"test"),e.call(i,"update")]).indentTail(Y.length),J=n.concat([Y,Z,")"]),$=E(e.call(i,"body"),r);return l.push(J),J.length>1&&(l.push("\n"),$=$.trimLeft()),l.push($),n.concat(l);case"WhileStatement":return n.concat(["while (",e.call(i,"test"),")",E(e.call(i,"body"),r)]);case"ForInStatement":return n.concat([a.each?"for each (":"for (",e.call(i,"left")," in ",e.call(i,"right"),")",E(e.call(i,"body"),r)]);case"ForOfStatement":case"ForAwaitStatement":return l.push("for "),(a.await||"ForAwaitStatement"===a.type)&&l.push("await "),l.push("(",e.call(i,"left")," of ",e.call(i,"right"),")",E(e.call(i,"body"),r)),n.concat(l);case"DoWhileStatement":var ee=n.concat(["do",E(e.call(i,"body"),r)]);return l.push(ee),C(ee)?l.push(" while"):l.push("\nwhile"),l.push(" (",e.call(i,"test"),");"),n.concat(l);case"DoExpression":var te=e.call((function(e){return g(e,r,i)}),"body");return n.concat(["do {\n",te.indent(r.tabWidth),"\n}"]);case"BreakStatement":return l.push("break"),a.label&&l.push(" ",e.call(i,"label")),l.push(";"),n.concat(l);case"ContinueStatement":return l.push("continue"),a.label&&l.push(" ",e.call(i,"label")),l.push(";"),n.concat(l);case"LabeledStatement":return n.concat([e.call(i,"label"),":\n",e.call(i,"body")]);case"TryStatement":return l.push("try ",e.call(i,"block")),a.handler?l.push(" ",e.call(i,"handler")):a.handlers&&e.each((function(e){l.push(" ",i(e))}),"handlers"),a.finalizer&&l.push(" finally ",e.call(i,"finalizer")),n.concat(l);case"CatchClause":return l.push("catch "),a.param&&l.push("(",e.call(i,"param")),a.guard&&l.push(" if ",e.call(i,"guard")),a.param&&l.push(") "),l.push(e.call(i,"body")),n.concat(l);case"ThrowStatement":return n.concat(["throw ",e.call(i,"argument"),";"]);case"SwitchStatement":return n.concat(["switch (",e.call(i,"discriminant"),") {\n",n.fromString("\n").join(e.map(i,"cases")),"\n}"]);case"SwitchCase":return a.test?l.push("case ",e.call(i,"test"),":"):l.push("default:"),a.consequent.length>0&&l.push("\n",e.call((function(e){return g(e,r,i)}),"consequent").indent(r.tabWidth)),n.concat(l);case"DebuggerStatement":return n.fromString("debugger;");case"JSXAttribute":return l.push(e.call(i,"name")),a.value&&l.push("=",e.call(i,"value")),n.concat(l);case"JSXIdentifier":return n.fromString(a.name,r);case"JSXNamespacedName":return n.fromString(":").join([e.call(i,"namespace"),e.call(i,"name")]);case"JSXMemberExpression":return n.fromString(".").join([e.call(i,"object"),e.call(i,"property")]);case"JSXSpreadAttribute":return n.concat(["{...",e.call(i,"argument"),"}"]);case"JSXSpreadChild":return n.concat(["{...",e.call(i,"expression"),"}"]);case"JSXExpressionContainer":return n.concat(["{",e.call(i,"expression"),"}"]);case"JSXElement":case"JSXFragment":var re="opening"+("JSXElement"===a.type?"Element":"Fragment"),ne="closing"+("JSXElement"===a.type?"Element":"Fragment"),ie=e.call(i,re);if(a[re].selfClosing)return t.default.ok(!a[ne],"unexpected "+ne+" element in self-closing "+a.type),ie;var ae=n.concat(e.map((function(e){var t=e.getValue();if(o.Literal.check(t)&&"string"==typeof t.value){if(/\S/.test(t.value))return t.value.replace(/^\s+|\s+$/g,"");if(/\n/.test(t.value))return"\n"}return i(e)}),"children")).indentTail(r.tabWidth),se=e.call(i,ne);return n.concat([ie,ae,se]);case"JSXOpeningElement":l.push("<",e.call(i,"name"));var oe=[];e.each((function(e){oe.push(" ",i(e))}),"attributes");var le=n.concat(oe);return(le.length>1||le.getLineLength(1)>r.wrapColumn)&&(oe.forEach((function(e,r){" "===e&&(t.default.strictEqual(r%2,0),oe[r]="\n")})),le=n.concat(oe).indentTail(r.tabWidth)),l.push(le,a.selfClosing?" />":">"),n.concat(l);case"JSXClosingElement":return n.concat(["</",e.call(i,"name"),">"]);case"JSXOpeningFragment":return n.fromString("<>");case"JSXClosingFragment":return n.fromString("</>");case"JSXText":return n.fromString(a.value,r);case"JSXEmptyExpression":return n.fromString("");case"TypeAnnotatedIdentifier":return n.concat([e.call(i,"annotation")," ",e.call(i,"identifier")]);case"ClassBody":return 0===a.body.length?n.fromString("{}"):n.concat(["{\n",e.call((function(e){return g(e,r,i)}),"body").indent(r.tabWidth),"\n}"]);case"ClassPropertyDefinition":return l.push("static ",e.call(i,"definition")),o.MethodDefinition.check(a.definition)||l.push(";"),n.concat(l);case"ClassProperty":a.declare&&l.push("declare ");var ue=a.accessibility||a.access;"string"==typeof ue&&l.push(ue," "),a.static&&l.push("static "),a.abstract&&l.push("abstract "),a.readonly&&l.push("readonly ");z=e.call(i,"key");return a.computed&&(z=n.concat(["[",z,"]"])),a.variance&&(z=n.concat([S(e,i),z])),l.push(z),a.optional&&l.push("?"),a.definite&&l.push("!"),a.typeAnnotation&&l.push(e.call(i,"typeAnnotation")),a.value&&l.push(" = ",e.call(i,"value")),l.push(";"),n.concat(l);case"ClassPrivateProperty":return a.static&&l.push("static "),l.push(e.call(i,"key")),a.typeAnnotation&&l.push(e.call(i,"typeAnnotation")),a.value&&l.push(" = ",e.call(i,"value")),l.push(";"),n.concat(l);case"ClassDeclaration":case"ClassExpression":case"DeclareClass":return a.declare&&l.push("declare "),a.abstract&&l.push("abstract "),l.push("class"),a.id&&l.push(" ",e.call(i,"id")),a.typeParameters&&l.push(e.call(i,"typeParameters")),a.superClass&&l.push(" extends ",e.call(i,"superClass"),e.call(i,"superTypeParameters")),a.extends&&a.extends.length>0&&l.push(" extends ",n.fromString(", ").join(e.map(i,"extends"))),a.implements&&a.implements.length>0&&l.push(" implements ",n.fromString(", ").join(e.map(i,"implements"))),l.push(" ",e.call(i,"body")),"DeclareClass"===a.type?A(e,l):n.concat(l);case"TemplateElement":return n.fromString(a.value.raw,r).lockIndentTail();case"TemplateLiteral":var ce=e.map(i,"expressions");return l.push("`"),e.each((function(e){var t=e.getName();l.push(i(e)),t<ce.length&&l.push("${",ce[t],"}")}),"quasis"),l.push("`"),n.concat(l).lockIndentTail();case"TaggedTemplateExpression":return n.concat([e.call(i,"tag"),e.call(i,"quasi")]);case"Node":case"Printable":case"SourceLocation":case"Position":case"Statement":case"Function":case"Pattern":case"Expression":case"Declaration":case"Specifier":case"NamedSpecifier":case"Comment":case"Flow":case"FlowType":case"FlowPredicate":case"MemberTypeAnnotation":case"Type":case"TSHasOptionalTypeParameterInstantiation":case"TSHasOptionalTypeParameters":case"TSHasOptionalTypeAnnotation":case"ChainElement":throw new Error("unprintable type: "+JSON.stringify(a.type));case"CommentBlock":case"Block":return n.concat(["/*",n.fromString(a.value,r),"*/"]);case"CommentLine":case"Line":return n.concat(["//",n.fromString(a.value,r)]);case"TypeAnnotation":return a.typeAnnotation?("FunctionTypeAnnotation"!==a.typeAnnotation.type&&l.push(": "),l.push(e.call(i,"typeAnnotation")),n.concat(l)):n.fromString("");case"ExistentialTypeParam":case"ExistsTypeAnnotation":return n.fromString("*",r);case"EmptyTypeAnnotation":return n.fromString("empty",r);case"AnyTypeAnnotation":return n.fromString("any",r);case"MixedTypeAnnotation":return n.fromString("mixed",r);case"ArrayTypeAnnotation":return n.concat([e.call(i,"elementType"),"[]"]);case"TupleTypeAnnotation":var he=e.map(i,"types"),de=n.fromString(", ").join(he).getLineLength(1)<=r.wrapColumn;return de?r.arrayBracketSpacing?l.push("[ "):l.push("["):l.push("[\n"),e.each((function(e){var t=e.getName();if(e.getValue()){var n=he[t];de?t>0&&l.push(" "):n=n.indent(r.tabWidth),l.push(n),(t<a.types.length-1||!de&&h.isTrailingCommaEnabled(r,"arrays"))&&l.push(","),de||l.push("\n")}else l.push(",")}),"types"),de&&r.arrayBracketSpacing?l.push(" ]"):l.push("]"),n.concat(l);case"BooleanTypeAnnotation":return n.fromString("boolean",r);case"BooleanLiteralTypeAnnotation":return t.default.strictEqual(typeof a.value,"boolean"),n.fromString(""+a.value,r);case"InterfaceTypeAnnotation":return l.push("interface"),a.extends&&a.extends.length>0&&l.push(" extends ",n.fromString(", ").join(e.map(i,"extends"))),l.push(" ",e.call(i,"body")),n.concat(l);case"DeclareFunction":return A(e,["function ",e.call(i,"id"),";"]);case"DeclareModule":return A(e,["module ",e.call(i,"id")," ",e.call(i,"body")]);case"DeclareModuleExports":return A(e,["module.exports",e.call(i,"typeAnnotation")]);case"DeclareVariable":return A(e,["var ",e.call(i,"id"),";"]);case"DeclareExportDeclaration":case"DeclareExportAllDeclaration":return n.concat(["declare ",b(e,r,i)]);case"EnumDeclaration":return n.concat(["enum ",e.call(i,"id"),e.call(i,"body")]);case"EnumBooleanBody":case"EnumNumberBody":case"EnumStringBody":case"EnumSymbolBody":return("EnumSymbolBody"===a.type||a.explicitType)&&l.push(" of ",a.type.slice(4,-4).toLowerCase()),l.push(" {\n",n.fromString("\n").join(e.map(i,"members")).indent(r.tabWidth),"\n}"),n.concat(l);case"EnumDefaultedMember":return n.concat([e.call(i,"id"),","]);case"EnumBooleanMember":case"EnumNumberMember":case"EnumStringMember":return n.concat([e.call(i,"id")," = ",e.call(i,"init"),","]);case"InferredPredicate":return n.fromString("%checks",r);case"DeclaredPredicate":return n.concat(["%checks(",e.call(i,"value"),")"]);case"FunctionTypeAnnotation":var pe=e.getParentNode(0),fe=!(o.ObjectTypeCallProperty.check(pe)||o.ObjectTypeInternalSlot.check(pe)&&pe.method||o.DeclareFunction.check(e.getParentNode(2)));fe&&!o.FunctionTypeParam.check(pe)&&!o.TypeAlias.check(pe)&&l.push(": ");var me=!!a.typeParameters,ge=me||1!==a.params.length||a.params[0].name;return l.push(me?e.call(i,"typeParameters"):"",ge?"(":"",y(e,r,i),ge?")":""),a.returnType&&l.push(fe?" => ":": ",e.call(i,"returnType")),n.concat(l);case"FunctionTypeParam":var _e=e.call(i,"name");return l.push(_e),a.optional&&l.push("?"),_e.infos[0].line&&l.push(": "),l.push(e.call(i,"typeAnnotation")),n.concat(l);case"GenericTypeAnnotation":return n.concat([e.call(i,"id"),e.call(i,"typeParameters")]);case"DeclareInterface":l.push("declare ");case"InterfaceDeclaration":case"TSInterfaceDeclaration":return a.declare&&l.push("declare "),l.push("interface ",e.call(i,"id"),e.call(i,"typeParameters")," "),a.extends&&a.extends.length>0&&l.push("extends ",n.fromString(", ").join(e.map(i,"extends"))," "),a.body&&l.push(e.call(i,"body")),n.concat(l);case"ClassImplements":case"InterfaceExtends":return n.concat([e.call(i,"id"),e.call(i,"typeParameters")]);case"IntersectionTypeAnnotation":return n.fromString(" & ").join(e.map(i,"types"));case"NullableTypeAnnotation":return n.concat(["?",e.call(i,"typeAnnotation")]);case"NullLiteralTypeAnnotation":return n.fromString("null",r);case"ThisTypeAnnotation":return n.fromString("this",r);case"NumberTypeAnnotation":return n.fromString("number",r);case"ObjectTypeCallProperty":return e.call(i,"value");case"ObjectTypeIndexer":return a.static&&l.push("static "),l.push(S(e,i),"["),a.id&&l.push(e.call(i,"id"),": "),l.push(e.call(i,"key"),"]: ",e.call(i,"value")),n.concat(l);case"ObjectTypeProperty":return n.concat([S(e,i),e.call(i,"key"),a.optional?"?":"",": ",e.call(i,"value")]);case"ObjectTypeInternalSlot":return n.concat([a.static?"static ":"","[[",e.call(i,"id"),"]]",a.optional?"?":"","FunctionTypeAnnotation"!==a.value.type?": ":"",e.call(i,"value")]);case"QualifiedTypeIdentifier":return n.concat([e.call(i,"qualification"),".",e.call(i,"id")]);case"StringLiteralTypeAnnotation":return n.fromString(P(a.value,r),r);case"NumberLiteralTypeAnnotation":case"NumericLiteralTypeAnnotation":return t.default.strictEqual(typeof a.value,"number"),n.fromString(JSON.stringify(a.value),r);case"BigIntLiteralTypeAnnotation":return n.fromString(a.raw,r);case"StringTypeAnnotation":return n.fromString("string",r);case"DeclareTypeAlias":l.push("declare ");case"TypeAlias":return n.concat(["type ",e.call(i,"id"),e.call(i,"typeParameters")," = ",e.call(i,"right"),";"]);case"DeclareOpaqueType":l.push("declare ");case"OpaqueType":return l.push("opaque type ",e.call(i,"id"),e.call(i,"typeParameters")),a.supertype&&l.push(": ",e.call(i,"supertype")),a.impltype&&l.push(" = ",e.call(i,"impltype")),l.push(";"),n.concat(l);case"TypeCastExpression":return n.concat(["(",e.call(i,"expression"),e.call(i,"typeAnnotation"),")"]);case"TypeParameterDeclaration":case"TypeParameterInstantiation":return n.concat(["<",n.fromString(", ").join(e.map(i,"params")),">"]);case"Variance":return"plus"===a.kind?n.fromString("+"):"minus"===a.kind?n.fromString("-"):n.fromString("");case"TypeParameter":return a.variance&&l.push(S(e,i)),l.push(e.call(i,"name")),a.bound&&l.push(e.call(i,"bound")),a.default&&l.push("=",e.call(i,"default")),n.concat(l);case"TypeofTypeAnnotation":return n.concat([n.fromString("typeof ",r),e.call(i,"argument")]);case"IndexedAccessType":case"OptionalIndexedAccessType":return n.concat([e.call(i,"objectType"),a.optional?"?.":"","[",e.call(i,"indexType"),"]"]);case"UnionTypeAnnotation":return n.fromString(" | ").join(e.map(i,"types"));case"VoidTypeAnnotation":return n.fromString("void",r);case"NullTypeAnnotation":return n.fromString("null",r);case"SymbolTypeAnnotation":return n.fromString("symbol",r);case"BigIntTypeAnnotation":return n.fromString("bigint",r);case"TSType":throw new Error("unprintable type: "+JSON.stringify(a.type));case"TSNumberKeyword":return n.fromString("number",r);case"TSBigIntKeyword":return n.fromString("bigint",r);case"TSObjectKeyword":return n.fromString("object",r);case"TSBooleanKeyword":return n.fromString("boolean",r);case"TSStringKeyword":return n.fromString("string",r);case"TSSymbolKeyword":return n.fromString("symbol",r);case"TSAnyKeyword":return n.fromString("any",r);case"TSVoidKeyword":return n.fromString("void",r);case"TSIntrinsicKeyword":return n.fromString("intrinsic",r);case"TSThisType":return n.fromString("this",r);case"TSNullKeyword":return n.fromString("null",r);case"TSUndefinedKeyword":return n.fromString("undefined",r);case"TSUnknownKeyword":return n.fromString("unknown",r);case"TSNeverKeyword":return n.fromString("never",r);case"TSArrayType":return n.concat([e.call(i,"elementType"),"[]"]);case"TSLiteralType":return e.call(i,"literal");case"TSUnionType":return n.fromString(" | ").join(e.map(i,"types"));case"TSIntersectionType":return n.fromString(" & ").join(e.map(i,"types"));case"TSConditionalType":return l.push(e.call(i,"checkType")," extends ",e.call(i,"extendsType")," ? ",e.call(i,"trueType")," : ",e.call(i,"falseType")),n.concat(l);case"TSInferType":return l.push("infer ",e.call(i,"typeParameter")),n.concat(l);case"TSParenthesizedType":return n.concat(["(",e.call(i,"typeAnnotation"),")"]);case"TSFunctionType":return n.concat([e.call(i,"typeParameters"),"(",y(e,r,i),") => ",e.call(i,"typeAnnotation","typeAnnotation")]);case"TSConstructorType":return n.concat(["new ",e.call(i,"typeParameters"),"(",y(e,r,i),") => ",e.call(i,"typeAnnotation","typeAnnotation")]);case"TSMappedType":return l.push(a.readonly?"readonly ":"","[",e.call(i,"typeParameter"),"]",a.optional?"?":""),a.typeAnnotation&&l.push(": ",e.call(i,"typeAnnotation"),";"),n.concat(["{\n",n.concat(l).indent(r.tabWidth),"\n}"]);case"TSTupleType":return n.concat(["[",n.fromString(", ").join(e.map(i,"elementTypes")),"]"]);case"TSNamedTupleMember":return l.push(e.call(i,"label")),a.optional&&l.push("?"),l.push(": ",e.call(i,"elementType")),n.concat(l);case"TSRestType":return n.concat(["...",e.call(i,"typeAnnotation")]);case"TSOptionalType":return n.concat([e.call(i,"typeAnnotation"),"?"]);case"TSIndexedAccessType":return n.concat([e.call(i,"objectType"),"[",e.call(i,"indexType"),"]"]);case"TSTypeOperator":return n.concat([e.call(i,"operator")," ",e.call(i,"typeAnnotation")]);case"TSTypeLiteral":return(xe=n.fromString("\n").join(e.map(i,"members"))).isEmpty()?n.fromString("{}",r):(l.push("{\n",xe.indent(r.tabWidth),"\n}"),n.concat(l));case"TSEnumMember":return l.push(e.call(i,"id")),a.initializer&&l.push(" = ",e.call(i,"initializer")),n.concat(l);case"TSTypeQuery":return n.concat(["typeof ",e.call(i,"exprName")]);case"TSParameterProperty":return a.accessibility&&l.push(a.accessibility," "),a.export&&l.push("export "),a.static&&l.push("static "),a.readonly&&l.push("readonly "),l.push(e.call(i,"parameter")),n.concat(l);case"TSTypeReference":return n.concat([e.call(i,"typeName"),e.call(i,"typeParameters")]);case"TSQualifiedName":return n.concat([e.call(i,"left"),".",e.call(i,"right")]);case"TSAsExpression":var ve=e.call(i,"expression");return l.push(ve,n.fromString(" as "),e.call(i,"typeAnnotation")),n.concat(l);case"TSNonNullExpression":return n.concat([e.call(i,"expression"),"!"]);case"TSTypeAnnotation":return n.concat([": ",e.call(i,"typeAnnotation")]);case"TSIndexSignature":return n.concat([a.readonly?"readonly ":"","[",e.map(i,"parameters"),"]",e.call(i,"typeAnnotation")]);case"TSPropertySignature":return l.push(S(e,i),a.readonly?"readonly ":""),a.computed?l.push("[",e.call(i,"key"),"]"):l.push(e.call(i,"key")),l.push(a.optional?"?":"",e.call(i,"typeAnnotation")),n.concat(l);case"TSMethodSignature":return a.computed?l.push("[",e.call(i,"key"),"]"):l.push(e.call(i,"key")),a.optional&&l.push("?"),l.push(e.call(i,"typeParameters"),"(",y(e,r,i),")",e.call(i,"typeAnnotation")),n.concat(l);case"TSTypePredicate":return a.asserts&&l.push("asserts "),l.push(e.call(i,"parameterName")),a.typeAnnotation&&l.push(" is ",e.call(i,"typeAnnotation","typeAnnotation")),n.concat(l);case"TSCallSignatureDeclaration":return n.concat([e.call(i,"typeParameters"),"(",y(e,r,i),")",e.call(i,"typeAnnotation")]);case"TSConstructSignatureDeclaration":return a.typeParameters?l.push("new",e.call(i,"typeParameters")):l.push("new "),l.push("(",y(e,r,i),")",e.call(i,"typeAnnotation")),n.concat(l);case"TSTypeAliasDeclaration":return n.concat([a.declare?"declare ":"","type ",e.call(i,"id"),e.call(i,"typeParameters")," = ",e.call(i,"typeAnnotation"),";"]);case"TSTypeParameter":l.push(e.call(i,"name"));pe=e.getParentNode(0);var ye=o.TSMappedType.check(pe);return a.constraint&&l.push(ye?" in ":" extends ",e.call(i,"constraint")),a.default&&l.push(" = ",e.call(i,"default")),n.concat(l);case"TSTypeAssertion":return l.push("<",e.call(i,"typeAnnotation"),"> ",e.call(i,"expression")),n.concat(l);case"TSTypeParameterDeclaration":case"TSTypeParameterInstantiation":return n.concat(["<",n.fromString(", ").join(e.map(i,"params")),">"]);case"TSEnumDeclaration":var xe;return l.push(a.declare?"declare ":"",a.const?"const ":"","enum ",e.call(i,"id")),(xe=n.fromString(",\n").join(e.map(i,"members"))).isEmpty()?l.push(" {}"):l.push(" {\n",xe.indent(r.tabWidth),"\n}"),n.concat(l);case"TSExpressionWithTypeArguments":return n.concat([e.call(i,"expression"),e.call(i,"typeParameters")]);case"TSInterfaceBody":var be;return(be=n.fromString("\n").join(e.map(i,"body"))).isEmpty()?n.fromString("{}",r):n.concat(["{\n",be.indent(r.tabWidth),"\n}"]);case"TSImportType":return l.push("import(",e.call(i,"argument"),")"),a.qualifier&&l.push(".",e.call(i,"qualifier")),a.typeParameters&&l.push(e.call(i,"typeParameters")),n.concat(l);case"TSImportEqualsDeclaration":return a.isExport&&l.push("export "),l.push("import ",e.call(i,"id")," = ",e.call(i,"moduleReference")),F(n.concat(l));case"TSExternalModuleReference":return n.concat(["require(",e.call(i,"expression"),")"]);case"TSModuleDeclaration":if("TSModuleDeclaration"===(pe=e.getParentNode()).type)l.push(".");else if(a.declare&&l.push("declare "),!a.global)if("StringLiteral"===a.id.type||"Literal"===a.id.type&&"string"==typeof a.id.value)l.push("module ");else if(a.loc&&a.loc.lines&&a.id.loc){a.loc.lines.sliceString(a.loc.start,a.id.loc.start).indexOf("module")>=0?l.push("module "):l.push("namespace ")}else l.push("namespace ");return l.push(e.call(i,"id")),a.body&&(l.push(" "),l.push(e.call(i,"body"))),n.concat(l);case"TSModuleBlock":var Ae=e.call((function(e){return g(e,r,i)}),"body");return Ae.isEmpty()?l.push("{}"):l.push("{\n",Ae.indent(r.tabWidth),"\n}"),n.concat(l);case"V8IntrinsicIdentifier":return n.concat(["%",e.call(i,"name")]);case"TopicReference":return n.fromString("#");default:throw new Error("unknown type: "+JSON.stringify(a.type))}}(e,r,a);if(!l||d.isEmpty())return d;var p=!1,f=function(e,t){var r=[],i=e.getValue();i.decorators&&i.decorators.length>0&&!h.getParentExportDeclaration(e)?e.each((function(e){r.push(t(e),"\n")}),"decorators"):h.isExportDeclaration(i)&&i.declaration&&i.declaration.decorators&&e.each((function(e){r.push(t(e),"\n")}),"declaration","decorators");return n.concat(r)}(e,a);return f.isEmpty()?i.avoidRootParens||(p=e.needsParens()):u.push(f),p&&u.unshift("("),u.push(d),p&&u.push(")"),n.concat(u)}function g(e,r,i){var a=[],s=!1,u=!1;e.each((function(e){var t=e.getValue();t&&("EmptyStatement"!==t.type||t.comments&&t.comments.length>0)&&(o.Comment.check(t)?s=!0:o.Statement.check(t)?u=!0:l.assert(t),a.push({node:t,printed:i(e)}))})),s&&t.default.strictEqual(u,!1,"Comments may appear as statements in otherwise empty statement lists, but may not coexist with non-Comment nodes.");var c=null,d=a.length,p=[];return a.forEach((function(e,t){var i,a,s=e.printed,o=e.node,l=s.length>1,u=t>0,f=t<d-1,m=o&&o.loc&&o.loc.lines,g=m&&r.reuseWhitespace&&h.getTrueLoc(o,m);if(u)if(g){var _=m.skipSpaces(g.start,!0),v=_?_.line:1,y=g.start.line-v;i=Array(y+1).join("\n")}else i=l?"\n\n":"\n";else i="";if(f)if(g){var x=m.skipSpaces(g.end),b=(x?x.line:m.length)-g.end.line;a=Array(b+1).join("\n")}else a=l?"\n\n":"\n";else a="";p.push(function(e,t){if(!e&&!t)return n.fromString("");if(!e)return n.fromString(t);if(!t)return n.fromString(e);var r=n.fromString(e),i=n.fromString(t);if(i.length>r.length)return i;return r}(c,i),s),f?c=a:a&&p.push(a)})),n.concat(p)}function _(e,t,r){var i=e.getNode(),a=i.kind,s=[],l=i.value;o.FunctionExpression.check(l)||(l=i);var u=i.accessibility||i.access;"string"==typeof u&&s.push(u," "),i.static&&s.push("static "),i.abstract&&s.push("abstract "),i.override&&s.push("override "),i.readonly&&s.push("readonly "),l.async&&s.push("async "),l.generator&&s.push("*"),"get"!==a&&"set"!==a||s.push(a," ");var c=e.call(r,"key");return i.computed&&(c=n.concat(["[",c,"]"])),s.push(c),i.optional&&s.push("?"),i===l?(s.push(e.call(r,"typeParameters"),"(",y(e,t,r),")",e.call(r,"returnType")),i.body?s.push(" ",e.call(r,"body")):s.push(";")):(s.push(e.call(r,"value","typeParameters"),"(",e.call((function(e){return y(e,t,r)}),"value"),")",e.call(r,"value","returnType")),l.body?s.push(" ",e.call(r,"value","body")):s.push(";")),n.concat(s)}function v(e,t,r){var i=e.map(r,"arguments"),a=h.isTrailingCommaEnabled(t,"parameters"),s=n.fromString(", ").join(i);return s.getLineLength(1)>t.wrapColumn?(s=n.fromString(",\n").join(i),n.concat(["(\n",s.indent(t.tabWidth),a?",\n)":"\n)"])):n.concat(["(",s,")"])}function y(e,t,r){var i,a=e.getValue(),s=[];a.params?(i=a.params,s=e.map(r,"params")):a.parameters&&(i=a.parameters,s=e.map(r,"parameters")),a.defaults&&e.each((function(e){var t=e.getName(),i=s[t];i&&e.getValue()&&(s[t]=n.concat([i," = ",r(e)]))}),"defaults"),a.rest&&s.push(n.concat(["...",e.call(r,"rest")]));var o=n.fromString(", ").join(s);return o.length>1||o.getLineLength(1)>t.wrapColumn?(o=n.fromString(",\n").join(s),o=h.isTrailingCommaEnabled(t,"parameters")&&!a.rest&&"RestElement"!==i[i.length-1].type?n.concat([o,",\n"]):n.concat([o,"\n"]),n.concat(["\n",o.indent(t.tabWidth)])):o}function x(e,t,r){var i=e.getValue();if(i.assertions&&i.assertions.length>0){var a=[" assert {"],s=e.map(r,"assertions"),o=n.fromString(", ").join(s);return o.length>1||o.getLineLength(1)>t.wrapColumn?a.push("\n",n.fromString(",\n").join(s).indent(t.tabWidth),"\n}"):a.push(" ",o," }"),n.concat(a)}return n.fromString("")}function b(e,t,r){var i=e.getValue(),a=["export "];i.exportKind&&"type"===i.exportKind&&(i.declaration||a.push("type "));var s=t.objectCurlySpacing;if(o.Declaration.assert(i),(i.default||"ExportDefaultDeclaration"===i.type)&&a.push("default "),i.declaration)a.push(e.call(r,"declaration"));else if(i.specifiers){if(1===i.specifiers.length&&"ExportBatchSpecifier"===i.specifiers[0].type)a.push("*");else if(0===i.specifiers.length)a.push("{}");else if("ExportDefaultSpecifier"===i.specifiers[0].type){var l=[],u=[];if(e.each((function(e){"ExportDefaultSpecifier"===e.getValue().type?l.push(r(e)):u.push(r(e))}),"specifiers"),l.forEach((function(e,t){t>0&&a.push(", "),a.push(e)})),u.length>0){var c=n.fromString(", ").join(u);c.getLineLength(1)>t.wrapColumn&&(c=n.concat([n.fromString(",\n").join(u).indent(t.tabWidth),","])),l.length>0&&a.push(", "),c.length>1?a.push("{\n",c,"\n}"):t.objectCurlySpacing?a.push("{ ",c," }"):a.push("{",c,"}")}}else a.push(s?"{ ":"{",n.fromString(", ").join(e.map(r,"specifiers")),s?" }":"}");i.source&&a.push(" from ",e.call(r,"source"),x(e,t,r))}var h=n.concat(a);return";"===w(h)||i.declaration&&("FunctionDeclaration"===i.declaration.type||"ClassDeclaration"===i.declaration.type||"TSModuleDeclaration"===i.declaration.type||"TSInterfaceDeclaration"===i.declaration.type||"TSEnumDeclaration"===i.declaration.type)||(h=n.concat([h,";"])),h}function A(e,r){var i=h.getParentExportDeclaration(e);return i?t.default.strictEqual(i.type,"DeclareExportDeclaration"):r.unshift("declare "),n.concat(r)}function S(e,t){return e.call((function(e){var r=e.getValue();return r?"plus"===r?n.fromString("+"):"minus"===r?n.fromString("-"):t(e):n.fromString("")}),"variance")}function E(e,t){return e.length>1?n.concat([" ",e]):n.concat(["\n",F(e).indent(t.tabWidth)])}function w(e){var t=e.lastPos();do{var r=e.charAt(t);if(/\S/.test(r))return r}while(e.prevPos(t))}function C(e){return"}"===w(e)}function T(e){return e.replace(/['"]/g,(function(e){return'"'===e?"'":'"'}))}function D(e){var t=s.getFieldValue(e,"value"),r=s.getFieldValue(e,"extra");if(r&&"string"==typeof r.raw&&t==r.rawValue)return r.raw;if("Literal"===e.type){var n=e.raw;if("string"==typeof n&&t==n)return n}}function M(e){return JSON.stringify(e).replace(/[\u2028\u2029]/g,(function(e){return"\\u"+e.charCodeAt(0).toString(16)}))}function P(e,t){switch(l.assert(e),t.quote){case"auto":var r=M(e),n=T(M(T(e)));return r.length>n.length?n:r;case"single":return T(M(T(e)));default:return M(e)}}function F(e){var t=w(e);return!t||"\n};".indexOf(t)<0?n.concat([e,";"]):e}return Co.Printer=function e(n){t.default.ok(this instanceof e);var s=n&&n.tabWidth;function o(e,t){return e=Object.assign({},e,t),function(t){return l(t,e)}}function l(e,i){if(t.default.ok(e instanceof c.default),(i=i||{}).includeComments)return r.printComments(e,o(i,{includeComments:!1}));var u=n.tabWidth;if(!s){var h=e.getNode().loc;h&&h.lines&&h.lines.guessTabWidth&&(n.tabWidth=h.lines.guessTabWidth())}var d=a.getReprinter(e),p=d?d(l):m(e,n,i,o(i,{includeComments:!0,avoidRootParens:!1}));return n.tabWidth=u,p}(n=i.normalize(n)).sourceFileName=null,this.print=function(e){if(!e)return f;var t=l(c.default.from(e),{includeComments:!0,avoidRootParens:!1});return new d(t.toString(n),h.composeSourceMaps(n.inputSourceMap,t.getSourceMap(n.sourceMapName,n.sourceRoot)))},this.printGenerically=function(e){if(!e)return f;var t=c.default.from(e),i=n.reuseWhitespace;n.reuseWhitespace=!1;var a=new d(function e(t){return r.printComments(t,(function(t){return m(t,n,{includeComments:!0,avoidRootParens:!1},e)}))}(t).toString(n));return n.reuseWhitespace=i,a}},Co}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.run=e.prettyPrint=e.print=e.visit=e.types=e.parse=void 0;var t=jr,r=t.__importDefault(Vr),n=t.__importStar(Gi());e.types=n;var i=function(){if(xo)return Wi;xo=1,Object.defineProperty(Wi,"__esModule",{value:!0}),Wi.parse=void 0;var e=jr,t=e.__importDefault(js),r=e.__importStar(Gi()),n=r.builders,i=r.builtInTypes.object,a=r.builtInTypes.array,s=ho(),o=vo(),l=Ao(),u=e.__importStar(so());Wi.parse=function(e,t){t=s.normalize(t);var r,i,a=o.fromString(e,t),h=a.toString({tabWidth:t.tabWidth,reuseWhitespace:!1,useTabs:!1}),d=[],p=t.parser.parse(h,{jsx:!0,loc:!0,locations:!0,range:t.range,comment:!0,onComment:d,tolerant:u.getOption(t,"tolerant",!0),ecmaVersion:6,sourceType:u.getOption(t,"sourceType","module")}),f=Array.isArray(p.tokens)?p.tokens:Ue.tokenize(h,{loc:!0});delete p.tokens,f.forEach((function(e){"string"!=typeof e.value&&(e.value=a.sliceString(e.loc.start,e.loc.end))})),Array.isArray(p.comments)&&(d=p.comments,delete p.comments),p.loc?u.fixFaultyLocations(p,a):p.loc={start:a.firstPos(),end:a.lastPos()},p.loc.lines=a,p.loc.indent=0,"Program"===p.type?(i=p,(r=n.file(p,t.sourceFileName||null)).loc={start:a.firstPos(),end:a.lastPos(),lines:a,indent:0}):"File"===p.type&&(i=(r=p).program),t.tokens&&(r.tokens=f);var m=u.getTrueLoc({type:i.type,loc:i.loc,body:[],comments:d},a);return i.loc.start=m.start,i.loc.end=m.end,l.attach(d,i.body.length?r.program:r,a),new c(a,f).copy(r)};var c=function e(r,n){t.default.ok(this instanceof e),this.lines=r,this.tokens=n,this.startTokenIndex=0,this.endTokenIndex=n.length,this.indent=0,this.seen=new Map},h=c.prototype;return h.copy=function(e){if(this.seen.has(e))return this.seen.get(e);if(a.check(e)){var t=new Array(e.length);return this.seen.set(e,t),e.forEach((function(e,r){t[r]=this.copy(e)}),this),t}if(!i.check(e))return e;u.fixFaultyLocations(e,this.lines);var r=Object.create(Object.getPrototypeOf(e),{original:{value:e,configurable:!1,enumerable:!1,writable:!0}});this.seen.set(e,r);var n=e.loc,s=this.indent,o=s,l=this.startTokenIndex,c=this.endTokenIndex;n&&(("Block"===e.type||"Line"===e.type||"CommentBlock"===e.type||"CommentLine"===e.type||this.lines.isPrecededOnlyByWhitespace(n.start))&&(o=this.indent=n.start.column),n.lines=this.lines,n.tokens=this.tokens,n.indent=o,this.findTokenRange(n));for(var h=Object.keys(e),d=h.length,p=0;p<d;++p){var f=h[p];"loc"===f||"tokens"===f&&"File"===e.type?r[f]=e[f]:r[f]=this.copy(e[f])}return this.indent=s,this.startTokenIndex=l,this.endTokenIndex=c,r},h.findTokenRange=function(e){for(;this.startTokenIndex>0;){var t=e.tokens[this.startTokenIndex];if(!(u.comparePos(e.start,t.loc.start)<0))break;--this.startTokenIndex}for(;this.endTokenIndex<e.tokens.length&&(t=e.tokens[this.endTokenIndex],u.comparePos(t.loc.end,e.end)<0);)++this.endTokenIndex;for(;this.startTokenIndex<this.endTokenIndex&&(t=e.tokens[this.startTokenIndex],u.comparePos(t.loc.start,e.start)<0);)++this.startTokenIndex;for(e.start.token=this.startTokenIndex;this.endTokenIndex>this.startTokenIndex&&(t=e.tokens[this.endTokenIndex-1],u.comparePos(e.end,t.loc.end)<0);)--this.endTokenIndex;e.end.token=this.endTokenIndex},Wi}();Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return i.parse}});var a=Fo(),s=Gi();function o(e,t){return new a.Printer(t).print(e)}function l(e){process.stdout.write(e)}Object.defineProperty(e,"visit",{enumerable:!0,get:function(){return s.visit}}),e.print=o,e.prettyPrint=function(e,t){return new a.Printer(t).printGenerically(e)},e.run=function(e,t){return function(e,t,n){r.default.readFile(e,"utf-8",(function(e,r){e?console.error(e):function(e,t,r){var n=r&&r.writeback||l;t(i.parse(e,r),(function(e){n(o(e,r).code)}))}(r,t,n)}))}(process.argv[2],e,t)}}(Fr);var Ro=Symbol("private"),No=1,Bo=2;class Io{constructor(e){void 0===e&&(e={}),this[Ro]={};var t=this[Ro];t.flags=new Wt,t.elapsedTime=0,t.intervalElapsedTime=0,t.interval=e.interval,t.onInterval=e.onInterval,this.start()}start(){var e=this[Ro];e.elapsedTime=0,e.flags.enable(No,!0),e.flags.enable(Bo,!1)}resume(){this[Ro].flags.enable(Bo,!1)}pause(){this[Ro].flags.enable(Bo,!0)}stop(){var e=this[Ro];e.flags.enable(No,!1),e.flags.enable(Bo,!1)}update(e){var t=this[Ro],r=t.flags;r.has(No)&&!r.has(Bo)&&(t.elapsedTime+=e,t.interval&&(t.intervalElapsedTime+=e,t.intervalElapsedTime<t.interval||(t.intervalElapsedTime=0,t.onInterval&&t.onInterval())))}get elapsedTime(){return this[Ro].elapsedTime}get interval(){return this[Ro].interval}set interval(e){this[Ro].interval=e}get onInterval(){return this[Ro].onInterval}set onInterval(e){this[Ro].onInterval=e}}var Oo=Symbol("private");class ko{constructor(e){void 0===e&&(e={}),this[Oo]={},this[Oo].randomSeed=we.parseValue(e.seed,Math.floor(4294967295*Math.random()))}setRandomSeed(e){this[Oo].seed=e}getRandomSeed(){return this[Oo].seed}nextNumber(){var e=this[Oo];return e.randomSeed=(9301*e.randomSeed+49297)%233280,e.randomSeed/233280}nextBoolean(){return!!(this.nextInt()%2)}nextFloat(e,t){return void 0===e&&(e=0),void 0===t&&(t=4294967295),this.nextNumber()*(t-e)+e}nextInt(e,t){return void 0===e&&(e=0),void 0===t&&(t=4294967295),Math.floor(this.nextNumber()*(t-e+1))+e}}class Lo{constructor(e){this._variables={},this._classTypes=e,this._checkedTypes={},this._init()}_init(){var e=this,t=this,r=function(r){var n=e._classTypes[r];e._variables[r]=new n,e._checkedTypes[r]=function(e){t._checkClassType(e,r)}};for(var n in this._classTypes)r(n)}_checkClassType(e,t){var r=this._variables[t],n=Object.keys(r);!function(e,t,r){if(e)for(var n=0;n<t.length;n++){var i=t[n];void 0===e[i]&&r&&r(i)}}(e,n,(function(e){we.error("Check class '"+t+"' attributes failed, due to '"+e+"' is not existing")}));var i=we.getFunctionsFromObject(r);!function(e,t,r){if(e)for(var n=0;n<t.length;n++){var i=t[n];we.isFunction(e[i])||r&&r(i)}}(e,i,(function(r){e.__proto__[r]=function(){},we.error("Check class '"+t+"' functions failed, due to '"+r+"' is not existing")}))}checkObject(e,t){var r=this._checkedTypes[e];r&&(r(t),this._checkedTypes[e]=null)}getVariables(){return this._variables}}function Uo(e){var t=e.split(".");return{major:parseInt(t.length>=1?t[0]:0),minor:parseInt(t.length>=2?t[1]:0),modified:parseInt(t.length>=3?t[2]:0)}}function zo(e,t){return e.major!=t.major?e.major>t.major?1:-1:e.minor!=t.minor?e.minor>t.minor?1:-1:e.modified!=t.modified?e.modified>t.modified?1:-1:0}let jo=class{constructor(e){void 0===e&&(e=""),this._major=0,this._minor=0,this._modified=0,we.isString(e)?this.fromString(e):e.isVersion&&this.copy(e)}fromString(e){var{major:t,minor:r,modified:n}=Uo(e);return this._major=t,this._minor=r,this._modified=n,this}toString(){return[this._major,this._minor,this._modified].join(".")}copy(e){return this._major=e.major,this._minor=e.minor,this._modified=e.modified,this}compare(e){return we.isString(e)?zo(this,Uo(e)):e.isVersion?zo(this,e):0}isCompatibleWith(e){return!(this._major<e.major)&&(this._major>e.major||!(this._minor<e.minor)&&(this._minor>e.minor||!(this._modified<e.modified)))}get major(){return this._major}get minor(){return this._minor}get modified(){return this._modified}get isVersion(){return!0}};var Vo=1e-6,Go="undefined"!=typeof Float32Array?Float32Array:Array,Wo=Math.random;function Ho(){var e=new Go(9);return Go!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function qo(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=r[0],p=r[1],f=r[2],m=r[3],g=r[4],_=r[5],v=r[6],y=r[7],x=r[8];return e[0]=d*n+p*s+f*u,e[1]=d*i+p*o+f*c,e[2]=d*a+p*l+f*h,e[3]=m*n+g*s+_*u,e[4]=m*i+g*o+_*c,e[5]=m*a+g*l+_*h,e[6]=v*n+y*s+x*u,e[7]=v*i+y*o+x*c,e[8]=v*a+y*l+x*h,e}function Xo(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Qo=qo,Ko=Xo,Yo=Object.freeze({__proto__:null,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},adjoint:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],l=t[6],u=t[7],c=t[8];return e[0]=s*c-o*u,e[1]=i*u-n*c,e[2]=n*o-i*s,e[3]=o*l-a*c,e[4]=r*c-i*l,e[5]=i*a-r*o,e[6]=a*u-s*l,e[7]=n*l-r*u,e[8]=r*s-n*a,e},clone:function(e){var t=new Go(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},create:Ho,determinant:function(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8];return t*(u*a-s*l)+r*(-u*i+s*o)+n*(l*i-a*o)},equals:function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=t[0],d=t[1],p=t[2],f=t[3],m=t[4],g=t[5],_=t[6],v=t[7],y=t[8];return Math.abs(r-h)<=Vo*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-d)<=Vo*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-p)<=Vo*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-f)<=Vo*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-m)<=Vo*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(o-g)<=Vo*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-_)<=Vo*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-v)<=Vo*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(c-y)<=Vo*Math.max(1,Math.abs(c),Math.abs(y))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},fromQuat:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=r+r,o=n+n,l=i+i,u=r*s,c=n*s,h=n*o,d=i*s,p=i*o,f=i*l,m=a*s,g=a*o,_=a*l;return e[0]=1-h-f,e[3]=c-_,e[6]=d+g,e[1]=c+_,e[4]=1-u-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-u-h,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromValues:function(e,t,r,n,i,a,s,o,l){var u=new Go(9);return u[0]=e,u[1]=t,u[2]=r,u[3]=n,u[4]=i,u[5]=a,u[6]=s,u[7]=o,u[8]=l,u},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=c*s-o*u,d=-c*a+o*l,p=u*a-s*l,f=r*h+n*d+i*p;return f?(f=1/f,e[0]=h*f,e[1]=(-c*n+i*u)*f,e[2]=(o*n-i*s)*f,e[3]=d*f,e[4]=(c*r-i*l)*f,e[5]=(-o*r+i*a)*f,e[6]=p*f,e[7]=(-u*r+n*l)*f,e[8]=(s*r-n*a)*f,e):null},mul:Qo,multiply:qo,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},normalFromMat4:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],v=r*o-n*s,y=r*l-i*s,x=r*u-a*s,b=n*l-i*o,A=n*u-a*o,S=i*u-a*l,E=c*m-h*f,w=c*g-d*f,C=c*_-p*f,T=h*g-d*m,D=h*_-p*m,M=d*_-p*g,P=v*M-y*D+x*T+b*C-A*w+S*E;return P?(P=1/P,e[0]=(o*M-l*D+u*T)*P,e[1]=(l*C-s*M-u*w)*P,e[2]=(s*D-o*C+u*E)*P,e[3]=(i*D-n*M-a*T)*P,e[4]=(r*M-i*C+a*w)*P,e[5]=(n*C-r*D-a*E)*P,e[6]=(m*S-g*A+_*b)*P,e[7]=(g*x-f*S-_*y)*P,e[8]=(f*A-m*x+_*v)*P,e):null},projection:function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},rotate:function(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=Math.sin(r),p=Math.cos(r);return e[0]=p*n+d*s,e[1]=p*i+d*o,e[2]=p*a+d*l,e[3]=p*s-d*n,e[4]=p*o-d*i,e[5]=p*l-d*a,e[6]=u,e[7]=c,e[8]=h,e},scale:function(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},set:function(e,t,r,n,i,a,s,o,l,u){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=s,e[6]=o,e[7]=l,e[8]=u,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},sub:Ko,subtract:Xo,translate:function(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=r[0],p=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=d*n+p*s+u,e[7]=d*i+p*o+c,e[8]=d*a+p*l+h,e},transpose:function(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}});function Zo(){var e=new Go(16);return Go!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Jo(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function $o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function el(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],v=r*o-n*s,y=r*l-i*s,x=r*u-a*s,b=n*l-i*o,A=n*u-a*o,S=i*u-a*l,E=c*m-h*f,w=c*g-d*f,C=c*_-p*f,T=h*g-d*m,D=h*_-p*m,M=d*_-p*g,P=v*M-y*D+x*T+b*C-A*w+S*E;return P?(P=1/P,e[0]=(o*M-l*D+u*T)*P,e[1]=(i*D-n*M-a*T)*P,e[2]=(m*S-g*A+_*b)*P,e[3]=(d*A-h*S-p*b)*P,e[4]=(l*C-s*M-u*w)*P,e[5]=(r*M-i*C+a*w)*P,e[6]=(g*x-f*S-_*y)*P,e[7]=(c*S-d*x+p*y)*P,e[8]=(s*D-o*C+u*E)*P,e[9]=(n*C-r*D-a*E)*P,e[10]=(f*A-m*x+_*v)*P,e[11]=(h*x-c*A-p*v)*P,e[12]=(o*w-s*T-l*E)*P,e[13]=(r*T-n*w+i*E)*P,e[14]=(m*y-f*b-g*v)*P,e[15]=(c*b-h*y+d*v)*P,e):null}function tl(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],v=t[15],y=r[0],x=r[1],b=r[2],A=r[3];return e[0]=y*n+x*o+b*h+A*m,e[1]=y*i+x*l+b*d+A*g,e[2]=y*a+x*u+b*p+A*_,e[3]=y*s+x*c+b*f+A*v,y=r[4],x=r[5],b=r[6],A=r[7],e[4]=y*n+x*o+b*h+A*m,e[5]=y*i+x*l+b*d+A*g,e[6]=y*a+x*u+b*p+A*_,e[7]=y*s+x*c+b*f+A*v,y=r[8],x=r[9],b=r[10],A=r[11],e[8]=y*n+x*o+b*h+A*m,e[9]=y*i+x*l+b*d+A*g,e[10]=y*a+x*u+b*p+A*_,e[11]=y*s+x*c+b*f+A*v,y=r[12],x=r[13],b=r[14],A=r[15],e[12]=y*n+x*o+b*h+A*m,e[13]=y*i+x*l+b*d+A*g,e[14]=y*a+x*u+b*p+A*_,e[15]=y*s+x*c+b*f+A*v,e}function rl(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3],o=n+n,l=i+i,u=a+a,c=n*o,h=n*l,d=n*u,p=i*l,f=i*u,m=a*u,g=s*o,_=s*l,v=s*u;return e[0]=1-(p+m),e[1]=h+v,e[2]=d-_,e[3]=0,e[4]=h-v,e[5]=1-(c+m),e[6]=f+g,e[7]=0,e[8]=d+_,e[9]=f-g,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function nl(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function il(e,t){var r=t[0],n=t[1],i=t[2],a=t[4],s=t[5],o=t[6],l=t[8],u=t[9],c=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(a,s,o),e[2]=Math.hypot(l,u,c),e}function al(e,t){var r=new Go(3);il(r,t);var n=1/r[0],i=1/r[1],a=1/r[2],s=t[0]*n,o=t[1]*i,l=t[2]*a,u=t[4]*n,c=t[5]*i,h=t[6]*a,d=t[8]*n,p=t[9]*i,f=t[10]*a,m=s+c+f,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(h-p)/g,e[1]=(d-l)/g,e[2]=(o-u)/g):s>c&&s>f?(g=2*Math.sqrt(1+s-c-f),e[3]=(h-p)/g,e[0]=.25*g,e[1]=(o+u)/g,e[2]=(d+l)/g):c>f?(g=2*Math.sqrt(1+c-s-f),e[3]=(d-l)/g,e[0]=(o+u)/g,e[1]=.25*g,e[2]=(h+p)/g):(g=2*Math.sqrt(1+f-s-c),e[3]=(o-u)/g,e[0]=(d+l)/g,e[1]=(h+p)/g,e[2]=.25*g),e}function sl(e,t,r,n){var i=t[0],a=t[1],s=t[2],o=t[3],l=i+i,u=a+a,c=s+s,h=i*l,d=i*u,p=i*c,f=a*u,m=a*c,g=s*c,_=o*l,v=o*u,y=o*c,x=n[0],b=n[1],A=n[2];return e[0]=(1-(f+g))*x,e[1]=(d+y)*x,e[2]=(p-v)*x,e[3]=0,e[4]=(d-y)*b,e[5]=(1-(h+g))*b,e[6]=(m+_)*b,e[7]=0,e[8]=(p+v)*A,e[9]=(m-_)*A,e[10]=(1-(h+f))*A,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function ol(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=r+r,o=n+n,l=i+i,u=r*s,c=n*s,h=n*o,d=i*s,p=i*o,f=i*l,m=a*s,g=a*o,_=a*l;return e[0]=1-h-f,e[1]=c+_,e[2]=d-g,e[3]=0,e[4]=c-_,e[5]=1-u-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ll(e,t,r,n,i){var a,s=1/Math.tan(t/2);return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(n-i),e[10]=(i+n)*a,e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}var ul=ll;function cl(e,t,r,n,i,a,s){var o=1/(t-r),l=1/(n-i),u=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*o,e[13]=(i+n)*l,e[14]=(s+a)*u,e[15]=1,e}var hl=cl;function dl(e,t,r,n){var i=t[0],a=t[1],s=t[2],o=n[0],l=n[1],u=n[2],c=i-r[0],h=a-r[1],d=s-r[2],p=c*c+h*h+d*d;p>0&&(c*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-u*h,m=u*c-o*d,g=o*h-l*c;return(p=f*f+m*m+g*g)>0&&(f*=p=1/Math.sqrt(p),m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*f-c*g,e[6]=c*m-h*f,e[7]=0,e[8]=c,e[9]=h,e[10]=d,e[11]=0,e[12]=i,e[13]=a,e[14]=s,e[15]=1,e}function pl(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}var fl=tl,ml=pl,gl=Object.freeze({__proto__:null,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},adjoint:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15];return e[0]=o*(d*_-p*g)-h*(l*_-u*g)+m*(l*p-u*d),e[1]=-(n*(d*_-p*g)-h*(i*_-a*g)+m*(i*p-a*d)),e[2]=n*(l*_-u*g)-o*(i*_-a*g)+m*(i*u-a*l),e[3]=-(n*(l*p-u*d)-o*(i*p-a*d)+h*(i*u-a*l)),e[4]=-(s*(d*_-p*g)-c*(l*_-u*g)+f*(l*p-u*d)),e[5]=r*(d*_-p*g)-c*(i*_-a*g)+f*(i*p-a*d),e[6]=-(r*(l*_-u*g)-s*(i*_-a*g)+f*(i*u-a*l)),e[7]=r*(l*p-u*d)-s*(i*p-a*d)+c*(i*u-a*l),e[8]=s*(h*_-p*m)-c*(o*_-u*m)+f*(o*p-u*h),e[9]=-(r*(h*_-p*m)-c*(n*_-a*m)+f*(n*p-a*h)),e[10]=r*(o*_-u*m)-s*(n*_-a*m)+f*(n*u-a*o),e[11]=-(r*(o*p-u*h)-s*(n*p-a*h)+c*(n*u-a*o)),e[12]=-(s*(h*g-d*m)-c*(o*g-l*m)+f*(o*d-l*h)),e[13]=r*(h*g-d*m)-c*(n*g-i*m)+f*(n*d-i*h),e[14]=-(r*(o*g-l*m)-s*(n*g-i*m)+f*(n*l-i*o)),e[15]=r*(o*d-l*h)-s*(n*d-i*h)+c*(n*l-i*o),e},clone:function(e){var t=new Go(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:Jo,create:Zo,determinant:function(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*s-r*a)*(h*g-d*m)-(t*o-n*a)*(c*g-d*f)+(t*l-i*a)*(c*m-h*f)+(r*o-n*s)*(u*g-d*p)-(r*l-i*s)*(u*m-h*p)+(n*l-i*o)*(u*f-c*p)},equals:function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],v=t[0],y=t[1],x=t[2],b=t[3],A=t[4],S=t[5],E=t[6],w=t[7],C=t[8],T=t[9],D=t[10],M=t[11],P=t[12],F=t[13],R=t[14],N=t[15];return Math.abs(r-v)<=Vo*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-y)<=Vo*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-x)<=Vo*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(a-b)<=Vo*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-A)<=Vo*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(o-S)<=Vo*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(l-E)<=Vo*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(u-w)<=Vo*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(c-C)<=Vo*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(h-T)<=Vo*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(d-D)<=Vo*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(p-M)<=Vo*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(f-P)<=Vo*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-F)<=Vo*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(g-R)<=Vo*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(_-N)<=Vo*Math.max(1,Math.abs(_),Math.abs(N))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},fromQuat:ol,fromQuat2:function(e,t){var r=new Go(3),n=-t[0],i=-t[1],a=-t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=n*n+i*i+a*a+s*s;return h>0?(r[0]=2*(o*s+c*n+l*a-u*i)/h,r[1]=2*(l*s+c*i+u*n-o*a)/h,r[2]=2*(u*s+c*a+o*i-l*n)/h):(r[0]=2*(o*s+c*n+l*a-u*i),r[1]=2*(l*s+c*i+u*n-o*a),r[2]=2*(u*s+c*a+o*i-l*n)),rl(e,t,r),e},fromRotation:function(e,t,r){var n,i,a,s=r[0],o=r[1],l=r[2],u=Math.hypot(s,o,l);return u<Vo?null:(s*=u=1/u,o*=u,l*=u,n=Math.sin(t),a=1-(i=Math.cos(t)),e[0]=s*s*a+i,e[1]=o*s*a+l*n,e[2]=l*s*a-o*n,e[3]=0,e[4]=s*o*a-l*n,e[5]=o*o*a+i,e[6]=l*o*a+s*n,e[7]=0,e[8]=s*l*a+o*n,e[9]=o*l*a-s*n,e[10]=l*l*a+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromRotationTranslation:rl,fromRotationTranslationScale:sl,fromRotationTranslationScaleOrigin:function(e,t,r,n,i){var a=t[0],s=t[1],o=t[2],l=t[3],u=a+a,c=s+s,h=o+o,d=a*u,p=a*c,f=a*h,m=s*c,g=s*h,_=o*h,v=l*u,y=l*c,x=l*h,b=n[0],A=n[1],S=n[2],E=i[0],w=i[1],C=i[2],T=(1-(m+_))*b,D=(p+x)*b,M=(f-y)*b,P=(p-x)*A,F=(1-(d+_))*A,R=(g+v)*A,N=(f+y)*S,B=(g-v)*S,I=(1-(d+m))*S;return e[0]=T,e[1]=D,e[2]=M,e[3]=0,e[4]=P,e[5]=F,e[6]=R,e[7]=0,e[8]=N,e[9]=B,e[10]=I,e[11]=0,e[12]=r[0]+E-(T*E+P*w+N*C),e[13]=r[1]+w-(D*E+F*w+B*C),e[14]=r[2]+C-(M*E+R*w+I*C),e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromValues:function(e,t,r,n,i,a,s,o,l,u,c,h,d,p,f,m){var g=new Go(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=n,g[4]=i,g[5]=a,g[6]=s,g[7]=o,g[8]=l,g[9]=u,g[10]=c,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},fromXRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,r,n,i,a,s){var o=1/(r-t),l=1/(i-n),u=1/(a-s);return e[0]=2*a*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(i+n)*l,e[10]=(s+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*u,e[15]=0,e},getRotation:al,getScaling:il,getTranslation:nl,identity:$o,invert:el,lookAt:function(e,t,r,n){var i,a,s,o,l,u,c,h,d,p,f=t[0],m=t[1],g=t[2],_=n[0],v=n[1],y=n[2],x=r[0],b=r[1],A=r[2];return Math.abs(f-x)<Vo&&Math.abs(m-b)<Vo&&Math.abs(g-A)<Vo?$o(e):(c=f-x,h=m-b,d=g-A,i=v*(d*=p=1/Math.hypot(c,h,d))-y*(h*=p),a=y*(c*=p)-_*d,s=_*h-v*c,(p=Math.hypot(i,a,s))?(i*=p=1/p,a*=p,s*=p):(i=0,a=0,s=0),o=h*s-d*a,l=d*i-c*s,u=c*a-h*i,(p=Math.hypot(o,l,u))?(o*=p=1/p,l*=p,u*=p):(o=0,l=0,u=0),e[0]=i,e[1]=o,e[2]=c,e[3]=0,e[4]=a,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=u,e[10]=d,e[11]=0,e[12]=-(i*f+a*m+s*g),e[13]=-(o*f+l*m+u*g),e[14]=-(c*f+h*m+d*g),e[15]=1,e)},mul:fl,multiply:tl,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},ortho:hl,orthoNO:cl,orthoZO:function(e,t,r,n,i,a,s){var o=1/(t-r),l=1/(n-i),u=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+r)*o,e[13]=(i+n)*l,e[14]=a*u,e[15]=1,e},perspective:ul,perspectiveFromFieldOfView:function(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+o),u=2/(i+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(s-o)*l*.5,e[9]=(i-a)*u*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},perspectiveNO:ll,perspectiveZO:function(e,t,r,n,i){var a,s=1/Math.tan(t/2);return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(n-i),e[10]=i*a,e[14]=i*n*a):(e[10]=-1,e[14]=-n),e},rotate:function(e,t,r,n){var i,a,s,o,l,u,c,h,d,p,f,m,g,_,v,y,x,b,A,S,E,w,C,T,D=n[0],M=n[1],P=n[2],F=Math.hypot(D,M,P);return F<Vo?null:(D*=F=1/F,M*=F,P*=F,i=Math.sin(r),s=1-(a=Math.cos(r)),o=t[0],l=t[1],u=t[2],c=t[3],h=t[4],d=t[5],p=t[6],f=t[7],m=t[8],g=t[9],_=t[10],v=t[11],y=D*D*s+a,x=M*D*s+P*i,b=P*D*s-M*i,A=D*M*s-P*i,S=M*M*s+a,E=P*M*s+D*i,w=D*P*s+M*i,C=M*P*s-D*i,T=P*P*s+a,e[0]=o*y+h*x+m*b,e[1]=l*y+d*x+g*b,e[2]=u*y+p*x+_*b,e[3]=c*y+f*x+v*b,e[4]=o*A+h*S+m*E,e[5]=l*A+d*S+g*E,e[6]=u*A+p*S+_*E,e[7]=c*A+f*S+v*E,e[8]=o*w+h*C+m*T,e[9]=l*w+d*C+g*T,e[10]=u*w+p*C+_*T,e[11]=c*w+f*C+v*T,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],s=t[5],o=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+u*n,e[5]=s*i+c*n,e[6]=o*i+h*n,e[7]=l*i+d*n,e[8]=u*i-a*n,e[9]=c*i-s*n,e[10]=h*i-o*n,e[11]=d*i-l*n,e},rotateY:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-u*n,e[1]=s*i-c*n,e[2]=o*i-h*n,e[3]=l*i-d*n,e[8]=a*n+u*i,e[9]=s*n+c*i,e[10]=o*n+h*i,e[11]=l*n+d*i,e},rotateZ:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],u=t[4],c=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+u*n,e[1]=s*i+c*n,e[2]=o*i+h*n,e[3]=l*i+d*n,e[4]=u*i-a*n,e[5]=c*i-s*n,e[6]=h*i-o*n,e[7]=d*i-l*n,e},scale:function(e,t,r){var n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},set:function(e,t,r,n,i,a,s,o,l,u,c,h,d,p,f,m,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=s,e[6]=o,e[7]=l,e[8]=u,e[9]=c,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},sub:ml,subtract:pl,targetTo:dl,translate:function(e,t,r){var n,i,a,s,o,l,u,c,h,d,p,f,m=r[0],g=r[1],_=r[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=n,e[1]=i,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=n*m+o*g+h*_+t[12],e[13]=i*m+l*g+d*_+t[13],e[14]=a*m+u*g+p*_+t[14],e[15]=s*m+c*g+f*_+t[15]),e},transpose:function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=i,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}});function _l(){var e=new Go(3);return Go!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function vl(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function yl(e,t,r){var n=new Go(3);return n[0]=e,n[1]=t,n[2]=r,n}function xl(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function bl(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Al(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Sl(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function El(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function wl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Cl(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.hypot(r,n,i)}function Tl(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function Dl(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function Ml(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Pl(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Fl(e,t,r){var n=t[0],i=t[1],a=t[2],s=r[0],o=r[1],l=r[2];return e[0]=i*l-a*o,e[1]=a*s-n*l,e[2]=n*o-i*s,e}function Rl(e,t,r){var n=t[0],i=t[1],a=t[2],s=r[3]*n+r[7]*i+r[11]*a+r[15];return s=s||1,e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/s,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/s,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/s,e}function Nl(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],s=t[1],o=t[2];return Math.abs(r-a)<=Vo*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=Vo*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-o)<=Vo*Math.max(1,Math.abs(i),Math.abs(o))}var Bl,Il=Al,Ol=Sl,kl=El,Ll=Cl,Ul=Tl,zl=vl,jl=Dl,Vl=(Bl=_l(),function(e,t,r,n,i,a){var s,o;for(t||(t=3),r||(r=0),o=n?Math.min(n*t+r,e.length):e.length,s=r;s<o;s+=t)Bl[0]=e[s],Bl[1]=e[s+1],Bl[2]=e[s+2],i(Bl,Bl,a),e[s]=Bl[0],e[s+1]=Bl[1],e[s+2]=Bl[2];return e}),Gl=Object.freeze({__proto__:null,add:bl,angle:function(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],s=t[1],o=t[2],l=Math.sqrt(r*r+n*n+i*i)*Math.sqrt(a*a+s*s+o*o),u=l&&Pl(e,t)/l;return Math.acos(Math.min(Math.max(u,-1),1))},bezier:function(e,t,r,n,i,a){var s=1-a,o=s*s,l=a*a,u=o*s,c=3*a*o,h=3*l*s,d=l*a;return e[0]=t[0]*u+r[0]*c+n[0]*h+i[0]*d,e[1]=t[1]*u+r[1]*c+n[1]*h+i[1]*d,e[2]=t[2]*u+r[2]*c+n[2]*h+i[2]*d,e},ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},clone:function(e){var t=new Go(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},create:_l,cross:Fl,dist:Ll,distance:Cl,div:kl,divide:El,dot:Pl,equals:Nl,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},forEach:Vl,fromValues:yl,hermite:function(e,t,r,n,i,a){var s=a*a,o=s*(2*a-3)+1,l=s*(a-2)+a,u=s*(a-1),c=s*(3-2*a);return e[0]=t[0]*o+r[0]*l+n[0]*u+i[0]*c,e[1]=t[1]*o+r[1]*l+n[1]*u+i[1]*c,e[2]=t[2]*o+r[2]*l+n[2]*u+i[2]*c,e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},len:zl,length:vl,lerp:function(e,t,r,n){var i=t[0],a=t[1],s=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=s+n*(r[2]-s),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},mul:Ol,multiply:Sl,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},normalize:Ml,random:function(e,t){t=t||1;var r=2*Wo()*Math.PI,n=2*Wo()-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e},rotateX:function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},rotateY:function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},rotateZ:function(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:wl,scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},set:xl,sqrDist:Ul,sqrLen:jl,squaredDistance:Tl,squaredLength:Dl,str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},sub:Il,subtract:Al,transformMat3:function(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e},transformMat4:Rl,transformQuat:function(e,t,r){var n=r[0],i=r[1],a=r[2],s=r[3],o=t[0],l=t[1],u=t[2],c=i*u-a*l,h=a*o-n*u,d=n*l-i*o,p=i*d-a*h,f=a*c-n*d,m=n*h-i*c,g=2*s;return c*=g,h*=g,d*=g,p*=2,f*=2,m*=2,e[0]=o+c+p,e[1]=l+h+f,e[2]=u+d+m,e},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e}});function Wl(){var e=new Go(4);return Go!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Hl(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function ql(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3],o=r[0],l=r[1],u=r[2],c=r[3];return e[0]=n*c+s*o+i*u-a*l,e[1]=i*c+s*l+a*o-n*u,e[2]=a*c+s*u+n*l-i*o,e[3]=s*c-n*o-i*l-a*u,e}function Xl(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=Math.sqrt(r*r+n*n+i*i),o=Math.exp(a),l=s>0?o*Math.sin(s)/s:0;return e[0]=r*l,e[1]=n*l,e[2]=i*l,e[3]=o*Math.cos(s),e}function Ql(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=Math.sqrt(r*r+n*n+i*i),o=s>0?Math.atan2(s,a)/s:0;return e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=.5*Math.log(r*r+n*n+i*i+a*a),e}function Kl(e,t,r,n){var i,a,s,o,l,u=t[0],c=t[1],h=t[2],d=t[3],p=r[0],f=r[1],m=r[2],g=r[3];return(a=u*p+c*f+h*m+d*g)<0&&(a=-a,p=-p,f=-f,m=-m,g=-g),1-a>Vo?(i=Math.acos(a),s=Math.sin(i),o=Math.sin((1-n)*i)/s,l=Math.sin(n*i)/s):(o=1-n,l=n),e[0]=o*u+l*p,e[1]=o*c+l*f,e[2]=o*h+l*m,e[3]=o*d+l*g,e}function Yl(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,s=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*s+s]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*a+s]-t[3*s+a])*r,e[a]=(t[3*a+i]+t[3*i+a])*r,e[s]=(t[3*s+i]+t[3*i+s])*r}return e}!function(){var e,t=(e=new Go(4),Go!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();var Zl,Jl,$l,eu,tu,ru,nu=function(e){var t=new Go(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},iu=function(e,t,r,n){var i=new Go(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},au=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},su=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},ou=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},lu=ql,uu=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},cu=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},hu=function(e,t,r,n){var i=t[0],a=t[1],s=t[2],o=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=s+n*(r[2]-s),e[3]=o+n*(r[3]-o),e},du=function(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.hypot(t,r,n,i)},pu=du,fu=function(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i},mu=fu,gu=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=r*r+n*n+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=a*s,e},_u=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},vu=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],s=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(r-s)<=Vo*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=Vo*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-l)<=Vo*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-u)<=Vo*Math.max(1,Math.abs(a),Math.abs(u))},yu=(Zl=_l(),Jl=yl(1,0,0),$l=yl(0,1,0),function(e,t,r){var n=Pl(t,r);return n<-.999999?(Fl(Zl,Jl,t),zl(Zl)<1e-6&&Fl(Zl,$l,t),Ml(Zl,Zl),Hl(e,Zl,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Fl(Zl,t,r),e[0]=Zl[0],e[1]=Zl[1],e[2]=Zl[2],e[3]=1+n,gu(e,e))}),xu=(eu=Wl(),tu=Wl(),function(e,t,r,n,i,a){return Kl(eu,t,i,a),Kl(tu,r,n,a),Kl(e,eu,tu,2*a*(1-a)),e}),bu=(ru=Ho(),function(e,t,r,n){return ru[0]=r[0],ru[3]=r[1],ru[6]=r[2],ru[1]=n[0],ru[4]=n[1],ru[7]=n[2],ru[2]=-t[0],ru[5]=-t[1],ru[8]=-t[2],gu(e,Yl(e,ru))}),Au=Object.freeze({__proto__:null,add:ou,calculateW:function(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},clone:nu,conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},copy:au,create:Wl,dot:cu,equals:vu,exactEquals:_u,exp:Xl,fromEuler:function(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var a=Math.sin(t),s=Math.cos(t),o=Math.sin(r),l=Math.cos(r),u=Math.sin(n),c=Math.cos(n);return e[0]=a*l*c-s*o*u,e[1]=s*o*c+a*l*u,e[2]=s*l*u-a*o*c,e[3]=s*l*c+a*o*u,e},fromMat3:Yl,fromValues:iu,getAngle:function(e,t){var r=cu(e,t);return Math.acos(2*r*r-1)},getAxisAngle:function(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>Vo?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r},identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=r*r+n*n+i*i+a*a,o=s?1/s:0;return e[0]=-r*o,e[1]=-n*o,e[2]=-i*o,e[3]=a*o,e},len:pu,length:du,lerp:hu,ln:Ql,mul:lu,multiply:ql,normalize:gu,pow:function(e,t,r){return Ql(e,t),uu(e,e,r),Xl(e,e),e},random:function(e){var t=Wo(),r=Wo(),n=Wo(),i=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*r),e[1]=i*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*n),e[3]=a*Math.cos(2*Math.PI*n),e},rotateX:function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+s*o,e[1]=i*l+a*o,e[2]=a*l-i*o,e[3]=s*l-n*o,e},rotateY:function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l-a*o,e[1]=i*l+s*o,e[2]=a*l+n*o,e[3]=s*l-i*o,e},rotateZ:function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*o,e[1]=i*l-n*o,e[2]=a*l+s*o,e[3]=s*l-a*o,e},rotationTo:yu,scale:uu,set:su,setAxes:bu,setAxisAngle:Hl,slerp:Kl,sqlerp:xu,sqrLen:mu,squaredLength:fu,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}});function Su(e,t,r,n){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}function Eu(e,t,r,n){return[Su(n,e[0],t[0],r[0]),Su(n,e[1],t[1],r[1]),Su(n,e[2],t[2],r[2])]}class wu{constructor(e){void 0===e&&(e=50),this._divisions=e}getPoints(e,t,r){for(var n=[],i=0;i<=this._divisions;i++)n.push(Eu(e,t,r,i/this._divisions));return n.map((e=>[e[0],e[1],e[2]]))}splitPoints(e,t){for(var r=e.length,n=[],i=0;i<r-2;i+=1){var a=this.getNearPoint(e[i],e[i+1],t),s=this.getNearPoint(e[i+1],e[i+2],t);n.push([e[i],[a[0],a[1],a[2]],e[i+1],[s[0],s[1],s[2]],e[i+2]])}return n}getNearPoint(e,t,r){var n=[0,0,0];return n[0]=e[0]+r*(t[0]-e[0]),n[1]=e[1]+r*(t[1]-e[1]),n[2]=e[2]+r*(t[2]-e[2]),n}}!function(e){Go=e}(Array);for(var Cu=_l(),Tu=_l(),Du=_l(),Mu=Zo(),Pu=Zo(),Fu=Zo(),Ru=_l(),Nu=Wl(),Bu=_l(),Iu=[1,1,1],Ou=$o([]),ku=[],Lu=0;Lu<256;Lu++)ku[Lu]=(Lu<16?"0":"")+Lu.toString(16).toUpperCase();function Uu(e,t,r,n){var i=Math.cos(t),a=Math.cos(r),s=Math.cos(n),o=Math.sin(t),l=Math.sin(r),u=Math.sin(n);return e[0]=o*a*s+i*l*u,e[1]=i*l*s-o*a*u,e[2]=i*a*u+o*l*s,e[3]=i*a*s-o*l*u,e}let zu=class e{static equalsNumber(t,r,n){return void 0===n&&(n=1e-4),e.abs(t-r)<n}static generateUUID(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return ku[255&e]+ku[e>>8&255]+ku[e>>16&255]+ku[e>>24&255]+"-"+ku[255&t]+ku[t>>8&255]+"-"+ku[t>>16&15|64]+ku[t>>24&255]+"-"+ku[63&r|128]+ku[r>>8&255]+"-"+ku[r>>16&255]+ku[r>>24&255]+ku[255&n]+ku[n>>8&255]+ku[n>>16&255]+ku[n>>24&255]}static clamp(e,t,r){return Math.max(t,Math.min(r,e))}static randomBoolean(){return!!(e.randomInt()%2)}static randomFloat(e,t){return void 0===e&&(e=0),void 0===t&&(t=4294967295),Math.random()*(t-e)+e}static randomInt(e,t){return void 0===e&&(e=0),void 0===t&&(t=4294967295),Math.floor(Math.random()*(t-e+1))+e}static randomIndexFromArray(t){return e.randomInt(0,t.length-1)}static randomFromArray(t){return t[e.randomIndexFromArray(t)]}static randomKeyFromObject(t,r){var n=Object.keys(t);if(r)if(we.isArray(r))r.forEach((e=>{var t=n.indexOf(e);-1!==t&&n.splice(t,1)}));else{var i=n.indexOf(r);-1!==i&&n.splice(i,1)}var a=e.randomIndexFromArray(n);return n[a]}static randomFromObject(t,r){return t[e.randomKeyFromObject(t,r)]}static degToRad(t){return t*e.DEG2RAD}static radToDeg(t){return t*e.RAD2DEG}static anglesToRadians(t){return t.map((t=>e.degToRad(t)))}static radiansToAngles(t){return t.map((t=>e.radToDeg(t)))}static isPrime(e){for(var t=2,r=Math.sqrt(e);t<=r;t++)if(e%t==0)return!1;return e>1}static ceilAlign(e,t){var r=e%t;return r?e+t-r:e}static floorAlign(e,t){return e-e%t}static isPowerOfTwo(e){return 0==(e&e-1)&&0!==e}static ceilPowerOfTwo(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}static floorPowerOfTwo(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}static toInteger(e){return(e=+e)!=e?e=0:0!==e&&e!==1/0&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}static fract(e){return e-Math.floor(e)}static swapArray(e,t,r){return e[t]=e.splice(r,1,e[t])[0],e}static roundUp(e,t){if("number"==typeof e){for(var r=1;t>0;r*=10,t--);for(;t<0;r/=10,t++);return Math.round(e*r)/r}return e}static toHexNumberString(e,t){void 0===t&&(t="00000000");var r=e<0;e=e.toString(16),r&&(e=e.substring(1));var n=t+e;return n=n.substring(e.length,n.length),r&&(n="-"+n),n}static getDistanceToSquared(e,t){if(2==e.length&&2==t.length)return(r=e[0]-t[0])*r+(n=e[1]-t[1])*n;var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}static getDistance(t,r){return Math.sqrt(e.getDistanceToSquared(t,r))}static getDurationFromSpeed(t,r,n){return void 0===n&&(n=!1),!t||!r||r<=0?0:e.getDistanceFromPoints(t,n)/r*1e3}static randomVector(t,r){return 2==t.length?[e.randomFloat(t[0],r[0]),e.randomFloat(t[1],r[1])]:3==t.length?[e.randomFloat(t[0],r[0]),e.randomFloat(t[1],r[1]),e.randomFloat(t[2],r[2])]:null}static randomVector2Range(t,r){return e.randomVector([t,t],[r,r])}static randomVector3Range(t,r){return e.randomVector([t,t,t],[r,r,r])}static randomColor(){return e.randomInt(0,16777215)}static lerp(e,t,r){return e+(t-e)*r}static lerpVector(e,t,r,n){return(n=n||[])[0]=e[0]+(t[0]-e[0])*r,n[1]=e[1]+(t[1]-e[1])*r,n[2]=e[2]+(t[2]-e[2])*r,n}static equalsVector(t,r,n){if(void 0===n&&(n=1e-4),2===t.length){if(!e.equalsNumber(t[0],r[0],n)||!e.equalsNumber(t[1],r[1],n))return!1}else if(!(3!==t.length||e.equalsNumber(t[0],r[0],n)&&e.equalsNumber(t[1],r[1],n)&&e.equalsNumber(t[2],r[2],n)))return!1;return!0}static equalsVector3(t,r,n){return void 0===n&&(n=1e-4),!!(e.equalsNumber(t[0],r[0],n)&&e.equalsNumber(t[1],r[1],n)&&e.equalsNumber(t[2],r[2],n))}static exactEqualsVector3(e,t){return e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]}static isZeroVector(e){if(e)for(var t=0;t<e.length;t++)if(e[t])return!1;return!0}static isParallelVector(e,t){return e[0]*t[1]==e[1]*t[0]&&e[0]*t[2]==e[2]*t[0]&&e[1]*t[2]==e[2]*t[1]}static addVector(e,t,r){return r=r||[],we.isNumber(t)?(r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t):(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2]),r}static subVector(e,t,r){return r=r||[],we.isNumber(t)?(r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]-t):(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2]),r}static scaleVector(e,t,r){return r=r||[],we.isNumber(t)?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t):(r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2]),r}static divideVector(e,t,r){return r=r||[],we.isNumber(t)?(r[0]=e[0]/t,r[1]=e[1]/t,r[2]=e[2]/t):(r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2]),r}static clampVector(e,t,r,n){return(n=n||[])[0]=Math.max(t[0],Math.min(r[0],e[0])),n[1]=Math.max(t[1],Math.min(r[1],e[1])),n[2]=Math.max(t[2],Math.min(r[2],e[2])),n}static dotVector(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}static crossVector(e,t,r){return(r=r||[])[0]=e[1]*t[2]-e[2]*t[1],r[1]=e[2]*t[0]-e[0]*t[2],r[2]=e[0]*t[1]-e[1]*t[0],r}static negVector(e,t){return(t=t||[])[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}static normalizeVector(e,t){return void 0===t&&(t=[0,0,0]),Ml(t,e)}static minVector(e){if(!e.length)return null;if(1===e.length)return e[0].slice(0);for(var t=e[0].slice(0),r=1;r<e.length;r++){var n=e[r];t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),t[2]=Math.min(t[2],n[2])}return t}static maxVector(e){if(!e.length)return null;if(1===e.length)return e[0].slice(0);for(var t=e[0].slice(0),r=1;r<e.length;r++){var n=e[r];t[0]=Math.max(t[0],n[0]),t[1]=Math.max(t[1],n[1]),t[2]=Math.max(t[2],n[2])}return t}static getVec3FromMatrixColumn(e,t,r){var n=4*t;return(r=r||[])[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r}static transformDirection(t,r){var n=t[0],i=t[1],a=t[2],s=r,o=[0,0,0];return o[0]=s[0]*n+s[4]*i+s[8]*a,o[1]=s[1]*n+s[5]*i+s[9]*a,o[2]=s[2]*n+s[6]*i+s[10]*a,e.normalizeVector(o)}static getVectorLength(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}static getVectorLengthSquared(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}static getDirection(t,r){var n=e.subVector(r,t);return e.normalizeVector(n)}static getDistanceFromPoints(t,r){if(void 0===r&&(r=!1),!t||t.length<2)return 0;for(var n=0,i=0;i<t.length-1;i++)n+=e.getDistance(t[i],t[i+1]);return r&&(n+=e.getDistance(t[t.length-1],t[0])),n}static getCenterFromPoints(e){if(!e)return[0,0,0];var t=[0,0,0];return e.forEach((e=>{t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]})),t[0]/=e.length,t[1]/=e.length,t[2]/=e.length,t}static toUniquePoints(t,r){void 0===r&&(r=1e-4);var n=[];return t.forEach((t=>{for(var i=0;i<n.length;i++){var a=n[i];if(e.equalsVector(a,t,r))return}n.push(t)})),n}static getAngleBetweenVectors(t,r){if(2===t.length){var n=t[0]*r[0]+t[1]*r[1],i=t[0]*r[1]-t[1]*r[0],a=Math.atan2(i,n);return e.radToDeg(a)}return 3===t.length?(t=e.normalizeVector(t),r=e.normalizeVector(r),(n=e.dotVector(t,r))>1&&n<1+e.TOLERANCE?n=1:n<-1&&n>-1-e.TOLERANCE&&(n=-1),e.radToDeg(e.acos(n))):0}static getArea(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n][0]*e[i][1]-e[i][0]*e[n][1];return.5*r}static isClockWise(t){return e.getArea(t)<0}static makeClockWisePoints(e){var t=e.slice(0);t.sort(((e,t)=>e[1]-t[1]));var r=(t[0][1]+t[t.length-1][1])/2;t.sort(((e,t)=>t[0]-e[0]));var n,i=[(t[0][0]+t[t.length-1][0])/2,r];t.forEach((e=>{var t=Math.atan2(e[1]-i[1],e[0]-i[0]);n?t<n&&(t+=2*Math.PI):n=t,e.angle=t})),t.sort(((e,t)=>e.angle-t.angle));var a=t.reverse();return a.unshift(a.pop()),a.map((e=>[e[0],e[1]]))}static intersectPoint(e,t){var r=e[0],n=e[1];return!(r<t[0])&&(!(r>t[2])&&(!(n<t[1])&&!(n>t[3])))}static getDirectionFromAngles(e,t){var r=t/180*Math.PI+Math.PI/2,n=-e/180*Math.PI+Math.PI/2,i=Math.sin(r);return[i*Math.cos(n),-Math.cos(r),i*Math.sin(n)]}static getOffsetFromAngles(t,r,n){var i=e.getDirectionFromAngles(t,r);return wl(i,i,n)}static getAnglesFromOffset(t){if(!t)return[0,0];Ml(Cu,t);var r=-Math.acos(Cu[1]),n=Math.atan2(Cu[0],Cu[2]),i=e.radToDeg(n),a=e.radToDeg(r);return a>0&&a<.001?a=90:a<90?a=90-a:a-=90,[i-=180,a]}static projectOnVector(e,t,r){var n=vl(r);return 0===n?xl(e,0,0,0):wl(e,r,Pl(t,r)/n)}static projectOnPlane(t,r,n){return e.projectOnVector(t,r,n),t[0]=r[0]-t[0],t[1]=r[1]-t[1],t[2]=r[2]-t[2],t}static toPlanePoints(e){if(!e||!e.length)return[];var t=e[0].length;return t?3==t?e.map((e=>[e[0],e[2]])):e.slice(0):[]}static slerp(e,t,r){return Kl([],e,t,r)}static lookAt(t,r,n){var i=[];if(Nl(t,r))Jo(i,Ou);else if(dl(i,t,r,n),!i[0]||!i[5]||!i[10]){var a=e.TOLERANCE;dl(i,t,[r[0]-a,r[1]-a,r[2]-a],n)}return i}static getQuatFromAxisRadian(e,t,r){var n=t/2,i=Math.sin(n);return(r=r||[])[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=Math.cos(n),r}static getQuatFromAxisAngle(t,r,n){var i=e.degToRad(r);return e.getQuatFromAxisRadian(t,i,n)}static getQuatLength(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3])}static getQuatFromAngles(e,t){void 0===t&&(t=[0,0,0,1]);var r=.5*Math.PI/180;return Uu(t,e[0]*r,e[1]*r,e[2]*r)}static getQuatFromEuler(e,t){return void 0===t&&(t=[0,0,0,1]),Uu(t,.5*e[0],.5*e[1],.5*e[2])}static getQuatFromMat4(e){return al([],e)}static getQuatFromTarget(t,r,n){var i=e.lookAt(r,t,n);return e.getQuatFromMat4(i)}static getEulerFromQuat(t,r){ol(Mu,t);var n=Mu[0],i=Mu[4],a=Mu[8],s=Mu[5],o=Mu[9],l=Mu[6],u=Mu[10],c=r||[0,0,0];return c[1]=Math.asin(e.clamp(a,-1,1)),Math.abs(a)<.9999999?(c[0]=Math.atan2(-o,u),c[2]=Math.atan2(-i,n)):(c[0]=Math.atan2(l,s),c[2]=0),c}static getAnglesFromQuat(t,r){var n=e.getEulerFromQuat(t,r);return n[0]=e.radToDeg(n[0]),n[1]=e.radToDeg(n[1]),n[2]=e.radToDeg(n[2]),n}static pixelToScreenCoordinate(e,t){return[e[0]/t[0]*2-1,-e[1]/t[1]*2+1]}static screenCoordinateToPixel(e,t){return[(e[0]+1)/2*t[0],(e[1]-1)/-2*t[1]]}static getPositionOnDirection(t,r,n){return e.addVector(t,e.scaleVector(r,n))}static getPositionOnPlane(t,r,n){return Al(Tu,t,r),e.projectOnPlane(Du,Tu,n),bl(Tu,Du,r),[Tu[0],Tu[1],Tu[2]]}static createVec3(){return[0,0,0]}static createQuat(){return[0,0,0,1]}static createEuler(){return[0,0,0]}static createMat3(){return[1,0,0,0,1,0,0,0,1]}static createMat4(t,r,n){if(arguments.length){var i=e.getQuatFromAngles(r,Nu);return sl(e.createMat4(),i,t,n)}return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}static getPointOnLine(t,r,n){var i;return 1===n?i=r.concat():0==n?i=t.concat():(i=e.subVector(r,t),i=e.scaleVector(i,n),i=e.addVector(t,i)),i}static getQuatFromUnitVectors(t,r){var n=[],i=e.dotVector(t,r)+1;return i<Number.EPSILON?(i=0,Math.abs(t[0])>Math.abs(t[2])?(n[0]=-t[1],n[1]=t[0],n[2]=0,n[3]=i):(n[0]=0,n[1]=-t[2],n[2]=t[1],n[3]=i)):(n[0]=t[1]*r[2]-t[2]*r[1],n[1]=t[2]*r[0]-t[0]*r[2],n[2]=t[0]*r[1]-t[1]*r[0],n[3]=i),e.normalizeQuat(n)}static normalizeQuat(t){var r=[],n=e.getQuatLength(t);return 0===n?(r[0]=0,r[1]=0,r[2]=0,r[3]=1):(n=1/n,r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n),r}static getQuatLength(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3])}static multiplyQuat(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],s=t[0],o=t[1],l=t[2],u=t[3];return[r*u+a*s+n*l-i*o,n*u+a*o+i*s-r*l,i*u+a*l+r*o-n*s,a*u-r*s-n*o-i*l]}static vec3ApplyQuat(e,t,r){var n=e[0],i=e[1],a=e[2],s=t[0],o=t[1],l=t[2],u=t[3],c=u*n+o*a-l*i,h=u*i+l*n-s*a,d=u*a+s*i-o*n,p=-s*n-o*i-l*a;return void 0===r&&(r=[0,0,0]),r[0]=c*u+p*-s+h*-l-d*-o,r[1]=h*u+p*-o+d*-s-c*-l,r[2]=d*u+p*-l+c*-o-h*-s,r}static decomposeFromMat4(e,t,r,n){t&&nl(t,e),r&&(al(r,e),gu(r,r)),n&&il(n,e)}static composeToMat4(e,t,r,n){return sl(n=n||[],t,e,r)}static selfToWorld(e,t,r,n){return n=n||[],r?(nl(Ru,e),il(Bu,e),al(Nu,e),sl(Mu,Nu,Ru,Iu),Rl(n,t,Mu)):Rl(n,t,e),n}static worldToSelf(e,t,r,n){return n=n||[],r?(nl(Ru,e),il(Bu,e),al(Nu,e),sl(Fu,Nu,Ru,Iu),el(Pu,Fu)):el(Pu,e),Rl(n,t,Pu),n}static intersectPlane(t,r,n,i){var a=[],s=e.dotVector(n,r),o=-(e.dotVector(t,n)+i)/s;return o<0?null:(a[0]=r[0]*o+t[0],a[1]=r[1]*o+t[1],a[2]=r[2]*o+t[2],a)}static intersectsBox(e,t,r,n){return!(t[0]<r[0]||e[0]>n[0]||t[1]<r[1]||e[1]>n[1]||t[2]<r[2]||e[2]>n[2])}static intersectsPoint(e,t,r){return!(e[0]<t[0]||e[0]>r[0]||e[1]<t[1]||e[1]>r[1]||e[2]<t[2]||e[2]>r[2])}static snapPoint(t,r){for(var n=e.getAnglesFromQuat(r.quaternion),i=e.createMat4(r.position,n,[1,1,1]),a=Rl([],t,el([],i)),s=Math.max(0,r.precision),o=[],l=0;l<3;l++){var u=.1*a[l],c=e.floor(u),h=u-c+.1*s*.5,d=s>0?h-h%(.1*s):h;o[l]=10*(c+d)}return Rl([],o,i)}static getPointsSteps(t){var r=e.getDistanceFromPoints(t);if(!r)return[];for(var n=[],i=0;i<t.length-1;i++){var a=e.getDistance(t[i],t[i+1]);n.push(a/r)}return n}static getArrayIndexFromProgress(t,r,n){if(!t.length)return-1;if(r>=1)return t.length-1;if(n){for(var i=0,a=0;a<n.length;a++){var s=n[a];if(i+s>=r)return a;i+=s}return i}var o=1/t.length,l=e.floor(r/o);return e.min(l,t.length-1)}static getArrayProgress(t,r,n){if(!t.length)return 0;if(r>=1)return 1;if(!n){var i=1/t.length;return e.fract(r/i)}for(var a=0,s=0;s<n.length;s++){var o=n[s];if(o){var l=a+o-r;if(l>=0)return 1-l/o;a+=o}}}static lerpPoints(t,r,n){var i,a,s=-1;if(1==(n=e.clamp(n,0,1)))i=t[(s=t.length-1)-1],a=t[s],e.vec3.copy(Cu,t[s]);else{s=e.getArrayIndexFromProgress(t,n,r);var o=e.getArrayProgress(t,n,r);i=t[s],a=t[s+1],e.vec3.lerp(Cu,i,a,o)}return{point:Cu,index:s,from:i,to:a}}static makeSphericalFromCartesianCoords(t){var r={radius:1,theta:0,phi:0},n=t[0],i=t[1],a=t[2];return r.radius=Math.sqrt(n*n+i*i+a*a),0===r.radius?(r.theta=0,r.phi=0):(r.theta=Math.atan2(n,a),r.phi=Math.acos(e.clamp(i/r.radius,-1,1))),r}static makeSphereicalSafe(e){void 0===e&&(e={radius:1,phi:0,theta:0});var t=1e-6;return e.phi=Math.max(t,Math.min(Math.PI-t,e.phi)),e}static getFromSphericalCoords(e){void 0===e&&(e={radius:1,phi:0,theta:0});var t=Math.sin(e.phi)*e.radius;return[t*Math.sin(e.theta),Math.cos(e.phi)*e.radius,t*Math.cos(e.theta)]}static pointInLineSegment(t,r,n,i,a){return i=void 0!==i?i:.001,a=void 0===a||a,n[0]==t[0]&&n[1]==t[1]||n[0]==r[0]&&n[1]==r[1]?a:e.pointToLineDistance(t,r,n)<i&&e.projectionInside(t,r,n,a)}static pointToLineDistance(e,t,r){var n,i;return t[0]===e[0]?(n=1/0,i=t[0]):(n=(t[1]-e[1])/(t[0]-e[0]),i=t[1]-n*t[0]),n!==1/0?Math.abs(n*r[0]-r[1]+i)/Math.sqrt(n*n+1):Math.abs(i-r[0])}static projectionInside(t,r,n,i){return i=void 0===i||i,t[0]===r[0]&&t[1]===r[1]?!!i&&(n[0]===t[0]&&n[1]===t[1]):(n=e.projectPointToLineSegment(t,r,n),i?n[1]>=Math.min(r[1],t[1])&&Math.max(r[1],t[1])>=n[1]&&n[0]>=Math.min(r[0],t[0])&&Math.max(r[0],t[0])>=n[0]:n[1]>Math.min(r[1],t[1])&&Math.max(r[1],t[1])>n[1]&&n[0]>Math.min(r[0],t[0])&&Math.max(r[0],t[0])>n[0]||n[0]===r[0]&&r[0]===t[0]&&n[1]>Math.min(r[1],t[1])&&Math.max(r[1],t[1])>n[1]||n[1]===r[1]&&r[1]===t[1]&&n[0]>Math.min(r[0],t[0])&&Math.max(r[0],t[0])>n[0])}static projectPointToLineSegment(e,t,r){var n,i,a,s;return Math.abs(t[0]-e[0])<=.001?(n="no",i=t[0]):(n=(t[1]-e[1])/(t[0]-e[0]),i=t[1]-n*t[0]),"no"!==n?0!==n?s=n*(a=(r[1]+r[0]/n-i)*n/(n*n+1))+i:(a=r[0],s=t[1]):(a=i,s=r[1]),[a,s]}static simplifyPoints(t,r,n){if(void 0===t&&(t=[]),void 0===r&&(r=!0),void 0===n&&(n=1.5),t.length&&!(t.length<3)){var i=t.slice(),a=i[0][1];return function t(r,n){void 0===n&&(n=0);for(var i=n;i<r.length;i++)if(i!==r.length-1){if(e.equalsVector(r[i],r[i+1]))return r.splice(i,1),void t(r,i)}else e.equalsVector(r[i],r[0])&&r.splice(i,1)}(i),r&&(i=function(t){for(var r=[],n=0;n<t.length-1;n++)r.push([[t[n][0],t[n][2]],[t[n+1][0],t[n+1][2]]]);r.push([[t[t.length-1][0],t[t.length-1][2]],[t[0][0],t[0][2]]]);for(var i=[],o=0;o<r.length-1;o++)for(var l=o+1;l<r.length;l++){var u=r[o],c=r[l];e.equalsVector(u[0],c[1])&&e.equalsVector(u[1],c[0])&&i.push([o,l])}var h=[];s(h,r,i);for(var d=[],p=function(){var e=[];h[f].forEach((t=>{e.push(t[0])})),d.push(e)},f=0;f<h.length;f++)p();for(var m=[],g=0,_=0;_<d.length;_++){var v=e.getArea(d[_]);g<v&&(g=v,m=d[_])}for(var y=0;y<m.length;y++){var x=m[y].slice();m[y]=[x[0],a,x[1]]}return m}(i)),function e(t,r){void 0===r&&(r=1);for(var n=r;n<t.length-1;n++)if(l([t[n-1],t[n],t[n+1]]))return t.splice(n,1),void e(t,n)}(i),l([i[i.length-1],i[0],i[1]])&&i.splice(0,1),l([i[i.length-2],i[i.length-1],i[0]])&&i.splice(i.length-1,1),i}function s(e,t,r){if(r.length>1)for(var n=r.length-1;n>=0;n--)for(var i=r[n],a=r.length-2;a>=0;a--){if(!o(i,r[a])){e.push(t.splice(i[0]+1,i[1]-i[0]-1)),t.splice(i[0],2),r.splice(n,2);for(var l=0;l<r.length;l++)r[l][0]>i[0]&&(r[l][0]-=i[1]-i[0]+1),r[l][1]>i[0]&&(r[l][1]-=i[1]-i[0]+1);return void s(e,t,r)}}else 1===r.length?(e.push(t.splice(r[0][0]+1,r[0][1]-r[0][0]-1)),t.splice(r[0][0],2),e.push(t)):e.push(t)}function o(e,t){return!(t[0]>e[1]||t[0]<e[0])||!(t[1]>e[1]||t[1]<e[0])}function l(t){var r=t[0],i=t[1],a=t[2],s=e.normalizeVector(e.subVector(r,i)),o=e.normalizeVector(e.subVector(i,a)),l=e.acos(e.dotVector(s,o));return e.radToDeg(l)<n}}static intersectLineSegments(t,r,n,i,a){if((a=void 0!==a?a:.001)>0){if(e.pointInLineSegment(t,r,n,a))return n[0]==t[0]&&n[1]==t[1]||n[0]==r[0]&&n[1]==r[1]?null:[n[0],n[1]];if(e.pointInLineSegment(t,r,i,a))return i[0]==t[0]&&i[1]==t[1]||i[0]==r[0]&&i[1]==r[1]?null:[i[0],i[1]];if(e.pointInLineSegment(n,i,t,a))return t[0]==n[0]&&t[1]==n[1]||t[0]==i[0]&&t[1]==i[1]?null:[t[0],t[1]];if(e.pointInLineSegment(n,i,r,a))return r[0]==n[0]&&r[1]==n[1]||r[0]==i[0]&&r[1]==i[1]?null:[r[0],r[1]]}var s=(t[0]-n[0])*(r[1]-n[1])-(t[1]-n[1])*(r[0]-n[0]),o=(t[0]-i[0])*(r[1]-i[1])-(t[1]-i[1])*(r[0]-i[0]);if(s*o>0)return null;var l=(n[0]-t[0])*(i[1]-t[1])-(n[1]-t[1])*(i[0]-t[0]);if(l*(l+s-o)>0)return null;if(o-s==0)return null;var u=l/(o-s),c=u*(r[0]-t[0]),h=u*(r[1]-t[1]);return[t[0]+c,t[1]+h]}static genSmoothPathByBezier(e,t,r){if(void 0===t&&(t=.5),void 0===r&&(r=50),!e||!e.length)return null;if(t>1||t<0)return console.error("curvature must between 0.0 and 1.0!"),e;if(r<=0)return console.error("divisions must above 0!"),e;var n=new wu(r),i=1-t,a=n.splitPoints(e,i);a.forEach(((e,t)=>{var r=n.getPoints(e[1],e[2],e[3]);0==t?a[t]=[e[0],...r]:t==a.length-1?a[t]=[...r,e[4]]:a[t]=[...r]}));var s=[];a.forEach((e=>{e.forEach((e=>{s.push(e)}))}));var o=n.getNearPoint(s[0],s[1],.01);return s.splice(1,0,[o[0],o[1],o[2]]),s}};zu.DEG2RAD=Math.PI/180,zu.RAD2DEG=180/Math.PI,zu.TOLERANCE=1e-5,zu.E=Math.E,zu.LN2=Math.LN2,zu.LN10=Math.LN10,zu.LOG2E=Math.LOG2E,zu.LOG10E=Math.LOG10E,zu.PI=Math.PI,zu.SQRT1_2=Math.SQRT1_2,zu.SQRT2=Math.SQRT2,zu.abs=Math.abs,zu.acos=Math.acos,zu.acosh=Math.acosh,zu.asin=Math.asin,zu.asinh=Math.asinh,zu.atan=Math.atan,zu.atan2=Math.atan2,zu.atanh=Math.atanh,zu.cbrt=Math.cbrt,zu.ceil=Math.ceil,zu.clz32=Math.clz32,zu.cos=Math.cos,zu.cosh=Math.cosh,zu.exp=Math.exp,zu.expm1=Math.expm1,zu.floor=Math.floor,zu.fround=Math.fround,zu.hypot=Math.hypot,zu.imul=Math.imul,zu.log=Math.log,zu.log1p=Math.log1p,zu.log2=Math.log2,zu.log10=Math.log10,zu.max=Math.max,zu.min=Math.min,zu.pow=Math.pow,zu.random=Math.random,zu.round=Math.round,zu.sign=Math.sign,zu.sin=Math.sin,zu.sinh=Math.sinh,zu.sqrt=Math.sqrt,zu.tan=Math.tan,zu.tanh=Math.tanh,zu.trunc=Math.trunc,zu.vec3=Gl,zu.quat=Au,zu.mat3=Yo,zu.mat4=gl;class ju{constructor(e,t){this._center=e||[0,0,0],this._radius=we.parseValue(t,0)}_getMaxScaleOnAxis(e){var t=e,r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(r,n,i))}applyMatrix4(e){return zu.vec3.transformMat4(this._center,this._center,e),this._radius*=this._getMaxScaleOnAxis(e),this}copy(e){return this._center=e.center,this._radius=e.radius,this}get center(){return this._center}get radius(){return this._radius}}var Vu=zu.createVec3();zu.createVec3(),zu.createVec3();let Gu=class{constructor(e,t){this._min=[1/0,1/0,1/0],this._max=[-1/0,-1/0,-1/0],this.set(e,t)}_getPoints(e,t,r){return(r=r||[])[0]=[e[0],e[1],e[2]],r[1]=[t[0],e[1],e[2]],r[2]=[t[0],e[1],t[2]],r[3]=[e[0],e[1],t[2]],r[4]=[e[0],t[1],e[2]],r[5]=[t[0],t[1],e[2]],r[6]=[t[0],t[1],t[2]],r[7]=[e[0],t[1],t[2]],r}_getLayoutPosition(e,t,r){if(3!==we.getArrayLength(e))return null;var n=this._getPoints(t,r),i=[[n[0],n[1]],[n[0],n[4]],[n[0],n[2]]],a=[we.getProgressByLayout(e[0]),we.getProgressByLayout(e[1]),we.getProgressByLayout(e[2])];return[zu.lerpVector(i[0][0],i[0][1],a[0])[0],zu.lerpVector(i[1][0],i[1][1],a[1])[1],zu.lerpVector(i[2][0],i[2][1],a[2])[2]]}isEmpty(){return this._max[0]<this._min[0]||this._max[1]<this._min[1]||this._max[2]<this._min[2]}makeEmpty(){return this._min=[1/0,1/0,1/0],this._max=[-1/0,-1/0,-1/0],this}set(e,t){return e&&t&&(zu.vec3.sub(this._min,e,t),zu.vec3.add(this._max,e,t)),this}expandByPoint(e){return zu.vec3.min(this._min,this._min,e),zu.vec3.max(this._max,this._max,e),this}getBoundingSphere(){return new ju(this.center,this.radius)}getPoints(){return this._getPoints(this.min,this.max)}getLayoutPosition(e){return this._getLayoutPosition(e,this.min,this.max)}get min(){return this._min.slice(0)}get max(){return this._max.slice(0)}get center(){return this.isEmpty()?[0,0,0]:zu.vec3.scale([],zu.vec3.add(Vu,this._min,this._max),.5)}get halfSize(){var e=this.size;return zu.vec3.scale(e,e,.5)}get size(){return this.isEmpty()?[0,0,0]:zu.vec3.sub([],this._max,this._min)}get radius(){var e=this.size;return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2))/2}};var Wu={c:null,u:[[],[],[]],e:[]},Hu={c:null,u:[[],[],[]],e:[]},qu=[[],[],[]],Xu=[[],[],[]],Qu=[],Ku=[];let Yu=class extends Gu{constructor(e,t,r){super(e,t),this._rotation=r?r.slice(0):[0,0,0,1]}_getWorldPosition(e,t){var r=t||[];return zu.vec3.transformQuat(r,e,this._rotation),zu.vec3.add(r,r,this.center)}get angles(){return zu.getAnglesFromQuat(this._rotation)}get min(){return this._getWorldPosition(zu.negVector(this.halfSize))}get max(){return this._getWorldPosition(this.halfSize)}get originalMin(){return super.min}get originalMax(){return super.max}getPoints(){return this._getPoints(zu.negVector(this.halfSize),this.halfSize).map((e=>this._getWorldPosition(e)))}getLayoutPosition(e){var t=this.halfSize,r=this._getLayoutPosition(e,zu.negVector(t),t);return this._getWorldPosition(r)}containsPoint(e){var t=zu.subVector(e,this.center),r=zu.vec3ApplyQuat([1,0,0],this._rotation),n=zu.vec3ApplyQuat([0,1,0],this._rotation),i=zu.vec3ApplyQuat([0,0,1],this._rotation);return zu.abs(zu.dotVector(t,r))<=this.halfSize[0]&&zu.abs(zu.dotVector(t,n))<=this.halfSize[1]&&zu.abs(zu.dotVector(t,i))<=this.halfSize[2]}intersectsOBB(e,t){void 0===t&&(t=Number.EPSILON),Wu.c=this.center,Wu.e=this.halfSize;var r=zu.mat3.fromQuat([],this._rotation);Wu.u[0]=[r[0],r[1],r[2]],Wu.u[1]=[r[3],r[4],r[5]],Wu.u[2]=[r[6],r[7],r[8]],Hu.c=e.center,Hu.e=e.halfSize;var n,i,a=zu.mat3.fromQuat([],e._rotation);Hu.u[0]=[a[0],a[1],a[2]],Hu.u[1]=[a[3],a[4],a[5]],Hu.u[2]=[a[6],a[7],a[8]];for(var s=0;s<3;s++)for(var o=0;o<3;o++)qu[s][o]=zu.dotVector(Wu.u[s],Hu.u[o]);Ku=zu.subVector(Hu.c,Wu.c),Qu[0]=zu.dotVector(Ku,Wu.u[0]),Qu[1]=zu.dotVector(Ku,Wu.u[1]),Qu[2]=zu.dotVector(Ku,Wu.u[2]);for(var l=0;l<3;l++)for(var u=0;u<3;u++)Xu[l][u]=zu.abs(qu[l][u])+t;for(var c=0;c<3;c++)if(n=Wu.e[c],i=Hu.e[0]*Xu[c][0]+Hu.e[1]*Xu[c][1]+Hu.e[2]*Xu[c][2],zu.abs(Qu[c])>n+i)return!1;for(var h=0;h<3;h++)if(n=Wu.e[0]*Xu[0][h]+Wu.e[1]*Xu[1][h]+Wu.e[2]*Xu[2][h],i=Hu.e[h],zu.abs(Qu[0]*qu[0][h]+Qu[1]*qu[1][h]+Qu[2]*qu[2][h])>n+i)return!1;return n=Wu.e[1]*Xu[2][0]+Wu.e[2]*Xu[1][0],i=Hu.e[1]*Xu[0][2]+Hu.e[2]*Xu[0][1],!(zu.abs(Qu[2]*qu[1][0]-Qu[1]*qu[2][0])>n+i)&&(n=Wu.e[1]*Xu[2][1]+Wu.e[2]*Xu[1][1],i=Hu.e[0]*Xu[0][2]+Hu.e[2]*Xu[0][0],!(zu.abs(Qu[2]*qu[1][1]-Qu[1]*qu[2][1])>n+i)&&(n=Wu.e[1]*Xu[2][2]+Wu.e[2]*Xu[1][2],i=Hu.e[0]*Xu[0][1]+Hu.e[1]*Xu[0][0],!(zu.abs(Qu[2]*qu[1][2]-Qu[1]*qu[2][2])>n+i)&&(n=Wu.e[0]*Xu[2][0]+Wu.e[2]*Xu[0][0],i=Hu.e[1]*Xu[1][2]+Hu.e[2]*Xu[1][1],!(zu.abs(Qu[0]*qu[2][0]-Qu[2]*qu[0][0])>n+i)&&(n=Wu.e[0]*Xu[2][1]+Wu.e[2]*Xu[0][1],i=Hu.e[0]*Xu[1][2]+Hu.e[2]*Xu[1][0],!(zu.abs(Qu[0]*qu[2][1]-Qu[2]*qu[0][1])>n+i)&&(n=Wu.e[0]*Xu[2][2]+Wu.e[2]*Xu[0][2],i=Hu.e[0]*Xu[1][1]+Hu.e[1]*Xu[1][0],!(zu.abs(Qu[0]*qu[2][2]-Qu[2]*qu[0][2])>n+i)&&(n=Wu.e[0]*Xu[1][0]+Wu.e[1]*Xu[0][0],i=Hu.e[1]*Xu[2][2]+Hu.e[2]*Xu[2][1],!(zu.abs(Qu[1]*qu[0][0]-Qu[0]*qu[1][0])>n+i)&&(n=Wu.e[0]*Xu[1][1]+Wu.e[1]*Xu[0][1],i=Hu.e[0]*Xu[2][2]+Hu.e[2]*Xu[2][0],!(zu.abs(Qu[1]*qu[0][1]-Qu[0]*qu[1][1])>n+i)&&(n=Wu.e[0]*Xu[1][2]+Wu.e[1]*Xu[0][2],i=Hu.e[0]*Xu[2][1]+Hu.e[1]*Xu[2][0],!(zu.abs(Qu[1]*qu[0][2]-Qu[0]*qu[1][2])>n+i)))))))))}};function Zu(e){throw new TypeError('"'+e+'" is read-only')}var Ju=zu.createVec3(),$u=zu.createVec3(),ec=zu.createMat3();let tc=class{constructor(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:[1,0,0],this.constant=void 0!==t?t:0}set(e,t){for(var r=0;r<3;r++)this.normal[r]=e[r];return this.constant=t,this}setComponents(e,t,r,n){return this.normal[0]=e,this.normal[1]=t,this.normal[2]=r,this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){for(var r=0;r<3;r++)this.normal[r]=e[r];return this.constant=-zu.dotVector(t,this.normal),this}setFromCoplanarPoints(e,t,r){zu.subVector(r,t),Zu("_vector1"),zu.subVector(e,t),Zu("_vector2");var n=zu.normalizeVector(zu.crossVector(Ju,$u));return this.setFromNormalAndCoplanarPoint(n,e),this}clone(){return(new this.constructor).copy(this)}copy(e){for(var t=0;t<3;t++)this.normal[t]=e.normal[t];return this.constant=e.constant,this}normalize(){var e=1/zu.getVectorLength(this.normal);return this.normal=zu.scaleVector(this.normal,e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal[0]=-this.normal[0],this.normal[1]=-this.normal[1],this.normal[2]=-this.normal[2],this}distanceToPoint(e){return zu.dotVector(this.normal,e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THING.Plane: .projectPoint() target is now required"),t=zu.createVec3()),t=zu.scaleVector([...this.normal],-this.distanceToPoint(e)),zu.addVector(t,e)}intersectsBox(e){var t,r;return this.normal[0]>0?(t=this.normal[0]*e.min[0],r=this.normal[0]*e.max[0]):(t=this.normal[0]*e.max[0],r=this.normal[0]*e.min[0]),this.normal[1]>0?(t+=this.normal[1]*e.min[1],r+=this.normal[1]*e.max[1]):(t+=this.normal[1]*e.max[1],r+=this.normal[1]*e.min[1]),this.normal[2]>0?(t+=this.normal[2]*e.min[2],r+=this.normal[2]*e.max[2]):(t+=this.normal[2]*e.max[2],r+=this.normal[2]*e.min[2]),t<=-this.constant&&r>=-this.constant}intersectsSphere(e){return Math.abs(this.distanceToPoint(e.center))<=e.radius}coplanarPoint(e){return void 0===e&&(console.warn("THING.EXTEND.Plane: .coplanarPoint() target is now required"),e=zu.createVec3()),e=[...this.normal],zu.scaleVector(e,-this.constant)}applyMatrix4(e,t){var r=t||zu.mat3.normalFromMat4(ec,e),n=zu.createVec3();zu.vec3.transformMat4(n,this.coplanarPoint(Ju),e);var i=zu.createVec3();return zu.vec3.transformMat3(i,this.normal,r),this.normal=zu.normalizeVector(i),this.constant=-zu.dotVector(n,this.normal),this}translate(e){return this.constant-=zu.dotVector(e,this.normal),this}equals(e){return zu.equalsVector(e.normal,this.normal)&&e.constant===this.constant}};var rc=zu.createVec3();function nc(e,t){return e.distance-t.distance}var ic=zu.createMat4(),ac=new Gu;class sc{constructor(e){void 0===e&&(e={}),this._vertices={near:[zu.createVec3(),zu.createVec3(),zu.createVec3(),zu.createVec3()],far:[zu.createVec3(),zu.createVec3(),zu.createVec3(),zu.createVec3()]},void 0!==e.projectionMatrix&&this.setFromProjectionMatrix(e.projectionMatrix,e.maxFar||1e4)}setFromProjectionMatrix(e,t){var r=0===e[11];zu.mat4.invert(ic,e);var n=this._vertices.near;zu.vec3.set(n[0],1,1,-1),zu.vec3.set(n[1],1,-1,-1),zu.vec3.set(n[2],-1,-1,-1),zu.vec3.set(n[3],-1,1,-1),this._vertices.near.forEach((function(e){zu.vec3.transformMat4(e,e,ic)}));var i=this._vertices.far;return zu.vec3.set(i[0],1,1,1),zu.vec3.set(i[1],1,-1,1),zu.vec3.set(i[2],-1,-1,1),zu.vec3.set(i[3],-1,1,1),this._vertices.far.forEach((function(e){zu.vec3.transformMat4(e,e,ic);var n=Math.abs(e[2]);r?e[2]*=Math.min(t/n,1):zu.vec3.scale(e,e,Math.min(t/n,1))})),this._vertices}setWorldFromProjectionMatrix(e,t,r){if(void 0===r)return console.warn("THING.EXTEND.CameraFrustum: .setWorldFromProjectionMatrix() transform is now required"),null;for(var n=this.setFromProjectionMatrix(e,t),i=0;i<n.near.length;i++)n.near[i]=r.selfToWorld(n.near[i]);for(var a=0;a<n.far.length;a++)n.far[a]=r.selfToWorld(n.far[a]);return n}getBoundingSphere(e){ac.set(this._vertices.near[0],[0,0,0]),this._vertices.near.forEach((function(e){ac.expandByPoint(e)})),this._vertices.far.forEach((function(e){ac.expandByPoint(e)}));var t=ac.getBoundingSphere();return e&&t.applyMatrix4(e),t}}var oc=Symbol("private"),lc={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-lc.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*lc.Bounce.In(2*e):.5*lc.Bounce.Out(2*e-1)+.5}}};class uc{static nextId(){return uc._nextId++}constructor(e,t){void 0===t&&(t=cc),this[oc]={};var r=this[oc];r.group=t,r.object=e,r.valuesEnd={},r.isPaused=!1,r.yoyo=!1,r.isPlaying=!1,r.pauseStart=0,r.duration=1e3,r.initialRepeat=0,r.repeat=0,r.delayTime=0,r.startTime=0,r.chainedTweens=[],r.isChainStopped=!1,r.onStartCallbackFired=!1,r.id=uc.nextId(),r.goToEnd=!1,r.easingFunction=lc.Linear.None}getId(){return this[oc].id}isPlaying(){return this[oc].isPlaying}isPaused(){return this[oc].isPaused}to(e,t){var r=this[oc];return void 0!==t&&(r.duration=t),r.valuesEnd=e,this}duration(e){return this[oc].duration=e,this}start(e){var t=this[oc];return t.isPlaying||(t.group&&t.group.add(this),t.repeat=t.initialRepeat,t.isPlaying=!0,t.isPaused=!1,t.onStartCallbackFired=!1,t.isChainStopped=!1,t.startTime=e,t.startTime+=t.delayTime,t.flattenObjects=[],this._parseValues(t.object,t.valuesEnd)),this}_parseValues(e,t){var r=this[oc];for(var n in e){we.isNull(e[n])&&(e[n]=0);var i=e[n],a=t[n];we.isNull(a)||(we.isNumber(i)&&we.isNumber(a)?r.flattenObjects.push({current:e,key:n,start:i,end:a}):we.isObject(i)&&we.isObject(a)||we.isArray(i)&&we.isArray(a)?this._parseValues(i,a):(r.onParseValueCallback(e,t,n),Array.isArray(e[n])&&Array.isArray(t[n])&&this._parseValues(e[n],t[n])))}}stop(){var e=this[oc];return e.isChainStopped||(e.isChainStopped=!0,this.stopChainedTweens()),e.isPlaying?(e.group&&e.group.remove(this),e.isPlaying=!1,e.isPaused=!1,e.onStopCallback&&e.onStopCallback(e.object),this):this}end(){return this[oc].goToEnd=!0,this.update(1/0),this}pause(e){void 0===e&&(e=(new Date).getTime());var t=this[oc];return t.isPaused||!t.isPlaying||(t.isPaused=!0,t.pauseStart=e,t.group&&t.group.remove(this)),this}resume(e){void 0===e&&(e=(new Date).getTime());var t=this[oc];return t.isPaused&&t.isPlaying?(t.isPaused=!1,t.startTime+=e-t.pauseStart,t.pauseStart=0,t.group&&t.group.add(this),this):this}stopChainedTweens(){for(var e=this[oc],t=0,r=e.chainedTweens.length;t<r;t++)e.chainedTweens[t].stop();return this}group(e){return this[oc].group=e,this}delay(e){return this[oc].delayTime=e,this}repeat(e){var t=this[oc];return t.initialRepeat=e,t.repeat=e,this}repeatDelay(e){return this[oc].repeatDelayTime=e,this}yoyo(e){return this[oc].yoyo=e,this}easing(e){return this[oc].easingFunction=e,this}chain(){for(var e=this[oc],t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.chainedTweens=t,this}onStart(e){return this[oc].onStartCallback=e,this}onUpdate(e){return this[oc].onUpdateCallback=e,this}onRepeat(e){return this[oc].onRepeatCallback=e,this}onComplete(e){return this[oc].onCompleteCallback=e,this}onStop(e){return this[oc].onStopCallback=e,this}onParseValue(e){this[oc].onParseValueCallback=e}update(e,t){void 0===t&&(t=!0);var r=this[oc];if(r.isPaused)return!0;var n=r.startTime+r.duration;if(!r.goToEnd&&!r.isPlaying){if(e>n)return!1;t&&this.start(e)}if(r.goToEnd=!1,e<r.startTime)return!0;!1===r.onStartCallbackFired&&(r.onStartCallback&&r.onStartCallback(r.object),r.onStartCallbackFired=!0);var i=(e-r.startTime)/r.duration;i=0===r.duration||i>1?1:i;var a=r.easingFunction(i);return this._updateValues(a),r.onUpdateCallback&&r.onUpdateCallback(r.object,i),1===i&&this._setRepeatValues(e),!0}_updateValues(e){for(var t=this[oc].flattenObjects,r=0,n=t.length;r<n;r++){var i=t[r],a=i.start;i.current[i.key]=a+(i.end-a)*e}}_setRepeatValues(e){var t=this[oc];if(t.repeat>0)return isFinite(t.repeat)&&t.repeat--,t.yoyo&&this._swapEndStartRepeatValues(),void 0!==t.repeatDelayTime?t.startTime=e+t.repeatDelayTime:t.startTime=e+t.delayTime,t.onRepeatCallback&&t.onRepeatCallback(t.object),!0;t.onCompleteCallback&&t.onCompleteCallback(t.object);for(var r=0,n=t.chainedTweens.length;r<n;r++)t.chainedTweens[r].start(t.startTime+t.duration);return t.isPlaying=!1,!1}_swapEndStartRepeatValues(){this[oc].flattenObjects.forEach((e=>{var t=e.end;e.end=e.start,e.start=t}))}}uc._nextId=0;var cc=new class{constructor(){this._tweens=[]}add(e){this._tweens.push(e)}remove(e){var t=this._tweens.findIndex((t=>t.getId()===e.getId()));this._tweens.splice(t,1)}update(e,t){void 0===t&&(t=!0);for(var r=0;r<this._tweens.length;r++){var n=this._tweens[r],i=t;n&&!1===n.update(e,i)&&t&&(this._tweens.splice(r,1),r--)}}removeAll(){this._tweens=[]}},hc=cc.update.bind(cc),dc=cc.add.bind(cc),pc=cc.remove.bind(cc),fc=cc.removeAll.bind(cc),mc={Easing:lc,Tween:uc,update:hc,add:dc,remove:pc,removeAll:fc},gc=Object.freeze({__proto__:null,ArgumentParser:class{constructor(){this._args={},this._options=[]}clear(){this._args={},this._options=[]}parse(e){this.clear();var t=function({booleanKeys:e=[],allowKeyGrouping:t=!1,allowEmbeddedValues:r=!1,args:n=process.argv.slice(2)}={}){return n.reduce(((n,i,a,s)=>{const o=i.length>0&&"-"===i[0];let l=!1;if(n=Object.keys(n).reduce(((e,t)=>{let r=n[t];return void 0===r&&(r=!!o||i,l=!o),Object.assign({},e,{[t]:r})}),{}),o||l||(n=Object.assign({},n,{_args:(n._args||[]).concat(i)})),o){const o=t&&i.length>2&&"-"===i[0]&&"-"!==i[1];let l,u=i.replace(/^-*/g,"").trim().replace(/(-+|\s+)\w/g,(function(e){return e[e.length-1].toUpperCase()}));const c=r&&function(e){const t=e.search(/[0-9]/);return-1===t?null:{key:e.slice(0,t),value:e.slice(t)}}(u);c?(u=c.key,l=c.value):l=!(a!==s.length-1&&!o&&-1===e.indexOf(u))||void 0,(u?o?Array.from(u):[u]:[]).forEach((e=>{n=Object.assign({},n,{[e]:l})}))}return n}),{})}({args:e.split(" ")});for(var r in t)if("_args"!=r)if(-1!==r.indexOf("=")){var n=r.split("=");n[1]?this._args[n[0]]=n[1]:this._args[n[0]]=!0}else this._args[r]=!0;return this._options=t._args||this._options,this}get args(){return this._args}get options(){return this._options}},ArrayProxy:class{constructor(e,t){void 0===e&&(e=[]),void 0===t&&(t=null),this._array=e.slice(0),this._onUpdateValue=t;var r={get:(e,t)=>e[t],set:(e,t,r,n)=>(e[t]=r,this._onUpdateValue&&this._onUpdateValue({data:r}),!0)},n=new Proxy(this._array,r);return Object.defineProperty(n,"customFormatters",{enumerable:!1,configurable:!1,get:()=>["object",{object:this._array.slice(0)}]}),n}copy(e){this._array=e.slice(0),this._onUpdateValue&&this._onUpdateValue()}},AstParser:class{constructor(){}static parse(e){try{return Fr.parse(e)}catch(e){return console.error(e),{}}}static visit(e,t){void 0===t&&(t={}),Fr.visit(e,t)}static print(e){return Fr.print(e).code}},BaseUtils:ae,BoundingSphere:ju,Box3:Gu,BufferAllocator:tr,Callbacks:Gt,CameraFrustum:sc,CancelablePromise:E,CircularQueue:Lt,CommandExecutor:Sr,DynamicCachedObject:kt,EventDispatcher:Ut,Expression:Ft,FilteredArray:jt,Flags:Wt,Frustum:class{constructor(e,t,r,n,i,a){this.planes=[void 0!==e?e:new tc,void 0!==t?t:new tc,void 0!==r?r:new tc,void 0!==n?n:new tc,void 0!==i?i:new tc,void 0!==a?a:new tc],this.projectionMatrix=zu.createMat4(),this.matrixWorld=zu.createMat4(),this.axis=[],this.boxNormals=[],this.frustumEdges=[],this.vectorResult=[];for(var s=0;s<48;s++)this.vectorResult[s]=[]}set(e,t,r,n,i,a){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(n),s[4].copy(i),s[5].copy(a),this}setProjectionMatrix(e,t,r,n){void 0===e&&(e=50),void 0===t&&(t=1),void 0===r&&(r=.1),void 0===n&&(n=2e3),this.fov=e,this.aspect=t,this.near=r,this.far=n,zu.mat4.perspective(this.projectionMatrix,e/180*Math.PI,t,r,n)}setMatrixWorld(e,t,r){zu.mat4.fromRotationTranslationScale(this.matrixWorld,t,e,r)}updateProjectionMatrix(){zu.mat4.perspective(this.projectionMatrix,this.fov/180*Math.PI,this.aspect,this.near,this.far)}clone(){return(new this.constructor).copy(this)}copy(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){var t=this.planes,r=e,n=r[0],i=r[1],a=r[2],s=r[3],o=r[4],l=r[5],u=r[6],c=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],g=r[13],_=r[14],v=r[15];return t[0].setComponents(s-n,c-o,f-h,v-m).normalize(),t[1].setComponents(s+n,c+o,f+h,v+m).normalize(),t[2].setComponents(s+i,c+l,f+d,v+g).normalize(),t[3].setComponents(s-i,c-l,f-d,v-g).normalize(),t[4].setComponents(s-a,c-u,f-p,v-_).normalize(),t[5].setComponents(s+a,c+u,f+p,v+_).normalize(),this}setFrustumVertical(e){this.frustumVertices=e}intersectsObject(e){var t=e.getAABB().getBoundingSphere();return this.intersectsSphere(t)}intersectsSphere(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(r)<n)return!1}return!0}intersectsBox(e){return this.frustumVertices?(this.box=e,this.getAllAxis(),this.pointsProjection()):(console.warn("THING.EXTEND.Frustum: .intersectsBox() vertices is now required"),!1)}getAllAxis(){this.getPlanesNormal(),this.getBoxesNormal(),this.getEdgesCross()}getPlanesNormal(){for(var e=0;e<this.planes.length-1;e++){var t=this.planes[e].normal;zu.isZeroVector(t)||this.containAxis(t)||(this.axis[e]=t)}}getBoxesNormal(){this.boxVertices=this.box.getPoints(),this.boxNormals[0]=zu.normalizeVector(zu.subVector(this.boxVertices[0],this.boxVertices[1],this.vectorResult[0]),this.vectorResult[1]),this.boxNormals[1]=zu.normalizeVector(zu.subVector(this.boxVertices[0],this.boxVertices[3],this.vectorResult[2]),this.vectorResult[3]),this.boxNormals[2]=zu.normalizeVector(zu.subVector(this.boxVertices[0],this.boxVertices[4],this.vectorResult[4]),this.vectorResult[5]);for(var e=0;e<this.boxNormals.length;e++)zu.isZeroVector(this.boxNormals[e])||this.containAxis(this.boxNormals[e])||(this.axis[this.axis.length]=this.boxNormals[e])}getEdgesCross(){var e=this.frustumVertices;this.frustumEdges[0]=zu.subVector(e.near[0],e.near[1],this.vectorResult[6]),this.frustumEdges[1]=zu.subVector(e.near[0],e.near[3],this.vectorResult[7]),this.frustumEdges[2]=zu.subVector(e.near[0],e.far[0],this.vectorResult[8]),this.frustumEdges[3]=zu.subVector(e.near[1],e.far[1],this.vectorResult[9]),this.frustumEdges[4]=zu.subVector(e.near[2],e.far[2],this.vectorResult[10]),this.frustumEdges[5]=zu.subVector(e.near[3],e.far[3],this.vectorResult[11]);for(var t=0,r=0;r<this.frustumEdges.length;r++)for(var n=0;n<this.boxNormals.length;n++){var i=zu.normalizeVector(zu.crossVector(this.frustumEdges[r],this.boxNormals[n],this.vectorResult[12+t]),this.vectorResult[13+t]);zu.isZeroVector(i)||this.containAxis(i)||(this.axis[this.axis.length]=i),t+=2}}containAxis(e){for(var t=0;t<this.axis.length;t++)if(zu.isParallelVector(this.axis[t],e))return!0;return!1}pointsProjection(){for(var e=0;e<this.axis.length;e++){for(var t=0,r=0,n=0;n<this.frustumVertices.near.length;n++){var i=zu.dotVector(this.frustumVertices.near[n],this.axis[e]);0===n?t=r=i:(t=zu.max(t,i),r=zu.min(r,i))}for(var a=0;a<this.frustumVertices.far.length;a++){var s=zu.dotVector(this.frustumVertices.far[a],this.axis[e]);t=zu.max(t,s),r=zu.min(r,s)}for(var o=0,l=0,u=0;u<this.boxVertices.length;u++){var c=zu.dotVector(this.boxVertices[u],this.axis[e]);0===u?o=l=c:(o=zu.max(o,c),l=zu.min(l,c))}if(o<r||t<l)return!1}return!0}intersectsBoxV1(e){for(var t=this.planes,r=0;r<6;r++){var n=t[r];if(rc[0]=n.normal[0]>0?e.max[0]:e.min[0],rc[1]=n.normal[1]>0?e.max[1]:e.min[1],rc[2]=n.normal[2]>0?e.max[2]:e.min[2],n.distanceToPoint(rc)<0)return!1}return!0}intersectsBoxV2(e){for(var t=this.planes,{min:r,max:n}=e,i=0;i<6;i++){var a=t[i],s=a.normal,o=a.constant,l=s[0]*r[0]+s[1]*r[1]+s[2]*r[2]+o,u=s[0]*n[0]+s[1]*n[1]+s[2]*n[2]+o;if(l>u){var c=l;l=u,u=c}if(u<-1||l>1)return!1}return!0}containsPoint(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}getRayFromCamera(e){var t=[e[0],e[1],.5],r=[],n=[],i=[];return function(e){return-1==e[11]}(this.projectionMatrix)&&(zu.mat4.getTranslation(n,this.matrixWorld),zu.mat4.invert(r,this.projectionMatrix),zu.vec3.transformMat4(t,t,r),zu.vec3.transformMat4(t,t,this.matrixWorld),i=zu.normalizeVector(zu.subVector(t,n))),{origin:n,direction:i}}static intersectObjects(e,t,r){var n=r||[];if(!t.length)return console.warn("THING.MathUitls.intersectObjects: objects is not an Array."),n;for(var i=0,a=t.length;i<a;i++){t[i].traverse((t=>{if(!(t.destroyed||t.isViewProbe||t.isViewProbeInnerPlane||t.isViewProbeOutline)){var r=t.raycast(e,!1);r.length>0&&n.push(...r)}}))}return n.sort(nc),n}},IdAllocator:class{constructor(e){this[Ht]={},this[Ht].values=[4294967295]}allocate(){var e=this[Ht].values,t=e[e.length-1];t||(t=4294967295,valuePools.push(t));for(var r=0;r<32;r++){var n=1<<r;if(t&n){var i=e.length-1;return e[i]&=~n,i<<8|n}}return-1}free(e){var t=e>>8,r=255&e;this[Ht].values[t]|=r}},IndexAllocator:Xt,Layers:class{constructor(){this._values=new Set}isEmpty(){return!this._values.size}clear(){this._values.clear()}add(e){return this._values.add(e),this}remove(e){return this._values.remove(e),this}set(e){return this._values.clear(),e.isLayers?this.union(e.values):Utils.isArray(e)?e.forEach((e=>{this._values.add(e)})):this._values.add(e),this}union(e){return this._values=new Set([...this._values,...e.values]),this}intersect(e){return this._values=new Set([...this._values].filter((t=>e.values.has(t)))),this}diff(e){return this._values=new Set([...this._values].filter((t=>!e.values.has(t)))),this}get values(){return Array(this._values)}get isLayers(){return!0}},LayoutType:f,LogLevelType:p,MathUtils:zu,OBB:Yu,ObjectAttributes:gr,ObjectPool:class extends Xt{constructor(e){super(e),this[sr]={};var t=this[sr],r=e.maxCount;if(r){var n=e.classType;if(n){t.classType=n,t.objects=[];for(var i=0;i<r;i++)t.objects[i]=null}else Utils.error("Initialize object pool failed, due to 'classType' is null")}else Utils.error("Initialize object pool failed, due to maxCount: '"+r+"' is invalid")}allocate(e,t){var r=super.allocate();if(-1===r)return null;var n=this[sr],i=n.objects;return t&&(t.index=r),i[r]=i[r]||new n.classType(e),i[r]}},ObjectProxy:ur,Plane:tc,RandomGenerator:ko,RefCountObject:vr,ResolvableCachedObject:It,ResolvablePromise:Rt,StateGroup:br,StringEncoder:Le,Switcher:class{constructor(){Object.defineProperty(this,Tr,{value:Pr}),Object.defineProperty(this,Cr,{value:Mr}),Object.defineProperty(this,wr,{value:Dr}),this[Er.private]={};var e=this[Er.private];e.lockQueue=[],e.enable=!0,e.onChange=null}isEnable(){return this[Er.private].enable}enable(e){this.isLock()||this[Er.private].enable(e)}isLock(e){return!!Qt(this,Tr)[Tr](e)}getLockState(e){var t=Qt(this,Tr)[Tr](e);return!!t&&t.enable}lock(e,t){if(!this.isLock(t)){var r=this[Er.private];r.lockQueue.push({prevEnableState:r.enable,enable:e,name:t}),Qt(this,Cr)[Cr](e)}}unlock(e){var t=this[Er.private],r=Qt(this,Tr)[Tr](e);if(r){var n=r.prevEnableState;t.lockQueue.splice(r.index,1);for(var i=r.index;i<t.lockQueue.length;i++)t.lockQueue[i].prevEnableState=n;t.lockQueue.length&&(n=t.lockQueue[t.lockQueue.length-1].enable),Qt(this,Cr)[Cr](n)}}},TWEEN:mc,Timer:Io,TypeChecker:Lo,TypedObject:ar,Utils:we,Version:jo,external:d});class _c{constructor(e,t,r,n,i=!0){this.target=e,this.propertyPath=t,this.name=this.target.uuid+"."+t,this.times=r,this.values=n,this.valueSize=n.length/r.length,this.interpolant=i}getValue(e,t){const r=this.times,n=r.length;if(e<=r[0])return this._copyValue(0,t);if(e>=r[n-1])return this._copyValue(n-1,t);let i=n-1;for(;e<r[i]&&i>0;)i--;const a=(e-r[i])/(r[i+1]-r[i]);return this._interpolate(i,a,t)}_interpolate(e,t,r){const n=this.values,i=this.valueSize;let a,s;for(let o=0;o<i;o++)a=n[e*i+o],s=n[(e+1)*i+o],this.interpolant?r[o]=void 0!==a&&void 0!==s?a*(1-t)+s*t:a:r[o]=a;return r}_copyValue(e,t){const r=this.values,n=this.valueSize,i=n*e;for(let e=0;e<n;e++)t[e]=r[i+e];return t}}class vc extends _c{constructor(e,t,r,n,i){super(e,t,r,n,i)}_interpolate(e,t,r){return r[0]=this.values[e],r}}vc.prototype.valueTypeName="bool";class yc extends _c{constructor(e,t,r,n,i){super(e,t,r,n,i)}}yc.prototype.valueTypeName="color";class xc extends _c{constructor(e,t,r,n,i){super(e,t,r,n,i)}}xc.prototype.valueTypeName="number";let bc=class e{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}lerpVectors(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}set(e=0,t=0,r=0){return this.x=e,this.y=t,this.z=r,this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}getLength(){return Math.sqrt(this.getLengthSquared())}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(e=1){const t=e/(this.getLength()||1);return this.x*=t,this.y*=t,this.z*=t,this}subtract(t,r=new e){return r.set(this.x-t.x,this.y-t.y,this.z-t.z)}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}crossVectors(e,t){const r=e.x,n=e.y,i=e.z,a=t.x,s=t.y,o=t.z;return this.x=n*o-i*s,this.y=i*a-r*o,this.z=r*s-n*a,this}cross(e){return this.crossVectors(this,e)}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}applyQuaternion(e){const t=this.x,r=this.y,n=this.z,i=e._x,a=e._y,s=e._z,o=e._w,l=o*t+a*n-s*r,u=o*r+s*t-i*n,c=o*n+i*r-a*t,h=-i*t-a*r-s*n;return this.x=l*o+h*-i+u*-s-c*-a,this.y=u*o+h*-a+c*-i-l*-s,this.z=c*o+h*-s+l*-a-u*-i,this}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,i=e.elements,a=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*a,this}applyMatrix3(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}transformDirection(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}setFromMatrixPosition(e){return this.setFromMatrixColumn(e,3)}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}setFromSpherical(e){const t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this}project(e){return this.applyMatrix4(e.projectionViewMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.worldMatrix)}reflect(e){return this.sub(Ac.copy(e).multiplyScalar(2*this.dot(e)))}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}clone(){return new e(this.x,this.y,this.z)}};const Ac=new bc;class Sc{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}isIdentity(){const e=this.elements;return 1===e[0]&&0===e[4]&&0===e[8]&&0===e[12]&&0===e[1]&&1===e[5]&&0===e[9]&&0===e[13]&&0===e[2]&&0===e[6]&&1===e[10]&&0===e[14]&&0===e[3]&&0===e[7]&&0===e[11]&&1===e[15]}set(e,t,r,n,i,a,s,o,l,u,c,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=n,g[1]=i,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}clone(){return(new Sc).fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1)}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,n=t.elements,i=this.elements,a=r[0],s=r[4],o=r[8],l=r[12],u=r[1],c=r[5],h=r[9],d=r[13],p=r[2],f=r[6],m=r[10],g=r[14],_=r[3],v=r[7],y=r[11],x=r[15],b=n[0],A=n[4],S=n[8],E=n[12],w=n[1],C=n[5],T=n[9],D=n[13],M=n[2],P=n[6],F=n[10],R=n[14],N=n[3],B=n[7],I=n[11],O=n[15];return i[0]=a*b+s*w+o*M+l*N,i[4]=a*A+s*C+o*P+l*B,i[8]=a*S+s*T+o*F+l*I,i[12]=a*E+s*D+o*R+l*O,i[1]=u*b+c*w+h*M+d*N,i[5]=u*A+c*C+h*P+d*B,i[9]=u*S+c*T+h*F+d*I,i[13]=u*E+c*D+h*R+d*O,i[2]=p*b+f*w+m*M+g*N,i[6]=p*A+f*C+m*P+g*B,i[10]=p*S+f*T+m*F+g*I,i[14]=p*E+f*D+m*R+g*O,i[3]=_*b+v*w+y*M+x*N,i[7]=_*A+v*C+y*P+x*B,i[11]=_*S+v*T+y*F+x*I,i[15]=_*E+v*D+y*R+x*O,this}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}inverse(){return this.getInverse(this)}getInverse(e){const t=this.elements,r=e.elements,n=r[0],i=r[1],a=r[2],s=r[3],o=r[4],l=r[5],u=r[6],c=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],g=r[13],_=r[14],v=r[15],y=d*_*c-g*p*c+g*u*f-l*_*f-d*u*v+l*p*v,x=m*p*c-h*_*c-m*u*f+o*_*f+h*u*v-o*p*v,b=h*g*c-m*d*c+m*l*f-o*g*f-h*l*v+o*d*v,A=m*d*u-h*g*u-m*l*p+o*g*p+h*l*_-o*d*_,S=n*y+i*x+a*b+s*A;if(0===S)return console.warn("Matrix4: can not invert matrix, determinant is 0"),this.identity();const E=1/S;return t[0]=y*E,t[1]=(g*p*s-d*_*s-g*a*f+i*_*f+d*a*v-i*p*v)*E,t[2]=(l*_*s-g*u*s+g*a*c-i*_*c-l*a*v+i*u*v)*E,t[3]=(d*u*s-l*p*s-d*a*c+i*p*c+l*a*f-i*u*f)*E,t[4]=x*E,t[5]=(h*_*s-m*p*s+m*a*f-n*_*f-h*a*v+n*p*v)*E,t[6]=(m*u*s-o*_*s-m*a*c+n*_*c+o*a*v-n*u*v)*E,t[7]=(o*p*s-h*u*s+h*a*c-n*p*c-o*a*f+n*u*f)*E,t[8]=b*E,t[9]=(m*d*s-h*g*s-m*i*f+n*g*f+h*i*v-n*d*v)*E,t[10]=(o*g*s-m*l*s+m*i*c-n*g*c-o*i*v+n*l*v)*E,t[11]=(h*l*s-o*d*s-h*i*c+n*d*c+o*i*f-n*l*f)*E,t[12]=A*E,t[13]=(h*g*a-m*d*a+m*i*p-n*g*p-h*i*_+n*d*_)*E,t[14]=(m*l*a-o*g*a-m*i*u+n*g*u+o*i*_-n*l*_)*E,t[15]=(o*d*a-h*l*a+h*i*u-n*d*u-o*i*p+n*l*p)*E,this}transform(e,t,r){const n=this.elements,i=r._x,a=r._y,s=r._z,o=r._w,l=i+i,u=a+a,c=s+s,h=i*l,d=i*u,p=i*c,f=a*u,m=a*c,g=s*c,_=o*l,v=o*u,y=o*c,x=t.x,b=t.y,A=t.z;return n[0]=(1-(f+g))*x,n[1]=(d+y)*x,n[2]=(p-v)*x,n[3]=0,n[4]=(d-y)*b,n[5]=(1-(h+g))*b,n[6]=(m+_)*b,n[7]=0,n[8]=(p+v)*A,n[9]=(m-_)*A,n[10]=(1-(h+f))*A,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}makeRotationFromQuaternion(e){const t=this.elements,r=e.x,n=e.y,i=e.z,a=e.w,s=r+r,o=n+n,l=i+i,u=r*s,c=r*o,h=r*l,d=n*o,p=n*l,f=i*l,m=a*s,g=a*o,_=a*l;return t[0]=1-(d+f),t[4]=c-_,t[8]=h+g,t[1]=c+_,t[5]=1-(u+f),t[9]=p-m,t[2]=h-g,t[6]=p+m,t[10]=1-(u+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}extractRotation(e){const t=this.elements,r=e.elements,n=1/Ec.setFromMatrixColumn(e,0).getLength(),i=1/Ec.setFromMatrixColumn(e,1).getLength(),a=1/Ec.setFromMatrixColumn(e,2).getLength();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}lookAtRH(e,t,r){const n=this.elements;return Dc.subVectors(e,t),0===Dc.getLengthSquared()&&(Dc.z=1),Dc.normalize(),Cc.crossVectors(r,Dc),0===Cc.getLengthSquared()&&(1===Math.abs(r.z)?Dc.x+=1e-4:Dc.z+=1e-4,Dc.normalize(),Cc.crossVectors(r,Dc)),Cc.normalize(),Tc.crossVectors(Dc,Cc),n[0]=Cc.x,n[4]=Tc.x,n[8]=Dc.x,n[1]=Cc.y,n[5]=Tc.y,n[9]=Dc.y,n[2]=Cc.z,n[6]=Tc.z,n[10]=Dc.z,this}decompose(e,t,r){const n=this.elements;let i=Ec.set(n[0],n[1],n[2]).getLength();const a=Ec.set(n[4],n[5],n[6]).getLength(),s=Ec.set(n[8],n[9],n[10]).getLength();this.determinant()<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],wc.copy(this);const o=1/i,l=1/a,u=1/s;return wc.elements[0]*=o,wc.elements[1]*=o,wc.elements[2]*=o,wc.elements[4]*=l,wc.elements[5]*=l,wc.elements[6]*=l,wc.elements[8]*=u,wc.elements[9]*=u,wc.elements[10]*=u,t.setFromRotationMatrix(wc),r.x=i,r.y=a,r.z=s,this}determinant(){const e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],a=e[1],s=e[5],o=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+i*o*c-n*l*c-i*s*h+r*l*h+n*s*d-r*o*d)+e[7]*(+t*o*d-t*l*h+i*a*h-n*a*d+n*l*u-i*o*u)+e[11]*(+t*l*c-t*s*d-i*a*c+r*a*d+i*s*u-r*l*u)+e[15]*(-n*s*u-t*o*c+t*s*h+n*a*c-r*a*h+r*o*u)}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))}makeRotationAxis(e,t){const r=Math.cos(t),n=Math.sin(t),i=1-r,a=e.x,s=e.y,o=e.z,l=i*a,u=i*s;return this.set(l*a+r,l*s-n*o,l*o+n*s,0,l*s+n*o,u*s+r,u*o-n*a,0,l*o-n*s,u*o+n*a,i*o*o+r,0,0,0,0,1)}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Ec=new bc,wc=new Sc,Cc=new bc,Tc=new bc,Dc=new bc;class Mc{constructor(e=0,t=0,r=0,n=1){this._x=e,this._y=t,this._z=r,this._w=n}static slerpFlat(e,t,r,n,i,a,s){let o=r[n+0],l=r[n+1],u=r[n+2],c=r[n+3];const h=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];if(0===s)return e[t]=o,e[t+1]=l,e[t+2]=u,void(e[t+3]=c);if(1===s)return e[t]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(c!==f||o!==h||l!==d||u!==p){let e=1-s;const t=o*h+l*d+u*p+c*f,r=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const i=Math.sqrt(n),a=Math.atan2(i,t*r);e=Math.sin(e*a)/i,s=Math.sin(s*a)/i}const i=s*r;if(o=o*e+h*i,l=l*e+d*i,u=u*e+p*i,c=c*e+f*i,e===1-s){const e=1/Math.sqrt(o*o+l*l+u*u+c*c);o*=e,l*=e,u*=e,c*=e}}e[t]=o,e[t+1]=l,e[t+2]=u,e[t+3]=c}static multiplyQuaternionsFlat(e,t,r,n,i,a){const s=r[n],o=r[n+1],l=r[n+2],u=r[n+3],c=i[a],h=i[a+1],d=i[a+2],p=i[a+3];return e[t]=s*p+u*c+o*d-l*h,e[t+1]=o*p+u*h+l*c-s*d,e[t+2]=l*p+u*d+s*h-o*c,e[t+3]=u*p-s*c-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this.onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this.onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this.onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this.onChangeCallback()}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lerpQuaternions(e,t,r){if(0===r)return this.copy(e);if(1===r)return this.copy(t);const n=e._w,i=e._x,a=e._y,s=e._z;let o=t._w,l=t._x,u=t._y,c=t._z;n*o+i*l+a*u+s*c<0&&(o=-o,l=-l,u=-u,c=-c),this._w=n+r*(o-n),this._x=i+r*(l-i),this._y=a+r*(u-a),this._z=s+r*(c-s);const h=1/Math.sqrt(this._w*this._w+this._x*this._x+this._y*this._y+this._z*this._z);return this._w*=h,this._x*=h,this._y*=h,this._z*=h,this.onChangeCallback(),this}slerpQuaternions(e,t,r){if(0===r)return this.copy(e);if(1===r)return this.copy(t);const n=e._w,i=e._x,a=e._y,s=e._z;let o=t._w,l=t._x,u=t._y,c=t._z,h=n*o+i*l+a*u+s*c;if(h<0&&(h=-h,o=-o,l=-l,u=-u,c=-c),h<.95){const e=Math.acos(h),t=1/Math.sin(e),d=Math.sin(e*(1-r))*t,p=Math.sin(e*r)*t;this._w=n*d+o*p,this._x=i*d+l*p,this._y=a*d+u*p,this._z=s*d+c*p}else{this._w=n+r*(o-n),this._x=i+r*(l-i),this._y=a+r*(u-a),this._z=s+r*(c-s);const e=1/Math.sqrt(this._w*this._w+this._x*this._x+this._y*this._y+this._z*this._z);this._w*=e,this._x*=e,this._y*=e,this._z*=e}return this.onChangeCallback(),this}set(e=0,t=0,r=0,n=1){return this._x=e,this._y=t,this._z=r,this._w=n,this.onChangeCallback(),this}clone(){return new Mc(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=void 0!==e.w?e.w:1,this.onChangeCallback(),this}setFromEuler(e,t=!0){const r=Math.cos(e._x/2),n=Math.cos(e._y/2),i=Math.cos(e._z/2),a=Math.sin(e._x/2),s=Math.sin(e._y/2),o=Math.sin(e._z/2),l=e._order;return"XYZ"===l?(this._x=a*n*i+r*s*o,this._y=r*s*i-a*n*o,this._z=r*n*o+a*s*i,this._w=r*n*i-a*s*o):"YXZ"===l?(this._x=a*n*i+r*s*o,this._y=r*s*i-a*n*o,this._z=r*n*o-a*s*i,this._w=r*n*i+a*s*o):"ZXY"===l?(this._x=a*n*i-r*s*o,this._y=r*s*i+a*n*o,this._z=r*n*o+a*s*i,this._w=r*n*i-a*s*o):"ZYX"===l?(this._x=a*n*i-r*s*o,this._y=r*s*i+a*n*o,this._z=r*n*o-a*s*i,this._w=r*n*i+a*s*o):"YZX"===l?(this._x=a*n*i+r*s*o,this._y=r*s*i+a*n*o,this._z=r*n*o-a*s*i,this._w=r*n*i-a*s*o):"XZY"===l&&(this._x=a*n*i-r*s*o,this._y=r*s*i-a*n*o,this._z=r*n*o+a*s*i,this._w=r*n*i+a*s*o),!0===t&&this.onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],n=t[4],i=t[8],a=t[1],s=t[5],o=t[9],l=t[2],u=t[6],c=t[10],h=r+s+c;let d;return h>0?(d=.5/Math.sqrt(h+1),this._w=.25/d,this._x=(u-o)*d,this._y=(i-l)*d,this._z=(a-n)*d):r>s&&r>c?(d=2*Math.sqrt(1+r-s-c),this._w=(u-o)/d,this._x=.25*d,this._y=(n+a)/d,this._z=(i+l)/d):s>c?(d=2*Math.sqrt(1+s-r-c),this._w=(i-l)/d,this._x=(n+a)/d,this._y=.25*d,this._z=(o+u)/d):(d=2*Math.sqrt(1+c-r-s),this._w=(a-n)/d,this._x=(i+l)/d,this._y=(o+u)/d,this._z=.25*d),this.onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,n=e._y,i=e._z,a=e._w,s=t._x,o=t._y,l=t._z,u=t._w;return this._x=r*u+a*s+n*l-i*o,this._y=n*u+a*o+i*s-r*l,this._z=i*u+a*l+r*o-n*s,this._w=a*u-r*s-n*o-i*l,this.onChangeCallback(),this}toMatrix4(e=new Sc){const t=e.elements,r=2*this._x*this._y,n=2*this._x*this._z,i=2*this._x*this._w,a=2*this._y*this._z,s=2*this._y*this._w,o=2*this._z*this._w,l=this._x*this._x,u=this._y*this._y,c=this._z*this._z,h=this._w*this._w;return t[0]=l-u-c+h,t[4]=r-o,t[8]=n+s,t[12]=0,t[1]=r+o,t[5]=-l+u-c+h,t[9]=a-i,t[13]=0,t[2]=n-s,t[6]=a+i,t[10]=-l-u+c+h,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,e}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}setFromAxisAngle(e,t){const r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this.onChangeCallback(),this}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}onChange(e){return this.onChangeCallback=e,this}onChangeCallback(){}}class Pc extends _c{constructor(e,t,r,n,i){super(e,t,r,n,i)}_interpolate(e,t,r){const n=this.values;return this.interpolant?Mc.slerpFlat(r,0,n,4*e,n,4*(e+1),t):this._copyValue(e,r),r}}Pc.prototype.valueTypeName="quaternion";class Fc extends _c{constructor(e,t,r,n,i){super(e,t,r,n,i)}_interpolate(e,t,r){return r[0]=this.values[e],r}}Fc.prototype.valueTypeName="string";class Rc extends _c{constructor(e,t,r,n,i){super(e,t,r,n,i)}}Rc.prototype.valueTypeName="vector";const Nc={BASIC:"basic",LAMBERT:"lambert",PHONG:"phong",PBR:"pbr",PBR2:"pbr2",MATCAP:"matcap",POINT:"point",LINE:"line",SHADER:"shader",DEPTH:"depth",DISTANCE:"distance"},Bc={NONE:"none",NORMAL:"normal",ADD:"add",SUB:"sub",MUL:"mul",CUSTOM:"custom"},Ic={ADD:100,SUBTRACT:101,REVERSE_SUBTRACT:102},Oc={ZERO:200,ONE:201,SRC_COLOR:202,SRC_ALPHA:203,SRC_ALPHA_SATURATE:204,DST_COLOR:205,DST_ALPHA:206,ONE_MINUS_SRC_COLOR:207,ONE_MINUS_SRC_ALPHA:208,ONE_MINUS_DST_COLOR:209,ONE_MINUS_DST_ALPHA:210},kc={NONE:"none",FRONT:"front",BACK:"back",FRONT_AND_BACK:"front_and_back"},Lc={FRONT:"front",BACK:"back",DOUBLE:"double"},Uc={SMOOTH_SHADING:"smooth_shading",FLAT_SHADING:"flat_shading"},zc={DEPTH_COMPONENT:1e3,DEPTH_STENCIL:1001,STENCIL_INDEX8:1002,ALPHA:1003,RED:1004,RGB:1005,RGBA:1006,LUMINANCE:1007,LUMINANCE_ALPHA:1008,RED_INTEGER:1010,RG:1011,RG_INTEGER:1012,RGB_INTEGER:1013,RGBA_INTEGER:1014,R32F:1100,R16F:1101,R8:1102,RG32F:1103,RG16F:1104,RG8:1105,RGB32F:1106,RGB16F:1107,RGB8:1108,RGBA32F:1109,RGBA16F:1110,RGBA8:1111,RGBA4:1112,RGB5_A1:1113,DEPTH_COMPONENT32F:1114,DEPTH_COMPONENT24:1115,DEPTH_COMPONENT16:1116,DEPTH24_STENCIL8:1117,DEPTH32F_STENCIL8:1118,RGB_S3TC_DXT1:1200,RGBA_S3TC_DXT1:1201,RGBA_S3TC_DXT3:1202,RGBA_S3TC_DXT5:1203,RGB_PVRTC_4BPPV1:1204,RGB_PVRTC_2BPPV1:1205,RGBA_PVRTC_4BPPV1:1206,RGBA_PVRTC_2BPPV1:1207,RGB_ETC1:1208,RGBA_ASTC_4x4:1209,RGBA_BPTC:1210},jc={UNSIGNED_BYTE:1500,UNSIGNED_SHORT_5_6_5:1501,UNSIGNED_SHORT_4_4_4_4:1502,UNSIGNED_SHORT_5_5_5_1:1503,UNSIGNED_SHORT:1504,UNSIGNED_INT:1505,UNSIGNED_INT_24_8:1506,FLOAT:1507,HALF_FLOAT:1508,FLOAT_32_UNSIGNED_INT_24_8_REV:1509,BYTE:1510,SHORT:1511,INT:1512},Vc={NEAREST:1600,LINEAR:1601,NEAREST_MIPMAP_NEAREST:1602,LINEAR_MIPMAP_NEAREST:1603,NEAREST_MIPMAP_LINEAR:1604,LINEAR_MIPMAP_LINEAR:1605},Gc={REPEAT:1700,CLAMP_TO_EDGE:1701,MIRRORED_REPEAT:1702},Wc={LEQUAL:515,GEQUAL:518,LESS:513,GREATER:516,EQUAL:514,NOTEQUAL:517,ALWAYS:519,NEVER:512},Hc={KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056},qc={HARD:"hard",POISSON_SOFT:"poisson_soft",PCF3_SOFT:"pcf3_soft",PCF5_SOFT:"pcf5_soft",PCSS16_SOFT:"pcss16_soft",PCSS32_SOFT:"pcss32_soft",PCSS64_SOFT:"pcss64_soft"},Xc={LINEAR:"linear",SRGB:"sRGB",RGBE:"RGBE",RGBM7:"RGBM7",RGBM16:"RGBM16",RGBD:"RGBD",GAMMA:"Gamma"},Qc={MULTIPLY:"ENVMAP_BLENDING_MULTIPLY",MIX:"ENVMAP_BLENDING_MIX",ADD:"ENVMAP_BLENDING_ADD"},Kc={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Yc={NONE:0,RGB:1,RGBA:2},Zc={COLOR_ATTACHMENT0:2e3,COLOR_ATTACHMENT1:2001,COLOR_ATTACHMENT2:2002,COLOR_ATTACHMENT3:2003,COLOR_ATTACHMENT4:2004,COLOR_ATTACHMENT5:2005,COLOR_ATTACHMENT6:2006,COLOR_ATTACHMENT7:2007,COLOR_ATTACHMENT8:2008,COLOR_ATTACHMENT9:2009,COLOR_ATTACHMENT10:2010,COLOR_ATTACHMENT11:2011,COLOR_ATTACHMENT12:2012,COLOR_ATTACHMENT13:2013,COLOR_ATTACHMENT14:2014,COLOR_ATTACHMENT15:2015,DEPTH_ATTACHMENT:2020,STENCIL_ATTACHMENT:2021,DEPTH_STENCIL_ATTACHMENT:2030},Jc={STREAM_DRAW:35040,STREAM_READ:35041,STREAM_COPY:35042,STATIC_DRAW:35044,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_DRAW:35048,DYNAMIC_READ:35049,DYNAMIC_COPY:35050},$c={ANY_SAMPLES_PASSED:7e3,ANY_SAMPLES_PASSED_CONSERVATIVE:7001,TIME_ELAPSED:7002};class eh{addEventListener(e,t,r){void 0===this._eventMap&&(this._eventMap={});const n=this._eventMap;void 0===n[e]&&(n[e]=[]),n[e].push({listener:t,thisObject:r||this})}removeEventListener(e,t,r){if(void 0===this._eventMap)return;const n=this._eventMap[e];if(void 0!==n)for(let e=0,i=n.length;e<i;e++){const i=n[e];if(i.listener===t&&i.thisObject===(r||this)){n.splice(e,1);break}}}dispatchEvent(e){if(void 0===this._eventMap)return;const t=this._eventMap[e.type];if(void 0!==t){e.target=this;const r=t.slice(0);for(let t=0,n=r.length;t<n;t++){const n=r[t];n.listener.call(n.thisObject,e)}e.target=null}}}class th extends eh{constructor(e){super(),this.clip=e,this.weight=0,this.time=0,this.blendMode=Bc.NORMAL}update(e){this.time+=e;const t=this.clip.duration;this.time>t&&(this.time=this.time%t),this.time<0&&(this.time=this.time%t+t)}}class rh{constructor(e,t,r,n){this.target=null,this.property="",this.parseBinding(e,t),this.valueSize=n;let i,a,s,o=Float64Array;switch(r){case"quaternion":i=ih,a=sh,s=ch;break;case"string":case"bool":o=Array,i=nh,a=nh,s=hh;break;default:i=oh,a=lh,s=uh}this.buffer=new o(4*n),this._mixBufferFunction=i,this._mixBufferFunctionAdditive=a,this._setIdentity=s,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}parseBinding(e,t){if((t=t.split(".")).length>1){let r=e[t[0]];for(let e=1;e<t.length-1;e++)r=r[t[e]];this.property=t[t.length-1],this.target=r}else this.property=t[0],this.target=e}saveOriginalState(){const e=this.buffer,t=this.valueSize,r=2*t;this.valueSize>1?this.target[this.property].toArray?this.target[this.property].toArray(e,r):function(e,t,r,n){for(let i=0;i<n;i++)e[r+i]=t[i]}(e,this.target[this.property],r,this.valueSize):this.target[this.property]=e[r];for(let n=t,i=r;n!==i;++n)e[n]=e[r+n%t];this._setIdentity(e,3*t,t,r),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.buffer,t=this.valueSize,r=2*t;for(let n=t,i=r;n!==i;++n)e[n]=e[r+n%t];this.apply()}accumulate(e){const t=this.buffer,r=this.valueSize,n=r;let i=this.cumulativeWeight;if(0===i){for(let e=0;e!==r;++e)t[n+e]=t[e];i=e}else{i+=e;const a=e/i;this._mixBufferFunction(t,n,0,a,r)}this.cumulativeWeight=i}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,n=3*r;0===this.cumulativeWeightAdditive&&this._setIdentity(t,n,r,2*r),this._mixBufferFunctionAdditive(t,n,0,e,r),this.cumulativeWeightAdditive+=e}apply(){const e=this.buffer,t=this.valueSize,r=this.cumulativeWeight,n=this.cumulativeWeightAdditive;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const n=2*t;this._mixBufferFunction(e,t,n,1-r,t)}n>0&&this._mixBufferFunctionAdditive(e,t,3*t,1,t),this.valueSize>1?this.target[this.property].fromArray?this.target[this.property].fromArray(e,t):function(e,t,r,n){for(let i=0;i<n;i++)e[i]=t[r+i]}(this.target[this.property],e,t,this.valueSize):this.target[this.property]=e[t]}}function nh(e,t,r,n,i){if(n>=.5)for(let n=0;n!==i;++n)e[t+n]=e[r+n]}function ih(e,t,r,n){Mc.slerpFlat(e,t,e,t,e,r,n)}const ah=new Float64Array(4);function sh(e,t,r,n){Mc.multiplyQuaternionsFlat(ah,0,e,t,e,r),Mc.slerpFlat(e,t,e,t,ah,0,n)}function oh(e,t,r,n,i){const a=1-n;for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]*a+e[r+s]*n}}function lh(e,t,r,n,i){for(let a=0;a!==i;++a){const i=t+a;e[i]=e[i]+e[r+a]*n}}function uh(e,t,r){for(let n=0;n<r;n++)e[t+n]=0}function ch(e,t){uh(e,t,3),e[t+3]=1}function hh(e,t,r,n){for(let i=0;i<r;i++)e[t+i]=e[n+i]}class dh{constructor(){this._actions=[],this._bindings={}}addAction(e){if(-1!==this._actions.indexOf(e))return void console.warn("AnimationMixer.addAction(): already has the action, clip name is <"+e.clip.name+">.");this._actions.push(e);const t=e.clip.tracks;for(let e=0;e<t.length;e++){const r=t[e],n=r.name;if(!this._bindings[n]){const e=new rh(r.target,r.propertyPath,r.valueTypeName,r.valueSize);this._bindings[n]={binding:e,referenceCount:0,active:!1,cachedActive:!1}}this._bindings[n].referenceCount++}}removeAction(e){const t=this._actions.indexOf(e);if(-1===t)return void console.warn("AnimationMixer.removeAction(): action not found in this mixer, clip name is <"+e.clip.name+">.");if(e.weight>0)return void console.warn("AnimationMixer.removeAction(): make sure action's weight is zero before removing it.");this._actions.splice(t,1);const r=clip.tracks;for(let e=0;e<r.length;e++){const t=r[e].name,n=this._bindings[t];n&&--n.referenceCount<=0&&(n.cachedActive&&n.binding.restoreOriginalState(),delete this._bindings[t])}}hasAction(e){return this._actions.indexOf(e)>-1}getActions(){return this._actions}update(e){for(let e in this._bindings)this._bindings[e].active=!1;for(let t=0,r=this._actions.length;t<r;t++){const r=this._actions[t];if(r.weight>0){r.update(e);const t=r.clip.tracks;for(let e=0,n=t.length;e<n;e++){const n=t[e],i=this._bindings[n.name],a=i.binding;i.active=!0,i.cachedActive||(i.binding.saveOriginalState(),i.cachedActive=!0),n.getValue(r.time,a.buffer),r.blendMode===Bc.ADD?a.accumulateAdditive(r.weight):a.accumulate(r.weight)}}}for(let e in this._bindings){const t=this._bindings[e];t.active?t.binding.apply():t.cachedActive&&(t.binding.restoreOriginalState(),t.cachedActive=!1)}}}class ph{constructor(e,t,r=-1){this.name=e,this.tracks=t,this.duration=r,this.duration<0&&this.resetDuration()}resetDuration(){const e=this.tracks;let t=0;for(let r=0,n=e.length;r<n;r++){const n=e[r];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}}class fh{constructor(e,t,r){this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r}itemStart(e){this.itemsTotal++,!1===this.isLoading&&void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0}itemEnd(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())}itemError(e){void 0!==this.onError&&this.onError(e)}resolveURL(e){return this.urlModifier?this.urlModifier(e):e}setURLModifier(e){return this.urlModifier=e,this}}const mh=new fh;class gh{constructor(e){this.manager=void 0!==e?e:mh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise((function(n,i){r.load(e,n,t,i)}))}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setRequestHeader(e){return this.requestHeader=e,this}}let _h=class extends gh{constructor(e){super(e),this.responseType=void 0,this.mimeType=void 0}load(e,t,r,n){void 0===e&&(e=""),null!=this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,s=this.responseType;fetch(i).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("t3d.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const t=e.body.getReader(),n=e.headers.get("Content-Length"),i=n?parseInt(n):0,a=0!==i;let s=0;const o=new ReadableStream({start(e){!function n(){t.read().then((({done:t,value:o})=>{if(t)e.close();else{s+=o.byteLength;const t=new ProgressEvent("progress",{lengthComputable:a,loaded:s,total:i});void 0!==r&&r(t),e.enqueue(o),n()}}))}()}});return new Response(o)}throw new vh(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),r=t&&t[1]?t[1].toLowerCase():void 0,n=new TextDecoder(r);return e.arrayBuffer().then((e=>n.decode(e)))}}})).then((e=>{t&&t(e)})).catch((t=>{n&&n(t),this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};class vh extends Error{constructor(e,t){super(e),this.response=t}}let yh=class extends gh{constructor(e){super(e)}load(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){l(),t&&t(this),i.manager.itemEnd(e)}function o(t){l(),n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}function l(){a.removeEventListener("load",s,!1),a.removeEventListener("error",o,!1)}return a.addEventListener("load",s,!1),a.addEventListener("error",o,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}};class xh{constructor(e=0,t=0){this.x=e,this.y=t}set(e=0,t=0){return this.x=e,this.y=t,this}lerpVectors(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}getLength(){return Math.sqrt(this.getLengthSquared())}getLengthSquared(){return this.x*this.x+this.y*this.y}normalize(e=1){const t=e/(this.getLength()||1);return this.x*=t,this.y*=t,this}subtract(e,t=new xh){return t.set(this.x-e.x,this.y-e.y)}sub(e){return this.x-=e.x,this.y-=e.y,this}copy(e){return this.x=e.x,this.y=e.y,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}add(e){return this.x+=e.x,this.y+=e.y,this}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}clone(){return new xh(this.x,this.y)}}class bh{constructor(e,t){this.min=void 0!==e?e:new xh(1/0,1/0),this.max=void 0!==t?t:new xh(-1/0,-1/0)}set(e,t,r,n){this.min.set(e,t),this.max.set(r,n)}clone(){return(new bh).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}}const Ah=[new bc,new bc,new bc,new bc,new bc,new bc,new bc,new bc];class Sh{constructor(e,t){this.min=void 0!==e?e:new bc(1/0,1/0,1/0),this.max=void 0!==t?t:new bc(-1/0,-1/0,-1/0)}set(e,t){this.min.copy(e),this.max.copy(t)}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByBox3(e){return this.min.min(e.min),this.max.max(e.max),this}setFromArray(e,t=3,r=0){let n=1/0,i=1/0,a=1/0,s=-1/0,o=-1/0,l=-1/0;for(let u=0,c=e.length;u<c;u+=t){const t=e[u+r],c=e[u+r+1],h=e[u+r+2];t<n&&(n=t),c<i&&(i=c),h<a&&(a=h),t>s&&(s=t),c>o&&(o=c),h>l&&(l=h)}return this.min.set(n,i,a),this.max.set(s,o,l),this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}getCenter(e){const t=e||new bc;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}applyMatrix4(e){return this.isEmpty()||(Ah[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ah[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ah[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ah[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ah[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ah[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ah[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ah[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ah)),this}clone(){return(new Sh).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}}class Eh{constructor(e,t,r){if(this.r=0,this.g=0,this.b=0,void 0===t&&void 0===r)return this.setHex(e);this.setRGB(e,t,r)}lerpColors(e,t,r){this.r=r*(t.r-e.r)+e.r,this.g=r*(t.g-e.g)+e.g,this.b=r*(t.b-e.b)+e.b}lerp(e,t){this.lerpColors(this,e,t)}clone(){return new Eh(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}getHex(){return Ch(255*this.r,0,255)<<16^Ch(255*this.g,0,255)<<8^Ch(255*this.b,0,255)<<0}setRGB(e,t,r){return this.r=e,this.g=t,this.b=r,this}setHSL(e,t,r){var n;if(e=(e%(n=1)+n)%n,t=Math.max(0,Math.min(1,t)),r=Math.max(0,Math.min(1,r)),0===t)this.r=this.g=this.b=r;else{const n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=wh(i,n,e+1/3),this.g=wh(i,n,e),this.b=wh(i,n,e-1/3)}return this}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}}function wh(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function Ch(e,t,r){return Math.max(t,Math.min(r,e))}const Th=new Sc;class Dh{constructor(e=0,t=0,r=0,n=Dh.DefaultOrder){this._x=e,this._y=t,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this.onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this.onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this.onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this.onChangeCallback()}clone(){return new Dh(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this}set(e=0,t=0,r=0,n=this._order){return this._x=e,this._y=t,this._z=r,this._order=n,this.onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const n=e.elements,i=n[0],a=n[4],s=n[8],o=n[1],l=n[5],u=n[9],c=n[2],h=n[6],d=n[10];return"XYZ"===t?(this._y=Math.asin(Mh(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-Mh(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,i),this._z=0)):"ZXY"===t?(this._x=Math.asin(Mh(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,i))):"ZYX"===t?(this._y=Math.asin(-Mh(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-a,l))):"YZX"===t?(this._z=Math.asin(Mh(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===t?(this._z=Math.asin(-Mh(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-u,d),this._y=0)):console.warn("given unsupported order: "+t),this._order=t,!0===r&&this.onChangeCallback(),this}setFromQuaternion(e,t,r){return e.toMatrix4(Th),this.setFromRotationMatrix(Th,t,r)}onChange(e){return this.onChangeCallback=e,this}onChangeCallback(){}}function Mh(e,t,r){return Math.max(t,Math.min(r,e))}Dh.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Dh.DefaultOrder="XYZ";class Ph{constructor(){this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,r,n,i,a,s,o,l){const u=this.elements;return u[0]=e,u[3]=t,u[6]=r,u[1]=n,u[4]=i,u[7]=a,u[2]=s,u[5]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1)}inverse(){return this.getInverse(this)}getInverse(e){const t=e.elements,r=this.elements,n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=h*o-l*c,p=l*u-h*s,f=c*s-o*u,m=n*d+i*p+a*f;if(0===m)return console.warn("Matrix3: .getInverse() can not invert matrix, determinant is 0"),this.identity();const g=1/m;return r[0]=d*g,r[1]=(a*c-h*i)*g,r[2]=(l*i-a*o)*g,r[3]=p*g,r[4]=(h*n-a*u)*g,r[5]=(a*s-l*n)*g,r[6]=f*g,r[7]=(i*u-c*n)*g,r[8]=(o*n-i*s)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new Ph).fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,n=t.elements,i=this.elements,a=r[0],s=r[3],o=r[6],l=r[1],u=r[4],c=r[7],h=r[2],d=r[5],p=r[8],f=n[0],m=n[3],g=n[6],_=n[1],v=n[4],y=n[7],x=n[2],b=n[5],A=n[8];return i[0]=a*f+s*_+o*x,i[3]=a*m+s*v+o*b,i[6]=a*g+s*y+o*A,i[1]=l*f+u*_+c*x,i[4]=l*m+u*v+c*b,i[7]=l*g+u*y+c*A,i[2]=h*f+d*_+p*x,i[5]=h*m+d*v+p*b,i[8]=h*g+d*y+p*A,this}transform(e,t,r,n,i,a,s){const o=this.elements,l=Math.cos(i),u=Math.sin(i);return o[0]=l*r,o[3]=-u*n,o[6]=e,o[1]=u*r,o[4]=l*n,o[7]=t,o[2]=0,o[5]=0,o[8]=1,(a||s)&&(o[6]-=a*o[0]+s*o[3],o[7]-=a*o[1]+s*o[4]),this}setUvTransform(e,t,r,n,i,a,s){const o=Math.cos(i),l=Math.sin(i);return this.set(r*o,r*l,-r*(o*a+l*s)+a+e,-n*l,n*o,-n*(-l*a+o*s)+s+t,0,0,1)}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10])}}const Fh=new bc,Rh=new Ph;let Nh=class e{constructor(e=new bc(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}normalize(){const e=1/this.normal.getLength();return this.normal.multiplyScalar(e),this.constant*=e,this}distanceToPoint(e){return this.normal.dot(e)+this.constant}coplanarPoint(e=new bc){return e.copy(this.normal).multiplyScalar(-this.constant)}clone(){return(new e).copy(this)}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}applyMatrix4(e,t){const r=t||Rh.setFromMatrix4(e).inverse().transpose(),n=this.coplanarPoint(Fh).applyMatrix4(e),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this}};const Bh=new bc;class Ih{constructor(e=new Nh,t=new Nh,r=new Nh,n=new Nh,i=new Nh,a=new Nh){this.planes=[e,t,r,n,i,a]}set(e,t,r,n,i,a){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(n),s[4].copy(i),s[5].copy(a),this}setFromMatrix(e){const t=this.planes,r=e.elements,n=r[0],i=r[1],a=r[2],s=r[3],o=r[4],l=r[5],u=r[6],c=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],g=r[13],_=r[14],v=r[15];return t[0].setComponents(s-n,c-o,f-h,v-m).normalize(),t[1].setComponents(s+n,c+o,f+h,v+m).normalize(),t[2].setComponents(s+i,c+l,f+d,v+g).normalize(),t[3].setComponents(s-i,c-l,f-d,v-g).normalize(),t[4].setComponents(s-a,c-u,f-p,v-_).normalize(),t[5].setComponents(s+a,c+u,f+p,v+_).normalize(),this}intersectsSphere(e){const t=this.planes,r=e.center,n=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(r)<n)return!1}return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const n=t[r];if(Bh.x=n.normal.x>0?e.max.x:e.min.x,Bh.y=n.normal.y>0?e.max.y:e.min.y,Bh.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Bh)<0)return!1}return!0}clone(){return(new this.constructor).copy(this)}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}}const Oh=new bc,kh=new bc,Lh=new bc,Uh=new bc,zh=new bc;class jh{constructor(e=new bc,t=new bc(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}at(e,t=new bc){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}distanceSqToPoint(e){const t=Oh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Oh.copy(this.direction).multiplyScalar(t).add(this.origin),Oh.distanceToSquared(e))}intersectsBox(e){return null!==this.intersectBox(e,Oh)}intersectBox(e,t){let r,n,i,a,s,o;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),u>=0?(i=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(i=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),r>a||i>n?null:((i>r||r!=r)&&(r=i),(a<n||n!=n)&&(n=a),c>=0?(s=(e.min.z-h.z)*c,o=(e.max.z-h.z)*c):(s=(e.max.z-h.z)*c,o=(e.min.z-h.z)*c),r>o||s>n?null:((s>r||r!=r)&&(r=s),(o<n||n!=n)&&(n=o),n<0?null:this.at(r>=0?r:n,t)))}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}intersectSphere(e,t){Oh.subVectors(e.center,this.origin);const r=Oh.dot(this.direction),n=Oh.dot(Oh)-r*r,i=e.radius*e.radius;if(n>i)return null;const a=Math.sqrt(i-n),s=r-a,o=r+a;return s<0&&o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectTriangle(e,t,r,n,i){Lh.subVectors(t,e),Uh.subVectors(r,e),zh.crossVectors(Lh,Uh);let a,s=this.direction.dot(zh);if(s>0){if(n)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}kh.subVectors(this.origin,e);const o=a*this.direction.dot(Uh.crossVectors(kh,Uh));if(o<0)return null;const l=a*this.direction.dot(Lh.cross(kh));if(l<0)return null;if(o+l>s)return null;const u=-a*kh.dot(zh);return u<0?null:this.at(u/s,i)}}const Vh=new Sh,Gh=new bc;let Wh=class e{constructor(e=new bc,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromArray(e,t=3,r=0){const n=this.center;Vh.setFromArray(e,t).getCenter(n);let i=0;for(let a=0,s=e.length;a<s;a+=t)Gh.fromArray(e,a+r),i=Math.max(i,n.distanceToSquared(Gh));return this.radius=Math.sqrt(i),this}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Gh.subVectors(e,this.center);const t=Gh.getLengthSquared();if(t>this.radius*this.radius){const e=Math.sqrt(t),r=.5*(e-this.radius);this.center.addScaledVector(Gh,r/e),this.radius+=r}return this}clone(){return(new e).copy(this)}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}};class Hh{constructor(e=1,t=0,r=0){this.radius=e,this.phi=t,this.theta=r}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}clone(){return(new Hh).copy(this)}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.radius=e.getLength(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(Math.min(1,Math.max(-1,e.y/this.radius)))),this}}const qh=new bc,Xh=new bc,Qh=new bc,Kh=new bc;class Yh{constructor(e=new bc,t=new bc,r=new bc){this.a=e,this.b=t,this.c=r}static normal(e,t,r,n){const i=n||new bc;i.subVectors(r,t),qh.subVectors(e,t),i.cross(qh);const a=i.getLengthSquared();return a>0?i.multiplyScalar(1/Math.sqrt(a)):i.set(0,0,0)}static barycoordFromPoint(e,t,r,n,i){qh.subVectors(n,t),Xh.subVectors(r,t),Qh.subVectors(e,t);const a=qh.dot(qh),s=qh.dot(Xh),o=qh.dot(Qh),l=Xh.dot(Xh),u=Xh.dot(Qh),c=a*l-s*s,h=i||new bc;if(0===c)return h.set(-2,-1,-1);const d=1/c,p=(l*o-s*u)*d,f=(a*u-s*o)*d;return h.set(1-p-f,f,p)}static containsPoint(e,t,r,n){return this.barycoordFromPoint(e,t,r,n,Kh),Kh.x>=0&&Kh.y>=0&&Kh.x+Kh.y<=1}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}}class Zh{constructor(e=0,t=0,r=0,n=1){this.x=e,this.y=t,this.z=r,this.w=n}lerpVectors(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}set(e=0,t=0,r=0,n=1){return this.x=e,this.y=t,this.z=r,this.w=n,this}normalize(){return this.multiplyScalar(1/(this.getLength()||1))}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}getManhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}clone(){return new Zh(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}}const Jh=[];for(let e=0;e<256;e++)Jh[e]=(e<16?"0":"")+e.toString(16);function $h(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Jh[255&e]+Jh[e>>8&255]+Jh[e>>16&255]+Jh[e>>24&255]+"-"+Jh[255&t]+Jh[t>>8&255]+"-"+Jh[t>>16&15|64]+Jh[t>>24&255]+"-"+Jh[63&r|128]+Jh[r>>8&255]+"-"+Jh[r>>16&255]+Jh[r>>24&255]+Jh[255&n]+Jh[n>>8&255]+Jh[n>>16&255]+Jh[n>>24&255]).toUpperCase()}function ed(e){return 0==(e&e-1)&&0!==e}function td(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))}function rd(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function nd(e){const t={};for(const r in e){const n=e[r];Array.isArray(n)||ArrayBuffer.isView(n)?t[r]=n.slice():t[r]=n}return t}function id(e){const t=Array.isArray(e)?[]:{};if(e&&"object"==typeof e)for(const r in e)e.hasOwnProperty(r)&&(t[r]=e[r]&&"object"==typeof e[r]?id(e[r]):e[r]);return t}let ad=0;const sd=new Sc;let od=class{constructor(){this.id=ad++,this.uuid=$h(),this.name="",this.position=new bc,this.scale=new bc(1,1,1),this.euler=new Dh,this.quaternion=new Mc;const e=this.euler,t=this.quaternion;e.onChange((function(){t.setFromEuler(e,!1)})),t.onChange((function(){e.setFromQuaternion(t,void 0,!1)})),this.matrix=new Sc,this.worldMatrix=new Sc,this.children=new Array,this.parent=null,this.castShadow=!1,this.receiveShadow=!1,this.shadowType=qc.PCF3_SOFT,this.frustumCulled=!0,this.visible=!0,this.renderOrder=0,this.renderLayer=0,this.renderable=!0,this.userData={},this.matrixAutoUpdate=!0,this.matrixNeedsUpdate=!0,this.worldMatrixNeedsUpdate=!0}onBeforeRender(){}onAfterRender(){}add(e){e!==this?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.worldMatrixNeedsUpdate=!0):console.error("Object3D.add: object can't be added as a child of itself.",e)}remove(e){const t=this.children.indexOf(e);-1!==t&&(e.parent=null,this.children.splice(t,1),e.worldMatrixNeedsUpdate=!0)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,n=this.children.length;r<n;r++){const n=this.children[r].getObjectByProperty(e,t);if(void 0!==n)return n}}updateMatrix(e){if((this.matrixAutoUpdate||this.matrixNeedsUpdate)&&(this.matrix.transform(this.position,this.scale,this.quaternion),this.matrixNeedsUpdate=!1,this.worldMatrixNeedsUpdate=!0),this.worldMatrixNeedsUpdate||e){if(this.worldMatrix.copy(this.matrix),this.parent){const e=this.parent.worldMatrix;this.worldMatrix.premultiply(e)}this.worldMatrixNeedsUpdate=!1,e=!0}const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].updateMatrix(e)}getWorldDirection(e=new bc){const t=this.worldMatrix.elements;return e.set(t[8],t[9],t[10]).normalize()}lookAt(e,t){sd.lookAtRH(e,this.position,t),this.quaternion.setFromRotationMatrix(sd)}raycast(e,t){}traverse(e){e(this);const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverse(e)}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.worldMatrix.copy(e.worldMatrix),this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.shadowType=e.shadowType,this.frustumCulled=e.frustumCulled,this.visible=e.visible,this.renderOrder=e.renderOrder,this.renderLayer=e.renderLayer,this.renderable=e.renderable,this.userData=id(e.userData),!0===t)for(let t=0;t<e.children.length;t++){const r=e.children[t];this.add(r.clone())}return this}};const ld=new bc,ud=[],cd=[],hd=[];let dd=0;class pd{constructor(){this.id=dd++,this.version=0,this.lights=[],this.ambient=new Float32Array([0,0,0]),this.hemisphere=[],this.directional=[],this.directionalShadow=[],this.directionalShadowMap=[],this.directionalShadowDepthMap=[],this.directionalShadowMatrix=new Float32Array(0),this.point=[],this.pointShadow=[],this.pointShadowMap=[],this.pointShadowMatrix=new Float32Array(0),this.spot=[],this.spotShadow=[],this.spotShadowMap=[],this.spotShadowDepthMap=[],this.spotShadowMatrix=new Float32Array(0),this.useAmbient=!1,this.hemisNum=0,this.directsNum=0,this.pointsNum=0,this.spotsNum=0,this.directShadowNum=0,this.pointShadowNum=0,this.spotShadowNum=0,this.totalNum=0,this.shadowsNum=0,this.hash=new vd}begin(){this.totalNum=0,this.shadowsNum=0}push(e){this.lights[this.totalNum++]=e,xd(e)&&this.shadowsNum++}end(e){this.lights.length=this.totalNum,this.lights.sort(yd),this._setupCache(e),this.hash.update(this),this.version++}_setupCache(e){for(let e=0;e<3;e++)this.ambient[e]=0;this.useAmbient=!1,this.hemisNum=0,this.directsNum=0,this.pointsNum=0,this.spotsNum=0,this.directShadowNum=0,this.pointShadowNum=0,this.spotShadowNum=0;for(let t=0,r=this.lights.length;t<r;t++){const r=this.lights[t];r.isAmbientLight?this._doAddAmbientLight(r):r.isHemisphereLight?this._doAddHemisphereLight(r,e):r.isDirectionalLight?this._doAddDirectLight(r,e):r.isPointLight?this._doAddPointLight(r,e):r.isSpotLight&&this._doAddSpotLight(r,e)}const t=this.directShadowNum;if(t>0){this.directionalShadowMap.length=t,this.directionalShadowDepthMap.length=t,ud.length=t,this.directionalShadowMatrix.length!==16*t&&(this.directionalShadowMatrix=new Float32Array(16*t));for(let e=0;e<t;e++)ud[e].toArray(this.directionalShadowMatrix,16*e)}const r=this.pointShadowNum;if(r>0){this.pointShadowMap.length=r,cd.length=r,this.pointShadowMatrix.length!==16*r&&(this.pointShadowMatrix=new Float32Array(16*r));for(let e=0;e<r;e++)cd[e].toArray(this.pointShadowMatrix,16*e)}const n=this.spotShadowNum;if(n>0){this.spotShadowMap.length=n,this.spotShadowDepthMap.length=n,hd.length=n,this.spotShadowMatrix.length!==16*n&&(this.spotShadowMatrix=new Float32Array(16*n));for(let e=0;e<n;e++)hd[e].toArray(this.spotShadowMatrix,16*e)}}_doAddAmbientLight(e){const t=e.intensity,r=e.color;this.ambient[0]+=r.r*t,this.ambient[1]+=r.g*t,this.ambient[2]+=r.b*t,this.useAmbient=!0}_doAddHemisphereLight(e,t){const r=e.intensity,n=e.color,i=e.groundColor,a=t.useAnchorMatrix,s=md(e);s.skyColor[0]=n.r*r,s.skyColor[1]=n.g*r,s.skyColor[2]=n.b*r,s.groundColor[0]=i.r*r,s.groundColor[1]=i.g*r,s.groundColor[2]=i.b*r;const o=e.worldMatrix.elements,l=ld.set(o[4],o[5],o[6]).normalize();a&&l.transformDirection(t.anchorMatrixInverse),l.toArray(s.direction),this.hemisphere[this.hemisNum++]=s}_doAddDirectLight(e,t){const r=e.intensity,n=e.color,i=t.useAnchorMatrix,a=md(e);a.color[0]=n.r*r,a.color[1]=n.g*r,a.color[2]=n.b*r;const s=e.getWorldDirection(ld);if(i&&s.transformDirection(t.anchorMatrixInverse),s.multiplyScalar(-1).toArray(a.direction),e.castShadow){const r=e.shadow,n=_d(e);n.shadowBias[0]=r.bias,n.shadowBias[1]=r.normalBias,n.shadowMapSize[0]=r.mapSize.x,n.shadowMapSize[1]=r.mapSize.y,n.shadowParams[0]=r.radius,n.shadowParams[1]=r.frustumEdgeFalloff,this.directionalShadow[this.directShadowNum++]=n,r.update(e),r.updateMatrix(),i&&r.matrix.multiply(t.anchorMatrix),this.directionalShadowMap[this.directsNum]=r.map,this.directionalShadowDepthMap[this.directsNum]=r.depthMap,ud[this.directsNum]=r.matrix}this.directional[this.directsNum++]=a}_doAddPointLight(e,t){const r=e.intensity,n=e.color,i=e.distance,a=e.decay,s=t.useAnchorMatrix,o=md(e);o.color[0]=n.r*r,o.color[1]=n.g*r,o.color[2]=n.b*r,o.distance=i,o.decay=a;const l=ld.setFromMatrixPosition(e.worldMatrix);if(s&&l.applyMatrix4(t.anchorMatrixInverse),o.position[0]=l.x,o.position[1]=l.y,o.position[2]=l.z,e.castShadow){const t=e.shadow,r=_d(e);r.shadowBias[0]=t.bias,r.shadowBias[1]=t.normalBias,r.shadowMapSize[0]=t.mapSize.x,r.shadowMapSize[1]=t.mapSize.y,r.shadowParams[0]=t.radius,r.shadowParams[1]=0,r.shadowCameraRange[0]=t.cameraNear,r.shadowCameraRange[1]=t.cameraFar,this.pointShadow[this.pointShadowNum++]=r,t.update(e,0),t.matrix.makeTranslation(-l.x,-l.y,-l.z),this.pointShadowMap[this.pointsNum]=t.map,cd[this.pointsNum]=t.matrix}this.point[this.pointsNum++]=o}_doAddSpotLight(e,t){const r=e.intensity,n=e.color,i=e.distance,a=e.decay,s=t.useAnchorMatrix,o=md(e);o.color[0]=n.r*r,o.color[1]=n.g*r,o.color[2]=n.b*r,o.distance=i,o.decay=a;const l=ld.setFromMatrixPosition(e.worldMatrix);s&&l.applyMatrix4(t.anchorMatrixInverse),o.position[0]=l.x,o.position[1]=l.y,o.position[2]=l.z;const u=e.getWorldDirection(ld);s&&u.transformDirection(t.anchorMatrixInverse),u.multiplyScalar(-1).toArray(o.direction);const c=Math.cos(e.angle),h=Math.cos(e.angle*(1-e.penumbra));if(o.coneCos=c,o.penumbraCos=h,e.castShadow){const r=e.shadow,n=_d(e);n.shadowBias[0]=r.bias,n.shadowBias[1]=r.normalBias,n.shadowMapSize[0]=r.mapSize.x,n.shadowMapSize[1]=r.mapSize.y,n.shadowParams[0]=r.radius,n.shadowParams[1]=r.frustumEdgeFalloff,this.spotShadow[this.spotShadowNum++]=n,r.update(e),r.updateMatrix(),s&&r.matrix.multiply(t.anchorMatrix),this.spotShadowMap[this.spotsNum]=r.map,this.spotShadowDepthMap[this.spotsNum]=r.depthMap,hd[this.spotsNum]=r.matrix}this.spot[this.spotsNum++]=o}}const fd=new WeakMap;function md(e){if(fd.has(e))return fd.get(e);let t;return e.isHemisphereLight?t={direction:new Float32Array(3),skyColor:new Float32Array([0,0,0]),groundColor:new Float32Array([0,0,0])}:e.isDirectionalLight?t={direction:new Float32Array(3),color:new Float32Array([0,0,0])}:e.isPointLight?t={position:new Float32Array(3),color:new Float32Array([0,0,0]),distance:0,decay:0}:e.isSpotLight&&(t={position:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array([0,0,0]),distance:0,coneCos:0,penumbraCos:0,decay:0}),fd.set(e,t),t}const gd=new WeakMap;function _d(e){if(gd.has(e))return gd.get(e);let t;return e.isDirectionalLight?t={shadowBias:new Float32Array(2),shadowMapSize:new Float32Array(2),shadowParams:new Float32Array(2)}:e.isPointLight?t={shadowBias:new Float32Array(2),shadowMapSize:new Float32Array(2),shadowParams:new Float32Array(2),shadowCameraRange:new Float32Array(2)}:e.isSpotLight&&(t={shadowBias:new Float32Array(2),shadowMapSize:new Float32Array(2),shadowParams:new Float32Array(2)}),gd.set(e,t),t}class vd{constructor(){this._factor=new Uint16Array(8)}update(e){this._factor[0]=e.useAmbient?1:0,this._factor[1]=e.hemisNum,this._factor[2]=e.directsNum,this._factor[3]=e.pointsNum,this._factor[4]=e.spotsNum,this._factor[5]=e.directShadowNum,this._factor[6]=e.pointShadowNum,this._factor[7]=e.spotShadowNum}compare(e){if(!e)return!1;for(let t=0,r=e.length;t<r;t++)if(this._factor[t]!==e[t])return!1;return!0}copyTo(e){return e||(e=new this._factor.constructor(this._factor.length)),e.set(this._factor),e}}function yd(e,t){const r=xd(e)?1:0;return(xd(t)?1:0)-r}function xd(e){return e.shadow&&e.castShadow}function bd(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.id-t.id}function Ad(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.material.id!==t.material.id?e.material.id-t.material.id:e.id-t.id}class Sd{constructor(e){this.id=e,this.opaque=[],this.opaqueCount=0,this.transparent=[],this.transparentCount=0,this._cache=[],this._cacheIndex=0,this._lastCacheIndex=0,this.opaqueSortCompareFn=bd,this.transparentSortCompareFn=Ad}begin(){this._cacheIndex=0,this.opaqueCount=0,this.transparentCount=0}end(){this.opaque.length=this.opaqueCount,this.transparent.length=this.transparentCount;const e=this._cacheIndex,t=this._lastCacheIndex;if(t>e){const r=this._cache;for(let n=e;n<t;n++){const e=r[n];e.object=null,e.geometry=null,e.material=null,e.group=null}}this._lastCacheIndex=e}addRenderable(e,t,r,n,i){const a=this._cache;let s=a[this._cacheIndex];void 0===s?(s={object:e,geometry:t,material:r,z:n,renderOrder:e.renderOrder,group:i},a[this._cacheIndex]=s):(s.object=e,s.geometry=t,s.material=r,s.z=n,s.renderOrder=e.renderOrder,s.group=i),r.transparent?(this.transparent[this.transparentCount]=s,this.transparentCount++):(this.opaque[this.opaqueCount]=s,this.opaqueCount++),this._cacheIndex++}sort(){this.opaque.sort(this.opaqueSortCompareFn),this.transparent.sort(this.transparentSortCompareFn)}}class Ed{constructor(){this.layerMap=new Map,this.layerList=[],this._lastLayer=this.createLayer(0)}begin(){for(let e=0,t=this.layerList.length;e<t;e++)this.layerList[e].begin()}end(){for(let e=0,t=this.layerList.length;e<t;e++)this.layerList[e].end(),this.layerList[e].sort()}push(e,t){if(e.frustumCulled&&t.frustumCulled&&(Cd.copy(e.geometry.boundingSphere).applyMatrix4(e.worldMatrix),!t.frustum.intersectsSphere(Cd)))return;wd.setFromMatrixPosition(e.worldMatrix),wd.applyMatrix4(t.projectionViewMatrix);const r=e.renderLayer||0;let n=this._lastLayer;if(n.id!==r&&(n=this.layerMap.get(r),n||(n=this.createLayer(r)),this._lastLayer=n),Array.isArray(e.material)){const t=e.geometry.groups;for(let r=0;r<t.length;r++){const i=t[r],a=e.material[i.materialIndex];a&&n.addRenderable(e,e.geometry,a,wd.z,i)}}else n.addRenderable(e,e.geometry,e.material,wd.z)}setLayer(e,t){this.layerMap.set(e,t),this.layerList.push(t),this.layerList.sort(Td)}createLayer(e){const t=new Sd(e);return this.setLayer(e,t),t}getLayer(e){return this.layerMap.get(e)}removeLayer(e){const t=this.layerMap.get(e);if(t){this.layerMap.delete(e);const r=this.layerList.indexOf(t);-1!==r&&this.layerList.splice(r,1),this._lastLayer===e&&(this._lastLayer=null)}}}const wd=new bc,Cd=new Wh;function Td(e,t){return e.id-t.id}const Dd=new Nh;let Md=0;class Pd{constructor(){this.id=Md++,this.version=0,this.useAnchorMatrix=!1,this.anchorMatrix=new Sc,this.anchorMatrixInverse=new Sc,this.disableShadowSampler=!1,this.logarithmicDepthBuffer=!1,this.fog=null,this.environment=null,this.environmentLightIntensity=1,this.clippingPlanesData=new Float32Array([]),this.numClippingPlanes=0}update(e){this.useAnchorMatrix=!e.anchorMatrix.isIdentity(),this.anchorMatrix.copy(e.anchorMatrix),this.anchorMatrixInverse.getInverse(e.anchorMatrix),this.disableShadowSampler=e.disableShadowSampler,this.logarithmicDepthBuffer=e.logarithmicDepthBuffer,this.fog=e.fog,this.environment=e.environment,this.environmentLightIntensity=e.environmentLightIntensity,this.clippingPlanesData.length<4*e.clippingPlanes.length&&(this.clippingPlanesData=new Float32Array(4*e.clippingPlanes.length)),this.setClippingPlanesData(e.clippingPlanes,this.clippingPlanesData),this.numClippingPlanes=e.clippingPlanes.length,this.version++}setClippingPlanesData(e,t){for(let r=0;r<e.length;r++)Dd.copy(e[r]),this.useAnchorMatrix&&Dd.applyMatrix4(this.anchorMatrixInverse),t[4*r+0]=Dd.normal.x,t[4*r+1]=Dd.normal.y,t[4*r+2]=Dd.normal.z,t[4*r+3]=Dd.constant;return t}}let Fd=0;class Rd{constructor(e,t){this.scene=e,this.lights=t,this.camera={id:Fd++,version:0,near:0,far:0,position:new bc,logDepthCameraNear:0,logDepthBufFC:0,viewMatrix:new Sc,projectionMatrix:new Sc,projectionViewMatrix:new Sc,rect:new Zh(0,0,1,1)},this.gammaFactor=2,this.outputEncoding=Xc.LINEAR}updateCamera(e){const t=this.scene,r=this.camera,n=e.projectionMatrix;let i=0,a=0;-1===n.elements[11]?(i=n.elements[14]/(n.elements[10]-1),a=n.elements[14]/(n.elements[10]+1)):(i=(n.elements[14]+1)/n.elements[10],a=(n.elements[14]-1)/n.elements[10]),r.near=i,r.far=a,t.logarithmicDepthBuffer?(r.logDepthCameraNear=i,r.logDepthBufFC=2/(Math.log(a-i+1)*Math.LOG2E)):(r.logDepthCameraNear=0,r.logDepthBufFC=0),r.position.setFromMatrixPosition(e.worldMatrix),t.useAnchorMatrix&&r.position.applyMatrix4(t.anchorMatrixInverse),r.viewMatrix.copy(e.viewMatrix),t.useAnchorMatrix&&r.viewMatrix.multiply(t.anchorMatrix),r.projectionMatrix.copy(n),r.projectionViewMatrix.copy(n).multiply(r.viewMatrix),r.rect.copy(e.rect),r.version++,this.gammaFactor=e.gammaFactor,this.outputEncoding=e.outputEncoding}}let Nd=class extends od{constructor(){super(),this.fog=null,this.environment=null,this.environmentLightIntensity=1,this.clippingPlanes=[],this.disableShadowSampler=!1,this.logarithmicDepthBuffer=!1,this.anchorMatrix=new Sc,this._sceneData=new Pd,this._lightData=new pd,this._skeletons=new Set,this._renderQueueMap=new WeakMap,this._renderStatesMap=new WeakMap}updateRenderStates(e,t){t=void 0===t||t,this._renderStatesMap.has(e)||this._renderStatesMap.set(e,new Rd(this._sceneData,this._lightData));const r=this._renderStatesMap.get(e);return t&&this._sceneData.update(this),r.updateCamera(e),r}getRenderStates(e){return this._renderStatesMap.get(e)}updateRenderQueue(e,t,r){t=void 0===t||t,r=void 0===r||r,this._renderQueueMap.has(e)||this._renderQueueMap.set(e,new Ed);const n=this._renderQueueMap.get(e);if(r&&this._skeletons.clear(),n.begin(),t?(this._lightData.begin(),this._doPushObject(this,e,n,r),this._lightData.end(this._sceneData)):this._doPushMesh(this,e,n,r),n.end(),r)for(const e of this._skeletons)e.updateBones(this._sceneData);return n}getRenderQueue(e){return this._renderQueueMap.get(e)}_doPushMesh(e,t,r,n){if(!e.visible)return;e.geometry&&e.material&&e.renderable&&(r.push(e,t),n&&e.skeleton&&this._skeletons.add(e.skeleton));const i=e.children;for(let e=0,a=i.length;e<a;e++)this._doPushMesh(i[e],t,r,n)}_doPushObject(e,t,r,n){if(!e.visible)return;e.geometry&&e.material&&e.renderable?(r.push(e,t),n&&e.skeleton&&this._skeletons.add(e.skeleton)):e.isLight&&this._lightData.push(e);const i=e.children;for(let e=0,a=i.length;e<a;e++)this._doPushObject(i[e],t,r,n)}};Nd.prototype.isScene=!0;let Bd=class extends od{constructor(){super(),this.viewMatrix=new Sc,this.projectionMatrix=new Sc,this.projectionMatrixInverse=new Sc,this.projectionViewMatrix=new Sc,this.frustum=new Ih,this.gammaFactor=2,this.outputEncoding=Xc.LINEAR,this.rect=new Zh(0,0,1,1),this.frustumCulled=!0}lookAt(e,t){Id.lookAtRH(this.position,e,t),this.quaternion.setFromRotationMatrix(Id)}setOrtho(e,t,r,n,i,a){this.projectionMatrix.set(2/(t-e),0,0,-(t+e)/(t-e),0,2/(n-r),0,-(n+r)/(n-r),0,0,-2/(a-i),-(a+i)/(a-i),0,0,0,1),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}setPerspective(e,t,r,n){this.projectionMatrix.set(1/(t*Math.tan(e/2)),0,0,0,0,1/Math.tan(e/2),0,0,0,0,-(n+r)/(n-r),-2*n*r/(n-r),0,0,-1,0),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}getWorldDirection(e=new bc){const t=this.worldMatrix.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrix(e){od.prototype.updateMatrix.call(this,e),this.viewMatrix.getInverse(this.worldMatrix),this.projectionViewMatrix.multiplyMatrices(this.projectionMatrix,this.viewMatrix),this.frustum.setFromMatrix(this.projectionViewMatrix)}copy(e,t){return od.prototype.copy.call(this,e,t),this.viewMatrix.copy(e.viewMatrix),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.frustum.copy(e.frustum),this.gammaFactor=e.gammaFactor,this.outputEncoding=e.outputEncoding,this.rect.copy(e.rect),this.frustumCulled=e.frustumCulled,this}};Bd.prototype.isCamera=!0;const Id=new Sc,Od=new Wh,kd=new Sc,Ld=new jh,Ud=new bc,zd=new bc,jd=new bc,Vd=new bc,Gd=new bc,Wd=new bc,Hd=new bc,qd=new bc,Xd=new bc,Qd=new bc,Kd=new bc,Yd=new Zh,Zd=new Zh,Jd=new bc,$d=new Sc,ep=new xh,tp=new xh,rp=new xh,np=new bc,ip=new bc;let ap=class extends od{constructor(e,t){super(),this.geometry=e,this.material=t,this.morphTargetInfluences=null}raycast(e,t){const r=this.geometry,n=this.worldMatrix;if(Od.copy(r.boundingSphere),Od.applyMatrix4(n),!e.intersectsSphere(Od))return;if(kd.getInverse(n),Ld.copy(e).applyMatrix4(kd),!Ld.intersectsBox(r.boundingBox))return;const i=r.getAttribute("a_Position"),a=r.getAttribute("a_Uv"),s=r.morphAttributes.position;let o;if(r.index){const n=r.index.buffer.array;for(let r=0;r<n.length;r+=3){const l=n[r],u=n[r+1],c=n[r+2];o=sp(this,e,Ld,i,s,a,l,u,c),o&&(o.faceIndex=Math.floor(r/3),t.push(o))}}else for(let r=0;r<i.buffer.count;r+=3){o=sp(this,e,Ld,i,s,a,r,r+1,r+2),o&&(o.faceIndex=Math.floor(r/3),t.push(o))}}copy(e){return super.copy(e),e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),this}clone(){return new this.constructor(this.geometry,this.material).copy(this)}};function sp(e,t,r,n,i,a,s,o,l){zd.fromArray(n.buffer.array,3*s),jd.fromArray(n.buffer.array,3*o),Vd.fromArray(n.buffer.array,3*l);const u=e.morphTargetInfluences;if(i&&u){qd.set(0,0,0),Xd.set(0,0,0),Qd.set(0,0,0);for(let e=0;e<i.length;e++){const t=u[e],r=i[e];0!==t&&(Gd.fromArray(r.buffer.array,3*s),Wd.fromArray(r.buffer.array,3*o),Hd.fromArray(r.buffer.array,3*l),qd.addScaledVector(Gd,t),Xd.addScaledVector(Wd,t),Qd.addScaledVector(Hd,t))}zd.add(qd),jd.add(Xd),Vd.add(Qd)}e.isSkinnedMesh&&(op(e,s,zd),op(e,o,jd),op(e,l,Vd));const c=function(e,t,r,n,i,a,s){let o;const l=e.material;o=l.side===Lc.BACK?r.intersectTriangle(a,i,n,!0,s):r.intersectTriangle(n,i,a,l.side!==Lc.DOUBLE,s);if(null===o)return null;ip.copy(s),ip.applyMatrix4(e.worldMatrix);const u=t.origin.distanceTo(ip);return{distance:u,point:ip.clone(),object:e}}(e,t,r,zd,jd,Vd,np);if(c){a&&(ep.fromArray(a.buffer.array,2*s),tp.fromArray(a.buffer.array,2*o),rp.fromArray(a.buffer.array,2*l),c.uv=(h=np,d=zd,p=jd,f=Vd,m=ep,g=tp,_=rp,Yh.barycoordFromPoint(h,d,p,f,Ud),m.multiplyScalar(Ud.x),g.multiplyScalar(Ud.y),_.multiplyScalar(Ud.z),m.add(g).add(_),m.clone()));const e={a:s,b:o,c:l,normal:new bc};Yh.normal(zd,jd,Vd,e.normal),c.face=e}var h,d,p,f,m,g,_;return c}function op(e,t,r){const n=e.skeleton,i=e.geometry.attributes.skinIndex,a=e.geometry.attributes.skinWeight;Yd.fromArray(i.buffer.array,t*i.size),Zd.fromArray(a.buffer.array,t*a.size),Kd.copy(r).applyMatrix4(e.bindMatrix),r.set(0,0,0);for(let e=0;e<4;e++){const t=lp(Zd,e);if(0!==t){const i=lp(Yd,e);$d.multiplyMatrices(n.bones[i].worldMatrix,n.boneInverses[i]),r.addScaledVector(Jd.copy(Kd).applyMatrix4($d),t)}}return r.applyMatrix4(e.bindMatrixInverse)}function lp(e,t){switch(t){case 0:return e.x;case 1:return e.y;case 2:return e.z;case 3:return e.w;default:throw new Error("index is out of range: "+t)}}ap.prototype.isMesh=!0;class up{constructor(e,t=e.stride,r=0,n=!1){this.buffer=e,this.size=t,this.offset=r,this.normalized=n,this.divisor=0}copy(e){return this.buffer=e.buffer,this.size=e.size,this.offset=e.offset,this.normalized=e.normalized,this.divisor=e.divisor,this}clone(e){let t;return e?(e.has(this.buffer)||e.set(this.buffer,this.buffer.clone()),t=new up(e.get(this.buffer),this.size,this.offset,this.normalized),t.divisor=this.divisor,t):(console.warn("t3d.Attribute.clone(): now requires a WeakMap as an argument to save shared buffers."),t=new up(this.buffer.clone(),this.size,this.offset,this.normalized),t.divisor=this.divisor,t)}}let cp=class e{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Jc.STATIC_DRAW,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}copy(e){return this.array=new e.array.constructor(e.array),this.stride=e.stride,this.count=e.array.length/this.stride,this.usage=e.usage,this}clone(){const t=new this.array.constructor(this.array),r=new e(t,this.stride);return r.usage=this.usage,r}},hp=0;const dp=new bc,pp=new bc,fp=new bc,mp=new Sh,gp=new Sh;class _p extends eh{constructor(){super(),this.id=hp++,this.uuid=$h(),this.attributes={},this.morphAttributes={},this.index=null,this.boundingBox=new Sh,this.boundingSphere=new Wh,this.groups=[],this.instanceCount=-1,this.version=0}addAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}removeAttribute(e){delete this.attributes[e]}setIndex(e){if(Array.isArray(e)){const t=new(function(e){if(0===e.length)return-1/0;let t=e[0];for(let r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}(e)>65535?Uint32Array:Uint16Array)(e);this.index=new up(new cp(t,1))}else this.index=e}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}computeBoundingBox(){const e=this.attributes.a_Position||this.attributes.position,t=this.morphAttributes.position;if(this.boundingBox.setFromArray(e.buffer.array,e.buffer.stride,e.offset),t)for(let e=0;e<t.length;e++){const r=t[e];mp.setFromArray(r.buffer.array,r.buffer.stride,r.offset),dp.addVectors(this.boundingBox.min,mp.min),this.boundingBox.expandByPoint(dp),dp.addVectors(this.boundingBox.max,mp.max),this.boundingBox.expandByPoint(dp)}}computeBoundingSphere(){const e=this.attributes.a_Position||this.attributes.position,t=this.morphAttributes.position;if(t){mp.setFromArray(e.buffer.array,e.buffer.stride,e.offset);for(let e=0;e<t.length;e++){const r=t[e];gp.setFromArray(r.buffer.array,r.buffer.stride,r.offset),dp.addVectors(mp.min,gp.min),mp.expandByPoint(dp),dp.addVectors(mp.max,gp.max),mp.expandByPoint(dp)}const r=this.boundingSphere.center;mp.getCenter(r);let n=0;for(let i=0;i<e.buffer.count;i++){pp.fromArray(e.buffer.array,3*i),n=r.distanceToSquared(pp);for(let e=0;e<t.length;e++){const a=t[e];dp.fromArray(a.buffer.array,3*i),fp.addVectors(pp,dp);const s=r.distanceToSquared(fp);s>n&&(n=s,pp.add(dp))}}this.boundingSphere.radius=Math.sqrt(n)}else this.boundingSphere.setFromArray(e.buffer.array,e.buffer.stride,e.offset)}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){let t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[];const i=new WeakMap,a=e.index;null!==a&&this.setIndex(a.clone(i));const s=e.attributes;for(t in s){const e=s[t];this.addAttribute(t,e.clone(i))}const o=e.morphAttributes;for(t in o){const e=[],a=o[t];for(r=0,n=a.length;r<n;r++)e.push(a[r].clone(i));this.morphAttributes[t]=e}const l=e.groups;for(r=0,n=l.length;r<n;r++){const e=l[r];this.addGroup(e.start,e.count,e.materialIndex)}return this.boundingBox.copy(e.boundingBox),this.boundingSphere.copy(e.boundingSphere),this.instanceCount=e.instanceCount,this}clone(){return(new _p).copy(this)}}class vp extends _p{constructor(e=1,t=1,r=1,n=1){super();const i=e/2,a=t/2,s=Math.floor(r),o=Math.floor(n),l=s+1,u=o+1,c=e/s,h=t/o;let d,p;const f=[],m=[],g=[],_=[];for(p=0;p<u;p++){const e=p*h-a;for(d=0;d<l;d++){const t=d*c-i;m.push(t,0,e),g.push(0,1,0),_.push(d/s),_.push(1-p/o)}}for(p=0;p<o;p++)for(d=0;d<s;d++){const e=d+l*p,t=d+l*(p+1),r=d+1+l*(p+1),n=d+1+l*p;f.push(e,t,n),f.push(t,r,n)}this.setIndex(new up(new cp(m.length/3>65536?new Uint32Array(f):new Uint16Array(f),1))),this.addAttribute("a_Position",new up(new cp(new Float32Array(m),3))),this.addAttribute("a_Normal",new up(new cp(new Float32Array(g),3))),this.addAttribute("a_Uv",new up(new cp(new Float32Array(_),2))),this.computeBoundingBox(),this.computeBoundingSphere()}}let yp=0;class xp extends eh{constructor(){super(),this.id=yp++,this.uuid=$h(),this.type=Nc.SHADER,this.shaderName="",this.defines={},this.uniforms={},this.vertexShader="",this.fragmentShader="",this.precision=null,this.transparent=!1,this.blending=Bc.NORMAL,this.blendSrc=Oc.SRC_ALPHA,this.blendDst=Oc.ONE_MINUS_SRC_ALPHA,this.blendEquation=Ic.ADD,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.premultipliedAlpha=!1,this.vertexColors=Yc.NONE,this.vertexTangents=!1,this.opacity=1,this.diffuse=new Eh(16777215),this.diffuseMap=null,this.diffuseMapCoord=0,this.diffuseMapTransform=new Ph,this.alphaMap=null,this.alphaMapCoord=0,this.alphaMapTransform=new Ph,this.emissive=new Eh(0),this.emissiveMap=null,this.emissiveMapCoord=0,this.emissiveMapTransform=new Ph,this.aoMap=null,this.aoMapIntensity=1,this.aoMapCoord=0,this.aoMapTransform=new Ph,this.normalMap=null,this.normalScale=new xh(1,1),this.bumpMap=null,this.bumpScale=1,this.envMap=null,this.envMapIntensity=1,this.envMapCombine=Qc.MULTIPLY,this.depthFunc=Wc.LEQUAL,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.stencilTest=!1,this.stencilWriteMask=255,this.stencilFunc=Wc.ALWAYS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Hc.KEEP,this.stencilZFail=Hc.KEEP,this.stencilZPass=Hc.KEEP,this.stencilFuncBack=null,this.stencilRefBack=null,this.stencilFuncMaskBack=null,this.stencilFailBack=null,this.stencilZFailBack=null,this.stencilZPassBack=null,this.clippingPlanes=null,this.alphaTest=0,this.alphaToCoverage=!1,this.side=Lc.FRONT,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.shading=Uc.SMOOTH_SHADING,this.dithering=!1,this.acceptLight=!1,this.fog=!0,this.drawMode=Kc.TRIANGLES,this.needsUpdate=!0}copy(e){return this.shaderName=e.shaderName,this.defines=Object.assign({},e.defines),this.uniforms=nd(e.uniforms),this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.precision=e.precision,this.transparent=e.transparent,this.blending=e.blending,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.premultipliedAlpha=e.premultipliedAlpha,this.vertexColors=e.vertexColors,this.vertexTangents=e.vertexTangents,this.opacity=e.opacity,this.diffuse.copy(e.diffuse),this.diffuseMap=e.diffuseMap,this.diffuseMapCoord=e.diffuseMapCoord,this.diffuseMapTransform.copy(e.diffuseMapTransform),this.alphaMap=e.alphaMap,this.alphaMapCoord=e.alphaMapCoord,this.alphaMapTransform.copy(e.alphaMapTransform),this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveMapCoord=e.emissiveMapCoord,this.emissiveMapTransform.copy(e.emissiveMapTransform),this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.aoMapCoord=e.aoMapCoord,this.aoMapTransform.copy(e.aoMapTransform),this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.envMapCombine=e.envMapCombine,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.stencilTest=e.stencilTest,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilFuncBack=e.stencilFuncBack,this.stencilRefBack=e.stencilRefBack,this.stencilFuncMaskBack=e.stencilFuncMaskBack,this.stencilFailBack=e.stencilFailBack,this.stencilZFailBack=e.stencilZFailBack,this.stencilZPassBack=e.stencilZPassBack,this.clippingPlanes=e.clippingPlanes,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.side=e.side,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.shading=e.shading,this.dithering=e.dithering,this.acceptLight=e.acceptLight,this.fog=e.fog,this.drawMode=e.drawMode,this}clone(){return(new this.constructor).copy(this)}dispose(){this.dispatchEvent({type:"dispose"})}}class bp extends xp{constructor(e){super(),e&&(this.shaderName=e.name,Object.assign(this.defines,e.defines),this.uniforms=nd(e.uniforms),this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader)}}class Ap{constructor(e){const t=new Nd,r=this.camera=new Bd;r.frustumCulled=!1,r.position.set(0,1,0),r.lookAt(new bc(0,0,0),new bc(0,0,-1)),r.setOrtho(-1,1,-1,1,.1,2),t.add(r);const n=this.geometry=new vp(2,2,1,1),i=this.material=new bp(e);this.uniforms=i.uniforms;const a=new ap(n,i);a.frustumCulled=!1,t.add(a),t.updateMatrix(),this.renderStates=t.updateRenderStates(r);const s=t.updateRenderQueue(r,!1,!1);this.renderQueueLayer=s.layerList[0],this.renderConfig={}}render(e){e.renderRenderableList(this.renderQueueLayer.opaque,this.renderStates,this.renderConfig)}dispose(){this.geometry.dispose(),this.material.dispose()}}class Sp extends xp{constructor(){super(),this.type=Nc.DEPTH,this.packToRGBA=!1}}class Ep extends xp{constructor(){super(),this.type=Nc.DISTANCE}}class wp{constructor(){this.getDepthMaterial=Pp,this.getDistanceMaterial=Fp,this.shadowLayers=null,this.transparentShadow=!1;const e={isPointLight:!1,light:null};this._state=e;const t=this;this._renderOptions={getGeometry:null,getMaterial:function(r){return e.isPointLight?t.getDistanceMaterial(r,e.light):t.getDepthMaterial(r,e.light)},ifRender:function(e){return e.object.castShadow}}}set getGeometry(e){e?this._renderOptions.getGeometry=e:delete this._renderOptions.getGeometry}get getGeometry(){return this._renderOptions.getGeometry}set ifRender(e){e?this._renderOptions.ifRender=e:delete this._renderOptions.ifRender}get ifRender(){return this._renderOptions.ifRender}render(e,t){const r=e.renderPass;Cp.copy(r.getClearColor()),r.setClearColor(1,1,1,1);const n=t._lightData.lights,i=t._lightData.shadowsNum;for(let a=0;a<i;a++){const i=n[a],s=i.shadow;if(!1===s.autoUpdate&&!1===s.needsUpdate)continue;const o=s.camera,l=s.renderTarget,u=i.isPointLight,c=u?6:1;this._state.isPointLight=u,this._state.light=i;const h=this._renderOptions;s.prepareDepthMap(!t.disableShadowSampler,r.capabilities);for(let n=0;n<c;n++){u&&(s.update(i,n),l.activeCubeFace=n),r.setRenderTarget(l),r.clear(!0,!0);const a=t.updateRenderStates(o,0===n),c=t.updateRenderQueue(o,!1,!1);for(let t=0;t<c.layerList.length;t++){const r=c.layerList[t];null!==this.shadowLayers&&-1===this.shadowLayers.indexOf(r.id)||(e.renderRenderableList(r.opaque,a,h),this.transparentShadow&&e.renderRenderableList(r.transparent,a,h))}}s.needsUpdate=!1}r.setClearColor(Cp.x,Cp.y,Cp.z,Cp.w)}}const Cp=new Zh,Tp={front:Lc.BACK,back:Lc.FRONT,double:Lc.DOUBLE},Dp={},Mp={};function Pp(e,t){const r=!!e.object.skeleton,n=e.geometry.morphAttributes.position&&e.geometry.morphAttributes.position.length>0,i=e.material.clippingPlanes,a=i&&i.length>0?i.length:0,s=n<<0|r<<1;let o=Dp[s];void 0===o&&(o={},Dp[s]=o);let l=o[a];return void 0===l&&(l=new Sp,l.packToRGBA=!0,o[a]=l),l.side=Tp[e.material.side],l.clippingPlanes=e.material.clippingPlanes,l.drawMode=e.material.drawMode,l}function Fp(e,t){const r=!!e.object.skeleton,n=e.geometry.morphAttributes.position&&e.geometry.morphAttributes.position.length>0,i=e.material.clippingPlanes,a=i&&i.length>0?i.length:0,s=n<<0|r<<1;let o=Mp[s];void 0===o&&(o={},Mp[s]=o);let l=o[a];return void 0===l&&(l=new Ep,o[a]=l),l.side=Tp[e.material.side],l.uniforms.nearDistance=t.shadow.cameraNear,l.uniforms.farDistance=t.shadow.cameraFar,l.clippingPlanes=e.material.clippingPlanes,l.drawMode=e.material.drawMode,l}let Rp=0;class Np extends eh{constructor(){super(),this.id=Rp++,this.mipmaps=[],this.border=0,this.format=zc.RGBA,this.internalformat=null,this.type=jc.UNSIGNED_BYTE,this.magFilter=Vc.LINEAR,this.minFilter=Vc.LINEAR_MIPMAP_LINEAR,this.wrapS=Gc.CLAMP_TO_EDGE,this.wrapT=Gc.CLAMP_TO_EDGE,this.anisotropy=1,this.compare=void 0,this.generateMipmaps=!0,this.encoding=Xc.LINEAR,this.flipY=!0,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.version=0}clone(){return(new this.constructor).copy(this)}copy(e){return this.mipmaps=e.mipmaps.slice(0),this.border=e.border,this.format=e.format,this.internalformat=e.internalformat,this.type=e.type,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.anisotropy=e.anisotropy,this.compare=e.compare,this.generateMipmaps=e.generateMipmaps,this.encoding=e.encoding,this.flipY=e.flipY,this.premultiplyAlpha=e.premultiplyAlpha,this.unpackAlignment=e.unpackAlignment,this.version=e.version,this}dispose(){this.dispatchEvent({type:"dispose"}),this.version=0}}Np.prototype.isTexture=!0;class Bp extends Np{constructor(){super(),this.image=null}copy(e){return super.copy(e),this.image=e.image,this}}Bp.prototype.isTexture2D=!0;class Ip extends Np{constructor(){super(),this.images=[],this.flipY=!1}copy(e){return super.copy(e),this.images=e.images.slice(0),this}}Ip.prototype.isTextureCube=!0;class Op extends Np{constructor(){super(),this.image={data:new Uint8Array([255,255,255,255,255,255,255,255]),width:2,height:2,depth:2},this.wrapR=Gc.CLAMP_TO_EDGE,this.format=zc.RED,this.type=jc.UNSIGNED_BYTE,this.magFilter=Vc.NEAREST,this.minFilter=Vc.NEAREST,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}copy(e){return super.copy(e),this.image=e.image,this}}Op.prototype.isTexture3D=!0;const kp={u_Model:[1,null],u_Projection:[2,function(e){this.set(e.projectionMatrix.elements)}],u_View:[2,function(e){this.set(e.viewMatrix.elements)}],u_ProjectionView:[2,function(e){this.set(e.projectionViewMatrix.elements)}],u_CameraPosition:[2,function(e){this.setValue(e.position.x,e.position.y,e.position.z)}],logDepthBufFC:[2,function(e){this.set(e.logDepthBufFC)}],logDepthCameraNear:[2,function(e){this.set(e.logDepthCameraNear)}],u_EnvMapLight_Intensity:[3,function(e){this.set(e.environmentLightIntensity)}],u_FogColor:[3,function(e){const t=e.fog.color;this.setValue(t.r,t.g,t.b)}],u_FogDensity:[3,function(e){this.set(e.fog.density)}],u_FogNear:[3,function(e){this.set(e.fog.near)}],u_FogFar:[3,function(e){this.set(e.fog.far)}],u_Color:[4,function(e,t){const r=e.diffuse;this.setValue(r.r,r.g,r.b)}],u_Opacity:[4,function(e,t){this.set(e.opacity)}],diffuseMap:[4,function(e,t){this.set(e.diffuseMap,t)}],alphaMap:[4,function(e,t){this.set(e.alphaMap,t)}],alphaMapUVTransform:[4,function(e,t){this.set(e.alphaMapTransform.elements)}],normalMap:[4,function(e,t){this.set(e.normalMap,t)}],normalScale:[4,function(e,t){this.setValue(e.normalScale.x,e.normalScale.y)}],bumpMap:[4,function(e,t){this.set(e.bumpMap,t)}],bumpScale:[4,function(e,t){this.set(e.bumpScale)}],cubeMap:[4,function(e,t){this.set(e.cubeMap,t)}],u_EnvMap_Intensity:[4,function(e,t){this.set(e.envMapIntensity)}],u_Specular:[4,function(e,t){this.set(e.shininess)}],u_SpecularColor:[4,function(e,t){const r=e.specular;this.setValue(r.r,r.g,r.b)}],specularMap:[4,function(e,t){this.set(e.specularMap,t)}],aoMap:[4,function(e,t){this.set(e.aoMap,t)}],aoMapIntensity:[4,function(e,t){this.set(e.aoMapIntensity)}],aoMapUVTransform:[4,function(e,t){this.set(e.aoMapTransform.elements)}],u_Roughness:[4,function(e,t){this.set(e.roughness)}],roughnessMap:[4,function(e,t){this.set(e.roughnessMap,t)}],u_Metalness:[4,function(e,t){this.set(e.metalness)}],metalnessMap:[4,function(e,t){this.set(e.metalnessMap,t)}],u_Clearcoat:[4,function(e,t){this.set(e.clearcoat)}],u_ClearcoatRoughness:[4,function(e,t){this.set(e.clearcoatRoughness)}],clearcoatMap:[4,function(e,t){this.set(e.clearcoatMap,t)}],clearcoatRoughnessMap:[4,function(e,t){this.set(e.clearcoatRoughnessMap,t)}],clearcoatNormalMap:[4,function(e,t){this.set(e.clearcoatNormalMap,t)}],clearcoatNormalScale:[4,function(e,t){this.setValue(e.clearcoatNormalScale.x,e.clearcoatNormalScale.y)}],glossiness:[4,function(e,t){this.set(e.glossiness)}],glossinessMap:[4,function(e,t){this.set(e.glossinessMap,t)}],emissive:[4,function(e,t){const r=e.emissive;this.setValue(r.r,r.g,r.b)}],emissiveMap:[4,function(e,t){this.set(e.emissiveMap,t)}],emissiveMapUVTransform:[4,function(e,t){this.set(e.emissiveMapTransform.elements)}],matcap:[4,function(e,t){this.set(e.matcap,t)}],uvTransform:[4,function(e,t){this.set(e.diffuseMapTransform.elements)}],u_PointSize:[4,function(e,t){this.set(e.size)}],u_PointScale:[5,null],maxMipLevel:[5,function(e,t){this.set(t.get(e).__maxMipLevel||8)}],envMap:[5,function(e,t){this.set(e,t)}],u_EnvMap_Flip:[5,function(e,t){this.set(e.images[0]&&e.images[0].rtt?1:-1)}]},Lp=new Bp;Lp.image={data:new Uint8Array([1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1]),width:2,height:2},Lp.magFilter=Vc.NEAREST,Lp.minFilter=Vc.NEAREST,Lp.generateMipmaps=!1,Lp.version++;const Up=new Bp;Up.image={data:null,width:2,height:2},Up.version++,Up.type=jc.FLOAT_32_UNSIGNED_INT_24_8_REV,Up.format=zc.DEPTH_STENCIL,Up.magFilter=Vc.NEAREST,Up.minFilter=Vc.NEAREST,Up.compare=Wc.LESS,Up.generateMipmaps=!1,Up.version++;const zp=new Op,jp=new Ip;function Vp(e,t){if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function Gp(e,t){for(let r=0,n=t.length;r<n;r++)e[r]=t[r]}const Wp=[];function Hp(e,t){let r=Wp[t];void 0===r&&(r=new Int32Array(t),Wp[t]=r);for(let n=0;n!==t;++n)r[n]=e.allocTexUnit();return r}function qp(e,t){const r=e.gl,n=e.type,i=e.location,a=e.cache;switch(n){case r.FLOAT:e.setValue=function(e){a[0]!==e&&(r.uniform1f(i,e),a[0]=e)},e.set=t?function(e){Vp(a,e)||(r.uniform1fv(i,e),Gp(a,e))}:e.setValue;break;case r.SAMPLER_2D:case r.SAMPLER_2D_SHADOW:e.setValue=function(e,t){const s=t.allocTexUnit();t.setTexture2D(e||(n===r.SAMPLER_2D_SHADOW?Up:Lp),s),a[0]!==s&&(r.uniform1i(i,s),a[0]=s)},e.set=t?function(e,t){const s=e.length,o=Hp(t,s);for(let i=0;i!==s;++i)t.setTexture2D(e[i]||(n===r.SAMPLER_2D_SHADOW?Up:Lp),o[i]);Vp(a,o)||(r.uniform1iv(i,o),Gp(a,o))}:e.setValue;break;case r.SAMPLER_CUBE:case r.SAMPLER_CUBE_SHADOW:e.setValue=function(e,t){const n=t.allocTexUnit();t.setTextureCube(e||jp,n),a[0]!==n&&(r.uniform1i(i,n),a[0]=n)},e.set=t?function(e,t){const n=e.length,s=Hp(t,n);for(let r=0;r!==n;++r)t.setTextureCube(e[r]||jp,s[r]);Vp(a,s)||(r.uniform1iv(i,s),Gp(a,s))}:e.setValue;break;case r.SAMPLER_3D:e.setValue=function(e,t){const n=t.allocTexUnit();t.setTexture3D(e||zp,n),a[0]!==n&&(r.uniform1i(i,n),a[0]=n)},e.set=t?function(e,t){const n=e.length,s=Hp(t,n);for(let r=0;r!==n;++r)t.setTexture3D(e[r]||zp,s[r]);Vp(a,s)||(r.uniform1iv(i,s),Gp(a,s))}:e.setValue;break;case r.BOOL:case r.INT:e.setValue=function(e){a[0]!==e&&(r.uniform1i(i,e),a[0]=e)},e.set=t?function(e){Vp(a,e)||(r.uniform1iv(i,e),Gp(a,e))}:e.setValue;break;case r.FLOAT_VEC2:e.setValue=function(e,t){a[0]===e&&a[1]===t||(r.uniform2f(i,e,t),a[0]=e,a[1]=t)},e.set=function(e){Vp(a,e)||(r.uniform2fv(i,e),Gp(a,e))};break;case r.BOOL_VEC2:case r.INT_VEC2:e.setValue=function(e,t){a[0]===e&&a[1]===t||(r.uniform2i(i,e,t),a[0]=e,a[1]=t)},e.set=function(e){Vp(a,e)||(r.uniform2iv(i,e),Gp(a,e))};break;case r.FLOAT_VEC3:e.setValue=function(e,t,n){a[0]===e&&a[1]===t&&a[2]===n||(r.uniform3f(i,e,t,n),a[0]=e,a[1]=t,a[2]=n)},e.set=function(e){Vp(a,e)||(r.uniform3fv(i,e),Gp(a,e))};break;case r.BOOL_VEC3:case r.INT_VEC3:e.setValue=function(e,t,n){a[0]===e&&a[1]===t&&a[2]===n||(r.uniform3i(i,e,t,n),a[0]=e,a[1]=t,a[2]=n)},e.set=function(e){Vp(a,e)||(r.uniform3iv(i,e),Gp(a,e))};break;case r.FLOAT_VEC4:e.setValue=function(e,t,n,s){a[0]===e&&a[1]===t&&a[2]===n&&a[3]===s||(r.uniform4f(i,e,t,n,s),a[0]=e,a[1]=t,a[2]=n,a[3]=s)},e.set=function(e){Vp(a,e)||(r.uniform4fv(i,e),Gp(a,e))};break;case r.BOOL_VEC4:case r.INT_VEC4:e.setValue=function(e,t,n,s){a[0]===e&&a[1]===t&&a[2]===n&&a[3]===s||(r.uniform4i(i,e,t,n,s),a[0]=e,a[1]=t,a[2]=n,a[3]=s)},e.set=function(e){Vp(a,e)||(r.uniform4iv(i,e),Gp(a,e))};break;case r.FLOAT_MAT2:e.setValue=e.set=t?function(e){Vp(a,e)||(r.uniformMatrix2fv(i,!1,e),Gp(a,e))}:function(e){a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]||(r.uniformMatrix2fv(i,!1,e),a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3])};break;case r.FLOAT_MAT3:e.setValue=e.set=t?function(e){Vp(a,e)||(r.uniformMatrix3fv(i,!1,e),Gp(a,e))}:function(e){a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]&&a[4]===e[4]&&a[5]===e[5]&&a[6]===e[6]&&a[7]===e[7]&&a[8]===e[8]||(r.uniformMatrix3fv(i,!1,e),a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[8]=e[8])};break;case r.FLOAT_MAT4:e.setValue=e.set=t?function(e){Vp(a,e)||(r.uniformMatrix4fv(i,!1,e),Gp(a,e))}:function(e){a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]&&a[4]===e[4]&&a[5]===e[5]&&a[6]===e[6]&&a[7]===e[7]&&a[8]===e[8]&&a[9]===e[9]&&a[10]===e[10]&&a[11]===e[11]&&a[12]===e[12]&&a[13]===e[13]&&a[14]===e[14]&&a[15]===e[15]||(r.uniformMatrix4fv(i,!1,e),a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15])}}}class Xp{constructor(e,t,r,n){this.gl=e,this.id=t,this.type=r.type,this.location=n,this.setValue=void 0,this.set=void 0,this.cache=[],qp(this),this.internalGroup=0,this.internalFun=null;const i=kp[t];i&&(this.internalGroup=i[0],this.internalFun=i[1])}}class Qp{constructor(e,t,r,n){this.gl=e,this.id=t,this.type=r.type,this.size=r.size,this.location=n,this.setValue=void 0,this.set=void 0,this.cache=[],qp(this,!0)}}class Kp{constructor(){this.seq=[],this.map={}}}class Yp extends Kp{constructor(e){super(),this.id=e}set(e,t){const r=this.seq;for(let n=0,i=r.length;n!==i;++n){const i=r[n];i.set(e[i.id],t)}}}const Zp=/(\w+)(\])?(\[|\.)?/g;function Jp(e,t){e.seq.push(t),e.map[t.id]=t}function $p(e,t,r,n){const i=t.name,a=i.length;for(Zp.lastIndex=0;;){const s=Zp.exec(i),o=Zp.lastIndex;let l=s[1];const u="]"===s[2],c=s[3];if(u&&(l|=0),void 0===c||"["===c&&o+2===a){Jp(n,void 0===c?new Xp(e,l,t,r):new Qp(e,l,t,r));break}{let e=n.map[l];void 0===e&&(e=new Yp(l),Jp(n,e)),n=e}}}class ef extends Kp{constructor(e,t){super();const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<r;++n){const r=e.getActiveUniform(t,n),i=e.getUniformLocation(t,r.name);$p(e,r,i,this)}}set(e,t,r){const n=this.map[e];void 0!==n&&n.set(t,r)}has(e){return!!this.map[e]}}class tf{constructor(e,t,r){this.gl=e,this.name=r.name,this.type=r.type,this.size=r.size,this.location=e.getAttribLocation(t,this.name),this.count=function(e,t){switch(t){case e.FLOAT:case e.BYTE:case e.UNSIGNED_BYTE:case e.UNSIGNED_SHORT:return 1;case e.FLOAT_VEC2:return 2;case e.FLOAT_VEC3:return 3;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 4;case e.FLOAT_MAT3:return 9;case e.FLOAT_MAT4:return 16;default:return 0}}(e,this.type),this.format=function(e,t){switch(t){case e.FLOAT:case e.FLOAT_VEC2:case e.FLOAT_VEC3:case e.FLOAT_VEC4:case e.FLOAT_MAT2:case e.FLOAT_MAT3:case e.FLOAT_MAT4:return e.FLOAT;case e.UNSIGNED_BYTE:return e.UNSIGNED_BYTE;case e.UNSIGNED_SHORT:return e.UNSIGNED_SHORT;case e.BYTE:return e.BYTE;default:return e.FLOAT}}(e,this.type),this.locationSize=1,this.type===e.FLOAT_MAT2&&(this.locationSize=2),this.type===e.FLOAT_MAT3&&(this.locationSize=3),this.type===e.FLOAT_MAT4&&(this.locationSize=4)}}let rf=0;class nf{constructor(e,t,r){let n,i,a;this.gl=e,this.vshaderSource=t,this.fshaderSource=r,this.id=rf++,this.usedTimes=1,this.code="",this.lightId=-1,this.lightVersion=-1,this.cameraId=-1,this.cameraVersion=-1,this.sceneId=-1,this.sceneVersion=-1,this.program,this.compile=function(i){const a=af(e,e.VERTEX_SHADER,t),s=af(e,e.FRAGMENT_SHADER,r);if(n=e.createProgram(),e.attachShader(n,a),e.attachShader(n,s),e.linkProgram(n),i&&!1===e.getProgramParameter(n,e.LINK_STATUS)){const t=e.getProgramInfoLog(n).trim(),r=sf(e,a,"VERTEX"),i=sf(e,s,"FRAGMENT");console.error("Shader Error "+e.getError()+" - VALIDATE_STATUS "+e.getProgramParameter(n,e.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+r+"\n"+i)}else this.program=n;e.deleteShader(a),e.deleteShader(s)},this.getUniforms=function(){return void 0===i&&(i=new ef(e,n)),i},this.getAttributes=function(){return void 0===a&&(a=function(e,t){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const n=e.getActiveAttrib(t,i);r[n.name]=new tf(e,t,n)}return r}(e,n)),a},this.dispose=function(){e.deleteProgram(n),this.program=void 0}}}function af(e,t,r){const n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}function sf(e,t,r){const n=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(n&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const n=parseInt(a[1]);return r+"\n\n"+i+"\n\n"+function(e,t){const r=e.split("\n"),n=[],i=Math.max(t-6,0),a=Math.min(t+6,r.length);for(let e=i;e<a;e++){const i=e+1;n.push(`${i===t?">":" "} ${i}: ${r[e]}`)}return n.join("\n")}(e.getShaderSource(t),n)}return i}const of={alphaTest_frag:"#ifdef ALPHATEST\n\tif ( outColor.a < ALPHATEST ) {\n\t\tdiscard;\n\t} else {\n\t\toutColor.a = u_Opacity;\n\t}\n#endif",aoMap_pars_frag:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\tvarying vec2 vAOMapUV;\n#endif",aoMap_pars_vert:"#ifdef USE_AOMAP\n\tuniform mat3 aoMapUVTransform;\n\tvarying vec2 vAOMapUV;\n#endif",aoMap_vert:"#ifdef USE_AOMAP\n\t#if (USE_AOMAP == 2)\n        vAOMapUV = (aoMapUVTransform * vec3(a_Uv2, 1.)).xy;\n    #else\n        vAOMapUV = (aoMapUVTransform * vec3(a_Uv, 1.)).xy;\n    #endif\n#endif",aoMap_frag:"\n#ifdef USE_AOMAP\n    float ambientOcclusion = (texture2D(aoMap, vAOMapUV).r - 1.0) * aoMapIntensity + 1.0;\n    \n    reflectedLight.indirectDiffuse *= ambientOcclusion;\n    #if defined(USE_ENV_MAP) && defined(USE_PBR)\n        float dotNV = saturate(dot(N, V));\n        reflectedLight.indirectSpecular *= computeSpecularOcclusion(dotNV, ambientOcclusion, GGXRoughnessToBlinnExponent(roughness));\n    #endif\n#endif",begin_frag:"vec4 outColor = vec4(u_Color, u_Opacity);",begin_vert:"vec3 transformed = vec3(a_Position);\nvec3 objectNormal = vec3(a_Normal);\n#ifdef USE_TANGENT\n    vec3 objectTangent = vec3(a_Tangent.xyz);\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nvec3 BRDF_Diffuse_Lambert(vec3 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent(const in vec3 F0, const in float dotNV, const in float roughness) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nvec3 BRDF_Specular_BlinnPhong(vec3 specularColor, vec3 N, vec3 L, vec3 V, float shininess) {\n    vec3 H = normalize(L + V);\n    float dotNH = saturate(dot(N, H));\n    float dotLH = saturate(dot(L, H));\n    vec3 F = F_Schlick(specularColor, dotLH);\n    float G = G_BlinnPhong_Implicit( );\n    float D = D_BlinnPhong(shininess, dotNH);\n    return F * G * D;\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nvec3 BRDF_Specular_GGX(vec3 specularColor, vec3 N, vec3 L, vec3 V, float roughness) {\n\tfloat alpha = pow2( roughness );\n\tvec3 H = normalize(L + V);\n\tfloat dotNL = saturate( dot(N, L) );\n\tfloat dotNV = saturate( dot(N, V) );\n\tfloat dotNH = saturate( dot(N, H) );\n\tfloat dotLH = saturate( dot(L, H) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * G * D;\n}\nvec3 BRDF_Specular_GGX_Environment(const in vec3 N, const in vec3 V, const in vec3 specularColor, const in float roughness) {\n\tfloat dotNV = saturate(dot(N, V));\n\tvec2 brdf = integrateSpecularBRDF(dotNV, roughness);\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment(const in vec3 N, const in vec3 V, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {\n\tfloat dotNV = saturate(dot(N, V));\n\tvec3 F = F_Schlick_RoughnessDependent(specularColor, dotNV, roughness);\n\tvec2 brdf = integrateSpecularBRDF(dotNV, roughness);\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + (1.0 - specularColor) * 0.047619;\tvec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpMap_pars_frag:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd(vec2 uv) {\n\t\tvec2 dSTdx = dFdx( uv );\n\t\tvec2 dSTdy = dFdy( uv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, uv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, uv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, uv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clippingPlanes_frag:"\n#if NUM_CLIPPING_PLANES > 0\n    vec4 plane;\n    #pragma unroll_loop_start\n    for (int i = 0; i < NUM_CLIPPING_PLANES; i++) {\n        plane = clippingPlanes[i];\n        if ( dot( -v_modelPos, plane.xyz ) > plane.w ) discard;\n    }\n    #pragma unroll_loop_end\n#endif",clippingPlanes_pars_frag:"#if NUM_CLIPPING_PLANES > 0\n    uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",color_frag:"#ifdef USE_VCOLOR_RGB\n    outColor.rgb *= v_Color;\n#endif\n#ifdef USE_VCOLOR_RGBA\n    outColor *= v_Color;\n#endif",color_pars_frag:"#ifdef USE_VCOLOR_RGB\n    varying vec3 v_Color;\n#endif\n#ifdef USE_VCOLOR_RGBA\n    varying vec4 v_Color;\n#endif",color_pars_vert:"#ifdef USE_VCOLOR_RGB\n    attribute vec3 a_Color;\n    varying vec3 v_Color;\n#endif\n#ifdef USE_VCOLOR_RGBA\n    attribute vec4 a_Color;\n    varying vec4 v_Color;\n#endif",color_vert:"#if defined(USE_VCOLOR_RGB) || defined(USE_VCOLOR_RGBA)\n    v_Color = a_Color;\n#endif",common_frag:"uniform mat4 u_View;\nuniform float u_Opacity;\nuniform vec3 u_Color;\nuniform vec3 u_CameraPosition;\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};",common_vert:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\n#ifdef USE_TANGENT\n\tattribute vec4 a_Tangent;\n#endif\n#include <transpose>\n#include <inverse>\nuniform mat4 u_Projection;\nuniform mat4 u_View;\nuniform mat4 u_Model;\nuniform mat4 u_ProjectionView;\nuniform vec3 u_CameraPosition;\n#define EPSILON 1e-6\n#ifdef USE_MORPHTARGETS\n    attribute vec3 morphTarget0;\n    attribute vec3 morphTarget1;\n    attribute vec3 morphTarget2;\n    attribute vec3 morphTarget3;\n    #ifdef USE_MORPHNORMALS\n    \tattribute vec3 morphNormal0;\n    \tattribute vec3 morphNormal1;\n    \tattribute vec3 morphNormal2;\n    \tattribute vec3 morphNormal3;\n    #else\n    \tattribute vec3 morphTarget4;\n    \tattribute vec3 morphTarget5;\n    \tattribute vec3 morphTarget6;\n    \tattribute vec3 morphTarget7;\n    #endif\n#endif\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}",diffuseMap_frag:"#ifdef USE_DIFFUSE_MAP\n    #if (USE_DIFFUSE_MAP == 2)\n        vec4 texelColor = texture2D(diffuseMap, v_Uv2);\n    #else \n        vec4 texelColor = texture2D(diffuseMap, v_Uv);\n    #endif\n    \n    texelColor = mapTexelToLinear(texelColor);\n    outColor *= texelColor;\n#endif",diffuseMap_pars_frag:"#ifdef USE_DIFFUSE_MAP\n    uniform sampler2D diffuseMap;\n#endif",emissiveMap_frag:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D(emissiveMap, vEmissiveMapUV);\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissiveMap_pars_frag:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n\tvarying vec2 vEmissiveMapUV;\n#endif",emissiveMap_vert:"#ifdef USE_EMISSIVEMAP\n\t#if (USE_EMISSIVEMAP == 2)\n        vEmissiveMapUV = (emissiveMapUVTransform * vec3(a_Uv2, 1.)).xy;\n    #else\n        vEmissiveMapUV = (emissiveMapUVTransform * vec3(a_Uv, 1.)).xy;\n    #endif\n#endif",emissiveMap_pars_vert:"#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapUVTransform;\n\tvarying vec2 vEmissiveMapUV;\n#endif",encodings_frag:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_frag:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}",end_frag:"gl_FragColor = outColor;",envMap_frag:"#ifdef USE_ENV_MAP\n    vec3 envDir;\n    #ifdef USE_VERTEX_ENVDIR\n        envDir = v_EnvDir;\n    #else\n        envDir = reflect(normalize(v_modelPos - u_CameraPosition), N);\n    #endif\n    vec4 envColor = textureCube(envMap, vec3(u_EnvMap_Flip * envDir.x, envDir.yz));\n    envColor = envMapTexelToLinear( envColor );\n    #ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutColor = mix(outColor, envColor * outColor, u_EnvMap_Intensity);\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutColor = mix(outColor, envColor, u_EnvMap_Intensity);\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutColor += envColor * u_EnvMap_Intensity;\n\t#endif\n#endif",envMap_pars_frag:"#ifdef USE_ENV_MAP\n    #ifdef USE_VERTEX_ENVDIR\n        varying vec3 v_EnvDir;\n    #endif\n    uniform samplerCube envMap;\n    uniform float u_EnvMap_Flip;\n    uniform float u_EnvMap_Intensity;\n    uniform float u_EnvMapLight_Intensity;\n    uniform int maxMipLevel;\n#endif",envMap_pars_vert:"#ifdef USE_ENV_MAP\n    #ifdef USE_VERTEX_ENVDIR\n        varying vec3 v_EnvDir;\n    #endif\n#endif",envMap_vert:"\n#ifdef USE_ENV_MAP\n    #ifdef USE_VERTEX_ENVDIR\n        vec3 transformedNormal = (transposeMat4(inverseMat4(u_Model)) * vec4(objectNormal, 0.0)).xyz;\n        transformedNormal = normalize(transformedNormal);\n        v_EnvDir = reflect(normalize(worldPosition.xyz - u_CameraPosition), transformedNormal);\n    #endif\n#endif",fog_frag:"#ifdef USE_FOG\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    #ifdef USE_EXP2_FOG\n        float fogFactor = 1.0 - exp(-u_FogDensity * u_FogDensity * depth * depth);\n    #else\n        float fogFactor = smoothstep(u_FogNear, u_FogFar, depth);\n    #endif\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, fogFactor);\n#endif",fog_pars_frag:"#ifdef USE_FOG\n    uniform vec3 u_FogColor;\n    #ifdef USE_EXP2_FOG\n        uniform float u_FogDensity;\n    #else\n        uniform float u_FogNear;\n        uniform float u_FogFar;\n    #endif\n#endif",inverse:"mat4 inverseMat4(mat4 m) {\n    float\n    a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    return mat4(\n        a11 * b11 - a12 * b10 + a13 * b09,\n        a02 * b10 - a01 * b11 - a03 * b09,\n        a31 * b05 - a32 * b04 + a33 * b03,\n        a22 * b04 - a21 * b05 - a23 * b03,\n        a12 * b08 - a10 * b11 - a13 * b07,\n        a00 * b11 - a02 * b08 + a03 * b07,\n        a32 * b02 - a30 * b05 - a33 * b01,\n        a20 * b05 - a22 * b02 + a23 * b01,\n        a10 * b10 - a11 * b08 + a13 * b06,\n        a01 * b08 - a00 * b10 - a03 * b06,\n        a30 * b04 - a31 * b02 + a33 * b00,\n        a21 * b02 - a20 * b04 - a23 * b00,\n        a11 * b07 - a10 * b09 - a12 * b06,\n        a00 * b09 - a01 * b07 + a02 * b06,\n        a31 * b01 - a30 * b03 - a32 * b00,\n        a20 * b03 - a21 * b01 + a22 * b00) / det;\n}",light_frag:"\n#if (defined(USE_PHONG) || defined(USE_PBR))\n    vec3 V = normalize(u_CameraPosition - v_modelPos);\n#endif\n#ifdef USE_PBR\n    #ifdef USE_PBR2\n        vec3 diffuseColor = outColor.xyz;\n        vec3 specularColor = specularFactor.xyz;\n        float roughness = max(1.0 - glossinessFactor, 0.0525);\n    #else\n        vec3 diffuseColor = outColor.xyz * (1.0 - metalnessFactor);\n        vec3 specularColor = mix(vec3(0.04), outColor.xyz, metalnessFactor);\n        float roughness = max(roughnessFactor, 0.0525);\n    #endif\n    vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));\n    float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\n    roughness += geometryRoughness;\n    roughness = min(roughness, 1.0);\n    #ifdef USE_CLEARCOAT\n        float clearcoat = u_Clearcoat;\n        float clearcoatRoughness = u_ClearcoatRoughness;\n        #ifdef USE_CLEARCOATMAP\n\t\t    clearcoat *= texture2D(clearcoatMap, v_Uv).x;\n        #endif\n        #ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\t    clearcoatRoughness *= texture2D(clearcoatRoughnessMap, v_Uv).y;\n\t    #endif\n        clearcoat = saturate(clearcoat);\n        clearcoatRoughness = max(clearcoatRoughness, 0.0525);\n\t    clearcoatRoughness += geometryRoughness;\n\t    clearcoatRoughness = min(clearcoatRoughness, 1.0);\n    #endif\n#else\n    vec3 diffuseColor = outColor.xyz;\n    #ifdef USE_PHONG\n        vec3 specularColor = u_SpecularColor.xyz;\n        float shininess = u_Specular;\n    #endif\n#endif\n#ifdef USE_LIGHT\n    vec3 L;\n    float falloff;\n    float dotNL;\n    vec3 irradiance;\n    float clearcoatDHR;\n    #ifdef USE_CLEARCOAT\n        float ccDotNL;\n        vec3 ccIrradiance;\n    #endif\n    #if NUM_DIR_LIGHTS > 0\n        #pragma unroll_loop_start\n        for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n            L = normalize(-u_Directional[i].direction);\n            falloff = 1.0;\n            #if defined(USE_SHADOW) && (UNROLLED_LOOP_INDEX < NUM_DIR_SHADOWS)\n                #ifdef USE_PCSS_SOFT_SHADOW\n                    falloff *= getShadowWithPCSS(directionalDepthMap[i], directionalShadowMap[i], vDirectionalShadowCoord[i], u_DirectionalShadow[i].shadowMapSize, u_DirectionalShadow[i].shadowBias, u_DirectionalShadow[i].shadowParams);\n                #else\n                    falloff *= getShadow(directionalShadowMap[i], vDirectionalShadowCoord[i], u_DirectionalShadow[i].shadowMapSize, u_DirectionalShadow[i].shadowBias, u_DirectionalShadow[i].shadowParams);\n                #endif\n            #endif\n            dotNL = saturate(dot(N, L));\n            irradiance = u_Directional[i].color * falloff * dotNL * PI;\n            #ifdef USE_CLEARCOAT        \n                ccDotNL = saturate(dot(clearcoatNormal, L));\n                ccIrradiance = ccDotNL * u_Directional[i].color * falloff  * PI;\n                clearcoatDHR = clearcoat * clearcoatDHRApprox(clearcoatRoughness, ccDotNL);\n                reflectedLight.directSpecular += ccIrradiance * clearcoat * BRDF_Specular_GGX(specularColor, clearcoatNormal, L, V, clearcoatRoughness);\n            #else\n\t\t        clearcoatDHR = 0.0;\n\t        #endif\n            reflectedLight.directDiffuse += (1.0 - clearcoatDHR) * irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n            #ifdef USE_PHONG\n                reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n            #endif\n            #ifdef USE_PBR\n                reflectedLight.directSpecular += (1.0 - clearcoatDHR) * irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness);\n            #endif\n        }\n        #pragma unroll_loop_end\n    #endif\n    #if NUM_POINT_LIGHTS > 0\n        vec3 worldV;\n        #pragma unroll_loop_start\n        for (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n            worldV = v_modelPos - u_Point[i].position;\n            L = -worldV;\n            falloff = pow(clamp(1. - length(L) / u_Point[i].distance, 0.0, 1.0), u_Point[i].decay);\n            L = normalize(L);\n            #if defined(USE_SHADOW) && (UNROLLED_LOOP_INDEX < NUM_POINT_SHADOWS)\n                falloff *= getPointShadow(pointShadowMap[i], vPointShadowCoord[i], u_PointShadow[i].shadowMapSize, u_PointShadow[i].shadowBias, u_PointShadow[i].shadowParams, u_PointShadow[i].shadowCameraRange);\n            #endif\n            dotNL = saturate(dot(N, L));\n            irradiance = u_Point[i].color * falloff * dotNL * PI;\n            #ifdef USE_CLEARCOAT        \n                ccDotNL = saturate(dot(clearcoatNormal, L));\n                ccIrradiance = ccDotNL *  u_Point[i].color * falloff  * PI;\n                clearcoatDHR = clearcoat * clearcoatDHRApprox(clearcoatRoughness, ccDotNL);\n                reflectedLight.directSpecular += ccIrradiance * clearcoat * BRDF_Specular_GGX(specularColor, clearcoatNormal, L, V, clearcoatRoughness);\n            #else\n\t\t        clearcoatDHR = 0.0;\n\t        #endif\n            reflectedLight.directDiffuse += (1.0 - clearcoatDHR) * irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n            #ifdef USE_PHONG\n                reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n            #endif\n            #ifdef USE_PBR\n                reflectedLight.directSpecular += (1.0 - clearcoatDHR) * irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness);\n            #endif\n        }\n        #pragma unroll_loop_end\n    #endif\n    #if NUM_SPOT_LIGHTS > 0\n        float lightDistance;\n        float angleCos;\n        #pragma unroll_loop_start\n        for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n            L = u_Spot[i].position - v_modelPos;\n            lightDistance = length(L);\n            L = normalize(L);\n            angleCos = dot(L, -normalize(u_Spot[i].direction));\n            falloff = smoothstep(u_Spot[i].coneCos, u_Spot[i].penumbraCos, angleCos);\n            falloff *= pow(clamp(1. - lightDistance / u_Spot[i].distance, 0.0, 1.0), u_Spot[i].decay);\n            #if defined(USE_SHADOW) && (UNROLLED_LOOP_INDEX < NUM_SPOT_SHADOWS)\n                #ifdef USE_PCSS_SOFT_SHADOW\n                    falloff *= getShadowWithPCSS(spotDepthMap[i], spotShadowMap[i], vSpotShadowCoord[i], u_SpotShadow[i].shadowMapSize, u_SpotShadow[i].shadowBias, u_SpotShadow[i].shadowParams);\n                #else\n                    falloff *= getShadow(spotShadowMap[i], vSpotShadowCoord[i], u_SpotShadow[i].shadowMapSize, u_SpotShadow[i].shadowBias, u_SpotShadow[i].shadowParams);\n                #endif\n            #endif\n            dotNL = saturate(dot(N, L));\n            irradiance = u_Spot[i].color * falloff * dotNL * PI;\n            #ifdef USE_CLEARCOAT        \n                ccDotNL = saturate(dot(clearcoatNormal, L));\n                ccIrradiance = ccDotNL *  u_Spot[i].color * falloff  * PI;\n                clearcoatDHR = clearcoat * clearcoatDHRApprox(clearcoatRoughness, ccDotNL);\n                reflectedLight.directSpecular += ccIrradiance * clearcoat * BRDF_Specular_GGX(specularColor, clearcoatNormal, L, V, clearcoatRoughness);\n            #else\n\t\t        clearcoatDHR = 0.0;\n\t        #endif\n            reflectedLight.directDiffuse += (1.0 - clearcoatDHR) * irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n            #ifdef USE_PHONG\n                reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n            #endif\n            #ifdef USE_PBR\n                reflectedLight.directSpecular += (1.0 - clearcoatDHR) * irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness);\n            #endif\n        }\n        #pragma unroll_loop_end\n    #endif\n    vec3 iblIrradiance = vec3(0., 0., 0.);\n    vec3 indirectIrradiance = vec3(0., 0., 0.);\n    vec3 indirectRadiance = vec3(0., 0., 0.);\n    vec3 clearcoatRadiance = vec3(0., 0., 0.);\n    #ifdef USE_AMBIENT_LIGHT\n        indirectIrradiance += u_AmbientLightColor * PI;\n    #endif\n    #if NUM_HEMI_LIGHTS > 0\n        float hemiDiffuseWeight;\n        #pragma unroll_loop_start\n        for (int i = 0; i < NUM_HEMI_LIGHTS; i++) {\n            L = normalize(u_Hemi[i].direction);\n            dotNL = dot(N, L);\n            hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n            indirectIrradiance += mix(u_Hemi[i].groundColor, u_Hemi[i].skyColor, hemiDiffuseWeight) * PI;\n        }\n        #pragma unroll_loop_end\n    #endif\n    #if defined(USE_ENV_MAP) && defined(USE_PBR)\n        vec3 envDir;\n        #ifdef USE_VERTEX_ENVDIR\n            envDir = v_EnvDir;\n        #else\n            envDir = reflect(normalize(v_modelPos - u_CameraPosition), N);\n        #endif\n        iblIrradiance += getLightProbeIndirectIrradiance(maxMipLevel, N);\n        indirectRadiance += getLightProbeIndirectRadiance(GGXRoughnessToBlinnExponent(roughness), maxMipLevel, envDir);\n        #ifdef USE_CLEARCOAT\n            vec3 clearcoatDir = reflect(normalize(v_modelPos - u_CameraPosition), clearcoatNormal);\n\t\t    clearcoatRadiance += getLightProbeIndirectRadiance(GGXRoughnessToBlinnExponent(clearcoatRoughness), maxMipLevel, clearcoatDir);\n\t    #endif\n    #endif\n    reflectedLight.indirectDiffuse += indirectIrradiance * BRDF_Diffuse_Lambert(diffuseColor);\n    #if defined(USE_ENV_MAP) && defined(USE_PBR)\n        #ifdef USE_CLEARCOAT\n            float ccDotNV = saturate(dot(clearcoatNormal, V));\n            reflectedLight.indirectSpecular += clearcoatRadiance * clearcoat * BRDF_Specular_GGX_Environment(clearcoatNormal, V, specularColor, clearcoatRoughness);\n            ccDotNL = ccDotNV;\n            clearcoatDHR = clearcoat * clearcoatDHRApprox(clearcoatRoughness, ccDotNL);\n        #else\n            clearcoatDHR = 0.0;\n        #endif\n        float clearcoatInv = 1.0 - clearcoatDHR;\n        vec3 singleScattering = vec3(0.0);\n\t    vec3 multiScattering = vec3(0.0);\n        vec3 cosineWeightedIrradiance = iblIrradiance * RECIPROCAL_PI;\n        BRDF_Specular_Multiscattering_Environment(N, V, specularColor, roughness, singleScattering, multiScattering);\n        vec3 diffuse = diffuseColor * (1.0 - (singleScattering + multiScattering));\n        reflectedLight.indirectSpecular += clearcoatInv * indirectRadiance * singleScattering;\n        reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n        reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n    #endif\n#endif",light_pars_frag:"#ifdef USE_AMBIENT_LIGHT\n    uniform vec3 u_AmbientLightColor;\n#endif\n#ifdef USE_CLEARCOAT\n    float clearcoatDHRApprox(const in float roughness, const in float dotNL) {\n        return 0.04 + (1.0 - 0.16) * (pow(1.0 - dotNL, 5.0) * pow(1.0 - roughness, 2.0));\n    }\n#endif\n#if NUM_HEMI_LIGHTS > 0\n    struct HemisphereLight {\n        vec3 direction;\n        vec3 skyColor;\n\t\tvec3 groundColor;\n    };\n    uniform HemisphereLight u_Hemi[NUM_HEMI_LIGHTS];\n#endif\n#if NUM_DIR_LIGHTS > 0\n    struct DirectLight {\n        vec3 direction;\n        vec3 color;\n    };\n    uniform DirectLight u_Directional[NUM_DIR_LIGHTS];\n#endif\n#if NUM_POINT_LIGHTS > 0\n    struct PointLight {\n        vec3 position;\n        vec3 color;\n        float distance;\n        float decay;\n    };\n    uniform PointLight u_Point[NUM_POINT_LIGHTS];\n#endif\n#if NUM_SPOT_LIGHTS > 0\n    struct SpotLight {\n        vec3 position;\n        vec3 color;\n        float distance;\n        float decay;\n        float coneCos;\n        float penumbraCos;\n        vec3 direction;\n    };\n    uniform SpotLight u_Spot[NUM_SPOT_LIGHTS];\n#endif\n#if defined(USE_PBR) && defined(USE_ENV_MAP)\n    vec3 getLightProbeIndirectIrradiance(const in int maxMIPLevel, const in vec3 N) {\n        vec3 coordVec = vec3(u_EnvMap_Flip * N.x, N.yz);\n    \t#ifdef TEXTURE_LOD_EXT\n    \t\tvec4 envMapColor = textureCubeLodEXT(envMap, coordVec, float(maxMIPLevel));\n    \t#else\n    \t\tvec4 envMapColor = textureCube(envMap, coordVec, float(maxMIPLevel));\n    \t#endif\n        envMapColor = envMapTexelToLinear(envMapColor);\n        return PI * envMapColor.rgb * u_EnvMap_Intensity * u_EnvMapLight_Intensity;\n    }\n    float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {\n    \tfloat maxMIPLevelScalar = float(maxMIPLevel);\n    \tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2(pow2(blinnShininessExponent) + 1.0);\n    \treturn clamp(desiredMIPLevel, 0.0, maxMIPLevelScalar);\n    }\n    vec3 getLightProbeIndirectRadiance(const in float blinnShininessExponent, const in int maxMIPLevel, const in vec3 envDir) {\n        float specularMIPLevel = getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);\n        vec3 coordVec = vec3(u_EnvMap_Flip * envDir.x, envDir.yz);\n        #ifdef TEXTURE_LOD_EXT\n    \t\tvec4 envMapColor = textureCubeLodEXT(envMap, coordVec, specularMIPLevel);\n    \t#else\n    \t\tvec4 envMapColor = textureCube(envMap, coordVec, specularMIPLevel);\n    \t#endif\n        envMapColor = envMapTexelToLinear(envMapColor);\n        return envMapColor.rgb * u_EnvMap_Intensity;\n    }\n    float computeSpecularOcclusion(const in float dotNV, const in float ambientOcclusion, const in float roughness) {\n    \treturn saturate(pow(dotNV + ambientOcclusion, exp2(-16.0 * roughness - 1.0)) - 1.0 + ambientOcclusion);\n    }\n#endif",alphamap_pars_frag:"#ifdef USE_ALPHA_MAP\n\tuniform sampler2D alphaMap;\n\tvarying vec2 vAlphaMapUV;\n#endif",alphamap_frag:"#ifdef USE_ALPHA_MAP\n\toutColor.a *= texture2D(alphaMap, vAlphaMapUV).g;\n#endif",alphamap_pars_vert:"#ifdef USE_ALPHA_MAP\n    uniform mat3 alphaMapUVTransform;\n\tvarying vec2 vAlphaMapUV;\n#endif",alphamap_vert:"#ifdef USE_ALPHA_MAP\n\t#if (USE_ALPHA_MAP == 2)\n        vAlphaMapUV = (alphaMapUVTransform * vec3(a_Uv2, 1.)).xy;\n    #else\n        vAlphaMapUV = (alphaMapUVTransform * vec3(a_Uv, 1.)).xy;\n    #endif\n#endif",normalMap_pars_frag:"#ifdef USE_NORMAL_MAP\n    uniform sampler2D normalMap;\n    uniform vec2 normalScale;\n#endif\n#if defined(USE_NORMAL_MAP) || defined(USE_CLEARCOAT_NORMALMAP)\n    #if defined(USE_TANGENT) && !defined(FLAT_SHADED)\n        #define USE_TBN\n    #else\n        #include <tsn>\n    #endif\n#endif",normal_frag:"\n#ifdef FLAT_SHADED\n    vec3 fdx = dFdx(v_modelPos);\n    vec3 fdy = dFdy(v_modelPos);\n    vec3 N = normalize(cross(fdx, fdy));\n#else\n    vec3 N = normalize(v_Normal);\n    #ifdef DOUBLE_SIDED\n        N = N * (float(gl_FrontFacing) * 2.0 - 1.0);\n    #endif\n#endif\n#ifdef USE_TBN\n\tvec3 tangent = normalize(v_Tangent);\n\tvec3 bitangent = normalize(v_Bitangent);\n\t#ifdef DOUBLE_SIDED\n\t\ttangent = tangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\tbitangent = bitangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t#endif\n\tmat3 tspace = mat3(tangent, bitangent, N);\n#endif\nvec3 geometryNormal = N;\n#ifdef USE_NORMAL_MAP\n    vec3 mapN = texture2D(normalMap, v_Uv).rgb * 2.0 - 1.0;\n    mapN.xy *= normalScale;\n    #ifdef USE_TBN\n        N = normalize(tspace * mapN);\n    #else\n        mapN.xy *= (float(gl_FrontFacing) * 2.0 - 1.0);\n        N = normalize(tsn(N, v_modelPos, v_Uv) * mapN);\n    #endif\n#elif defined(USE_BUMPMAP)\n    N = perturbNormalArb(v_modelPos, N, dHdxy_fwd(v_Uv));\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D(clearcoatNormalMap, v_Uv).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TBN\n\t\tclearcoatNormal = normalize(tspace * clearcoatMapN);\n\t#else\n\t\tclearcoatMapN.xy *= (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\tclearcoatNormal = normalize(tsn(clearcoatNormal, v_modelPos, v_Uv) * clearcoatMapN);\n\t#endif\n#endif",normal_pars_frag:"#ifndef FLAT_SHADED\n    varying vec3 v_Normal;\n    #ifdef USE_TANGENT\n        varying vec3 v_Tangent;\n\t\tvarying vec3 v_Bitangent;\n    #endif\n#endif",normal_pars_vert:"#ifndef FLAT_SHADED\n    varying vec3 v_Normal;\n    #ifdef USE_TANGENT\n        varying vec3 v_Tangent;\n\t\tvarying vec3 v_Bitangent;\n    #endif\n#endif",normal_vert:"#ifndef FLAT_SHADED\n    v_Normal = (transposeMat4(inverseMat4(u_Model)) * vec4(objectNormal, 0.0)).xyz;\n    #ifdef FLIP_SIDED\n    \tv_Normal = - v_Normal;\n    #endif\n    #ifdef USE_TANGENT\n        v_Tangent = (transposeMat4(inverseMat4(u_Model)) * vec4(objectTangent, 0.0)).xyz;\n        #ifdef FLIP_SIDED\n            v_Tangent = - v_Tangent;\n        #endif\n        v_Bitangent = normalize(cross(v_Normal, v_Tangent) * a_Tangent.w);\n    #endif\n#endif",packing:"const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n    vec4 r = vec4( fract( v * PackFactors ), v );\n    r.yzw -= r.xyz * ShiftRight8;    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n    return dot( v, UnpackFactors );\n}",premultipliedAlpha_frag:"#ifdef USE_PREMULTIPLIED_ALPHA\n    gl_FragColor.rgb = gl_FragColor.rgb * gl_FragColor.a;\n#endif",pvm_vert:"vec4 worldPosition = u_Model * vec4(transformed, 1.0);\ngl_Position = u_ProjectionView * worldPosition;",dithering_frag:"#if defined( DITHERING )\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_frag:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",shadow:"#ifdef USE_SHADOW_SAMPLER\n    float computeShadow(sampler2DShadow shadowMap, vec3 shadowCoord) {\n        return texture2D( shadowMap, shadowCoord );\n    }\n#else\n    float computeShadow(sampler2D shadowMap, vec3 shadowCoord) {\n        return step(shadowCoord.z, unpackRGBAToDepth(texture2D(shadowMap, shadowCoord.xy)));\n    }\n#endif\nfloat computeShadowWithPoissonSampling(sampler2DShadow shadowMap, vec3 shadowCoord, float texelSize) {\n    vec3 poissonDisk[4];\n    poissonDisk[0] = vec3(-0.94201624, -0.39906216, 0);\n    poissonDisk[1] = vec3(0.94558609, -0.76890725, 0);\n    poissonDisk[2] = vec3(-0.094184101, -0.92938870, 0);\n    poissonDisk[3] = vec3(0.34495938, 0.29387760, 0);\n    return computeShadow(shadowMap, shadowCoord + poissonDisk[0] * texelSize) * 0.25 +\n        computeShadow(shadowMap, shadowCoord + poissonDisk[1] * texelSize) * 0.25 +\n        computeShadow(shadowMap, shadowCoord + poissonDisk[2] * texelSize) * 0.25 +\n        computeShadow(shadowMap, shadowCoord + poissonDisk[3] * texelSize) * 0.25;\n}\nfloat computeShadowWithPCF1(sampler2DShadow shadowSampler, vec3 shadowCoord) {\n    return computeShadow(shadowSampler, shadowCoord);\n}\nfloat computeShadowWithPCF3(sampler2DShadow shadowSampler, vec3 shadowCoord, vec2 shadowMapSizeAndInverse) {\n    vec2 uv = shadowCoord.xy * shadowMapSizeAndInverse.x;    uv += 0.5;    vec2 st = fract(uv);    vec2 base_uv = floor(uv) - 0.5;    base_uv *= shadowMapSizeAndInverse.y;\n    vec2 uvw0 = 3. - 2. * st;\n    vec2 uvw1 = 1. + 2. * st;\n    vec2 u = vec2((2. - st.x) / uvw0.x - 1., st.x / uvw1.x + 1.) * shadowMapSizeAndInverse.y;\n    vec2 v = vec2((2. - st.y) / uvw0.y - 1., st.y / uvw1.y + 1.) * shadowMapSizeAndInverse.y;\n    float shadow = 0.;\n    shadow += uvw0.x * uvw0.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[0], v[0]), shadowCoord.z));\n    shadow += uvw1.x * uvw0.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[1], v[0]), shadowCoord.z));\n    shadow += uvw0.x * uvw1.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[0], v[1]), shadowCoord.z));\n    shadow += uvw1.x * uvw1.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[1], v[1]), shadowCoord.z));\n    shadow = shadow / 16.;\n    return shadow;\n}\nfloat computeShadowWithPCF5(sampler2DShadow shadowSampler, vec3 shadowCoord, vec2 shadowMapSizeAndInverse) {\n    vec2 uv = shadowCoord.xy * shadowMapSizeAndInverse.x;    uv += 0.5;    vec2 st = fract(uv);    vec2 base_uv = floor(uv) - 0.5;    base_uv *= shadowMapSizeAndInverse.y;\n    vec2 uvw0 = 4. - 3. * st;\n    vec2 uvw1 = vec2(7.);\n    vec2 uvw2 = 1. + 3. * st;\n    vec3 u = vec3((3. - 2. * st.x) / uvw0.x - 2., (3. + st.x) / uvw1.x, st.x / uvw2.x + 2.) * shadowMapSizeAndInverse.y;\n    vec3 v = vec3((3. - 2. * st.y) / uvw0.y - 2., (3. + st.y) / uvw1.y, st.y / uvw2.y + 2.) * shadowMapSizeAndInverse.y;\n    float shadow = 0.;\n    shadow += uvw0.x * uvw0.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[0], v[0]), shadowCoord.z));\n    shadow += uvw1.x * uvw0.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[1], v[0]), shadowCoord.z));\n    shadow += uvw2.x * uvw0.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[2], v[0]), shadowCoord.z));\n    shadow += uvw0.x * uvw1.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[0], v[1]), shadowCoord.z));\n    shadow += uvw1.x * uvw1.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[1], v[1]), shadowCoord.z));\n    shadow += uvw2.x * uvw1.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[2], v[1]), shadowCoord.z));\n    shadow += uvw0.x * uvw2.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[0], v[2]), shadowCoord.z));\n    shadow += uvw1.x * uvw2.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[1], v[2]), shadowCoord.z));\n    shadow += uvw2.x * uvw2.y * computeShadow(shadowSampler, vec3(base_uv.xy + vec2(u[2], v[2]), shadowCoord.z));\n    shadow = shadow / 144.;\n    return shadow;\n}\nfloat computeFallOff(float value, vec2 clipSpace, float frustumEdgeFalloff) {\n    float mask = smoothstep(1.0 - frustumEdgeFalloff, 1.00000012, clamp(dot(clipSpace, clipSpace), 0., 1.));\n    return mix(value, 1.0, mask);\n}\nfloat getShadow(sampler2DShadow shadowMap, vec4 shadowCoord, vec2 shadowMapSize, vec2 shadowBias, vec2 shadowParams) {\n    shadowCoord.xyz /= shadowCoord.w;\n    shadowCoord.z += shadowBias.x;\n    bvec4 inFrustumVec = bvec4 (shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0);\n    bool inFrustum = all(inFrustumVec);\n    bvec2 frustumTestVec = bvec2(inFrustum, shadowCoord.z <= 1.0);\n    bool frustumTest = all(frustumTestVec);\n    float shadow = 1.0;\n    if (frustumTest) {\n        #ifdef USE_HARD_SHADOW\n            shadow = computeShadow(shadowMap, shadowCoord.xyz);\n        #else\n            #ifdef USE_PCF3_SOFT_SHADOW\n                vec2 shadowMapSizeAndInverse = vec2(shadowMapSize.x, 1. / shadowMapSize.x);\n                shadow = computeShadowWithPCF3(shadowMap, shadowCoord.xyz, shadowMapSizeAndInverse);\n            #else\n                #ifdef USE_PCF5_SOFT_SHADOW\n                    vec2 shadowMapSizeAndInverse = vec2(shadowMapSize.x, 1. / shadowMapSize.x);\n                    shadow = computeShadowWithPCF5(shadowMap, shadowCoord.xyz, shadowMapSizeAndInverse);\n                #else\n                    float texelSize = shadowParams.x / shadowMapSize.x;\n                    shadow = computeShadowWithPoissonSampling(shadowMap, shadowCoord.xyz, texelSize);\n                #endif\n            #endif\n        #endif\n        shadow = computeFallOff(shadow, shadowCoord.xy * 2. - 1., shadowParams.y);\n    }\n    return shadow;\n}\nfloat textureCubeCompare(samplerCube depths, vec3 uv, float compare) {\n    return step(compare, unpackRGBAToDepth(textureCube(depths, uv)));\n}\nfloat getPointShadow(samplerCube shadowMap, vec4 shadowCoord, vec2 shadowMapSize, vec2 shadowBias, vec2 shadowParams, vec2 shadowCameraRange) {\n    vec3 V = shadowCoord.xyz;\n    float depth = (length(V) - shadowCameraRange.x) / (shadowCameraRange.y - shadowCameraRange.x);    depth += shadowBias.x;\n    #ifdef USE_HARD_SHADOW\n        return textureCubeCompare(shadowMap, normalize(V), depth);\n    #else\n        float texelSize = shadowParams.x / shadowMapSize.x;\n        vec3 poissonDisk[4];\n        poissonDisk[0] = vec3(-1.0, 1.0, -1.0);\n        poissonDisk[1] = vec3(1.0, -1.0, -1.0);\n        poissonDisk[2] = vec3(-1.0, -1.0, -1.0);\n        poissonDisk[3] = vec3(1.0, -1.0, 1.0);\n        return textureCubeCompare(shadowMap, normalize(V) + poissonDisk[0] * texelSize, depth) * 0.25 +\n            textureCubeCompare(shadowMap, normalize(V) + poissonDisk[1] * texelSize, depth) * 0.25 +\n            textureCubeCompare(shadowMap, normalize(V) + poissonDisk[2] * texelSize, depth) * 0.25 +\n            textureCubeCompare(shadowMap, normalize(V) + poissonDisk[3] * texelSize, depth) * 0.25;\n    #endif\n}\n#ifdef USE_PCSS_SOFT_SHADOW\n    const vec3 PoissonSamplers32[64] = vec3[64](\n        vec3(0.06407013, 0.05409927, 0.),\n        vec3(0.7366577, 0.5789394, 0.),\n        vec3(-0.6270542, -0.5320278, 0.),\n        vec3(-0.4096107, 0.8411095, 0.),\n        vec3(0.6849564, -0.4990818, 0.),\n        vec3(-0.874181, -0.04579735, 0.),\n        vec3(0.9989998, 0.0009880066, 0.),\n        vec3(-0.004920578, -0.9151649, 0.),\n        vec3(0.1805763, 0.9747483, 0.),\n        vec3(-0.2138451, 0.2635818, 0.),\n        vec3(0.109845, 0.3884785, 0.),\n        vec3(0.06876755, -0.3581074, 0.),\n        vec3(0.374073, -0.7661266, 0.),\n        vec3(0.3079132, -0.1216763, 0.),\n        vec3(-0.3794335, -0.8271583, 0.),\n        vec3(-0.203878, -0.07715034, 0.),\n        vec3(0.5912697, 0.1469799, 0.),\n        vec3(-0.88069, 0.3031784, 0.),\n        vec3(0.5040108, 0.8283722, 0.),\n        vec3(-0.5844124, 0.5494877, 0.),\n        vec3(0.6017799, -0.1726654, 0.),\n        vec3(-0.5554981, 0.1559997, 0.),\n        vec3(-0.3016369, -0.3900928, 0.),\n        vec3(-0.5550632, -0.1723762, 0.),\n        vec3(0.925029, 0.2995041, 0.),\n        vec3(-0.2473137, 0.5538505, 0.),\n        vec3(0.9183037, -0.2862392, 0.),\n        vec3(0.2469421, 0.6718712, 0.),\n        vec3(0.3916397, -0.4328209, 0.),\n        vec3(-0.03576927, -0.6220032, 0.),\n        vec3(-0.04661255, 0.7995201, 0.),\n        vec3(0.4402924, 0.3640312, 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.),\n        vec3(0., 0., 0.)\n    );\n    const vec3 PoissonSamplers64[64] = vec3[64](\n        vec3(-0.613392, 0.617481, 0.),\n        vec3(0.170019, -0.040254, 0.),\n        vec3(-0.299417, 0.791925, 0.),\n        vec3(0.645680, 0.493210, 0.),\n        vec3(-0.651784, 0.717887, 0.),\n        vec3(0.421003, 0.027070, 0.),\n        vec3(-0.817194, -0.271096, 0.),\n        vec3(-0.705374, -0.668203, 0.),\n        vec3(0.977050, -0.108615, 0.),\n        vec3(0.063326, 0.142369, 0.),\n        vec3(0.203528, 0.214331, 0.),\n        vec3(-0.667531, 0.326090, 0.),\n        vec3(-0.098422, -0.295755, 0.),\n        vec3(-0.885922, 0.215369, 0.),\n        vec3(0.566637, 0.605213, 0.),\n        vec3(0.039766, -0.396100, 0.),\n        vec3(0.751946, 0.453352, 0.),\n        vec3(0.078707, -0.715323, 0.),\n        vec3(-0.075838, -0.529344, 0.),\n        vec3(0.724479, -0.580798, 0.),\n        vec3(0.222999, -0.215125, 0.),\n        vec3(-0.467574, -0.405438, 0.),\n        vec3(-0.248268, -0.814753, 0.),\n        vec3(0.354411, -0.887570, 0.),\n        vec3(0.175817, 0.382366, 0.),\n        vec3(0.487472, -0.063082, 0.),\n        vec3(-0.084078, 0.898312, 0.),\n        vec3(0.488876, -0.783441, 0.),\n        vec3(0.470016, 0.217933, 0.),\n        vec3(-0.696890, -0.549791, 0.),\n        vec3(-0.149693, 0.605762, 0.),\n        vec3(0.034211, 0.979980, 0.),\n        vec3(0.503098, -0.308878, 0.),\n        vec3(-0.016205, -0.872921, 0.),\n        vec3(0.385784, -0.393902, 0.),\n        vec3(-0.146886, -0.859249, 0.),\n        vec3(0.643361, 0.164098, 0.),\n        vec3(0.634388, -0.049471, 0.),\n        vec3(-0.688894, 0.007843, 0.),\n        vec3(0.464034, -0.188818, 0.),\n        vec3(-0.440840, 0.137486, 0.),\n        vec3(0.364483, 0.511704, 0.),\n        vec3(0.034028, 0.325968, 0.),\n        vec3(0.099094, -0.308023, 0.),\n        vec3(0.693960, -0.366253, 0.),\n        vec3(0.678884, -0.204688, 0.),\n        vec3(0.001801, 0.780328, 0.),\n        vec3(0.145177, -0.898984, 0.),\n        vec3(0.062655, -0.611866, 0.),\n        vec3(0.315226, -0.604297, 0.),\n        vec3(-0.780145, 0.486251, 0.),\n        vec3(-0.371868, 0.882138, 0.),\n        vec3(0.200476, 0.494430, 0.),\n        vec3(-0.494552, -0.711051, 0.),\n        vec3(0.612476, 0.705252, 0.),\n        vec3(-0.578845, -0.768792, 0.),\n        vec3(-0.772454, -0.090976, 0.),\n        vec3(0.504440, 0.372295, 0.),\n        vec3(0.155736, 0.065157, 0.),\n        vec3(0.391522, 0.849605, 0.),\n        vec3(-0.620106, -0.328104, 0.),\n        vec3(0.789239, -0.419965, 0.),\n        vec3(-0.545396, 0.538133, 0.),\n        vec3(-0.178564, -0.596057, 0.)\n    );\n    float getRand(vec2 seed) {\n        return fract(sin(dot(seed.xy ,vec2(12.9898,78.233))) * 43758.5453);\n    }\n    float computeShadowWithPCSS(sampler2D depthSampler, sampler2DShadow shadowSampler, vec3 shadowCoord, float shadowMapSizeInverse, float lightSizeUV, int searchTapCount, int pcfTapCount, vec3[64] poissonSamplers) {\n        float depthMetric = shadowCoord.z;\n        float blockerDepth = 0.0;\n        float sumBlockerDepth = 0.0;\n        float numBlocker = 0.0;\n        for (int i = 0; i < searchTapCount; i++) {\n            blockerDepth = unpackRGBAToDepth(texture(depthSampler, shadowCoord.xy + (lightSizeUV * shadowMapSizeInverse * PoissonSamplers32[i].xy)));\n            if (blockerDepth < depthMetric) {\n                sumBlockerDepth += blockerDepth;\n                numBlocker++;\n            }\n        }\n        if (numBlocker < 1.0) {\n            return 1.0;\n        }\n        float avgBlockerDepth = sumBlockerDepth / numBlocker;\n        float AAOffset = shadowMapSizeInverse * 10.;\n        float penumbraRatio = ((depthMetric - avgBlockerDepth) + AAOffset);\n        float filterRadius = penumbraRatio * lightSizeUV * shadowMapSizeInverse;\n        float random = getRand(shadowCoord.xy);        float rotationAngle = random * 3.1415926;\n        vec2 rotationVector = vec2(cos(rotationAngle), sin(rotationAngle));\n        float shadow = 0.;\n        for (int i = 0; i < pcfTapCount; i++) {\n            vec3 offset = poissonSamplers[i];\n            offset = vec3(offset.x * rotationVector.x - offset.y * rotationVector.y, offset.y * rotationVector.x + offset.x * rotationVector.y, 0.);\n            shadow += texture(shadowSampler, shadowCoord + offset * filterRadius);\n        }\n        shadow /= float(pcfTapCount);\n        shadow = mix(shadow, 1., depthMetric - avgBlockerDepth);\n        return shadow;\n    }\n    float getShadowWithPCSS(sampler2D depthSampler, sampler2DShadow shadowMap, vec4 shadowCoord, vec2 shadowMapSize, vec2 shadowBias, vec2 shadowParams) {\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias.x;\n        bvec4 inFrustumVec = bvec4 (shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0);\n        bool inFrustum = all(inFrustumVec);\n        bvec2 frustumTestVec = bvec2(inFrustum, shadowCoord.z <= 1.0);\n        bool frustumTest = all(frustumTestVec);\n        float shadow = 1.0;\n        if (frustumTest) {\n            #ifdef USE_PCSS16_SOFT_SHADOW\n                shadow = computeShadowWithPCSS(depthSampler, shadowMap, shadowCoord.xyz, 1. / shadowMapSize.x, 0.1 * shadowMapSize.x, 16, 16, PoissonSamplers32);\n            #else\n                #ifdef USE_PCSS32_SOFT_SHADOW\n                    shadow = computeShadowWithPCSS(depthSampler, shadowMap, shadowCoord.xyz, 1. / shadowMapSize.x, 0.1 * shadowMapSize.x, 16, 32, PoissonSamplers32);\n                #else\n                    shadow = computeShadowWithPCSS(depthSampler, shadowMap, shadowCoord.xyz, 1. / shadowMapSize.x, 0.1 * shadowMapSize.x, 32, 64, PoissonSamplers64);\n                #endif\n            #endif\n            shadow = computeFallOff(shadow, shadowCoord.xy * 2. - 1., shadowParams.y);\n        }\n        return shadow;\n    }\n#endif",shadowMap_frag:"#ifdef USE_SHADOW\n#endif",shadowMap_pars_frag:"#ifdef USE_SHADOW\n\t#if NUM_DIR_SHADOWS > 0\n\t\tuniform sampler2DShadow directionalShadowMap[NUM_DIR_SHADOWS];\n\t\tvarying vec4 vDirectionalShadowCoord[NUM_DIR_SHADOWS];\n\t\t#ifdef USE_PCSS_SOFT_SHADOW\n\t\t\tuniform sampler2D directionalDepthMap[NUM_DIR_SHADOWS];\n\t\t#endif\n\t\tstruct DirectLightShadow {\n\t\t\tvec2 shadowBias;\n\t\t\tvec2 shadowMapSize;\n\t\t\tvec2 shadowParams;\n\t\t};\n\t\tuniform DirectLightShadow u_DirectionalShadow[NUM_DIR_SHADOWS];\n\t#endif\n\t#if NUM_POINT_SHADOWS > 0\n\t\tuniform samplerCube pointShadowMap[NUM_POINT_SHADOWS];\n\t\tvarying vec4 vPointShadowCoord[NUM_POINT_SHADOWS];\n\t\tstruct PointLightShadow {\n\t\t\tvec2 shadowBias;\n\t\t\tvec2 shadowMapSize;\n\t\t\tvec2 shadowParams;\n\t\t\tvec2 shadowCameraRange;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow u_PointShadow[NUM_POINT_SHADOWS];\n\t#endif\n\t#if NUM_SPOT_SHADOWS > 0\n\t\tuniform sampler2DShadow spotShadowMap[NUM_SPOT_SHADOWS];\n\t\tvarying vec4 vSpotShadowCoord[NUM_SPOT_SHADOWS];\n\t\t#ifdef USE_PCSS_SOFT_SHADOW\n\t\t\tuniform sampler2D spotDepthMap[NUM_SPOT_SHADOWS];\n\t\t#endif\n\t\tstruct SpotLightShadow {\n\t\t\tvec2 shadowBias;\n\t\t\tvec2 shadowMapSize;\n\t\t\tvec2 shadowParams;\n\t\t};\n\t\tuniform SpotLightShadow u_SpotShadow[NUM_SPOT_SHADOWS];\n\t#endif\n\t#include <packing>\n\t#include <shadow>\n#endif",shadowMap_pars_vert:"#ifdef USE_SHADOW\n\t#if NUM_DIR_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[NUM_DIR_SHADOWS];\n\t\tvarying vec4 vDirectionalShadowCoord[NUM_DIR_SHADOWS];\n\t\tstruct DirectLightShadow {\n\t\t\tvec2 shadowBias;\n\t\t\tvec2 shadowMapSize;\n\t\t\tvec2 shadowParams;\n\t\t};\n\t\tuniform DirectLightShadow u_DirectionalShadow[NUM_DIR_SHADOWS];\n\t#endif\n\t#if NUM_POINT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[NUM_POINT_SHADOWS];\n\t\tvarying vec4 vPointShadowCoord[NUM_POINT_SHADOWS];\n\t\tstruct PointLightShadow {\n\t\t\tvec2 shadowBias;\n\t\t\tvec2 shadowMapSize;\n\t\t\tvec2 shadowParams;\n\t\t\tvec2 shadowCameraRange;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow u_PointShadow[NUM_POINT_SHADOWS];\n\t#endif\n\t#if NUM_SPOT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[NUM_SPOT_SHADOWS];\n\t\tvarying vec4 vSpotShadowCoord[NUM_SPOT_SHADOWS];\n\t\tstruct SpotLightShadow {\n\t\t\tvec2 shadowBias;\n\t\t\tvec2 shadowMapSize;\n\t\t\tvec2 shadowParams;\n\t\t};\n\t\tuniform SpotLightShadow u_SpotShadow[NUM_SPOT_SHADOWS];\n\t#endif\n#endif",shadowMap_vert:"\n#ifdef USE_SHADOW\n\t#if NUM_DIR_SHADOWS > 0 || NUM_POINT_SHADOWS > 0 || NUM_SPOT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = (transposeMat4(inverseMat4(u_Model)) * vec4(objectNormal, 0.0)).xyz;\n\t\tshadowWorldNormal = normalize(shadowWorldNormal);\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor (int i = 0; i < NUM_DIR_SHADOWS; i++) {\n\t\t\tshadowWorldPosition = worldPosition + vec4(shadowWorldNormal * u_DirectionalShadow[i].shadowBias[1], 0);\n\t\t\tvDirectionalShadowCoord[i] = directionalShadowMatrix[i] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor (int i = 0; i < NUM_POINT_SHADOWS; i++) {\n\t\t\tshadowWorldPosition = worldPosition + vec4(shadowWorldNormal * u_PointShadow[i].shadowBias[1], 0);\n\t\t\tvPointShadowCoord[i] = pointShadowMatrix[i] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor (int i = 0; i < NUM_SPOT_SHADOWS; i++) {\n\t\t\tshadowWorldPosition = worldPosition + vec4(shadowWorldNormal * u_SpotShadow[i].shadowBias[1], 0);\n\t\t\tvSpotShadowCoord[i] = spotShadowMatrix[i] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif",morphnormal_vert:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vert:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vert:"#ifdef USE_MORPHTARGETS\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n        transformed += morphTarget4 * morphTargetInfluences[ 4 ];\n        transformed += morphTarget5 * morphTargetInfluences[ 5 ];\n        transformed += morphTarget6 * morphTargetInfluences[ 6 ];\n        transformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",skinning_pars_vert:"#ifdef USE_SKINNING\n    attribute vec4 skinIndex;\n\tattribute vec4 skinWeight;\n    uniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n    #ifdef BONE_TEXTURE\n        uniform sampler2D boneTexture;\n        uniform int boneTextureSize;\n        mat4 getBoneMatrix( const in float i ) {\n            float j = i * 4.0;\n            float x = mod( j, float( boneTextureSize ) );\n            float y = floor( j / float( boneTextureSize ) );\n            float dx = 1.0 / float( boneTextureSize );\n            float dy = 1.0 / float( boneTextureSize );\n            y = dy * ( y + 0.5 );\n            vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n            vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n            vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n            vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n            mat4 bone = mat4( v1, v2, v3, v4 );\n            return bone;\n        }\n    #else\n        uniform mat4 boneMatrices[MAX_BONES];\n        mat4 getBoneMatrix(const in float i) {\n            mat4 bone = boneMatrices[int(i)];\n            return bone;\n        }\n    #endif\n#endif",skinning_vert:"#ifdef USE_SKINNING\n    mat4 boneMatX = getBoneMatrix( skinIndex.x );\n    mat4 boneMatY = getBoneMatrix( skinIndex.y );\n    mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n    mat4 boneMatW = getBoneMatrix( skinIndex.w );\n    vec4 skinVertex = bindMatrix * vec4(transformed, 1.0);\n    vec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned = bindMatrixInverse * skinned;\n    transformed = skinned.xyz / skinned.w;\n#endif",skinnormal_vert:"#ifdef USE_SKINNING\n    mat4 skinMatrix = mat4( 0.0 );\n    skinMatrix += skinWeight.x * boneMatX;\n    skinMatrix += skinWeight.y * boneMatY;\n    skinMatrix += skinWeight.z * boneMatZ;\n    skinMatrix += skinWeight.w * boneMatW;\n    skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n    objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n    #ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularMap_frag:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, v_Uv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularMap_pars_frag:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",transpose:"mat4 transposeMat4(mat4 inMatrix) {\n    vec4 i0 = inMatrix[0];\n    vec4 i1 = inMatrix[1];\n    vec4 i2 = inMatrix[2];\n    vec4 i3 = inMatrix[3];\n    mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n    return outMatrix;\n}",tsn:"mat3 tsn(vec3 N, vec3 V, vec2 uv) {\n    vec3 q0 = vec3(dFdx(V.x), dFdx(V.y), dFdx(V.z));\n    vec3 q1 = vec3(dFdy(V.x), dFdy(V.y), dFdy(V.z));\n    vec2 st0 = dFdx( uv.st );\n    vec2 st1 = dFdy( uv.st );\n    float scale = sign( st1.t * st0.s - st0.t * st1.s );\n    vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n    vec3 T = normalize( ( -q0 * st1.s + q1 * st0.s ) * scale );\n    mat3 tsn = mat3( S, T, N );\n    return tsn;\n}",uv_pars_frag:"#ifdef USE_UV1\n    varying vec2 v_Uv;\n#endif\n#ifdef USE_UV2\n    varying vec2 v_Uv2;\n#endif",uv_pars_vert:"#if defined(USE_UV1) || defined(USE_UV2)\n    uniform mat3 uvTransform;\n#endif\n#ifdef USE_UV1\n    attribute vec2 a_Uv;\n    varying vec2 v_Uv;\n#endif\n#ifdef USE_UV2\n    attribute vec2 a_Uv2;\n    varying vec2 v_Uv2;\n#endif",uv_vert:"#ifdef USE_UV1\n    v_Uv = (uvTransform * vec3(a_Uv, 1.)).xy;\n#endif\n#ifdef USE_UV2\n    v_Uv2 = (uvTransform * vec3(a_Uv2, 1.)).xy;\n#endif",modelPos_pars_frag:"varying vec3 v_modelPos;",modelPos_pars_vert:"varying vec3 v_modelPos;",modelPos_vert:"\nv_modelPos = worldPosition.xyz;",logdepthbuf_frag:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_frag:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vert:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tuniform float logDepthCameraNear;\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t\tuniform float logDepthCameraNear;\n\t#endif\n#endif",logdepthbuf_vert:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w - logDepthCameraNear;\n\t\tvIsPerspective = float( isPerspectiveMatrix( u_Projection ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( u_Projection ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w - logDepthCameraNear + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",clearcoat_pars_frag:"#ifdef USE_CLEARCOAT\n\tuniform float u_Clearcoat;\n\tuniform float u_ClearcoatRoughness;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif"};var lf="#define USE_PBR\n#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <modelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <aoMap_pars_vert>\n#include <alphamap_pars_vert>\n#include <emissiveMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <logdepthbuf_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <morphnormal_vert>\n    #include <skinning_vert>\n    #include <skinnormal_vert>\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <logdepthbuf_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    #include <modelPos_vert>\n    #include <envMap_vert>\n    #include <aoMap_vert>\n    #include <alphamap_vert>\n    #include <emissiveMap_vert>\n    #include <shadowMap_vert>\n}";const uf={basic_frag:"#include <common_frag>\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <modelPos_pars_frag>\n#if defined(USE_ENV_MAP) && !defined(USE_VERTEX_ENVDIR)\n    #include <normalMap_pars_frag>\n    #include <normal_pars_frag>    \n#endif\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <fog_pars_frag>\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <logdepthbuf_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphamap_frag>\n    #include <alphaTest_frag>\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n    reflectedLight.indirectDiffuse += vec3(1.0);\n    #include <aoMap_frag>\n    reflectedLight.indirectDiffuse *= outColor.xyz;\n    outColor.xyz = reflectedLight.indirectDiffuse;\n    #if defined(USE_ENV_MAP) && !defined(USE_VERTEX_ENVDIR)\n        #include <normal_frag>\n    #endif\n    #include <envMap_frag>\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",basic_vert:"#include <common_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <modelPos_pars_vert>\n#if defined(USE_ENV_MAP) && !defined(USE_VERTEX_ENVDIR)\n    #include <normal_pars_vert>\n#endif\n#include <envMap_pars_vert>\n#include <aoMap_pars_vert>\n#include <alphamap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <logdepthbuf_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    #include <logdepthbuf_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    #include <modelPos_vert>\n    #ifdef USE_ENV_MAP\n        #include <morphnormal_vert>\n        #include <skinnormal_vert>\n        #ifndef USE_VERTEX_ENVDIR\n            #include <normal_vert>\n        #endif  \n    #endif\n    #include <envMap_vert>\n    #include <aoMap_vert>\n    #include <alphamap_vert>\n}",depth_frag:"#include <common_frag>\n#include <diffuseMap_pars_frag>\n#include <modelPos_pars_frag>\n#include <uv_pars_frag>\n#include <packing>\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n        vec4 texelColor = texture2D( diffuseMap, v_Uv );\n        float alpha = texelColor.a * u_Opacity;\n        if(alpha < ALPHATEST) discard;\n    #endif\n    #include <logdepthbuf_frag>\n    \n    #ifdef DEPTH_PACKING_RGBA\n        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n    #else\n        gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), u_Opacity );\n    #endif\n}",depth_vert:"#include <common_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <uv_pars_vert>\n#include <modelPos_pars_vert>\n#include <logdepthbuf_pars_vert>\nvoid main() {\n    #include <uv_vert>\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    #include <logdepthbuf_vert>\n    #include <modelPos_vert>\n}",distance_frag:"#include <common_frag>\nuniform float nearDistance;\nuniform float farDistance;\n#include <modelPos_pars_frag>\n#include <packing>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    \n    float dist = length( v_modelPos - u_CameraPosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n    gl_FragColor = packDepthToRGBA(dist);\n}",distance_vert:"#include <common_vert>\n#include <modelPos_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    #include <modelPos_vert>\n}",lambert_frag:"#define USE_LAMBERT\n#include <common_frag>\n#include <dithering_pars_frag>\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <normalMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <modelPos_pars_frag>\n#include <bsdfs>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <logdepthbuf_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphamap_frag>\n    #include <alphaTest_frag>\n    #include <normal_frag>\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n    #include <light_frag>\n    #include <aoMap_frag>\n    outColor.xyz = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n    #include <envMap_frag>\n    #include <shadowMap_frag>\n    vec3 totalEmissiveRadiance = emissive;\n    #include <emissiveMap_frag>\n    outColor.xyz += totalEmissiveRadiance;\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n    #include <dithering_frag>\n}",lambert_vert:"#define USE_LAMBERT\n#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <modelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <aoMap_pars_vert>\n#include <alphamap_pars_vert>\n#include <emissiveMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <logdepthbuf_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <morphnormal_vert>\n    #include <skinning_vert>\n    #include <skinnormal_vert>\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <logdepthbuf_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    #include <modelPos_vert>\n    #include <envMap_vert>\n    #include <aoMap_vert>\n    #include <alphamap_vert>\n    #include <emissiveMap_vert>\n    #include <shadowMap_vert>\n}",normaldepth_frag:"#include <common_frag>\n#include <diffuseMap_pars_frag>\n#include <uv_pars_frag>\n#include <packing>\n#include <normal_pars_frag>\n#include <logdepthbuf_pars_frag>\nvoid main() {\n    #if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n        vec4 texelColor = texture2D( diffuseMap, v_Uv );\n        float alpha = texelColor.a * u_Opacity;\n        if(alpha < ALPHATEST) discard;\n    #endif\n    #include <logdepthbuf_frag>\n    vec4 packedNormalDepth;\n    packedNormalDepth.xyz = normalize(v_Normal) * 0.5 + 0.5;\n    packedNormalDepth.w = gl_FragCoord.z;\n    gl_FragColor = packedNormalDepth;\n}",normaldepth_vert:"#include <common_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <logdepthbuf_pars_vert>\nvoid main() {\n    #include <uv_vert>\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <morphnormal_vert>\n    #include <skinning_vert>\n    #include <skinnormal_vert>\n    #include <normal_vert>\n    #include <pvm_vert>\n    #include <logdepthbuf_vert>\n}",pbr_frag:"#define USE_PBR\n#include <common_frag>\n#include <dithering_pars_frag>\nuniform float u_Metalness;\n#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif\nuniform float u_Roughness;\n#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <clearcoat_pars_frag>\n#include <modelPos_pars_frag>\n#include <bsdfs>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <logdepthbuf_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphamap_frag>\n    #include <alphaTest_frag>\n    #include <normal_frag>\n    float roughnessFactor = u_Roughness;\n    #ifdef USE_ROUGHNESSMAP\n    \tvec4 texelRoughness = texture2D( roughnessMap, v_Uv );\n    \troughnessFactor *= texelRoughness.g;\n    #endif\n    float metalnessFactor = u_Metalness;\n    #ifdef USE_METALNESSMAP\n    \tvec4 texelMetalness = texture2D( metalnessMap, v_Uv );\n    \tmetalnessFactor *= texelMetalness.b;\n    #endif\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n    #include <light_frag>\n    #include <aoMap_frag>\n    outColor.xyz = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n    #include <shadowMap_frag>\n    vec3 totalEmissiveRadiance = emissive;\n    #include <emissiveMap_frag>\n    outColor.xyz += totalEmissiveRadiance;\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n    #include <dithering_frag>\n}",pbr_vert:lf,pbr2_frag:"#define USE_PBR\n#define USE_PBR2\n#include <common_frag>\n#include <dithering_pars_frag>\nuniform vec3 u_SpecularColor;\n#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif\nuniform float glossiness;\n#ifdef USE_GLOSSINESSMAP\n\tuniform sampler2D glossinessMap;\n#endif\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <modelPos_pars_frag>\n#include <bsdfs>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <logdepthbuf_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphamap_frag>\n    #include <alphaTest_frag>\n    #include <normal_frag>\n    vec3 specularFactor = u_SpecularColor;\n    #ifdef USE_SPECULARMAP\n        vec4 texelSpecular = texture2D(specularMap, v_Uv);\n        texelSpecular = sRGBToLinear(texelSpecular);\n        specularFactor *= texelSpecular.rgb;\n    #endif\n    float glossinessFactor = glossiness;\n    #ifdef USE_GLOSSINESSMAP\n        vec4 texelGlossiness = texture2D(glossinessMap, v_Uv);\n        glossinessFactor *= texelGlossiness.a;\n    #endif\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n    #include <light_frag>\n    #include <aoMap_frag>\n    outColor.xyz = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n    #include <shadowMap_frag>\n    vec3 totalEmissiveRadiance = emissive;\n    #include <emissiveMap_frag>\n    outColor.xyz += totalEmissiveRadiance;\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n    #include <dithering_frag>\n}",pbr2_vert:lf,matcap_frag:"#define MATCAP\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common_frag>\n#include <dithering_pars_frag>\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <normalMap_pars_frag>\n#include <modelPos_pars_frag>\n#include <bumpMap_pars_frag>\n#include <normal_pars_frag>\n#include <fog_pars_frag>\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <logdepthbuf_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphamap_frag>\n    #include <alphaTest_frag>\n    #include <normal_frag>\n    vec3 viewDir = normalize(vViewPosition);\n\tvec3 x = normalize(vec3(viewDir.z, 0.0, -viewDir.x));\n\tvec3 y = cross(viewDir, x);\n    vec3 viewN = (u_View * vec4(N, 0.0)).xyz;\n\tvec2 uv = vec2(dot(x, viewN), dot(y, viewN)) * 0.495 + 0.5;\n    #ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D(matcap, uv);\n\t\tmatcapColor = matcapTexelToLinear(matcapColor);\n\t#else\n\t\tvec4 matcapColor = vec4(1.0);\n\t#endif\n\toutColor.rgb *= matcapColor.rgb;\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n    #include <dithering_frag>\n}",matcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <alphamap_pars_vert>\n#include <modelPos_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <logdepthbuf_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <morphnormal_vert>\n    #include <skinning_vert>\n    #include <skinnormal_vert>\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <logdepthbuf_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    #include <alphamap_vert>\n    #include <modelPos_vert>\n    vec4 mvPosition = u_View * worldPosition;\n    vViewPosition = - mvPosition.xyz;\n}",phong_frag:"#define USE_PHONG\n#include <common_frag>\n#include <dithering_pars_frag>\nuniform float u_Specular;\nuniform vec3 u_SpecularColor;\n#include <specularMap_pars_frag>\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <modelPos_pars_frag>\n#include <bsdfs>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <logdepthbuf_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphamap_frag>\n    #include <alphaTest_frag>\n    #include <normal_frag>\n    #include <specularMap_frag>\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n    #include <light_frag>\n    #include <aoMap_frag>\n    outColor.xyz = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n    #include <envMap_frag>\n    #include <shadowMap_frag>\n    vec3 totalEmissiveRadiance = emissive;\n    #include <emissiveMap_frag>\n    outColor.xyz += totalEmissiveRadiance;\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n    #include <dithering_frag>\n}",phong_vert:"#define USE_PHONG\n#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <modelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <aoMap_pars_vert>\n#include <alphamap_pars_vert>\n#include <emissiveMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <logdepthbuf_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <morphnormal_vert>\n    #include <skinning_vert>\n    #include <skinnormal_vert>\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <logdepthbuf_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    #include <modelPos_vert>\n    #include <envMap_vert>\n    #include <aoMap_vert>\n    #include <alphamap_vert>\n    #include <emissiveMap_vert>\n    #include <shadowMap_vert>\n}",point_frag:"#include <common_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <fog_pars_frag>\n#include <logdepthbuf_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #include <color_frag>\n    #include <logdepthbuf_frag>\n    #ifdef USE_DIFFUSE_MAP\n        outColor *= texture2D(diffuseMap, vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y));\n    #endif\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",point_vert:"#include <common_vert>\n#include <color_pars_vert>\n#include <logdepthbuf_pars_vert>\nuniform float u_PointSize;\nuniform float u_PointScale;\nvoid main() {\n    #include <begin_vert>\n    #include <pvm_vert>\n    #include <color_vert>\n    vec4 mvPosition = u_View * u_Model * vec4(transformed, 1.0);\n    #ifdef USE_SIZEATTENUATION\n        gl_PointSize = u_PointSize * ( u_PointScale / - mvPosition.z );\n    #else\n        gl_PointSize = u_PointSize;\n    #endif\n    #include <logdepthbuf_vert>\n}"};class cf{constructor(e,t,r){this._gl=e,this._state=t,this._capabilities=r,this._programs=[]}getProgram(e,t,r,n){const i=this._programs,a=function(e,t,r,n,i){const a=r.acceptLight?i.lights:null,s=r.fog?i.scene.fog:null,o=void 0!==r.envMap?r.envMap||i.scene.environment:null,l=i.scene.logarithmicDepthBuffer,u=i.scene.disableShadowSampler,c=r.clippingPlanes&&r.clippingPlanes.length>0?r.clippingPlanes.length:i.scene.numClippingPlanes,h={};h.shaderName=r.type===Nc.SHADER&&r.shaderName?r.shaderName:r.type,h.version=t.version,h.precision=r.precision||t.maxPrecision,h.useStandardDerivatives=t.version>=2||!!t.getExtension("OES_standard_derivatives")||!!t.getExtension("GL_OES_standard_derivatives"),h.useShaderTextureLOD=t.version>=2||!!t.getExtension("EXT_shader_texture_lod"),h.useDiffuseMap=r.diffuseMap?r.diffuseMapCoord+1:0,h.useAlphaMap=r.alphaMap?r.alphaMapCoord+1:0,h.useEmissiveMap=r.emissiveMap?r.emissiveMapCoord+1:0,h.useAOMap=r.aoMap?r.aoMapCoord+1:0,h.useNormalMap=!!r.normalMap,h.useBumpMap=!!r.bumpMap,h.useSpecularMap=!!r.specularMap,h.useRoughnessMap=!!r.roughnessMap,h.useMetalnessMap=!!r.metalnessMap,h.useGlossinessMap=!!r.glossinessMap,h.useMatcap=!!r.matcap,h.useEnvMap=!!o,h.envMapCombine=r.envMapCombine,h.useClearcoat=r.clearcoat>0,h.useClearcoatMap=h.useClearcoat&&!!r.clearcoatMap,h.useClearcoatRoughnessMap=h.useClearcoat&&!!r.clearcoatRoughnessMap,h.useClearcoatNormalMap=h.useClearcoat&&!!r.clearcoatNormalMap,h.useUv1=1===h.useDiffuseMap||1===h.useAlphaMap||1===h.useEmissiveMap||1===h.useAOMap||h.useNormalMap||h.useBumpMap||h.useSpecularMap||h.useRoughnessMap||h.useMetalnessMap||h.useGlossinessMap||h.useClearcoatMap||h.useClearcoatNormalMap||h.useClearcoatRoughnessMap,h.useUv2=2===h.useDiffuseMap||2===h.useAlphaMap||2===h.useEmissiveMap||2===h.useAOMap,h.useAmbientLight=!!a&&a.useAmbient,h.hemisphereLightNum=a?a.hemisNum:0,h.directLightNum=a?a.directsNum:0,h.pointLightNum=a?a.pointsNum:0,h.spotLightNum=a?a.spotsNum:0,h.directShadowNum=n.receiveShadow&&a?a.directShadowNum:0,h.pointShadowNum=n.receiveShadow&&a?a.pointShadowNum:0,h.spotShadowNum=n.receiveShadow&&a?a.spotShadowNum:0,h.useShadow=n.receiveShadow&&!!a&&a.shadowsNum>0,h.useShadowSampler=t.version>=2&&!u,h.shadowType=h.useShadowSampler?n.shadowType:qc.POISSON_SOFT,h.dithering=r.dithering;const d=e.currentRenderTarget;h.gammaFactor=i.gammaFactor,h.outputEncoding=d.texture?hf(d.texture):i.outputEncoding,h.diffuseMapEncoding=hf(r.diffuseMap||r.cubeMap),h.envMapEncoding=hf(o),h.emissiveMapEncoding=hf(r.emissiveMap),h.matcapEncoding=hf(r.matcap),h.alphaTest=r.alphaTest,h.premultipliedAlpha=r.premultipliedAlpha,h.useVertexColors=r.vertexColors,h.useVertexTangents=!!r.normalMap&&r.vertexTangents,h.numClippingPlanes=c,h.flatShading=r.shading===Uc.FLAT_SHADING,h.fog=!!s,h.fogExp2=!!s&&s.isFogExp2,h.sizeAttenuation=r.sizeAttenuation,h.doubleSided=r.side===Lc.DOUBLE,h.flipSided=r.side===Lc.BACK,h.packDepthToRGBA=r.packToRGBA,h.logarithmicDepthBuffer=!!l,h.rendererExtensionFragDepth=t.version>=2||!!t.getExtension("EXT_frag_depth"),h.morphTargets=!!n.morphTargetInfluences,h.morphNormals=!!n.morphTargetInfluences&&n.geometry.morphAttributes.normal;const p=n.isSkinnedMesh&&n.skeleton,f=t.maxVertexUniformVectors,m=t.maxVertexTextures>0&&(!!t.getExtension("OES_texture_float")||t.version>=2);let g=0;m?g=1024:(g=n.skeleton?n.skeleton.bones.length:0,16*g>f&&(console.warn("Program: too many bones ("+g+"), current cpu only support "+Math.floor(f/16)+" bones!!"),g=Math.floor(f/16)));return h.useSkinning=p,h.bonesNum=g,h.useVertexTexture=m,h}(this._state,this._capabilities,e,t,r),s=function(e,t){let r="";for(const t in e)r+=e[t]+"_";for(const e in t.defines)r+=e+"_"+t.defines[e]+"_";t.type!==Nc.SHADER||t.shaderName||(r+=t.vertexShader,r+=t.fragmentShader);return r}(a,e);let o;for(let e=0,t=i.length;e<t;e++){const t=i[e];if(t.code===s){o=t,++o.usedTimes;break}}if(void 0===o){const t=function(e){const t=[];for(const r in e){const n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(e.defines),r=uf[e.type+"_vert"]||e.vertexShader||uf.basic_vert,l=uf[e.type+"_frag"]||e.fragmentShader||uf.basic_frag;o=function(e,t,r,n,i){let a=["precision "+r.precision+" float;","precision "+r.precision+" int;","precision "+r.precision+" sampler2D;","#define SHADER_NAME "+r.shaderName,t,r.version>=2?"#define WEBGL2":"",r.useRoughnessMap?"#define USE_ROUGHNESSMAP":"",r.useMetalnessMap?"#define USE_METALNESSMAP":"",r.useGlossinessMap?"#define USE_GLOSSINESSMAP":"",r.useAmbientLight?"#define USE_AMBIENT_LIGHT":"",r.pointLightNum>0||r.directLightNum>0||r.useAmbientLight||r.hemisphereLightNum>0||r.spotLightNum>0?"#define USE_LIGHT":"",r.useNormalMap?"#define USE_NORMAL_MAP":"",r.useBumpMap?"#define USE_BUMPMAP":"",r.useSpecularMap?"#define USE_SPECULARMAP":"",r.useEmissiveMap?"#define USE_EMISSIVEMAP "+r.useEmissiveMap:"",r.useShadow?"#define USE_SHADOW":"",r.flatShading?"#define FLAT_SHADED":"",r.flipSided?"#define FLIP_SIDED":"",r.useDiffuseMap?"#define USE_DIFFUSE_MAP "+r.useDiffuseMap:"",r.useAlphaMap?"#define USE_ALPHA_MAP "+r.useAlphaMap:"",r.useEnvMap?"#define USE_ENV_MAP":"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.useAOMap?"#define USE_AOMAP "+r.useAOMap:"",r.useVertexColors==Yc.RGB?"#define USE_VCOLOR_RGB":"",r.useVertexColors==Yc.RGBA?"#define USE_VCOLOR_RGBA":"",r.useVertexTangents?"#define USE_TANGENT":"",r.useUv1?"#define USE_UV1":"",r.useUv2?"#define USE_UV2":"",r.fog?"#define USE_FOG":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.useSkinning?"#define USE_SKINNING":"",r.bonesNum>0?"#define MAX_BONES "+r.bonesNum:"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","\n"].filter(gf).join("\n"),s=[r.useStandardDerivatives&&r.version<2?"#extension GL_OES_standard_derivatives : enable":"",r.useShaderTextureLOD&&r.version<2?"#extension GL_EXT_shader_texture_lod : enable":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth&&r.version<2?"#extension GL_EXT_frag_depth : enable":"","precision "+r.precision+" float;","precision "+r.precision+" int;","precision "+r.precision+" sampler2D;",r.version>=2?"precision "+r.precision+" sampler2DShadow;":"",r.version>=2?"precision "+r.precision+" samplerCubeShadow;":"","#define SHADER_NAME "+r.shaderName,"#define PI 3.14159265359","#define EPSILON 1e-6","float pow2(const in float x) { return x * x; }","#define LOG2 1.442695","#define RECIPROCAL_PI 0.31830988618","#define saturate(a) clamp(a, 0.0, 1.0)","#define whiteCompliment(a) (1.0 - saturate(a))","highp float rand(const in vec2 uv) {","\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;","\thighp float dt = dot(uv.xy, vec2(a, b)), sn = mod(dt, PI);","\treturn fract(sin(sn) * c);","}",t,r.version>=2?"#define WEBGL2":"",r.useShadowSampler?"#define USE_SHADOW_SAMPLER":"#define sampler2DShadow sampler2D",r.useRoughnessMap?"#define USE_ROUGHNESSMAP":"",r.useMetalnessMap?"#define USE_METALNESSMAP":"",r.useGlossinessMap?"#define USE_GLOSSINESSMAP":"",r.useClearcoat?"#define USE_CLEARCOAT":"",r.useClearcoatMap?"#define USE_CLEARCOATMAP":"",r.useClearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.useClearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.useAmbientLight?"#define USE_AMBIENT_LIGHT":"",r.pointLightNum>0||r.directLightNum>0||r.useAmbientLight||r.hemisphereLightNum>0||r.spotLightNum>0?"#define USE_LIGHT":"",r.useNormalMap?"#define USE_NORMAL_MAP":"",r.useBumpMap?"#define USE_BUMPMAP":"",r.useSpecularMap?"#define USE_SPECULARMAP":"",r.useEmissiveMap?"#define USE_EMISSIVEMAP "+r.useEmissiveMap:"",r.useShadow?"#define USE_SHADOW":"",r.shadowType===qc.HARD?"#define USE_HARD_SHADOW":"",r.shadowType===qc.POISSON_SOFT?"#define USE_POISSON_SOFT_SHADOW":"",r.shadowType===qc.PCF3_SOFT?"#define USE_PCF3_SOFT_SHADOW":"",r.shadowType===qc.PCF5_SOFT?"#define USE_PCF5_SOFT_SHADOW":"",r.shadowType===qc.PCSS16_SOFT?"#define USE_PCSS16_SOFT_SHADOW":"",r.shadowType===qc.PCSS32_SOFT?"#define USE_PCSS32_SOFT_SHADOW":"",r.shadowType===qc.PCSS64_SOFT?"#define USE_PCSS64_SOFT_SHADOW":"",r.shadowType===qc.PCSS16_SOFT||r.shadowType===qc.PCSS32_SOFT||r.shadowType===qc.PCSS64_SOFT?"#define USE_PCSS_SOFT_SHADOW":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.useShaderTextureLOD?"#define TEXTURE_LOD_EXT":"",r.useDiffuseMap?"#define USE_DIFFUSE_MAP "+r.useDiffuseMap:"",r.useAlphaMap?"#define USE_ALPHA_MAP "+r.useAlphaMap:"",r.useEnvMap?"#define USE_ENV_MAP":"",r.useAOMap?"#define USE_AOMAP "+r.useAOMap:"",r.useVertexColors==Yc.RGB?"#define USE_VCOLOR_RGB":"",r.useVertexColors==Yc.RGBA?"#define USE_VCOLOR_RGBA":"",r.useVertexTangents?"#define USE_TANGENT":"",r.premultipliedAlpha?"#define USE_PREMULTIPLIED_ALPHA":"",r.fog?"#define USE_FOG":"",r.fogExp2?"#define USE_EXP2_FOG":"",r.alphaTest?"#define ALPHATEST "+r.alphaTest:"",r.useEnvMap?"#define "+r.envMapCombine:"","#define GAMMA_FACTOR "+r.gammaFactor,r.useMatcap?"#define USE_MATCAP":"",r.useUv1?"#define USE_UV1":"",r.useUv2?"#define USE_UV2":"",r.dithering?"#define DITHERING":"",of.encodings_pars_frag,pf("mapTexelToLinear",r.diffuseMapEncoding),r.useEnvMap?pf("envMapTexelToLinear",r.envMapEncoding):"",r.useEmissiveMap?pf("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.useMatcap?pf("matcapTexelToLinear",r.matcapEncoding):"",ff("linearToOutputTexel",r.outputEncoding),r.packDepthToRGBA?"#define DEPTH_PACKING_RGBA":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","\n"].filter(gf).join("\n"),o=n,l=i;if(o=mf(o),l=mf(l),o=_f(o,r),l=_f(l,r),o=vf(o,r),l=vf(l,r),o=bf(o),l=bf(l),r.version>1){a=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+a,l=l.replace("#extension GL_EXT_draw_buffers : require","");let e=0;const t=[];for(;l.indexOf("gl_FragData["+e+"]")>-1;)l=l.replace("gl_FragData["+e+"]","pc_fragData"+e),t.push("layout(location = "+e+") out highp vec4 pc_fragData"+e+";"),e++;s=["#version 300 es\n","#define varying in",l.indexOf("layout")>-1||t.length>0?"":"out highp vec4 pc_fragColor;","#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad",t.join("\n")].join("\n")+"\n"+s}return o=a+o,l=s+l,new nf(e,o,l)}(this._gl,t,a,r,l),o.compile(n),o.code=s,i.push(o)}return o}releaseProgram(e){if(0==--e.usedTimes){const t=this._programs,r=t.indexOf(e);t[r]=t[t.length-1],t.pop(),e.dispose(this._gl)}}}function hf(e){let t;return e?e.encoding&&(t=e.encoding):t=Xc.LINEAR,t}function df(e){switch(e){case Xc.LINEAR:return["Linear","(value)"];case Xc.SRGB:return["sRGB","(value)"];case Xc.RGBE:return["RGBE","(value)"];case Xc.RGBM7:return["RGBM","(value, 7.0)"];case Xc.RGBM16:return["RGBM","(value, 16.0)"];case Xc.RGBD:return["RGBD","(value, 256.0)"];case Xc.GAMMA:return["Gamma","(value, float(GAMMA_FACTOR))"];default:console.error("unsupported encoding: "+e)}}function pf(e,t){const r=df(t);return"vec4 "+e+"(vec4 value) { return "+r[0]+"ToLinear"+r[1]+"; }"}function ff(e,t){const r=df(t);return"vec4 "+e+"(vec4 value) { return LinearTo"+r[0]+r[1]+"; }"}const mf=function(e){return e.replace(/#include +<([\w\d.]+)>/g,(function(e,t){const r=of[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return mf(r)}))};function gf(e){return""!==e}function _f(e,t){return e.replace(/NUM_HEMI_LIGHTS/g,t.hemisphereLightNum).replace(/NUM_DIR_LIGHTS/g,t.directLightNum).replace(/NUM_SPOT_LIGHTS/g,t.spotLightNum).replace(/NUM_POINT_LIGHTS/g,t.pointLightNum).replace(/NUM_DIR_SHADOWS/g,t.directShadowNum).replace(/NUM_SPOT_SHADOWS/g,t.spotShadowNum).replace(/NUM_POINT_SHADOWS/g,t.pointShadowNum)}function vf(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes)}const yf=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function xf(e,t,r,n){let i="";for(let e=parseInt(t);e<parseInt(r);e++)i+=n.replace(/\[\s*i\s*\]/g,"["+e+"]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function bf(e){return e.replace(yf,xf)}class Af{constructor(e){this._gl=e,this._extensions={},this.version=parseFloat(/^WebGL\ (\d)/.exec(e.getParameter(e.VERSION))[1]);const t=this.getExtension("EXT_texture_filter_anisotropic");this.anisotropyExt=t,this.maxAnisotropy=null!==t?e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1;let r=null,n=!1;try{this.version>1?(r=this.getExtension("EXT_disjoint_timer_query_webgl2"),r&&(n=(e.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)??0)>0)):(r=this.getExtension("EXT_disjoint_timer_query"),r&&(n=(r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)??0)>0))}catch(e){console.warn(e)}this.timerQuery=r,this.canUseTimestamp=n,this.maxPrecision=function(e,t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}if("mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0)return"mediump";return"lowp"}(e,"highp"),this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxVertexUniformVectors=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxSamples=this.version>1?e.getParameter(e.MAX_SAMPLES):1,this.lineWidthRange=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE)}getExtension(e){const t=this._gl,r=this._extensions;if(void 0!==r[e])return r[e];let n=null;for(let r in Sf)if(n=t.getExtension(Sf[r]+e),n)break;return r[e]=n,n}}const Sf=["","WEBKIT_","MOZ_"];class Ef{constructor(e,t){this._gl=e,this._capabilities=t}getGLType(e){const t=this._gl,r=this._capabilities,n=r.version>=2;if(e===jc.UNSIGNED_BYTE)return t.UNSIGNED_BYTE;if(e===jc.UNSIGNED_SHORT_5_6_5)return t.UNSIGNED_SHORT_5_6_5;if(e===jc.UNSIGNED_SHORT_4_4_4_4)return t.UNSIGNED_SHORT_4_4_4_4;if(e===jc.UNSIGNED_SHORT_5_5_5_1)return t.UNSIGNED_SHORT_5_5_5_1;let i;if(n){if(e===jc.UNSIGNED_SHORT)return t.UNSIGNED_SHORT;if(e===jc.UNSIGNED_INT)return t.UNSIGNED_INT;if(e===jc.UNSIGNED_INT_24_8)return t.UNSIGNED_INT_24_8;if(e===jc.FLOAT)return t.FLOAT;if(e===jc.HALF_FLOAT)return t.HALF_FLOAT;if(e===jc.FLOAT_32_UNSIGNED_INT_24_8_REV)return t.FLOAT_32_UNSIGNED_INT_24_8_REV;if(e===jc.BYTE)return t.BYTE;if(e===jc.SHORT)return t.SHORT;if(e===jc.INT)return t.INT}else{if(e===jc.UNSIGNED_SHORT||e===jc.UNSIGNED_INT||e===jc.UNSIGNED_INT_24_8){if(i=r.getExtension("WEBGL_depth_texture"),!i)return console.warn("extension WEBGL_depth_texture is not support."),null;if(e===jc.UNSIGNED_SHORT)return t.UNSIGNED_SHORT;if(e===jc.UNSIGNED_INT)return t.UNSIGNED_INT;if(e===jc.UNSIGNED_INT_24_8)return i.UNSIGNED_INT_24_8_WEBGL}if(e===jc.FLOAT)return i=r.getExtension("OES_texture_float"),i?t.FLOAT:(console.warn("extension OES_texture_float is not support."),null);if(e===jc.HALF_FLOAT)return i=r.getExtension("OES_texture_half_float"),i?i.HALF_FLOAT_OES:(console.warn("extension OES_texture_half_float is not support."),null)}return void 0!==t[e]?t[e]:e}getGLFormat(e){const t=this._gl,r=this._capabilities;if(e===zc.RGB)return t.RGB;if(e===zc.RGBA)return t.RGBA;if(e===zc.ALPHA)return t.ALPHA;if(e===zc.LUMINANCE)return t.LUMINANCE;if(e===zc.LUMINANCE_ALPHA)return t.LUMINANCE_ALPHA;if(e===zc.DEPTH_COMPONENT)return t.DEPTH_COMPONENT;if(e===zc.DEPTH_STENCIL)return t.DEPTH_STENCIL;if(e===zc.RED)return t.RED;if(e===zc.RED_INTEGER)return t.RED_INTEGER;if(e===zc.RG)return t.RG;if(e===zc.RG_INTEGER)return t.RG_INTEGER;if(e===zc.RGB_INTEGER)return t.RGB_INTEGER;if(e===zc.RGBA_INTEGER)return t.RGBA_INTEGER;let n;if(e===zc.RGB_S3TC_DXT1||e===zc.RGBA_S3TC_DXT1||e===zc.RGBA_S3TC_DXT3||e===zc.RGBA_S3TC_DXT5){if(n=r.getExtension("WEBGL_compressed_texture_s3tc"),!n)return console.warn("extension WEBGL_compressed_texture_s3tc is not support."),null;if(e===zc.RGB_S3TC_DXT1)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===zc.RGBA_S3TC_DXT1)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===zc.RGBA_S3TC_DXT3)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===zc.RGBA_S3TC_DXT5)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===zc.RGB_PVRTC_4BPPV1||e===zc.RGB_PVRTC_2BPPV1||e===zc.RGBA_PVRTC_4BPPV1||e===zc.RGBA_PVRTC_2BPPV1){if(n=r.getExtension("WEBGL_compressed_texture_pvrtc"),!n)return console.warn("extension WEBGL_compressed_texture_pvrtc is not support."),null;if(e===zc.RGB_PVRTC_4BPPV1)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===zc.RGB_PVRTC_2BPPV1)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===zc.RGBA_PVRTC_4BPPV1)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===zc.RGBA_PVRTC_2BPPV1)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return e===zc.RGB_ETC1?(n=r.getExtension("WEBGL_compressed_texture_etc1"),n?n.COMPRESSED_RGB_ETC1_WEBGL:(console.warn("extension WEBGL_compressed_texture_etc1 is not support."),null)):e===zc.RGBA_ASTC_4x4?(n=r.getExtension("WEBGL_compressed_texture_astc"),n?n.COMPRESSED_RGBA_ASTC_4x4_KHR:(console.warn("extension WEBGL_compressed_texture_astc is not support."),null)):e===zc.RGBA_BPTC?(n=r.getExtension("EXT_texture_compression_bptc"),n?n.COMPRESSED_RGBA_BPTC_UNORM_EXT:(console.warn("extension EXT_texture_compression_bptc is not support."),null)):void 0!==t[e]?t[e]:e}getGLInternalFormat(e){const t=this._gl,r=this._capabilities,n=r.version>=2;if(e===zc.RGBA4)return t.RGBA4;if(e===zc.RGB5_A1)return t.RGB5_A1;if(e===zc.DEPTH_COMPONENT16)return t.DEPTH_COMPONENT16;if(e===zc.STENCIL_INDEX8)return t.STENCIL_INDEX8;if(e===zc.DEPTH_STENCIL)return t.DEPTH_STENCIL;let i;if(n){if(e===zc.R8)return t.R8;if(e===zc.RG8)return t.RG8;if(e===zc.RGB8)return t.RGB8;if(e===zc.RGBA8)return t.RGBA8;if(e===zc.DEPTH_COMPONENT24)return t.DEPTH_COMPONENT24;if(e===zc.DEPTH_COMPONENT32F)return t.DEPTH_COMPONENT32F;if(e===zc.DEPTH24_STENCIL8)return t.DEPTH24_STENCIL8;if(e===zc.DEPTH32F_STENCIL8)return t.DEPTH32F_STENCIL8;if(e===zc.R16F||e===zc.RG16F||e===zc.RGB16F||e===zc.RGBA16F||e===zc.R32F||e===zc.RG32F||e===zc.RGB32F||e===zc.RGBA32F){if(i=r.getExtension("EXT_color_buffer_float"),!i)return console.warn("extension EXT_color_buffer_float is not support."),null;if(e===zc.R16F)return t.R16F;if(e===zc.RG16F)return t.RG16F;if(e===zc.RGB16F)return t.RGB16F;if(e===zc.RGBA16F)return t.RGBA16F;if(e===zc.R32F)return t.R32F;if(e===zc.RG32F)return t.RG32F;if(e===zc.RGB32F)return t.RGB32F;if(e===zc.RGBA32F)return t.RGBA32F}}else if(e===zc.RGBA32F||e===zc.RGB32F){if(i=r.getExtension("WEBGL_color_buffer_float"),!i)return console.warn("extension WEBGL_color_buffer_float is not support."),null;if(e===zc.RGBA32F)return i.RGBA32F_EXT;if(e===zc.RGB32F)return i.RGB32F_EXT}return void 0!==t[e]?t[e]:e}}function wf(e,t,r,n){const i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let t=0;t<n;t++)e.texImage2D(r+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return a}function Cf(e){let t=!1;const r=new Zh;let n=null;const i=new Zh(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,n,a,s,o){!0===o&&(t*=s,n*=s,a*=s),r.set(t,n,a,s),!1===i.equals(r)&&(e.clearColor(t,n,a,s),i.copy(r))},getClear:function(){return i},reset:function(){t=!1,n=null,i.set(-1,0,0,0)}}}function Tf(e,t){let r=!1,n=null,i=null,a=null;return{setTest:function(r){r?t.enable(e.DEPTH_TEST):t.disable(e.DEPTH_TEST)},setMask:function(t){n===t||r||(e.depthMask(t),n=t)},setFunc:function(t){i!==t&&(e.depthFunc(t),i=t)},setLocked:function(e){r=e},setClear:function(t){a!==t&&(e.clearDepth(t),a=t)},reset:function(){r=!1,n=null,i=null,a=null}}}function Df(e,t){let r=!1,n=null,i=null,a=null,s=null,o=null,l=null,u=null,c=null,h=null,d=null,p=null,f=null,m=null,g=null;return{setTest:function(r){r?t.enable(e.STENCIL_TEST):t.disable(e.STENCIL_TEST)},setMask:function(t){n===t||r||(e.stencilMask(t),n=t)},setFunc:function(t,r,n,o,l,u){i===t&&a===r&&s===n&&c===o&&h===l&&d===u||(null===o||null===l||null===u?e.stencilFunc(t,r,n):(e.stencilFuncSeparate(e.FRONT,t,r,n),e.stencilFuncSeparate(e.BACK,o,l,u)),i=t,a=r,s=n,c=o,h=l,d=u)},setOp:function(t,r,n,i,a,s){o===t&&l===r&&u===n&&p===i&&f===a&&m===s||(null===i||null===a||null===s?e.stencilOp(t,r,n):(e.stencilOpSeparate(e.FRONT,t,r,n),e.stencilOpSeparate(e.BACK,i,a,s)),o=t,l=r,u=n,p=i,f=a,m=s)},setLocked:function(e){r=e},setClear:function(t){g!==t&&(e.clearStencil(t),g=t)},reset:function(){r=!1,n=null,i=null,a=null,s=null,o=null,l=null,u=null,c=null,h=null,d=null,p=null,f=null,m=null,g=null}}}class Mf{constructor(e,t){this.gl=e,this.capabilities=t,this.colorBuffer=new Cf(e),this.depthBuffer=new Tf(e,this),this.stencilBuffer=new Df(e,this),this.states={},this.currentBlending=null,this.currentBlendEquation=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendEquationAlpha=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipliedAlpha=null,this.currentFlipSided=!1,this.currentCullFace=null;const r=e.getParameter(e.VIEWPORT);this.currentViewport=(new Zh).fromArray(r),this.currentLineWidth=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentProgram=null,this.currentBoundBuffers={},this.currentRenderTarget=null,this.currentTextureSlot=null,this.currentBoundTextures={},this.emptyTextures={},this.emptyTextures[e.TEXTURE_2D]=wf(e,e.TEXTURE_2D,e.TEXTURE_2D,1),this.emptyTextures[e.TEXTURE_CUBE_MAP]=wf(e,e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),this.blendEquationToGL={[Ic.ADD]:e.FUNC_ADD,[Ic.SUBTRACT]:e.FUNC_SUBTRACT,[Ic.REVERSE_SUBTRACT]:e.FUNC_REVERSE_SUBTRACT},this.blendFactorToGL={[Oc.ZERO]:e.ZERO,[Oc.ONE]:e.ONE,[Oc.SRC_COLOR]:e.SRC_COLOR,[Oc.SRC_ALPHA]:e.SRC_ALPHA,[Oc.SRC_ALPHA_SATURATE]:e.SRC_ALPHA_SATURATE,[Oc.DST_COLOR]:e.DST_COLOR,[Oc.DST_ALPHA]:e.DST_ALPHA,[Oc.ONE_MINUS_SRC_COLOR]:e.ONE_MINUS_SRC_COLOR,[Oc.ONE_MINUS_SRC_ALPHA]:e.ONE_MINUS_SRC_ALPHA,[Oc.ONE_MINUS_DST_COLOR]:e.ONE_MINUS_DST_COLOR,[Oc.ONE_MINUS_DST_ALPHA]:e.ONE_MINUS_DST_ALPHA},this.colorBuffer.setClear(0,0,0,1),this.depthBuffer.setClear(1),this.stencilBuffer.setClear(0),this.depthBuffer.setTest(!0),this.depthBuffer.setFunc(Wc.LEQUAL),this.setFlipSided(!1),this.setCullFace(kc.BACK)}enable(e){!0!==this.states[e]&&(this.gl.enable(e),this.states[e]=!0)}disable(e){!1!==this.states[e]&&(this.gl.disable(e),this.states[e]=!1)}setBlending(e,t,r,n,i,a,s,o){const l=this.gl;if(e!==Bc.NONE){if(this.enable(l.BLEND),e!==Bc.CUSTOM)e===this.currentBlending&&o===this.currentPremultipliedAlpha||(this.currentBlendEquation===Ic.ADD&&this.currentBlendEquationAlpha===Ic.ADD||(l.blendEquation(l.FUNC_ADD),this.currentBlendEquation=Ic.ADD,this.currentBlendEquationAlpha=Ic.ADD),e===Bc.NORMAL?o?l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA):l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA):e===Bc.ADD?o?l.blendFunc(l.ONE,l.ONE):l.blendFunc(l.SRC_ALPHA,l.ONE):e===Bc.SUB?l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE):e===Bc.MUL?o?l.blendFuncSeparate(l.ZERO,l.SRC_COLOR,l.ZERO,l.SRC_ALPHA):l.blendFunc(l.ZERO,l.SRC_COLOR):console.error("WebGLState: Invalid blending: ",e)),this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null;else{i=i||t,a=a||r,s=s||n;const e=this.blendEquationToGL,o=this.blendFactorToGL;t===this.currentBlendEquation&&i===this.currentBlendEquationAlpha||(l.blendEquationSeparate(e[t],e[i]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=i),r===this.currentBlendSrc&&n===this.currentBlendDst&&a===this.currentBlendSrcAlpha&&s===this.currentBlendDstAlpha||(l.blendFuncSeparate(o[r],o[n],o[a],o[s]),this.currentBlendSrc=r,this.currentBlendDst=n,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=s)}this.currentBlending=e,this.currentPremultipliedAlpha=o}else this.disable(l.BLEND)}setFlipSided(e){const t=this.gl;this.currentFlipSided!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e)}setCullFace(e){const t=this.gl;e!==kc.NONE?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===kc.BACK?t.cullFace(t.BACK):e===kc.FRONT?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}viewport(e,t,r,n){const i=this.currentViewport;if(i.x!==e||i.y!==t||i.z!==r||i.w!==n){this.gl.viewport(e,t,r,n),i.set(e,t,r,n)}}setLineWidth(e){if(e!==this.currentLineWidth){const t=this.capabilities.lineWidthRange;t[0]<=e&&e<=t[1]?this.gl.lineWidth(e):console.warn("GL_ALIASED_LINE_WIDTH_RANGE is ["+t[0]+","+t[1]+"], but set to "+e+"."),this.currentLineWidth=e}}setPolygonOffset(e,t,r){const n=this.gl;e?(this.enable(n.POLYGON_OFFSET_FILL),this.currentPolygonOffsetFactor===t&&this.currentPolygonOffsetUnits===r||(n.polygonOffset(t,r),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=r)):this.disable(n.POLYGON_OFFSET_FILL)}setProgram(e){this.currentProgram!==e&&(this.gl.useProgram(e.program),this.currentProgram=e)}bindBuffer(e,t){const r=this.gl;this.currentBoundBuffers[e]!==t&&(r.bindBuffer(e,t),this.currentBoundBuffers[e]=t)}activeTexture(e){const t=this.gl;void 0===e&&(e=t.TEXTURE0+this.capabilities.maxTextures-1),this.currentTextureSlot!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t){const r=this.gl;null===this.currentTextureSlot&&this.activeTexture();let n=this.currentBoundTextures[this.currentTextureSlot];void 0===n&&(n={type:void 0,texture:void 0},this.currentBoundTextures[this.currentTextureSlot]=n),n.type===e&&n.texture===t||(r.bindTexture(e,t||this.emptyTextures[e]),n.type=e,n.texture=t)}reset(){const e=this.gl;e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.cullFace(e.BACK),e.frontFace(e.CCW),e.viewport(0,0,e.canvas.width,e.canvas.height),e.lineWidth(1),e.polygonOffset(0,0),e.useProgram(null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.activeTexture(e.TEXTURE0),this.colorBuffer.reset(),this.depthBuffer.reset(),this.stencilBuffer.reset(),this.states={},this.currentBlending=null,this.currentBlendEquation=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendEquationAlpha=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipliedAlpha=null,this.currentFlipSided=!1,this.currentCullFace=null,this.currentViewport.set(0,0,e.canvas.width,e.canvas.height),this.currentLineWidth=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentProgram=null,this.currentBoundBuffers={},this.currentRenderTarget=null,this.currentTextureSlot=null,this.currentBoundTextures={}}setMaterial(e,t){this.setCullFace(e.side===Lc.DOUBLE?kc.NONE:kc.BACK);let r=e.side===Lc.BACK;t&&(r=!r),this.setFlipSided(r),e.blending===Bc.NORMAL&&!1===e.transparent?this.setBlending(Bc.NONE):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.depthBuffer.setFunc(e.depthFunc),this.depthBuffer.setTest(e.depthTest),this.depthBuffer.setMask(e.depthWrite),this.colorBuffer.setMask(e.colorWrite);const n=e.stencilTest;this.stencilBuffer.setTest(n),n&&(this.stencilBuffer.setMask(e.stencilWriteMask),this.stencilBuffer.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask,e.stencilFuncBack,e.stencilRefBack,e.stencilFuncMaskBack),this.stencilBuffer.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass,e.stencilFailBack,e.stencilZFailBack,e.stencilZPassBack)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),void 0!==e.lineWidth&&this.setLineWidth(e.lineWidth),!0===e.alphaToCoverage?this.enable(this.gl.SAMPLE_ALPHA_TO_COVERAGE):this.disable(this.gl.SAMPLE_ALPHA_TO_COVERAGE)}}class Pf{constructor(e){this._key="__webgl$"+e,this._count=0}get(e){const t=this._key;let r=e[t];return void 0===r&&(r={},e[t]=r,this._count++),r}delete(e){const t=this._key;e[t]&&(this._count--,delete e[t])}size(){return this._count}}class Ff extends Pf{constructor(e,t,r,n,i){super(e),this._gl=t,this._state=r,this._capabilities=n,this._constants=i,this._usedTextureUnits=0;const a=this;this._onTextureDispose=function e(r){const n=r.target,i=a.get(n);n.removeEventListener("dispose",e),i.__webglTexture&&!i.__external&&t.deleteTexture(i.__webglTexture),a.delete(n)},this._wrappingToGL={[Gc.REPEAT]:t.REPEAT,[Gc.CLAMP_TO_EDGE]:t.CLAMP_TO_EDGE,[Gc.MIRRORED_REPEAT]:t.MIRRORED_REPEAT},this._filterToGL={[Vc.NEAREST]:t.NEAREST,[Vc.LINEAR]:t.LINEAR,[Vc.NEAREST_MIPMAP_NEAREST]:t.NEAREST_MIPMAP_NEAREST,[Vc.LINEAR_MIPMAP_NEAREST]:t.LINEAR_MIPMAP_NEAREST,[Vc.NEAREST_MIPMAP_LINEAR]:t.NEAREST_MIPMAP_LINEAR,[Vc.LINEAR_MIPMAP_LINEAR]:t.LINEAR_MIPMAP_LINEAR}}allocTexUnit(){const e=this._usedTextureUnits++;return e>=this._capabilities.maxTextures&&console.warn("trying to use "+e+" texture units while this GPU supports only "+this._capabilities.maxTextures),e}resetTextureUnits(){this._usedTextureUnits=0}setTexture2D(e,t){const r=this._gl,n=this._state,i=this._capabilities,a=this._constants;void 0!==t&&(t=r.TEXTURE0+t);const s=this.get(e);if(e.image&&s.__version!==e.version&&(!e.image.rtt||void 0===t)&&!s.__external){void 0===s.__webglTexture&&(e.addEventListener("dispose",this._onTextureDispose),s.__webglTexture=r.createTexture()),n.activeTexture(t),n.bindTexture(r.TEXTURE_2D,s.__webglTexture);let o=e.image;const l=Lf(o);l&&(o=Of(o,i.maxTextureSize),Rf(e)&&!1===Bf(o)&&i.version<2&&(o=If(o)));const u=!Bf(o)&&i.version<2;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,e.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),this._setTextureParameters(e,u);const c=a.getGLFormat(e.format),h=a.getGLType(e.type),d=null!==e.internalformat?a.getGLInternalFormat(e.internalformat):kf(r,i,c,h),p=e.mipmaps;let f;if(l)if(p.length>0&&!u){for(let e=0,t=p.length;e<t;e++)f=p[e],r.texImage2D(r.TEXTURE_2D,e,d,c,h,f);e.generateMipmaps=!1,s.__maxMipLevel=p.length-1}else r.texImage2D(r.TEXTURE_2D,0,d,c,h,o),s.__maxMipLevel=0;else if(p.length>0&&!u){const t=o.isCompressed;for(let n=0,i=p.length;n<i;n++)f=p[n],t?r.compressedTexImage2D(r.TEXTURE_2D,n,d,f.width,f.height,0,f.data):r.texImage2D(r.TEXTURE_2D,n,d,f.width,f.height,e.border,c,h,f.data);e.generateMipmaps=!1,s.__maxMipLevel=p.length-1}else r.texImage2D(r.TEXTURE_2D,0,d,o.width,o.height,e.border,c,h,o.data),s.__maxMipLevel=0;return e.generateMipmaps&&!u&&this._generateMipmap(r.TEXTURE_2D,e,o.width,o.height),s.__version=e.version,s}return n.activeTexture(t),n.bindTexture(r.TEXTURE_2D,s.__webglTexture),s}setTextureCube(e,t){const r=this._gl,n=this._state,i=this._capabilities,a=this._constants;void 0!==t&&(t=r.TEXTURE0+t);const s=this.get(e);if(!(6!==e.images.length||s.__version===e.version||e.images[0].rtt&&void 0!==t||s.__external)){void 0===s.__webglTexture&&(e.addEventListener("dispose",this._onTextureDispose),s.__webglTexture=r.createTexture()),n.activeTexture(t),n.bindTexture(r.TEXTURE_CUBE_MAP,s.__webglTexture);const o=[];let l=!1;for(let t=0;t<6;t++){let r=e.images[t];const n=Lf(r);n&&(r=Of(r,i.maxTextureSize),Rf(e)&&!1===Bf(r)&&i.version<2&&(r=If(r))),!Bf(r)&&i.version<2&&(l=!0),o[t]=r,r.__isDom=n}r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,e.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),this._setTextureParameters(e,l);const u=a.getGLFormat(e.format),c=a.getGLType(e.type),h=null!==e.internalformat?a.getGLInternalFormat(e.internalformat):kf(r,i,u,c),d=e.mipmaps;let p;for(let t=0;t<6;t++){const n=o[t];if(n.__isDom)if(d.length>0&&!l){for(let e=0,n=d.length;e<n;e++)p=d[e][t],r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,h,u,c,p);s.__maxMipLevel=d.length-1,e.generateMipmaps=!1}else r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,h,u,c,n),s.__maxMipLevel=0;else if(d.length>0&&!l){const i=n.isCompressed;for(let n=0,a=d.length;n<a;n++)p=d[n][t],i?r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,h,p.width,p.height,0,p.data):r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,h,p.width,p.height,e.border,u,c,p.data);s.__maxMipLevel=d.length-1,e.generateMipmaps=!1}else r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,h,n.width,n.height,e.border,u,c,n.data),s.__maxMipLevel=0}return e.generateMipmaps&&!l&&this._generateMipmap(r.TEXTURE_CUBE_MAP,e,o[0].width,o[0].height),s.__version=e.version,s}return n.activeTexture(t),n.bindTexture(r.TEXTURE_CUBE_MAP,s.__webglTexture),s}setTexture3D(e,t){const r=this._gl,n=this._state,i=this._capabilities,a=this._constants;if(i.version<2)return void console.warn("Try to use Texture3D but browser not support WebGL2.0");void 0!==t&&(t=r.TEXTURE0+t);const s=this.get(e);if(e.image&&s.__version!==e.version&&!s.__external){void 0===s.__webglTexture&&(e.addEventListener("dispose",this._onTextureDispose),s.__webglTexture=r.createTexture()),n.activeTexture(t),n.bindTexture(r.TEXTURE_3D,s.__webglTexture);const o=e.image;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,e.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),this._setTextureParameters(e,!1);const l=a.getGLFormat(e.format),u=a.getGLType(e.type),c=null!==e.internalformat?a.getGLInternalFormat(e.internalformat):kf(r,i,l,u);return r.texImage3D(r.TEXTURE_3D,0,c,o.width,o.height,o.depth,e.border,l,u,o.data),e.generateMipmaps&&this._generateMipmap(r.TEXTURE_3D,e,o.width,o.height),s.__version=e.version,s}return n.activeTexture(t),n.bindTexture(r.TEXTURE_3D,s.__webglTexture),s}setTextureExternal(e,t){const r=this._gl,n=this.get(e);n.__external||(n.__webglTexture?r.deleteTexture(n.__webglTexture):e.addEventListener("dispose",this._onTextureDispose)),n.__webglTexture=t,n.__external=!0}_setTextureParameters(e,t){const r=this._gl,n=this._capabilities,i=this._wrappingToGL,a=this._filterToGL;let s=r.TEXTURE_2D;e.isTextureCube&&(s=r.TEXTURE_CUBE_MAP),e.isTexture3D&&(s=r.TEXTURE_3D);const o=function(e,t){let r=e.wrapS,n=e.wrapT,i=e.wrapR,a=e.magFilter,s=e.minFilter;const o=e.anisotropy,l=e.compare;t&&(r=Gc.CLAMP_TO_EDGE,n=Gc.CLAMP_TO_EDGE,e.isTexture3D&&(i=Gc.CLAMP_TO_EDGE),e.wrapS===Gc.CLAMP_TO_EDGE&&e.wrapT===Gc.CLAMP_TO_EDGE||console.warn("Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to t3d.TEXTURE_WRAP.CLAMP_TO_EDGE.",e),a=Nf(e.magFilter),s=Nf(e.minFilter),(e.minFilter!==Vc.NEAREST&&e.minFilter!==Vc.LINEAR||e.magFilter!==Vc.NEAREST&&e.magFilter!==Vc.LINEAR)&&console.warn("Texture is not power of two. Texture.minFilter and Texture.magFilter should be set to t3d.TEXTURE_FILTER.NEAREST or t3d.TEXTURE_FILTER.LINEAR.",e));return[r,n,i,a,s,o,l]}(e,t);r.texParameteri(s,r.TEXTURE_WRAP_S,i[o[0]]),r.texParameteri(s,r.TEXTURE_WRAP_T,i[o[1]]),e.isTexture3D&&r.texParameteri(s,r.TEXTURE_WRAP_R,i[o[2]]),r.texParameteri(s,r.TEXTURE_MAG_FILTER,a[o[3]]),r.texParameteri(s,r.TEXTURE_MIN_FILTER,a[o[4]]);const l=n.anisotropyExt;l&&r.texParameterf(s,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o[5],n.maxAnisotropy)),n.version>=2&&(void 0!==o[6]?(r.texParameteri(s,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(s,r.TEXTURE_COMPARE_FUNC,o[6])):r.texParameteri(s,r.TEXTURE_COMPARE_MODE,r.NONE))}_generateMipmap(e,t,r,n){this._gl.generateMipmap(e);this.get(t).__maxMipLevel=Math.log(Math.max(r,n))*Math.LOG2E}}function Rf(e){return e.wrapS!==Gc.CLAMP_TO_EDGE||e.wrapT!==Gc.CLAMP_TO_EDGE||e.minFilter!==Vc.NEAREST&&e.minFilter!==Vc.LINEAR}function Nf(e){return e===Vc.NEAREST||e===Vc.NEAREST_MIPMAP_LINEAR||e===Vc.NEAREST_MIPMAP_NEAREST?Vc.NEAREST:Vc.LINEAR}function Bf(e){return ed(e.width)&&ed(e.height)}function If(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");t.width=td(e.width),t.height=td(e.height);return t.getContext("2d").drawImage(e,0,0,t.width,t.height),console.warn("image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}function Of(e,t){if(e.width>t||e.height>t){const r=t/Math.max(e.width,e.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=Math.floor(e.width*r),n.height=Math.floor(e.height*r);return n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.warn("image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}function kf(e,t,r,n){if(!1===t.version>=2)return r;let i=r;return r===e.RED&&(n===e.FLOAT&&(i=e.R32F),n===e.HALF_FLOAT&&(i=e.R16F),n===e.UNSIGNED_BYTE&&(i=e.R8)),r===e.RG&&(n===e.FLOAT&&(i=e.RG32F),n===e.HALF_FLOAT&&(i=e.RG16F),n===e.UNSIGNED_BYTE&&(i=e.RG8)),r===e.RGB&&(n===e.FLOAT&&(i=e.RGB32F),n===e.HALF_FLOAT&&(i=e.RGB16F),n===e.UNSIGNED_BYTE&&(i=e.RGB8)),r===e.RGBA&&(n===e.FLOAT&&(i=e.RGBA32F),n===e.HALF_FLOAT&&(i=e.RGBA16F),n===e.UNSIGNED_BYTE&&(i=e.RGBA8),n===e.UNSIGNED_SHORT_4_4_4_4&&(i=e.RGBA4),n===e.UNSIGNED_SHORT_5_5_5_1&&(i=e.RGB5_A1)),r!==e.DEPTH_COMPONENT&&r!==e.DEPTH_STENCIL||(i=e.DEPTH_COMPONENT16,n===e.FLOAT&&(i=e.DEPTH_COMPONENT32F),n===e.UNSIGNED_INT&&(i=e.DEPTH_COMPONENT24),n===e.UNSIGNED_INT_24_8&&(i=e.DEPTH24_STENCIL8),n===e.FLOAT_32_UNSIGNED_INT_24_8_REV&&(i=e.DEPTH32F_STENCIL8)),i!==e.R16F&&i!==e.R32F&&i!==e.RG16F&&i!==e.RG32F&&i!==e.RGB16F&&i!==e.RGB32F&&i!==e.RGBA16F&&i!==e.RGBA32F||t.getExtension("EXT_color_buffer_float"),i}function Lf(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}class Uf extends Pf{constructor(e,t,r,n){super(e),this._gl=t,this._capabilities=r,this._constants=n;const i=this;this._onRenderBufferDispose=function e(r){const n=r.target;n.removeEventListener("dispose",e);const a=i.get(n);a.__webglRenderbuffer&&!a.__external&&t.deleteRenderbuffer(a.__webglRenderbuffer),i.delete(n)}}setRenderBuffer(e){const t=this._gl,r=this._capabilities,n=this._constants,i=this.get(e);if(void 0===i.__webglRenderbuffer){e.addEventListener("dispose",this._onRenderBufferDispose),i.__webglRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,i.__webglRenderbuffer);const a=n.getGLInternalFormat(e.format);e.multipleSampling>0?(r.version<2&&console.error("render buffer multipleSampling is not support in webgl 1.0."),t.renderbufferStorageMultisample(t.RENDERBUFFER,Math.min(e.multipleSampling,r.maxSamples),a,e.width,e.height)):t.renderbufferStorage(t.RENDERBUFFER,a,e.width,e.height)}else t.bindRenderbuffer(t.RENDERBUFFER,i.__webglRenderbuffer);return i}setRenderBufferExternal(e,t){const r=this._gl,n=this.get(e);n.__external||(n.__webglRenderbuffer?r.deleteRenderbuffer(n.__webglRenderbuffer):e.addEventListener("dispose",this._onRenderBufferDispose)),n.__webglRenderbuffer=t,n.__external=!0}}class zf extends Pf{constructor(e,t,r,n,i,a,s){super(e),this._gl=t,this._state=r,this._capabilities=n,this._textures=i,this._renderBuffers=a,this._constants=s;const o=this;this._onRenderTargetDispose=function e(n){const i=n.target;i.removeEventListener("dispose",e);const a=o.get(i);a.__webglFramebuffer&&t.deleteFramebuffer(a.__webglFramebuffer),o.delete(i),r.currentRenderTarget===i&&(r.currentRenderTarget=null)}}_setupRenderTarget(e){const t=this._gl,r=this._state,n=this._textures,i=this._renderBuffers,a=this._capabilities,s=this.get(e);e.addEventListener("dispose",this._onRenderTargetDispose);const o=t.createFramebuffer(),l=[];s.__webglFramebuffer=o,s.__drawBuffers=l,e.isRenderTargetCube&&(s.__currentActiveCubeFace=e.activeCubeFace),t.bindFramebuffer(t.FRAMEBUFFER,o);for(const s in e._attachments){const o=jf[s];o===t.DEPTH_ATTACHMENT||o===t.DEPTH_STENCIL_ATTACHMENT?a.version<2&&!a.getExtension("WEBGL_depth_texture")&&console.warn("WebGLRenderTargets: extension WEBGL_depth_texture is not support."):o!==t.STENCIL_ATTACHMENT&&l.push(o);const u=e._attachments[s];if(u.isTexture2D){const e=n.setTexture2D(u);t.framebufferTexture2D(t.FRAMEBUFFER,o,t.TEXTURE_2D,e.__webglTexture,0),r.bindTexture(t.TEXTURE_2D,null)}else if(u.isTextureCube){const i=n.setTextureCube(u);t.framebufferTexture2D(t.FRAMEBUFFER,o,t.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,i.__webglTexture,0),r.bindTexture(t.TEXTURE_CUBE_MAP,null)}else{const e=i.setRenderBuffer(u);t.framebufferRenderbuffer(t.FRAMEBUFFER,o,t.RENDERBUFFER,e.__webglRenderbuffer)}}l.sort(Vf),a.version>=2?t.drawBuffers(l):a.getExtension("WEBGL_draw_buffers")&&a.getExtension("WEBGL_draw_buffers").drawBuffersWEBGL(l)}setRenderTarget(e){const t=this._gl,r=this._state,n=this._textures;let i;if(r.currentRenderTarget!==e&&(e.isRenderTargetBack?t.bindFramebuffer(t.FRAMEBUFFER,null):(i=this.get(e),void 0===i.__webglFramebuffer?this._setupRenderTarget(e):t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer)),r.currentRenderTarget=e),e.isRenderTargetCube){i=this.get(e);const r=e.activeCubeFace;if(i.__currentActiveCubeFace!==r){for(const i in e._attachments){const a=e._attachments[i];if(a.isTextureCube){const e=n.get(a);t.framebufferTexture2D(t.FRAMEBUFFER,jf[i],t.TEXTURE_CUBE_MAP_POSITIVE_X+r,e.__webglTexture,0)}}i.__currentActiveCubeFace=r}}}blitRenderTarget(e,t,r=!0,n=!0,i=!0){const a=this._gl,s=this._capabilities;if(s.version<2)return void console.warn("WebGLRenderTargets: blitFramebuffer not support by WebGL"+s.version);const o=this.get(e).__webglFramebuffer,l=this.get(t).__webglFramebuffer;a.bindFramebuffer(a.READ_FRAMEBUFFER,o),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,l);let u=0;r&&(u|=a.COLOR_BUFFER_BIT),n&&(u|=a.DEPTH_BUFFER_BIT),i&&(u|=a.STENCIL_BUFFER_BIT),a.blitFramebuffer(0,0,e.width,e.height,0,0,t.width,t.height,u,a.NEAREST)}readRenderTargetPixels(e,t,r,n,i){const a=this._gl,s=this._state,o=this._constants,l=s.currentRenderTarget;if(l&&l.texture){if(e>=0&&e<=l.width-r&&t>=0&&t<=l.height-n){const s=o.getGLType(l.texture.type),u=o.getGLFormat(l.texture.format);a.readPixels(e,t,r,n,u,s,i)}}else console.warn("WebGLRenderTargets.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not bound or texture not attached.")}updateRenderTargetMipmap(e){const t=this._gl,r=this._state,n=this._capabilities,i=e.texture;if(i.generateMipmaps&&i.minFilter!==Vc.NEAREST&&i.minFilter!==Vc.LINEAR&&(function(e){return ed(e.width)&&ed(e.height)}(e)||n.version>=2)){let e=t.TEXTURE_2D;i.isTextureCube&&(e=t.TEXTURE_CUBE_MAP),i.isTexture3D&&(e=t.TEXTURE_3D);const n=this._textures.get(i).__webglTexture;r.bindTexture(e,n),t.generateMipmap(e),r.bindTexture(e,null)}}}const jf={[Zc.COLOR_ATTACHMENT0]:36064,[Zc.COLOR_ATTACHMENT1]:36065,[Zc.COLOR_ATTACHMENT2]:36066,[Zc.COLOR_ATTACHMENT3]:36067,[Zc.COLOR_ATTACHMENT4]:36068,[Zc.COLOR_ATTACHMENT5]:36069,[Zc.COLOR_ATTACHMENT6]:36070,[Zc.COLOR_ATTACHMENT7]:36071,[Zc.COLOR_ATTACHMENT8]:36072,[Zc.COLOR_ATTACHMENT9]:36073,[Zc.COLOR_ATTACHMENT10]:36074,[Zc.COLOR_ATTACHMENT11]:36075,[Zc.COLOR_ATTACHMENT12]:36076,[Zc.COLOR_ATTACHMENT13]:36077,[Zc.COLOR_ATTACHMENT14]:36078,[Zc.COLOR_ATTACHMENT15]:36079,[Zc.DEPTH_ATTACHMENT]:36096,[Zc.STENCIL_ATTACHMENT]:36128,[Zc.DEPTH_STENCIL_ATTACHMENT]:33306};function Vf(e,t){return e-t}class Gf extends Pf{constructor(e,t,r){super(e),this._gl=t,this._capabilities=r}setBuffer(e,t,r){const n=this.get(e),i=void 0===n.glBuffer;(i||n.version!==e.version)&&(r&&r.reset(),i||n.__external?this._createGLBuffer(n,e,t):(this._updateGLBuffer(n.glBuffer,e,t),n.version=e.version))}removeBuffer(e){const t=this._gl,r=this.get(e);r.glBuffer&&!r.__external&&t.deleteBuffer(r.glBuffer),this.delete(e)}setBufferExternal(e,t){const r=this._gl,n=this.get(e);n.__external||n.glBuffer&&r.deleteBuffer(n.glBuffer);const i=Wf(r,e.array);n.glBuffer=t,n.type=i,n.bytesPerElement=e.array.BYTES_PER_ELEMENT,n.version=e.version,n.__external=!0}_createGLBuffer(e,t,r){const n=this._gl,i=t.array,a=t.usage,s=n.createBuffer();n.bindBuffer(r,s),n.bufferData(r,i,a),t.onUploadCallback();const o=Wf(n,i);e.glBuffer=s,e.type=o,e.bytesPerElement=i.BYTES_PER_ELEMENT,e.version=t.version,e.__external=!1}_updateGLBuffer(e,t,r){const n=this._gl,i=this._capabilities,a=t.array,s=t.updateRange;n.bindBuffer(r,e),-1===s.count?n.bufferSubData(r,0,a):(i.version>=2?n.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a,s.offset,s.count):n.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1)}}function Wf(e,t){let r;return t instanceof Float32Array?r=e.FLOAT:t instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array."):r=t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int16Array?e.SHORT:t instanceof Uint32Array?e.UNSIGNED_INT:t instanceof Int32Array?e.INT:t instanceof Int8Array?e.BYTE:t instanceof Uint8Array?e.UNSIGNED_BYTE:e.FLOAT,r}class Hf extends Pf{constructor(e,t,r,n){super(e),this._gl=t,this._buffers=r,this._vertexArrayBindings=n;const i=this;this._onGeometryDispose=function e(t){const a=t.target,s=i.get(a);a.removeEventListener("dispose",e),null!==a.index&&r.removeBuffer(a.index.buffer);for(const e in a.attributes)r.removeBuffer(a.attributes[e].buffer);for(const e in a.morphAttributes){const t=a.morphAttributes[e];for(let e=0,n=t.length;e<n;e++)r.removeBuffer(t[e].buffer)}n.releaseByGeometry(a),s.created=!1,i.delete(a)}}setGeometry(e){const t=this._gl,r=this._buffers,n=this.get(e);n.created||(e.addEventListener("dispose",this._onGeometryDispose),n.created=!0),null!==e.index&&r.setBuffer(e.index.buffer,t.ELEMENT_ARRAY_BUFFER,this._vertexArrayBindings);for(const n in e.attributes)r.setBuffer(e.attributes[n].buffer,t.ARRAY_BUFFER);for(const n in e.morphAttributes){const i=e.morphAttributes[n];for(let e=0,n=i.length;e<n;e++)r.setBuffer(i[e].buffer,t.ARRAY_BUFFER)}return n}}class qf extends Pf{constructor(e,t){super(e);const r=this;this._onMaterialDispose=function e(n){const i=n.target,a=r.get(i);i.removeEventListener("dispose",e);const s=a.program;void 0!==s&&t.releaseProgram(s),r.delete(i)}}setMaterial(e){const t=this.get(e);return void 0===t.program&&e.addEventListener("dispose",this._onMaterialDispose),t}}class Xf extends Pf{constructor(e,t,r,n){super(e),this._gl=t,this._capabilities=r,this._buffers=n,this._isWebGL2=r.version>=2,this._vaoExt=r.getExtension("OES_vertex_array_object"),this._currentGeometryProgram="",this._currentVAO=null}setup(e,t,r){if(e.morphTargetInfluences)this.reset(),this._setupVertexAttributes(r,t),this._currentGeometryProgram="";else if(this._isWebGL2||this._vaoExt){const e=this.get(t);void 0===e._vaos&&(e._vaos={});let n=e._vaos[r.id];n||(n=e._vaos[r.id]={version:-1,object:this._createVAO()}),this._bindVAO(n.object),n.version!==t.version&&(this._setupVertexAttributes(r,t),n.version=t.version)}else{const e=r.id+"_"+t.id+"_"+t.version;e!==this._currentGeometryProgram&&(this._setupVertexAttributes(r,t),this._currentGeometryProgram=e)}}releaseByGeometry(e){const t=this.get(e);if(t._vaos){for(const e in t._vaos){const r=t[e];r&&this._disposeVAO(r.object)}t._vaos={}}}reset(e){(null!==this._currentVAO||e)&&(this._isWebGL2?this._gl.bindVertexArray(null):this._vaoExt&&this._vaoExt.bindVertexArrayOES(null),this._currentVAO=null),""!==this._currentGeometryProgram&&(this._currentGeometryProgram="")}_createVAO(){return this._isWebGL2?this._gl.createVertexArray():this._vaoExt?this._vaoExt.createVertexArrayOES():null}_bindVAO(e){this._currentVAO!==e&&(this._isWebGL2?this._gl.bindVertexArray(e):this._vaoExt&&this._vaoExt.bindVertexArrayOES(e),this._currentVAO=e)}_disposeVAO(e){this._isWebGL2?this._gl.deleteVertexArray(e):this._vaoExt&&this._vaoExt.deleteVertexArrayOES(e)}_setupVertexAttributes(e,t){const r=this._gl,n=this._isWebGL2,i=e.getAttributes(),a=this._capabilities,s=this._buffers;for(const e in i){const o=i[e],l=t.getAttribute(e);if(l){const t=l.size;o.count!==t&&console.warn("WebGLVertexArrayBindings: attribute "+e+" size not match! "+o.count+" : "+t);const i=l.buffer,u=s.get(i),c=u.type;o.format;for(let e=0,t=o.locationSize;e<t;e++)r.enableVertexAttribArray(o.location+e);if(l.divisor>0)for(let e=0,t=o.locationSize;e<t;e++)n?r.vertexAttribDivisor(o.location+e,l.divisor):a.getExtension("ANGLE_instanced_arrays")?a.getExtension("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(o.location+e,l.divisor):console.warn("vertexAttribDivisor not supported");const h=u.bytesPerElement,d=u.glBuffer,p=i.stride,f=l.offset,m=l.normalized;if(r.bindBuffer(r.ARRAY_BUFFER,d),o.count===p&&1===o.locationSize)r.vertexAttribPointer(o.location,o.count,c,m,0,0);else for(let e=0;e<o.locationSize;e++)r.vertexAttribPointer(o.location+e,o.count/o.locationSize,c,m,h*p,h*(f+o.count/o.locationSize*e))}}if(t.index){const e=s.get(t.index.buffer);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.glBuffer)}}}class Qf extends Pf{constructor(e,t,r){super(e),this._gl=t,this._capabilities=r;const n=r.timerQuery,i=this,a=e=>{const s=e.target,o=i.get(s);s.removeEventListener("dispose",a),o._webglQuery&&(r.version>1?t.deleteQuery(o._webglQuery):n.deleteQueryEXT(o._webglQuery)),i.delete(s)};this._onQueryDispose=a,this._typeToGL={[$c.ANY_SAMPLES_PASSED]:35887,[$c.ANY_SAMPLES_PASSED_CONSERVATIVE]:36202,[$c.TIME_ELAPSED]:35007}}_get(e){const t=this._capabilities,r=this.get(e);return void 0===r._webglQuery&&(e.addEventListener("dispose",this._onQueryDispose),r._webglQuery=t.version>1?this._gl.createQuery():t.timerQuery.createQueryEXT(),r._target=null,r._result=null),r}begin(e,t){const r=this._capabilities,n=this._typeToGL,i=this._get(e);r.version>1?this._gl.beginQuery(n[t],i._webglQuery):r.timerQuery.beginQueryEXT(n[t],i._webglQuery),i._target=t,i._result=null}end(e){const t=this._capabilities,r=this._typeToGL,n=this._get(e);t.version>1?this._gl.endQuery(r[n._target]):t.timerQuery.endQueryEXT(r[n._target])}counter(e){const t=this._capabilities.timerQuery,r=this._get(e);t.queryCounterEXT(r._webglQuery,t.TIMESTAMP_EXT),r._target=t.TIMESTAMP_EXT,r._result=null}isResultAvailable(e){const t=this._gl,r=this._capabilities,n=r.timerQuery,i=this._get(e);let a;return a=r.version>1?t.getQueryParameter(i._webglQuery,t.QUERY_RESULT_AVAILABLE):n.getQueryObjectEXT(i._webglQuery,n.QUERY_RESULT_AVAILABLE),a}isTimerDisjoint(){return this._gl.getParameter(this._capabilities.timerQuery.GPU_DISJOINT_EXT)}getResult(e){const t=this._gl,r=this._capabilities,n=r.timerQuery,i=this._get(e);return null===i._result&&(r.version>1?i._result=t.getQueryParameter(i._webglQuery,t.QUERY_RESULT):i._result=n.getQueryObjectEXT(i._webglQuery,n.QUERY_RESULT_EXT)),i._result}}const Kf=new Zh,Yf=new Sc,Zf=new WeakMap,Jf=new Float32Array(8);let $f=new Float32Array([]);function em(e){return e.geometry}function tm(e){return e.material}function rm(e){return!0}function nm(){}let im=0;class am{constructor(e){const t=im++,r=new Af(e),n=new Ef(e,r),i=new Mf(e,r),a=new Ff(t,e,i,r,n),s=new Uf(t,e,r,n),o=new zf(t,e,i,r,a,s,n),l=new Gf(t,e,r),u=new Xf(t,e,r,l),c=new Hf(t,e,l,u),h=new cf(e,i,r),d=new qf(t,h),p=new Qf(t,e,r);this.id=t,this.gl=e,this.capabilities=r,this._textures=a,this._renderBuffers=s,this._renderTargets=o,this._buffers=l,this._geometries=c,this._programs=h,this._materials=d,this._state=i,this._vertexArrayBindings=u,this._queries=p}clear(e,t,r){const n=this.gl;let i=0;(void 0===e||e)&&(i|=n.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=n.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=n.STENCIL_BUFFER_BIT),i>0&&n.clear(i)}setClearColor(e,t,r,n,i){this._state.colorBuffer.setClear(e,t,r,n,i)}getClearColor(){return this._state.colorBuffer.getClear()}setRenderTarget(e){this._renderTargets.setRenderTarget(e)}getRenderTarget(){return this._state.currentRenderTarget}blitRenderTarget(e,t,r=!0,n=!0,i=!0){this._renderTargets.blitRenderTarget(e,t,r,n,i)}readRenderTargetPixels(e,t,r,n,i){this._renderTargets.readRenderTargetPixels(e,t,r,n,i)}updateRenderTargetMipmap(e){this._renderTargets.updateRenderTargetMipmap(e)}setTextureExternal(e,t){this._textures.setTextureExternal(e,t)}setRenderBufferExternal(e,t){this._renderBuffers.setRenderBufferExternal(e,t)}setBufferExternal(e,t){this._buffers.setBufferExternal(e,t)}resetVertexArrayBindings(e){this._vertexArrayBindings.reset(e)}resetState(){this._state.reset()}beginQuery(e,t){this._queries.begin(e,t)}endQuery(e){this._queries.end(e)}queryCounter(e){this._queries.counter(e)}isTimerQueryDisjoint(e){return this._queries.isTimerDisjoint(e)}isQueryResultAvailable(e){return this._queries.isResultAvailable(e)}getQueryResult(e){return this._queries.getResult(e)}render(e,t,r){const n=this._state,i=this.capabilities,a=this._vertexArrayBindings,s=this._textures,o=r.getGeometry||em,l=r.getMaterial||tm,u=r.beforeRender||nm,c=r.afterRender||nm,h=r.ifRender||rm,d=r.renderInfo,p=t.scene,f=t.lights,m=t.camera,g=n.currentRenderTarget;if(!h(e))return;const _=e.object,v=l.call(this,e),y=o.call(this,e),x=e.group,b=v.fog?p.fog:null,A=void 0!==v.envMap?v.envMap||p.environment:null;let S=p.clippingPlanesData,E=p.numClippingPlanes;v.clippingPlanes&&v.clippingPlanes.length>0&&($f.length<4*v.clippingPlanes.length&&($f=new Float32Array(4*v.clippingPlanes.length)),S=p.setClippingPlanesData(v.clippingPlanes,$f),E=v.clippingPlanes.length),_.onBeforeRender(e,v),u.call(this,e,v);const w=this._materials.setMaterial(v);if(!1===v.needsUpdate)if(void 0===w.program)v.needsUpdate=!0;else if(w.fog!==b)v.needsUpdate=!0;else if(w.envMap!==A)v.needsUpdate=!0;else if(w.numClippingPlanes!==E)v.needsUpdate=!0;else if(w.logarithmicDepthBuffer!==p.logarithmicDepthBuffer)v.needsUpdate=!0;else if(t.outputEncoding!==w.outputEncoding||t.gammaFactor!==w.gammaFactor)v.needsUpdate=!0;else if(i.version>1&&p.disableShadowSampler!==w.disableShadowSampler)v.needsUpdate=!0;else{const e=v.acceptLight&&f.totalNum>0;e!==w.acceptLight?v.needsUpdate=!0:e&&(f.hash.compare(w.lightsHash)&&_.receiveShadow===w.receiveShadow&&_.shadowType===w.shadowType||(v.needsUpdate=!0))}if(v.needsUpdate){const e=w.program;w.program=this._programs.getProgram(v,_,t,!0),e&&this._programs.releaseProgram(e),w.fog=b,w.envMap=A,w.logarithmicDepthBuffer=p.logarithmicDepthBuffer,w.acceptLight=v.acceptLight,w.lightsHash=f.hash.copyTo(w.lightsHash),w.receiveShadow=_.receiveShadow,w.shadowType=_.shadowType,w.numClippingPlanes=E,w.outputEncoding=t.outputEncoding,w.gammaFactor=t.gammaFactor,w.disableShadowSampler=p.disableShadowSampler,v.needsUpdate=!1}const C=w.program;if(void 0===C.program)return;n.setProgram(C),this._geometries.setGeometry(y),_.morphTargetInfluences&&this._updateMorphtargets(_,y,C),a.setup(_,y,C);let T=!1;C.lightId===f.id&&C.lightVersion===f.version||(T=!0,C.lightId=f.id,C.lightVersion=f.version);let D=!1;C.cameraId===m.id&&C.cameraVersion===m.version||(D=!0,C.cameraId=m.id,C.cameraVersion=m.version);let M=!1;C.sceneId===p.id&&C.sceneVersion===p.version||(M=!0,C.sceneId=p.id,C.sceneVersion=p.version);const P=C.getUniforms();v.acceptLight&&this._uploadLights(P,f,p.disableShadowSampler,T),_.isSkinnedMesh&&this._uploadSkeleton(P,_,p);for(let e=0,t=P.seq.length;e<t;e++){const t=P.seq[e],r=t.id,n=t.internalGroup;if(v.uniforms&&void 0!==v.uniforms[r])t.set(v.uniforms[r],s);else if(1!==n)if(2===n&&D)t.internalFun(m);else if(3===n&&M)t.internalFun(p);else if(4!==n)if(5!==n)"clippingPlanes"===r&&t.set(S);else if("u_PointScale"===r){const e=.5*g.height;t.set(e)}else t.internalFun(A,s);else t.internalFun(v,s);else{let e=_.worldMatrix;p.useAnchorMatrix&&(e=Yf.copy(e).premultiply(p.anchorMatrixInverse)),t.set(e.elements)}}const F=_.worldMatrix.determinant()<0;n.setMaterial(v,F);const R=Kf.set(g.width,g.height,g.width,g.height).multiply(m.rect);R.z-=R.x,R.w-=R.y,R.x=Math.floor(R.x),R.y=Math.floor(R.y),R.z=Math.floor(R.z),R.w=Math.floor(R.w),n.viewport(R.x,R.y,R.z,R.w),this._draw(y,v,x,d),s.resetTextureUnits(),n.depthBuffer.setTest(!0),n.depthBuffer.setMask(!0),n.colorBuffer.setMask(!0),c(e),_.onAfterRender(e)}_uploadLights(e,t,r,n){const i=this._textures;t.useAmbient&&n&&e.set("u_AmbientLightColor",t.ambient),t.hemisNum>0&&n&&e.set("u_Hemi",t.hemisphere),t.directsNum>0&&(n&&e.set("u_Directional",t.directional),t.directShadowNum>0&&(n&&e.set("u_DirectionalShadow",t.directionalShadow),e.has("directionalShadowMap")&&(this.capabilities.version>=2&&!r?e.set("directionalShadowMap",t.directionalShadowDepthMap,i):e.set("directionalShadowMap",t.directionalShadowMap,i),e.set("directionalShadowMatrix",t.directionalShadowMatrix)),e.has("directionalDepthMap")&&e.set("directionalDepthMap",t.directionalShadowMap,i))),t.pointsNum>0&&(n&&e.set("u_Point",t.point),t.pointShadowNum>0&&(n&&e.set("u_PointShadow",t.pointShadow),e.has("pointShadowMap")&&(e.set("pointShadowMap",t.pointShadowMap,i),e.set("pointShadowMatrix",t.pointShadowMatrix)))),t.spotsNum>0&&(n&&e.set("u_Spot",t.spot),t.spotShadowNum>0&&(n&&e.set("u_SpotShadow",t.spotShadow),e.has("spotShadowMap")&&(this.capabilities.version>=2&&!r?e.set("spotShadowMap",t.spotShadowDepthMap,i):e.set("spotShadowMap",t.spotShadowMap,i),e.set("spotShadowMatrix",t.spotShadowMatrix)),e.has("spotDepthMap")&&e.set("spotDepthMap",t.spotShadowMap,i)))}_uploadSkeleton(e,t,r){if(t.skeleton&&t.skeleton.bones.length>0){const n=t.skeleton,i=this.capabilities;i.maxVertexTextures>0&&(i.getExtension("OES_texture_float")||i.version>=2)?(void 0===n.boneTexture&&n.generateBoneTexture(i.version>=2),e.set("boneTexture",n.boneTexture,this._textures),e.set("boneTextureSize",n.boneTexture.image.width)):e.set("boneMatrices",n.boneMatrices),e.set("bindMatrix",t.bindMatrix.elements),Yf.copy(t.bindMatrixInverse),r.useAnchorMatrix&&Yf.multiply(r.anchorMatrix),e.set("bindMatrixInverse",Yf.elements)}}_updateMorphtargets(e,t,r){const n=e.morphTargetInfluences;Zf.has(t)||Zf.set(t,n.slice(0));const i=t.morphAttributes.position,a=t.morphAttributes.normal,s=Zf.get(t);for(let e=0;e<s.length;e++){0!==s[e]&&(i&&t.removeAttribute("morphTarget"+e),a&&t.removeAttribute("morphNormal"+e))}for(let e=0;e<n.length;e++)s[e]=n[e];s.length=n.length;let o=0;for(let e=0;e<s.length;e++){const r=s[e];r>0&&(i&&t.addAttribute("morphTarget"+o,i[e]),a&&t.addAttribute("morphNormal"+o,a[e]),Jf[o]=r,o++)}for(;o<8;o++)Jf[o]=0;r.getUniforms().set("morphTargetInfluences",Jf)}_draw(e,t,r,n){const i=this.gl,a=this.capabilities,s=this._buffers,o=null!==e.index;let l=0,u=o?e.index.buffer.count:e.getAttribute("a_Position").buffer.count;const c=r?r.start:0,h=r?r.count:1/0;l=Math.max(l,c),u=Math.min(u,h);const d=e.instanceCount,p=d>=0;if(o){const r=s.get(e.index.buffer),n=r.bytesPerElement,o=r.type;if(o===i.UNSIGNED_INT&&a.version<2&&!a.getExtension("OES_element_index_uint")&&console.warn("draw elements type not support UNSIGNED_INT!"),p){if(d>0)if(a.version>=2)i.drawElementsInstanced(t.drawMode,u,o,l*n,d);else{if(!a.getExtension("ANGLE_instanced_arrays"))return void console.warn("no support instanced draw.");a.getExtension("ANGLE_instanced_arrays").drawElementsInstancedANGLE(t.drawMode,u,o,l*n,d)}}else i.drawElements(t.drawMode,u,o,l*n)}else if(p){if(d>0)if(a.version>=2)i.drawArraysInstanced(t.drawMode,l,u,d);else{if(!a.getExtension("ANGLE_instanced_arrays"))return void console.warn("no support instanced draw.");a.getExtension("ANGLE_instanced_arrays").drawArraysInstancedANGLE(t.drawMode,l,u,d)}}else i.drawArrays(t.drawMode,l,u);n&&n.update(u,t.drawMode,d<0?1:d)}}class sm{constructor(e){this.renderPass=new am(e)}renderScene(e,t){const r=e.getRenderStates(t),n=e.getRenderQueue(t);let i;for(let e=0,t=n.layerList.length;e<t;e++)i=n.layerList[e],this.renderRenderableList(i.opaque,r),this.renderRenderableList(i.transparent,r)}renderRenderableList(e,t,r={}){const n=this.renderPass;for(let i=0,a=e.length;i<a;i++)n.render(e[i],t,r)}}class om{constructor(){const e={calls:0,triangles:0,lines:0,points:0},t=[function(t,r){e.points+=t*r},function(t,r){e.lines+=t*(r/2)},function(t,r){e.lines+=t*r},function(t,r){e.lines+=t*(r-1)},function(t,r){e.triangles+=t*(r/3)},function(t,r){e.triangles+=t*(r-2)},function(t,r){e.triangles+=t*(r-2)}];this.update=function(r,n,i){e.calls++,t[n](i,r)},this.reset=function(){e.calls=0,e.triangles=0,e.lines=0,e.points=0},this.render=e}}class lm{constructor(e=0,t=1,r=1e3){this.color=new Eh(e),this.near=t,this.far=r}}lm.prototype.isFog=!0;class um{constructor(e=0,t=25e-5){this.color=new Eh(e),this.density=t}}um.prototype.isFogExp2=!0;class cm extends _p{constructor(e=1,t=1,r=1,n=1,i=1,a=1){super();const s=this;n=Math.floor(n),i=Math.floor(i),a=Math.floor(a);const o=[],l=[],u=[],c=[];let h=0,d=0;function p(e,t,r,n,i,a,p,f,m,g,_){const v=a/m,y=p/g,x=a/2,b=p/2,A=f/2,S=m+1,E=g+1;let w=0,C=0;const T=new bc;for(let a=0;a<E;a++){const s=a*y-b;for(let o=0;o<S;o++){const h=o*v-x;T[e]=h*n,T[t]=s*i,T[r]=A,l.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[r]=f>0?1:-1,u.push(T.x,T.y,T.z),c.push(o/m),c.push(1-a/g),w+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const r=h+t+S*e,n=h+t+S*(e+1),i=h+(t+1)+S*(e+1),a=h+(t+1)+S*e;o.push(r,n,a),o.push(n,i,a),C+=6}s.addGroup(d,C,_),d+=C,h+=w}p("z","y","x",-1,-1,r,t,e,a,i,0),p("z","y","x",1,-1,r,t,-e,a,i,1),p("x","z","y",1,1,e,r,t,n,a,2),p("x","z","y",1,-1,e,r,-t,n,a,3),p("x","y","z",1,-1,e,t,r,n,i,4),p("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(new up(new cp(l.length/3>65536?new Uint32Array(o):new Uint16Array(o),1))),this.addAttribute("a_Position",new up(new cp(new Float32Array(l),3))),this.addAttribute("a_Normal",new up(new cp(new Float32Array(u),3))),this.addAttribute("a_Uv",new up(new cp(new Float32Array(c),2))),this.computeBoundingBox(),this.computeBoundingSphere()}}class hm extends _p{constructor(e=1,t=1,r=1,n=8,i=1,a=!1,s=0,o=2*Math.PI){super();const l=this;n=Math.floor(n),i=Math.floor(i);const u=[],c=[],h=[],d=[];let p=0;const f=[],m=r/2;let g=0;function _(r){const i=p,a=new xh,f=new bc;let _,v=0;const y=!0===r?e:t,x=!0===r?1:-1;for(_=1;_<=n;_++)c.push(0,m*x,0),h.push(0,x,0),d.push(.5,.5),p++;const b=p;for(_=0;_<=n;_++){const e=_/n*o+s,t=Math.cos(e),r=Math.sin(e);f.x=y*r,f.y=m*x,f.z=y*t,c.push(f.x,f.y,f.z),h.push(0,x,0),a.x=.5*t+.5,a.y=.5*r*x+.5,d.push(a.x,a.y),p++}for(_=0;_<n;_++){const e=i+_,t=b+_;!0===r?u.push(t,t+1,e):u.push(t+1,t,e),v+=3}l.addGroup(g,v,!0===r?1:2),g+=v}!function(){const a=new bc,_=new bc;let v,y,x=0;const b=(t-e)/r;for(y=0;y<=i;y++){const l=[],u=y/i,g=u*(t-e)+e;for(v=0;v<=n;v++){const e=v/n,t=e*o+s,i=Math.sin(t),f=Math.cos(t);_.x=g*i,_.y=-u*r+m,_.z=g*f,c.push(_.x,_.y,_.z),a.set(i,b,f).normalize(),h.push(a.x,a.y,a.z),d.push(e,1-u),l.push(p++)}f.push(l)}for(v=0;v<n;v++)for(y=0;y<i;y++){const e=f[y][v],t=f[y+1][v],r=f[y+1][v+1],n=f[y][v+1];u.push(e,t,n),u.push(t,r,n),x+=6}l.addGroup(g,x,0),g+=x}(),!1===a&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(new up(new cp(c.length/3>65536?new Uint32Array(u):new Uint16Array(u),1))),this.addAttribute("a_Position",new up(new cp(new Float32Array(c),3))),this.addAttribute("a_Normal",new up(new cp(new Float32Array(h),3))),this.addAttribute("a_Uv",new up(new cp(new Float32Array(d),2))),this.computeBoundingBox(),this.computeBoundingSphere()}}class dm extends _p{constructor(e=1,t=8,r=6,n=0,i=2*Math.PI,a=0,s=Math.PI){super(),t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const o=a+s;let l,u,c=0;const h=[],d=new bc,p=new bc,f=[],m=[],g=[],_=[];for(u=0;u<=r;u++){const f=[],v=u/r;let y=0;for(0==u&&0==a?y=.5/t:u==r&&o==Math.PI&&(y=-.5/t),l=0;l<=t;l++){const r=l/t;d.x=-e*Math.cos(n+r*i)*Math.sin(a+v*s),d.y=e*Math.cos(a+v*s),d.z=e*Math.sin(n+r*i)*Math.sin(a+v*s),m.push(d.x,d.y,d.z),p.copy(d).normalize(),g.push(p.x,p.y,p.z),_.push(r+y,1-v),f.push(c++)}h.push(f)}for(u=0;u<r;u++)for(l=0;l<t;l++){const e=h[u][l+1],t=h[u][l],n=h[u+1][l],i=h[u+1][l+1];(0!==u||a>0)&&f.push(e,t,i),(u!==r-1||o<Math.PI)&&f.push(t,n,i)}this.setIndex(new up(new cp(m.length/3>65536?new Uint32Array(f):new Uint16Array(f),1))),this.addAttribute("a_Position",new up(new cp(new Float32Array(m),3))),this.addAttribute("a_Normal",new up(new cp(new Float32Array(g),3))),this.addAttribute("a_Uv",new up(new cp(new Float32Array(_),2))),this.computeBoundingBox(),this.computeBoundingSphere()}}class pm extends _p{constructor(e=1,t=.4,r=64,n=8,i=2,a=3){super(),r=Math.floor(r),n=Math.floor(n);const s=[],o=[],l=[],u=[];let c,h;const d=new bc,p=new bc,f=new bc,m=new bc,g=new bc,_=new bc,v=new bc;for(c=0;c<=r;++c){const s=c/r*i*Math.PI*2;for(y(s,i,a,e,f),y(s+.01,i,a,e,m),_.subVectors(m,f),v.addVectors(m,f),g.crossVectors(_,v),v.crossVectors(g,_),g.normalize(),v.normalize(),h=0;h<=n;++h){const e=h/n*Math.PI*2,i=-t*Math.cos(e),a=t*Math.sin(e);d.x=f.x+(i*v.x+a*g.x),d.y=f.y+(i*v.y+a*g.y),d.z=f.z+(i*v.z+a*g.z),o.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),l.push(p.x,p.y,p.z),u.push(c/r),u.push(h/n)}}for(h=1;h<=r;h++)for(c=1;c<=n;c++){const e=(n+1)*(h-1)+(c-1),t=(n+1)*h+(c-1),r=(n+1)*h+c,i=(n+1)*(h-1)+c;s.push(e,t,i),s.push(t,r,i)}function y(e,t,r,n,i){const a=Math.cos(e),s=Math.sin(e),o=r/t*e,l=Math.cos(o);i.x=n*(2+l)*.5*a,i.y=n*(2+l)*s*.5,i.z=n*Math.sin(o)*.5}this.setIndex(new up(new cp(o.length/3>65536?new Uint32Array(s):new Uint16Array(s),1))),this.addAttribute("a_Position",new up(new cp(new Float32Array(o),3))),this.addAttribute("a_Normal",new up(new cp(new Float32Array(l),3))),this.addAttribute("a_Uv",new up(new cp(new Float32Array(u),2))),this.computeBoundingBox(),this.computeBoundingSphere()}}class fm extends xp{constructor(){super(),this.type=Nc.BASIC}}class mm extends xp{constructor(){super(),this.type=Nc.LAMBERT,this.acceptLight=!0}}class gm extends xp{constructor(){super(),this.type=Nc.LINE,this.lineWidth=1,this.drawMode=Kc.LINES}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this}}class _m extends xp{constructor(){super(),this.type=Nc.MATCAP,this.matcap=null}copy(e){return super.copy(e),this.matcap=e.matcap,this}}class vm extends xp{constructor(){super(),this.type=Nc.PBR2,this.specular=new Eh(1118481),this.glossiness=.5,this.specularMap=null,this.glossinessMap=null,this.acceptLight=!0}copy(e){return super.copy(e),this.specular=e.specular,this.glossiness=e.glossiness,this.specularMap=e.specularMap,this.glossinessMap=e.glossinessMap,this}}class ym extends xp{constructor(){super(),this.type=Nc.PBR,this.roughness=.5,this.metalness=.5,this.roughnessMap=null,this.metalnessMap=null,this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new xh(1,1),this.clearcoatNormalMap=null,this.acceptLight=!0}copy(e){return super.copy(e),this.roughness=e.roughness,this.metalness=e.metalness,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this}}class xm extends xp{constructor(){super(),this.type=Nc.PHONG,this.shininess=30,this.specular=new Eh(1118481),this.specularMap=null,this.acceptLight=!0}copy(e){return super.copy(e),this.shininess=e.shininess,this.specular.copy(e.specular),this.specularMap=e.specularMap,this}}class bm extends xp{constructor(){super(),this.type=Nc.POINT,this.size=1,this.sizeAttenuation=!0,this.drawMode=Kc.POINTS}copy(e){return super.copy(e),this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}class Am extends eh{constructor(e,t){super(),this.width=e,this.height=t}resize(e,t){return(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,!0)}dispose(){this.dispatchEvent({type:"dispose"})}}Am.prototype.isRenderTarget=!0;class Sm extends eh{constructor(e,t,r=zc.RGBA8,n=0){super(),this.width=e,this.height=t,this.format=r,this.multipleSampling=n}resize(e,t){return(this.width!==e||this.height!==t)&&(this.dispose(),this.width=e,this.height=t,!0)}clone(){return(new this.constructor).copy(this)}copy(e){return this.format=e.format,this.multipleSampling=e.multipleSampling,this}dispose(){this.dispatchEvent({type:"dispose"})}}Sm.prototype.isRenderBuffer=!0;class Em extends Am{constructor(e,t){super(e,t),this._attachments={},this.attach(new Bp,Zc.COLOR_ATTACHMENT0),this.attach(new Sm(e,t,zc.DEPTH_STENCIL),Zc.DEPTH_STENCIL_ATTACHMENT)}attach(e,t=Zc.COLOR_ATTACHMENT0){e.isTexture?e.image&&e.image.rtt?e.image.width===this.width&&e.image.height===this.height||(e.version++,e.image.width=this.width,e.image.height=this.height):(e.version++,e.image={rtt:!0,data:null,width:this.width,height:this.height}):e.resize(this.width,this.height),this._attachments[t]=e}detach(e=Zc.COLOR_ATTACHMENT0){delete this._attachments[e]}resize(e,t){const r=super.resize(e,t);if(r){this.dispose(!1);for(const r in this._attachments){const n=this._attachments[r];n.isTexture?(n.image={rtt:!0,data:null,width:this.width,height:this.height},n.version++):n.resize(e,t)}}return r}dispose(e=!0){if(super.dispose(),e)for(const e in this._attachments)this._attachments[e].dispose()}}Em.prototype.isRenderTarget2D=!0,Object.defineProperties(Em.prototype,{texture:{set:function(e){e?e.isTexture&&this.attach(e,Zc.COLOR_ATTACHMENT0):this.detach(Zc.COLOR_ATTACHMENT0)},get:function(){const e=this._attachments[Zc.COLOR_ATTACHMENT0];return e.isTexture?e:null}}});class wm extends Am{constructor(e){super(e.width,e.height),this.view=e}resize(e,t){this.view.width=e,this.view.height=t,this.width=e,this.height=t}dispose(){}}wm.prototype.isRenderTargetBack=!0;class Cm extends Am{constructor(e,t){super(e,t),this._attachments={},this.attach(new Ip,Zc.COLOR_ATTACHMENT0),this.attach(new Sm(e,t,zc.DEPTH_STENCIL),Zc.DEPTH_STENCIL_ATTACHMENT),this.activeCubeFace=0}attach(e,t=Zc.COLOR_ATTACHMENT0){if(e.isTexture){let t=!1;for(let r=0;r<6;r++)e.images[r]&&e.images[r].rtt?e.images[r].width===this.width&&e.images[r].height===this.height||(e.images[r].width=this.width,e.images[r].height=this.height,t=!0):(e.images[r]={rtt:!0,data:null,width:this.width,height:this.height},t=!0);t&&e.version++}else e.resize(this.width,this.height);this._attachments[t]=e}detach(e=Zc.COLOR_ATTACHMENT0){delete this._attachments[e]}resize(e,t){if(super.resize(e,t)){this.dispose(!1);for(const r in this._attachments){const n=this._attachments[r];if(n.isTexture){for(let e=0;e<6;e++)n.images[e]={rtt:!0,data:null,width:this.width,height:this.height};n.version++}else n.resize(e,t)}}}dispose(e=!0){if(super.dispose(),e)for(const e in this._attachments)this._attachments[e].dispose()}}Cm.prototype.isRenderTargetCube=!0,Object.defineProperties(Cm.prototype,{texture:{set:function(e){e?e.isTexture&&this.attach(e,Zc.COLOR_ATTACHMENT0):this.detach(Zc.COLOR_ATTACHMENT0)},get:function(){const e=this._attachments[Zc.COLOR_ATTACHMENT0];return e.isTexture?e:null}}});let Tm=0;class Dm extends eh{constructor(){super(),this.id=Tm++}dispose(){this.dispatchEvent({type:"dispose"})}}const Mm=new Sc;class Pm{constructor(e,t){this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=new Float32Array(16*this.bones.length),this.boneTexture=void 0}pose(){const e=this.boneInverses;for(let t=0;t<this.bones.length;t++){this.bones[t].worldMatrix.getInverse(e[t])}for(let e=0;e<this.bones.length;e++){const t=this.bones[e];t.parent&&"bone"==t.parent.type?(t.matrix.getInverse(t.parent.worldMatrix),t.matrix.multiply(t.worldMatrix)):t.matrix.copy(t.worldMatrix),t.matrix.decompose(t.position,t.quaternion,t.scale)}}clone(){return new Pm(this.bones,this.boneInverses)}updateBones(e){const t=e.useAnchorMatrix,r=e.anchorMatrixInverse,n=this.boneInverses;for(let e=0;e<this.bones.length;e++){const i=this.bones[e];Mm.multiplyMatrices(i.worldMatrix,n[e]),t&&Mm.premultiply(r),Mm.toArray(this.boneMatrices,16*e)}void 0!==this.boneTexture&&this.boneTexture.version++}generateBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=rd(Math.ceil(e)),e=Math.max(4,e);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new Bp;r.image={data:t,width:e,height:e},r.format=zc.RGBA,r.type=jc.FLOAT,r.magFilter=Vc.NEAREST,r.minFilter=Vc.NEAREST,r.generateMipmaps=!1,r.flipY=!1,this.boneMatrices=t,this.boneTexture=r}}class Fm extends od{constructor(e=16777215,t=1){super(),this.color=new Eh(e),this.intensity=t}lookAt(e,t){Rm.lookAtRH(this.position,e,t),this.quaternion.setFromRotationMatrix(Rm)}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}}Fm.prototype.isLight=!0;const Rm=new Sc;let Nm=class extends Fm{constructor(e,t){super(e,t)}};Nm.prototype.isAmbientLight=!0;class Bm{constructor(){this.camera=new Bd,this.matrix=new Sc,this.bias=0,this.normalBias=0,this.radius=1,this.cameraNear=1,this.cameraFar=500,this.mapSize=new xh(512,512),this.autoUpdate=!0,this.needsUpdate=!1,this.renderTarget=null,this.map=null,this.depthMap=null}update(e,t){}updateMatrix(){const e=this.matrix,t=this.camera;e.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),e.multiply(t.projectionMatrix),e.multiply(t.viewMatrix)}copy(e){return this.camera.copy(e.camera),this.matrix.copy(e.matrix),this.bias=e.bias,this.normalBias=e.normalBias,this.radius=e.radius,this.cameraNear=e.cameraNear,this.cameraFar=e.cameraFar,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}prepareDepthMap(e,t){}}class Im extends Bm{constructor(){super(),this.windowSize=500,this.frustumEdgeFalloff=0,this.camera.frustumCulled=!1,this.renderTarget=new Em(this.mapSize.x,this.mapSize.y);const e=this.renderTarget.texture;e.generateMipmaps=!1,e.minFilter=Vc.LINEAR;const t=new Bp;t.type=jc.UNSIGNED_INT,t.format=zc.DEPTH_COMPONENT,t.magFilter=Vc.LINEAR,t.minFilter=Vc.LINEAR,t.compare=Wc.LESS,t.generateMipmaps=!1;const r=new Sm(this.mapSize.x,this.mapSize.y,zc.DEPTH_COMPONENT16);this.renderTarget.detach(Zc.DEPTH_STENCIL_ATTACHMENT),this.renderTarget.attach(r,Zc.DEPTH_ATTACHMENT),this.map=e,this.depthMap=t,this._depthBuffer=r,this._lookTarget=new bc,this._up=new bc(0,1,0)}update(e){this._updateCamera(e),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)}_updateCamera(e){const t=this.camera,r=this._lookTarget;e.getWorldDirection(r),t.position.setFromMatrixPosition(e.worldMatrix),r.multiplyScalar(-1).add(t.position),t.lookAt(r,this._up),t.updateMatrix();const n=this.windowSize/2;t.setOrtho(-n,n,-n,n,this.cameraNear,this.cameraFar)}copy(e){return super.copy(e),this.windowSize=e.windowSize,this.frustumEdgeFalloff=e.frustumEdgeFalloff,this}prepareDepthMap(e,t){const r=e&&t.version>=2,n=this.renderTarget;r!==(n._attachments[Zc.DEPTH_ATTACHMENT]===this.depthMap)&&(r?(t.getExtension("OES_texture_float_linear")&&(this.depthMap.type=jc.FLOAT),n.dispose(),n.attach(this.depthMap,Zc.DEPTH_ATTACHMENT)):(n.dispose(),n.attach(this._depthBuffer,Zc.DEPTH_ATTACHMENT)))}}let Om=class extends Fm{constructor(e,t){super(e,t),this.shadow=new Im}copy(e){return super.copy(e),this.shadow.copy(e.shadow),this}};Om.prototype.isDirectionalLight=!0;let km=class extends Fm{constructor(e,t,r){super(e,r),this.groundColor=new Eh(void 0!==t?t:16777215)}copy(e){super.copy(e),this.groundColor.copy(e.groundColor)}};km.prototype.isHemisphereLight=!0;class Lm extends Bm{constructor(){super(),this.renderTarget=new Cm(this.mapSize.x,this.mapSize.y);const e=this.renderTarget.texture;e.generateMipmaps=!1,e.minFilter=Vc.LINEAR,this.map=e,this._targets=[new bc(1,0,0),new bc(-1,0,0),new bc(0,1,0),new bc(0,-1,0),new bc(0,0,1),new bc(0,0,-1)],this._ups=[new bc(0,-1,0),new bc(0,-1,0),new bc(0,0,1),new bc(0,0,-1),new bc(0,-1,0),new bc(0,-1,0)],this._lookTarget=new bc}update(e,t){this._updateCamera(e,t),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)}_updateCamera(e,t){const r=this.camera,n=this._lookTarget,i=this._targets,a=this._ups;r.position.setFromMatrixPosition(e.worldMatrix),n.set(i[t].x+r.position.x,i[t].y+r.position.y,i[t].z+r.position.z),r.lookAt(n,a[t]),r.updateMatrix(),r.setPerspective(.5*Math.PI,1,this.cameraNear,this.cameraFar)}}class Um extends Fm{constructor(e,t,r,n){super(e,t),this.decay=void 0!==n?n:1,this.distance=void 0!==r?r:200,this.shadow=new Lm}copy(e){return super.copy(e),this.shadow.copy(e.shadow),this}}Um.prototype.isPointLight=!0;class zm extends Bm{constructor(){super(),this.frustumEdgeFalloff=0,this.renderTarget=new Em(this.mapSize.x,this.mapSize.y);const e=this.renderTarget.texture;e.generateMipmaps=!1,e.minFilter=Vc.LINEAR;const t=new Bp;t.type=jc.UNSIGNED_INT,t.format=zc.DEPTH_COMPONENT,t.magFilter=Vc.LINEAR,t.minFilter=Vc.LINEAR,t.compare=Wc.LESS,t.generateMipmaps=!1;const r=new Sm(this.mapSize.x,this.mapSize.y,zc.DEPTH_COMPONENT16);this.renderTarget.detach(Zc.DEPTH_STENCIL_ATTACHMENT),this.renderTarget.attach(r,Zc.DEPTH_ATTACHMENT),this.map=e,this.depthMap=t,this._depthBuffer=r,this._lookTarget=new bc,this._up=new bc(0,1,0)}update(e){this._updateCamera(e),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)}_updateCamera(e){const t=this.camera,r=this._lookTarget;e.getWorldDirection(r),t.position.setFromMatrixPosition(e.worldMatrix),r.multiplyScalar(-1).add(t.position),t.lookAt(r,this._up),t.updateMatrix(),t.setPerspective(2*e.angle,1,this.cameraNear,this.cameraFar)}copy(e){return super.copy(e),this.frustumEdgeFalloff=e.frustumEdgeFalloff,this}prepareDepthMap(e,t){const r=e&&t.version>=2,n=this.renderTarget;r!==(n._attachments[Zc.DEPTH_ATTACHMENT]===this.depthMap)&&(r?(t.getExtension("OES_texture_float_linear")&&(this.depthMap.type=jc.FLOAT),n.dispose(),n.attach(this.depthMap,Zc.DEPTH_ATTACHMENT)):(n.dispose(),n.attach(this._depthBuffer,Zc.DEPTH_ATTACHMENT)))}}let jm=class extends Fm{constructor(e,t,r,n,i,a){super(e,t),this.decay=void 0!==a?a:1,this.distance=void 0!==r?r:200,this.penumbra=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/6,this.shadow=new zm}copy(e){return super.copy(e),this.shadow.copy(e.shadow),this}};jm.prototype.isSpotLight=!0;class Vm extends od{constructor(){super()}}Vm.prototype.isBone=!0;class Gm extends ap{constructor(e,t){super(e,t),this.skeleton=void 0,this.bindMode="attached",this.bindMatrix=new Sc,this.bindMatrixInverse=new Sc}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrix(),t=this.worldMatrix),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)}updateMatrix(e){super.updateMatrix(e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.worldMatrix):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("t3d.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}}Gm.prototype.isSkinnedMesh=!0;class Wm extends od{constructor(){super()}}Wm.prototype.isGroup=!0;class Hm{constructor(){console.error("EnvironmentMapPass has been removed, use ReflectionProbe(jsm) instead.")}}bc.prototype.applyProjection=function(e){console.error("t3d.Vector3: .applyProjection has been removed. Use .applyMatrix4 instead.")},Object.defineProperties(Bd.prototype,{gammaInput:{get:function(){return console.warn("t3d.Camera: .gammaInput has been removed. Use texture.encoding instead."),!1},set:function(e){console.warn("t3d.Camera: .gammaInput has been removed. Use texture.encoding instead.")},configurable:!0},gammaOutput:{get:function(){return console.warn("t3d.Camera: .gammaOutput has been removed. Use .outputEncoding or renderTarget.texture.encoding instead."),this.outputEncoding==Xc.GAMMA},set:function(e){console.warn("t3d.Camera: .gammaOutput has been removed. Use .outputEncoding or renderTarget.texture.encoding instead."),this.outputEncoding=e?Xc.GAMMA:Xc.LINEAR},configurable:!0}}),Object.defineProperties(xp.prototype,{emissiveIntensity:{get:function(){return console.warn("t3d.Material: .emissiveIntensity has been removed. Use material.emissive instead."),!1},set:function(e){console.warn("t3d.Material: .emissiveIntensity has been removed. Use material.emissive instead.")},configurable:!0}}),Object.defineProperties(am.prototype,{textures:{get:function(){return console.warn("WebGLRenderPass: .textures has been deprecated. All methods are moved to WebGLRenderPass."),this._textures},configurable:!0},renderBuffers:{get:function(){return console.warn("WebGLRenderPass: .renderBuffers has been deprecated. All methods are moved to WebGLRenderPass."),this._renderBuffers},configurable:!0},renderTarget:{get:function(){return this._renderTargets},configurable:!0},state:{get:function(){return this._state},configurable:!0},vertexArrayBindings:{get:function(){return console.warn("WebGLRenderPass: .vertexArrayBindings has been deprecated. All methods are moved to WebGLRenderPass."),this._vertexArrayBindings},configurable:!0}}),Xf.prototype.resetBinding=function(){console.error("WebGLVertexArrayBindings: .resetBinding() has been removed. Use WebGLRenderPass.resetVertexArrayBindings() instead.")},Hf.prototype.setBufferExternal=function(e,t){console.warn("WebGLGeometries: .setBufferExternal has been removed. Use WebGLRenderPass.setBufferExternal instead."),this._buffers.setBufferExternal(e,t)};const qm={TEXTURE_2D:3553,TEXTURE_CUBE_MAP:34067,TEXTURE_3D:32879};Object.defineProperties(Np.prototype,{textureType:{get:function(){return console.warn("TextureBase: .textureType has been removed."),""},set:function(e){console.warn("TextureBase: .textureType has been removed.")},configurable:!0}}),Object.defineProperties(Bp,{textureType:{get:function(){return console.warn("Texture2D: .textureType has been removed."),qm.TEXTURE_2D},set:function(e){console.warn("Texture2D: .textureType has been removed.")},configurable:!0}}),Object.defineProperties(Op,{textureType:{get:function(){return console.warn("Texture3D: .textureType has been removed."),qm.TEXTURE_3D},set:function(e){console.warn("Texture3D: .textureType has been removed.")},configurable:!0}}),Object.defineProperties(Ip,{textureType:{get:function(){return console.warn("TextureCube: .textureType has been removed."),qm.TEXTURE_CUBE_MAP},set:function(e){console.warn("TextureCube: .textureType has been removed.")},configurable:!0}});const Xm={AMBIENT:"ambient",HEMISPHERE:"hemisphere",DIRECT:"direct",POINT:"point",SPOT:"spot"};Object.defineProperties(Fm.prototype,{lightType:{get:function(){return console.warn("Light: .lightType has been removed."),""},set:function(e){console.warn("Light: .lightType has been removed.")},configurable:!0}}),Object.defineProperties(Nm.prototype,{lightType:{get:function(){return console.warn("AmbientLight: .lightType has been removed."),Xm.AMBIENT},set:function(e){console.warn("AmbientLight: .lightType has been removed.")},configurable:!0}}),Object.defineProperties(Om.prototype,{lightType:{get:function(){return console.warn("DirectionalLight: .lightType has been removed."),Xm.DIRECT},set:function(e){console.warn("DirectionalLight: .lightType has been removed.")},configurable:!0}}),Object.defineProperties(km.prototype,{lightType:{get:function(){return console.warn("HemisphereLight: .lightType has been removed."),Xm.HEMISPHERE},set:function(e){console.warn("HemisphereLight: .lightType has been removed.")},configurable:!0}}),Object.defineProperties(Um.prototype,{lightType:{get:function(){return console.warn("PointLight: .lightType has been removed."),Xm.POINT},set:function(e){console.warn("PointLight: .lightType has been removed.")},configurable:!0}}),Object.defineProperties(jm.prototype,{lightType:{get:function(){return console.warn("SpotLight: .lightType has been removed."),Xm.SPOT},set:function(e){console.warn("SpotLight: .lightType has been removed.")},configurable:!0}});const Qm={MESH:"mesh",SKINNED_MESH:"skinned_mesh",LIGHT:"light",CAMERA:"camera",SCENE:"scene",GROUP:"group"};Object.defineProperties(ap.prototype,{type:{get:function(){return console.warn("Mesh: .type has been removed, use .isMesh instead."),Qm.MESH},set:function(e){console.warn("Mesh: .type has been removed.")},configurable:!0}}),Object.defineProperties(Gm.prototype,{type:{get:function(){return console.warn("SkinnedMesh: .type has been removed, use .isSkinnedMesh instead."),Qm.SKINNED_MESH},set:function(e){console.warn("SkinnedMesh: .type has been removed.")},configurable:!0}}),Object.defineProperties(Fm.prototype,{type:{get:function(){return console.warn("Light: .type has been removed, use .isLight instead."),Qm.LIGHT},set:function(e){console.warn("Light: .type has been removed.")},configurable:!0}}),Object.defineProperties(Bd.prototype,{type:{get:function(){return console.warn("Camera: .type has been removed, use .isCamera instead."),Qm.CAMERA},set:function(e){console.warn("Camera: .type has been removed.")},configurable:!0}}),Object.defineProperties(Nd.prototype,{type:{get:function(){return console.warn("Scene: .type has been removed, use .isScene instead."),Qm.SCENE},set:function(e){console.warn("Scene: .type has been removed.")},configurable:!0}}),Object.defineProperties(Wm.prototype,{type:{get:function(){return console.warn("Group: .type has been removed, use .isGroup instead."),Qm.GROUP},set:function(e){console.warn("Group: .type has been removed.")},configurable:!0}});const Km={NORMAL:"normal",EXP2:"exp2"};Object.defineProperties(lm.prototype,{fogType:{get:function(){return console.warn("Fog: .fogType has been removed, use .isFog instead."),Km.NORMAL},set:function(e){console.warn("Fog: .fogType has been removed.")},configurable:!0}}),Object.defineProperties(um.prototype,{fogType:{get:function(){return console.warn("FogExp2: .fogType has been removed, use .isFogExp2 instead."),Km.EXP2},set:function(e){console.warn("FogExp2: .fogType has been removed.")},configurable:!0}}),Bp.fromImage=function(e){console.warn("Texture2D.fromImage has been removed.");const t=new Bp;return t.image=e,t.version++,t},Bp.fromSrc=function(e){console.warn("Texture2D.fromSrc has been removed, use Texture2DLoader(jsm) instead.");const t=new Bp;return(new yh).load(e,(function(e){t.image=e,t.version++,t.dispatchEvent({type:"onload"})})),t},Ip.fromImage=function(e){console.warn("TextureCube.fromImage has been removed.");const t=new Ip,r=t.images;for(let t=0;t<6;t++)r[t]=e[t];return t.version++,t},Ip.fromSrc=function(e){console.warn("TextureCube.fromSrc has been removed, use TextureCubeLoader(jsm) instead.");const t=new Ip,r=t.images,n=new yh;let i=0;return function a(s){if(s&&(r.push(s),i++),i>=6)return t.version++,void t.dispatchEvent({type:"onload"});n.load(e[i],a)}(),t};var Ym=Object.freeze({__proto__:null,ATTACHMENT:Zc,AmbientLight:Nm,AnimationAction:th,AnimationMixer:dh,Attribute:up,BLEND_EQUATION:Ic,BLEND_FACTOR:Oc,BLEND_TYPE:Bc,BUFFER_USAGE:Jc,BasicMaterial:fm,Bone:Vm,BooleanKeyframeTrack:vc,Box2:bh,Box3:Sh,BoxGeometry:cm,Buffer:cp,COMPARE_FUNC:Wc,CULL_FACE_TYPE:kc,Camera:Bd,Color3:Eh,ColorKeyframeTrack:yc,CubeGeometry:cm,CylinderGeometry:hm,DRAW_MODE:Kc,DRAW_SIDE:Lc,DefaultLoadingManager:mh,DepthMaterial:Sp,DirectionalLight:Om,DirectionalLightShadow:Im,DistanceMaterial:Ep,ENVMAP_COMBINE_TYPE:Qc,EnvironmentMapPass:Hm,Euler:Dh,EventDispatcher:eh,FOG_TYPE:Km,FileLoader:_h,Fog:lm,FogExp2:um,Frustum:Ih,Geometry:_p,Group:Wm,HemisphereLight:km,ImageLoader:yh,KeyframeClip:ph,KeyframeTrack:_c,LIGHT_TYPE:Xm,LambertMaterial:mm,Light:Fm,LightData:pd,LightShadow:Bm,LineMaterial:gm,Loader:gh,LoadingManager:fh,MATERIAL_TYPE:Nc,MatcapMaterial:_m,Material:xp,Matrix3:Ph,Matrix4:Sc,Mesh:ap,NumberKeyframeTrack:xc,OBJECT_TYPE:Qm,OPERATION:Hc,Object3D:od,PBR2Material:vm,PBRMaterial:ym,PIXEL_FORMAT:zc,PIXEL_TYPE:jc,PhongMaterial:xm,Plane:Nh,PlaneGeometry:vp,PointLight:Um,PointLightShadow:Lm,PointsMaterial:bm,PropertyBindingMixer:rh,QUERY_TYPE:$c,Quaternion:Mc,QuaternionKeyframeTrack:Pc,Query:Dm,Ray:jh,RenderBuffer:Sm,RenderInfo:om,RenderQueue:Ed,RenderQueueLayer:Sd,RenderStates:Rd,RenderTarget2D:Em,RenderTargetBack:wm,RenderTargetBase:Am,RenderTargetCube:Cm,Renderer:sm,SHADING_TYPE:Uc,SHADOW_TYPE:qc,Scene:Nd,SceneData:Pd,ShaderChunk:of,ShaderLib:uf,ShaderMaterial:bp,ShaderPostPass:Ap,ShadowMapPass:wp,Skeleton:Pm,SkinnedMesh:Gm,Sphere:Wh,SphereGeometry:dm,Spherical:Hh,SpotLight:jm,SpotLightShadow:zm,StringKeyframeTrack:Fc,TEXEL_ENCODING_TYPE:Xc,TEXTURE_FILTER:Vc,TEXTURE_WRAP:Gc,Texture2D:Bp,Texture3D:Op,TextureBase:Np,TextureCube:Ip,TorusKnotGeometry:pm,Triangle:Yh,VERTEX_COLOR:Yc,Vector2:xh,Vector3:bc,Vector4:Zh,VectorKeyframeTrack:Rc,WEBGL_COMPARE_FUNC:Wc,WEBGL_OP:Hc,WEBGL_PIXEL_FORMAT:zc,WEBGL_PIXEL_TYPE:jc,WEBGL_TEXTURE_FILTER:Vc,WEBGL_TEXTURE_TYPE:qm,WEBGL_TEXTURE_WRAP:Gc,WebGLAttribute:tf,WebGLCapabilities:Af,WebGLGeometries:Hf,WebGLProgram:nf,WebGLPrograms:cf,WebGLProperties:Pf,WebGLQueries:Qf,WebGLRenderBuffers:Uf,WebGLRenderPass:am,WebGLState:Mf,WebGLTextures:Ff,WebGLUniforms:ef,cloneJson:id,cloneUniforms:nd,generateUUID:$h,isPowerOfTwo:ed,nearestPowerOfTwo:td,nextPowerOfTwo:rd});class Zm extends ap{constructor(e){const t=new cm(1,1,1),r=new bp(Zm.SkyBoxShader);r.side=Lc.BACK,super(t,r),this.material=r,e&&(this.texture=e),this.frustumCulled=!1}set level(e){this.material.uniforms.level=e}get level(){return this.material.uniforms.level}set gamma(e){this.material.defines.GAMMA=e,this.material.needsUpdate=!0}get gamma(){return this.material.defines.GAMMA}set texture(e){e.isTextureCube?(this.material.cubeMap=e,this.material.uniforms.flip=e.images[0]&&e.images[0].rtt?1:-1,this.material.defines.PANORAMA=!1):(this.material.diffuseMap=e,this.material.uniforms.flip=-1,this.material.defines.PANORAMA=""),this.material.needsUpdate=!0}get texture(){return this.material.diffuseMap||this.material.cubeMap}}Zm.SkyBoxShader={name:"skybox",defines:{GAMMA:!1,PANORAMA:!1},uniforms:{level:0,flip:-1},vertexShader:["#include <common_vert>","varying vec3 vDir;","void main() {","\tvDir = (u_Model * vec4(a_Position, 0.0)).xyz;","\tgl_Position = u_ProjectionView * u_Model * vec4(a_Position, 1.0);","\tgl_Position.z = gl_Position.w;","}"].join("\n"),fragmentShader:["#include <common_frag>","#ifdef PANORAMA","\tuniform sampler2D diffuseMap;","#else","\tuniform samplerCube cubeMap;","#endif","uniform float flip;","uniform float level;","varying vec3 vDir;","void main() {","\t#include <begin_frag>","\tvec3 V = normalize(vDir);","\t#ifdef PANORAMA","\t\tfloat phi = acos(V.y);","\t\tfloat theta = flip * atan(V.x, V.z) + PI * 0.5;","\t\tvec2 uv = vec2(theta / 2.0 / PI, -phi / PI);","\t\t#ifdef TEXTURE_LOD_EXT","\t\t\toutColor *= mapTexelToLinear(texture2DLodEXT(diffuseMap, fract(uv), level));","\t\t#else","\t\t\toutColor *= mapTexelToLinear(texture2D(diffuseMap, fract(uv), level));","\t\t#endif","\t#else","\t\tvec3 coordVec = vec3(flip * V.x, V.yz);","\t\t#ifdef TEXTURE_LOD_EXT","\t\t\toutColor *= mapTexelToLinear(textureCubeLodEXT(cubeMap, coordVec, level));","\t\t#else","\t\t\toutColor *= mapTexelToLinear(textureCube(cubeMap, coordVec, level));","\t\t#endif","\t#endif","\t#include <end_frag>","\t#ifdef GAMMA","\t\t#include <encodings_frag>","\t#endif","}"].join("\n")};const Jm="\n#ifdef USE_DIFFUSE_MAP\n\t#ifdef UV_DISCARD\n\t\tif (v_Uv.x < 0. || v_Uv.x > 1. || v_Uv.y < 0. || v_Uv.y > 1.) { \n\t\t\tdiscard;\n\t\t}\n\t#endif\n#endif\n",$m="\n#include <common_vert>\nvarying vec3 vDir;\nuniform mat4 rotationMatrix;\n\nvoid main() {\n    mat4 o_model = rotationMatrix * u_Model;\n\tvDir = (o_model * vec4(a_Position, 0.0)).xyz;\n\tgl_Position = u_ProjectionView * u_Model * vec4(a_Position, 1.0);\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n}\n",eg={instance_pars_vert:"\n#ifdef USE_INSTANCING\n\t\n\tattribute mat4 instanceMatrix;\n\n\t#if defined(USE_VCOLOR_RGB) || defined(USE_VCOLOR_RGBA)\n\t\t// attribute vec3 instanceColor;\n\t#endif\n\t\n#endif\n",instance_normal_vert:"\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\tobjectNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\tobjectNormal = im * objectNormal;\n#endif\n",instance_position_vert:"\n#ifdef USE_INSTANCING\n\ttransformed.xyz = ( instanceMatrix * vec4( transformed, 1.0 ) ).xyz;\n#endif\n",instance_color_vert:"\n#ifdef USE_INSTANCING\n\t#if defined(USE_VCOLOR_RGB) || defined(USE_VCOLOR_RGBA)\n\n\t\t// v_Color.xyz = instanceColor.xyz;\n\t\t// v_Color.xyz *= instanceColor.xyz;\n\n\t#endif\n#endif\n"},tg={gpu_picker_instanceStates_pars_vert:"\n#ifdef USE_GPUPICKER\n\t#ifdef USE_INSTANCING\n        attribute float instanceStates;\n\t#endif\n\n\tvarying float vinstanceStates;\n#endif\n",gpu_picker_instanceStates_vert:"\n#ifdef USE_GPUPICKER\n\t#ifdef USE_INSTANCING\n        vinstanceStates = instanceStates;\n\t#endif\n#endif\n",gpu_picker_instanceStates_pars_frag:"\n#ifdef USE_GPUPICKER\n\t#ifdef USE_INSTANCING\n        varying float vinstanceStates;\n\t#endif\n#endif\n",gpu_picker_instanceStates_frag:"\n#ifdef USE_GPUPICKER\n    #ifdef USE_INSTANCING\n        if(vinstanceStates == 0.0){\n            discard;\n        }\n    #endif\n#endif\n",gpu_picker_pars_vert:"\n#ifdef USE_GPUPICKER\n\t#ifdef USE_INSTANCING\n\t\tattribute float instanceID;\n\t#endif\n\n\t#ifdef USE_ATTRIBUTES_ID\n\t\tattribute float ids;\n\t#endif\n\n\tuniform float baseId;\n\t\n\tvarying vec3 vPickColor;\n\n\tvec3 packPickIdToRGB(float pickId) {\n\t\tvec3 a = fract(vec3(1.0 / 255.0, 1.0 / (255.0 * 255.0), 1.0 / (255.0 * 255.0 * 255.0)) * pickId);\n\t\ta -= a.xxy * vec3(0.0, 1.0 / 255.0, 1.0 / 255.0);\n\t\treturn a;\n\t}\n#endif\n",gpu_picker_id_vert:"\n#ifdef USE_GPUPICKER\n\t#ifdef USE_ATTRIBUTES_ID\n\t\tvPickColor = packPickIdToRGB(ids);\n\t#else\n\t\t#ifdef USE_INSTANCING\n\t\t\tvPickColor = packPickIdToRGB(instanceID);\n\t\t#else\n\t\t\tvPickColor = packPickIdToRGB(baseId);\n\t\t#endif\n\t#endif\n#endif\n",gpu_picker_point_size_vert:"\n#ifdef USE_GPUPICKER\n\tgl_PointSize = size * (scale / length(mvPosition.xyz));\n#endif\n",gpu_picker_pars_frag:"\n#ifdef USE_GPUPICKER\n\tvarying vec3 vPickColor;\n#endif\n",gpu_picker_id_frag:"\n#ifdef USE_GPUPICKER\n\tgl_FragColor = vec4(vPickColor, 1.);\n#endif\n"},rg={colormapping_pars_frag:"\n#ifdef COLOR_MAPPING\n  uniform sampler2D colorMapping;\n  uniform float colorMappingIntensity;\n#endif\n",colormapping_frag:"\n#ifdef COLOR_MAPPING\n  float gray = clamp( dot( outColor.rgb, vec3(0.333, 0.333, 0.333) ), 0.0, 1.0 );\n  outColor.rgb = mix( outColor.rgb, texture2D( colorMapping, vec2( gray, 0.5 ) ).rgb, colorMappingIntensity );\n#endif\n"},ng={fresnel_pars_frag:"\n#ifdef FRESNEL\n\tuniform float fresnelPower;\n\tuniform bool fresnelInverse;\n#endif\n",fresnel_frag:"\n#ifdef FRESNEL\n    vec3 normal = (transposeMat4(inverseMat4(u_View)) * vec4(N,0.0)).xyz;\n    normal = normalize(normal);\n\tif (fresnelInverse) {\n\t\tgl_FragColor.a *= pow( abs( dot( normal, vec3(0., 0., 1.) ) ), fresnelPower );\n\t} else {\n\t\tgl_FragColor.a *= pow( 1.0 - abs( dot( normal, vec3(0., 0., 1.) ) ), fresnelPower );\n\t}\n#endif\n"},ig={uv_pars_vert:"\n#if defined(USE_UV1) || defined(USE_UV2)\n    uniform mat3 uvTransform;\n#endif\n\n#ifdef USE_UV1\n    attribute vec2 a_Uv;\n    varying vec2 v_Uv;\n#endif\n\n#ifdef USE_UV2\n    attribute vec2 a_Uv2;\n    varying vec2 v_Uv2;\n#endif\n\n#ifdef USE_UV3\n    attribute vec2 a_Uv3;\n#endif\n",alphamap_vert:"\n#ifdef USE_ALPHA_MAP\n\n\t#if (USE_ALPHA_MAP == 2)\n        vAlphaMapUV = (alphaMapUVTransform * vec3(a_Uv2, 1.)).xy;\n    #elif (USE_ALPHA_MAP == 3)\n        vAlphaMapUV = (alphaMapUVTransform * vec3(a_Uv3, 1.)).xy;\n    #else\n        vAlphaMapUV = (alphaMapUVTransform * vec3(a_Uv, 1.)).xy;\n    #endif\n\n#endif\n",emissivemap_vert:"\n#ifdef USE_EMISSIVEMAP\n\t#if (USE_EMISSIVEMAP == 2)\n\t\tvEmissiveMapUV = (emissiveMapUVTransform * vec3(a_Uv2, 1.)).xy;\n    #elif (USE_EMISSIVEMAP == 3)\n        vEmissiveMapUV = (emissiveMapUVTransform * vec3(a_Uv3, 1.)).xy;\n\t#else\n\t\tvEmissiveMapUV = (emissiveMapUVTransform * vec3(a_Uv, 1.)).xy;\n\t#endif\n#endif\n",emissivemap_frag:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D(emissiveMap, vEmissiveMapUV);\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n\t#ifdef USE_PBR\n\t\t#ifdef USE_SIDE_EMISSIVE\n\t\t\tvec3 emissiveUp = vec3(0., 1., 0.);\n\n\t\t\ttotalEmissiveRadiance.rgb *= totalEmissiveRadiance.rgb * (1. - abs(dot(v_Normal, emissiveUp)));\n\t\t#endif\n\t#endif\n\n#endif\n"},ag={light_frag:"\n// Use v_modelPos from modelPos_pars_frag\n// Use geometryNormal, N from normal_frag\n\n#ifdef USE_LIGHT\n\n    #ifdef USE_PBR\n        #ifdef USE_PBR2\n            vec3 diffuseColor = outColor.xyz;\n            vec3 specularColor = specularFactor.xyz;\n\t\t\tfloat roughness = max(1.0 - glossinessFactor, 0.0525);\n        #else\n            vec3 diffuseColor = outColor.xyz * (1.0 - metalnessFactor);\n            vec3 specularColor = mix(vec3(0.04), outColor.xyz, metalnessFactor);\n            float roughness = max(roughnessFactor, 0.0525);\n        #endif\n\n        vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));\n        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\n        roughness += geometryRoughness;\n\n        roughness = min(roughness, 1.0);\n\n        #ifdef USE_CLEARCOAT\n            float clearcoat = u_Clearcoat;\n            float clearcoatRoughness = u_ClearcoatRoughness;\n            #ifdef USE_CLEARCOATMAP\n\t\t        clearcoat *= texture2D(clearcoatMap, v_Uv).x;\n            #endif\n            #ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\t        clearcoatRoughness *= texture2D(clearcoatRoughnessMap, v_Uv).y;\n\t        #endif\n            clearcoat = saturate(clearcoat);\n            clearcoatRoughness = max(clearcoatRoughness, 0.0525);\n\t        clearcoatRoughness += geometryRoughness;\n\t        clearcoatRoughness = min(clearcoatRoughness, 1.0);\n        #endif\n\n    #else\n        vec3 diffuseColor = outColor.xyz;\n        #ifdef USE_PHONG\n            vec3 specularColor = u_SpecularColor.xyz;\n            float shininess = u_Specular;\n        #endif\n    #endif\n\n    #if (defined(USE_PHONG) || defined(USE_PBR))\n        vec3 V = normalize(u_CameraPosition - v_modelPos);\n    #endif\n\n    vec3 L;\n    float falloff;\n    float dotNL;\n    vec3 irradiance;\n\n    float clearcoatDHR;\n\n    #ifdef USE_CLEARCOAT\n        float ccDotNL;\n        vec3 ccIrradiance;\n    #endif\n\n    #if NUM_DIR_LIGHTS > 0\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n            L = normalize(-u_Directional[i].direction);\n            falloff = 1.0;\n\n            #if defined(USE_SHADOW) && (UNROLLED_LOOP_INDEX < NUM_DIR_SHADOWS)\n                #ifdef USE_PCSS_SOFT_SHADOW\n                    falloff *= getShadowWithPCSS(directionalDepthMap[i], directionalShadowMap[i], vDirectionalShadowCoord[i], u_DirectionalShadow[i].shadowMapSize, u_DirectionalShadow[i].shadowBias, u_DirectionalShadow[i].shadowParams);\n                #else\n                    falloff *= getShadow(directionalShadowMap[i], vDirectionalShadowCoord[i], u_DirectionalShadow[i].shadowMapSize, u_DirectionalShadow[i].shadowBias, u_DirectionalShadow[i].shadowParams);\n                #endif\n            #endif\n\n            dotNL = saturate(dot(N, L));\n            irradiance = u_Directional[i].color * falloff * dotNL * PI;\n\n            #ifdef USE_CLEARCOAT        \n                ccDotNL = saturate(dot(clearcoatNormal, L));\n                ccIrradiance = ccDotNL * u_Directional[i].color * falloff  * PI;\n                clearcoatDHR = clearcoat * clearcoatDHRApprox(clearcoatRoughness, ccDotNL);\n                reflectedLight.directSpecular += ccIrradiance * clearcoat * BRDF_Specular_GGX(specularColor, clearcoatNormal, L, V, clearcoatRoughness);\n            #else\n\t\t        clearcoatDHR = 0.0;\n\t        #endif\n\n            reflectedLight.directDiffuse += (1.0 - clearcoatDHR) * irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n\n            #ifdef USE_PHONG\n                reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n            #endif\n\n            #ifdef USE_PBR\n                reflectedLight.directSpecular += specularFactor * (1.0 - clearcoatDHR) * irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness);    // Modification : add specular factor\n            #endif\n        }\n        #pragma unroll_loop_end\n    #endif\n\n    #if NUM_POINT_LIGHTS > 0\n        vec3 worldV;\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n            worldV = v_modelPos - u_Point[i].position;\n\n            L = -worldV;\n            falloff = pow(clamp(1. - length(L) / u_Point[i].distance, 0.0, 1.0), u_Point[i].decay);\n            L = normalize(L);\n\n            #if defined(USE_SHADOW) && (UNROLLED_LOOP_INDEX < NUM_POINT_SHADOWS)\n                falloff *= getPointShadow(pointShadowMap[i], vPointShadowCoord[i], u_PointShadow[i].shadowMapSize, u_PointShadow[i].shadowBias, u_PointShadow[i].shadowParams, u_PointShadow[i].shadowCameraRange);\n            #endif\n\n            dotNL = saturate(dot(N, L));\n            irradiance = u_Point[i].color * falloff * dotNL * PI;\n\n            #ifdef USE_CLEARCOAT        \n                ccDotNL = saturate(dot(clearcoatNormal, L));\n                ccIrradiance = ccDotNL * u_Point[i].color * falloff  * PI;\n                clearcoatDHR = clearcoat * clearcoatDHRApprox(clearcoatRoughness, ccDotNL);\n                reflectedLight.directSpecular += ccIrradiance * clearcoat * BRDF_Specular_GGX(specularColor, clearcoatNormal, L, V, clearcoatRoughness);\n            #else\n\t\t        clearcoatDHR = 0.0;\n\t        #endif\n\n            reflectedLight.directDiffuse += (1.0 - clearcoatDHR) * irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n\n            #ifdef USE_PHONG\n                reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n            #endif\n\n            #ifdef USE_PBR\n                reflectedLight.directSpecular += specularFactor * (1.0 - clearcoatDHR) * irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness);    // Modification : add specular factor\n            #endif\n        }\n        #pragma unroll_loop_end\n    #endif\n\n    #if NUM_SPOT_LIGHTS > 0\n        float lightDistance;\n        float angleCos;\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n            L = u_Spot[i].position - v_modelPos;\n            lightDistance = length(L);\n            L = normalize(L);\n            angleCos = dot(L, -normalize(u_Spot[i].direction));\n\n            falloff = smoothstep(u_Spot[i].coneCos, u_Spot[i].penumbraCos, angleCos);\n            falloff *= pow(clamp(1. - lightDistance / u_Spot[i].distance, 0.0, 1.0), u_Spot[i].decay);\n\n            #if defined(USE_SHADOW) && (UNROLLED_LOOP_INDEX < NUM_SPOT_SHADOWS)\n                #ifdef USE_PCSS_SOFT_SHADOW\n                    falloff *= getShadowWithPCSS(spotDepthMap[i], spotShadowMap[i], vSpotShadowCoord[i], u_SpotShadow[i].shadowMapSize, u_SpotShadow[i].shadowBias, u_SpotShadow[i].shadowParams);\n                #else\n                    falloff *= getShadow(spotShadowMap[i], vSpotShadowCoord[i], u_SpotShadow[i].shadowMapSize, u_SpotShadow[i].shadowBias, u_SpotShadow[i].shadowParams);\n                #endif\n            #endif\n\n            dotNL = saturate(dot(N, L));\n            irradiance = u_Spot[i].color * falloff * dotNL * PI;\n\n            #ifdef USE_CLEARCOAT        \n                ccDotNL = saturate(dot(clearcoatNormal, L));\n                ccIrradiance = ccDotNL * u_Directional[i].color * falloff  * PI;\n                clearcoatDHR = clearcoat * clearcoatDHRApprox(clearcoatRoughness, ccDotNL);\n                reflectedLight.directSpecular += ccIrradiance * clearcoat * BRDF_Specular_GGX(specularColor, clearcoatNormal, L, V, clearcoatRoughness);\n            #else\n                clearcoatDHR = 0.0;\n            #endif\n\n            reflectedLight.directDiffuse += (1.0 - clearcoatDHR) * irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n\n            #ifdef USE_PHONG\n                reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n            #endif\n\n            #ifdef USE_PBR\n                reflectedLight.directSpecular += specularFactor * (1.0 - clearcoatDHR) * irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness);    // Modification : add specular factor\n            #endif\n        }\n        #pragma unroll_loop_end\n    #endif\n\n    vec3 iblIrradiance = vec3(0., 0., 0.);\n    vec3 indirectIrradiance = vec3(0., 0., 0.);\n    vec3 indirectRadiance = vec3(0., 0., 0.);\n\n    #ifdef USE_AMBIENT_LIGHT\n        indirectIrradiance += u_AmbientLightColor * PI;\n    #endif\n\n    #if NUM_HEMI_LIGHTS > 0\n        float hemiDiffuseWeight;\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < NUM_HEMI_LIGHTS; i++) {\n            L = normalize(u_Hemi[i].direction);\n\n            dotNL = dot(N, L);\n            hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n            indirectIrradiance += mix(u_Hemi[i].groundColor, u_Hemi[i].skyColor, hemiDiffuseWeight) * PI;\n        }\n        #pragma unroll_loop_end\n    #endif\n\n    // TODO light map\n\n    #if defined(USE_ENV_MAP) && defined(USE_PBR)\n        vec3 envDir;\n        #ifdef USE_VERTEX_ENVDIR\n            envDir = v_EnvDir;\n        #else\n            envDir = reflect(normalize(v_modelPos - u_CameraPosition), N);\n        #endif\n        iblIrradiance += getLightProbeIndirectIrradiance(maxMipLevel, N);\n        indirectRadiance += getLightProbeIndirectRadiance(GGXRoughnessToBlinnExponent(roughness), maxMipLevel, envDir);\n\n        #ifdef USE_CLEARCOAT\n            vec3 clearcoatDir = reflect(normalize(v_modelPos - u_CameraPosition), clearcoatNormal);\n            clearcoatRadiance += getLightProbeIndirectRadiance(GGXRoughnessToBlinnExponent(clearcoatRoughness), maxMipLevel, clearcoatDir);\n        #endif\n\n    #endif\n\n    reflectedLight.indirectDiffuse += indirectIrradiance * BRDF_Diffuse_Lambert(diffuseColor);\n\n    #if defined(USE_ENV_MAP) && defined(USE_PBR)\n        // reflectedLight.indirectSpecular += indirectRadiance * BRDF_Specular_GGX_Environment(N, V, specularColor, roughness);\n\n        #ifdef USE_CLEARCOAT\n            float ccDotNV = saturate(dot(clearcoatNormal, V));\n            reflectedLight.indirectSpecular += clearcoatRadiance * clearcoat * BRDF_Specular_GGX_Environment(clearcoatNormal, V, specularColor, clearcoatRoughness);\n            ccDotNL = ccDotNV;\n            clearcoatDHR = clearcoat * clearcoatDHRApprox(clearcoatRoughness, ccDotNL);\n        #else\n            clearcoatDHR = 0.0;\n        #endif\n\n        float clearcoatInv = 1.0 - clearcoatDHR;\n\n        // Both indirect specular and indirect diffuse light accumulate here\n\n        vec3 singleScattering = vec3(0.0);\n\t    vec3 multiScattering = vec3(0.0);\n\n        vec3 cosineWeightedIrradiance = iblIrradiance * RECIPROCAL_PI;\n\n        BRDF_Specular_Multiscattering_Environment(N, V, specularColor, roughness, singleScattering, multiScattering);\n\n        vec3 diffuse = diffuseColor * (1.0 - (singleScattering + multiScattering));\n\n        reflectedLight.indirectSpecular += clearcoatInv * indirectRadiance * singleScattering;\n        reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n        reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n    #endif\n\n#endif\n",simulate_basic_1_frag:"\n#ifdef SIMULATE_BASIC\n    reflectedLight.indirectDiffuse += vec3(1.0);\n#endif\n",simulate_basic_2_frag:"\n#ifdef SIMULATE_BASIC\n    reflectedLight.indirectDiffuse *= outColor.xyz;\n    outColor.xyz = reflectedLight.indirectDiffuse;\n#else\n    outColor.xyz = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n#endif\n"};Mc.prototype.inverse=function(){return this.conjugate()},Mc.prototype.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this};const sg=new bc,og=new Sc;delete am.prototype.textures,delete am.prototype.renderBuffers,delete am.prototype.renderTarget,delete am.prototype.state,delete am.prototype.vertexArrayBindings,sm.prototype.setAnimationLoop=e=>{const t=e;window.requestAnimationFrame((function e(r,n){t(r,n),window.requestAnimationFrame(e)}))},xh.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},xh.prototype.clampScalar=function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},xh.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},xh.prototype.multiply=function(e){return this.x*=e.x,this.y*=e.y,this},xh.prototype.toArray=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},xh.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},xh.prototype.dot=function(e){return this.x*e.x+this.y*e.y},xh.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Ph.prototype.fromArray=function(e,t){void 0===t&&(t=0);for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this},Ph.prototype.toArray=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e},Sc.prototype.compose=function(e,t,r){const n=this.elements,i=t._x,a=t._y,s=t._z,o=t._w,l=i+i,u=a+a,c=s+s,h=i*l,d=i*u,p=i*c,f=a*u,m=a*c,g=s*c,_=o*l,v=o*u,y=o*c,x=r.x,b=r.y,A=r.z;return n[0]=(1-(f+g))*x,n[1]=(d+y)*x,n[2]=(p-v)*x,n[3]=0,n[4]=(d-y)*b,n[5]=(1-(h+g))*b,n[6]=(m+_)*b,n[7]=0,n[8]=(p+v)*A,n[9]=(m-_)*A,n[10]=(1-(h+f))*A,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},Sc.prototype.makeScale=function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},Dh.prototype.fromArray=function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},Dh.prototype.toArray=function(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},delete Np.prototype.textureType,delete Bp.prototype.textureType,delete Op.prototype.textureType,delete Ip.prototype.textureType,Np.prototype.toString=function(){return"[object Texture]"};const lg=_p.prototype.computeBoundingBox;_p.prototype.computeBoundingBox=function(){(this.attributes.a_Position||this.attributes.position)&&lg.call(this)};const ug=_p.prototype.computeBoundingSphere;function cg(e,t,r){return Math.max(t,Math.min(r,e))}_p.prototype.computeBoundingSphere=function(){(this.attributes.a_Position||this.attributes.position)&&ug.call(this)},bc.prototype.setFromMatrix3Column=function(e,t){return this.fromArray(e.elements,3*t)},bc.prototype.clamp=function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},bc.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Sh.prototype.setFromCenterAndSize=function(e,t){const r=_vector.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},Sh.prototype.getSize=function(e){return void 0===e&&(console.warn("T3D.Box3: .getSize() target is now required"),e=new bc),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},Ph.prototype.extractBasis=function(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this},Mc.prototype.clone=function(){return new this.constructor(this._x,this._y,this._z,this._w)},Mc.prototype.setFromRotationMatrix3=function(e){const t=e.elements,r=t[0],n=t[3],i=t[6],a=t[1],s=t[4],o=t[7],l=t[2],u=t[5],c=t[8],h=r+s+c;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(u-o)*e,this._y=(i-l)*e,this._z=(a-n)*e}else if(r>s&&r>c){const e=2*Math.sqrt(1+r-s-c);this._w=(u-o)/e,this._x=.25*e,this._y=(n+a)/e,this._z=(i+l)/e}else if(s>c){const e=2*Math.sqrt(1+s-r-c);this._w=(i-l)/e,this._x=(n+a)/e,this._y=.25*e,this._z=(o+u)/e}else{const e=2*Math.sqrt(1+c-r-s);this._w=(a-n)/e,this._x=(i+l)/e,this._y=(o+u)/e,this._z=.25*e}return this.onChangeCallback(),this},Eh.prototype.getHexString=function(){return("000000"+this.getHex().toString(16)).slice(-6)},Eh.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},Eh.prototype.isColor3=!0,delete Bd.prototype.type,delete Bd.prototype.gammaInput,delete Bd.prototype.gammaOutput,bh.prototype.containsPoint=function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},delete Wm.prototype.type,od.prototype.updateWorldMatrix=function(e,t){const r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),(this.matrixAutoUpdate||this.matrixNeedsUpdate)&&this.updateMatrix(),null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix),!0===t){const e=this.children;for(let t=0,r=e.length;t<r;t++)e[t].updateWorldMatrix(!1,!0)}},od.prototype.applyMatrix4=function(e){(this.matrixAutoUpdate||this.matrixNeedsUpdate)&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},od.prototype.worldToLocal=function(e){return e.applyMatrix4(og.getInverse(this.worldMatrix))},od.prototype.localToWorld=function(e){return e.applyMatrix4(this.worldMatrix)},od.prototype.attach=function(e){return this.updateWorldMatrix(!0,!1),og.getInverse(this.worldMatrix),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),og.multiply(e.parent.worldMatrix)),e.applyMatrix4(og),e.updateWorldMatrix(!1,!1),this.add(e),this},od.prototype.addBeforeRenderFunction=function(e,t,r){const n={name:t,func:e};this._beforeRenderFunctions=this._beforeRenderFunctions||[];const i=this._beforeRenderFunctions;if(void 0!==r&&i.length?(i.splice(r,0,n),n.index=r):(i.push(n),n.index=i.length-1),1===i.length){const e=this.onBeforeRender;e&&"function () {}"!=e.toString()&&i.splice(0,0,{name:"__originalBeforeRender__",func:e});const t=this;this.onBeforeRender=function(e,r){for(let n=0,i=t._beforeRenderFunctions.length;n<i;n++){t._beforeRenderFunctions[n].func.call(t,e,r)}}}return n},od.prototype.removeBeforeRenderFunction=function(e){var t=this._beforeRenderFunctions,r=t.indexOf(e);-1!==r&&t.splice(r,1),t.length||(this.onBeforeRender=function(){})},delete xp.prototype.emissiveIntensity,Object.defineProperty(xp.prototype,"needsUpdate",{set:function(e){!0===e&&(this.version=void 0===this.version?0:this.version,this.version++),this._needsUpdate=e},get:function(){return!!this._needsUpdate}}),delete ap.prototype.type,delete Gm.prototype.type;const hg=ap.prototype.copy;ap.prototype.copy=function(e){return hg.call(this,e),e.effects&&(this.effects=id(e.effects)),e._cachedEffects&&(this._cachedEffects=id(e._cachedEffects)),this},Object.defineProperty(Ip.prototype,"isTextureCube",{get:function(){return!0}}),Object.defineProperty(Sc.prototype,"isMatrix4",{get:function(){return!0}}),Sc.prototype.clone=function(){return(new Sc).fromArray(this.elements)},Zm.SkyBoxShader.uniforms.rotationMatrix=og.identity().toArray(),Zm.SkyBoxShader.vertexShader=$m,Object.defineProperty(Zm.prototype,"isSkyBox",{get:function(){return!0}}),Object.defineProperty(Zh.prototype,"isVector4",{get:function(){return!0}}),Wh.prototype.isEmpty=function(){return this.radius<=0&&0==(this.center.x|this.center.y|this.center.z)},jh.prototype.distanceSqToPoint=function(e){const t=sg.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(sg.copy(this.direction).multiplyScalar(t).add(this.origin),sg.distanceToSquared(e))},jh.prototype.closestPointToPoint=function(e,t){void 0===t&&(console.warn("T3D.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},delete Fm.prototype.lightType,delete Fm.prototype.type,delete Nm.prototype.lightType,delete Om.prototype.lightType,delete km.prototype.lightType,delete Um.prototype.lightType,delete jm.prototype.lightType,delete Nd.prototype.type,delete lm.prototype.fogType,delete um.prototype.fogType;var dg={c:null,u:[new bc,new bc,new bc],e:[]},pg={c:null,u:[new bc,new bc,new bc],e:[]},fg=[[],[],[]],mg=[[],[],[]],gg=[],_g=new bc,vg=new bc,yg=new bc,xg=new bc,bg=new bc,Ag=new bc,Sg=new Ph,Eg=new Sh,wg=new Sc,Cg=new Sc,Tg=new jh;class Dg{constructor(e=new bc,t=new bc,r=new Ph){this.center=e,this.halfSize=t,this.rotation=r}set(e,t,r){return this.center=e,this.halfSize=t,this.rotation=r,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return(new this.constructor).copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,t){var r=this.halfSize;xg.subVectors(e,this.center),this.rotation.extractBasis(_g,vg,yg),t.copy(this.center);var n=cg(xg.dot(_g),-r.x,r.x);t.add(_g.multiplyScalar(n));var i=cg(xg.dot(vg),-r.y,r.y);t.add(vg.multiplyScalar(i));var a=cg(xg.dot(yg),-r.z,r.z);return t.add(yg.multiplyScalar(a)),t}containsPoint(e){return xg.subVectors(e,this.center),this.rotation.extractBasis(_g,vg,yg),Math.abs(xg.dot(_g))<=this.halfSize.x&&Math.abs(xg.dot(vg))<=this.halfSize.y&&Math.abs(xg.dot(yg))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB(obb.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,Ag),Ag.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e,t=Number.EPSILON){dg.c=this.center,dg.e[0]=this.halfSize.x,dg.e[1]=this.halfSize.y,dg.e[2]=this.halfSize.z,this.rotation.extractBasis(dg.u[0],dg.u[1],dg.u[2]),pg.c=e.center,pg.e[0]=e.halfSize.x,pg.e[1]=e.halfSize.y,pg.e[2]=e.halfSize.z,e.rotation.extractBasis(pg.u[0],pg.u[1],pg.u[2]);for(var r=0;r<3;r++)for(var n=0;n<3;n++)fg[r][n]=dg.u[r].dot(pg.u[n]);xg.subVectors(pg.c,dg.c),gg[0]=xg.dot(dg.u[0]),gg[1]=xg.dot(dg.u[1]),gg[2]=xg.dot(dg.u[2]);for(r=0;r<3;r++)for(n=0;n<3;n++)mg[r][n]=Math.abs(fg[r][n])+t;var i,a;for(r=0;r<3;r++)if(i=dg.e[r],a=pg.e[0]*mg[r][0]+pg.e[1]*mg[r][1]+pg.e[2]*mg[r][2],Math.abs(gg[r])>i+a)return!1;for(r=0;r<3;r++)if(i=dg.e[0]*mg[0][r]+dg.e[1]*mg[1][r]+dg.e[2]*mg[2][r],a=pg.e[r],Math.abs(gg[0]*fg[0][r]+gg[1]*fg[1][r]+gg[2]*fg[2][r])>i+a)return!1;return i=dg.e[1]*mg[2][0]+dg.e[2]*mg[1][0],a=pg.e[1]*mg[0][2]+pg.e[2]*mg[0][1],!(Math.abs(gg[2]*fg[1][0]-gg[1]*fg[2][0])>i+a)&&(i=dg.e[1]*mg[2][1]+dg.e[2]*mg[1][1],a=pg.e[0]*mg[0][2]+pg.e[2]*mg[0][0],!(Math.abs(gg[2]*fg[1][1]-gg[1]*fg[2][1])>i+a)&&(i=dg.e[1]*mg[2][2]+dg.e[2]*mg[1][2],a=pg.e[0]*mg[0][1]+pg.e[1]*mg[0][0],!(Math.abs(gg[2]*fg[1][2]-gg[1]*fg[2][2])>i+a)&&(i=dg.e[0]*mg[2][0]+dg.e[2]*mg[0][0],a=pg.e[1]*mg[1][2]+pg.e[2]*mg[1][1],!(Math.abs(gg[0]*fg[2][0]-gg[2]*fg[0][0])>i+a)&&(i=dg.e[0]*mg[2][1]+dg.e[2]*mg[0][1],a=pg.e[0]*mg[1][2]+pg.e[2]*mg[1][0],!(Math.abs(gg[0]*fg[2][1]-gg[2]*fg[0][1])>i+a)&&(i=dg.e[0]*mg[2][2]+dg.e[2]*mg[0][2],a=pg.e[0]*mg[1][1]+pg.e[1]*mg[1][0],!(Math.abs(gg[0]*fg[2][2]-gg[2]*fg[0][2])>i+a)&&(i=dg.e[0]*mg[1][0]+dg.e[1]*mg[0][0],a=pg.e[1]*mg[2][2]+pg.e[2]*mg[2][1],!(Math.abs(gg[1]*fg[0][0]-gg[0]*fg[1][0])>i+a)&&(i=dg.e[0]*mg[1][1]+dg.e[1]*mg[0][1],a=pg.e[0]*mg[2][2]+pg.e[2]*mg[2][0],!(Math.abs(gg[1]*fg[0][1]-gg[0]*fg[1][1])>i+a)&&(i=dg.e[0]*mg[1][2]+dg.e[1]*mg[0][2],a=pg.e[0]*mg[2][1]+pg.e[1]*mg[2][0],!(Math.abs(gg[1]*fg[0][2]-gg[0]*fg[1][2])>i+a)))))))))}intersectsPlane(e){this.rotation.extractBasis(_g,vg,yg);const t=this.halfSize.x*Math.abs(e.normal.dot(_g))+this.halfSize.y*Math.abs(e.normal.dot(vg))+this.halfSize.z*Math.abs(e.normal.dot(yg)),r=e.normal.dot(this.center)-e.constant;return Math.abs(r)<=t}intersectRay(e,t){return this.getSize(bg),Eg.setFromCenterAndSize(xg.set(0,0,0),bg),function(e,t){var r=e.elements,n=t.elements;r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=n[3],r[5]=n[4],r[6]=n[5],r[7]=0,r[8]=n[6],r[9]=n[7],r[10]=n[8],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1}(wg,this.rotation),wg.setPosition(this.center),Tg.copy(e).applyMatrix4(Cg.getInverse(wg)),Tg.intersectsBox(Eg,t)?t.applyMatrix4(wg):null}intersectsRay(e){return null!==this.intersectRay(e,xg)}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){var t=e.elements,r=xg.set(t[0],t[1],t[2]).length(),n=xg.set(t[4],t[5],t[6]).length(),i=xg.set(t[8],t[9],t[10]).length();e.determinant()<0&&(r=-r),Sg.setFromMatrix4(e);var a=1/r,s=1/n,o=1/i;return Sg.elements[0]*=a,Sg.elements[1]*=a,Sg.elements[2]*=a,Sg.elements[3]*=s,Sg.elements[4]*=s,Sg.elements[5]*=s,Sg.elements[6]*=o,Sg.elements[7]*=o,Sg.elements[8]*=o,this.rotation.multiply(Sg),this.halfSize.x*=r,this.halfSize.y*=n,this.halfSize.z*=i,xg.setFromMatrixPosition(e),this.center.add(xg),this}}const Mg=`\n#include <common_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <uv_pars_vert>\n#include <modelPos_pars_vert>\n#include <logdepthbuf_pars_vert>\n${eg.instance_pars_vert}\nvoid main() {\n    #include <uv_vert>\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <skinning_vert>\n\n\t${eg.instance_position_vert}\n\n    #include <pvm_vert>\n    #include <logdepthbuf_vert>\n    #include <modelPos_vert>\n}\n`;class Pg extends Sp{constructor(){super(...arguments),this.type=Nc.SHADER,this.shaderName="CUSTOM_DEPTH",this.vertexShader=Mg,this.fragmentShader="\n#include <common_frag>\n#include <diffuseMap_pars_frag>\n\n#include <modelPos_pars_frag>\n#include <uv_pars_frag>\n\n#include <packing>\n\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\n\nvoid main() {\n    #include <clippingPlanes_frag>\n\n    #if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n        vec4 texelColor = texture2D( diffuseMap, v_Uv );\n\n        float alpha = texelColor.a * u_Opacity;\n        if(alpha < ALPHATEST) discard;\n    #endif\n\n    #include <logdepthbuf_frag>\n    \n    #ifdef DEPTH_PACKING_RGBA\n        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n    #else\n        gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), u_Opacity );\n    #endif\n}\n"}}Pg.prototype.useDefaultBufferMaterial=!0;const Fg=`\n#include <common_vert>\n#include <modelPos_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n${eg.instance_pars_vert}\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <skinning_vert>\n\t${eg.instance_position_vert}\n    #include <pvm_vert>\n    #include <modelPos_vert>\n}\n`;class Rg extends Ep{constructor(){super(...arguments),this.type=Nc.SHADER,this.shaderName="CUSTOM_DISTANCE",this.vertexShader=Fg,this.fragmentShader="\n#include <common_frag>\nuniform float nearDistance;\nuniform float farDistance;\n#include <modelPos_pars_vert>\n#include <packing>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n\t#include <clippingPlanes_frag>\n\n    float dist = length( v_modelPos - u_CameraPosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n    gl_FragColor = packDepthToRGBA(dist);\n}\n"}}Rg.prototype.useDefaultBufferMaterial=!0;class Ng extends gh{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(r){t&&t(r),i.manager.itemEnd(e)})).catch((function(t){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}const Bg=new RegExp("[\\[\\]\\.:\\/]","g");class Ig{constructor(){}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Bg,"")}static extractUrlBase(e){const t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"}static resolveURL(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e}static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static parseGLB(e){const t=1313821514,r=5130562,n=new DataView(e),i={magic:n.getUint32(0,!0),version:n.getUint32(4,!0),length:n.getUint32(8,!0)};if(1179937895!==i.magic)return console.error("Invalid glb magic number. Expected 0x46546C67, found 0x"+i.magic.toString(16)),null;i.version<2&&console.error("GLTFLoader: Legacy binary file detected.");let a=n.getUint32(12,!0),s=n.getUint32(16,!0);if(s!==t)return console.error("Invalid glb chunk type. Expected 0x4E4F534A, found 0x"+s.toString(16)),null;const o=new Uint8Array(e,20,a),l=JSON.parse(Ig.decodeText(o)),u=[];let c=20+a;for(;c<i.length;){if(a=n.getUint32(c,!0),s=n.getUint32(c+4,!0),s!==r)return console.error("Invalid glb chunk type. Expected 0x004E4942, found 0x"+s.toString(16)),null;const t=c+8,i=e.slice(t,t+a);u.push(i),c+=a+8}return{gltf:l,buffers:u}}static getNormalizedComponentScale(e){if(e===Int8Array)return 1/127;if(e===Uint8Array)return 1/255;if(e===Int16Array)return 1/32767;if(e===Uint16Array)return 1/65535;throw new Error("Unsupported normalized accessor component type.")}}class Og{static parse(e,t){const{url:r}=e;return t.loadFile(r,"arraybuffer").then((t=>{if("glTF"===Ig.decodeText(new Uint8Array(t,0,4))){const r=Ig.parseGLB(t);e.gltf=r.gltf,e.buffers=r.buffers}else{const r=Ig.decodeText(new Uint8Array(t));e.gltf=JSON.parse(r)}}))}}class kg{static parse(e,t){const{gltf:r,path:n}=e,{nodes:i=[],skins:a=[],meshes:s=[],buffers:o,images:l}=r;if(a.forEach((e=>{const{joints:t=[]}=e;t.forEach((e=>{i[e].isBone=!0}))})),i.forEach((e=>{void 0!==e.mesh&&void 0!==e.skin&&(s[e.mesh].isSkinned=!0)})),t.detailLoadProgress){const r=new Set;o&&o.forEach((e=>{if(!e.uri)return;const t=Ig.resolveURL(e.uri,n);r.add(t)})),l&&l.forEach(((e,t)=>{const{uri:i,bufferView:a}=e;let s=i;void 0!==a&&(s="blob<"+t+">"),s=Ig.resolveURL(s,n),r.add(s)})),r.forEach((e=>t.manager.itemStart(e))),e.loadItems=r}}}class Lg{static parse(e){const{gltf:{asset:{version:t}}}=e,r=Number(t);if(!(r>=2&&r<3))throw"Only support gltf 2.x."}}class Ug{static parse(e,t){const{gltf:r,loadItems:n}=e;return null!==e.buffers?null:Promise.all(r.buffers.map((r=>{const i=Ig.resolveURL(r.uri,e.path);t.detailLoadProgress&&n.delete(i);const a=t.loadFile(i,"arraybuffer").then((e=>(t.detailLoadProgress&&t.manager.itemEnd(i),e)));return t.detailLoadProgress&&a.catch((()=>t.manager.itemEnd(i))),a}))).then((t=>{e.buffers=t}))}}class zg{static loadBufferView(e,t,r){const n=t[e.buffer];if(!r||!r.supported)throw new Error("GLTFLoader: setMeshoptDecoder must be called before loading compressed files.");const i=e.byteOffset||0,a=e.byteLength||0,s=e.count,o=e.byteStride,l=new Uint8Array(n,i,a);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,o,l,e.mode,e.filter).then((e=>e.buffer)):r.ready.then((()=>{const t=new ArrayBuffer(s*o);return r.decodeGltfBuffer(new Uint8Array(t),s,o,l,e.mode,e.filter),t}))}}class jg{static parse(e,t){const{buffers:r,gltf:n}=e;if(n.bufferViews)return Promise.all(n.bufferViews.map((e=>{const{buffer:n,byteOffset:i=0,byteLength:a=0}=e;if(e.extensions){const{EXT_meshopt_compression:n}=e.extensions;if(n)return zg.loadBufferView(n,r,t.getMeshoptDecoder())}return r[n].slice(i,i+a)}))).then((t=>{e.bufferViews=t}))}}class Vg{static loadTextureData(e,t){return new Promise(((r,n)=>{t.load(e,r,void 0,n)}))}}function Gg(e){const{loader:t,imageUrl:r,imageName:n,isObjectURL:i,sourceUrl:a,index:s,path:o}=e;return t.loadImage(r).then((e=>(e.__name=n,!0===i&&URL.revokeObjectURL(a),t.detailLoadProgress&&(i?t.manager.itemEnd(Ig.resolveURL("blob<"+s+">",o)):t.manager.itemEnd(r)),e)))}const Wg={POSITION:"a_Position",NORMAL:"a_Normal",TANGENT:"a_Tangent",TEXCOORD_0:"a_Uv",TEXCOORD_1:"a_Uv2",TEXCOORD_2:"a_Uv3",TEXCOORD_3:"a_Uv4",TEXCOORD_4:"a_Uv5",TEXCOORD_5:"a_Uv6",TEXCOORD_6:"a_Uv7",TEXCOORD_7:"a_Uv8",COLOR_0:"a_Color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex",TEXCOORD0:"a_Uv",TEXCOORD:"a_Uv",COLOR0:"a_Color",COLOR:"a_Color",WEIGHT:"skinWeight",JOINT:"skinIndex"},Hg="MASK",qg="BLEND",Xg={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Qg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Kg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Yg={9728:Vc.NEAREST,9729:Vc.LINEAR,9984:Vc.NEAREST_MIPMAP_NEAREST,9985:Vc.LINEAR_MIPMAP_NEAREST,9986:Vc.NEAREST_MIPMAP_LINEAR,9987:Vc.LINEAR_MIPMAP_LINEAR},Zg={33071:Gc.CLAMP_TO_EDGE,33648:Gc.MIRRORED_REPEAT,10497:Gc.REPEAT},Jg={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class $g{static getMaterial(){return new fm}}class e_{static transform(e,t){let r=0,n=0,i=1,a=1,s=0;void 0!==t.offset&&(r=t.offset[0],n=t.offset[1]),void 0!==t.rotation&&(s=t.rotation),void 0!==t.scale&&(i=t.scale[0],a=t.scale[1]),e.setUvTransform(r,n,i,a,s,0,0),void 0!==t.texCoord&&console.warn("Custom UV sets in KHR_texture_transform extension not yet supported.")}}class t_{static getMaterial(){return new vm}static parseParams(e,t,r){const{diffuseFactor:n,diffuseTexture:i,specularFactor:a,glossinessFactor:s,specularGlossinessTexture:o}=t;Array.isArray(n)&&(e.diffuse.fromArray(n),e.opacity=n[3]||1),i&&(e.diffuseMap=r[i.index],e.diffuseMapCoord=i.texCoord||0,e.diffuseMap&&(e.diffuseMap.encoding=Xc.SRGB),function(e,t,r={}){const n=r.KHR_texture_transform;n&&(e[t]=e_.transform(e[t+"Transform"],n))}(e,"diffuseMap",i.extensions)),e.glossiness=void 0!==s?s:1,Array.isArray(a)&&e.specular.fromArray(a),o&&(e.glossinessMap=r[o.index],e.specularMap=r[o.index])}}class r_{static getMaterial(){return new ym}static parseParams(e,t,r){const{clearcoatFactor:n,clearcoatTexture:i,clearcoatRoughnessFactor:a,clearcoatRoughnessTexture:s,clearcoatNormalTexture:o}=t;if(n&&(e.clearcoat=n),i&&(e.clearcoatMap=r[i.index]),a&&(e.clearcoatRoughness=a),s&&(e.clearcoatRoughnessMap=r[s.index]),o&&(e.clearcoatNormalMap=r[o.index],o.scale)){const t=o.scale;e.clearcoatNormalScale=new xh(t,t)}}}function n_(e,t,r={}){const n=r.KHR_texture_transform;n&&e_.transform(e[t+"Transform"],n)}class i_{static parse(e){const{bufferViews:t,gltf:r}=e;if(!r.accessors)return;const n=new Map,i=r.accessors.map((e=>{const{bufferView:i,type:a,componentType:s,count:o,byteOffset:l=0,normalized:u=!1,sparse:c}=e;if(void 0===i&&void 0===c)return null;const h=void 0!==i?t[i]:null,d=void 0!==i?r.bufferViews[i].byteStride:void 0,p=Qg[a],f=Kg[s],m=f.BYTES_PER_ELEMENT;let g,_;if(d&&d!==m*p){const e="Buffer:"+i+":"+s;let t=n.get(e);t||(g=new f(h),t=new cp(g,d/m),n.set(e,t)),_=new up(t,p,l/m,u)}else g=null===h?new f(o*p):new f(h,l,o*p),_=new up(new cp(g,p),p,0,u);if(c){const e=Qg.SCALAR,r=Kg[c.indices.componentType],n=c.indices.byteOffset||0,i=c.values.byteOffset||0,a=new r(t[c.indices.bufferView],n,c.count*e),s=new f(t[c.values.bufferView],i,c.count*p);null!==h&&(_=new up(_.buffer.clone(),_.size,_.offset,_.normalized));const o=_.buffer;for(let e=0,t=a.length;e<t;e++){let t=a[e];if(o.array[t*_.size]=s[e*p],p>=2&&(o.array[t*_.size+1]=s[e*p+1]),p>=3&&(o.array[t*_.size+2]=s[e*p+2]),p>=4&&(o.array[t*_.size+3]=s[e*p+3]),p>=5)throw new Error("Unsupported itemSize in sparse Attribute.")}}return _}));n.clear(),e.accessors=i}}class a_{static getGeometry(e,t,r,n,i){const{bufferView:a,attributes:s}=e;if(!i)throw new Error("GLTFLoader: No DRACOLoader instance provided.");const o={};for(let e in s){const t=void 0===Wg[e]?e:Wg[e];o[t]=s[e]}const l={},u={};for(const e in r){const t=Wg[e]||e.toLowerCase();if(void 0!==s[e]){const i=n[r[e]],a=Kg[i.componentType];u[t]=a.name,l[t]=!0===i.normalized}}const c=t[a];return new Promise((function(e){i.decodeDracoFile(c,(function(t){for(const e in t.attributes){const r=t.attributes[e],n=l[e];void 0!==n&&(r.normalized=n)}e(t)}),o,u)}))}}function s_(e,t,r,n){const{attributes:i,indices:a,targets:s}=t;for(const t in i){const r=i[t],a=void 0===Wg[t]?t:Wg[t];a in e.attributes||e.addAttribute(a,n[r])}void 0===a||e.index||e.setIndex(n[a]);const{boundingBox:o,boundingSphere:l}=e;if(void 0!==i.POSITION){const t=i.POSITION,n=r.accessors[t];if(n.min&&n.max){if(o.min.fromArray(n.min),o.max.fromArray(n.max),n.normalized){const e=Ig.getNormalizedComponentScale(Kg[n.componentType]);o.min.multiplyScalar(e),o.max.multiplyScalar(e)}}else e.computeBoundingBox()}else e.computeBoundingBox();if(o.getCenter(l.center),l.radius=o.min.distanceTo(o.max)/2,s){let t=!1,r=!1;for(let e=0,n=s.length;e<n;e++){const n=s[e];if(void 0!==n.POSITION&&(t=!0),void 0!==n.NORMAL&&(r=!0),t&&r)break}if(t||r){const i=[],a=[];for(let o=0,l=s.length;o<l;o++){const l=s[o];t&&i.push(void 0!==l.POSITION?n[l.POSITION]:e.attributes[Wg.POSITION]),r&&a.push(void 0!==l.NORMAL?n[l.NORMAL]:e.attributes[Wg.NORMAL])}t&&(e.morphAttributes.position=i),r&&(e.morphAttributes.normal=a)}}return e}function o_(e,t){let{geometry:r,material:n,skinned:i,mode:a}=e;const s=void 0!==r.attributes[Wg.TANGENT],o=void 0!==r.attributes[Wg.COLOR_0],l=void 0===r.attributes[Wg.NORMAL],u=i;if(a===Jg.POINTS){const e="PointsMaterial:"+n.id;let r=t.get(e);r||(r=new bm,xp.prototype.copy.call(r,n),r.diffuse.copy(n.diffuse),r.diffuseMap=n.map,r.acceptLight=!1,t.set(e,r)),n=r}else if(a===Jg.LINES||a===Jg.LINE_STRIP||a===Jg.LINE_LOOP){const e="BasicMaterial:"+n.id;let r=t.get(e);r||(r=new fm,r.envMap=void 0,r.diffuse.copy(n.diffuse),r.diffuseMap=n.diffuseMap,r.drawMode=a,t.set(e,r)),n=r}else a===Jg.TRIANGLE_STRIP?(console.warn("TRIANGLE_STRIP will be removed later."),n.drawMode=Jg.TRIANGLE_STRIP):a===Jg.TRIANGLE_FAN&&(console.warn("TRIANGLE_FAN will be removed later."),n.drawMode=Jg.TRIANGLE_FAN);if(s||o||l||u){let e="ClonedMaterial:"+n.id+":";s&&(e+="vertex-tangents:"),o&&(3===r.attributes[Wg.COLOR_0].size?e+="vertex-colors-rgb:":4===r.attributes[Wg.COLOR_0].size&&(e+="vertex-colors-rgba:")),l&&(e+="flat-shading:");let i=t.get(e);i||(i=n.clone(),s&&(i.vertexTangents=!0,i.normalMap&&(i.normalScale.y*=-1)),o&&(3===r.attributes[Wg.COLOR_0].size?i.vertexColors=Yc.RGB:4===r.attributes[Wg.COLOR_0].size?i.vertexColors=Yc.RGBA:console.warn("Illegal vertex color size: "+r.attributes[Wg.COLOR_0].size)),l&&(i.shading=Uc.FLAT_SHADING)),n=i}e.material=n}function l_(e){const t=e.extensions&&e.extensions.KHR_draco_mesh_compression;let r;if(r=t?"draco:"+t.bufferView+":"+t.indices+":"+u_(t.attributes):e.indices+":"+u_(e.attributes)+":"+e.mode,e.targets)for(let t=0,n=e.targets.length;t<n;t++)r+=":"+u_(e.targets[t]);return r}function u_(e){let t="";const r=Object.keys(e).sort();for(let n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}class c_{static getLight(e){const{color:t,intensity:r=1,type:n,range:i,spot:a}=e;let s;if("directional"===n)s=new Om;else if("point"===n)s=new Um,void 0!==i&&(s.distance=i);else{if("spot"!==n)throw new Error("Unexpected light type: "+n);if(s=new jm,void 0!==i&&(s.distance=i),a){const{innerConeAngle:e=0,outerConeAngle:t=Math.PI/4}=a;s.angle=t,s.penumbra=1-e/t}}return t&&s.color.fromArray(t),s.intensity=r,s}}const h_=new Zh;class d_{static parse(e){const{gltf:t,accessors:r,nodes:n}=e,i=t.skins;if(!i)return;const a=i.map((e=>{const{inverseBindMatrices:t,joints:i}=e,a=r[t],s=[],o=[];return i.forEach(((e,t)=>{const r=n[e];if(r){s.push(r);const e=new Sc;a&&e.fromArray(a.buffer.array,16*t),o.push(e)}else console.warn("Joint "+e+" could not be found.")})),new Pm(s,o)}));e.skins=a,n.forEach(((e,r)=>{const{skin:n}=t.nodes[r];void 0!==n&&e.traverse((function(e){e.isSkinnedMesh&&e.bind(a[n],e.worldMatrix)}))}))}}function p_(e,t,r,n){const i=n[e],a=r[e];if(t.add(i),a.children){const e=a.children;for(let t=0,a=e.length;t<a;t++){p_(e[t],i,r,n)}}}class f_{static parse(e){const{gltf:t,nodes:r,accessors:n}=e,{animations:i}=t;if(!i)return;const a=i.map(((e,t)=>{const{channels:i,samplers:a,name:s=`animation_${t}`}=e,o=[];let l=0;for(let e=0;e<i.length;e++){const t=i[e],s=a[t.sampler];if(s){const e=t.target,i=void 0!==e.node?e.node:e.id,a=n[s.input],u=n[s.output],c=r[i];if(!c)continue;let h;switch(c.updateMatrix(),c.matrixAutoUpdate=!0,Xg[e.path]){case Xg.rotation:h=Pc;break;case Xg.weights:h=xc;break;default:h=Rc}if(!h)continue;const d=new a.buffer.array.constructor(a.buffer.array),p=new u.buffer.array.constructor(u.buffer.array);if(u.normalized){const e=Ig.getNormalizedComponentScale(p.constructor);for(let t=0,r=p.length;t<r;t++)p[t]*=e}const f=[];Xg[e.path]===Xg.weights?c.traverse((function(e){e.isMesh&&e.morphTargetInfluences&&f.push(e)})):f.push(c);for(let t=0,r=f.length;t<r;t++){const r=new h(f[t],Xg[e.path],d,p);o.push(r)}const m=d[d.length-1];l<m&&(l=m)}}return new ph(s,o,l)}));e.animations=a}}let m_=0;class g_{constructor(){this.id=++m_,this.url="",this.path="",this.options=null,this.gltf=null,this.loadItems=null,this.buffers=null,this.bufferViews=null,this.images=null,this.textures=null,this.materials=null,this.accessors=null,this.primitives=null,this.nodes=null,this.cameras=null,this.lights=null,this.skins=null,this.root=null,this.roots=null,this.animations=null}}const __=[Og,kg,Lg,Ug,jg,class{static parse(e,t){const{gltf:r,bufferViews:n,path:i,loadItems:a}=e;if(r.images)return Promise.all(r.images.map(((e,r)=>{const{uri:s,bufferView:o,mimeType:l,name:u}=e;let c=!1,h=s||"";if(void 0!==o){const e=n[o],t=new Blob([e],{type:l});h=URL.createObjectURL(t),c=!0}const d=Ig.resolveURL(h,i);let p;if(t.detailLoadProgress&&a.delete(d),l&&l.includes("ktx2"))p=Vg.loadTextureData(d,t.getKTX2Loader()).then((e=>(t.detailLoadProgress&&(c?t.manager.itemEnd(Ig.resolveURL("blob<"+r+">",i)):t.manager.itemEnd(d)),e)));else{const e={loader:t,imageUrl:d,imageName:u,isObjectURL:c,sourceUrl:h,index:r,path:i};if(!l||!l.includes("avif")&&!l.includes("webp"))return Gg(e);p=function(e){const t=new Promise((t=>{const r=new Image;e.includes("avif")?r.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=":r.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",r.onload=()=>{t(1===r.height)}}));return t}(l).then((t=>{if(t)return Gg(e);throw new Error("GLTFLoader: WebP or AVIF required by asset but unsupported.")}))}return t.detailLoadProgress&&p.catch((()=>t.manager.itemEnd(d))),p}))).then((t=>{e.images=t}))}},class{static parse(e){const{gltf:t,images:r}=e;if(t.textures)return Promise.all(t.textures.map(((e,n)=>{const{sampler:i,source:a=0,name:s}=e,o=new Bp;if(e.extensions){const{KHR_texture_basisu:t}=e.extensions;if(t){const e=r[t.source],{image:n,mipmaps:i,type:a,format:s,minFilter:l,magFilter:u,generateMipmaps:c,encoding:h,premultiplyAlpha:d}=e;o.image=n,o.mipmaps=i,o.type=a,o.format=s,o.minFilter=l,o.magFilter=u,o.generateMipmaps=c,o.encoding=h,o.premultiplyAlpha=d}else{if(!Object.values(e.extensions).length||!Object.values(e.extensions)[0].hasOwnProperty("source"))return console.error("GLTFLoader: Couldn't load texture"),null;o.image=r[Object.values(e.extensions)[0].source]}}else o.image=r[a];o.version++,o.name=s||o.image.__name||`texture_${n}`,o.flipY=!1;return function(e,t={}){const{magFilter:r,minFilter:n,wrapS:i,wrapT:a}=t;e.magFilter=Yg[r]||Vc.LINEAR,e.minFilter=Yg[n]||Vc.LINEAR_MIPMAP_LINEAR,e.wrapS=Zg[i]||Gc.REPEAT,e.wrapT=Zg[a]||Gc.REPEAT}(o,(t.samplers||{})[i]),o}))).then((t=>{e.textures=t}))}},class{static parse(e){const{gltf:t,textures:r}=e;if(!t.materials)return;const n=[];for(let e=0;e<t.materials.length;e++){const{extensions:i={},pbrMetallicRoughness:a,normalTexture:s,occlusionTexture:o,emissiveTexture:l,emissiveFactor:u,alphaMode:c,alphaCutoff:h,doubleSided:d,name:p=""}=t.materials[e],{KHR_materials_unlit:f,KHR_materials_pbrSpecularGlossiness:m,KHR_materials_clearcoat:g}=i;let _=null;if(f?_=$g.getMaterial():m?(_=t_.getMaterial(),t_.parseParams(_,m,r)):g?(_=r_.getMaterial(),r_.parseParams(_,g,r)):_=new ym,_.name=p,a){const{baseColorFactor:e,baseColorTexture:t,metallicFactor:n,roughnessFactor:i,metallicRoughnessTexture:s}=a;Array.isArray(e)&&(_.diffuse.fromArray(e),_.opacity=void 0!==e[3]?e[3]:1),t&&(_.diffuseMap=r[t.index],_.diffuseMapCoord=t.texCoord||0,_.diffuseMap&&(_.diffuseMap.encoding=Xc.SRGB,n_(_,"diffuseMap",t.extensions))),f||m||(_.metalness=void 0!==n?n:1,_.roughness=void 0!==i?i:1,s&&(_.metalnessMap=r[s.index],_.roughnessMap=r[s.index]))}u&&_.emissive.fromArray(u),l&&(_.emissiveMap=r[l.index],_.emissiveMapCoord=l.texCoord||0,_.emissiveMap&&(_.emissiveMap.encoding=Xc.SRGB,n_(_,"emissiveMap",l.extensions))),o&&(_.aoMap=r[o.index],_.aoMapCoord=o.texCoord||0,void 0!==o.strength&&(_.aoMapIntensity=o.strength),_.aoMap&&n_(_,"aoMap",o.extensions)),f||s&&(_.normalMap=r[s.index],_.normalScale.set(1,-1),void 0!==s.scale&&_.normalScale.set(s.scale,-s.scale),_.normalMap),_.side=!0===d?Lc.DOUBLE:Lc.FRONT,c===qg?_.transparent=!0:(_.transparent=!1,c===Hg&&(_.alphaTest=void 0!==h?h:.5)),n[e]=_}e.materials=n}},i_,class{static parse(e,t){const{gltf:r,accessors:n,materials:i,bufferViews:a}=e;if(!r.meshes)return;const s=new Map,o=new Map,l=[];for(let e=0;e<r.meshes.length;e++){const u=r.meshes[e],c=[];for(let e=0;e<u.primitives.length;e++){const l=u.primitives[e],{extensions:h={},mode:d,material:p}=l,{KHR_draco_mesh_compression:f}=h;let m;const g=l_(l);o.has(g)?m=o.get(g):(m=f?a_.getGeometry(f,a,l.attributes,r.accessors,t.getDRACOLoader()):Promise.resolve(new _p),m=m.then((e=>(s_(e,l,r,n),e))),o.set(g,m));const _=m.then((e=>{const t={mode:d,geometry:e,material:void 0===p?new ym:i[p],weights:Object.keys(e.morphAttributes).length>0&&u.weights?u.weights.slice(0):void 0,skinned:u.isSkinned};return o_(t,s),t}));c.push(_)}l.push(Promise.all(c))}return s.clear(),o.clear(),Promise.all(l).then((t=>{e.primitives=t}))}},class{static parse(e){const{gltf:{nodes:t,cameras:r,extensions:n}}=e;if(!t)return;const i=new Set,a=[],s=[],o=t.map((t=>{const{matrix:o,translation:l,rotation:u,scale:c,camera:h,mesh:d,extensions:p={}}=t,{KHR_lights_punctual:f}=p;let m=null;if(t.isBone)m=new Vm;else if(void 0!==d)m=function(e,t){const{primitives:r}=e,{mesh:n,skin:i}=t,a=r[n].map((e=>{const{geometry:t,material:r,weights:n}=e;let a;return void 0!==i?(a=new Gm(t,r),t.attributes.skinWeight&&!t.attributes.skinWeight.normalized&&function(e){const t=e.offset,r=e.buffer,n=r.stride;for(let e=0,i=r.count;e<i;e++){h_.fromArray(r.array,e*n+t);const i=1/h_.getManhattanLength();i!==1/0?h_.multiplyScalar(i):h_.set(1,0,0,0),h_.toArray(r.array,e*n+t)}}(t.attributes.skinWeight)):(a=new ap(t,r),n&&(a.morphTargetInfluences=n.slice())),a}));if(a.length>1){const e=new od;return a.forEach((t=>e.add(t))),e}return a[0]}(e,t);else if(void 0!==h)m=function(e){const{orthographic:t,perspective:r,type:n}=e,i=new Bd;if("perspective"==n){const{aspectRatio:e,yfov:t,zfar:n,znear:a}=r;i.setPerspective(t,e||1,a||1,n||2e6)}else if("orthographic"==n){const{xmag:e,ymag:r,zfar:n,znear:a}=t;i.setOrtho(-e,e,-r,r,a||1,n||2e6)}return i}(r[h]),a.push(m);else if(f){const e=f.light,t=n.KHR_lights_punctual.lights;m=c_.getLight(t[e]),s.push(m)}else m=new od;if(void 0!==t.name&&(m.name=function(e,t){const r=Ig.sanitizeNodeName(e||"");let n=r;for(let e=1;t.has(n);++e)n=r+"-"+e;return t.add(n),n}(t.name,i),m.children.length>0))for(let e=0;e<m.children.length;e++)m.children[e].name=m.name+"_"+e;return void 0!==o?(m.matrix.fromArray(o),m.matrix.decompose(m.position,m.quaternion,m.scale)):(void 0!==l&&m.position.fromArray(l),void 0!==u&&m.quaternion.fromArray(u),void 0!==c&&m.scale.fromArray(c)),m}));i.clear(),e.nodes=o,e.cameras=a,e.lights=s}},d_,class{static parse(e){const{gltf:t,nodes:r}=e,n=t.scenes.map((e=>{const{name:n="",nodes:i=[]}=e,a=new od;a.name=n;for(let e=0;e<i.length;e++)p_(i[e],a,t.nodes,r);return a}));e.roots=n,e.root=n[t.scene]}},f_];const v_=["asset","scene","scenes","extensionsUsed","extensions","nodes","accessors","images","skins","meshes","textures","samplers","materials","cameras","animations","buffers","bufferViews","meshReferences","meshUses"];const y_=(e,t,r,n,i)=>{const a=new Bp;a.image=e,a.version++,a.name=n||e.__name||`texture_${i}`,a.flipY=!1;const s=r.samplers||{};return b_(a,s[t]),a},x_=(e,t,r)=>{const{gltf:n,bufferViews:i,path:a,loadItems:s}=e;if(!n.images)return;const o=n.images[r],{uri:l,bufferView:u,mimeType:c,name:h}=o;let d=!1,p=l||"",f=!0;const m=p.search(/\.jpe?g($|\?)/i)>0||0===p.search(/^data\:image\/jpeg/);if(("image/jpeg"===c||m)&&(f=!1),void 0!==u){const e=i[u],t=new Blob([e],{type:c});if(p=URL.createObjectURL(t),d=!0,"image/png"===c){const t=new DataView(e,25,1).getUint8(0,!1);f=6===t||4===t||3===t}}const g=Ig.resolveURL(p,a);t.detailLoadProgress&&s.delete(g);const _=t.loadImage(g).then((e=>(e.__name=h,e.__hasAlpha=f,!0===d&&URL.revokeObjectURL(p),t.detailLoadProgress&&(d?t.manager.itemEnd(Ig.resolveURL("blob<"+r+">",a)):t.manager.itemEnd(g)),e)));return t.detailLoadProgress&&_.catch((()=>t.manager.itemEnd(g))),_},b_=(e,t={})=>{const{magFilter:r,minFilter:n,wrapS:i,wrapT:a}=t;e.magFilter=Yg[r]||Vc.LINEAR,e.minFilter=Yg[n]||Vc.LINEAR_MIPMAP_LINEAR,e.wrapS=Zg[i]||Gc.REPEAT,e.wrapT=Zg[a]||Gc.REPEAT},A_=`\n#define USE_PBR\n\n#include <common_vert>\n#include <normal_pars_vert>\n${ig.uv_pars_vert}\n#include <color_pars_vert>\n#include <modelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <aoMap_pars_vert>\n#include <alphamap_pars_vert>\n#include <emissiveMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <logdepthbuf_pars_vert>\n${eg.instance_pars_vert}\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <morphnormal_vert>\n    #include <skinning_vert>\n    #include <skinnormal_vert>\n\t${eg.instance_position_vert}\n    #include <pvm_vert>\n\t${eg.instance_normal_vert}\n    #include <normal_vert>\n    #include <logdepthbuf_vert>\n    #include <uv_vert>\n    #include <color_vert>\n\t${eg.instance_color_vert}\n    #include <modelPos_vert>\n    #include <envMap_vert>\n    #include <aoMap_vert>\n\t${ig.alphamap_vert}\n\t${ig.emissivemap_vert}\n    #include <shadowMap_vert>\n}\n`,S_=`\n#define USE_PBR\n\n#include <transpose>\n#include <inverse>\n#include <common_frag>\n#include <dithering_pars_frag>\n\n// if no light> this will not active\nuniform float u_Metalness;\n#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif\n\nuniform float u_Roughness;\n#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif\n\nuniform float specularFactor; // Modification : add specular factor\n\nuniform vec3 emissive;\n\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <clearcoat_pars_frag>\n#include <modelPos_pars_frag>\n#include <bsdfs>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\n${rg.colormapping_pars_frag}\n${ng.fresnel_pars_frag}\n\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <logdepthbuf_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n\t#include <alphamap_frag>\n\t${rg.colormapping_frag}\n\t\n    #include <alphaTest_frag>\n    #include <normal_frag>\n\n    float roughnessFactor = u_Roughness;\n    #ifdef USE_ROUGHNESSMAP\n    \tvec4 texelRoughness = texture2D( roughnessMap, v_Uv );\n    \t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n    \troughnessFactor *= texelRoughness.g;\n    #endif\n\n    float metalnessFactor = u_Metalness;\n    #ifdef USE_METALNESSMAP\n    \tvec4 texelMetalness = texture2D( metalnessMap, v_Uv );\n    \t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n    \tmetalnessFactor *= texelMetalness.b;\n    #endif\n\n\tReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\t${ag.light_frag}\n\t#ifndef USE_LIGHT\n\t\tfloat roughness = max(roughnessFactor, 0.0525);\n\t\tvec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));\n\t\tfloat geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\n\t\troughness += geometryRoughness;\n\t\tvec3 V = normalize(u_CameraPosition - v_modelPos);\n\t#endif\n\t${ag.simulate_basic_1_frag}\n\t#include <aoMap_frag>\n    ${ag.simulate_basic_2_frag}\n    \n    #include <shadowMap_frag>\n    vec3 totalEmissiveRadiance = emissive;\n\t${ig.emissivemap_frag}\n    outColor.xyz += totalEmissiveRadiance;\n\t\n    #include <end_frag>\n\t${ng.fresnel_frag}\n\t\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n    #include <dithering_frag>\n}\n`;class E_ extends ym{constructor(){super(...arguments),this.type=Nc.SHADER,this.shaderName="CUSTOM_PBR",this.name="",this.vertexShader=A_,this.fragmentShader=S_,this.aoMapCoord=1,this.roughness=1,this.metalness=0,this._specularFactor=1,this.uniforms={specularFactor:1,colorMapping:null,fresnelInverse:!1,fresnelPower:0},this.defines={COLOR_MAPPING:!1,FRESNEL:!1,USE_INSTANCING:!1,USE_UV3:!1,USE_SIDE_EMISSIVE:!1,SIMULATE_BASIC:!1},this._colorMapping=null,this._colorMappingIntensity=1,this._fresnelInverse=!1,this._fresnelPower=0,this._verticalEmissive=!1,this._simulateBasic=!1,this._wireframe=!1}set specularFactor(e){this._specularFactor=e,this.uniforms.specularFactor=e}get specularFactor(){return this._specularFactor}set fresnelInverse(e){this._fresnelInverse=e,this.uniforms.fresnelInverse=e||e}get fresnelInverse(){return this._fresnelInverse}set fresnelPower(e){this._fresnelPower=e,e?(this.defines.FRESNEL=!0,this.uniforms.fresnelPower=e):(this.defines.FRESNEL=!1,this.uniforms.fresnelPower=e),this.needsUpdate=!0}get fresnelPower(){return this._fresnelPower}set colorMapping(e){this._colorMapping=e,e?(this.defines.COLOR_MAPPING=!0,this.uniforms.colorMapping=e):(this.defines.COLOR_MAPPING=!1,this.uniforms.colorMapping=null),this.needsUpdate=!0}get colorMapping(){return this._colorMapping}set colorMappingIntensity(e){this._colorMappingIntensity=e,this.uniforms.colorMappingIntensity=e}get colorMappingIntensity(){return this._colorMappingIntensity}set verticalEmissive(e){this._verticalEmissive!==e&&(this._verticalEmissive=e,e?(this.defines.USE_UV3=!0,this.defines.USE_SIDE_EMISSIVE=!0,this.emissiveMapCoord=2):(this.defines.USE_UV3=!1,this.defines.USE_SIDE_EMISSIVE=!1,this.emissiveMapCoord=0),this.needsUpdate=!0)}get verticalEmissive(){return this._verticalEmissive}set simulateBasic(e){this._simulateBasic!==e&&(this._simulateBasic=e,e?(this.defines.SIMULATE_BASIC=!0,this.acceptLight=!1):(this.defines.SIMULATE_BASIC=!1,this.acceptLight=!0),this.needsUpdate=!0)}get simulateBasic(){return this._simulateBasic}set wireframe(e){e!==this._wireframe&&(this._wireframe=e,this.drawMode=e?Kc.LINES:Kc.TRIANGLES)}get wireframe(){return this._wireframe}copy(e){return super.copy(e),this.colorMapping=e.colorMapping,this.colorMappingIntensity=e.colorMappingIntensity,this.fresnelInverse=e.fresnelInverse,this.fresnelPower=e.fresnelPower,this.specularFactor=e.specularFactor,this.verticalEmissive=e.verticalEmissive,this.simulateBasic=e.simulateBasic,this.wireframe=e.wireframe,this.name=e.name,e.userData&&(this.userData=id(e.userData)),this}get isPBRMaterial(){return!0}}E_.prototype.useDefaultBufferMaterial=!0;const w_=`\n#include <common_vert>\n${ig.uv_pars_vert}\n#include <color_pars_vert>\n\n#if defined(USE_ENV_MAP) && !defined(USE_VERTEX_ENVDIR)\n    #include <modelPos_pars_vert>\n    #include <normal_pars_vert>\n#endif\n\n#include <envMap_pars_vert>\n#include <aoMap_pars_vert>\n#include <alphamap_pars_vert>\n#include <emissiveMap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <logdepthbuf_pars_vert>\n${eg.instance_pars_vert}\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <skinning_vert>\n\t${eg.instance_position_vert}\n    #include <pvm_vert>\n    #include <logdepthbuf_vert>\n\n    #include <uv_vert>\n    #include <color_vert>\n    ${eg.instance_color_vert}\n\n\t#ifdef USE_ENV_MAP\n        #include <morphnormal_vert>\n        #include <skinnormal_vert>\n\n        #ifndef USE_VERTEX_ENVDIR\n            #include <modelPos_vert>\n            #include <normal_vert>\n        #endif  \n    #endif\n\n    #include <envMap_vert>\n    #include <aoMap_vert>\n    ${ig.alphamap_vert}\n    ${ig.emissivemap_vert}\n}\n`,C_=`\n#include <common_frag>\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n\n#if defined(USE_ENV_MAP) && !defined(USE_VERTEX_ENVDIR)\n    #include <normalMap_pars_frag>\n    #include <normal_pars_frag>\n\n    #include <modelPos_pars_frag>\n#endif\n\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <fog_pars_frag>\n#include <logdepthbuf_pars_frag>\n${rg.colormapping_pars_frag}\n\nuniform vec3 emissive;\n\nvoid main() {\n    #include <begin_frag>\n    #include <logdepthbuf_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n\t#include <alphamap_frag>\n    ${rg.colormapping_frag}\n    #include <alphaTest_frag>\n\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n    reflectedLight.indirectDiffuse += vec3(1.0);\n    #include <aoMap_frag>\n    reflectedLight.indirectDiffuse *= outColor.xyz;\n    outColor.xyz = reflectedLight.indirectDiffuse;\n\n    vec3 totalEmissiveRadiance = emissive;\n\t${ig.emissivemap_frag}\n    outColor.xyz += totalEmissiveRadiance;\n\n\t#if defined(USE_ENV_MAP) && !defined(USE_VERTEX_ENVDIR)\n        #include <normal_frag>\n    #endif\n\n    #include <envMap_frag>\n    #include <end_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}\n`;class T_ extends fm{constructor(){super(...arguments),this.type=Nc.SHADER,this.shaderName="CUSTOM_BASIC",this.name="",this.envMap=void 0,this.vertexShader=w_,this.fragmentShader=C_,this.aoMapCoord=1,this.defines={USE_INSTANCING:!1,USE_UV3:!1,USE_SIDE_EMISSIVE:!1},this._verticalEmissive=!1,this._wireframe=!1}set verticalEmissive(e){this._verticalEmissive!==e&&(this._verticalEmissive=e,e?(this.defines.USE_UV3=!0,this.defines.USE_SIDE_EMISSIVE=!0,this.emissiveMapCoord=2):(this.defines.USE_UV3=!1,this.defines.USE_SIDE_EMISSIVE=!1,this.emissiveMapCoord=0),this.needsUpdate=!0)}get verticalEmissive(){return this._verticalEmissive}set envMap(e){}get envMap(){}set wireframe(e){e!==this._wireframe&&(this._wireframe=e,this.drawMode=e?Kc.LINES:Kc.TRIANGLES)}get wireframe(){return this._wireframe}copy(e){return super.copy(e),this.verticalEmissive=e.verticalEmissive,this.wireframe=e.wireframe,this.name=e.name,e.userData&&(this.userData=id(e.userData)),this}get isBasicMaterial(){return!0}}T_.prototype.useDefaultBufferMaterial=!0;class D_{static getMaterial(){return new T_}}class M_ extends vm{constructor(){super(...arguments)}get isPBR2Material(){return!0}}M_.prototype.useDefaultBufferMaterial=!0;class P_ extends t_{static getMaterial(){return new M_}}const F_={glow:"Glow",innerGlow:"InnerGlow",lineBloom:"SoftGlow",tailing:"Tailing",radial:"RadialTailing",ghosting:"Ghosting"},R_={No:"NONE",Normal:"NORMAL",Additive:"ADD",Subtractive:"SUB",Multiply:"MUL",Custom:"CUSTOM"},N_=(e,t,r)=>{r.identity();let n=e;for(;n!==t&&null!==n;)(n.matrixAutoUpdate||n.matrixNeedsUpdate)&&(n.matrix.transform(n.position,n.scale,n.quaternion),n.matrixNeedsUpdate=!1,n.worldMatrixNeedsUpdate=!0),r.premultiply(n.matrix),n=n.parent;return r},B_=new Sc,I_=new Sc,O_=(e,t,r=0)=>{e.isEdge||t(e,r),e.children.forEach((e=>O_(e,t,r+1)))},k_=(e,t)=>e.distance-t.distance,L_=(e=[],t=[])=>{if(!(Array.isArray(t)||t instanceof Float32Array))return t;for(let r=0,n=t.length;r<n;r++)e[r]=L_(e[r],t[r]);return e},U_=(e={},t={})=>{if(!(r=t)||"object"!=typeof r)return t;var r;for(let r in t)Array.isArray(t[r])||t[r]instanceof Float32Array?(!(t instanceof Float32Array)||e[r]&&e[r]instanceof Float32Array&&e[r].length===t[r].length||(e[r]=new Float32Array(t[r].length)),e[r]=L_(e[r],t[r])):e[r]=U_(e[r],t[r]);return e},z_=(e={},t={})=>{for(const r in t){const n=t[r];Array.isArray(n)||ArrayBuffer.isView(n)?e[r]=n.slice():e[r]=n}return e},j_=(e,t=new WeakMap)=>{if(t.has(e))return e;let r=null;if([Date,RegExp,Set,WeakSet,Map,WeakMap,Error].includes(e&&e.constructor))r=new e.constructor(e);else if(Array.isArray(e))r=[],e.forEach(((e,t)=>{r[t]=j_(e)}));else if(e instanceof Float32Array)r=new Float32Array(e.length),e.forEach(((e,t)=>{r[t]=j_(e)}));else if("object"==typeof e&&null!==e){r={};for(const t in e)Object.hasOwnProperty.call(e,t)&&(r[t]=j_(e[t]));t.set(e,r)}else r=e;return r};const V_=(e,t,r={})=>{const n=r.KHR_texture_transform;n&&e_.transform(e[t+"Transform"],n)};class G_ extends bm{constructor(){super(...arguments),this.type=Nc.SHADER,this.shaderName="CUSTOM_POINTS",this.vertexShader="\n#include <common_vert>\n#include <logdepthbuf_pars_vert>\n#include <morphtarget_pars_vert>\n\n// color_pars_vert.glsl\n#include <color_pars_vert>\n\nuniform float u_PointSize;\nuniform float u_PointScale;\n\nvoid main() {\n    #include <begin_vert>\n\t#include <color_vert>\n\n\t#include <morphtarget_vert>\n\t#include <morphnormal_vert>\n    #include <pvm_vert>\n    vec4 mvPosition = u_View * u_Model * vec4(transformed, 1.0);\n\n    #ifdef USE_SIZEATTENUATION\n        gl_PointSize = u_PointSize * ( u_PointScale / - mvPosition.z );\n    #else\n        gl_PointSize = u_PointSize;\n    #endif\n\n    #include <logdepthbuf_vert>\n}\n",this.fragmentShader="\n#include <common_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <fog_pars_frag>\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\n\n#if defined(USE_DIFFUSE_MAP) || defined(USE_ALPHA_MAP)\n\tuniform mat3 uvTransform;\n\tuniform float imageRatio;\n#endif\n\nvoid main() {\n\t#include <clippingPlanes_frag>\n    #include <begin_frag>\n    #include <logdepthbuf_frag>\n\t#include <color_frag>\n\n    #if defined( USE_DIFFUSE_MAP ) || defined( USE_ALPHA_MAP )\n\t\tvec2 uv;\n\t\tif ( imageRatio > 1.0 ) {\n\t\t\tuv = ( uvTransform * vec3( gl_PointCoord.x * imageRatio + ( 1.0 - imageRatio ) / 2.0, 1.0 - gl_PointCoord.y, 1.0 ) ).xy;\n\t\t} else {\n\t\t\tuv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y / imageRatio - ( 1.0 - 1.0 / imageRatio ) / 2.0, 1.0 ) ).xy;\n\t\t}\n\t#endif\n\n\t// EXTERNAL\n\t#if defined( USE_DIFFUSE_MAP ) || defined( USE_ALPHA_MAP )\n\t\t#ifdef UV_DISCARD\n\t\t\tif (uv.x < 0. || uv.x > 1. || uv.y < 0. || uv.y > 1.) { \n\t\t\t\tdiscard;\n\t\t\t}\n\t\t#endif\n\t#endif\n\n\t#ifdef USE_DIFFUSE_MAP\n\t\tvec4 mapTexel = texture2D( diffuseMap, uv );\n\t\toutColor *= mapTexelToLinear( mapTexel );\n\t#endif\n\n\t#ifdef USE_ALPHA_MAP\n\t\toutColor.a *= texture2D( alphaMap, uv ).g;\n\t#endif\n\n\t#ifdef ALPHATEST\n\t\tif ( outColor.a < ALPHATEST ) discard;\n\t#endif\n\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}\n",this.uniforms.imageRatio=1,this.defines.UV_DISCARD=!1}set imageRatio(e){this.uniforms.imageRatio=e}get imageRatio(){return this.uniforms.imageRatio}copy(e){return super.copy(e),this.imageRatio=e.imageRatio,this}get isPointsMaterial(){return!0}}G_.prototype.useDefaultBufferMaterial=!0;const W_=(e,t,r,n)=>{const{attributes:i,indices:a,targets:s}=t;for(const t in i){const r=i[t];Wg[t]in e.attributes||e.addAttribute(Wg[t],n[r])}void 0===a||e.index||e.setIndex(n[a]);const{boundingBox:o,boundingSphere:l}=e;if(void 0!==i.POSITION){const t=i.POSITION,n=r.accessors[t];if(n.min&&n.max){if(o.min.fromArray(n.min),o.max.fromArray(n.max),n.normalized){const e=Ig.getNormalizedComponentScale(Kg[n.componentType]);o.min.multiplyScalar(e),o.max.multiplyScalar(e)}}else e.computeBoundingBox()}else e.computeBoundingBox();if(o.getCenter(l.center),l.radius=o.min.distanceTo(o.max)/2,s){let t=!1,r=!1;for(let e=0,n=s.length;e<n;e++){const n=s[e];if(void 0!==n.POSITION&&(t=!0),void 0!==n.NORMAL&&(r=!0),t&&r)break}if(t||r){const i=[],a=[];for(let o=0,l=s.length;o<l;o++){const l=s[o];t&&i.push(void 0!==l.POSITION?n[l.POSITION]:e.attributes[Wg.POSITION]),r&&a.push(void 0!==l.NORMAL?n[l.NORMAL]:e.attributes[Wg.NORMAL])}t&&(e.morphAttributes.position=i),r&&(e.morphAttributes.normal=a)}}return e},H_=(e,t)=>{let{geometry:r,material:n,skinned:i,mode:a}=e;const s=void 0!==r.attributes[Wg.TANGENT],o=void 0!==r.attributes[Wg.COLOR_0],l=void 0===r.attributes[Wg.NORMAL],u=i;if(a===Jg.POINTS){const e="PointsMaterial:"+n.id;let r=t.get(e);r||(r=new G_,xp.prototype.copy.call(r,n),r.diffuse.copy(n.diffuse),r.diffuseMap=n.map,r.acceptLight=!1,t.set(e,r)),n=r}else if(a===Jg.LINES||a===Jg.LINE_STRIP||a===Jg.LINE_LOOP){const e="BasicMaterial:"+n.id;let r=t.get(e);r||(r=new T_,r.envMap=void 0,r.diffuse.copy(n.diffuse),r.diffuseMap=n.diffuseMap,r.drawMode=a,t.set(e,r)),n=r}else a===Jg.TRIANGLE_STRIP?(console.warn("TRIANGLE_STRIP will be removed later."),n.drawMode=Jg.TRIANGLE_STRIP):a===Jg.TRIANGLE_FAN&&(console.warn("TRIANGLE_FAN will be removed later."),n.drawMode=Jg.TRIANGLE_FAN);if(s||o||l||u){let e="ClonedMaterial:"+n.id+":";s&&(e+="vertex-tangents:"),o&&(3===r.attributes[Wg.COLOR_0].size?e+="vertex-colors-rgb:":4===r.attributes[Wg.COLOR_0].size&&(e+="vertex-colors-rgba:")),l&&(e+="flat-shading:");let i=t.get(e);i||(i=n.clone(),s&&(i.vertexTangents=!0,i.normalMap&&(i.normalScale.y*=-1)),o&&(3===r.attributes[Wg.COLOR_0].size?i.vertexColors=Yc.RGB:4===r.attributes[Wg.COLOR_0].size?i.vertexColors=Yc.RGBA:console.warn("Illegal vertex color size: "+r.attributes[Wg.COLOR_0].size)),l&&(i.shading=Uc.FLAT_SHADING),t.set(e,i)),n=i}e.material=n},q_=e=>{const t=e.extensions&&e.extensions.KHR_draco_mesh_compression;let r;if(r=t?"draco:"+t.bufferView+":"+t.indices+":"+X_(t.attributes):e.indices+":"+X_(e.attributes)+":"+e.mode,e.targets)for(let t=0,n=e.targets.length;t<n;t++)r+=":"+X_(e.targets[t]);return r},X_=e=>{let t="";const r=Object.keys(e).sort();for(let n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t};const Q_=(e,t)=>{const r=Ig.sanitizeNodeName(e||"");let n=r;for(let e=1;t.has(n);++e)n=r+"-"+e;return t.add(n),n},K_=e=>{const{orthographic:t,perspective:r,type:n}=e,i=new Bd;if("perspective"==n){const{aspectRatio:e,yfov:t,zfar:n,znear:a}=r;i.setPerspective(t,e||1,a||1,n||2e6)}else if("orthographic"==n){const{xmag:e,ymag:r,zfar:n,znear:a}=t;i.setOrtho(-e,e,-r,r,a||1,n||2e6)}return i},Y_=(e,t)=>{const{primitives:r}=e,{mesh:n,skin:i}=t,a=r[n].map((e=>{const{geometry:t,material:r,weights:n}=e;let a;return void 0!==i?a=new Gm(t,r):(a=new ap(t,r),n&&(a.morphTargetInfluences=n.slice())),a}));if(a.length>1){const e=new od;return a.forEach((t=>e.add(t))),e}return a[0]},Z_=e=>{const t=e[0],r=e[1],n=e[2],i=Math.PI/180;return new bc(t*i,r*i,n*i)};function J_(e,t,r,n){const i=n[e],a=r[e];if(t.add(i),a.children){const e=a.children;for(let t=0,a=e.length;t<a;t++){J_(e[t],i,r,n)}}}const $_=(e,t,r={})=>{const n=r.KHR_texture_transform;n&&(e[t]=e_.transform(e[t],n))},ev=(e,t,r)=>{if(!(e.material&&e.material.userData&&e.material.userData.gltfExtensions))return;const{blend:n}=e.material.userData.gltfExtensions;if(!n)return;const i=e.geometry.index.buffer.count,a=[{materialIndex:0,start:0,count:i}],s=[e.material],o=e.material&&e.material.vertexColors==Yc.RGBA;for(let e=0,l=n.length;e<l;e++){const l=n[e];if(!l)continue;const u=t[l.subMaterial].clone();if(!u)continue;u.transparent=!0,o&&(u.vertexColors=Yc.RGBA);const c=l.maskTexture;c&&(u.alphaMap=r[c.index],u.alphaMapCoord=c.texCoord||0,u.alphaMap&&(u.alphaMap.encoding=Xc.SRGB,$_(u,"alphaMap",c.extensions),c.extensions&&(u.userData=u.userData||{},u.userData.gltfExtensions=u.userData.gltfExtensions||{},u.userData.gltfExtensions.maskTexture=c.extensions)),s.push(u),a.push({materialIndex:s.length-1,start:0,count:i}))}e.material=s,e.geometry.groups=a},tv=Object.prototype.toString,rv=e=>function(t){return tv.call(t)=="[object "+e+"]"},nv=(()=>{const e=1,t=1,r=128/e,n=128/t,i=["rgb(255,255,255)"];var a=document.createElement("canvas");a.width=128,a.height=128;for(var s=a.getContext("2d"),o=0;o<t;o++)for(var l=0;l<e;l++)s.fillStyle=i[(l+o)%2],s.fillRect(l*r,o*n,r,n);return a})();let iv=new Map,av=new Map;const sv=(e,t)=>{let r=e.get(t);return r||(r=new RegExp(t),e.set(t,r)),r},ov=(e,t)=>{if(t){let r=av.get(t);return r||(r=new Map,av.set(t,r)),sv(r,e)}return sv(iv,e)},lv=(e,t)=>{void 0===t&&(t="s");const r=ov("["+t+"]+$");return e.replace(r,"")},uv=(e,t)=>lv(e,"/")+"/"+lv(((e,t)=>{void 0===t&&(t="s");const r=ov("^["+t+"]+");return e.replace(r,"")})(t,"/"),"/"),cv={diffuseImage:nv,isType:rv,isArray:rv("Array"),isObject:rv("Object"),isString:rv("String"),isNumber:rv("Number"),isFunction:rv("Function"),isRegExp:rv("RegExp"),isUndefined:rv("Undefined"),isNull:function(e){return null==e},parseValue:function(e,t){return cv.isNull(e)?t:e},objectKeysToLowerCase:function(e,t,r){var n,i,a,s,o,l,u,c;if(l=cv.objectKeysToLowerCase,"undefined"===(u=typeof t)||null===t||0===t||!1===t)t=0;else if("object"===u){if(!(t instanceof l))throw new TypeError('Expected "deep" to be a special object')}else if(!0===t)t=1/0;else{if("number"!==u)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+u+'"');if(isNaN(t)||t<0)throw new RangeError('Expected "deep" to be a positive number, got '+t)}if(null===e||"object"!=typeof e)throw new TypeError('Expected "input" to be an object');if(u=typeof r,null!==r&&"undefined"!==u&&"function"!==u)throw new TypeError('Expected "filter" to be a function');if(r=r||null,s=(a=Object.keys(e)).length-1,o={},t){if("number"==typeof t)t=Object.seal(Object.create(l.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:t,writable:!1}}));else if(~(n=t.input.indexOf(e)))return t.output[n];for(t.level+=1,t.input.push(e),t.output.push(o),n=s+1;n--;)"object"==typeof(c=e[i=a[s-n]])&&c&&t.level<t.max&&(r?r(c):c.constructor===Object)&&(c=l(c,t,r)),o[i.toLowerCase()]=c;t.level-=1}else for(n=s+1;n--;)o[(i=a[s-n]).toLowerCase()]=e[i];return o},removeAt:(e,t)=>{const r=e.substring(0);return t>=e.length?r:r.slice(0,t)+r.slice(t+1)},getExtension:e=>{var t=e.split(".");if(t.length>1){var r=t.pop(),n=r.indexOf("?");return-1!==n?r.substring(0,n):r}return""},getFileName:(e,t=!0)=>{var r=e.indexOf("\\")>=0?e.lastIndexOf("\\"):e.lastIndexOf("/");if(-1===r)return t?e:e.split(".")[0];var n=e.substring(r);return 0!==n.indexOf("\\")&&0!==n.indexOf("/")||(n=n.substring(1)),t?n:n.split(".")[0]},appendURL:(e,t)=>{var r=cv.getFileName(e);if(((e,t)=>e.slice(0,t.length)===t)(r,"?")){var n=(e=>{const t=e.indexOf("\\")>=0?e.lastIndexOf("\\"):e.lastIndexOf("/");return e.substring(0,t)})(e);return uv(n,t)+r}return uv(e,t)}};function hv(e){var t=e.split(".");return{major:parseInt(t.length>=1?t[0]:0),minor:parseInt(t.length>=2?t[1]:0),modified:parseInt(t.length>=3?t[2]:0)}}function dv(e,t){return e.major!=t.major?e.major>t.major?1:-1:e.minor!=t.minor?e.minor>t.minor?1:-1:e.modified!=t.modified?e.modified>t.modified?1:-1:0}class pv{constructor(e=""){this._major=0,this._minor=0,this._modified=0,cv.isString(e)?this.fromString(e):e.isVersion&&this.copy(e)}fromString(e){var{major:t,minor:r,modified:n}=hv(e);return this._major=t,this._minor=r,this._modified=n,this}toString(){return[this._major,this._minor,this._modified].join(".")}copy(e){return this._major=e.major,this._minor=e.minor,this._modified=e.modified,this}compare(e){return cv.isString(e)?dv(this,hv(e)):e.isVersion?dv(this,e):0}isCompatibleWith(e){return!(this._major<e.major)&&(!(this._minor<e.minor)&&!(this._modified<e.modified))}get major(){return this._major}get minor(){return this._minor}get modified(){return this._modified}get isVersion(){return!0}}class fv{constructor(e){const t=e.split(" ");this.initDate(t[0]),this.initTime(t[1])}initDate(e){const t=e.split("-");this._year=parseInt(t[0],10),this._month=parseInt(t[1],10),this._date=parseInt(t[2],10)}initTime(e){const t=e.split(":");this._hours=parseInt(t[0],10),this._minutes=parseInt(t[1],10),this._seconds=parseInt(t[2],10)}getYear(){return this._year}getMonth(){return this._month-1}getDate(){return this._date}getHours(){return this._hours}getMinutes(){return this._minutes}getSeconds(){return this._seconds}}class mv{constructor(){}GLTF_decoder_1_count(e,t,r,n){return 0==e?n-t:e%2?r%2?n+t:n:n-t}GLTF_decoder_1_offset(e,t,r,n){return 0==e?n:e%2?n-(t*=r):n}GLTF_decoder_1_length(e,t,r,n,i){return t*=r,0==e?i-t:e%2?n%2?i+t:i:i-t}GLTF_decoder_2_offset(e,t,r,n){return e%2?n-(t*=r):n}GLTF_decoder_2_length(e,t,r,n,i){return t*=r,e%2?n%2?i+t:i:i-t}GLTF_decoder_3_offset(e,t,r,n){return e%2?n-(t*=r):n}GLTF_decoder_3_length(e,t,r,n,i){return t*=r,e%2?n%2?i+t:i:i-t}}class gv{constructor(e,t){this._decoder={},this._nameDecoder={},t?(t.data=cv.objectKeysToLowerCase(e),this._init(t.data)):this._init(e)}_init(e){if(e){var t=e.version;if(t)new pv(t).compare("2.0")<=0||(this._initDecoder(e),this._initResourceDecoder(t,e))}}_initDecoder(e){var t=e.createtime;if(t){var r=new fv(t),n=r.getSeconds();this._decoder.version=Math.floor(n/10);for(var i=e.size,a=1,s=0;s<i.length;s++){var o=i[s].toString();-1!==o.indexOf(".")&&(a+=Math.floor(o.substring(o.length-1)))}this._decoder.randomWeight=a,this._decoder.randomRanges=[r.getHours()+1,r.getDate()+1,r.getSeconds()%13+1,r.getMinutes()%13+1,a%5*(a%5)+1,e.verts%13+1,e.faces%13+1,e.nodes%13+1]}}_initResourceDecoder(e,t){var r=t.texfiles;if(r){var n=new pv(e),i=this._nodecode_name;2==n.major&&1==n.minor?i=this._decode21_name:2==n.major&&3==n.minor&&(i=this._decode23_name);var a=Object.keys(r).length,s=t.gltffiles||t.modelfiles;if(s)for(var o=0;o<s.length;o++)s[o]=i(s[o],a);var l=t.lod;if(l){var u=Object.keys(l);for(o=0;o<u.length;o++){var c=u[o];l[i(c,a)]=l[c],delete l[c]}}this._nameDecoder.version=n,this._nameDecoder.decodeFunc=i}}_nodecode_name(e,t){return e}_decode21_name(e,t){const r=["F7WD3HNR2OPYV6AUS5TKM018ZBJL4EQXIGC9F","A0JQM9PSLXF18647URV3DNHOCY52TEZBWIGKA","B0IE6Q4S3C7OA28UHTPXDW9NYMGLF1K5VJRZB","EQ72MKL3DYNF5RU1PWBT64X9CIZVJHS8G0OAE"];var n=e.charAt(0),i=r[1].indexOf(n);if(-1!==i){i++,i=Math.floor(i/2)+1,e=cv.removeAt(e,i);var a=cv.getExtension(e);e=cv.getFileName(e,!1);for(var s="",o=0;o<e.length;o++){var l=e[o],u=r[(o+1+t)%4],c=u.indexOf(l);0===c?c=35:c--,s+=u[c]}return a?s+"."+a:s}}_decode23_name(e,t){const r=["T64X9CIZVYNF5RU1PWBJHS8G0OAEQ72MKL3DT"];var n=e.charAt(0),i=r[0].indexOf(n);if(-1!==i){i++,i=Math.floor(i/2)+1,e=cv.removeAt(e,i);var a=cv.getExtension(e);e=cv.getFileName(e,!1);for(var s="",o=0;o<e.length;o++){var l=e[o],u=r[0],c=u.indexOf(l);0===c?c=35:c--,s+=u[c]}return a?s+"."+a:s}}decode(e,t,r){var n=this._nameDecoder.version;n&&(n.major<=2&&n.minor<=2?this._decode_lt_2_2(e,t,r):2==n.major&&3==n.minor&&this._decode_2_3(t,r));var i=this._nameDecoder.decodeFunc;if(i&&("buffers"==t||"images"==t))for(var a=e.buffers.length+e.images.length,s=0;s<r.length;s++){var o=i(r[s].uri,a);o&&(r[s].uri=o)}}_decode_lt_2_2(e,t,r){var n=new mv,i=this._nameDecoder.version,a=i&&2==i.major&&2==i.minor;switch(this._decoder.version){case 0:case 3:var s=this._decoder.randomWeight;if("accessors"==t)for(var o=0;o<r.length;o++){var l=r[o];if(!a||void 0!==l.byteType)(u=e.bufferViews[l.bufferView]).factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType,l.count=n.GLTF_decoder_1_count(o,s,l.byteType,l.count),delete l.byteType}else if("bufferViews"==t)for(o=0;o<r.length;o++){var u=r[o];if(!a||void 0!==u.byteType){var c=u.factor;u.byteOffset=n.GLTF_decoder_1_offset(o,s,c,cv.parseValue(u.uinOffset,u.byteOffset)),u.byteLength=n.GLTF_decoder_1_length(o,s,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}break;case 1:case 4:var h=this._decoder.randomRanges;if("accessors"==t)for(o=0;o<r.length;o++){l=r[o];if(!a||void 0!==l.byteType){(u=e.bufferViews[l.bufferView]).factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType;s=h[Math.floor(o/2)%8]+(o+1)%7;l.count=n.GLTF_decoder_1_count(o,s,l.byteType,l.count),delete l.byteType}}else if("bufferViews"==t)for(o=0;o<r.length;o++){u=r[o];if(!a||void 0!==u.byteType){var d=h[Math.floor(o/2)%8]+(o+1)%7;c=u.factor;u.byteOffset=n.GLTF_decoder_2_offset(o,d,c,cv.parseValue(u.uinOffset,u.byteOffset)),u.byteLength=n.GLTF_decoder_2_length(o,d,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}break;case 2:case 5:this._decoder.randomRanges3=[this._decoder.randomRanges[7],7*e.materials.length%10];var p=(e.buffers[0].byteLength-999).toString();for(o=0;o<p.length;o++){var f=10-Math.floor(p[o]);this._decoder.randomRanges3.push(f)}this._decoder.randomRanges3.push(this._decoder.randomRanges[3]);h=this._decoder.randomRanges3;if("accessors"==t)for(o=0;o<r.length;o++){l=r[o];if(!a||void 0!==l.byteType){u=e.bufferViews[l.bufferView],s=h[Math.floor(o/2)%h.length]+Math.floor(o+1)%7;u.factor=Math.floor(u.byteLength/l.count),u.opFactor=l.byteType,l.count=n.GLTF_decoder_1_count(o,s,l.byteType,l.count),delete l.byteType}}else if("bufferViews"==t)for(o=0;o<r.length;o++){u=r[o];if(!a||void 0!==u.byteType){d=h[Math.floor(o/2)%h.length]+Math.floor(o+1)%7,c=u.factor;u.byteOffset=n.GLTF_decoder_3_offset(o,d,c,cv.parseValue(u.uinOffset,u.byteOffset)),u.byteLength=n.GLTF_decoder_3_length(o,d,c,u.opFactor,u.byteLength),delete u.factor,delete u.opFactor}}}}_decode_2_3(e,t){if("accessors"==e)for(var r=0;r<t.length;r++){t[r].count--}else if("bufferViews"==e)for(r=0;r<t.length;r++){var n=t[r];n.byteOffset--,n.byteLength--}}decodeDracoFile(e,t,r){}}const _v=new WeakMap,vv="srgb";class yv extends gh{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={a_Position:"POSITION",a_Normal:"NORMAL",a_Color:"COLOR",a_Uv:"TEX_COORD"},this.defaultAttributeTypes={a_Position:"Float32Array",a_Normal:"Float32Array",a_Color:"Float32Array",a_Uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,n){const i=new _h(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{this.parse(e,t,n)}),r,n)}parse(e,t,r){this.decodeDracoFile(e,t,null,null,vv).catch(r)}decodeDracoFile(e,t,r,n,i="srgb-linear"){const a={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:i};return this.decodeGeometry(e,a).then(t)}decodeGeometry(e,t){const r=JSON.stringify(t);if(_v.has(e)){const t=_v.get(e);if(t.key===r)return t.promise;if(0===e.byteLength)throw new Error("DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const i=this.workerNextTaskID++,a=e.byteLength,s=this._getWorker(i,a).then((r=>(n=r,new Promise(((r,a)=>{n._callbacks[i]={resolve:r,reject:a},n.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return s.catch((()=>!0)).then((()=>{n&&i&&this._releaseTask(n,i)})),_v.set(e,{key:r,promise:s}),s}_createGeometry(e){const t=new _p;e.index&&t.setIndex(new up(new cp(e.index.array,1)));for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r],i=n.name,a=n.array,s=n.itemSize,o=new up(new cp(a,s));"a_color"===i&&Ev(o,n.vertexColorSpace),t.addAttribute(i,o)}return t}_loadLibrary(e,t){const r=new _h(this.manager);return r.setPath(this.decoderPath||yv.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise(((t,n)=>{r.load(e,t,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=this.decoderConfig||yv.decoderConfig,t="object"!=typeof WebAssembly||"js"===e.type,r=[];return t?r.push(this._loadLibrary("draco_decoder.js","text")):(r.push(this._loadLibrary("draco_wasm_wrapper.js","text")),r.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(r).then((r=>{const n=r[0];t||(e.wasmBinary=r[1]);const i=wv.toString(),a=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig||yv.decoderConfig}),e.onmessage=function(t){const r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function xv(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function bv(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}function Av(e,t,r,n,i){return t*=e.size,e.normalized&&(r=bv(r,e.buffer.array),n=bv(n,e.buffer.array),i=bv(i,e.buffer.array)),e.buffer.array[t+0]=r,e.buffer.array[t+1]=n,e.buffer.array[t+2]=i,e}function Sv(e,t,r){const n=function(e,t){let r=e.buffer.array[t*e.size];return e.normalized&&(r=xv(r,e.buffer.array)),r}(t,r),i=function(e,t){let r=e.buffer.array[t*e.size+1];return e.normalized&&(r=xv(r,e.buffer.array)),r}(t,r),a=function(e,t){let r=e.buffer.array[t*e.size+2];return e.normalized&&(r=xv(r,e.buffer.array)),r}(t,r);return e.setRGB(n,i,a),e}function Ev(e,t){if(t!==vv)return;const r=new Eh;for(let t=0,n=e.buffer.count;t<n;t++)Sv(r,e,t),r.convertSRGBToLinear(),Av(e,t,r.r,r.g,r.b)}function wv(){let e,t;function r(e,t,r,n,i,a){const s=a.num_components(),o=r.num_points()*s,l=o*i.BYTES_PER_ELEMENT,u=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),c=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,a,u,l,c);const h=new i(e.HEAPF32.buffer,c,o).slice();return e._free(c),{name:n,array:h,itemSize:s}}onmessage=function(n){const i=n.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const n=i.buffer,a=i.taskConfig;t.then((e=>{const t=e.draco,s=new t.Decoder;try{const e=function(e,t,n,i){const a=i.attributeIDs,s=i.attributeTypes;let o,l;const u=t.GetEncodedGeometryType(n);if(u===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeArrayToMesh(n,n.byteLength,o);else{if(u!==e.POINT_CLOUD)throw new Error("DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeArrayToPointCloud(n,n.byteLength,o)}if(!l.ok()||0===o.ptr)throw new Error("DRACOLoader: Decoding failed: "+l.error_msg());const c={index:null,attributes:[]};for(const n in a){const l=self[s[n]]||Float32Array;let u,h;if(i.useUniqueIDs)h=a[n],u=t.GetAttributeByUniqueId(o,h);else{if(h=t.GetAttributeId(o,e[a[n]]),-1===h)continue;u=t.GetAttribute(o,h)}const d=r(e,t,o,n,l,u);"a_color"===n&&(d.vertexColorSpace=i.vertexColorSpace),c.attributes.push(d)}u===e.TRIANGULAR_MESH&&(c.index=function(e,t,r){const n=r.num_faces(),i=3*n,a=4*i,s=e._malloc(a);t.GetTrianglesUInt32Array(r,a,s);const o=new Uint32Array(e.HEAPF32.buffer,s,i).slice();return e._free(s),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),c}(t,s,new Int8Array(n),a),o=e.attributes.map((e=>e.array.buffer));e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(s)}}))}}}yv.decoderPath="./",yv.decoderConfig={},yv.setDecoderPath=function(e){console.warn("DRACOLoader.setDecoderPath has been deprecated, use new DRACOLoader().setDecoderPath instead."),yv.decoderPath=e},yv.setDecoderConfig=function(e){console.warn("DRACOLoader.setDecoderConfig has been deprecated, use new DRACOLoader().setDecoderConfig instead.");const t=yv.decoderConfig.wasmBinary;yv.decoderConfig=e||{},t&&(yv.decoderConfig.wasmBinary=t)},yv.releaseDecoderModule=function(){console.warn("DRACOLoader.releaseDecoderModule has been removed.")};const Cv=[Og,class{static parse(e){const{gltf:t,options:r={}}=e,{decoder:n,sourcefile:i}=r;if(n){for(var a=0;a<v_.length;a++){let e=v_[a],r=t[e];r&&n.decode(t,e,r)}i&&(e.sourcefile=i)}}},kg,Lg,Ug,jg,class{static parse(e,t){const{gltf:r,options:n}=e;if(!r.textures)return;const i=new Map;return Promise.all(r.textures.map((({sampler:a,source:s=0,name:o},l)=>{if(n.onLoadTexture)return n.onLoadTexture(Ig.resolveURL(r.images[s].uri,e.path),r.samplers[a]).then((n=>{if(n)return Promise.resolve(n);if(i.has(s)){const e=i.get(s);return y_(e,a,r,o,l)}return x_(e,t,s).then((e=>{i.set(s,e);return y_(e,a,r,o,l)}))}));if(i.has(s)){const e=i.get(s);return y_(e,a,r,o,l)}return x_(e,t,s).then((e=>{i.set(s,e);return y_(e,a,r,o,l)}))}))).then((t=>{const r=[];for(let e of i.values())r.push(e);e.images=r,e.textures=t}))}},class{static parse(e){const{gltf:t,textures:r}=e;if(!t.materials)return;const n=[];for(let e=0;e<t.materials.length;e++){const{extensions:i={},pbrMetallicRoughness:a,normalTexture:s,occlusionTexture:o,emissiveTexture:l,emissiveFactor:u,alphaMode:c,alphaCutoff:h,doubleSided:d,name:p=""}=t.materials[e],{KHR_materials_unlit:f,KHR_materials_pbrSpecularGlossiness:m}=i;let g=null;if(f?g=D_.getMaterial():m?(g=P_.getMaterial(),P_.parseParams(g,m,r)):g=new E_,g.name=p,a){const{baseColorFactor:e,baseColorTexture:t,metallicFactor:n,roughnessFactor:i,metallicRoughnessTexture:s}=a;Array.isArray(e)&&(g.diffuse.fromArray(e),g.opacity=void 0===e[3]?1:e[3]),t&&(g.diffuseMap=r[t.index],g.diffuseMapCoord=t.texCoord||0,g.diffuseMap&&(g.diffuseMap.encoding=Xc.SRGB,V_(g,"diffuseMap",t.extensions),t.extensions&&(g.userData=g.userData||{},g.userData.gltfExtensions=g.userData.gltfExtensions||{},g.userData.gltfExtensions.baseColorTexture=t.extensions))),f||m||(g.metalness=void 0!==n?n:1,g.roughness=void 0!==i?i:1,s&&(g.metalnessMap=r[s.index],g.roughnessMap=r[s.index]))}u&&g.emissive.fromArray(u),l&&(g.emissiveMap=r[l.index],g.emissiveMapCoord=l.texCoord||0,g.emissiveMap&&(g.emissiveMap.encoding=Xc.SRGB,V_(g,"emissiveMap",l.extensions),l.extensions&&(g.userData=g.userData||{},g.userData.gltfExtensions=g.userData.gltfExtensions||{},g.userData.gltfExtensions.emissiveTexture=l.extensions))),o&&(g.aoMap=r[o.index],g.aoMapCoord=o.texCoord||0,void 0!==o.strength&&(g.aoMapIntensity=o.strength),g.aoMap&&V_(g,"aoMap",o.extensions));const{blend:_,sceneBlend:v,depthWrite:y,wireframe:x}=i;_&&(g.userData=g.userData||{},g.userData.gltfExtensions=g.userData.gltfExtensions||{},g.userData.gltfExtensions.blend=_),v&&(g.blending=void 0===Bc[R_[v]]?Bc.NORMAL:Bc[R_[v]],g.userData=g.userData||{},g.userData.gltfExtensions=g.userData.gltfExtensions||{},g.userData.gltfExtensions.sceneBlend=v),void 0!==y&&(g.depthWrite=!!y,g.userData=g.userData||{},g.userData.gltfExtensions=g.userData.gltfExtensions||{},g.userData.gltfExtensions.depthWrite=y),void 0!==x&&(g.drawMode=x?Kc.LINE_STRIP:Kc.TRIANGLES,g.userData=g.userData||{},g.userData.gltfExtensions=g.userData.gltfExtensions||{},g.userData.gltfExtensions.wireframe=x),f||s&&(g.normalMap=r[s.index],g.normalScale.set(1,-1),void 0!==s.scale&&g.normalScale.set(s.scale,-s.scale),g.normalMap&&s.extensions&&(g.userData=g.userData||{},g.userData.gltfExtensions=g.userData.gltfExtensions||{},g.userData.gltfExtensions.normalTexture=s.extensions)),g.side=!0===d?Lc.DOUBLE:Lc.FRONT,c===qg?g.transparent=!0:(g.transparent=!1,c===Hg&&(g.alphaTest=void 0!==h?h:.5)),n[e]=g}e.materials=n}},i_,class{static parse(e,t){const{gltf:r,accessors:n,materials:i,bufferViews:a}=e;if(!r.meshes)return;const s=new Map,o=new Map,l=[];for(let e=0;e<r.meshes.length;e++){const u=r.meshes[e],c=[];for(let e=0;e<u.primitives.length;e++){const l=u.primitives[e],{extensions:h={},mode:d,material:p}=l,{KHR_draco_mesh_compression:f}=h;let m;const g=q_(l);o.has(g)?m=o.get(g):(m=f?a_.getGeometry(f,a,l.attributes,r.accessors,t.getDRACOLoader()):Promise.resolve(new _p),m=m.then((e=>(W_(e,l,r,n),e))),o.set(g,m));const _=m.then((e=>{const t={mode:d,geometry:e,material:void 0===p?new E_:i[p],weights:Object.keys(e.morphAttributes).length>0&&u.weights?u.weights.slice(0):void 0,skinned:u.isSkinned};return H_(t,s),t}));c.push(_)}l.push(Promise.all(c))}return s.clear(),o.clear(),Promise.all(l).then((t=>{e.primitives=t}))}},class{static parse(e){const{gltf:{nodes:t,cameras:r,extensions:n}}=e;if(!t)return;const i=new Set,a=[],s=[],o=[];let l;const u=t.map((t=>{const{matrix:u,translation:c,rotation:h,scale:d,camera:p,mesh:f,extensions:m={},extras:g}=t,{KHR_lights_punctual:_,billboard:v}=m;let y=null;if(t.isBone)y=new Vm;else if(void 0!==f)y=Y_(e,t);else if(void 0!==p)y=K_(r[p]),a.push(y);else if(_){const e=_.light,t=n.KHR_lights_punctual.lights;y=c_.getLight(t[e]),s.push(y)}else y=new od;if(v&&(y.userData.billboard=v),g)if(g.ik){const{ik:e}=g,{type:t,index:r,rotationMin:n,rotationMax:i}=e;if(t)l=r;else{const e={index:r,rotationMin:Z_(n),rotationMax:Z_(i)};o.push(e)}}else y.userData.info=y.userData.info||{},y.userData.info.extras=g;if(void 0!==t.name&&(y.name=Q_(t.name,i),y.children.length>0))for(let e=0;e<y.children.length;e++)y.children[e].name=y.name+"_"+e;void 0!==u?(y.matrix.fromArray(u),y.matrix.decompose(y.position,y.quaternion,y.scale)):(void 0!==c&&y.position.fromArray(c),void 0!==h&&y.quaternion.fromArray(h),void 0!==d&&y.scale.fromArray(d));const{effects:x,renderOrder:b,castShadows:A,receiveShadows:S}=m;if(x&&(void 0!==x.skipGlow&&(y.effects=y.effects||{},y.effects.Glow=0,y._cachedEffects=y._cachedEffects||{},y._cachedEffects.Glow="skip",y.traverse((function(e){(e.isMesh||e.isSprite)&&(e.effects=e.effects||{},e.effects.Glow=0,e._cachedEffects=e._cachedEffects||{},e._cachedEffects.Glow="skip")}))),void 0===x.bloom&&void 0===x.glow||(y.effects=y.effects||{},y.effects.Glow=x.glow,y._cachedEffects=y._cachedEffects||{},y._cachedEffects.Glow=x.glow,y.traverse((function(e){(e.isMesh||e.isSprite)&&(e.effects=e.effects||{},e.effects.Glow=x.glow,e._cachedEffects=e._cachedEffects||{},e._cachedEffects.Glow=x.glow)}))),void 0!==x.skipInnerGlow&&(y.effects=y.effects||{},y.effects.InnerGlow=0,y._cachedEffects=y._cachedEffects||{},y._cachedEffects.InnerGlow="skip",y.traverse((function(e){(e.isMesh||e.isSprite)&&(e.effects=e.effects||{},e.effects.InnerGlow=0,e._cachedEffects=e._cachedEffects||{},e._cachedEffects.InnerGlow="skip")}))),void 0===x.glowInset&&void 0===x.innerGlow||(y.effects=y.effects||{},y.effects.InnerGlow=x.innerGlow,y._cachedEffects=y._cachedEffects||{},y._cachedEffects.InnerGlow=x.innerGlow,y.traverse((function(e){(e.isMesh||e.isSprite)&&(e.effects=e.effects||{},e.effects.InnerGlow=x.innerGlow,e._cachedEffects=e._cachedEffects||{},e._cachedEffects.InnerGlow=x.innerGlow)}))),void 0!==x.skipOutline&&(y.userData.skipOutline=!0,y.traverse((function(e){(e.isMesh||e.isSprite)&&(e.userData=e.userData||{},e.userData.skipOutline=!0)})))),void 0!==b){const e=parseInt(b);y.traverse((function(t){(t.isMesh||t.isSprite)&&(t.renderOrder=e,t.userData=t.userData||{},t.userData.renderOrder=e)}))}return void 0!==A&&(y.castShadow=!!A,y.userData.castShadow=!!A),void 0!==S&&(y.receiveShadow=!!S,y.userData.receiveShadow=!!S),y}));if(i.clear(),e.nodes=u,e.cameras=a,e.lights=s,void 0!==l){const t={};t.effector=l,t.links=o,t.iteration=3,e.ik=[],e.ik.push(t)}}},d_,class{static parse(e){const{gltf:t,nodes:r}=e,n=t.scenes.map((e=>{const{name:n="",nodes:i=[],extras:a={}}=e,s=new od;s.name=n,s.userData.extras=a;for(let e=0;e<i.length;e++)J_(i[e],s,t.nodes,r);return s}));e.roots=n,e.root=n[t.scene]}},f_,class{static parse(e){const{roots:t,materials:r,textures:n}=e;for(let e=0,i=t.length;e<i;e++){t[e].traverse((e=>{ev(e,r,n)}))}}}],Tv=new class{constructor(e=mh,t=__){this.manager=e,this.detailLoadProgress=!0,this.autoLogError=!0,this._parsers=t.slice(0),this._dracoLoader=null,this._meshoptDecoder=null,this._ktx2Loader=null,this._fileLoader=new _h;const r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,i=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||r||n&&i<98?this._imageLoader=new yh:this._imageLoader=new Ng}load(e,t={}){return this.manager.itemStart(e),new Promise(((r,n)=>{const i=new g_;i.url=e,i.path=Ig.extractUrlBase(e),i.options=t,this._parse(i).then(r).then((()=>this.manager.itemEnd(e))).catch((t=>{this.autoLogError&&console.error(t),this.detailLoadProgress&&i.loadItems&&i.loadItems.forEach((e=>{this.manager.itemEnd(e)})),this.manager.itemError(e),this.manager.itemEnd(e),n(`Error loading glTF model from ${e} .`)}))}))}_parse(e){let t;return new Promise(((r,n)=>{this._parsers.forEach((r=>{t=t?t.then((()=>r.parse(e,this))):r.parse(e,this)})),t?t.then((()=>r(e))).catch(n):r(e)}))}setDRACOLoader(e){return this._dracoLoader=e,this}getDRACOLoader(){return this._dracoLoader}setMeshoptDecoder(e){return this._meshoptDecoder=e,this}getMeshoptDecoder(){return this._meshoptDecoder}setKTX2Loader(e){return this._ktx2Loader=e,this}getKTX2Loader(){return this._ktx2Loader}loadFile(e,t="json"){return this._fileLoader.setResponseType(t),new Promise(((t,r)=>{e=this.manager.resolveURL(e),this._fileLoader.load(e,t,void 0,r)}))}loadImage(e){return new Promise(((t,r)=>{e=this.manager.resolveURL(e),this._imageLoader.load(e,t,void 0,r)}))}insertParser(e,t){this._parsers.splice(t,0,e)}replaceParser(e,t){this._parsers.splice(t,1,e)}}(mh,Cv);let Dv=null;class Mv{constructor(){this._loader=Tv}static setDecoderPath(e){Dv||(Dv=new yv),Dv.setDecoderPath(e)}load(e,t){return this._loader.load(e,t).then((t=>({url:e,node:t.root,animations:t.animations,materials:t.materials,textures:t.textures,extensions:t.gltf.extensions,sourcefile:t.sourcefile,ik:t.ik})))}loadGLTF(e,t,r){const n=new gv(t=t||{},{});let i;const a=t.gltffiles||t.modelfiles;if(a&&a.length)if(t.lod){const r=Object.keys(t.lod)[0],n=a.findIndex((e=>-1!==e.indexOf(r)));i=cv.appendURL(e,a[n])}else i=cv.appendURL(e,a[0]);else i=cv.appendURL(e,"scene.gltf");return t.sourcefile&&(r.sourcefile=t.sourcefile),this.load(i,Object.assign({decoder:n},r))}loadGLTFs(e,t,r){var n;n=new od;const i=[];var a=t.gltffiles||t.modelfiles,s={};const o=[],l=new gv(t,s);for(var u=0;u<a.length;u++){const t=this._loadGLTFs(l,e,s.data,u,n,r);o.push(t)}return Promise.all(o).then((e=>(e.forEach((e=>{i.push({node:e.node,animations:e.animations,materials:e.materials}),n.add(e.node)})),{node:n,models:i})))}_loadGLTFs(e,t,r,n,i,a){this._loader.loadingIndex=n;var s=(r.gltffiles||r.modelfiles)[n],o=cv.appendURL(t,s);return this.load(o,Object.assign({decoder:e},a))}loadFromURL(e){const t=e.url,r=e.errorHandle,n=e.onLoadTexture,i={},a=cv.getExtension(t);if(n&&(i.onLoadTexture=n),Dv&&this._loader.setDRACOLoader(Dv),"gltf"==a||"glb"==a)return this.load(t,i);{const e=cv.appendURL(t,"index.json"),n=this;return n._loader.loadFile(e).then((e=>{if(!e)return;const r=cv.objectKeysToLowerCase(e),a=r.gltffiles||r.modelfiles;return a&&0!==a.length?(a[0]||a.splice(0,1),1===a.length||r.lod?(r.lod&&console.warn("The lod models is not fully supported!"),n.loadGLTF(t,r,i)):n.loadGLTFs(t,r,i)):n.loadGLTF(t,r,i)})).catch((e=>{var i=!1;if(r&&(i=r(e)),!i)return n.loadGLTF(t,null)}))}}}const Pv={front:Lc.BACK,back:Lc.FRONT,double:Lc.DOUBLE},Fv="RendererType",Rv="NamespaceObject",Nv="DracoDecoder",Bv={antialias:!0,alpha:!1,stencil:!0},Iv={},Ov={},kv=(e,t)=>{const{object:r,geometry:n,material:i}=e,a=!!r.skeleton,s=n.morphAttributes.position&&n.morphAttributes.position.length>0,o=!!i.defines.USE_INSTANCING,l=i.clippingPlanes,u=l&&l.length>0?l.length:0,c=s<<0|a<<1|o<<2;let h=Iv[c];void 0===h&&(h={},Iv[c]=h);let d=h[u];return void 0===d&&(d=new Pg,d.packToRGBA=!0,o&&(d.defines.USE_INSTANCING=!0),h[u]=d),d.side=Pv[i.side],d.clippingPlanes=i.clippingPlanes,d.drawMode=i.drawMode,d},Lv=(e,t)=>{const{object:r,geometry:n,material:i}=e,a=!!r.skeleton,s=n.morphAttributes.position&&n.morphAttributes.position.length>0,o=!!i.defines.USE_INSTANCING,l=i.clippingPlanes,u=l&&l.length>0?l.length:0,c=s<<0|a<<1|o<<2;let h=Ov[c];void 0===h&&(h={},Ov[c]=h);let d=h[u];return void 0===d&&(d=new Rg,d.uniforms={},o&&(d.defines.USE_INSTANCING=!0),h[u]=d),d.side=Pv[i.side],d.uniforms.nearDistance=t.shadow.cameraNear,d.uniforms.farDistance=t.shadow.cameraFar,d.clippingPlanes=i.clippingPlanes,d.drawMode=i.drawMode,d};class Uv{constructor(e){if(!e||!e.canvas)return;const t=e.compatibleMode&&e.compatibleMode.compatibleRender;t&&(of.encodings_frag="\n\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n\n#ifdef USE_AOMAP\n\tgl_FragColor.rgb *= ambientOcclusion;\n#else \n\t#ifdef USE_PBR\n\t\tgl_FragColor.rgb *= 1.2;\t\t\t// thingJs1.0 floorAo\n\t#endif\n#endif\n\n",of.aoMap_frag="\n#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAOMapUV ).r - 1.0 ) * aoMapIntensity  + 1.25;\n\n    #if defined(USE_ENV_MAP) && defined(USE_PBR)\n        float dotNV = saturate(dot(N, V));\n        reflectedLight.indirectSpecular *= computeSpecularOcclusion(dotNV, ambientOcclusion, GGXRoughnessToBlinnExponent(roughness));\n    #endif\n#endif\n");const r=e.canvas,n=r.getContext("webgl2",e||Bv)||r.getContext("webgl",e||Bv),i=new sm(n);var a;i.backRenderTarget=new wm(r),i.shadowMapPass=new wp,i.shadowMapPass.getDepthMaterial=kv,i.shadowMapPass.getDistanceMaterial=Lv,i.shadowMapPass.transparentShadow=!0,this._compatibleRender=t,this._renderer=i,this._logarithmicDepthBuffer=!1,this._logarithmicDepthNear=null,this._logarithmicDepthFar=null,this.deviceType=null,a=this,/(iPad|iPhone|iPod|iOS)/g.test(navigator.userAgent)&&(a.deviceType="ios"),this._texNeedRefresh=new Set}$markTexture(e){"EquirectangularReflection"===e._mapping&&this._texNeedRefresh.add(e)}$flushTextures(){0!==this._texNeedRefresh.size&&(this._texNeedRefresh.forEach((e=>{e.$preprocessEquTex()})),this._texNeedRefresh.clear())}setSize(e){this._renderer.backRenderTarget.resize(e[0],e[1])}getSize(e=[]){const t=this._renderer.backRenderTarget;return e.push(t.width,t.height),e}setPixelRatio(e){}getPixelRatio(){}getCapabilities(){const e=this._renderer.renderPass.capabilities;return{maxAnisotropy:e.maxAnisotropy,maxCubemapSize:e.maxCubemapSize,maxSamples:e.maxSamples,maxTextureSize:e.maxTextureSize,maxTextures:e.maxTextures,maxVertexTextures:e.maxVertexTextures,precision:e.maxPrecision,isWebGL2:e.version>=2,vertexTextures:e.maxVertexTextures}}getExtensions(){const e=this._renderer.renderPass.capabilities;return{has:function(t){return null!==e.getExtension(t)},get:function(t){return this.has(t)||console.warn("T3D.WebGLCapabilities: "+t+" extension not supported."),e.getExtension(t)}}}getContext(){return this._renderer.renderPass.gl}getContainer(){return this._renderer.backRenderTarget.view}run(e){this._renderer.setAnimationLoop((t=>e(t)))}stop(){this._renderer.setAnimationLoop(null)}resetStates(e=!0,t=!0,r=!0){const n=this._renderer.renderPass;e&&n.resetState(),t&&n.resetVertexArrayBindings(!0),r&&(n._state.currentRenderTarget=null)}setLogarithmicDepthBuffer(e){this._logarithmicDepthBuffer=!!e}getLogarithmicDepthBuffer(){return this._logarithmicDepthBuffer}setLogarithmicDepthNear(e){e!=this._logarithmicDepthNear&&(this._logarithmicDepthNear=e)}getLogarithmicDepthNear(){return this._logarithmicDepthNear}setLogarithmicDepthFar(e){e!=this._logarithmicDepthFar&&(this._logarithmicDepthFar=e)}getLogarithmicDepthFar(){return this._logarithmicDepthFar}setAttribute(e,t){if(e===Nv)Mv.setDecoderPath(t.path)}getAttribute(e){if(!e)return null;switch(e){case Fv:return"T3D";case Rv:return Ym;default:return null}}dispose(){if(!this._renderer)return;const e=this._renderer.backRenderTarget.view;e&&e.parentElement&&e.parentElement.removeChild(e),this._renderer=null}get $renderer(){return this._renderer}}class zv{constructor(e,t,r){this.autoUpdate=!0,this.needsUpdate=!0}needRender(){return!!this.autoUpdate||!!this.needsUpdate&&(this.needsUpdate=!1,!0)}setGeometryReplaceFunction(e){}setIfRenderReplaceFunction(e){}render(e,t,r,n){}output(e){}resize(e,t){this.needsUpdate=!0}dispose(){this.needsUpdate=!0}}class jv{constructor(){this.name="",this.bufferDependencies=[],this.active=!0}render(e,t,r,n,i){console.error("Effect: .render() must be implemented in subclass.")}resize(e,t){}dispose(){}}const Vv="\n    attribute vec3 a_Position;\n    attribute vec2 a_Uv;\n\n    uniform mat4 u_ProjectionView;\n    uniform mat4 u_Model;\n\n    varying vec2 v_Uv;\n\n    void main() {\n        v_Uv = a_Uv;\n        gl_Position = u_ProjectionView * u_Model * vec4(a_Position, 1.0);\n    }\n",Gv={name:"ec_blur",defines:{NORMALTEX_ENABLED:0,DEPTHTEX_ENABLED:0,DEPTH_PACKING:0,KERNEL_SIZE_INT:"5",KERNEL_SIZE_FLOAT:"5.0"},uniforms:{tDiffuse:null,textureSize:[512,512],direction:0,blurSize:1,kernel:[.122581,.233062,.288713,.233062,.122581],normalTex:null,depthTex:null,projection:new Float32Array(16),viewInverseTranspose:new Float32Array(16),depthRange:1},vertexShader:Vv,fragmentShader:"\n        uniform vec2 textureSize;\n        uniform int direction;\n        uniform float blurSize;\n        uniform float kernel[KERNEL_SIZE_INT];\n\n        #if NORMALTEX_ENABLED == 1\n            uniform sampler2D normalTex;\n            uniform mat4 viewInverseTranspose;\n            vec3 getViewNormal(const in vec2 screenPosition) {\n                vec3 normal = texture2D(normalTex, screenPosition).xyz * 2.0 - 1.0;\n                // Convert to view space\n                return (viewInverseTranspose * vec4(normal, 0.0)).xyz;\n            }\n        #endif\n\n        #if DEPTHTEX_ENABLED == 1\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\t\t#include <packing>\n\t\t\t#endif\n\t\t\tuniform sampler2D depthTex;\n\t\t\tuniform mat4 projection;\n\t\t\tuniform float depthRange;\n\t\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t\t#if DEPTH_PACKING == 1\n\t\t\t\t\treturn unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );\n\t\t\t\t#else\n\t\t\t\t\treturn texture2D( depthTex, screenPosition ).r;\n\t\t\t\t#endif\n\t\t\t}\n\t\t\tfloat getLinearDepth(vec2 coord) {\n\t\t\t\tfloat depth = getDepth(coord) * 2.0 - 1.0;\n\t\t\t\treturn projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n\t\t\t}\n\t\t#endif\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        void main() {\n            vec2 off = vec2(0.0);\n            if (direction == 0) {\n                off[0] = blurSize / textureSize.x;\n            } else {\n                off[1] = blurSize / textureSize.y;\n            }\n\n            vec4 sum = vec4(0.0);\n            float weightAll = 0.0;\n\n            #if NORMALTEX_ENABLED == 1\n                vec3 centerNormal = getViewNormal(v_Uv);\n            #endif\n            #if DEPTHTEX_ENABLED == 1\n                float centerDepth = getLinearDepth(v_Uv);\n            #endif\n\n            for (int i = 0; i < KERNEL_SIZE_INT; i++) {\n\t\t\t\tvec2 coord = clamp(v_Uv + vec2(float(i) - (KERNEL_SIZE_FLOAT - 1.) / 2.) * off, vec2(0.0), vec2(1.0));\n\t\t\t\tfloat w = kernel[i];\n\n\t\t\t\t#if NORMALTEX_ENABLED == 1\n\t\t\t\t\tvec3 normal = getViewNormal(coord);\n\t\t\t\t\tw *= clamp(dot(normal, centerNormal), 0.0, 1.0);\n\t\t\t\t#endif\n\t\t\t\t#if DEPTHTEX_ENABLED == 1\n\t\t\t\t\tfloat d = getLinearDepth(coord);\n\t\t            // PENDING Better equation?\n\t\t            // w *= (1.0 - smoothstep(abs(centerDepth - d) / depthRange, 0.0, 1.0));\n\t\t\t\t\tw *= (1.0 - smoothstep(0.0, 1.0, abs(centerDepth - d) / depthRange));\n\t\t\t\t#endif\n\n\t\t\t\tweightAll += w;\n\t\t\t\tsum += w * texture2D(tDiffuse, coord);\n\t\t\t}\n\n\t\t\tgl_FragColor = sum / weightAll;\n        }\n    "},Wv={name:"ec_additive",defines:{},uniforms:{texture1:null,colorWeight1:1,alphaWeight1:1,texture2:null,colorWeight2:1,alphaWeight2:1},vertexShader:Vv,fragmentShader:"\n        uniform sampler2D texture1;\n        uniform float colorWeight1;\n        uniform float alphaWeight1;\n\n        uniform sampler2D texture2;\n        uniform float colorWeight2;\n        uniform float alphaWeight2;\n\n        varying vec2 v_Uv;\n\n        void main() {\n            vec4 texel1 = texture2D(texture1, v_Uv);\n            vec4 texel2 = texture2D(texture2, v_Uv);\n            vec3 color = texel1.rgb * colorWeight1 + texel2.rgb * colorWeight2;\n            float alpha = texel1.a * alphaWeight1 + texel2.a * alphaWeight2;\n            gl_FragColor = vec4(color, alpha);\n        }\n    "},Hv={name:"ec_multiply",defines:{},uniforms:{texture1:null,texture2:null},vertexShader:Vv,fragmentShader:"\n        uniform sampler2D texture1;\n        uniform sampler2D texture2;\n\n        varying vec2 v_Uv;\n\n        void main() {\n            vec4 texel1 = texture2D(texture1, v_Uv);\n            vec4 texel2 = texture2D(texture2, v_Uv);\n            gl_FragColor = texel1 * texel2;\n        }\n    "},qv={name:"ec_copy",defines:{},uniforms:{tDiffuse:null},vertexShader:Vv,fragmentShader:"\n        uniform sampler2D tDiffuse;\n\n        varying vec2 v_Uv;\n\n        void main() {\n            gl_FragColor = texture2D(tDiffuse, v_Uv);\n        }\n    "},Xv={name:"ec_channel",defines:{},uniforms:{tDiffuse:null,channelMask:[1,0,0,0]},vertexShader:Vv,fragmentShader:"\n        uniform sampler2D tDiffuse;\n\t\tuniform vec4 channelMask;\n\n        varying vec2 v_Uv;\n\n        void main() {\n\t\t\tfloat value = dot(texture2D(tDiffuse, v_Uv), channelMask);\n            gl_FragColor = vec4(vec3(value), 1.0);\n        }\n    "},Qv={name:"ec_mask",defines:{},uniforms:{colorTexture:null,maskTexture:null,additiveTexture:null,channel:[1,0,0,0]},vertexShader:Vv,fragmentShader:"\n        uniform sampler2D colorTexture;\n\t\tuniform sampler2D maskTexture;\n\n\t\tuniform sampler2D additiveTexture;\n\n\t\tuniform vec4 channel;\n\n        varying vec2 v_Uv;\n\n        void main() {\n\t\t\tvec4 colorTex = texture2D(colorTexture, v_Uv);\n\t\t\tvec4 maskTex = texture2D(maskTexture, v_Uv);\n\t\t\tvec4 addTex = texture2D(additiveTexture, v_Uv);\n            gl_FragColor = colorTex * dot(maskTex, channel) + addTex;\n        }\n    "},Kv={name:"ec_highlight",defines:{},uniforms:{tDiffuse:null,threshold:1,smoothWidth:.01},vertexShader:Vv,fragmentShader:"\n        uniform float threshold;\n\t\tuniform float smoothWidth;\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        void main() {\n            vec4 texel = texture2D(tDiffuse, v_Uv);\n            vec3 luma = vec3(0.299, 0.587, 0.114);\n            float v = dot(texel.xyz, luma);\n            gl_FragColor = smoothstep(threshold, threshold + smoothWidth, v) * texel;\n        }\n    "},Yv={name:"ec_seperable_blur",defines:{MAX_RADIUS:4},uniforms:{tDiffuse:null,texSize:[.5,.5],direction:[.5,.5],kernelRadius:1},vertexShader:Vv,fragmentShader:"\n        uniform vec2 texSize;\n        uniform vec2 direction;\n        uniform float kernelRadius;\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        float gaussianPdf(in float x, in float sigma) {\n\t\t\treturn 0.39894 * exp(-0.5 * x * x / (sigma * sigma)) / sigma;\n\t\t}\n\n        void main() {\n            vec2 invSize = 1.0 / texSize;\n\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\n\t\t\tvec4 diffuseColor = texture2D(tDiffuse, v_Uv);\n\t\t\tvec4 diffuseSum = diffuseColor * weightSum;\n\t\t\tvec2 delta = direction * invSize * kernelRadius / float(MAX_RADIUS);\n\t\t\tvec2 uvOffset = delta;\n\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\n\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\n\t\t\t\tvec4 sample1 = texture2D(tDiffuse, v_Uv + uvOffset);\n\t\t\t\tvec4 sample2 = texture2D(tDiffuse, v_Uv - uvOffset);\n\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\n\t\t\t\tweightSum += (2.0 * w);\n\t\t\t\tuvOffset += delta;\n\t\t\t}\n\t\t\tvec4 color = diffuseSum / weightSum;\n\t\t\tgl_FragColor = color;\n        }\n    "},Zv={name:"ec_h_blur",uniforms:{tDiffuse:null,h:1/512},vertexShader:Vv,fragmentShader:"\n\t\tuniform float h;\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        void main() {\n            vec4 sum = vec4(0.0);\n           \n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x - 4.0 * h, v_Uv.y)) * 0.051;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x - 3.0 * h, v_Uv.y)) * 0.0918;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x - 2.0 * h, v_Uv.y)) * 0.12245;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x - 1.0 * h, v_Uv.y)) * 0.1531;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y)) * 0.1633;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x + 1.0 * h, v_Uv.y)) * 0.1531;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x + 2.0 * h, v_Uv.y)) * 0.12245;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x + 3.0 * h, v_Uv.y)) * 0.0918;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x + 4.0 * h, v_Uv.y)) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n        }\n    "},Jv={name:"ec_v_blur",uniforms:{tDiffuse:null,v:1/512},vertexShader:Vv,fragmentShader:"\n\t\tuniform float v;\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        void main() {\n            vec4 sum = vec4(0.0);\n           \n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y - 4.0 * v)) * 0.051;\n            sum += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y - 3.0 * v)) * 0.0918;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y - 2.0 * v)) * 0.12245;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y - 1.0 * v)) * 0.1531;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y)) * 0.1633;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y + 1.0 * v)) * 0.1531;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y + 2.0 * v)) * 0.12245;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y + 3.0 * v)) * 0.0918;\n\t\t\tsum += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y + 4.0 * v)) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n        }\n    "};function $v(e){return e.format===zc.DEPTH_STENCIL||e.format===zc.DEPTH24_STENCIL8}const ey={OPAQUE:1,TRANSPARENT:2,ALL:15};class ty extends jv{constructor(){super(),this.threshold=.7,this.smoothWidth=.01,this.blurSize=2,this.strength=1,this._highlightPass=new Ap(Kv),this._blurPass=new Ap(Gv),this._blendPass=new Ap(Wv),this._blendPass.material.premultipliedAlpha=!0}resize(e,t){this._blurPass.uniforms.textureSize[0]=e,this._blurPass.uniforms.textureSize[1]=t}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(0),s=t._renderTargetCache.allocate(1),o=t._renderTargetCache.allocate(1);e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._highlightPass.uniforms.tDiffuse=r.texture,this._highlightPass.uniforms.threshold=this.threshold,this._highlightPass.uniforms.smoothWidth=this.smoothWidth,this._highlightPass.render(e),e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.tDiffuse=a.texture,this._blurPass.uniforms.direction=0,this._blurPass.uniforms.blurSize=this.blurSize,this._blurPass.render(e),e.renderPass.setRenderTarget(o),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.tDiffuse=s.texture,this._blurPass.uniforms.direction=1,this._blurPass.uniforms.blurSize=this.blurSize,this._blurPass.render(e),e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=o.texture,this._blendPass.uniforms.colorWeight1=1,this._blendPass.uniforms.alphaWeight1=1,this._blendPass.uniforms.colorWeight2=this.strength,this._blendPass.uniforms.alphaWeight2=this.strength,i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1)),t._renderTargetCache.release(a,0),t._renderTargetCache.release(s,1),t._renderTargetCache.release(o,1)}dispose(){this._highlightPass.dispose(),this._blurPass.dispose(),this._blendPass.dispose()}}class ry extends jv{constructor(){super(),this.chromaFactor=.025,this._mainPass=new Ap(ny),this._mainPass.material.premultipliedAlpha=!0}resize(e,t){this._mainPass.uniforms.resolution[0]=1/e,this._mainPass.uniforms.resolution[1]=1/t}render(e,t,r,n,i){e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1);const a=this._mainPass;a.uniforms.tDiffuse=r.texture,a.uniforms.uChromaFactor=this.chromaFactor,i&&(a.material.transparent=t._tempClearColor[3]<1||!t.clearColor,a.renderStates.camera.rect.fromArray(t._tempViewport)),a.render(e),i&&(a.material.transparent=!1,a.renderStates.camera.rect.set(0,0,1,1))}dispose(){this._mainPass.dispose()}}const ny={name:"ec_chromatic_aberration",defines:{},uniforms:{tDiffuse:null,uChromaFactor:.025,uResolutionRatio:[1,1],resolution:[1/1024,1/512]},vertexShader:Vv,fragmentShader:"\n        uniform float uChromaFactor;\n        uniform vec2 uResolutionRatio;\n        uniform vec2 resolution;\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        void main() {\n            vec2 uv = v_Uv;\n            vec2 dist = uv - 0.5;\n            vec2 offset = uChromaFactor * dist * length(dist);\n            vec4 col = texture2D(tDiffuse, min(uv, 1.0 - resolution) * uResolutionRatio);\n            col.r = texture2D(tDiffuse, min(uv - offset, 1.0 - resolution) * uResolutionRatio).r;\n            col.b = texture2D(tDiffuse, min(uv + offset, 1.0 - resolution) * uResolutionRatio).b;\n            gl_FragColor = col;\n        }\n    "};class iy extends jv{constructor(){super(),this.brightness=0,this.contrast=1.02,this.exposure=0,this.gamma=1,this.saturation=1.02,this._mainPass=new Ap(ay),this._mainPass.material.premultipliedAlpha=!0,this._mainPass.uniforms.contrast=1.02,this._mainPass.uniforms.saturation=1.02}render(e,t,r,n,i){e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1);const a=this._mainPass;a.uniforms.tDiffuse=r.texture,a.uniforms.brightness=this.brightness,a.uniforms.contrast=this.contrast,a.uniforms.exposure=this.exposure,a.uniforms.gamma=this.gamma,a.uniforms.saturation=this.saturation,i&&(a.material.transparent=t._tempClearColor[3]<1||!t.clearColor,a.renderStates.camera.rect.fromArray(t._tempViewport)),a.render(e),i&&(a.material.transparent=!1,a.renderStates.camera.rect.set(0,0,1,1))}dispose(){this._mainPass.dispose()}}const ay={name:"ec_color_correction",defines:{},uniforms:{tDiffuse:null,brightness:0,contrast:1,exposure:0,gamma:1,saturation:1},vertexShader:Vv,fragmentShader:'\n        uniform float brightness;\n        uniform float contrast;\n        uniform float exposure;\n        uniform float gamma;\n        uniform float saturation;\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        // Values from "Graphics Shaders: Theory and Practice" by Bailey and Cunningham\n        const vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\n        void main() {\n            vec4 tex = texture2D(tDiffuse, v_Uv);\n            // brightness\n            vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);\n            // contrast\n            color = clamp((color - vec3(0.5)) * contrast + vec3(0.5), 0.0, 1.0);\n            // exposure\n            color = clamp(color * pow(2.0, exposure), 0.0, 1.0);\n            // gamma\n            color = clamp(pow(color, vec3(gamma)), 0.0, 1.0);\n            float luminance = dot(color, w);\n            color = mix(vec3(luminance), color, saturation);\n            gl_FragColor = vec4(color, tex.a);\n        }\n    '};class sy extends jv{constructor(){super(),this.bufferDependencies=[{key:"GBuffer"}],this.focalDepth=1,this.focalLength=24,this.fstop=.9,this.maxblur=1,this.threshold=.9,this.gain=1,this.bias=.5,this.dithering=1e-4,this._mainPass=new Ap(oy),this._mainPass.material.premultipliedAlpha=!0}resize(e,t){this._mainPass.uniforms.resolution[0]=1/e,this._mainPass.uniforms.resolution[1]=1/t}render(e,t,r,n,i){e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1);const a=t.getBuffer("GBuffer"),s=a.getCurrentRenderStates();this._mainPass.uniforms.tColor=r.texture,this._mainPass.uniforms.tDepth=a.output()._attachments[Zc.DEPTH_STENCIL_ATTACHMENT];let o=0,l=0;const u=s.camera.projectionMatrix;-1===u.elements[11]?(o=u.elements[14]/(u.elements[10]-1),l=u.elements[14]/(u.elements[10]+1)):(o=(u.elements[14]+1)/u.elements[10],l=(u.elements[14]-1)/u.elements[10]),this._mainPass.uniforms.znear=o,this._mainPass.uniforms.zfar=l,this._mainPass.uniforms.focalDepth=this.focalDepth,this._mainPass.uniforms.focalLength=this.focalLength,this._mainPass.uniforms.fstop=this.fstop,this._mainPass.uniforms.maxblur=this.maxblur,this._mainPass.uniforms.threshold=this.threshold,this._mainPass.uniforms.gain=this.gain,this._mainPass.uniforms.bias=this.bias,this._mainPass.uniforms.dithering=this.dithering,i&&(this._mainPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._mainPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._mainPass.render(e),i&&(this._mainPass.material.transparent=!1,this._mainPass.renderStates.camera.rect.set(0,0,1,1))}dispose(){this._mainPass.dispose()}}const oy={name:"ec_bokeh",defines:{RINGS:3,SAMPLES:4},uniforms:{tColor:null,tDepth:null,resolution:[1/1024,1/512],znear:.1,zfar:100,focalDepth:1,focalLength:24,fstop:.9,maxblur:1,threshold:.5,gain:2,bias:.5,dithering:1e-4},vertexShader:Vv,fragmentShader:"\n        varying vec2 v_Uv;\n\n        uniform sampler2D tColor;\n        uniform sampler2D tDepth;\n        \n        uniform vec2 resolution;  \n        \n        uniform float znear;\n        uniform float zfar;\n\n        uniform float focalDepth;\n        uniform float focalLength;\n        uniform float fstop;\n\n        uniform float maxblur; // clamp value of max blur (0.0 = no blur, 1.0 default)\n        uniform float threshold; // highlight threshold\n        uniform float gain; // highlight gain\n        uniform float bias; // bokeh edge bias\n        uniform float dithering;\n\n        const int samples = SAMPLES;\n        const int rings = RINGS;\n        const int maxringsamples = rings * samples;\n\n        float CoC = 0.03; // circle of confusion size in mm (35mm film = 0.03mm)\n\n        vec4 color(vec2 coords, float blur) {\n            vec4 col = texture2D(tColor, coords);\n            vec3 lumcoeff = vec3(0.299, 0.587, 0.114);\n            float lum = dot(col.rgb, lumcoeff);\n            float thresh = max((lum - threshold) * gain, 0.0);\n            return vec4(col.rgb + mix(vec3(0.0), col.rgb, thresh * blur), col.a);\n        }\n\n        float linearize(float depth) {\n            return -zfar * znear / (depth * (zfar - znear) - zfar);\n        }\n\n        float gather(float i, float j, int ringsamples, inout vec3 colorSum, float w, float h, float blur) {\n            float rings2 = float(rings);\n            float step = PI * 2.0 / float(ringsamples);\n            float pw = cos(j * step) * i;\n            float ph = sin(j * step) * i;\n\t\t\tvec4 sampleColor = color(v_Uv + vec2(pw * w, ph * h), blur);\n\t\t\tfloat weight = mix(1.0, i / rings2, bias) * sampleColor.a;\n            colorSum += sampleColor.rgb  * weight;\n            return weight;\n        }\n\n        void main() {\n            float depth = linearize(texture2D(tDepth,  v_Uv).x);\n            float fDepth = focalDepth;\n\n            // dof blur factor calculation\n\n            float f = focalLength; // focal length in mm\n            float d = fDepth * 1000.; // focal plane in mm\n            float o = depth * 1000.; // depth in mm\n\n            float a = (o * f) / (o - f);\n            float b = (d * f) / (d - f);\n            float c = (d - f) / (d * fstop * CoC);\n\n            float blur = abs(a - b) * c;\n            blur = clamp(blur, 0.0, 1.0);\n\n            // calculation of pattern for dithering\n\n            vec2 noise = vec2(rand( v_Uv), rand( v_Uv + vec2(0.4, 0.6))) * dithering * blur;\n\n            // getting blur x and y step factor\n\n            float w = resolution.x * blur * maxblur + noise.x;\n            float h = resolution.y * blur * maxblur + noise.y;\n\n            // calculation of final color\n\n            vec3 col = vec3(0.0);\n\t\t\tvec4 centerColor = texture2D(tColor,  v_Uv);\n\n            if (blur < 0.05) {\n                col = centerColor.rgb;\n            } else {\n                col = centerColor.rgb;\n\n                float s = 1.0;\n                int ringsamples;\n\n                for(int i = 1; i <= rings; i++) {\n                    ringsamples = i * samples;\n\n                    for (int j = 0; j < maxringsamples; j++) {\n                        if (j >= ringsamples) break;\n                        s += gather(float(i), float(j), ringsamples, col, w, h, blur);\n                    }\n                }\n\n                col /= s; // divide by sample count\n            }\n\n            gl_FragColor = vec4(col, centerColor.a);\n        }\n    "};class ly extends jv{constructor(){super(),this.noiseIntensity=.35,this.scanlinesIntensity=.5,this.scanlinesCount=2048,this.grayscale=!0,this._time=0,this._mainPass=new Ap(uy),this._mainPass.material.premultipliedAlpha=!0}render(e,t,r,n,i){e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1);const a=this._mainPass;a.uniforms.tDiffuse=r.texture,a.uniforms.nIntensity=this.noiseIntensity,a.uniforms.sIntensity=this.scanlinesIntensity,a.uniforms.sCount=this.scanlinesCount,a.uniforms.grayscale=this.grayscale,this._time+=.01667,a.uniforms.time=this._time,i&&(a.material.transparent=t._tempClearColor[3]<1||!t.clearColor,a.renderStates.camera.rect.fromArray(t._tempViewport)),a.render(e),i&&(a.material.transparent=!1,a.renderStates.camera.rect.set(0,0,1,1))}dispose(){this._mainPass.dispose()}}const uy={name:"ec_film",defines:{},uniforms:{tDiffuse:null,time:0,nIntensity:.5,sIntensity:.05,sCount:4096,grayscale:!0},vertexShader:Vv,fragmentShader:"\n        uniform float time;\n        uniform float nIntensity;\n        uniform float sIntensity;\n        uniform float sCount;\n        uniform bool grayscale;\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        void main() {\n            // sample the source\n            vec4 cTextureScreen = texture2D(tDiffuse, v_Uv);\n            // make some noise\n            float dx = rand(v_Uv + time);\n            // add noise\n            vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp(0.1 + dx, 0.0, 1.0);\n            // get us a sine and cosine\n            vec2 sc = vec2(sin(v_Uv.y * sCount), cos(v_Uv.y * sCount));\n            // add scanlines\n            cResult += cTextureScreen.rgb * vec3(sc.x, sc.y, sc.x) * sIntensity;\n            // interpolate between source and result by intensity\n            cResult = cTextureScreen.rgb + clamp(nIntensity, 0.0, 1.0) * (cResult - cTextureScreen.rgb);\n            // convert to grayscale if desired\n            if(grayscale) {\n                cResult = vec3(cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11);\n            }\n            gl_FragColor = vec4(cResult, cTextureScreen.a);\n        }\n    "};class cy extends jv{constructor(){super(),this._mainPass=new Ap(hy),this._mainPass.material.premultipliedAlpha=!0}resize(e,t){this._mainPass.uniforms.resolution[0]=1/e,this._mainPass.uniforms.resolution[1]=1/t}render(e,t,r,n,i){e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._mainPass.uniforms.tDiffuse=r.texture,i&&(this._mainPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._mainPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._mainPass.render(e),i&&(this._mainPass.material.transparent=!1,this._mainPass.renderStates.camera.rect.set(0,0,1,1))}dispose(){this._mainPass.dispose()}}const hy={name:"ec_fxaa",defines:{},uniforms:{tDiffuse:null,resolution:[1/1024,1/512]},vertexShader:Vv,fragmentShader:"\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n        \n        uniform vec2 resolution;  \n        \n        // FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\n        \n        //----------------------------------------------------------------------------------\n        // File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\n        // SDK Version: v3.00\n        // Email:       gameworks@nvidia.com\n        // Site:        http://developer.nvidia.com/\n        //\n        // Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n        //\n        // Redistribution and use in source and binary forms, with or without\n        // modification, are permitted provided that the following conditions\n        // are met:\n        //  * Redistributions of source code must retain the above copyright\n        //    notice, this list of conditions and the following disclaimer.\n        //  * Redistributions in binary form must reproduce the above copyright\n        //    notice, this list of conditions and the following disclaimer in the\n        //    documentation and/or other materials provided with the distribution.\n        //  * Neither the name of NVIDIA CORPORATION nor the names of its\n        //    contributors may be used to endorse or promote products derived\n        //    from this software without specific prior written permission.\n        //\n        // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS \"AS IS\" AND ANY\n        // EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n        // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n        // PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n        // CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n        // EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n        // PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n        // PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n        // OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n        // (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n        // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n        //\n        //----------------------------------------------------------------------------------\n        \n        #define FXAA_PC 1\n        #define FXAA_GLSL_100 1\n        #define FXAA_QUALITY_PRESET 39\n        \n        #define FXAA_GREEN_AS_LUMA 1\n        \n        /*--------------------------------------------------------------------------*/\n        #ifndef FXAA_PC_CONSOLE\n            //\n            // The console algorithm for PC is included\n            // for developers targeting really low spec machines.\n            // Likely better to just run FXAA_PC, and use a really low preset.\n            //\n            #define FXAA_PC_CONSOLE 0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #ifndef FXAA_GLSL_120\n            #define FXAA_GLSL_120 0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #ifndef FXAA_GLSL_130\n            #define FXAA_GLSL_130 0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #ifndef FXAA_HLSL_3\n            #define FXAA_HLSL_3 0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #ifndef FXAA_HLSL_4\n            #define FXAA_HLSL_4 0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #ifndef FXAA_HLSL_5\n            #define FXAA_HLSL_5 0\n        #endif\n        /*==========================================================================*/\n        #ifndef FXAA_GREEN_AS_LUMA\n            //\n            // For those using non-linear color,\n            // and either not able to get luma in alpha, or not wanting to,\n            // this enables FXAA to run using green as a proxy for luma.\n            // So with this enabled, no need to pack luma in alpha.\n            //\n            // This will turn off AA on anything which lacks some amount of green.\n            // Pure red and blue or combination of only R and B, will get no AA.\n            //\n            // Might want to lower the settings for both,\n            //    fxaaConsoleEdgeThresholdMin\n            //    fxaaQualityEdgeThresholdMin\n            // In order to insure AA does not get turned off on colors\n            // which contain a minor amount of green.\n            //\n            // 1 = On.\n            // 0 = Off.\n            //\n            #define FXAA_GREEN_AS_LUMA 0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #ifndef FXAA_EARLY_EXIT\n            //\n            // Controls algorithm's early exit path.\n            // On PS3 turning this ON adds 2 cycles to the shader.\n            // On 360 turning this OFF adds 10ths of a millisecond to the shader.\n            // Turning this off on console will result in a more blurry image.\n            // So this defaults to on.\n            //\n            // 1 = On.\n            // 0 = Off.\n            //\n            #define FXAA_EARLY_EXIT 1\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #ifndef FXAA_DISCARD\n            //\n            // Only valid for PC OpenGL currently.\n            // Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n            //\n            // 1 = Use discard on pixels which don't need AA.\n            //     For APIs which enable concurrent TEX+ROP from same surface.\n            // 0 = Return unchanged color on pixels which don't need AA.\n            //\n            #define FXAA_DISCARD 0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #ifndef FXAA_FAST_PIXEL_OFFSET\n            //\n            // Used for GLSL 120 only.\n            //\n            // 1 = GL API supports fast pixel offsets\n            // 0 = do not use fast pixel offsets\n            //\n            #ifdef GL_EXT_gpu_shader4\n                #define FXAA_FAST_PIXEL_OFFSET 1\n            #endif\n            #ifdef GL_NV_gpu_shader5\n                #define FXAA_FAST_PIXEL_OFFSET 1\n            #endif\n            #ifdef GL_ARB_gpu_shader5\n                #define FXAA_FAST_PIXEL_OFFSET 1\n            #endif\n            #ifndef FXAA_FAST_PIXEL_OFFSET\n                #define FXAA_FAST_PIXEL_OFFSET 0\n            #endif\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #ifndef FXAA_GATHER4_ALPHA\n            //\n            // 1 = API supports gather4 on alpha channel.\n            // 0 = API does not support gather4 on alpha channel.\n            //\n            #if (FXAA_HLSL_5 == 1)\n                #define FXAA_GATHER4_ALPHA 1\n            #endif\n            #ifdef GL_ARB_gpu_shader5\n                #define FXAA_GATHER4_ALPHA 1\n            #endif\n            #ifdef GL_NV_gpu_shader5\n                #define FXAA_GATHER4_ALPHA 1\n            #endif\n            #ifndef FXAA_GATHER4_ALPHA\n                #define FXAA_GATHER4_ALPHA 0\n            #endif\n        #endif\n        \n        \n        /*============================================================================\n                                FXAA QUALITY - TUNING KNOBS\n        ------------------------------------------------------------------------------\n        NOTE the other tuning knobs are now in the shader function inputs!\n        ============================================================================*/\n        #ifndef FXAA_QUALITY_PRESET\n            //\n            // Choose the quality preset.\n            // This needs to be compiled into the shader as it effects code.\n            // Best option to include multiple presets is to\n            // in each shader define the preset, then include this file.\n            //\n            // OPTIONS\n            // -----------------------------------------------------------------------\n            // 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n            // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n            // 39       - no dither, very expensive\n            //\n            // NOTES\n            // -----------------------------------------------------------------------\n            // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n            // 13 = about same speed as FXAA 3.9 and better than 12\n            // 23 = closest to FXAA 3.9 visually and performance wise\n            //  _ = the lowest digit is directly related to performance\n            // _  = the highest digit is directly related to style\n            //\n            #define FXAA_QUALITY_PRESET 12\n        #endif\n        \n        \n        /*============================================================================\n        \n                                FXAA QUALITY - PRESETS\n        \n        ============================================================================*/\n        \n        /*============================================================================\n                            FXAA QUALITY - MEDIUM DITHER PRESETS\n        ============================================================================*/\n        #if (FXAA_QUALITY_PRESET == 10)\n            #define FXAA_QUALITY_PS 3\n            #define FXAA_QUALITY_P0 1.5\n            #define FXAA_QUALITY_P1 3.0\n            #define FXAA_QUALITY_P2 12.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 11)\n            #define FXAA_QUALITY_PS 4\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 3.0\n            #define FXAA_QUALITY_P3 12.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 12)\n            #define FXAA_QUALITY_PS 5\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 4.0\n            #define FXAA_QUALITY_P4 12.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 13)\n            #define FXAA_QUALITY_PS 6\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 4.0\n            #define FXAA_QUALITY_P5 12.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 14)\n            #define FXAA_QUALITY_PS 7\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 2.0\n            #define FXAA_QUALITY_P5 4.0\n            #define FXAA_QUALITY_P6 12.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 15)\n            #define FXAA_QUALITY_PS 8\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 2.0\n            #define FXAA_QUALITY_P5 2.0\n            #define FXAA_QUALITY_P6 4.0\n            #define FXAA_QUALITY_P7 12.0\n        #endif\n        \n        /*============================================================================\n                            FXAA QUALITY - LOW DITHER PRESETS\n        ============================================================================*/\n        #if (FXAA_QUALITY_PRESET == 20)\n            #define FXAA_QUALITY_PS 3\n            #define FXAA_QUALITY_P0 1.5\n            #define FXAA_QUALITY_P1 2.0\n            #define FXAA_QUALITY_P2 8.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 21)\n            #define FXAA_QUALITY_PS 4\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 8.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 22)\n            #define FXAA_QUALITY_PS 5\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 8.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 23)\n            #define FXAA_QUALITY_PS 6\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 2.0\n            #define FXAA_QUALITY_P5 8.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 24)\n            #define FXAA_QUALITY_PS 7\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 2.0\n            #define FXAA_QUALITY_P5 3.0\n            #define FXAA_QUALITY_P6 8.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 25)\n            #define FXAA_QUALITY_PS 8\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 2.0\n            #define FXAA_QUALITY_P5 2.0\n            #define FXAA_QUALITY_P6 4.0\n            #define FXAA_QUALITY_P7 8.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 26)\n            #define FXAA_QUALITY_PS 9\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 2.0\n            #define FXAA_QUALITY_P5 2.0\n            #define FXAA_QUALITY_P6 2.0\n            #define FXAA_QUALITY_P7 4.0\n            #define FXAA_QUALITY_P8 8.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 27)\n            #define FXAA_QUALITY_PS 10\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 2.0\n            #define FXAA_QUALITY_P5 2.0\n            #define FXAA_QUALITY_P6 2.0\n            #define FXAA_QUALITY_P7 2.0\n            #define FXAA_QUALITY_P8 4.0\n            #define FXAA_QUALITY_P9 8.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 28)\n            #define FXAA_QUALITY_PS 11\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 2.0\n            #define FXAA_QUALITY_P5 2.0\n            #define FXAA_QUALITY_P6 2.0\n            #define FXAA_QUALITY_P7 2.0\n            #define FXAA_QUALITY_P8 2.0\n            #define FXAA_QUALITY_P9 4.0\n            #define FXAA_QUALITY_P10 8.0\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PRESET == 29)\n            #define FXAA_QUALITY_PS 12\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.5\n            #define FXAA_QUALITY_P2 2.0\n            #define FXAA_QUALITY_P3 2.0\n            #define FXAA_QUALITY_P4 2.0\n            #define FXAA_QUALITY_P5 2.0\n            #define FXAA_QUALITY_P6 2.0\n            #define FXAA_QUALITY_P7 2.0\n            #define FXAA_QUALITY_P8 2.0\n            #define FXAA_QUALITY_P9 2.0\n            #define FXAA_QUALITY_P10 4.0\n            #define FXAA_QUALITY_P11 8.0\n        #endif\n        \n        /*============================================================================\n                            FXAA QUALITY - EXTREME QUALITY\n        ============================================================================*/\n        #if (FXAA_QUALITY_PRESET == 39)\n            #define FXAA_QUALITY_PS 12\n            #define FXAA_QUALITY_P0 1.0\n            #define FXAA_QUALITY_P1 1.0\n            #define FXAA_QUALITY_P2 1.0\n            #define FXAA_QUALITY_P3 1.0\n            #define FXAA_QUALITY_P4 1.0\n            #define FXAA_QUALITY_P5 1.5\n            #define FXAA_QUALITY_P6 2.0\n            #define FXAA_QUALITY_P7 2.0\n            #define FXAA_QUALITY_P8 2.0\n            #define FXAA_QUALITY_P9 2.0\n            #define FXAA_QUALITY_P10 4.0\n            #define FXAA_QUALITY_P11 8.0\n        #endif\n        \n        \n        \n        /*============================================================================\n        \n                                        API PORTING\n        \n        ============================================================================*/\n        #if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n            #define FxaaBool bool\n            #define FxaaDiscard discard\n            #define FxaaFloat float\n            #define FxaaFloat2 vec2\n            #define FxaaFloat3 vec3\n            #define FxaaFloat4 vec4\n            #define FxaaHalf float\n            #define FxaaHalf2 vec2\n            #define FxaaHalf3 vec3\n            #define FxaaHalf4 vec4\n            #define FxaaInt2 ivec2\n            #define FxaaSat(x) clamp(x, 0.0, 1.0)\n            #define FxaaTex sampler2D\n        #else\n            #define FxaaBool bool\n            #define FxaaDiscard clip(-1)\n            #define FxaaFloat float\n            #define FxaaFloat2 float2\n            #define FxaaFloat3 float3\n            #define FxaaFloat4 float4\n            #define FxaaHalf half\n            #define FxaaHalf2 half2\n            #define FxaaHalf3 half3\n            #define FxaaHalf4 half4\n            #define FxaaSat(x) saturate(x)\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_GLSL_100 == 1)\n        #define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n        #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_GLSL_120 == 1)\n            // Requires,\n            //  #version 120\n            // And at least,\n            //  #extension GL_EXT_gpu_shader4 : enable\n            //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n            #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n            #if (FXAA_FAST_PIXEL_OFFSET == 1)\n                #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n            #else\n                #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n            #endif\n            #if (FXAA_GATHER4_ALPHA == 1)\n                // use #extension GL_ARB_gpu_shader5 : enable\n                #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n                #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n                #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n                #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n            #endif\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_GLSL_130 == 1)\n            // Requires '#version 130' or better\n            #define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n            #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n            #if (FXAA_GATHER4_ALPHA == 1)\n                // use #extension GL_ARB_gpu_shader5 : enable\n                #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n                #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n                #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n                #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n            #endif\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_HLSL_3 == 1)\n            #define FxaaInt2 float2\n            #define FxaaTex sampler2D\n            #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n            #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_HLSL_4 == 1)\n            #define FxaaInt2 int2\n            struct FxaaTex { SamplerState smpl; Texture2D tex; };\n            #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n            #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n        #endif\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_HLSL_5 == 1)\n            #define FxaaInt2 int2\n            struct FxaaTex { SamplerState smpl; Texture2D tex; };\n            #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n            #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n            #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n            #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n            #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n            #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n        #endif\n        \n        \n        /*============================================================================\n                        GREEN AS LUMA OPTION SUPPORT FUNCTION\n        ============================================================================*/\n        #if (FXAA_GREEN_AS_LUMA == 0)\n            FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n        #else\n            FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n        #endif\n        \n        \n        \n        \n        /*============================================================================\n        \n                                    FXAA3 QUALITY - PC\n        \n        ============================================================================*/\n        #if (FXAA_PC == 1)\n        /*--------------------------------------------------------------------------*/\n        FxaaFloat4 FxaaPixelShader(\n            //\n            // Use noperspective interpolation here (turn off perspective interpolation).\n            // {xy} = center of pixel\n            FxaaFloat2 pos,\n            //\n            // Used only for FXAA Console, and not used on the 360 version.\n            // Use noperspective interpolation here (turn off perspective interpolation).\n            // {xy_} = upper left of pixel\n            // {_zw} = lower right of pixel\n            FxaaFloat4 fxaaConsolePosPos,\n            //\n            // Input color texture.\n            // {rgb_} = color in linear or perceptual color space\n            // if (FXAA_GREEN_AS_LUMA == 0)\n            //     {__a} = luma in perceptual color space (not linear)\n            FxaaTex tex,\n            //\n            // Only used on the optimized 360 version of FXAA Console.\n            // For everything but 360, just use the same input here as for 'tex'.\n            // For 360, same diffuseMap, just alias with a 2nd sampler.\n            // This sampler needs to have an exponent bias of -1.\n            FxaaTex fxaaConsole360TexExpBiasNegOne,\n            //\n            // Only used on the optimized 360 version of FXAA Console.\n            // For everything but 360, just use the same input here as for 'tex'.\n            // For 360, same diffuseMap, just alias with a 3nd sampler.\n            // This sampler needs to have an exponent bias of -2.\n            FxaaTex fxaaConsole360TexExpBiasNegTwo,\n            //\n            // Only used on FXAA Quality.\n            // This must be from a constant/uniform.\n            // {x_} = 1.0/screenWidthInPixels\n            // {_y} = 1.0/screenHeightInPixels\n            FxaaFloat2 fxaaQualityRcpFrame,\n            //\n            // Only used on FXAA Console.\n            // This must be from a constant/uniform.\n            // This effects sub-pixel AA quality and inversely sharpness.\n            //   Where N ranges between,\n            //     N = 0.50 (default)\n            //     N = 0.33 (sharper)\n            // {x__} = -N/screenWidthInPixels\n            // {_y_} = -N/screenHeightInPixels\n            // {_z_} =  N/screenWidthInPixels\n            // {__w} =  N/screenHeightInPixels\n            FxaaFloat4 fxaaConsoleRcpFrameOpt,\n            //\n            // Only used on FXAA Console.\n            // Not used on 360, but used on PS3 and PC.\n            // This must be from a constant/uniform.\n            // {x__} = -2.0/screenWidthInPixels\n            // {_y_} = -2.0/screenHeightInPixels\n            // {_z_} =  2.0/screenWidthInPixels\n            // {__w} =  2.0/screenHeightInPixels\n            FxaaFloat4 fxaaConsoleRcpFrameOpt2,\n            //\n            // Only used on FXAA Console.\n            // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n            // This must be from a constant/uniform.\n            // {x__} =  8.0/screenWidthInPixels\n            // {_y_} =  8.0/screenHeightInPixels\n            // {_z_} = -4.0/screenWidthInPixels\n            // {__w} = -4.0/screenHeightInPixels\n            FxaaFloat4 fxaaConsole360RcpFrameOpt2,\n            //\n            // Only used on FXAA Quality.\n            // This used to be the FXAA_QUALITY_SUBPIX define.\n            // It is here now to allow easier tuning.\n            // Choose the amount of sub-pixel aliasing removal.\n            // This can effect sharpness.\n            //   1.00 - upper limit (softer)\n            //   0.75 - default amount of filtering\n            //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n            //   0.25 - almost off\n            //   0.00 - completely off\n            FxaaFloat fxaaQualitySubpix,\n            //\n            // Only used on FXAA Quality.\n            // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n            // It is here now to allow easier tuning.\n            // The minimum amount of local contrast required to apply algorithm.\n            //   0.333 - too little (faster)\n            //   0.250 - low quality\n            //   0.166 - default\n            //   0.125 - high quality\n            //   0.063 - overkill (slower)\n            FxaaFloat fxaaQualityEdgeThreshold,\n            //\n            // Only used on FXAA Quality.\n            // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n            // It is here now to allow easier tuning.\n            // Trims the algorithm from processing darks.\n            //   0.0833 - upper limit (default, the start of visible unfiltered edges)\n            //   0.0625 - high quality (faster)\n            //   0.0312 - visible limit (slower)\n            // Special notes when using FXAA_GREEN_AS_LUMA,\n            //   Likely want to set this to zero.\n            //   As colors that are mostly not-green\n            //   will appear very dark in the green channel!\n            //   Tune by looking at mostly non-green content,\n            //   then start at zero and increase until aliasing is a problem.\n            FxaaFloat fxaaQualityEdgeThresholdMin,\n            //\n            // Only used on FXAA Console.\n            // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n            // It is here now to allow easier tuning.\n            // This does not effect PS3, as this needs to be compiled in.\n            //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n            //   Due to the PS3 being ALU bound,\n            //   there are only three safe values here: 2 and 4 and 8.\n            //   These options use the shaders ability to a free *|/ by 2|4|8.\n            // For all other platforms can be a non-power of two.\n            //   8.0 is sharper (default!!!)\n            //   4.0 is softer\n            //   2.0 is really soft (good only for vector graphics inputs)\n            FxaaFloat fxaaConsoleEdgeSharpness,\n            //\n            // Only used on FXAA Console.\n            // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n            // It is here now to allow easier tuning.\n            // This does not effect PS3, as this needs to be compiled in.\n            //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n            //   Due to the PS3 being ALU bound,\n            //   there are only two safe values here: 1/4 and 1/8.\n            //   These options use the shaders ability to a free *|/ by 2|4|8.\n            // The console setting has a different mapping than the quality setting.\n            // Other platforms can use other values.\n            //   0.125 leaves less aliasing, but is softer (default!!!)\n            //   0.25 leaves more aliasing, and is sharper\n            FxaaFloat fxaaConsoleEdgeThreshold,\n            //\n            // Only used on FXAA Console.\n            // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n            // It is here now to allow easier tuning.\n            // Trims the algorithm from processing darks.\n            // The console setting has a different mapping than the quality setting.\n            // This only applies when FXAA_EARLY_EXIT is 1.\n            // This does not apply to PS3,\n            // PS3 was simplified to avoid more shader instructions.\n            //   0.06 - faster but more aliasing in darks\n            //   0.05 - default\n            //   0.04 - slower and less aliasing in darks\n            // Special notes when using FXAA_GREEN_AS_LUMA,\n            //   Likely want to set this to zero.\n            //   As colors that are mostly not-green\n            //   will appear very dark in the green channel!\n            //   Tune by looking at mostly non-green content,\n            //   then start at zero and increase until aliasing is a problem.\n            FxaaFloat fxaaConsoleEdgeThresholdMin,\n            //\n            // Extra constants for 360 FXAA Console only.\n            // Use zeros or anything else for other platforms.\n            // These must be in physical constant registers and NOT immedates.\n            // Immedates will result in compiler un-optimizing.\n            // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n            FxaaFloat4 fxaaConsole360ConstDir\n        ) {\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat2 posM;\n            posM.x = pos.x;\n            posM.y = pos.y;\n            #if (FXAA_GATHER4_ALPHA == 1)\n                #if (FXAA_DISCARD == 0)\n                    FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n                    #if (FXAA_GREEN_AS_LUMA == 0)\n                        #define lumaM rgbyM.w\n                    #else\n                        #define lumaM rgbyM.y\n                    #endif\n                #endif\n                #if (FXAA_GREEN_AS_LUMA == 0)\n                    FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n                    FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n                #else\n                    FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n                    FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n                #endif\n                #if (FXAA_DISCARD == 1)\n                    #define lumaM luma4A.w\n                #endif\n                #define lumaE luma4A.z\n                #define lumaS luma4A.x\n                #define lumaSE luma4A.y\n                #define lumaNW luma4B.w\n                #define lumaN luma4B.z\n                #define lumaW luma4B.x\n            #else\n                FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n                #if (FXAA_GREEN_AS_LUMA == 0)\n                    #define lumaM rgbyM.w\n                #else\n                    #define lumaM rgbyM.y\n                #endif\n                #if (FXAA_GLSL_100 == 1)\n                FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n                #else\n                FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n                #endif\n            #endif\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat maxSM = max(lumaS, lumaM);\n            FxaaFloat minSM = min(lumaS, lumaM);\n            FxaaFloat maxESM = max(lumaE, maxSM);\n            FxaaFloat minESM = min(lumaE, minSM);\n            FxaaFloat maxWN = max(lumaN, lumaW);\n            FxaaFloat minWN = min(lumaN, lumaW);\n            FxaaFloat rangeMax = max(maxWN, maxESM);\n            FxaaFloat rangeMin = min(minWN, minESM);\n            FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n            FxaaFloat range = rangeMax - rangeMin;\n            FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n            FxaaBool earlyExit = range < rangeMaxClamped;\n        /*--------------------------------------------------------------------------*/\n            if(earlyExit)\n                #if (FXAA_DISCARD == 1)\n                    FxaaDiscard;\n                #else\n                    return rgbyM;\n                #endif\n        /*--------------------------------------------------------------------------*/\n            #if (FXAA_GATHER4_ALPHA == 0)\n                #if (FXAA_GLSL_100 == 1)\n                FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n                #else\n                FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n                #endif\n            #else\n                FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n                FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n            #endif\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat lumaNS = lumaN + lumaS;\n            FxaaFloat lumaWE = lumaW + lumaE;\n            FxaaFloat subpixRcpRange = 1.0/range;\n            FxaaFloat subpixNSWE = lumaNS + lumaWE;\n            FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n            FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat lumaNESE = lumaNE + lumaSE;\n            FxaaFloat lumaNWNE = lumaNW + lumaNE;\n            FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n            FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat lumaNWSW = lumaNW + lumaSW;\n            FxaaFloat lumaSWSE = lumaSW + lumaSE;\n            FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n            FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n            FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n            FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n            FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n            FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n            FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n            FxaaBool horzSpan = edgeHorz >= edgeVert;\n            FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n        /*--------------------------------------------------------------------------*/\n            if(!horzSpan) lumaN = lumaW;\n            if(!horzSpan) lumaS = lumaE;\n            if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n            FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat gradientN = lumaN - lumaM;\n            FxaaFloat gradientS = lumaS - lumaM;\n            FxaaFloat lumaNN = lumaN + lumaM;\n            FxaaFloat lumaSS = lumaS + lumaM;\n            FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n            FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n            if(pairN) lengthSign = -lengthSign;\n            FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat2 posB;\n            posB.x = posM.x;\n            posB.y = posM.y;\n            FxaaFloat2 offNP;\n            offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n            offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n            if(!horzSpan) posB.x += lengthSign * 0.5;\n            if( horzSpan) posB.y += lengthSign * 0.5;\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat2 posN;\n            posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n            posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n            FxaaFloat2 posP;\n            posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n            posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n            FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n            FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n            FxaaFloat subpixE = subpixC * subpixC;\n            FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n        /*--------------------------------------------------------------------------*/\n            if(!pairN) lumaNN = lumaSS;\n            FxaaFloat gradientScaled = gradient * 1.0/4.0;\n            FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n            FxaaFloat subpixF = subpixD * subpixE;\n            FxaaBool lumaMLTZero = lumaMM < 0.0;\n        /*--------------------------------------------------------------------------*/\n            lumaEndN -= lumaNN * 0.5;\n            lumaEndP -= lumaNN * 0.5;\n            FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n            FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n            FxaaBool doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n        /*--------------------------------------------------------------------------*/\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n        /*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 3)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n        /*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 4)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n        /*--------------------------------------------------------------------------*/\n                        #if (FXAA_QUALITY_PS > 5)\n                        if(doneNP) {\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n                            doneNP = (!doneN) || (!doneP);\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n        /*--------------------------------------------------------------------------*/\n                            #if (FXAA_QUALITY_PS > 6)\n                            if(doneNP) {\n                                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                                doneN = abs(lumaEndN) >= gradientScaled;\n                                doneP = abs(lumaEndP) >= gradientScaled;\n                                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n                                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n                                doneNP = (!doneN) || (!doneP);\n                                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n                                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n        /*--------------------------------------------------------------------------*/\n                                #if (FXAA_QUALITY_PS > 7)\n                                if(doneNP) {\n                                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                                    doneN = abs(lumaEndN) >= gradientScaled;\n                                    doneP = abs(lumaEndP) >= gradientScaled;\n                                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n                                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n                                    doneNP = (!doneN) || (!doneP);\n                                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n                                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n        /*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 8)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n        /*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 9)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n        /*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 10)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n        /*--------------------------------------------------------------------------*/\n                        #if (FXAA_QUALITY_PS > 11)\n                        if(doneNP) {\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n                            doneNP = (!doneN) || (!doneP);\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n        /*--------------------------------------------------------------------------*/\n                            #if (FXAA_QUALITY_PS > 12)\n                            if(doneNP) {\n                                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                                doneN = abs(lumaEndN) >= gradientScaled;\n                                doneP = abs(lumaEndP) >= gradientScaled;\n                                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n                                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n                                doneNP = (!doneN) || (!doneP);\n                                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n                                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n        /*--------------------------------------------------------------------------*/\n                            }\n                            #endif\n        /*--------------------------------------------------------------------------*/\n                        }\n                        #endif\n        /*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n        /*--------------------------------------------------------------------------*/\n                }\n                #endif\n        /*--------------------------------------------------------------------------*/\n            }\n            #endif\n        /*--------------------------------------------------------------------------*/\n                                }\n                                #endif\n        /*--------------------------------------------------------------------------*/\n                            }\n                            #endif\n        /*--------------------------------------------------------------------------*/\n                        }\n                        #endif\n        /*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n        /*--------------------------------------------------------------------------*/\n                }\n                #endif\n        /*--------------------------------------------------------------------------*/\n            }\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat dstN = posM.x - posN.x;\n            FxaaFloat dstP = posP.x - posM.x;\n            if(!horzSpan) dstN = posM.y - posN.y;\n            if(!horzSpan) dstP = posP.y - posM.y;\n        /*--------------------------------------------------------------------------*/\n            FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n            FxaaFloat spanLength = (dstP + dstN);\n            FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n            FxaaFloat spanLengthRcp = 1.0/spanLength;\n        /*--------------------------------------------------------------------------*/\n            FxaaBool directionN = dstN < dstP;\n            FxaaFloat dst = min(dstN, dstP);\n            FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n            FxaaFloat subpixG = subpixF * subpixF;\n            FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n            FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n        /*--------------------------------------------------------------------------*/\n            FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n            FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n            if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n            if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n            #if (FXAA_DISCARD == 1)\n                return FxaaTexTop(tex, posM);\n            #else\n                return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n            #endif\n        }\n        /*==========================================================================*/\n        #endif\n        \n        void main() {\n        gl_FragColor = FxaaPixelShader(\n            v_Uv,\n            vec4(0.0),\n            tDiffuse,\n            tDiffuse,\n            tDiffuse,\n            resolution,\n            vec4(0.0),\n            vec4(0.0),\n            vec4(0.0),\n            0.75,\n            0.166,\n            0.0833,\n            0.0,\n            0.0,\n            0.0,\n            vec4(0.0)\n        );\n        \n        // TODO avoid querying texture twice for same texel\n        gl_FragColor.a = texture2D(tDiffuse, v_Uv).a;\n        }\n    "};class dy extends jv{constructor(){super(),this.bufferDependencies=[{key:"GBuffer"}],this._ssaoPass=new Ap(xy),this.radius=.5,this.power=1,this.bias=.1,this.intensity=1,this.autoSampleWeight=!1,this.quality="Medium",this._kernelCode="",this._kernelSize=-1,this._setNoiseSize(64),this._setKernelSize(16),this._blurPass=new Ap(Gv),this._blurPass.material.defines.NORMALTEX_ENABLED=1,this._blurPass.material.defines.DEPTHTEX_ENABLED=1,this.blurSize=1,this.depthRange=1,this._blendPass=new Ap(Hv),this._blendPass.material.premultipliedAlpha=!0}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(0),s=t._renderTargetCache.allocate(0),o=t.getBuffer("GBuffer"),l=o.getCurrentRenderStates();py.copy(l.camera.projectionMatrix),fy.copy(l.camera.projectionMatrix).inverse(),my.copy(l.camera.viewMatrix).inverse().transpose(),e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(1,1,1,1),e.renderPass.clear(!0,!0,!1),this._ssaoPass.uniforms.normalTex=o.output()._attachments[Zc.COLOR_ATTACHMENT0],this._ssaoPass.uniforms.depthTex=o.output()._attachments[Zc.DEPTH_STENCIL_ATTACHMENT],this._ssaoPass.uniforms.texSize[0]=o.output().width,this._ssaoPass.uniforms.texSize[1]=o.output().height,py.toArray(this._ssaoPass.uniforms.projection),fy.toArray(this._ssaoPass.uniforms.projectionInv),my.toArray(this._ssaoPass.uniforms.viewInverseTranspose),this._setKernelSize(gy[this.quality]),this._ssaoPass.uniforms.radius=this.radius,this._ssaoPass.uniforms.power=this.power,this._ssaoPass.uniforms.bias=this.bias,this._ssaoPass.uniforms.intensity=this.intensity,this._ssaoPass.material.defines.AUTO_SAMPLE_WEIGHT!=this.autoSampleWeight&&(this._ssaoPass.material.needsUpdate=!0,this._ssaoPass.material.defines.AUTO_SAMPLE_WEIGHT=this.autoSampleWeight),this._ssaoPass.render(e),e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.normalTex=o.output()._attachments[Zc.COLOR_ATTACHMENT0],this._blurPass.uniforms.depthTex=o.output()._attachments[Zc.DEPTH_STENCIL_ATTACHMENT],this._blurPass.uniforms.textureSize[0]=o.output().width,this._blurPass.uniforms.textureSize[1]=o.output().height,py.toArray(this._blurPass.uniforms.projection),my.toArray(this._blurPass.uniforms.viewInverseTranspose),this._blurPass.uniforms.blurSize=this.blurSize,this._blurPass.uniforms.depthRange=this.depthRange,this._blurPass.uniforms.direction=0,this._blurPass.uniforms.tDiffuse=a.texture,this._blurPass.render(e),e.renderPass.setRenderTarget(r?a:n),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.direction=1,this._blurPass.uniforms.tDiffuse=s.texture,this._blurPass.render(e),r&&(e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=a.texture,i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1))),t._renderTargetCache.release(a,0),t._renderTargetCache.release(s,0)}dispose(){this._ssaoPass.dispose(),this._blurPass.dispose(),this._blendPass.dispose()}_setKernelSize(e,t=0){const r=e+"_"+t;this._kernelCode!==r&&(this._kernelCode=r,vy[r]||(vy[r]=function(e,t=0){const r=new Float32Array(3*e);for(let n=0;n<e;n++){const e=_y(n+t,2)*Math.PI*2,i=1-(.85*_y(n+t,3)+.15),a=Math.sqrt(1-i*i),s=Math.random(),o=Math.cos(e)*a*s,l=Math.sin(e)*a*s,u=i*s;r[3*n]=o,r[3*n+1]=l,r[3*n+2]=u}return r}(e,t*e)),this._ssaoPass.uniforms.kernel=vy[r],this._ssaoPass.material.defines.KERNEL_SIZE=e,this._ssaoPass.material.needsUpdate=!0)}_setNoiseSize(e){if(this._noiseSize===e)return;this._noiseSize=e;const t=this._ssaoPass.uniforms;t.noiseTex?(t.noiseTex.image.data=yy(e),t.noiseTex.image.width=e,t.noiseTex.image.height=e,t.noiseTex.version++):t.noiseTex=function(e){const t=new Bp;return t.image={data:yy(e),width:e,height:e},t.type=jc.UNSIGNED_BYTE,t.magFilter=Vc.NEAREST,t.minFilter=Vc.NEAREST,t.wrapS=Gc.REPEAT,t.wrapT=Gc.REPEAT,t.generateMipmaps=!1,t.flipY=!1,t.version++,t}(e),t.noiseTexSize[0]=e,t.noiseTexSize[1]=e}}const py=new Sc,fy=new Sc,my=new Sc,gy={Low:6,Medium:12,High:32,Ultra:64};function _y(e,t){let r=0,n=1/t,i=e;for(;i>0;)r+=n*(i%t),i=Math.floor(i/t),n/=t;return r}const vy={};function yy(e){const t=new Uint8Array(e*e*4);let r=0;const n=new bc;for(let i=0;i<e;i++)for(let i=0;i<e;i++)n.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),t[r++]=255*(.5*n.x+.5),t[r++]=255*(.5*n.y+.5),t[r++]=0,t[r++]=255;return t}const xy={name:"ec_ssao",defines:{ALCHEMY:!1,DEPTH_PACKING:0,KERNEL_SIZE:64,AUTO_SAMPLE_WEIGHT:!1},uniforms:{normalTex:null,depthTex:null,texSize:[512,512],noiseTex:null,noiseTexSize:[4,4],projection:new Float32Array(16),projectionInv:new Float32Array(16),viewInverseTranspose:new Float32Array(16),kernel:null,radius:.2,power:1,bias:1e-4,intensity:1},vertexShader:Vv,fragmentShader:"\n        #include <packing>\n\n        varying vec2 v_Uv;\n\n        uniform sampler2D normalTex;\n        uniform sampler2D depthTex;\n        uniform vec2 texSize;\n\n        uniform sampler2D noiseTex;\n        uniform vec2 noiseTexSize;\n\n        uniform mat4 projection;\n        uniform mat4 projectionInv;\n        uniform mat4 viewInverseTranspose;\n\n        uniform vec3 kernel[KERNEL_SIZE];\n\n        uniform float radius;\n        uniform float power;\n        uniform float bias;\n        uniform float intensity;\n\n        float getDepth(const in vec2 screenPosition) {\n            #if DEPTH_PACKING == 1\n                return unpackRGBAToDepth(texture2D(depthTex, screenPosition));\n            #else\n                return texture2D(depthTex, screenPosition).r;\n            #endif\n        }\n\n        vec3 getViewNormal(const in vec2 screenPosition) {\n            vec3 normal = texture2D(normalTex, screenPosition).xyz * 2.0 - 1.0;\n            // Convert to view space\n            return (viewInverseTranspose * vec4(normal, 0.0)).xyz;\n        }\n\n        float ssaoEstimator(in mat3 kernelBasis, in vec3 originPos, in vec3 N) {\n            float occlusion = 0.0;\n\n\t\t\tfloat allWeight = 0.0;\n\n            for (int i = 0; i < KERNEL_SIZE; i++) {\n                vec3 samplePos = kernel[i];\n                samplePos = kernelBasis * samplePos;\n                samplePos = samplePos * radius + originPos;\n\n                vec4 texCoord = projection * vec4(samplePos, 1.0);\n                texCoord.xy /= texCoord.w;\n                texCoord.xy = texCoord.xy * 0.5 + 0.5;\n\n                float sampleDepth = getDepth(texCoord.xy);\n                float z = sampleDepth * 2.0 - 1.0;\n\n\t\t\t\tvec4 projectedPos = vec4(texCoord.xy * 2.0 - 1.0, z, 1.0);\n\t\t\t\tvec4 p4 = projectionInv * projectedPos;\n\t\t\t\tp4.xyz /= p4.w;\n\n                #ifdef ALCHEMY\n                    vec3 cDir = p4.xyz - originPos;\n\n                    float vv = dot(cDir, cDir);\n                    float vn = dot(cDir, N);\n\n                    float radius2 = radius * radius;\n                    vn = max(vn + p4.z * bias, 0.0);\n                    float f = max(radius2 - vv, 0.0) / radius2;\n                    occlusion += f * f * f * max(vn / (0.01 + vv), 0.0);\n\n\t\t\t\t\tallWeight += 1.0;\n                #else\n\t\t\t\t\tfloat factor = step(samplePos.z, p4.z - bias);\n\t\t\t\t\tfloat rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - p4.z));\n\n\t\t\t\t\t#ifdef AUTO_SAMPLE_WEIGHT\n\t\t\t\t\t\tfloat weight = smoothstep(0., radius, radius - length(originPos.xy - samplePos.xy));\n\t\t\t\t\t#else\n\t\t\t\t\t\tfloat weight = 1.0;\n\t\t\t\t\t#endif\n\t\t\t\t\t\n\t\t\t\t\tocclusion += rangeCheck * factor * weight;\n\t\t\t\t\tallWeight += weight;\n                #endif\n            }\n\n            occlusion = 1.0 - occlusion / allWeight;\n\n            return pow(occlusion, power);\n        }\n\n        void main() {\n            float centerDepth = getDepth(v_Uv);\n            if(centerDepth >= (1.0 - EPSILON)) {\n                discard;\n            }\n\n            vec3 N = getViewNormal(v_Uv);\n\n            vec2 noiseTexCoord = texSize / vec2(noiseTexSize) * v_Uv;\n            vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;\n\n            // Tangent\n            vec3 T = normalize(rvec - N * dot(rvec, N));\n            // Bitangent\n            vec3 BT = normalize(cross(N, T));\n\n            mat3 kernelBasis = mat3(T, BT, N);\n\n            // view position\n            float z = centerDepth * 2.0 - 1.0;\n            vec4 projectedPos = vec4(v_Uv * 2.0 - 1.0, z, 1.0);\n            vec4 p4 = projectionInv * projectedPos;\n            vec3 position = p4.xyz / p4.w;\n\n            float ao = ssaoEstimator(kernelBasis, position, N);\n            ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);\n\n            gl_FragColor = vec4(vec3(ao), 1.0);\n        }\n    "};class by extends jv{constructor(){super(),this.bufferDependencies=[{key:"SceneBuffer"},{key:"GBuffer"}],this.pixelStride=8,this.maxIteration=5,this.maxSteps=50,this.maxRayDistance=200,this.enablePixelStrideZCutoff=!0,this.pixelStrideZCutoff=50,this.screenEdgeFadeStart=.9,this.eyeFadeStart=.99,this.eyeFadeEnd=1,this.minGlossiness=.2,this.strength=.2,this.mixType=0,this.blurSize=2,this.depthRange=1,this._ssrPass=new Ap(wy),this._blurPass=new Ap(Gv),this._blurPass.material.defines.NORMALTEX_ENABLED=1,this._blurPass.material.defines.DEPTHTEX_ENABLED=1,this._blendPass=new Ap(Cy),this._blendPass.material.premultipliedAlpha=!0}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(0),s=t._renderTargetCache.allocate(0),o=t.getBuffer("SceneBuffer"),l=t.getBuffer("GBuffer"),u=l.getCurrentRenderStates();Ay.copy(u.camera.projectionMatrix),Sy.copy(u.camera.projectionMatrix).inverse(),Ey.copy(u.camera.viewMatrix).inverse().transpose(),e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,1),e.renderPass.clear(!0,!0,!1),this._ssrPass.uniforms.colorTex=o.output()._attachments[Zc.COLOR_ATTACHMENT0],this._ssrPass.uniforms.gBufferTexture1=l.output()._attachments[Zc.COLOR_ATTACHMENT0],this._ssrPass.uniforms.gBufferTexture2=l.output()._attachments[Zc.DEPTH_STENCIL_ATTACHMENT],this._ssrPass.uniforms.viewportSize[0]=l.output().width,this._ssrPass.uniforms.viewportSize[1]=l.output().height,Ay.toArray(this._ssrPass.uniforms.projection),Sy.toArray(this._ssrPass.uniforms.projectionInv),Ey.toArray(this._ssrPass.uniforms.viewInverseTranspose),this._ssrPass.uniforms.pixelStride=this.pixelStride,this._ssrPass.uniforms.maxRayDistance=this.maxRayDistance,this._ssrPass.uniforms.enablePixelStrideZCutoff=this.enablePixelStrideZCutoff?1:0,this._ssrPass.uniforms.pixelStrideZCutoff=this.pixelStrideZCutoff,this._ssrPass.uniforms.screenEdgeFadeStart=this.screenEdgeFadeStart,this._ssrPass.uniforms.eyeFadeStart=this.eyeFadeStart,this._ssrPass.uniforms.eyeFadeEnd=this.eyeFadeEnd,this._ssrPass.uniforms.minGlossiness=this.minGlossiness,this._ssrPass.uniforms.nearZ=u.camera.near,this._ssrPass.material.defines.MAX_ITERATION==this.maxSteps&&this._ssrPass.material.defines.MAX_BINARY_SEARCH_ITERATION==this.maxIteration||(this._ssrPass.material.needsUpdate=!0,this._ssrPass.material.defines.MAX_ITERATION=this.maxSteps,this._ssrPass.material.defines.MAX_BINARY_SEARCH_ITERATION=this.maxIteration),this._ssrPass.render(e),e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.normalTex=l.output()._attachments[Zc.COLOR_ATTACHMENT0],this._blurPass.uniforms.depthTex=l.output()._attachments[Zc.DEPTH_STENCIL_ATTACHMENT],this._blurPass.uniforms.textureSize[0]=l.output().width,this._blurPass.uniforms.textureSize[1]=l.output().height,Ay.toArray(this._blurPass.uniforms.projection),Ey.toArray(this._blurPass.uniforms.viewInverseTranspose),this._blurPass.uniforms.blurSize=this.blurSize,this._blurPass.uniforms.depthRange=this.depthRange,this._blurPass.uniforms.direction=0,this._blurPass.uniforms.tDiffuse=a.texture,this._blurPass.render(e),e.renderPass.setRenderTarget(r?a:n),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.direction=1,this._blurPass.uniforms.tDiffuse=s.texture,this._blurPass.render(e),r&&(e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=a.texture,this._blendPass.uniforms.reflectivitySampler=l.output()._attachments[Zc.COLOR_ATTACHMENT0],this._blendPass.uniforms.reflectivityThreshold=this.minGlossiness,this._blendPass.uniforms.strength=this.strength,this._blendPass.material.defines.MIX_TYPE!==this.mixType&&(this._blendPass.material.needsUpdate=!0,this._blendPass.material.defines.MIX_TYPE=this.mixType),i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1))),t._renderTargetCache.release(a,0),t._renderTargetCache.release(s,0)}dispose(){this._ssrPass.dispose(),this._blurPass.dispose(),this._blendPass.dispose()}}const Ay=new Sc,Sy=new Sc,Ey=new Sc,wy={name:"ec_ssr",defines:{MAX_ITERATION:50,MAX_BINARY_SEARCH_ITERATION:5},uniforms:{colorTex:null,gBufferTexture1:null,gBufferTexture2:null,projection:new Float32Array(16),projectionInv:new Float32Array(16),viewInverseTranspose:new Float32Array(16),pixelStride:8,maxRayDistance:200,enablePixelStrideZCutoff:1,pixelStrideZCutoff:50,screenEdgeFadeStart:.9,eyeFadeStart:.99,eyeFadeEnd:1,minGlossiness:.2,nearZ:.1,zThicknessThreshold:.1,jitterOffset:0,viewportSize:[512,512]},vertexShader:Vv,fragmentShader:"\n\t\tvarying vec2 v_Uv;\n\n\t\tuniform sampler2D colorTex;\n\t\tuniform sampler2D gBufferTexture1;\n\t\tuniform sampler2D gBufferTexture2;\n\n\t\tuniform mat4 projection;\n\t\tuniform mat4 projectionInv;\n\t\tuniform mat4 viewInverseTranspose;\n\n\t\tuniform float pixelStride;\n\n\t\tuniform float maxRayDistance;\n\n\t\tuniform float screenEdgeFadeStart;\n\t\n\t\tuniform float enablePixelStrideZCutoff;\n\t\tuniform float pixelStrideZCutoff;\n\n\t\tuniform float eyeFadeStart;\n\t\tuniform float eyeFadeEnd;\n\t\t\n\t\tuniform float minGlossiness;\n\t\tuniform float zThicknessThreshold;\n\t\tuniform float jitterOffset;\n\n\t\tuniform float nearZ;\n\t\tuniform vec2 viewportSize;\n\n\t\tfloat fetchDepth(sampler2D depthTexture, vec2 uv) {\n\t\t\tvec4 depthTexel = texture2D(depthTexture, uv);\n\t\t\treturn depthTexel.r * 2.0 - 1.0;\n\t\t}\n\n\t\tfloat linearDepth(float depth) {\n\t\t\treturn projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n\t\t}\n\n\t\tbool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel) {\n\t\t\t// Swap if bigger\n\t\t\tif (rayZFar > rayZNear) {\n\t\t\t\tfloat t = rayZFar; rayZFar = rayZNear; rayZNear = t;\n\t\t\t}\n\t\t\tfloat cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));\n\t\t\t// float cameraBackZ = linearDepth(fetchDepth(backDepthTex, hitPixel));\n\t\t\t// Cross z\n\t\t\treturn rayZFar <= cameraZ && rayZNear >= cameraZ - zThicknessThreshold;\n\t\t}\n\n\t\t// Trace a ray in screenspace from rayOrigin (in camera space) pointing in rayDir (in camera space)\n\t\t//\n\t\t// With perspective correct interpolation\n\t\t//\n\t\t// Returns true if the ray hits a pixel in the depth buffer\n\t\t// and outputs the hitPixel (in UV space), the hitPoint (in camera space) and the number\n\t\t// of iterations it took to get there.\n\t\t//\n\t\t// Based on Morgan McGuire & Mike Mara's GLSL implementation:\n\t\t// http://casual-effects.blogspot.com/2014/08/screen-space-ray-tracing.html\n\t\tbool traceScreenSpaceRay(vec3 rayOrigin, vec3 rayDir, float jitter, out vec2 hitPixel, out vec3 hitPoint, out float iterationCount) {\n\t\t\t// Clip to the near plane\n\t\t\tfloat rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) > -nearZ) ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;\n\n\t\t\tvec3 rayEnd = rayOrigin + rayDir * rayLength;\n\n\t\t\t// Project into homogeneous clip space\n\t\t\tvec4 H0 = projection * vec4(rayOrigin, 1.0);\n\t\t\tvec4 H1 = projection * vec4(rayEnd, 1.0);\n\n\t\t\tfloat k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\n\n\t\t\t// The interpolated homogeneous version of the camera space points\n\t\t\tvec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;\n\n\t\t\t// Screen space endpoints\n\t\t\t// PENDING viewportSize ?\n\t\t\tvec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;\n\t\t\tvec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;\n\n\t\t\t// If the line is degenerate, make it cover at least one pixel to avoid handling\n\t\t\t// zero-pixel extent as a special case later\n\t\t\tP1 += dot(P1 - P0, P1 - P0) < 0.0001 ? 0.01 : 0.0;\n\t\t\tvec2 delta = P1 - P0;\n\n\t\t\t// Permute so that the primary iteration is in x to collapse\n\t\t\t// all quadrant-specific DDA case later\n\t\t\tbool permute = false;\n\t\t\tif (abs(delta.x) < abs(delta.y)) {\n\t\t\t\t// More vertical line\n\t\t\t\tpermute = true;\n\t\t\t\tdelta = delta.yx;\n\t\t\t\tP0 = P0.yx;\n\t\t\t\tP1 = P1.yx;\n\t\t\t}\n\t\t\tfloat stepDir = sign(delta.x);\n\t\t\tfloat invdx = stepDir / delta.x;\n\n\t\t\t// Track the derivatives of Q and K\n\t\t\tvec3 dQ = (Q1 - Q0) * invdx;\n\t\t\tfloat dk = (k1 - k0) * invdx;\n\n\t\t\tvec2 dP = vec2(stepDir, delta.y * invdx);\n\n\t\t\t// Calculate pixel stride based on distance of ray origin from camera.\n\t\t\t// Since perspective means distant objects will be smaller in screen space\n\t\t\t// we can use this to have higher quality reflections for far away objects\n\t\t\t// while still using a large pixel stride for near objects (and increase performance)\n\t\t\t// this also helps mitigate artifacts on distant reflections when we use a large\n\t\t\t// pixel stride.\n\t\t\tfloat strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);\n\t\t\tfloat pixStride = mix(pixelStride, 1.0 + strideScaler * pixelStride, enablePixelStrideZCutoff);\n\n\t\t\t// Scale derivatives by the desired pixel stride and the offset the starting values by the jitter fraction\n\t\t\tdP *= pixStride; dQ *= pixStride; dk *= pixStride;\n\n\t\t\t// Track ray step and derivatives in a vec4 to parallelize\n\t\t\tvec4 pqk = vec4(P0, Q0.z, k0);\n\t\t\tvec4 dPQK = vec4(dP, dQ.z, dk);\n\n\t\t\tpqk += dPQK * jitter;\n\t\t\tfloat rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\t\t\tfloat rayZNear;\n\n\t\t\tbool intersect = false;\n\n\t\t\tvec2 texelSize = 1.0 / viewportSize;\n\n\t\t\titerationCount = 0.0;\n\t\t\tfloat end = P1.x * stepDir;\n\t\t\tfor (int i = 0; i < MAX_ITERATION; i++) {\n\t\t\t\tpqk += dPQK;\n\t\t\t\tif ((pqk.x * stepDir) >= end) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\trayZNear = rayZFar;\n\t\t\t\trayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\n\t\t\t\thitPixel = permute ? pqk.yx : pqk.xy;\n\t\t\t\thitPixel *= texelSize;\n\n\t\t\t\tintersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);\n\n\t\t\t\titerationCount += 1.0;\n\n\t\t\t\t// PENDING Right on all platforms?\n\t\t\t\tif (intersect) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Binary search refinement\n\t\t\t// FIXME If intersect in first iteration binary search may easily lead to the pixel of reflect object it self\n\t\t\tif (pixStride > 1.0 && intersect && iterationCount > 1.0) {\n\t\t\t\t// Roll back\n\t\t\t\tpqk -= dPQK;\n\t\t\t\tdPQK /= pixStride;\n\n\t\t\t\tfloat originalStride = pixStride * 0.5;\n\t\t\t\tfloat stride = originalStride;\n\n\t\t\t\trayZNear = pqk.z / pqk.w;\n\t\t\t\trayZFar = rayZNear;\n\n\t\t\t\tfor (int j = 0; j < MAX_BINARY_SEARCH_ITERATION; j++) {\n\t\t\t\t\tpqk += dPQK * stride;\n\t\t\t\t\trayZNear = rayZFar;\n\t\t\t\t\trayZFar = (dPQK.z * -0.5 + pqk.z) / (dPQK.w * -0.5 + pqk.w);\n\t\t\t\t\thitPixel = permute ? pqk.yx : pqk.xy;\n\t\t\t\t\thitPixel *= texelSize;\n\n\t\t\t\t\toriginalStride *= 0.5;\n\t\t\t\t\tstride = rayIntersectDepth(rayZNear, rayZFar, hitPixel) ? -originalStride : originalStride;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tQ0.xy += dQ.xy * iterationCount;\n\t\t\tQ0.z = pqk.z;\n\t\t\thitPoint = Q0 / pqk.w;\n\n\t\t\treturn intersect;\n\t\t}\n\n\t\tfloat calculateAlpha(float iterationCount, float reflectivity, vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir) {\n\t\t\tfloat alpha = clamp(reflectivity, 0.0, 1.0);\n\n\t\t\t// Fade ray hits that approach the maximum iterations\n\t\t\talpha *= 1.0 - (iterationCount / float(MAX_ITERATION));\n\n\t\t\t// Fade ray hits that approach the screen edge\n\t\t\tvec2 hitPixelNDC = hitPixel * 2.0 - 1.0;\n\t\t\tfloat maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));\n\t\t\talpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);\n\n\t\t\t// Fade ray hits base on how much they face the camera\n\t\t\tfloat _eyeFadeStart = eyeFadeStart;\n\t\t\tfloat _eyeFadeEnd = eyeFadeEnd;\n\t\t\tif (_eyeFadeStart > _eyeFadeEnd) {\n\t\t\t\tfloat tmp = _eyeFadeEnd;\n\t\t\t\t_eyeFadeEnd = _eyeFadeStart;\n\t\t\t\t_eyeFadeStart = tmp;\n\t\t\t}\n\t\t\tfloat eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);\n\t\t\talpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);\n\n\t\t\t// Fade ray hits based on distance from ray origin\n\t\t\talpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);\n\n\t\t\treturn alpha;\n\t\t}\n\t\tvoid main() {\n\t\t\tvec4 normalAndGloss = texture2D(gBufferTexture1, v_Uv);\n\n\t\t\tif (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat g = normalAndGloss.a;\n\t\t\tif (g <= minGlossiness) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat reflectivity = g;\n\n\t\t\tvec3 N = normalAndGloss.rgb * 2.0 - 1.0;\n\t\t\tN = normalize((viewInverseTranspose * vec4(N, 0.0)).xyz);\n\n\t\t\t// Position in view\n\t\t\tvec4 projectedPos = vec4(v_Uv * 2.0 - 1.0, fetchDepth(gBufferTexture2, v_Uv), 1.0);\n\t\t\tvec4 pos = projectionInv * projectedPos;\n\t\t\tvec3 rayOrigin = pos.xyz / pos.w;\n\n\t\t\tvec3 rayDir = normalize(reflect(normalize(rayOrigin), N));\n\t\t\tvec2 hitPixel;\n\t\t\tvec3 hitPoint;\n\t\t\tfloat iterationCount;\n\n\t\t\t// Get jitter\n\t\t\tvec2 uv2 = v_Uv * viewportSize;\n\t\t\tfloat jitter = fract((uv2.x + uv2.y) * 0.25);\n\n\t\t\tbool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);\n\t\t\t// Is empty\n\t\t\tif (!intersect) {\n\t\t\t\tdiscard;\n\t\t\t}\n\t\t\tfloat dist = distance(rayOrigin, hitPoint);\n\n\t\t\tfloat alpha = calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir) * float(intersect);\n\n\t\t\tvec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;\n\t\t\thitNormal = normalize((viewInverseTranspose * vec4(hitNormal, 0.0)).xyz);\n\n\t\t\t// Ignore the pixel not face the ray\n\t\t\t// TODO fadeout ?\n\t\t\t// PENDING Can be configured?\n\t\t\tif (dot(hitNormal, rayDir) >= 0.0) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tvec4 color = texture2D(colorTex, hitPixel);\n\t\t\tgl_FragColor = vec4(color.rgb * alpha, color.a);\n\t\t}\n    "},Cy={name:"ec_ssr_mix",defines:{MIX_TYPE:0},uniforms:{texture1:null,texture2:null,reflectivitySampler:null,strength:.15,reflectivityThreshold:.6,type:1},vertexShader:Vv,fragmentShader:"\n        uniform sampler2D texture1;\n        uniform sampler2D texture2;\n\t\tuniform sampler2D reflectivitySampler;\n\t\tuniform float reflectivityThreshold;\n\t\tuniform float strength;\n        varying vec2 v_Uv;\n        void main() {\n\t\t\t#if MIX_TYPE == 0\n\t\t\t\tvec4 texel1 = texture2D(texture1, v_Uv);\n\t\t\t\tvec4 texel2 = texture2D(texture2, v_Uv);\n\t\t\t\tvec3 color = texel1.rgb * 1.0 + texel2.rgb * 1.0 * strength;\n\t\t\t\tgl_FragColor = vec4(color, texel1.a);\n\t\t\t#else\n\t\t\t\tvec4 color = texture2D(texture1, v_Uv);\n\t\t\t\tvec4 SSR = texture2D(texture2, v_Uv);\n\t\t\t\tfloat reflectivity = texture(reflectivitySampler, v_Uv).a;\n\t\t\t\tif (reflectivity <= reflectivityThreshold) {\n\t\t\t\t\tgl_FragColor = color;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvec3 reflectionMultiplier = vec3(reflectivity * strength);\n\t\t\t\tvec3 colorMultiplier = 1.0-reflectionMultiplier;\n\t\t\t\tvec3 finalColor = (color.rgb*colorMultiplier)+(SSR.rgb*reflectionMultiplier);\n\t\t\t\tgl_FragColor =vec4(finalColor,color.a);\n\t\t\t#endif\n        }\n    "};class Ty extends jv{constructor(){super(),this.color=new Eh(0,0,0),this.offset=1,this._vignettingPass=new Ap(Dy),this._vignettingPass.material.premultipliedAlpha=!0}render(e,t,r,n,i){const a=this._vignettingPass;a.uniforms.tDiffuse=r.texture,this.color.toArray(a.uniforms.vignettingColor),a.uniforms.vignettingOffset=this.offset,e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),i&&(a.material.transparent=t._tempClearColor[3]<1||!t.clearColor,a.renderStates.camera.rect.fromArray(t._tempViewport)),a.render(e),i&&(a.material.transparent=!1,a.renderStates.camera.rect.set(0,0,1,1))}dispose(){this._vignettingPass.dispose()}}const Dy={name:"ec_vignetting_blend",defines:{},uniforms:{tDiffuse:null,vignettingColor:[0,0,0],vignettingOffset:1},vertexShader:Vv,fragmentShader:"\n\t\tuniform vec3 vignettingColor;\n\t\tuniform float vignettingOffset;\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        void main() {\n            vec4 color = texture2D(tDiffuse, v_Uv);\n            vec2 uv = (v_Uv - vec2(0.5)) * vec2(vignettingOffset);\n\t\t\tcolor.rgb = mix(color.rgb, vignettingColor, clamp(dot(uv, uv), 0.0, 1.0));\n\t\t\tgl_FragColor = color;\n        }\n    "};class My extends jv{constructor(){super(),this.offset=1,this._hBlurPass=new Ap(Zv),this._vBlurPass=new Ap(Jv),this._blendPass=new Ap(Py),this._blendPass.material.premultipliedAlpha=!0}resize(e,t){this._hBlurPass.uniforms.h=4/e,this._vBlurPass.uniforms.v=4/t}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(1),s=t._renderTargetCache.allocate(1),o=this._blendPass;e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._hBlurPass.uniforms.tDiffuse=r.texture,this._hBlurPass.render(e),e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._vBlurPass.uniforms.tDiffuse=a.texture,this._vBlurPass.render(e),o.uniforms.tDiffuse=r.texture,o.uniforms.blurOffset=this.offset,o.uniforms.blurTexture=s.texture,e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),i&&(o.material.transparent=t._tempClearColor[3]<1||!t.clearColor,o.renderStates.camera.rect.fromArray(t._tempViewport)),o.render(e),i&&(o.material.transparent=!1,o.renderStates.camera.rect.set(0,0,1,1)),t._renderTargetCache.release(a,1),t._renderTargetCache.release(s,1)}dispose(){this._hBlurPass.dispose(),this._vBlurPass.dispose(),this._blendPass.dispose()}}const Py={name:"ec_blur_blend",defines:{},uniforms:{tDiffuse:null,blurOffset:1,blurTexture:null},vertexShader:Vv,fragmentShader:"\n\t\tuniform float blurOffset;\n\n        uniform sampler2D blurTexture;\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        void main() {\n            vec4 color = texture2D(tDiffuse, v_Uv);\n            vec2 uv = (v_Uv - vec2(0.5)) * vec2(blurOffset);\n\n            vec3 color2 = texture2D(blurTexture, v_Uv).rgb;\n\n\t\t\tcolor.rgb = mix(color.rgb, color2, clamp(dot(uv, uv), 0.0, 1.0));\n\t\t\tgl_FragColor = color;\n        }\n    "};class Fy extends jv{constructor(){super(),this.bufferDependencies=[{key:"NonDepthMarkBuffer"}],this.color=new Eh(1,1,1),this.thickness=1,this.strength=1.5,this._downsamplerPass=new Ap(qv),this._edgeDetectionPass=new Ap(Ry),this._blurPass=new Ap(Yv),this._blendPass=new Ap(Ny),this._blendPass.material.premultipliedAlpha=!0}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(1),s=t._renderTargetCache.allocate(1),o=t.getBuffer("NonDepthMarkBuffer"),l=o.attachManager.getAttachIndex(this.name),u=o.attachManager.getChannelIndex(this.name);e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._downsamplerPass.uniforms.tDiffuse=o.output(l)._attachments[Zc.COLOR_ATTACHMENT0],this._downsamplerPass.render(e),e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._edgeDetectionPass.uniforms.tDiffuse=a.texture,this._edgeDetectionPass.uniforms.texSize[0]=a.width,this._edgeDetectionPass.uniforms.texSize[1]=a.height;for(let e=0;e<4;e++)this._edgeDetectionPass.uniforms.channelMask[e]=e===u?1:0;this.color.toArray(this._edgeDetectionPass.uniforms.edgeColor),this._edgeDetectionPass.render(e),e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.tDiffuse=s.texture,this._blurPass.uniforms.texSize[0]=s.width,this._blurPass.uniforms.texSize[1]=s.height,this._blurPass.uniforms.direction[0]=1,this._blurPass.uniforms.direction[1]=0,this._blurPass.uniforms.kernelRadius=this.thickness,this._blurPass.render(e),e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.tDiffuse=a.texture,this._blurPass.uniforms.direction[0]=0,this._blurPass.uniforms.direction[1]=1,this._blurPass.render(e),e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.colorTexture=r.texture,this._blendPass.uniforms.edgeTexture=s.texture,this._blendPass.uniforms.maskTexture=o.output(l)._attachments[Zc.COLOR_ATTACHMENT0],this._blendPass.uniforms.strength=this.strength;for(let e=0;e<4;e++)this._blendPass.uniforms.channelMask[e]=e===u?1:0;i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1)),t._renderTargetCache.release(a,1),t._renderTargetCache.release(s,1)}dispose(){this._downsamplerPass.dispose(),this._edgeDetectionPass.dispose(),this._blurPass.dispose(),this._blendPass.dispose()}}const Ry={name:"ec_outline_edge",defines:{},uniforms:{tDiffuse:null,texSize:[.5,.5],edgeColor:[1,1,1],channelMask:[1,0,0,0]},vertexShader:Vv,fragmentShader:"\n        uniform vec2 texSize;\n        uniform vec3 edgeColor;\n\n\t\tuniform vec4 channelMask;\n\n        uniform sampler2D tDiffuse;\n        varying vec2 v_Uv;\n\n        void main() {\n            vec2 invSize = 1.0 / texSize;\n\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\n\t\t\tfloat c1 = dot(texture2D(tDiffuse, v_Uv + uvOffset.xy), channelMask);\n\t\t\tfloat c2 = dot(texture2D(tDiffuse, v_Uv - uvOffset.xy), channelMask);\n\t\t\tfloat c3 = dot(texture2D(tDiffuse, v_Uv + uvOffset.yw), channelMask);\n\t\t\tfloat c4 = dot(texture2D(tDiffuse, v_Uv - uvOffset.yw), channelMask);\n\t\t\tfloat b1 = max(c1, c2);\n\t\t\tfloat b2 = max(c3, c4);\n\t\t\tfloat a = max(b1, b2);\n\t\t\tgl_FragColor = vec4(edgeColor, a);\n        }\n    "},Ny={name:"ec_outline_blend",defines:{},uniforms:{maskTexture:null,edgeTexture:null,colorTexture:null,strength:1,channelMask:[1,0,0,0]},vertexShader:Vv,fragmentShader:"\n        uniform sampler2D maskTexture;\n        uniform sampler2D edgeTexture;\n        uniform float strength;\n\n\t\tuniform vec4 channelMask;\n\n        uniform sampler2D colorTexture;\n        varying vec2 v_Uv;\n\n        void main() {\n            vec4 edgeColor = texture2D(edgeTexture, v_Uv);\n            vec4 maskColor = texture2D(maskTexture, v_Uv);\n\n            vec4 outlineColor = edgeColor * strength;\n\t\t\toutlineColor.a *= (1.0 - dot(maskColor, channelMask));\n\n            vec4 color = texture2D(colorTexture, v_Uv);\n\t\t\t\n            color.rgb = outlineColor.rgb * outlineColor.a + color.rgb * (1. - outlineColor.a);\n\t\t\tcolor.a = outlineColor.a + color.a * (1. - outlineColor.a);\n\n            gl_FragColor = color;\n        }\n    "};class By extends jv{constructor(){super(),this.bufferDependencies=[{key:"MarkBuffer"}],this.color=new Eh(1,1,1),this.strength=1.5,this.stride=5,this._channelPass=new Ap(Xv),this._blurXPass=new Ap(Iy),this._blurYPass=new Ap(Oy),this._blendPass=new Ap(ky),this._blendPass.material.premultipliedAlpha=!0}resize(e,t){this._blurXPass.uniforms.texSize[0]=e,this._blurXPass.uniforms.texSize[1]=t,this._blurYPass.uniforms.texSize[0]=e,this._blurYPass.uniforms.texSize[1]=t}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(0),s=t._renderTargetCache.allocate(0),o=t._renderTargetCache.allocate(0),l=t.getBuffer("MarkBuffer"),u=l.attachManager.getAttachIndex(this.name),c=l.attachManager.getChannelIndex(this.name);e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._channelPass.uniforms.tDiffuse=l.output(u)._attachments[Zc.COLOR_ATTACHMENT0];for(let e=0;e<4;e++)this._channelPass.uniforms.channelMask[e]=e===c?1:0;this._channelPass.render(e),e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurXPass.uniforms.tDiffuse=a.texture,this._blurXPass.uniforms.stride=this.stride,this._blurXPass.render(e),e.renderPass.setRenderTarget(o),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurYPass.uniforms.tDiffuse=a.texture,this._blurYPass.uniforms.blurX=s.texture,this._blurYPass.uniforms.stride=this.stride,this._blurYPass.uniforms.glowness=this.strength,this.color.toArray(this._blurYPass.uniforms.glowColor),this._blurYPass.render(e),e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=o.texture,i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1)),t._renderTargetCache.release(a,0),t._renderTargetCache.release(s,0),t._renderTargetCache.release(o,0)}dispose(){this._channelPass.dispose(),this._blurXPass.dispose(),this._blurYPass.dispose(),this._blendPass.dispose()}}const Iy={name:"ec_innerglow_x",defines:{},uniforms:{tDiffuse:null,texSize:[1,1],stride:10},vertexShader:Vv,fragmentShader:"\n\t\t#define WT9_0 1.0\n\t\t#define WT9_1 0.8\n\t\t#define WT9_2 0.6\n\t\t#define WT9_3 0.4\n\t\t#define WT9_4 0.2\n\t\t#define WT9_NORMALIZE 5.2\n\n\t\tvarying vec2 v_Uv;\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 texSize;\n\t\tuniform float stride;\n\n\t\tvoid main() {\n\t\t\tfloat texelIncrement = 0.25 * stride / texSize.x;\n\n\t\t\tfloat colour = texture2D(tDiffuse,vec2(v_Uv.x + texelIncrement, v_Uv.y)).x * (0.8 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 2.0 * texelIncrement, v_Uv.y)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 3.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 4.0 * texelIncrement, v_Uv.y)).x * (WT9_4 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y)).x * (WT9_0 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 1.0 * texelIncrement, v_Uv.y)).x * (WT9_1 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 2.0 * texelIncrement, v_Uv.y)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 3.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 4.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\n\t\t\ttexelIncrement = 0.5 * stride / texSize.x;\n\t\t\tcolour += texture2D(tDiffuse,vec2(v_Uv.x + texelIncrement, v_Uv.y)).x * (0.8 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 2.0 * texelIncrement, v_Uv.y)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 3.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 4.0 * texelIncrement, v_Uv.y)).x * (WT9_4 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y)).x * (WT9_0 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 1.0 * texelIncrement, v_Uv.y)).x * (WT9_1 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 2.0 * texelIncrement, v_Uv.y)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 3.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 4.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\n\t\t\ttexelIncrement = 0.75 * stride / texSize.x;\n\t\t\tcolour += texture2D(tDiffuse,vec2(v_Uv.x + texelIncrement, v_Uv.y)).x * (0.8 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 2.0 * texelIncrement, v_Uv.y)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 3.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 4.0 * texelIncrement, v_Uv.y)).x * (WT9_4 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y)).x * (WT9_0 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 1.0 * texelIncrement, v_Uv.y)).x * (WT9_1 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 2.0 * texelIncrement, v_Uv.y)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 3.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 4.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\n\t\t\ttexelIncrement = stride / texSize.x;\n\t\t\tcolour += texture2D(tDiffuse,vec2(v_Uv.x + texelIncrement, v_Uv.y)).x * (0.8 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 2.0 * texelIncrement, v_Uv.y)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 3.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x + 4.0 * texelIncrement, v_Uv.y)).x * (WT9_4 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x, v_Uv.y)).x * (WT9_0 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 1.0 * texelIncrement, v_Uv.y)).x * (WT9_1 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 2.0 * texelIncrement, v_Uv.y)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 3.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(tDiffuse, vec2(v_Uv.x - 4.0 * texelIncrement, v_Uv.y)).x * (WT9_3 / WT9_NORMALIZE);\n\n\t\t\tfloat col = 1.0 - colour * 0.25;\n\n\t\t\tgl_FragColor = vec4(col,col,col,col);\n\t\t}\n    "},Oy={name:"ec_innerglow_y",defines:{},uniforms:{tDiffuse:null,blurX:null,texSize:[1,1],stride:10,glowness:2,glowColor:[1,0,0]},vertexShader:Vv,fragmentShader:"\n\t\t#define WT9_0 1.0\n\t\t#define WT9_1 0.8\n\t\t#define WT9_2 0.6\n\t\t#define WT9_3 0.4\n\t\t#define WT9_4 0.2\n\t\t#define WT9_NORMALIZE 5.2\n\n\t\tvarying vec2 v_Uv;\n\t\tuniform vec2 texSize;\n\t\tuniform float stride;\n\t\tuniform float glowness;\n\t\tuniform vec3 glowColor;\n\t\tuniform sampler2D blurX;\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvoid main() {\n\t\t\tfloat texelIncrement = 0.25 * stride / texSize.y;\n\n\t\t\tfloat colour = texture2D(blurX, vec2(v_Uv.x , v_Uv.y + texelIncrement)).x * (0.8 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y + 2.0 * texelIncrement)).x* (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + 3.0 * texelIncrement)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + 4.0 * texelIncrement)).x * (WT9_4 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y)).x * (WT9_0 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y - 1.0 * texelIncrement)).x * (WT9_1 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y - 2.0 * texelIncrement)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y - 3.0 * texelIncrement)).x* (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y- 4.0 * texelIncrement)).x * (WT9_3 / WT9_NORMALIZE);\n\n\t\t\ttexelIncrement = 0.5 * stride / texSize.y;\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + texelIncrement)).x * (0.8 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y + 2.0 * texelIncrement)).x* (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + 3.0 * texelIncrement)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + 4.0 * texelIncrement)).x * (WT9_4 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y)).x * (WT9_0 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y - 1.0 * texelIncrement)).x * (WT9_1 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y - 2.0 * texelIncrement)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y - 3.0 * texelIncrement)).x* (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y- 4.0 * texelIncrement)).x * (WT9_3 / WT9_NORMALIZE);\n\n\t\t\ttexelIncrement = 0.75 * stride / texSize.y;\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + texelIncrement)).x * (0.8 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y + 2.0 * texelIncrement)).x* (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + 3.0 * texelIncrement)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + 4.0 * texelIncrement)).x * (WT9_4 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y)).x * (WT9_0 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y - 1.0 * texelIncrement)).x * (WT9_1 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y - 2.0 * texelIncrement)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y - 3.0 * texelIncrement)).x* (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y- 4.0 * texelIncrement)).x * (WT9_3 / WT9_NORMALIZE);\n\n\t\t\ttexelIncrement = stride / texSize.y;\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + texelIncrement)).x * (0.8 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y + 2.0 * texelIncrement)).x* (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + 3.0 * texelIncrement)).x * (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y + 4.0 * texelIncrement)).x * (WT9_4 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y)).x * (WT9_0 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y - 1.0 * texelIncrement)).x * (WT9_1 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y - 2.0 * texelIncrement)).x * (WT9_2 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x, v_Uv.y - 3.0 * texelIncrement)).x* (WT9_3 / WT9_NORMALIZE);\n\t\t\tcolour += texture2D(blurX, vec2(v_Uv.x , v_Uv.y- 4.0 * texelIncrement)).x * (WT9_3 / WT9_NORMALIZE);\n\n\t\t\tvec3 glo = (0.25 * glowness * colour) * glowColor;\n\t\t\tvec4 maskTexel = texture2D(tDiffuse, v_Uv);\n\t\t\t\n\t\t\tgl_FragColor = vec4(maskTexel.x * glo, 1.);\n\t\t}\n    "},ky={name:"ec_tint",defines:{},uniforms:{texture1:null,texture2:null},vertexShader:Vv,fragmentShader:"\n        uniform sampler2D texture1;\n        uniform sampler2D texture2;\n        varying vec2 v_Uv;\n        void main() {\n            vec4 texel1 = texture2D(texture1, v_Uv);\n            vec4 texel2 = texture2D(texture2, v_Uv);\n\n            float v = max(max(texel2.x, texel2.y), texel2.z);\n\n            vec4 color = mix(texel1, vec4(texel2.rgb, texel1.a), v);\n            gl_FragColor = color;\n        }\n    "};class Ly extends jv{constructor(){super(),this.bufferDependencies=[{key:"SceneBuffer"},{key:"MarkBuffer",mask:ey.OPAQUE},{key:"ColorMarkBuffer",mask:ey.TRANSPARENT}],this.strength=1,this.radius=.4,this.threshold=.01,this.smoothWidth=.1,this._maskPass=new Ap(Qv),this._highlightPass=new Ap(Kv),this._blurPass=new Ap(Yv),this._compositePass=new Ap(zy),this._blendPass=new Ap(Wv),this._blendPass.material.premultipliedAlpha=!0,this._compositePass.uniforms.bloomFactors=new Float32Array([1,.8,.6,.4,.2]),this._compositePass.uniforms.bloomTintColors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),this._tempRTList=[]}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(0),s=t._renderTargetCache.allocate(1),o=t.getBuffer("SceneBuffer"),l=t.getBuffer("MarkBuffer"),u=t.getBuffer("ColorMarkBuffer"),c=l.attachManager.has(this.name),h=u.attachManager.getAttachIndex(this.name),d=u.output(h)._attachments[Zc.COLOR_ATTACHMENT0];if(c){const t=l.attachManager.getAttachIndex(this.name),r=l.attachManager.getChannelIndex(this.name);e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._maskPass.uniforms.colorTexture=o.output()._attachments[Zc.COLOR_ATTACHMENT0],this._maskPass.uniforms.maskTexture=l.output(t)._attachments[Zc.COLOR_ATTACHMENT0],this._maskPass.uniforms.additiveTexture=d;for(let e=0;e<4;e++)this._maskPass.uniforms.channel[e]=e===r?1:0;this._maskPass.render(e)}e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._highlightPass.uniforms.tDiffuse=c?s.texture:d,this._highlightPass.uniforms.threshold=this.threshold,this._highlightPass.uniforms.smoothWidth=this.smoothWidth,this._highlightPass.render(e);let p=a;for(let r=0;r<Uy.length;r++){const n=t._renderTargetCache.allocate(r+1);e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.tDiffuse=p.texture,this._blurPass.uniforms.texSize[0]=p.width,this._blurPass.uniforms.texSize[1]=p.height,this._blurPass.uniforms.direction[0]=1,this._blurPass.uniforms.direction[1]=0,this._blurPass.uniforms.kernelRadius=Uy[r],this._blurPass.render(e);const i=t._renderTargetCache.allocate(r+1);e.renderPass.setRenderTarget(i),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.tDiffuse=n.texture,this._blurPass.uniforms.direction[0]=0,this._blurPass.uniforms.direction[1]=1,this._blurPass.render(e),t._renderTargetCache.release(n,r+1),p=i,this._tempRTList[r]=i}e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._compositePass.uniforms.blurTexture1=this._tempRTList[0].texture,this._compositePass.uniforms.blurTexture2=this._tempRTList[1].texture,this._compositePass.uniforms.blurTexture3=this._tempRTList[2].texture,this._compositePass.uniforms.blurTexture4=this._tempRTList[3].texture,this._compositePass.uniforms.blurTexture5=this._tempRTList[4].texture,this._compositePass.uniforms.bloomRadius=this.radius,this._compositePass.uniforms.bloomStrength=this.strength,this._compositePass.render(e),e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=s.texture,this._blendPass.uniforms.colorWeight1=1,this._blendPass.uniforms.alphaWeight1=1,this._blendPass.uniforms.colorWeight2=1,this._blendPass.uniforms.alphaWeight2=0,i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1)),t._renderTargetCache.release(a,0),t._renderTargetCache.release(s,1),this._tempRTList.forEach(((e,r)=>t._renderTargetCache.release(e,r+1)))}dispose(){this._maskPass.dispose(),this._highlightPass.dispose(),this._blurPass.dispose(),this._compositePass.dispose(),this._blendPass.dispose()}}const Uy=[3,5,7,9,11],zy={name:"ec_bloom_composite",defines:{NUM_MIPS:5},uniforms:{blurTexture1:null,blurTexture2:null,blurTexture3:null,blurTexture4:null,blurTexture5:null,bloomStrength:1,bloomRadius:0,bloomFactors:null,bloomTintColors:null},vertexShader:Vv,fragmentShader:"\n\t\tuniform sampler2D blurTexture1;\n\t\tuniform sampler2D blurTexture2;\n\t\tuniform sampler2D blurTexture3;\n\t\tuniform sampler2D blurTexture4;\n\t\tuniform sampler2D blurTexture5;\n\t\tuniform float bloomStrength;\n\t\tuniform float bloomRadius;\n\t\tuniform float bloomFactors[NUM_MIPS];\n\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n        varying vec2 v_Uv;\n\n        float lerpBloomFactor(const in float factor) {\n            float mirrorFactor = 1.2 - factor;\n            return mix(factor, mirrorFactor, bloomRadius);\n        }\n\n        void main() {\n            gl_FragColor = bloomStrength * (\n\t\t\t\tlerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, v_Uv) +\n\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, v_Uv) +\n\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, v_Uv) +\n\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, v_Uv) +\n\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, v_Uv)\n\t\t\t);\n        }\n    "};class jy extends jv{constructor(){super(),this.bufferDependencies=[{key:"SceneBuffer"},{key:"MarkBuffer",mask:ey.OPAQUE},{key:"ColorMarkBuffer",mask:ey.TRANSPARENT}],this.strength=.5,this.blendRate=.4,this.blurSize=1,this._maskPass=new Ap(Qv),this._downSamplerPass=new Ap(Vy),this._hBlurPass=new Ap(Zv),this._vBlurPass=new Ap(Jv),this._blendPass=new Ap(Wv),this._blendPass.material.premultipliedAlpha=!0,this._tempRTList=[],this._tempRTList2=[]}render(e,t,r,n,i){for(let e=0;e<6;e++)this._tempRTList[e]=t._renderTargetCache.allocate(e),this._tempRTList2[e]=t._renderTargetCache.allocate(e);const a=t.getBuffer("SceneBuffer"),s=t.getBuffer("MarkBuffer"),o=t.getBuffer("ColorMarkBuffer"),l=s.attachManager.has(this.name),u=o.attachManager.getAttachIndex(this.name),c=o.output(u)._attachments[Zc.COLOR_ATTACHMENT0];if(l){const t=s.attachManager.getAttachIndex(this.name),r=s.attachManager.getChannelIndex(this.name);e.renderPass.setRenderTarget(this._tempRTList[0]),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._maskPass.uniforms.colorTexture=a.output()._attachments[Zc.COLOR_ATTACHMENT0],this._maskPass.uniforms.maskTexture=s.output(t)._attachments[Zc.COLOR_ATTACHMENT0],this._maskPass.uniforms.additiveTexture=c;for(let e=0;e<4;e++)this._maskPass.uniforms.channel[e]=e===r?1:0;this._maskPass.render(e)}e.renderPass.setRenderTarget(this._tempRTList[1]),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._downSamplerPass.uniforms.tDiffuse=l?this._tempRTList[0].texture:c,this._downSamplerPass.uniforms.texSize[0]=this._tempRTList[0].width,this._downSamplerPass.uniforms.texSize[1]=this._tempRTList[0].height,this._downSamplerPass.uniforms.bright=4,this._downSamplerPass.render(e);for(let t=2;t<6;t++)e.renderPass.setRenderTarget(this._tempRTList[t]),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._downSamplerPass.uniforms.tDiffuse=this._tempRTList[t-1].texture,this._downSamplerPass.uniforms.texSize[0]=this._tempRTList[t-1].width,this._downSamplerPass.uniforms.texSize[1]=this._tempRTList[t-1].height,this._downSamplerPass.uniforms.bright=1,this._downSamplerPass.render(e);for(let t=0;t<5;t++)e.renderPass.setRenderTarget(this._tempRTList[t]),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._hBlurPass.uniforms.tDiffuse=this._tempRTList[t+1].texture,this._hBlurPass.uniforms.h=2*this.blurSize/this._tempRTList[t].width,this._hBlurPass.render(e);for(let t=0;t<5;t++)e.renderPass.setRenderTarget(this._tempRTList2[t]),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._vBlurPass.uniforms.tDiffuse=this._tempRTList[t].texture,this._vBlurPass.uniforms.v=2*this.blurSize/this._tempRTList[t].height,this._vBlurPass.render(e);for(let t=3;t>=0;t--)e.renderPass.setRenderTarget(this._tempRTList[t]),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=this._tempRTList2[t].texture,this._blendPass.uniforms.texture2=t<3?this._tempRTList[t+1].texture:this._tempRTList2[t+1].texture,this._blendPass.uniforms.colorWeight1=(1-this.blendRate)*this.strength,this._blendPass.uniforms.alphaWeight1=(1-this.blendRate)*this.strength,this._blendPass.uniforms.colorWeight2=this.blendRate*this.strength,this._blendPass.uniforms.alphaWeight2=this.blendRate*this.strength,this._blendPass.render(e);e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=this._tempRTList[0].texture,this._blendPass.uniforms.colorWeight1=1,this._blendPass.uniforms.alphaWeight1=1,this._blendPass.uniforms.colorWeight2=1,this._blendPass.uniforms.alphaWeight2=0,i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1)),this._tempRTList.forEach(((e,r)=>t._renderTargetCache.release(e,r))),this._tempRTList2.forEach(((e,r)=>t._renderTargetCache.release(e,r)))}dispose(){this._maskPass.dispose(),this._downSamplerPass.dispose(),this._hBlurPass.dispose(),this._vBlurPass.dispose(),this._blendPass.dispose()}}const Vy={name:"ec_sg_downsample",defines:{},uniforms:{tDiffuse:null,texSize:[512,512],bright:1},vertexShader:Vv,fragmentShader:"\n\t\tvarying vec2 v_Uv;\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 texSize;\n\t\n\t\tuniform float bright;\n\t\t\n\t\tvoid main() {\n    \t\tvec4 d = vec4(-1.0, -1.0, 1.0, 1.0) / texSize.xyxy;\n\t\t\tgl_FragColor = (texture2D(tDiffuse, v_Uv + d.xy) +\n\t\t\t\ttexture2D(tDiffuse, v_Uv + d.zy) +\n\t\t\t\ttexture2D(tDiffuse, v_Uv + d.xw) +\n\t\t\t\ttexture2D(tDiffuse, v_Uv + d.zw)) * bright * 0.25;\n\t\t}\n\t"};class Gy extends jv{constructor(){super(),this.bufferDependencies=[{key:"SceneBuffer"},{key:"MarkBuffer",mask:ey.OPAQUE},{key:"ColorMarkBuffer",mask:ey.TRANSPARENT}],this.center=new xh(.5,.5),this.direction=new xh(0,1),this.strength=1,this._maskPass=new Ap(Qv),this._tailingPass=new Ap(Wy),this._blendPass=new Ap(Wv),this._blendPass.material.premultipliedAlpha=!0}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(0),s=t._renderTargetCache.allocate(0),o=t.getBuffer("SceneBuffer"),l=t.getBuffer("MarkBuffer"),u=t.getBuffer("ColorMarkBuffer"),c=l.attachManager.has(this.name),h=u.attachManager.getAttachIndex(this.name),d=u.output(h)._attachments[Zc.COLOR_ATTACHMENT0];if(c){const t=l.attachManager.getAttachIndex(this.name),r=l.attachManager.getChannelIndex(this.name);e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._maskPass.uniforms.colorTexture=o.output()._attachments[Zc.COLOR_ATTACHMENT0],this._maskPass.uniforms.maskTexture=l.output(t)._attachments[Zc.COLOR_ATTACHMENT0],this._maskPass.uniforms.additiveTexture=d;for(let e=0;e<4;e++)this._maskPass.uniforms.channel[e]=e===r?1:0;this._maskPass.render(e)}e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._tailingPass.uniforms.blurMap=c?a.texture:d,this._tailingPass.uniforms.center[0]=this.center.x,this._tailingPass.uniforms.center[1]=this.center.y,this._tailingPass.uniforms.direction[0]=this.direction.x,this._tailingPass.uniforms.direction[1]=this.direction.y,this._tailingPass.uniforms.intensity=10*this.strength,this._tailingPass.render(e),e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=s.texture,this._blendPass.uniforms.colorWeight1=1,this._blendPass.uniforms.alphaWeight1=1,this._blendPass.uniforms.colorWeight2=1,this._blendPass.uniforms.alphaWeight2=0,i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1)),t._renderTargetCache.release(a,0),t._renderTargetCache.release(s,0)}dispose(){this._maskPass.dispose(),this._tailingPass.dispose(),this._blendPass.dispose()}}const Wy={name:"ec_tailing",defines:{},uniforms:{blurMap:null,blurStart:1,blurWidth:-.1,direction:[0,1],intensity:10,glowGamma:.8,center:[.5,.5]},vertexShader:Vv,fragmentShader:"\n\t\tvarying vec2 v_Uv;\n\t\tuniform sampler2D blurMap;\n\t\tuniform float blurStart;\n\t\tuniform float blurWidth;\n\t\tuniform vec2 direction;\n\t\tuniform float intensity;\n\t\tuniform float glowGamma;\n\t\tuniform vec2 center;\n\n\t\tvoid main() {\n\t\t\tvec2 texCoord = v_Uv;\n\t\t\tvec4 blurred = texture2D(blurMap, texCoord);\n\t\t\tvec2 resCoord = vec2(0.0);\n\n\t\t\tfor(float i = 0.0; i < 31.0; i++) {\n\t\t\t\tfloat scale = blurStart + blurWidth * ((31.0 - i) / (31.0 - 1.0));\n\t\t\t\tvec2 tmp = texCoord * scale;\n\t\t\t\tresCoord = mix(texCoord, tmp, direction);\n\t\t\t\tvec4 tmpc = texture2D(blurMap, resCoord) * (i / 31.0) * (i / 31.0);\n\t\t\t\tblurred += tmpc / 31.0;\n\t\t\t}\n\n\t\t\tblurred.r = pow(blurred.r, glowGamma);\n\t\t\tblurred.g = pow(blurred.g, glowGamma);\n\t\t\tblurred.b = pow(blurred.b, glowGamma);\n\t\t\tblurred.rgb *= intensity;\n\t\t\tblurred.rgb = clamp(blurred.rgb, 0.0, 1.0);\n\n\t\t\tvec4 origTex = texture2D(blurMap, texCoord);\n\t\t\tvec4 blurResult = origTex + blurred;\n\t\t\t// blurResult *= 2;\n\n\t\t\tvec2 dir = texCoord - center;\n\t\t\tfloat dist = sqrt(dir.x * dir.x + dir.y * dir.y);\n\t\t\tfloat t = dist * 1.0;\n\t\t\tt = clamp(t, 0.0, 1.0); // We need 0 <= t <= 1\n\n\t\t\tgl_FragColor = blurResult * t;\n\t\t}\n    "};class Hy extends jv{constructor(){super(),this.bufferDependencies=[{key:"SceneBuffer"},{key:"MarkBuffer",mask:ey.OPAQUE},{key:"ColorMarkBuffer",mask:ey.TRANSPARENT}],this.center=new xh(.5,.5),this.strength=1,this._maskPass=new Ap(Qv),this._radialTailingPass=new Ap(qy),this._blendPass=new Ap(Wv),this._blendPass.material.premultipliedAlpha=!0}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(0),s=t._renderTargetCache.allocate(0),o=t.getBuffer("SceneBuffer"),l=t.getBuffer("MarkBuffer"),u=t.getBuffer("ColorMarkBuffer"),c=l.attachManager.has(this.name),h=u.attachManager.getAttachIndex(this.name),d=u.output(h)._attachments[Zc.COLOR_ATTACHMENT0];if(c){const t=l.attachManager.getAttachIndex(this.name),r=l.attachManager.getChannelIndex(this.name);e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._maskPass.uniforms.colorTexture=o.output()._attachments[Zc.COLOR_ATTACHMENT0],this._maskPass.uniforms.maskTexture=l.output(t)._attachments[Zc.COLOR_ATTACHMENT0],this._maskPass.uniforms.additiveTexture=d;for(let e=0;e<4;e++)this._maskPass.uniforms.channel[e]=e===r?1:0;this._maskPass.render(e)}e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._radialTailingPass.uniforms.blurMap=c?a.texture:d,this._radialTailingPass.uniforms.center[0]=this.center.x,this._radialTailingPass.uniforms.center[1]=this.center.y,this._radialTailingPass.uniforms.intensity=10*this.strength,this._radialTailingPass.render(e),e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=s.texture,this._blendPass.uniforms.colorWeight1=1,this._blendPass.uniforms.alphaWeight1=1,this._blendPass.uniforms.colorWeight2=1,this._blendPass.uniforms.alphaWeight2=0,i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1)),t._renderTargetCache.release(a,0),t._renderTargetCache.release(s,0)}dispose(){this._maskPass.dispose(),this._radialTailingPass.dispose(),this._blendPass.dispose()}}const qy={name:"ec_radial_tailing",defines:{},uniforms:{blurMap:null,blurStart:1,blurWidth:-.1,intensity:10,glowGamma:.8,center:[.5,.5]},vertexShader:Vv,fragmentShader:"\n\t\tvarying vec2 v_Uv;\n\t\tuniform sampler2D blurMap;\n\t\tuniform float blurStart;\n\t\tuniform float blurWidth;\n\t\tuniform float intensity;\n\t\tuniform float glowGamma;\n\t\tuniform vec2 center;\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 texCoord = v_Uv;\n\t\t\tvec2 ctrPt = center;\n\t\t\tvec4 blurred = texture2D(blurMap, texCoord);\n\t\t\n\t\t\tfor(float i = 0.0; i < 31.0; i++) {\n\t\t\t\tfloat scale = blurStart + blurWidth * ((31.0 - i) / (31.0 - 1.0));\n\t\t\t\tvec2 tmp = (texCoord - ctrPt) * scale + ctrPt;\n\t\t\t\tvec4 tmpc = texture2D(blurMap, tmp) * (i / 31.0) * (i / 31.0);\n\t\t\n\t\t\t\tblurred += tmpc / 31.0;\n\t\t\t}\n\t\t\n\t\t\tblurred.r = pow(blurred.r, glowGamma);\n\t\t\tblurred.g = pow(blurred.g, glowGamma);\n\t\t\tblurred.b = pow(blurred.b, glowGamma);\n\t\t\tblurred.rgb *= intensity;\n\t\t\tblurred.rgb = clamp(blurred.rgb, 0.0, 1.0);\n\t\t\n\t\t\tvec4 origTex = texture2D(blurMap, texCoord);\n\t\t\tvec4 blurResult = origTex + blurred;\n\t\t\t// blurResult *= 2;\n\t\t\n\t\t\tvec2 dir = texCoord - ctrPt;\n\t\t\tfloat dist = sqrt(dir.x * dir.x + dir.y * dir.y);\n\t\t\tfloat t = dist * 1.0;\n\t\t\tt = clamp(t, 0.0, 1.0); // We need 0 <= t <= 1\n\t\t\n\t\t\tgl_FragColor = blurResult * t;\n\t\t}\n    "};class Xy extends jv{constructor(){super(),this.bufferDependencies=[{key:"SceneBuffer"},{key:"MarkBuffer",mask:ey.OPAQUE},{key:"ColorMarkBuffer",mask:ey.TRANSPARENT}],this.center=new xh(.5,.5),this.strength=1,this._maskPass=new Ap(Qv),this._ghostingPass=new Ap(Qy),this._blendPass=new Ap(Wv),this._blendPass.material.premultipliedAlpha=!0}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(0),s=t._renderTargetCache.allocate(0),o=t.getBuffer("SceneBuffer"),l=t.getBuffer("MarkBuffer"),u=t.getBuffer("ColorMarkBuffer"),c=l.attachManager.has(this.name),h=u.attachManager.getAttachIndex(this.name),d=u.output(h)._attachments[Zc.COLOR_ATTACHMENT0];if(c){const t=l.attachManager.getAttachIndex(this.name),r=l.attachManager.getChannelIndex(this.name);e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._maskPass.uniforms.colorTexture=o.output()._attachments[Zc.COLOR_ATTACHMENT0],this._maskPass.uniforms.maskTexture=l.output(t)._attachments[Zc.COLOR_ATTACHMENT0],this._maskPass.uniforms.additiveTexture=d;for(let e=0;e<4;e++)this._maskPass.uniforms.channel[e]=e===r?1:0;this._maskPass.render(e)}e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._ghostingPass.uniforms.blurMap=c?a.texture:d,this._ghostingPass.uniforms.center[0]=this.center.x,this._ghostingPass.uniforms.center[1]=this.center.y,this._ghostingPass.uniforms.intensity=3*this.strength,this._ghostingPass.render(e),e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=s.texture,this._blendPass.uniforms.colorWeight1=1,this._blendPass.uniforms.alphaWeight1=1,this._blendPass.uniforms.colorWeight2=1,this._blendPass.uniforms.alphaWeight2=0,i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1)),t._renderTargetCache.release(a,0),t._renderTargetCache.release(s,0)}dispose(){this._maskPass.dispose(),this._ghostingPass.dispose(),this._blendPass.dispose()}}const Qy={name:"ec_ghosting",defines:{},uniforms:{blurMap:null,blurStart:1,blurWidth:-.1,intensity:3,glowGamma:.8,center:[.5,.5]},vertexShader:Vv,fragmentShader:"\n\t\tvarying vec2 v_Uv;\n\t\tuniform sampler2D blurMap;\n\t\tuniform float blurStart;\n\t\tuniform float blurWidth;\n\t\tuniform float intensity;\n\t\tuniform float glowGamma;\n\t\tuniform vec2 center;\n\t\t\n\t\tvoid main() {\n\t\t\tvec2 uv = v_Uv;\n\t\t\tvec2 ctrPt = center;\n\t\t\n\t\t\tfloat scale = blurStart + blurWidth * 1.0;\n\t\t\tvec2 tmp = (uv - ctrPt) * scale + ctrPt;\n\n\t\t\tvec4 blurred = texture2D(blurMap, tmp);\n\t\t\tblurred.rgb = pow(blurred.rgb, vec3(glowGamma));\n\t\t\tblurred.rgb *= intensity;\n\t\t\tblurred.rgb = clamp(blurred.rgb, 0.0, 1.0);\n\t\t\t\n\t\t\tvec2 dir = uv - ctrPt;\n\t\t\tfloat dist = sqrt(dir.x * dir.x + dir.y * dir.y);\n\t\t\n\t\t\tgl_FragColor = blurred * clamp(dist, 0.0, 1.0);\n\t\t}\n    "};class Ky extends zv{constructor(e,t,r){super(e,t,r),this._rt=new Em(e,t),this._rt.texture.minFilter=Vc.NEAREST,this._rt.texture.magFilter=Vc.NEAREST,this._rt.texture.generateMipmaps=!1,r.floatColorBuffer?this._rt.texture.type=jc.FLOAT:this._rt.texture.type=jc.HALF_FLOAT;const n=new Bp;n.image={data:null,width:e,height:t},n.type=jc.UNSIGNED_INT_24_8,n.format=zc.DEPTH_STENCIL,n.magFilter=Vc.NEAREST,n.minFilter=Vc.NEAREST,n.generateMipmaps=!1,n.flipY=!1,this._rt.attach(n,Zc.DEPTH_STENCIL_ATTACHMENT),this._renderOptions={getMaterial:Jy(),ifRender:Yy(void 0)},this._renderStates=null,this.layers=[0]}setIfRenderReplaceFunction(e){this._renderOptions.ifRender=Yy(e||void 0)}setGeometryReplaceFunction(e){e?this._renderOptions.getGeometry=e:delete this._renderOptions.getGeometry}setMaterialReplaceFunction(e){this._renderOptions.getMaterial=e?Jy(e):Jy()}render(e,t,r,n){if(!this.needRender())return;e.renderPass.setRenderTarget(this._rt),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1);const i=this._renderOptions,a=r.getRenderStates(n),s=r.getRenderQueue(n);this._renderStates=a;const o=this.layers;for(let t=0,r=o.length;t<r;t++){const r=s.getLayer(o[t]);e.renderRenderableList(r.opaque,a,i),e.renderRenderableList(r.transparent,a,i)}}output(){return this._rt}getCurrentRenderStates(){return this._renderStates}resize(e,t){super.resize(e,t),this._rt.resize(e,t)}dispose(){super.dispose(),this._rt.dispose()}}function Yy(e=Zy){return function(t){return!!e(t)&&!!t.geometry.getAttribute("a_Normal")}}function Zy(e){return!0}function Jy(e=tx){return function(t){const r=e(t);return r.diffuseMap=t.material.diffuseMap,r.uniforms.roughness=void 0!==t.material.roughness?t.material.roughness:.5,r.roughnessMap=t.material.roughnessMap,r.side=t.material.side,r}}const $y=new Map,ex=new WeakMap;function tx(e){let t=ex.get(e.material);if(!t){const r=!e.geometry.attributes.a_Normal||e.material.shading===Uc.FLAT_SHADING,n=!!e.material.diffuseMap,i=!!e.material.roughnessMap,a=e.object.isSkinnedMesh&&e.object.skeleton,s=!!e.object.morphTargetInfluences,o=!!e.object.morphTargetInfluences&&e.object.geometry.morphAttributes.normal,l=e.material.side;let u=0;a&&(u=e.object.skeleton.boneTexture?1024:e.object.skeleton.bones.length);const c=r+"_"+n+"_"+i+"_"+a+"_"+u+"_"+s+"_"+o+"_"+l;if(t=$y.get(c),!t){const d=new bp(rx);d.shading=r?Uc.FLAT_SHADING:Uc.SMOOTH_SHADING,d.alphaTest=n?.999:0,d.side=l,t={refCount:0,material:d},$y.set(c,t)}function h(){e.material.removeEventListener("dispose",h),ex.delete(e.material),t.refCount--,t.refCount<=0&&$y.delete(c)}ex.set(e.material,t),t.refCount++,e.material.addEventListener("dispose",h)}return t.material}const rx={name:"ec_gbuffer_ng",defines:{G_USE_ROUGHNESSMAP:!1},uniforms:{roughness:.5,roughnessMap:null},vertexShader:"\n        #include <common_vert>\n        #include <morphtarget_pars_vert>\n        #include <skinning_pars_vert>\n        #include <normal_pars_vert>\n        #include <uv_pars_vert>\n\t\t#include <logdepthbuf_pars_vert>\n        void main() {\n        \t#include <uv_vert>\n        \t#include <begin_vert>\n        \t#include <morphtarget_vert>\n        \t#include <morphnormal_vert>\n        \t#include <skinning_vert>\n        \t#include <skinnormal_vert>\n        \t#include <normal_vert>\n        \t#include <pvm_vert>\n\t\t\t#include <logdepthbuf_vert>\n        }\n    ",fragmentShader:"\n        #include <common_frag>\n        #include <diffuseMap_pars_frag>\n\n        #include <uv_pars_frag>\n\n        #include <packing>\n        #include <normal_pars_frag>\n\n        uniform float roughness;\n\n        #ifdef USE_ROUGHNESSMAP\n            uniform sampler2D roughnessMap;\n        #endif\n\n\t\t#include <logdepthbuf_pars_frag>\n\n        void main() {\n            #if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n                vec4 texelColor = texture2D(diffuseMap, v_Uv);\n                float alpha = texelColor.a * u_Opacity;\n                if(alpha < ALPHATEST) discard;\n            #endif\n\n\t\t\t#include <logdepthbuf_frag>\n\n            vec3 normal = normalize(v_Normal);\n\n\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t#endif \n\n            float roughnessFactor = roughness;\n            #ifdef USE_ROUGHNESSMAP\n                roughnessFactor *= texture2D(roughnessMap, v_Uv).g;\n            #endif\n\n            vec4 packedNormalGlossiness;\n            packedNormalGlossiness.xyz = normal * 0.5 + 0.5;\n            packedNormalGlossiness.w = clamp(1. - roughnessFactor, 0., 1.);\n            \n            gl_FragColor = packedNormalGlossiness;\n        }\n    "};class nx{constructor(e){this.keys=new Array,this.masks=new Array,this.attachChannelSize=e}allocate(e,t=ey.ALL){return this.keys.push(e),this.masks.push(t),this.keys.length-1}getAttachIndex(e){const t=this.keys.indexOf(e);return Math.max(0,Math.floor(t/this.attachChannelSize))}getChannelIndex(e){const t=this.keys.indexOf(e);return Math.max(0,t%this.attachChannelSize)}has(e){return this.keys.indexOf(e)>-1}count(){return this.keys.length}attachCount(){return Math.ceil(this.keys.length/this.attachChannelSize)}getKey(e,t){return this.keys[e*this.attachChannelSize+t]}getMask(e,t){return this.masks[e*this.attachChannelSize+t]}getAttachInfo(e,t={count:0,keys:[],masks:[]}){t.count=0;for(let r=0;r<this.attachChannelSize;r++){const n=this.getKey(e,r),i=this.getMask(e,r);void 0!==n&&void 0!==i&&(t.keys[t.count]=n,t.masks[t.count]=i,t.count++)}return t}reset(){this.keys.length=0,this.masks.length=0}}class ix extends zv{constructor(e,t,r){super(e,t,r),this._rts=[];for(let n=0;n<r.maxMarkAttachment;n++){const r=new Em(e,t);r.detach(Zc.DEPTH_STENCIL_ATTACHMENT),this._rts.push(r)}this._mrts=[];for(let n=0;n<r.maxMarkAttachment;n++){const n=new Em(e,t);n.attach(new Sm(e,t,zc.RGBA8,r.samplerNumber),Zc.COLOR_ATTACHMENT0),n.detach(Zc.DEPTH_STENCIL_ATTACHMENT),this._mrts.push(n)}this._state={attachIndex:0,attachInfo:{count:0,keys:[],masks:[]}};const n=new nx(4);this._opacityRenderOptions={getMaterial:ox(void 0,this._state,n,ey.OPAQUE),ifRender:ax(void 0,this._state,ey.OPAQUE)},this._transparentRenderOptions={getMaterial:ox(void 0,this._state,n,ey.TRANSPARENT),ifRender:ax(void 0,this._state,ey.TRANSPARENT)},this.attachManager=n,this.layers=[0]}setIfRenderReplaceFunction(e){e?(this._opacityRenderOptions.ifRender=ax(e,this._state,ey.OPAQUE),this._transparentRenderOptions.ifRender=ax(e,this._state,ey.TRANSPARENT)):(this._opacityRenderOptions.ifRender=ax(void 0,this._state,ey.OPAQUE),this._transparentRenderOptions.ifRender=ax(void 0,this._state,ey.TRANSPARENT))}setGeometryReplaceFunction(e){e?(this._opacityRenderOptions.getGeometry=e,this._transparentRenderOptions.getGeometry=e):(delete this._opacityRenderOptions.getGeometry,delete this._transparentRenderOptions.getGeometry)}setMaterialReplaceFunction(e){e?(this._opacityRenderOptions.getMaterial=ox(e,this._state,this.attachManager,ey.OPAQUE),this._transparentRenderOptions.getMaterial=ox(e,this._state,this.attachManager,ey.TRANSPARENT)):(this._opacityRenderOptions.getMaterial=ox(void 0,this._state,this.attachManager,ey.OPAQUE),this._transparentRenderOptions.getMaterial=ox(void 0,this._state,this.attachManager,ey.TRANSPARENT))}render(e,t,r,n){if(!this.needRender())return;const i=this.attachManager.attachCount();i>this._rts.length&&console.error("XXMarkBuffer: attachCount<"+i+"> bigger then options.maxMarkAttachment<"+this._rts.length+">.");for(let a=0;a<i;a++){const i=this._rts[a],s=this._mrts[a];t.$useMSAA?(e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!1,!1)):(e.renderPass.setRenderTarget(i),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!1,!1));const o=r.getRenderStates(n),l=r.getRenderQueue(n);this._state.attachIndex=a,this.attachManager.getAttachInfo(a,this._state.attachInfo);let u=0,c=this._state.attachInfo.masks,h=this._state.attachInfo.count;for(let e=0;e<h;e++)u|=c[e];const d=this.layers;for(let t=0,r=d.length;t<r;t++){const r=l.getLayer(d[t]);u&ey.OPAQUE&&e.renderRenderableList(r.opaque,o,this._opacityRenderOptions),u&ey.TRANSPARENT&&e.renderRenderableList(r.transparent,o,this._transparentRenderOptions)}t.$useMSAA&&(e.renderPass.setRenderTarget(i),e.renderPass.blitRenderTarget(s,i,!0,!1,!1)),e.renderPass.updateRenderTargetMipmap(i)}}output(e=0){return this._rts[e]}resize(e,t){super.resize(e,t),this._rts.forEach((r=>r.resize(e,t))),this._mrts.forEach((r=>r.resize(e,t)))}dispose(){super.dispose(),this._rts.forEach((e=>e.dispose())),this._mrts.forEach((e=>e.dispose()))}}function ax(e=sx,t,r){return function(n){if(!e(n))return!1;if(!n.object.effects)return!1;let i=0;for(let e=0;e<t.attachInfo.count;e++){const r=t.attachInfo.keys[e];n.object.effects[r]&&(i|=t.attachInfo.masks[e])}return i&r}}function sx(e){return!0}function ox(e=ux,t,r,n){return function(i){const a=e(i);a.side=Lc.DOUBLE;for(let e=0;e<4;e++){const s=r.getKey(t.attachIndex,e),o=r.getMask(t.attachIndex,e);a.uniforms.mColor[e]=o&n&&i.object.effects[s]||0}return a}}const lx=new Map;function ux(e){const t=e.object.isSkinnedMesh&&e.object.skeleton,r=!!e.object.morphTargetInfluences,n=e.material.drawMode,i=t+"_"+r+"_"+n;let a;return lx.has(i)?a=lx.get(i):(a=new bp(cx),a.premultipliedAlpha=!0,a.transparent=!0,a.blending=Bc.ADD,a.drawMode=n,lx.set(i,a)),a}const cx={name:"ec_mark",defines:{},uniforms:{mColor:[1,1,1,1]},vertexShader:"\n        #include <common_vert>\n        #include <morphtarget_pars_vert>\n        #include <skinning_pars_vert>\n        #include <uv_pars_vert>\n\t\t#include <logdepthbuf_pars_vert>\n        void main() {\n        \t#include <uv_vert>\n        \t#include <begin_vert>\n        \t#include <morphtarget_vert>\n        \t#include <skinning_vert>\n        \t#include <pvm_vert>\n\t\t\t#include <logdepthbuf_vert>\n        }\n    ",fragmentShader:"\n        #include <common_frag>\n        #include <diffuseMap_pars_frag>\n\n        #include <uv_pars_frag>\n\n\t\t#include <logdepthbuf_pars_frag>\n\n\t\tuniform vec4 mColor;\n\n        void main() {\n\t\t\t#include <logdepthbuf_frag>\n\t\t\t\n            #if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n                vec4 texelColor = texture2D(diffuseMap, v_Uv);\n                float alpha = texelColor.a * u_Opacity;\n                if(alpha < ALPHATEST) discard;\n            #endif\n\n            gl_FragColor = mColor;\n        }\n    "};class hx extends ix{constructor(e,t,r){super(e,t,r)}syncDepthAttachments(e,t){this._rts.forEach((e=>e.dispose())),this._mrts.forEach((e=>e.dispose())),$v(e)?this._rts.forEach((t=>{t.attach(e,Zc.DEPTH_STENCIL_ATTACHMENT),t.detach(Zc.DEPTH_ATTACHMENT)})):this._rts.forEach((t=>{t.attach(e,Zc.DEPTH_ATTACHMENT),t.detach(Zc.DEPTH_STENCIL_ATTACHMENT)})),$v(t)?this._mrts.forEach((e=>{e.attach(t,Zc.DEPTH_STENCIL_ATTACHMENT),e.detach(Zc.DEPTH_ATTACHMENT)})):this._mrts.forEach((e=>{e.attach(t,Zc.DEPTH_ATTACHMENT),e.detach(Zc.DEPTH_STENCIL_ATTACHMENT)})),this.needsUpdate=!0}}class dx extends zv{constructor(e,t,r){super(e,t,r),this._rts=[];for(let n=0;n<r.maxColorAttachment;n++){const r=new Em(e,t);r.detach(Zc.DEPTH_STENCIL_ATTACHMENT),this._rts.push(r)}this._mrts=[];for(let n=0;n<r.maxColorAttachment;n++){const n=new Em(e,t);n.attach(new Sm(e,t,zc.RGBA8,r.samplerNumber),Zc.COLOR_ATTACHMENT0),n.detach(Zc.DEPTH_STENCIL_ATTACHMENT),this._mrts.push(n)}const n={key:null};this._state=n;const i=new nx(1);this._renderOptions={getMaterial:mx(void 0,n),ifRender:px(void 0,n)},this.attachManager=i,this.layers=[0]}setIfRenderReplaceFunction(e){this._renderOptions.ifRender=px(e||void 0,this._state)}setGeometryReplaceFunction(e){e?this._renderOptions.getGeometry=e:delete this._renderOptions.getGeometry}setMaterialReplaceFunction(e){this._renderOptions.getMaterial=mx(e||void 0,this._state)}syncDepthAttachments(e,t){this._rts.forEach((e=>e.dispose())),this._mrts.forEach((e=>e.dispose())),$v(e)?this._rts.forEach((t=>{t.attach(e,Zc.DEPTH_STENCIL_ATTACHMENT),t.detach(Zc.DEPTH_ATTACHMENT)})):this._rts.forEach((t=>{t.attach(e,Zc.DEPTH_ATTACHMENT),t.detach(Zc.DEPTH_STENCIL_ATTACHMENT)})),$v(t)?this._mrts.forEach((e=>{e.attach(t,Zc.DEPTH_STENCIL_ATTACHMENT),e.detach(Zc.DEPTH_ATTACHMENT)})):this._mrts.forEach((e=>{e.attach(t,Zc.DEPTH_ATTACHMENT),e.detach(Zc.DEPTH_STENCIL_ATTACHMENT)})),this.needsUpdate=!0}render(e,t,r,n){if(!this.needRender())return;const i=this.attachManager.attachCount();i>this._rts.length&&console.error("ColorMarkBuffer: attachCount<"+i+"> bigger then options.maxColorAttachment<"+this._rts.length+">.");for(let a=0;a<i;a++){const i=this._rts[a],s=this._mrts[a];t.$useMSAA?(e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!1,!1)):(e.renderPass.setRenderTarget(i),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!1,!1));const o=this._renderOptions,l=this.attachManager,u=r.getRenderStates(n),c=r.getRenderQueue(n);this._state.key=l.getKey(a,0);const h=l.getMask(a,0),d=this.layers;for(let t=0,r=d.length;t<r;t++){const r=c.getLayer(d[t]);h&ey.OPAQUE&&e.renderRenderableList(r.opaque,u,o),h&ey.TRANSPARENT&&e.renderRenderableList(r.transparent,u,o)}t.$useMSAA&&(e.renderPass.setRenderTarget(i),e.renderPass.blitRenderTarget(s,i,!0,!1,!1)),e.renderPass.updateRenderTargetMipmap(i)}}output(e=0){return this._rts[e]}resize(e,t){super.resize(e,t),this._rts.forEach((r=>r.resize(e,t))),this._mrts.forEach((r=>r.resize(e,t)))}dispose(){super.dispose(),this._rts.forEach((e=>e.dispose())),this._mrts.forEach((e=>e.dispose()))}}function px(e=fx,t){return function(r){return!!e(r)&&(!!r.object.effects&&!!r.object.effects[t.key])}}function fx(e){return!0}function mx(e=_x,t){return function(r){const n=e(r);return n.side=Lc.DOUBLE,n.uniforms.strength=r.object.effects[t.key]||0,n}}const gx=new Map;function _x(e){const t=e.object.isSkinnedMesh&&e.object.skeleton,r=!!e.object.morphTargetInfluences,n=e.material.drawMode,i=t+"_"+r+"_"+n+!!e.material.diffuseMap;let a;return gx.has(i)?a=gx.get(i):(a=new bp(vx),a.premultipliedAlpha=!1,a.drawMode=n,gx.set(i,a)),a.transparent=e.material.transparent,a.blending=e.material.blending,a.opacity=e.material.opacity,a.diffuse.copy(e.material.diffuse),a.diffuseMap=e.material.diffuseMap,a}const vx={name:"ec_color",defines:{},uniforms:{strength:1},vertexShader:"\n        #include <common_vert>\n        #include <morphtarget_pars_vert>\n        #include <skinning_pars_vert>\n        #include <uv_pars_vert>\n\t\t#include <logdepthbuf_pars_vert>\n        void main() {\n        \t#include <uv_vert>\n        \t#include <begin_vert>\n        \t#include <morphtarget_vert>\n        \t#include <skinning_vert>\n        \t#include <pvm_vert>\n\t\t\t#include <logdepthbuf_vert>\n        }\n    ",fragmentShader:"\n        #include <common_frag>\n        #include <diffuseMap_pars_frag>\n\n        #include <uv_pars_frag>\n\n\t\t#include <logdepthbuf_pars_frag>\n\n\t\tuniform float strength;\n\n        void main() {\n\t\t\t#include <logdepthbuf_frag>\n\n\t\t\tvec4 outColor = vec4(u_Color, u_Opacity);\n\n\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\toutColor *= texture2D(diffuseMap, v_Uv);\n\t\t\t#endif\n\n\t\t\t#ifdef ALPHATEST\n\t\t\t\tif(outColor.a < ALPHATEST) discard;\n\t\t\t#endif\n\n\t\t\toutColor.a *= strength;\n\n            gl_FragColor = outColor;\n        }\n    "};class yx extends zv{constructor(e,t,r){super(e,t,r),this._rt=new Em(e,t),this._rt.detach(Zc.DEPTH_STENCIL_ATTACHMENT),this._mrt=new Em(e,t),this._mrt.detach(Zc.DEPTH_STENCIL_ATTACHMENT),this.clearColor=!0,this.clearDepth=!0,this.clearStencil=!0,this.renderLayers=[{id:0,mask:ey.ALL}],this._sceneRenderOptions={}}syncAttachments(e,t,r,n){this._rt.dispose(),this._mrt.dispose(),this._rt.attach(e,Zc.COLOR_ATTACHMENT0),$v(t)?(this._rt.attach(t,Zc.DEPTH_STENCIL_ATTACHMENT),this._rt.detach(Zc.DEPTH_ATTACHMENT)):(this._rt.attach(t,Zc.DEPTH_ATTACHMENT),this._rt.detach(Zc.DEPTH_STENCIL_ATTACHMENT)),this._mrt.attach(r,Zc.COLOR_ATTACHMENT0),$v(n)?(this._mrt.attach(n,Zc.DEPTH_STENCIL_ATTACHMENT),this._mrt.detach(Zc.DEPTH_ATTACHMENT)):(this._mrt.attach(n,Zc.DEPTH_ATTACHMENT),this._mrt.detach(Zc.DEPTH_STENCIL_ATTACHMENT)),this.needsUpdate=!0}setIfRenderReplaceFunction(e){e?this._sceneRenderOptions.ifRender=e:delete this._sceneRenderOptions.ifRender}setGeometryReplaceFunction(e){e?this._sceneRenderOptions.getGeometry=e:delete this._sceneRenderOptions.getGeometry}setOutputEncoding(e){this._rt.texture.encoding=e}getOutputEncoding(){return this._rt.texture.encoding}render(e,t,r,n){if(!this.needRender())return;const i=t.$useMSAA,a=i?this._mrt:this._rt,s=!!a._attachments[Zc.DEPTH_STENCIL_ATTACHMENT];e.renderPass.setRenderTarget(a),t.clearColor?e.renderPass.setClearColor(...t._tempClearColor):e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(this.clearColor,this.clearDepth,this.clearStencil&&s);const o=r.getRenderStates(n),l=r.getRenderQueue(n);this.$renderScene(e,l,o),i&&(e.renderPass.setRenderTarget(this._rt),e.renderPass.blitRenderTarget(this._mrt,this._rt,!0,!0,s)),e.renderPass.updateRenderTargetMipmap(this._rt)}output(){return this._rt}resize(e,t){super.resize(e,t),this._rt.resize(e,t),this._mrt.resize(e,t)}dispose(){super.dispose(),this._rt.dispose(),this._mrt.dispose()}$renderScene(e,t,r){const n=this._sceneRenderOptions,i=this.renderLayers;for(let a=0,s=i.length;a<s;a++){const{id:s,mask:o,options:l=n}=i[a],u=t.getLayer(s);u&&(u.opaqueCount>0&&o&ey.OPAQUE&&e.renderRenderableList(u.opaque,r,l),u.transparentCount>0&&o&ey.TRANSPARENT&&e.renderRenderableList(u.transparent,r,l))}const a=t.getLayer(1);a&&a.opaqueCount+a.transparentCount>0&&(e.renderPass.clear(!1,!0,!1),e.renderRenderableList(a.opaque,r,n),e.renderRenderableList(a.transparent,r,n))}}class xx{constructor(e,t){this._width=e,this._height=t,this._map=new Map}allocate(e=0){let t=this._map.get(e);if(t||(t=[],this._map.set(e,t)),t.length>0)return t.shift();{const t=Math.pow(2,e),r=Math.ceil(this._width/t),n=Math.ceil(this._height/t),i=new Em(r,n),a=i._attachments[Zc.COLOR_ATTACHMENT0];return a.minFilter=Vc.LINEAR,a.magFilter=Vc.LINEAR,a.format=zc.RGBA,a.generateMipmaps=!1,i.detach(Zc.DEPTH_STENCIL_ATTACHMENT),i}}release(e,t=0){this._map.get(t).push(e)}resize(e,t){this._width=e,this._height=t,this._map.forEach(((e,t)=>{const r=Math.pow(2,t),n=Math.ceil(this._width/r),i=Math.ceil(this._height/r);e.forEach((e=>{e.resize(n,i)}))}))}updateStats(e){let t=0;this._map.forEach(((e,r)=>{const n=Math.pow(2,r);t+=e.length/(n*n)})),e.fboCache=t}dispose(){this._map.forEach((e=>{e.forEach((e=>{e.dispose()}))})),this._map.clear()}}class bx{constructor(e,t,r={}){this._size=new xh(e,t),r.webgl2=r.webgl2||!1,r.floatColorBuffer=r.floatColorBuffer||!1,r.samplerNumber=r.samplerNumber||8,r.maxMarkAttachment=r.maxMarkAttachment||5,r.maxColorAttachment=r.maxColorAttachment||5;const n=new yx(e,t,r),i=new Ky(e,t,r),a=new ix(e,t,r),s=new hx(e,t,r),o=new dx(e,t,r);this._bufferMap=new Map([["SceneBuffer",n],["GBuffer",i],["NonDepthMarkBuffer",a],["MarkBuffer",s],["ColorMarkBuffer",o]]),this._defaultColorTexture=new Bp,this._defaultMSColorRenderBuffer=new Sm(e,t,zc.RGBA8,r.samplerNumber),this._defaultDepthRenderBuffer=new Sm(e,t,zc.DEPTH_COMPONENT16),this._defaultMSDepthRenderBuffer=new Sm(e,t,zc.DEPTH_COMPONENT16,r.samplerNumber),this._defaultDepthStencilRenderBuffer=new Sm(e,t,zc.DEPTH_STENCIL),this._defaultMSDepthStencilRenderBuffer=new Sm(e,t,zc.DEPTH24_STENCIL8,r.samplerNumber),this._externalColorAttachment=null,this._externalDepthAttachment=null,this._samplerNumber=r.samplerNumber,this._externalMSAA=null,this._stencilBuffer=!1,this._syncAttachments(),this._copyPass=new Ap(qv),this._copyPass.material.premultipliedAlpha=!0,this._renderTargetCache=new xx(e,t),this._effectList=[],this._tempClearColor=[0,0,0,1],this._tempViewport=[0,0,1,1],this._tempBufferNames=new Set,this._stats={fboCache:0,markBuffers:0,colorMarkBuffers:0,currentBufferUsage:{}},this.sceneMSAA=!1,this.clearColor=!0,this.clearDepth=!0,this.clearStencil=!1,this.debugger=null}getSize(){return this._size}_syncAttachments(){const e=this._externalColorAttachment,t=this._externalDepthAttachment,r=!!e&&!!t,n=this._externalMSAA;let i=this._stencilBuffer;r&&(i=$v(t));const a=i?this._defaultDepthStencilRenderBuffer:this._defaultDepthRenderBuffer,s=i?this._defaultMSDepthStencilRenderBuffer:this._defaultMSDepthRenderBuffer;let o,l,u,c,h,d;r?n?(o=this._defaultColorTexture,l=a,u=e,c=t,h=a,d=t):(o=e,l=t,u=this._defaultMSColorRenderBuffer,c=s,h=t,d=s):(o=this._defaultColorTexture,l=a,u=this._defaultMSColorRenderBuffer,c=s,h=a,d=s),this._bufferMap.forEach((e=>{e.syncAttachments?e.syncAttachments(o,l,u,c):e.syncDepthAttachments&&e.syncDepthAttachments(h,d)}))}set stencilBuffer(e){this._stencilBuffer=e,this._syncAttachments()}get stencilBuffer(){return this._stencilBuffer}setExternalAttachment(e,t){const r=Ex(e);r===Ex(t)?(this._externalColorAttachment=e,this._externalDepthAttachment=t,this._externalMSAA=r>0,this._syncAttachments()):console.warn("EffectComposer.setExternalAttachment: color and depth attachment MultipleSampling not match.")}clearExternalAttachment(){this._externalColorAttachment=null,this._externalDepthAttachment=null,this._externalMSAA=null,this._syncAttachments()}addBuffer(e,t){this._bufferMap.set(e,t)}removeBuffer(e){this._bufferMap.delete(e)}getBuffer(e){return this._bufferMap.get(e)}addEffect(e,t,r=0){this.getEffect(e)?console.warn(""):(t.name=e,this._effectList.push({name:e,effect:t,order:r}),t.resize(this._size.x,this._size.y))}removeEffect(e){const t=this._effectList.findIndex((t=>t.name===e));t>-1&&this._effectList.splice(t,1)}getEffect(e){const t=this._effectList.find((t=>t.name===e));return t?t.effect:null}render(e,t,r,n){const i=t.getRenderStates(r);if(e.renderPass.getClearColor().toArray(this._tempClearColor),r.rect.toArray(this._tempViewport),r.rect.set(0,0,1,1),i.camera.rect.set(0,0,1,1),this._bufferMap.forEach((e=>{e.attachManager&&e.attachManager.reset()})),this.debugger)return this.debugger.bufferDependencies.forEach((n=>{const i=this._bufferMap.get(n);this.debugger.channel&&i.attachManager&&i.attachManager.allocate(this.debugger.channel,this.debugger.mask),i.render(e,this,t,r)})),this.debugger.render(e,this,n),void e.renderPass.setClearColor(...this._tempClearColor);this._effectList.sort(Sx);let a=this._effectList.findIndex((e=>e.effect.active));const s=a>-1;if(this._tempBufferNames.clear(),s){this._tempBufferNames.add("SceneBuffer"),this._effectList.forEach((e=>{e.effect.active&&e.effect.bufferDependencies.forEach((({key:t,mask:r})=>{this._tempBufferNames.add(t),this._bufferMap.get(t).attachManager&&this._bufferMap.get(t).attachManager.allocate(e.name,r)}))})),this._tempBufferNames.forEach((n=>{this._bufferMap.get(n).render(e,this,t,r)}));let i,s=this._renderTargetCache.allocate(),o=this._renderTargetCache.allocate();this._effectList.sort(Ax);const l=this._effectList.length,u=this._effectList.findIndex((e=>e.effect.active));a=l-1-a,this._effectList.forEach(((t,r)=>{if(!t.effect.active)return;const l=r<a;t.effect.render(e,this,r===u?this._bufferMap.get("SceneBuffer").output():s,l?o:n,!l),i=s,s=o,o=i})),this._renderTargetCache.release(s),this._renderTargetCache.release(o)}else if(this._externalColorAttachment&&this._externalDepthAttachment){const i=this._bufferMap.get("SceneBuffer");i.render(e,this,t,r),e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(this.clearColor,this.clearDepth,this.clearStencil);const a=this._copyPass;a.uniforms.tDiffuse=i.output().texture,a.material.transparent=this._tempClearColor[3]<1||!this.clearColor,a.renderStates.camera.rect.fromArray(this._tempViewport),a.render(e)}else{e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(...this._tempClearColor),e.renderPass.clear(this.clearColor,this.clearDepth,this.clearStencil),i.camera.rect.fromArray(this._tempViewport);const a=t.getRenderQueue(r);this._bufferMap.get("SceneBuffer").$renderScene(e,a,i)}e.renderPass.setClearColor(...this._tempClearColor),r.rect.fromArray(this._tempViewport),i.camera.rect.fromArray(this._tempViewport)}getStats(){this._renderTargetCache.updateStats(this._stats);const e=this.getBuffer("MarkBuffer").attachManager.attachCount(),t=this.getBuffer("NonDepthMarkBuffer").attachManager.attachCount(),r=this.getBuffer("ColorMarkBuffer").attachManager.attachCount();this._stats.markBuffers=e+t,this._stats.colorMarkBuffers=r;for(const[e,t]of this._bufferMap)t.attachManager||(this._stats.currentBufferUsage[e]=this._tempBufferNames.has(e)?1:0);return this._stats}resize(e,t){this._size.set(e,t),this._bufferMap.forEach((r=>r.resize(e,t))),this._renderTargetCache.resize(e,t),this._effectList.forEach((r=>r.effect.resize(e,t)))}dispose(){this._bufferMap.forEach((e=>e.dispose())),this._renderTargetCache.dispose(),this._effectList.forEach((e=>e.effect.dispose())),this._copyPass.dispose()}get $useMSAA(){return(null!==this._externalMSAA?this._externalMSAA:this.sceneMSAA)&&this._samplerNumber>1}}function Ax(e,t){return e.order-t.order}function Sx(e,t){return t.order-e.order}function Ex(e){return e.isTexture?0:e.multipleSampling}class wx extends bx{constructor(e,t,r){super(e,t,r),this.addEffect("SSAO",new dy,0),this.addEffect("SSR",new by,1),this.addEffect("ColorCorrection",new iy,2),this.addEffect("DOF",new sy,3),this.addEffect("Bloom",new ty,4),this.addEffect("InnerGlow",new By,10),this.addEffect("Glow",new Ly,11),this.addEffect("SoftGlow",new jy,12),this.addEffect("Tailing",new Gy,13),this.addEffect("RadialTailing",new Hy,14),this.addEffect("Ghosting",new Xy,15),this.addEffect("FXAA",new cy,101),this.addEffect("ChromaticAberration",new ry,102),this.addEffect("Vignetting",new Ty,103),this.addEffect("BlurEdge",new My,104),this.addEffect("Film",new ly,105),this._effectList.forEach((e=>e.effect.active=!1))}}class Cx{constructor(){this.bufferDependencies=[]}render(e,t,r){console.error("Debugger: .render() must be implemented in subclass.")}resize(e,t){}dispose(){}}class Tx extends Cx{constructor(){super(),this.bufferDependencies=["SceneBuffer","ColorMarkBuffer"],this._mainPass=new Ap(qv),this.channel="",this.mask=ey.ALL}render(e,t,r){e.renderPass.setRenderTarget(r),e.renderPass.setClearColor(0,0,0,1),e.renderPass.clear(!0,!0,!1);const n=t.getBuffer("ColorMarkBuffer"),i=n.attachManager.getAttachIndex(this.channel);this._mainPass.uniforms.tDiffuse=n.output(i)._attachments[Zc.COLOR_ATTACHMENT0],this._mainPass.render(e)}}class Dx extends Cx{constructor(){super(),this.bufferDependencies=["GBuffer"],this._mainPass=new Ap(Px),this.debugType=Mx.Normal}render(e,t,r){e.renderPass.setRenderTarget(r),e.renderPass.setClearColor(0,0,0,1),e.renderPass.clear(!0,!0,!1);const n=t.getBuffer("GBuffer"),i=n.getCurrentRenderStates();this._mainPass.uniforms.normalGlossinessTexture=n.output()._attachments[Zc.COLOR_ATTACHMENT0],this._mainPass.uniforms.depthTexture=n.output()._attachments[Zc.DEPTH_STENCIL_ATTACHMENT],this._mainPass.uniforms.debug=this.debugType||0,i.camera.projectionViewMatrix.toArray(this._mainPass.uniforms.projectionView),this._mainPass.render(e)}}const Mx={Normal:0,Depth:1,Position:2,Glossiness:3};Dx.DebugTypes=Mx;const Px={name:"ec_debug_gbuffer",defines:{},uniforms:{normalGlossinessTexture:null,depthTexture:null,projectionView:new Float32Array(16),debug:0},vertexShader:Vv,fragmentShader:"\n\t\tuniform sampler2D normalGlossinessTexture;\n\t\tuniform sampler2D depthTexture;\n\t\tuniform int debug;\n\n\t\tuniform mat4 projectionView;\n\n\t\tvarying vec2 v_Uv;\n\n\t\tvoid main() {\n\t\t\tvec2 texCoord = v_Uv;\n\t\t\tvec4 texel = texture2D(normalGlossinessTexture, texCoord);\n\n\t\t\tif (dot(texel.rgb, vec3(1.0)) == 0.0) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat depth = texture2D(depthTexture, texCoord).r;\n\n\t\t\tvec2 xy = texCoord * 2.0 - 1.0;\n\t\t\tfloat z = depth * 2.0 - 1.0;\n\n\t\t\tvec4 projectedPos = vec4(xy, z, 1.0);\n\t\t\tvec4 p4 = inverse(projectionView) * projectedPos;\n\n\t\t\tvec3 position = p4.xyz / p4.w;\n\n\t\t\tif (debug == 0) {\n\t\t\t\tgl_FragColor = vec4(texel.rgb, 1.0);\n\t\t\t} else if (debug == 1) {\n\t\t\t\tgl_FragColor = vec4(vec3(depth), 1.0);\n\t\t\t} else if (debug == 2) {\n\t\t\t\tgl_FragColor = vec4(position, 1.0);\n\t\t\t} else {\n\t\t\t\tgl_FragColor = vec4(vec3(texel.a), 1.0);\n\t\t\t}\n\t\t}\n\t"};class Fx extends Cx{constructor(){super(),this.bufferDependencies=["SceneBuffer","MarkBuffer"],this._mainPass=new Ap(Xv),this.channel="",this.mask=ey.ALL}render(e,t,r){e.renderPass.setRenderTarget(r),e.renderPass.setClearColor(0,0,0,1),e.renderPass.clear(!0,!0,!1);const n=t.getBuffer("MarkBuffer"),i=n.attachManager.getAttachIndex(this.channel),a=n.attachManager.getChannelIndex(this.channel);this._mainPass.uniforms.tDiffuse=n.output(i)._attachments[Zc.COLOR_ATTACHMENT0];for(let e=0;e<4;e++)this._mainPass.uniforms.channelMask[e]=e===a?1:0;this._mainPass.render(e)}}class Rx extends Cx{constructor(){super(),this.bufferDependencies=["NonDepthMarkBuffer"],this._mainPass=new Ap(Xv),this.channel="",this.mask=ey.ALL}render(e,t,r){e.renderPass.setRenderTarget(r),e.renderPass.setClearColor(0,0,0,1),e.renderPass.clear(!0,!0,!1);const n=t.getBuffer("NonDepthMarkBuffer"),i=n.attachManager.getAttachIndex(this.channel),a=n.attachManager.getChannelIndex(this.channel);this._mainPass.uniforms.tDiffuse=n.output(i)._attachments[Zc.COLOR_ATTACHMENT0];for(let e=0;e<4;e++)this._mainPass.uniforms.channelMask[e]=e===a?1:0;this._mainPass.render(e)}}class Nx extends Cx{constructor(){super(),this.bufferDependencies=["GBuffer"],this.defaultEffect=new dy}render(e,t,r){(t.getEffect("SSAO")||this.defaultEffect).render(e,t,null,r)}resize(e,t){this.defaultEffect.resize(e,t)}dispose(){this.defaultEffect.dispose()}}class Bx extends Cx{constructor(){super(),this.bufferDependencies=["SceneBuffer","GBuffer"],this.defaultEffect=new by}render(e,t,r){(t.getEffect("SSR")||this.defaultEffect).render(e,t,null,r)}resize(e,t){this.defaultEffect.resize(e,t)}dispose(){this.defaultEffect.dispose()}}bx.prototype.setGeometryReplaceFunction=function(e){console.warn("EffectComposer.setGeometryReplaceFunction has been removed, use SceneBuffer.setGeometryReplaceFunction instead.");this._bufferMap.get("SceneBuffer").setGeometryReplaceFunction(e)},Object.defineProperties(bx.prototype,{customRenderLayers:{set:function(e){console.error("EffectComposer.customRenderLayers has been removed, use SceneBuffer.renderLayers instead.")},get:function(){console.error("EffectComposer.customRenderLayers has been removed, use SceneBuffer.renderLayers instead.")}}}),Ap.prototype.dispose||(Ap.prototype.dispose=function(){const e=this.renderQueueLayer.opaque[0];e&&(e.geometry.dispose(),e.material.dispose())});class Ix{constructor(){this._outlineManager=new kx,this._effectRefCounts=new Map,this._states=new Ox}setEffect(e,t,r){if(!(e.isMesh||e.isLine||e.isSprite||e.isPoints))return;e.effects||(e.effects={});let n=!!r&&(r>0||"skip"!==r);(!!e.effects[t]&&(e.effects[t]>0||"skip"!==e._cachedEffects[t]))!==n?this._updateEffectRefCounts(t,n?1:-1):this._states.dirty(t),r>0?e.effects[t]=r:null!=e.effects[t]&&delete e.effects[t]}removeEffect(e,t){this.setEffect(e,t,0)}clearAllEffects(e){if(e.effects)for(let t in e.effects)this.removeEffect(e,t)}addCounts(e){for(let t in e)e[t]>0&&this._updateEffectRefCounts(t,e[t])}getStates(){return this._states.map}update(e){this.getStates().forEach(((t,r)=>{if(t.enableChanged)if(this._outlineManager.isOutlineEffect(r))t.enable?this._outlineManager.enableOutline(r,e):this._outlineManager.disableOutline(r,e);else{const n=e.getEffect(r);n&&n.enable(t.enable)}t.dirty}))}_updateEffectRefCounts(e,t){this._effectRefCounts.has(e)||this._effectRefCounts.set(e,0);let r=this._states,n=this._effectRefCounts.get(e);this._effectRefCounts.set(e,Math.max(this._effectRefCounts.get(e)+t,0)),0==n&&t>0?r.enable(e):n>0&&0==this._effectRefCounts.get(e)&&r.disable(e),r.dirty(e)}}class Ox{constructor(){this.map=new Map,this.clearStates=[]}enable(e){const t=this._getState(e);t.enable=!0,t.enableChanged=!0,t.dirty=!0;const r=this.clearStates.indexOf(e);-1!==r&&this.clearStates.splice(r,1)}disable(e){const t=this._getState(e);t.enable=!1,t.enableChanged=!0,t.dirty=!0,this.clearStates.push(e)}dirty(e){this._getState(e).dirty=!0}clearDisableStates(){if(0===this.clearStates.length)return;let e=this.clearStates.pop();for(;e;)this.map.delete(e),e=this.clearStates.pop()}_getState(e){return this.map.has(e)||this.map.set(e,{enable:!1,enableChanged:!0,dirty:!0}),this.map.get(e)}}class kx{constructor(){this.outlineMaxSize=20,this.insertStartIndex=30,this.insertOffset=this.insertStartIndex,this.outlineMap=new Map,this.outlinePool=[],this._regular=/(_)(.*)/}_isMax(){return this.outlineMap.size>this.outlineMaxSize}_getIndex(){return this.insertOffset<this.insertStartIndex+this.outlineMaxSize?this.insertOffset++:-1}_getCacheFromPool(){return this.outlinePool.length>0?this.outlinePool.pop():{}}isOutlineEffect(e){return!!e&&this._regular.test(e)}enableOutline(e,t){if(!e||!t)return;let r=this.outlineMap.get(e);if(void 0===r){if(this._isMax())return;let t,n=this._getCacheFromPool();t=n.effect,t||(t=new Fy);const i=this._regular.exec(e).pop();t.color.setHex(parseInt(i));r={index:n.index||this._getIndex(),effect:t,count:0},this.outlineMap.set(e,r)}return r.effect.active=!0,t.getEffect(e)||(t.addEffect(e,r.effect,r.index),r.count++),r.effect}disableOutline(e,t){if(!e||!t)return;const r=this.outlineMap.get(e);if(void 0!==r){if(t.getEffect(e)&&(t.removeEffect(e),r.count--),r.count<1){const{effect:t,index:n}=r;t.active=!1,this.outlineMap.delete(e),this.outlinePool.length<this.outlineMaxSize&&this.outlinePool.push({index:n,effect:t})}return r.effect}}}class Lx{constructor(){this._set=new Set,this._interval=1,this._timer=0}push(e,t=2){this._set.add({material:e,timer:t})}update(e){this._timer+=e,this._timer>this._interval&&(this._set.forEach((e=>{e.timer-=this._timer,e.timer<0&&(e.material.dispose(),this._set.delete(e))})),this._timer=0)}clear(){this._set.forEach((e=>e.material.dispose())),this._set.clear()}}class Ux{constructor(){this.map=new Map}createPickCache(e,t=!1){let r={object:e,uNode:t?this.getUNodeByPickedObject(e):void 0};return e._isPickBoxMesh&&(r.uNode=e._linkUNode),this.map.set(e.id,r),r}releasePickCache(e){this.map.delete(e.id)}getUNodeByPickedObject(e){do{if(e.$unode)break;e=e.parent}while(e);return e.$unode}dispose(){this.map.clear()}}const zx="STYLE",jx="BOUNDING_BOX",Vx="ANIMATION_PLAYER",Gx="TEXTURE_ANIMATION_PLAYER",Wx="INSTANCING",Hx="BILLBOARD_PROCESSOR",qx="SUBNODE_ATTACHER",Xx="CCD_IK_SOLVER",Qx=new Sc,Kx=new bc,Yx=new bc,Zx=new Mc,Jx=[];class $x{constructor(e){this._unode=null,this._attachTarget=null,this._offsetMatrix=new Sc,this._ignoreScale=e}bindSubNode(e,t){const r=e._parent._node.getObjectByName(e.name);return r?(this._attachTarget=r,this._offsetMatrix.fromArray(t),!0):(console.error("SubNodeAttacher: Can not find sub node name <"+e.name+">"),!1)}$onAdd(e){this._unode=e,this._unode.$uScene.$subNodeAttachers.add(this)}$onRemove(e){this._unode.$uScene.$subNodeAttachers.delete(this),this._unode=null,this._attachTarget=null}$update(){this._attachTarget&&this._offsetMatrix&&(Qx.copy(this._attachTarget.worldMatrix),this._ignoreScale&&(Qx.decompose(Kx,Zx,Yx),Yx.set(1,1,1),Qx.transform(Kx,Yx,Zx)),Qx.multiply(this._offsetMatrix),this._unode.setMatrixWorld(Qx.toArray(Jx),!1),this._unode.updateMatrixWorld())}dispose(){this._unode.$uScene.$subNodeAttachers.delete(this),this._unode=null,this._attachTarget=null}}const eb=new bc,tb=new bc,rb=new Mc,nb=new Mc,ib=new Dh,ab=new Sc,sb=new Sc,ob=new Set,lb=new Set,ub=new Mc,cb=new bc,hb=new Sc,db=[0,1,0],pb=["diffuseMap","alphaMap","emissiveMap","aoMap","bumpMap","envMap","normalMap","colorMapping","metalnessMap","roughnessMap","specularMap","glossinessMap"],fb=(e,t)=>{pb.forEach((r=>{e[r]&&t.add(e[r].id)}))};class mb extends eh{constructor(e){super(),this._uScene=e,this._node,this._parent=null,this._children=[],this._components=new Map,this._visible=!0,this._internalVisible=!0,this._sceneVisible=!1}setVisible(e){this._visible!==e&&(this._visible=e,this._node.visible=this._visible&&this._internalVisible,null!==this._parent?this.$syncSceneVisible(this._parent._sceneVisible):this.$syncSceneVisible(!!this.isRoot),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0)}getVisible(){return this._visible}getSceneVisible(){return this._sceneVisible}add(e){const t=e._parent;null!==t&&t.remove(e);let r=this._node.children.length;return this._node.add(e._node),e._node.worldMatrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(e),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0,this._node.children.length-r==1&&(e._parent=this,this._children.push(e)),e.$syncSceneVisible(this._sceneVisible),this}remove(e){let t=this._node.children.length;if(this._node.remove(e._node),e._node.worldMatrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(e),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0,t-this._node.children.length==1){let t=this._children.indexOf(e);e._parent=null,this._children.splice(t,1)}return e.$syncSceneVisible(!1),this}attach(e){let t=this._node.children.length;if(this._node.attach(e._node),e._node.worldMatrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(e),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0,this._node.children.length-t==1){if(e._parent){let t=e._parent._children.indexOf(e);e._parent._children.splice(t,1),e._parent=null}e._parent=this,this._children.push(e)}return this}getParent(){return this._parent}getChildren(){return this._children}clearChildren(){this._children.length=0}setPosition(e){this._node.position.fromArray(e),this._node.matrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getPosition(e){return this._node.position.toArray(e)}setQuaternion(e){this._node.quaternion.fromArray(e),this._node.matrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getQuaternion(e){return this._node.quaternion.toArray(e)}setEuler(e){this._node.euler.set(e[0]/180*Math.PI,e[1]/180*Math.PI,e[2]/180*Math.PI),this._node.matrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getEuler(e){return(e=this._node.euler.toArray(e))[0]=180*e[0]/Math.PI,e[1]=180*e[1]/Math.PI,e[2]=180*e[2]/Math.PI,e}setScale(e){this._node.scale.fromArray(e),this._node.matrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getScale(e){return this._node.scale.toArray(e)}setWorldPosition(e){eb.fromArray(e),this._node.parent&&(this._node.parent.updateWorldMatrix(!0),this._node.parent.worldToLocal(eb)),this._node.position.copy(eb),this._node.matrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getWorldPosition(e){return this._node.updateWorldMatrix(!0),eb.setFromMatrixPosition(this._node.worldMatrix).toArray(e)}setWorldQuaternion(e){rb.fromArray(e),this._node.parent&&(this._node.parent.updateWorldMatrix(!0),this._node.parent.worldMatrix.decompose(eb,nb,eb),nb.inverse(),rb.premultiply(nb)),this._node.quaternion.copy(rb),this._node.matrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getWorldQuaternion(e){return this._node.updateWorldMatrix(!0),this._node.worldMatrix.decompose(eb,rb,eb),rb.toArray(e)}setWorldEuler(e){ib.fromArray([e[0]/180*Math.PI,e[1]/180*Math.PI,e[2]/180*Math.PI]),rb.setFromEuler(ib),this._node.parent&&(this._node.parent.updateWorldMatrix(!0),this._node.parent.worldMatrix.decompose(eb,nb,eb),nb.inverse(),rb.premultiply(nb)),this._node.quaternion.copy(rb),this._node.matrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getWorldEuler(e=[]){return this._node.updateWorldMatrix(!0),this._node.worldMatrix.decompose(eb,rb,eb),ib.setFromQuaternion(rb),ib.toArray(e),e[0]=e[0]/Math.PI*180,e[1]=e[1]/Math.PI*180,e[2]=e[2]/Math.PI*180,e}setWorldScale(e){this._node.parent?(this._node.updateWorldMatrix(!0),this._node.worldMatrix.decompose(tb,rb,eb),eb.fromArray(e),sb.compose(tb,rb,eb),ab.getInverse(this._node.parent.worldMatrix),sb.premultiply(ab),sb.decompose(tb,rb,eb)):eb.fromArray(e),this._node.scale.copy(eb),this._node.matrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getWorldScale(e){return this._node.updateWorldMatrix(!0),this._node.worldMatrix.decompose(eb,rb,tb),tb.toArray(e)}setMatrix(e){this._node.matrix.fromArray(e),this._node.matrix.decompose(this._node.position,this._node.quaternion,this._node.scale),this._node.worldMatrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getMatrix(e){return this._node.updateMatrix(),this._node.matrix.toArray(e)}setMatrixWorld(e,t=!0){this._node.parent?(t&&this._node.updateWorldMatrix(!0),this._node.matrix.fromArray(e),ab.getInverse(this._node.parent.worldMatrix),this._node.matrix.premultiply(ab),this._node.matrix.decompose(this._node.position,this._node.quaternion,this._node.scale),this._node.worldMatrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0):this.setMatrix(e)}getMatrixWorld(e,t=!0){return this._node.parent?(t&&this._node.updateWorldMatrix(!0),this._node.worldMatrix.toArray(e)):this.getMatrix(e)}updateWorldMatrix(e,t){this._node.updateWorldMatrix(e,t)}bindSubNode(e,t,r=!1){return this.$hasComponent(qx)||this.$addComponent(qx,new $x(r)),this.$getComponent(qx).bindSubNode(e,t)}unbindSubNode(){this.$removeComponent(qx)}lookAt(e,t=db){eb.fromArray(e),tb.fromArray(t);const r=this._node.parent;this._node.updateWorldMatrix(!0,!1),cb.setFromMatrixPosition(this._node.worldMatrix),this.isCamera||this.isLight?hb.lookAtRH(cb,eb,tb):hb.lookAtRH(eb,cb,tb),this._node.quaternion.setFromRotationMatrix(hb),r&&(hb.extractRotation(r.worldMatrix),ub.setFromRotationMatrix(hb),this._node.quaternion.premultiply(ub.inverse())),this._node.matrixNeedsUpdate=!0,this._uScene.$transformCache.markDirty(this),this._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getForward(e){this._node.updateWorldMatrix(!0);const t=this._node.worldMatrix.elements;return eb.set(t[8],t[9],t[10]).normalize().toArray(e)}selfToWorld(e,t,r,n=!0){return this._node.updateWorldMatrix(n,!1),r?(this._node.worldMatrix.decompose(eb,rb,tb),ab.compose(eb,rb,tb.set(1,1,1)),eb.fromArray(t).applyMatrix4(ab).toArray(e)):this._node.localToWorld(eb.fromArray(t)).toArray(e)}worldToSelf(e,t,r,n=!0){return this._node.updateWorldMatrix(n,!1),r?(this._node.worldMatrix.decompose(eb,rb,tb),ab.compose(eb,rb,tb.set(1,1,1)),sb.getInverse(ab),eb.fromArray(t).applyMatrix4(sb).toArray(e)):this._node.worldToLocal(eb.fromArray(t)).toArray(e)}updateMatrixWorld(){this._node.updateMatrix()}getUserData(){return this._node.userData.info=this._node.userData.info||{},this._node.userData.info}setUserData(e){this._node.userData.info=e}setName(e){this._node.name=e}getName(){return this._node.name}setAttribute(e,t){"SkipMatrixUpdate"===e&&(this.$skipMatrixWorldUpdate=t)}getAttribute(e){return"Pickable"!==e&&("SkipMatrixUpdate"===e?this.$skipMatrixWorldUpdate:void 0)}getGeometryInfo(){return ob.clear(),lb.clear(),this._getGeometryInfo(ob,lb)}_getGeometryInfo(e,t){let r=0,n=0;if(this.$isContainer)this._children.forEach((i=>{let a=i._getGeometryInfo(e,t);r+=a.vertices,n+=a.triangles}));else{if(this._res){let e=this._res.$getInfo();r+=e.vertices,n+=e.triangles}else O_(this._node,(e=>{if(e.isMesh||e.isSprite||e.isLine||e.isPoints)if(e.geometry.index){let t=e.geometry.index.buffer.array.length;r+=t,n+=t/3}else{let t=e.geometry.getAttribute("a_Position").buffer.count;r+=t,n+=t/3}}));O_(this._node,(r=>{(r.isMesh||r.isSprite||r.isLine||r.isPoints)&&(Array.isArray(r.material)?r.material.forEach((n=>{e.add(n.id),fb(r.material,t)})):(e.add(r.material.id),fb(r.material,t)))}))}return{vertices:r,triangles:n,materials:e.size,textures:t.size}}getLayerMask(){const e=this._node.userData.layerMask;return void 0===e?1:e}setLayerMask(e){this.$isContainer?this._children.forEach((t=>{t.setLayerMask(e)})):this._node.traverse((t=>{t.userData.layerMask=e}))}dispose(){if(this.$hasComponent(qx)&&(this.$getComponent(qx).dispose(),this.$removeComponent(qx)),this._children.length&&this._children.forEach((e=>e.dispose())),this._parent&&this._parent.remove(this),this._node){this._node.$unode=null;const e=this._uScene.$pickNodeCache;this._node.traverse((t=>{t.__destroyed=!0,e.releasePickCache(t),this._uScene.$effectsManager.clearAllEffects(t)})),this._node=null}this.dispatchEvent({type:"u-dispose"}),this._uScene=null,ob.clear(),lb.clear()}copy(e){return this._node.copy(e._node,!1),this._visible=e._visible,this._internalVisible=e._internalVisible,this}clone(){return new this.constructor(this._uScene).copy(this)}get $uScene(){return this._uScene}get $node(){return this._node}set $skipMatrixWorldUpdate(e){e?this._node.updateMatrix=function(){}:this._node.hasOwnProperty("updateMatrix")&&(delete this._node.updateMatrix,this._node.worldMatrixNeedsUpdate=!0)}get $skipMatrixWorldUpdate(){return this._node.hasOwnProperty("updateMatrix")}set $internalVisible(e){this._internalVisible=e,this._node.visible=this._visible&&this._internalVisible}get $internalVisible(){return this._internalVisible}$syncSceneVisible(e){const t=e&&this._visible;this._sceneVisible!==t&&(this._sceneVisible=t,this.dispatchEvent({type:"scene-visible-changed"}),this._children.forEach((e=>{e.$syncSceneVisible(t)})))}$traverse(e){e(this),this._children.forEach((t=>t.$traverse(e)))}$traverseBranch(e){e(this)&&this._children.forEach((t=>t.$traverseBranch(e)))}$traverseAncestorsBranch(e){const t=this._parent;null!==t&&e(t)&&t.$traverseAncestorsBranch(e)}$parseOptions(e){this._node.name=void 0!==e.name?e.name:"",e.userData&&this.setUserData(e.userData);let t=e.parent;return t&&t.add(this),this}$addComponent(e,t){this._components.set(e,t),t.$onAdd&&t.$onAdd(this)}$removeComponent(e){if(this._components.has(e)){let t=this._components.get(e);t.$onRemove&&t.$onRemove(this),this._components.delete(e)}}$getComponent(e){return this._components.get(e)}$hasComponent(e){return this._components.has(e)}}const gb=new bc;class _b extends mb{constructor(e){super(e),this._node=new Nd,this._node.$unode=this,this._node.matrixAutoUpdate=!1,this._sceneVisible=!0,this._node.environmentLightIntensity=0,this._instancedContainer=new od,this._instancedContainer.name="instanced-container",this._instancedContainer.position.isOrigin=!0,this._node.add(this._instancedContainer),this._pickBoxContainer=new od,this._pickBoxContainer.name="pickBox-container",this._node.add(this._pickBoxContainer),this._translationOffset=new bc,this._quaternionOffset=new Mc}get isRoot(){return!0}setInstancedOffset(e){gb.fromArray(e);const t=this._instancedContainer.position;t.equals(gb)||(gb.sub(t),t.fromArray(e),t.isOrigin=0===t.getLengthSquared(),this._instancedContainer.traverse((e=>{if(e.isInstancedMesh){const t=e.geometry.getAttribute("instanceMatrix");if(t&&1===t.divisor){const e=t.buffer,r=e.array.length,n=t.size;for(let t=0;t<r;t+=n)e.array[t+12]-=gb.x,e.array[t+13]-=gb.y,e.array[t+14]-=gb.z;e.version++}}})))}setMatrixOffset(e){this._translationOffset.fromArray(e),this._node.anchorMatrix.transform(this._translationOffset,gb.set(1,1,1),this._quaternionOffset)}$addInstancedNode(e){this._instancedContainer.add(e)}$removeInstancedNode(e){this._instancedContainer.remove(e)}$updateInstancedMatrixWorld(){this._instancedContainer.updateMatrix()}$addPickBoxNode(e){this._pickBoxContainer.add(e)}$removePickBoxNode(e){this._pickBoxContainer.remove(e)}$syncPickBoxTransform(){this._pickBoxContainer.children.length<=0||this._pickBoxContainer.children.forEach((e=>{e.syncTransform()}))}set $quaternionOffset(e){this._quaternionOffset.fromArray(e),this._node.anchorMatrix.transform(this._translationOffset,gb.set(1,1,1),this._quaternionOffset)}get $quaternionOffset(){return this._quaternionOffset.toArray()}get $instancedOffset(){return this._instancedContainer.position}}class vb{constructor(){this._resident=new Set,this._cache=new Set,this._enabled=!1,this._active=!1}set enabled(e){this._enabled=e,e||(this._active=!1)}get enabled(){return this._enabled}get active(){return this._active}addResident(e){this._resident.add(e)}removeResident(e){this._resident.delete(e)}markDirty(e){if(!this._active)return;if(this._cache.has(e))return;let t;e.$traverseAncestorsBranch((e=>!this._cache.has(e)||(t=e,!1))),t||(this._cache.add(e),e.$traverseBranch((t=>t===e||!this._cache.has(t)||(this._cache.delete(t),!1))))}update(){this._active&&this._cache.forEach((e=>{e.$node&&e.updateMatrixWorld()}))}clear(){this._enabled&&(this._cache.clear(),this._resident.forEach((e=>this._cache.add(e))),this._active=this._enabled)}clearAll(){this._cache.clear(),this._resident.clear()}}class yb{constructor(){this._dirtyEffectBuffers=!1,this._enabled=!1,this._active=!1}set enabled(e){this._enabled=e,e||(this._active=!1)}get enabled(){return this._enabled}get active(){return this._active}set dirtyEffectBuffers(e){this._active&&(this._dirtyEffectBuffers=e)}get dirtyEffectBuffers(){return this._dirtyEffectBuffers}clear(){this._enabled&&(this._active=this._enabled,this._dirtyEffectBuffers=!1)}}let xb=class e{static isType(t){const{object:r,material:n}=t;if(r.isInstancedLine)return"InstancedLine";if(e.isShaderId(t))return"Shader";switch(n.shaderName){case"CUSTOM_POINTS":return"Points";case"CUSTOM_SPRITE":return"Sprite";default:return"Common"}}static isSkinning(e){const{object:t}=e;return!(!t.isSkinnedMesh||!t.skeleton)}static isInstance(e){const{material:t}=e;return!!t.defines.USE_INSTANCING}static isDiffuseMap(e){const{material:t}=e;return!!t.diffuseMap}static isAlphaMap(e){const{material:t}=e;return!!t.alphaMap}static isEmissiveMap(e){const{material:t}=e;return!!t.emissiveMap}static isRoughnessMap(e){const{material:t}=e;return!!t.roughnessMap}static isDrawMode(e){const{material:t}=e;return t.drawMode}static isSideType(e){const{material:t}=e;return t.side}static isFlatShading(e){const{geometry:t,material:r}=e;return!t.attributes.a_Normal||r.shading===Uc.FLAT_SHADING}static isShaderId(e){const{material:t}=e;return t.useDefaultBufferMaterial?"":t.uuid}static isMerged(e){const{geometry:t}=e;return!(!t||!t.getAttribute("ids"))}static isMorphTargets(e){const{object:t}=e;return!!t.morphTargetInfluences}static isMorphNormals(e){const{object:t}=e;return!(!t.morphTargetInfluences||!t.geometry.morphAttributes.normal)}static isClipping(e){const{material:t}=e,r=t.clippingPlanes;return r&&r.length>0?r.length:0}};const bb=`\n    #define USE_GPUPICKER\n    #include <common_vert>\n    #include <logdepthbuf_pars_vert>\n    #include <morphtarget_pars_vert>\n    \n    // color_pars_vert.glsl\n    #include <color_pars_vert>\n    \n    ${tg.gpu_picker_pars_vert}\n\n    uniform float u_PointSize;\n    uniform float u_PointScale;\n\n    void main() {\n\n        #include <begin_vert>\n        #include <color_vert>\n        ${tg.gpu_picker_id_vert}\n\n        #include <morphnormal_vert>\n        #include <pvm_vert>\n        vec4 mvPosition = u_View * u_Model * vec4(transformed, 1.0);\n\n        #ifdef USE_SIZEATTENUATION\n            gl_PointSize = u_PointSize * ( u_PointScale / - mvPosition.z );\n        #else\n            gl_PointSize = u_PointSize;\n        #endif\n\n        #include <logdepthbuf_vert>\n    }\n`,Ab=`\n    #define USE_GPUPICKER\n    #include <common_frag>\n    #include <color_pars_frag>\n    #include <diffuseMap_pars_frag>\n    #include <alphamap_pars_frag>\n    #include <logdepthbuf_pars_frag>\n\n    #if defined(USE_DIFFUSE_MAP) || defined(USE_ALPHA_MAP)\n        uniform mat3 uvTransform;\n        uniform float imageRatio;\n    #endif\n\n    ${tg.gpu_picker_pars_frag}\n\n    void main() {\n\n        #include <clippingPlanes_frag>\n        #include <logdepthbuf_frag>\n        #include <begin_frag>\n        #include <color_frag>\n\n        #if defined( USE_DIFFUSE_MAP ) || defined( USE_ALPHA_MAP )\n            vec2 uv;\n            if ( imageRatio > 1.0 ) {\n                uv = ( uvTransform * vec3( gl_PointCoord.x * imageRatio + ( 1.0 - imageRatio ) / 2.0, 1.0 - gl_PointCoord.y, 1.0 ) ).xy;\n            } else {\n                uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y / imageRatio - ( 1.0 - 1.0 / imageRatio ) / 2.0, 1.0 ) ).xy;\n            }\n        #endif\n\n        // EXTERNAL\n        #if defined( USE_DIFFUSE_MAP ) || defined( USE_ALPHA_MAP )\n            #ifdef UV_DISCARD\n                if (uv.x < 0. || uv.x > 1. || uv.y < 0. || uv.y > 1.) { \n                    discard;\n                }\n            #endif\n        #endif\n\n        #ifdef USE_DIFFUSE_MAP\n            vec4 mapTexel = texture2D( diffuseMap, uv );\n            outColor *= mapTexelToLinear( mapTexel );\n        #endif\n\n        #ifdef USE_ALPHA_MAP\n            outColor.a *= texture2D( alphaMap, uv ).g;\n        #endif\n\n        #ifdef ALPHATEST\n            if ( outColor.a < ALPHATEST ) discard;\n        #endif\n\n        ${tg.gpu_picker_id_frag}\n    }\n`;class Sb extends bp{constructor(){super({vertexShader:bb,fragmentShader:Ab}),this.opacity=1,this.alphaTest=.1,this.acceptLight=!1,this.blending=Bc.NONE,this.drawMode=Kc.POINTS}set imageRatio(e){this.uniforms.imageRatio=e}get imageRatio(){return this.uniforms.imageRatio}get isPointsPickerMaterial(){return!0}syncAttribute(e){}}const Eb={MarkBuffer:(e,t)=>{const r=new bp(wb.markerShader);return r.isPointsMarkMaterial=!0,r.premultipliedAlpha=!0,r.transparent=!0,r.blending=Bc.ADD,r.drawMode=t.isDrawMode,r.defines=z_(r.defines,e.defines),r.uniforms=z_(r.uniforms,e.uniforms),r},ColorMarkBuffer:(e,t)=>{const r=new bp(wb.colorMarkerShader);return r.isPointsColorMaterial=!0,r.alphaTest=.1,r.premultipliedAlpha=!1,r.drawMode=t.isDrawMode,r.defines=z_(r.defines,e.defines),r.uniforms=z_(r.uniforms,e.uniforms),r},GBuffer:(e,t)=>{const r=new bp(wb.gbufferShader);r.isPointsGBufferMaterial=!0,r.shaderName="CUSTOM_NORMAL_GLOSSINESS",r.shading=t.isFlatShading?Uc.FLAT_SHADING:Uc.SMOOTH_SHADING,r.alphaTest=t.isDiffuseMap?.999:0,r.side=e.side,t.isInstance&&(r.defines.USE_INSTANCING=!0)},PickBuffer:(e,t)=>{const r=new Sb;return t.isMerged&&(r.defines.USE_ATTRIBUTES_ID=!0),r.uniforms=z_(r.uniforms,e.uniforms),r.defines=z_(r.defines,e.defines),r}},wb={markerShader:{name:"ec_points_mark",defines:{},uniforms:{mColor:[1,1,1,1]},vertexShader:"\n        #include <common_vert>\n        #include <morphtarget_pars_vert>\n\t\t#include <logdepthbuf_pars_vert>\n\n\t\t// color_pars_vert.glsl\n\t\t#include <color_pars_vert>\n\t\n\t\tuniform float u_PointSize;\n\t\tuniform float u_PointScale;\n\n        void main() {\n        \t#include <begin_vert>\n\t\t\t#include <color_vert>\n        \t#include <morphtarget_vert>\n        \t#include <pvm_vert>\n\n\t\t\tvec4 mvPosition = u_View * u_Model * vec4(transformed, 1.0);\n\t\t\t#ifdef USE_SIZEATTENUATION\n\t\t\t\tgl_PointSize = u_PointSize * ( u_PointScale / - mvPosition.z );\n\t\t\t#else\n\t\t\t\tgl_PointSize = u_PointSize;\n\t\t\t#endif\n\n\t\t\t#include <logdepthbuf_vert>\n        }\n    ",fragmentShader:"\n        #include <common_frag>\n\t\t#include <color_pars_frag>\n        #include <diffuseMap_pars_frag>\n\t\t#include <alphamap_pars_frag>\n\t\t#include <logdepthbuf_pars_frag>\n\n\t\t#if defined(USE_DIFFUSE_MAP) || defined(USE_ALPHA_MAP)\n\t\t\tuniform mat3 uvTransform;\n\t\t\tuniform float imageRatio;\n\t\t#endif\n\n\t\tuniform vec4 mColor;\n\n        void main() {\n\t\t\t#include <clippingPlanes_frag>\n\t\t\t#include <logdepthbuf_frag>\n\t\t\t\n\n            #if defined( USE_DIFFUSE_MAP ) || defined( USE_ALPHA_MAP )\n\t\t\t\tvec2 uv;\n\t\t\t\tif ( imageRatio > 1.0 ) {\n\t\t\t\t\tuv = ( uvTransform * vec3( gl_PointCoord.x * imageRatio + ( 1.0 - imageRatio ) / 2.0, 1.0 - gl_PointCoord.y, 1.0 ) ).xy;\n\t\t\t\t} else {\n\t\t\t\t\tuv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y / imageRatio - ( 1.0 - 1.0 / imageRatio ) / 2.0, 1.0 ) ).xy;\n\t\t\t\t}\n\t\t\t#endif\n\n\t\t\t// EXTERNAL\n\t\t\t#if defined( USE_DIFFUSE_MAP ) || defined( USE_ALPHA_MAP )\n\t\t\t\t#ifdef UV_DISCARD\n\t\t\t\t\tif (uv.x < 0. || uv.x > 1. || uv.y < 0. || uv.y > 1.) { \n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t#endif\n\n\t\t\t#ifdef ALPHATEST\n\t\t\t\t#include <begin_frag>\n\t\t\t\t#include <color_frag>\n\n\t\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\t\toutColor = texture2D( diffuseMap, uv );\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_ALPHA_MAP\n\t\t\t\t\toutColor.a *= texture2D( alphaMap, uv ).g;\n\t\t\t\t#endif\n\n\t\t\t\tif ( outColor.a < ALPHATEST ) discard;\n\t\t\t#endif\n\n\t\t\tgl_FragColor = mColor;\n        }\n    "},colorMarkerShader:{name:"ec_points_color",defines:{},uniforms:{strength:1},vertexShader:"\n        #include <common_vert>\n        #include <morphtarget_pars_vert>\n\t\t#include <logdepthbuf_pars_vert>\n\n\t\t// color_pars_vert.glsl\n\t\t#include <color_pars_vert>\n\n\t\tuniform float u_PointSize;\n\t\tuniform float u_PointScale;\n\n        void main() {\n        \t#include <begin_vert>\n\t\t\t#include <color_vert>\n        \t#include <morphtarget_vert>\n        \t#include <pvm_vert>\n\n\t\t\tvec4 mvPosition = u_View * u_Model * vec4(transformed, 1.0);\n\t\t\t#ifdef USE_SIZEATTENUATION\n\t\t\t\tgl_PointSize = u_PointSize * ( u_PointScale / - mvPosition.z );\n\t\t\t#else\n\t\t\t\tgl_PointSize = u_PointSize;\n\t\t\t#endif\n\n\t\t\t#include <logdepthbuf_vert>\n        }\n    ",fragmentShader:"\n        #include <common_frag>\n\t\t#include <color_pars_frag>\n        #include <diffuseMap_pars_frag>\n\t\t#include <alphamap_pars_frag>\n\t\t#include <logdepthbuf_pars_frag>\n\n\t\t#if defined(USE_DIFFUSE_MAP) || defined(USE_ALPHA_MAP)\n\t\t\tuniform mat3 uvTransform;\n\t\t\tuniform float imageRatio;\n\t\t#endif\n\n\t\tuniform float strength;\n\n        void main() {\n\t\t\t#include <clippingPlanes_frag>\n\t\t\t#include <logdepthbuf_frag>\n\n\t\t\t#include <begin_frag>\n\t\t\t#include <color_frag>\n\n\t\t\t#if defined( USE_DIFFUSE_MAP ) || defined( USE_ALPHA_MAP )\n\t\t\t\tvec2 uv;\n\t\t\t\tif ( imageRatio > 1.0 ) {\n\t\t\t\t\tuv = ( uvTransform * vec3( gl_PointCoord.x * imageRatio + ( 1.0 - imageRatio ) / 2.0, 1.0 - gl_PointCoord.y, 1.0 ) ).xy;\n\t\t\t\t} else {\n\t\t\t\t\tuv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y / imageRatio - ( 1.0 - 1.0 / imageRatio ) / 2.0, 1.0 ) ).xy;\n\t\t\t\t}\n\t\t\t#endif\n\n\t\t\t// EXTERNAL\n\t\t\t#if defined( USE_DIFFUSE_MAP ) || defined( USE_ALPHA_MAP )\n\t\t\t\t#ifdef UV_DISCARD\n\t\t\t\t\tif (uv.x < 0. || uv.x > 1. || uv.y < 0. || uv.y > 1.) { \n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t#endif\n\n\t\t\t#ifdef ALPHATEST\n\t\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\t\toutColor = texture2D( diffuseMap, uv );\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_ALPHA_MAP\n\t\t\t\t\toutColor.a *= texture2D( alphaMap, uv ).g;\n\t\t\t\t#endif\n\n\t\t\t\tif ( outColor.a < ALPHATEST ) discard;\n\t\t\t#endif\n\n\t\t\toutColor.rgb *= strength;\n\n            gl_FragColor = outColor;\n        }\n    "},gbufferShader:{name:"ec_gbuffer_ng",defines:{G_USE_ROUGHNESSMAP:!1},uniforms:{roughness:.5,roughnessMap:null},vertexShader:`\n\t\t\t#include <common_vert>\n\t\t\t#include <morphtarget_pars_vert>\n\t\t\t#include <skinning_pars_vert>\n\t\t\t#include <normal_pars_vert>\n\t\t\t#include <uv_pars_vert>\n\t\t\t#include <logdepthbuf_pars_vert>\n\t\t\t${eg.instance_pars_vert}\n\t\t\tvoid main() {\n\t\t\t\t#include <uv_vert>\n\t\t\t\t#include <begin_vert>\n\t\t\t\t#include <morphtarget_vert>\n\t\t\t\t#include <morphnormal_vert>\n\t\t\t\t#include <skinning_vert>\n\t\t\t\t#include <skinnormal_vert>\n\t\t\t\t${eg.instance_position_vert}\n\t\t\t\t${eg.instance_normal_vert}\n\t\t\t\t#include <normal_vert>\n\t\t\t\t#include <pvm_vert>\n\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t}\n\t\t`,fragmentShader:"\n\t\t\t#include <common_frag>\n\t\t\t#include <diffuseMap_pars_frag>\n\t\n\t\t\t#include <uv_pars_frag>\n\t\n\t\t\t#include <packing>\n\t\t\t#include <normal_pars_frag>\n\t\n\t\t\tuniform float roughness;\n\t\n\t\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\t\tuniform sampler2D roughnessMap;\n\t\t\t#endif\n\t\n\t\t\t#include <logdepthbuf_pars_frag>\n\t\n\t\t\tvoid main() {\n\t\t\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\t\tvec4 texelColor = texture2D(diffuseMap, v_Uv);\n\t\t\t\t\tfloat alpha = texelColor.a * u_Opacity;\n\t\t\t\t\tif(alpha < ALPHATEST) discard;\n\t\t\t\t#endif\n\t\n\t\t\t\t#include <logdepthbuf_frag>\n\t\n\t\t\t\tvec3 normal = normalize(v_Normal);\n\t\n\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t\t#endif \n\t\n\t\t\t\tfloat roughnessFactor = roughness;\n\t\t\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\t\t\troughnessFactor *= texture2D(roughnessMap, v_Uv).g;\n\t\t\t\t#endif\n\t\n\t\t\t\tvec4 packedNormalGlossiness;\n\t\t\t\tpackedNormalGlossiness.xyz = normal * 0.5 + 0.5;\n\t\t\t\tpackedNormalGlossiness.w = clamp(1. - roughnessFactor, 0., 1.);\n\t\t\t\t\n\t\t\t\tgl_FragColor = packedNormalGlossiness;\n\t\t\t}\n\t\t"},pickBuffer:{}},Cb={MarkBuffer:(e,t)=>{const r=new bp(Tb.markerShader);return r.isCustomMarkMaterial=!0,r.premultipliedAlpha=!0,r.transparent=!0,r.blending=Bc.ADD,r.drawMode=t.isDrawMode,r.defines=z_(r.defines,e.defines),r.uniforms=z_(r.uniforms,e.uniforms),r},ColorMarkBuffer:(e,t)=>{const r=new bp(Tb.colorMarkerShader);return r.isCustomColorMaterial=!0,r.alphaTest=.1,r.premultipliedAlpha=!1,r.drawMode=t.isDrawMode,r.defines=z_(r.defines,e.defines),r.uniforms=z_(r.uniforms,e.uniforms),r},GBuffer:(e,t)=>{const r=new bp(Tb.gbufferShader);return r.isCustomGBufferMaterial=!0,r.shaderName="CUSTOM_NORMAL_GLOSSINESS",r.shading=t.isFlatShading?Uc.FLAT_SHADING:Uc.SMOOTH_SHADING,r.alphaTest=t.isDiffuseMap?.999:0,r.side=e.side,t.isInstance&&(r.defines.USE_INSTANCING=!0),r},PickBuffer:(e,t)=>{const r=new bp(Tb.pickBufferShader);return r.isCustomPickerMaterial=!0,t.isInstance&&(r.defines.USE_INSTANCING=!0),t.isMerged&&(r.defines.USE_ATTRIBUTES_ID=!0),r}},Tb={markerShader:{name:"ec_mark",defines:{},uniforms:{mColor:[1,1,1,1]},vertexShader:`\n\t\t\t#include <common_vert>\n\t\t\t#include <morphtarget_pars_vert>\n\t\t\t#include <skinning_pars_vert>\n\t\t\t#include <uv_pars_vert>\n\t\t\t#include <alphamap_pars_vert>\n\t\t\t#include <modelPos_pars_vert>\n\t\t\t#include <logdepthbuf_pars_vert>\n\t\t\t${eg.instance_pars_vert}\n\t\t\tvoid main() {\n\t\t\t\t#include <uv_vert>\n\t\t\t\t#include <alphamap_vert>\n\t\t\t\t#include <begin_vert>\n\t\t\t\t#include <morphtarget_vert>\n\t\t\t\t#include <skinning_vert>\n\t\t\t\t${eg.instance_position_vert}\n\t\t\t\t#include <pvm_vert>\n\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t\t#include <modelPos_vert>\n\t\t\t}\n\t\t`,fragmentShader:"\n\t\t\t#include <common_frag>\n\t\t\t#include <diffuseMap_pars_frag>\n\n\t\t\t#include <modelPos_pars_frag>\n\n\t\t\t#include <alphamap_pars_frag>\n\t\n\t\t\t#include <uv_pars_frag>\n\t\n\t\t\t#include <logdepthbuf_pars_frag>\n\n\t\t\t#include <clippingPlanes_pars_frag>\n\t\n\t\t\tuniform vec4 mColor;\n\t\n\t\t\tvoid main() {\n\n\t\t\t\t#include <clippingPlanes_frag>\n\n\t\t\t\t#include <logdepthbuf_frag>\n\t\t\t\t\n\t\t\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\t\tvec4 texelColor = texture2D(diffuseMap, v_Uv);\n\t\n\t\t\t\t\t#ifdef USE_ALPHA_MAP\n\t\t\t\t\t\ttexelColor.a *= texture2D(alphaMap, vAlphaMapUV).g;\n\t\t\t\t\t#endif\n\t\n\t\t\t\t\tfloat alpha = texelColor.a * u_Opacity;\n\t\t\t\t\tif(alpha < ALPHATEST) discard;\n\t\t\t\t#endif\n\t\n\t\t\t\tgl_FragColor = mColor;\n\t\t\t}\n\t\t"},colorMarkerShader:{name:"ec_color",defines:{},uniforms:{strength:1},vertexShader:`\n\t\t\t#include <common_vert>\n\t\t\t#include <morphtarget_pars_vert>\n\t\t\t#include <skinning_pars_vert>\n\t\t\t${ig.uv_pars_vert}\n\t\t\t#include <alphamap_pars_vert>\n\t\t\t#include <emissiveMap_pars_vert>\n\t\t\t#include <modelPos_pars_vert>\n\t\t\t#include <logdepthbuf_pars_vert>\n\t\t\t${eg.instance_pars_vert}\n\t\t\tvoid main() {\n\t\t\t\t#include <uv_vert>\n\t\t\t\t#include <alphamap_vert>\n\t\t\t\t#include <begin_vert>\n\t\t\t\t#include <morphtarget_vert>\n\t\t\t\t#include <skinning_vert>\n\t\t\t\t${eg.instance_position_vert}\n\t\t\t\t#include <pvm_vert>\n\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t\t#include <modelPos_vert>\n\t\t\t\t${ig.emissivemap_vert}\n\t\t\t}\n\t\t`,fragmentShader:`\n\t\t\t#include <common_frag>\n\t\t\t#include <diffuseMap_pars_frag>\n\n\t\t\t#include <modelPos_pars_frag>\n\n\t\t\t#include <alphamap_pars_frag>\n\t\n\t\t\t#include <uv_pars_frag>\n\n\t\t\t#include <emissiveMap_pars_frag>\n\t\n\t\t\t#include <logdepthbuf_pars_frag>\n\n\t\t\t#include <clippingPlanes_pars_frag>\n\t\n\t\t\tuniform float strength;\n\n\t\t\tuniform vec3 emissive;\n\t\n\t\t\tvoid main() {\n\n\t\t\t\t#include <clippingPlanes_frag>\n\n\t\t\t\t#include <logdepthbuf_frag>\n\t\n\t\t\t\tvec4 outColor = vec4(u_Color, u_Opacity);\n\t\n\t\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\t\t#if (USE_DIFFUSE_MAP == 2)\n\t\t\t\t\t\toutColor *= texture2D(diffuseMap, v_Uv2);\n\t\t\t\t\t#else\n\t\t\t\t\t\toutColor *= texture2D(diffuseMap, v_Uv);\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\n\t\t\t\t#include <alphamap_frag>\n\n\t\t\t\tvec3 totalEmissiveRadiance = emissive;\n\t\t\t\t${ig.emissivemap_frag}\n\t\t\t\toutColor.xyz += totalEmissiveRadiance;\n\t\n\t\t\t\t#ifdef ALPHATEST\n\t\t\t\t\tif(outColor.a < ALPHATEST) discard;\n\t\t\t\t#endif\n\n\t\t\t\toutColor.rgb *= strength;\n\n\t\t\t\tgl_FragColor = outColor;\n\t\t\t}\n\t\t`},gbufferShader:{name:"ec_gbuffer_ng",defines:{G_USE_ROUGHNESSMAP:!1},uniforms:{roughness:.5,roughnessMap:null},vertexShader:`\n\t\t\t#include <common_vert>\n\t\t\t#include <morphtarget_pars_vert>\n\t\t\t#include <skinning_pars_vert>\n\t\t\t#include <normal_pars_vert>\n\t\t\t#include <uv_pars_vert>\n\t\t\t#include <modelPos_pars_vert>\n\t\t\t#include <logdepthbuf_pars_vert>\n\t\t\t${eg.instance_pars_vert}\n\t\t\tvoid main() {\n\t\t\t\t#include <uv_vert>\n\t\t\t\t#include <begin_vert>\n\t\t\t\t#include <morphtarget_vert>\n\t\t\t\t#include <morphnormal_vert>\n\t\t\t\t#include <skinning_vert>\n\t\t\t\t#include <skinnormal_vert>\n\t\t\t\t${eg.instance_position_vert}\n\t\t\t\t${eg.instance_normal_vert}\n\t\t\t\t#include <normal_vert>\n\t\t\t\t#include <pvm_vert>\n\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t\t#include <modelPos_vert>\n\t\t\t}\n\t\t`,fragmentShader:"\n\t\t\t#include <common_frag>\n\t\t\t#include <diffuseMap_pars_frag>\n\t\n\t\t\t#include <modelPos_pars_frag>\n\n\t\t\t#include <uv_pars_frag>\n\t\n\t\t\t#include <packing>\n\t\t\t#include <normal_pars_frag>\n\t\n\t\t\tuniform float roughness;\n\t\n\t\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\t\tuniform sampler2D roughnessMap;\n\t\t\t#endif\n\t\n\t\t\t#include <logdepthbuf_pars_frag>\n\n\t\t\t#include <clippingPlanes_pars_frag>\n\t\n\t\t\tvoid main() {\n\n\t\t\t\t#include <clippingPlanes_frag>\n\n\t\t\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\t\tvec4 texelColor = texture2D(diffuseMap, v_Uv);\n\t\t\t\t\tfloat alpha = texelColor.a * u_Opacity;\n\t\t\t\t\tif(alpha < ALPHATEST) discard;\n\t\t\t\t#endif\n\t\n\t\t\t\t#include <logdepthbuf_frag>\n\t\n\t\t\t\tvec3 normal = normalize(v_Normal);\n\t\n\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t\t#endif \n\t\n\t\t\t\tfloat roughnessFactor = roughness;\n\t\t\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\t\t\troughnessFactor *= texture2D(roughnessMap, v_Uv).g;\n\t\t\t\t#endif\n\t\n\t\t\t\tvec4 packedNormalGlossiness;\n\t\t\t\tpackedNormalGlossiness.xyz = normal * 0.5 + 0.5;\n\t\t\t\tpackedNormalGlossiness.w = clamp(1. - roughnessFactor, 0., 1.);\n\t\t\t\t\n\t\t\t\tgl_FragColor = packedNormalGlossiness;\n\t\t\t}\n\t\t"},pickBufferShader:{vertexShader:`\n\t\t\t#define USE_GPUPICKER\n\t\t\t#include <common_vert>\n\t\t\t#include <modelPos_pars_vert>\n\t\t\t#include <logdepthbuf_pars_vert>\n\t\t\t#include <skinning_pars_vert>\n\t\t\t${eg.instance_pars_vert}\n\t\t\t${tg.gpu_picker_pars_vert}\n\t\t\t${tg.gpu_picker_instanceStates_pars_vert}\n\t\t\t\n\t\t\tvoid main() {\n\t\t\t\t#include <begin_vert>\n\t\t\t\t#include <skinning_vert>\n\t\t\t\t${eg.instance_position_vert}\n\t\t\t\t#include <pvm_vert>\n\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t\t#include <modelPos_vert>\n\t\t\t\t${tg.gpu_picker_id_vert}\n\t\t\t\t${tg.gpu_picker_instanceStates_vert}\n\t\t\t}\n\t\t`,fragmentShader:`\n\t\t\t#define USE_GPUPICKER\n\t\t\t#include <common_frag>\n\t\t\t#include <modelPos_pars_frag>\n\t\t\t#include <logdepthbuf_pars_frag>\n\t\t\t#include <clippingPlanes_pars_frag>\n\t\t\t${tg.gpu_picker_pars_frag}\n\t\t\t${tg.gpu_picker_instanceStates_pars_frag}\n\n\t\t\tvoid main() {\n\t\t\t\t${tg.gpu_picker_instanceStates_frag}\n\n\t\t\t\t#include <clippingPlanes_frag>\n\n\t\t\t\t#include <logdepthbuf_frag>\n\t\t\t\t${tg.gpu_picker_id_frag}\n\t\t\t}\n\t\t`}},Db=`\n    #define USE_GPUPICKER\n    #include <common_vert>\n    #include <logdepthbuf_pars_vert>\n\n    attribute vec2 position;\n\tattribute vec2 uv;\n\n    uniform float rotation;\n    uniform vec2 center;\n\n    #ifdef USE_DIFFUSE_MAP\n        varying vec2 v_Uv;\n        uniform mat3 uvTransform;\n    #endif\n\n    ${tg.gpu_picker_pars_vert}\n\n    void main() {\n\n        ${tg.gpu_picker_id_vert}\n\n        #ifdef USE_DIFFUSE_MAP\n            v_Uv = (uvTransform * vec3(uv, 1.)).xy;\n        #endif\n\n        vec4 mvPosition = u_View * u_Model * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n        vec2 scale;\n        scale.x = length(vec3(u_Model[0].x, u_Model[0].y, u_Model[0].z));\n        scale.y = length(vec3(u_Model[1].x, u_Model[1].y, u_Model[1].z));\n\n        #ifndef USE_SIZEATTENUATION\n            bool isPerspective = isPerspectiveMatrix(u_Projection);\n            if (isPerspective) scale *= - mvPosition.z;\n        #endif\n\n        vec2 alignedPosition = (position.xy - (center - vec2(0.5))) * scale;\n\n        vec2 rotatedPosition;\n        rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n        rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n        vec4 finalPosition;\n\n        finalPosition = u_View * u_Model * vec4( 0.0, 0.0, 0.0, 1.0 );\n        finalPosition.xy += rotatedPosition;\n        finalPosition = u_Projection * finalPosition;\n\n        gl_Position = finalPosition;\n\n        #include <logdepthbuf_vert>\n\n    }\n`,Mb=`\n    #define USE_GPUPICKER\n\n    #include <logdepthbuf_pars_frag>\n\n    #ifdef USE_DIFFUSE_MAP\n        uniform sampler2D diffuseMap;\n        varying vec2 v_Uv;\n    #endif\n\n    uniform vec3 u_Color;\n    uniform float u_Opacity;\n\n    ${tg.gpu_picker_pars_frag}\n\n    void main() {\n        ${Jm}\n\n        #include <logdepthbuf_frag>\n\n        vec4 outColor = vec4(u_Color, u_Opacity);\n        \n        #ifdef USE_DIFFUSE_MAP\n            outColor *= texture2D( diffuseMap, v_Uv );\n        #endif\n\n        #ifdef ALPHATEST\n            if ( outColor.a < ALPHATEST ) discard;\n        #endif\n\n        ${tg.gpu_picker_id_frag}\n    }\n\n`;class Pb extends bp{constructor(){super({vertexShader:Db,fragmentShader:Mb}),this.opacity=1,this.alphaTest=.1,this.blending=Bc.NONE}get isSpritePickerMaterial(){return!0}}const Fb={MarkBuffer:(e,t)=>{const r=new bp(Rb.markerShader);return r.isSpriteMarkMaterial=!0,r.premultipliedAlpha=!0,r.transparent=!0,r.blending=Bc.ADD,r.drawMode=t.isDrawMode,r.defines=z_(r.defines,e.defines),r.uniforms=z_(r.uniforms,e.uniforms),r},ColorMarkBuffer:(e,t)=>{const r=new bp(Rb.colorMarkerShader);return r.isSpriteColorMaterial=!0,r.alphaTest=.1,r.premultipliedAlpha=!1,r.drawMode=t.isDrawMode,r.defines=z_(r.defines,e.defines),r.uniforms=z_(r.uniforms,e.uniforms),r},GBuffer:(e,t)=>{const r=new bp(Rb.gbufferShader);return r.isSpriteGBufferMaterial=!0,r.shaderName="CUSTOM_NORMAL_GLOSSINESS",r.shading=t.isFlatShading?Uc.FLAT_SHADING:Uc.SMOOTH_SHADING,r.alphaTest=t.isDiffuseMap?.999:0,r.side=e.side,t.isInstance&&(r.defines.USE_INSTANCING=!0),r},PickBuffer:(e,t)=>{const r=new Pb;return r.uniforms=z_(r.uniforms,e.uniforms),r.defines=z_(r.defines,e.defines),t.isMerged&&(r.defines.USE_ATTRIBUTES_ID=!0),r}},Rb={markerShader:{name:"ec_sprite_mark",defines:{},uniforms:{mColor:[1,1,1,1]},vertexShader:"\n\t\t\t#include <common_vert>\n\t\t\t#include <logdepthbuf_pars_vert>\n\t\t\t#include <alphamap_pars_vert>\n\t\n\t\t\tattribute vec2 position;\n\t\t\tattribute vec2 uv;\n\t\n\t\t\tuniform float rotation;\n\t\t\tuniform vec2 center;\n\t\n\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\tvarying vec2 v_Uv;\n\t\t\t\tuniform mat3 uvTransform;\n\t\t\t#endif\n\t\n\t\t\tvoid main() {\n\t\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\t\tv_Uv = (uvTransform * vec3(uv, 1.)).xy;\n\t\t\t\t#endif\n\t\n\t\t\t\t#ifdef USE_ALPHA_MAP\n\t\t\t\t\tvAlphaMapUV = (alphaMapUVTransform * vec3(uv, 1.)).xy;\n\t\t\t\t#endif\n\t\n\t\t\t\tvec4 mvPosition = u_View * u_Model * vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\n\t\t\t\tvec2 scale;\n\t\t\t\tscale.x = length(vec3(u_Model[0].x, u_Model[0].y, u_Model[0].z));\n\t\t\t\tscale.y = length(vec3(u_Model[1].x, u_Model[1].y, u_Model[1].z));\n\t\n\t\t\t\t#ifndef USE_SIZEATTENUATION\n\t\t\t\t\tbool isPerspective = isPerspectiveMatrix(u_Projection);\n\t\t\t\t\tif (isPerspective) scale *= - mvPosition.z;\n\t\t\t\t#endif\n\t\n\t\t\t\tvec2 alignedPosition = (position.xy - (center - vec2(0.5))) * scale;\n\t\n\t\t\t\tvec2 rotatedPosition;\n\t\t\t\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\t\t\t\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\t\n\t\t\t\tvec4 finalPosition;\n\t\n\t\t\t\tfinalPosition = u_View * u_Model * vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tfinalPosition.xy += rotatedPosition;\n\t\t\t\tfinalPosition = u_Projection * finalPosition;\n\t\n\t\t\t\tgl_Position = finalPosition;\n\t\n\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t}\n\t\t",fragmentShader:`\n\t\t\t#include <logdepthbuf_pars_frag>\n\t\t\t#include <alphamap_pars_frag>\n\t\t\t\n\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\tuniform sampler2D diffuseMap;\n\t\t\t\tvarying vec2 v_Uv;\n\t\t\t#endif\n\t\n\t\t\tuniform vec3 u_Color;\n\t\t\tuniform float u_Opacity;\n\t\n\t\t\tuniform vec4 mColor;\n\t\n\t\t\tvoid main() {\n\t\t\t\t${Jm}\n\t\n\t\t\t\t#include <logdepthbuf_frag>\n\t\n\t\t\t\tvec4 outColor = vec4(u_Color, u_Opacity);\n\t\t\t\t\n\t\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\t\toutColor *= texture2D( diffuseMap, v_Uv );\n\t\t\t\t#endif\n\t\n\t\t\t\t#include <alphamap_frag>\n\t\n\t\t\t\t#ifdef ALPHATEST\n\t\t\t\t\tif ( outColor.a < ALPHATEST ) discard;\n\t\t\t\t#endif\n\t\n\t\t\t\tgl_FragColor = mColor;\n\t\t\t}\n\t\t`},colorMarkerShader:{name:"ec_sprite_color",defines:{},uniforms:{strength:1},vertexShader:"\n\t\t\t#include <common_vert>\n\t\t\t#include <logdepthbuf_pars_vert>\n\t\t\t#include <alphamap_pars_vert>\n\t\n\t\t\tattribute vec2 position;\n\t\t\tattribute vec2 uv;\n\t\n\t\t\tuniform float rotation;\n\t\t\tuniform vec2 center;\n\t\n\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\tvarying vec2 v_Uv;\n\t\t\t\tuniform mat3 uvTransform;\n\t\t\t#endif\n\t\n\t\t\tvoid main() {\n\t\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\t\tv_Uv = (uvTransform * vec3(uv, 1.)).xy;\n\t\t\t\t#endif\n\t\n\t\t\t\t#ifdef USE_ALPHA_MAP\n\t\t\t\t\tvAlphaMapUV = (alphaMapUVTransform * vec3(uv, 1.)).xy;\n\t\t\t\t#endif\n\t\n\t\t\t\tvec4 mvPosition = u_View * u_Model * vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\n\t\t\t\tvec2 scale;\n\t\t\t\tscale.x = length(vec3(u_Model[0].x, u_Model[0].y, u_Model[0].z));\n\t\t\t\tscale.y = length(vec3(u_Model[1].x, u_Model[1].y, u_Model[1].z));\n\t\n\t\t\t\t#ifndef USE_SIZEATTENUATION\n\t\t\t\t\tbool isPerspective = isPerspectiveMatrix(u_Projection);\n\t\t\t\t\tif (isPerspective) scale *= - mvPosition.z;\n\t\t\t\t#endif\n\t\n\t\t\t\tvec2 alignedPosition = (position.xy - (center - vec2(0.5))) * scale;\n\t\n\t\t\t\tvec2 rotatedPosition;\n\t\t\t\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\t\t\t\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\t\n\t\t\t\tvec4 finalPosition;\n\t\n\t\t\t\tfinalPosition = u_View * u_Model * vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tfinalPosition.xy += rotatedPosition;\n\t\t\t\tfinalPosition = u_Projection * finalPosition;\n\t\n\t\t\t\tgl_Position = finalPosition;\n\t\n\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t}\n\t\t",fragmentShader:`\n\t\t\t#include <logdepthbuf_pars_frag>\n\t\t\t#include <alphamap_pars_frag>\n\t\n\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\tuniform sampler2D diffuseMap;\n\t\t\t\tvarying vec2 v_Uv;\n\t\t\t#endif\n\t\n\t\t\tuniform vec3 u_Color;\n\t\t\tuniform float u_Opacity;\n\t\n\t\t\tuniform float strength;\n\t\n\t\t\tvoid main() {\n\t\t\t\t${Jm}\n\t\n\t\t\t\t#include <logdepthbuf_frag>\n\t\n\t\t\t\tvec4 outColor = vec4(u_Color, u_Opacity);\n\t\t\t\t\n\t\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\t\toutColor *= texture2D( diffuseMap, v_Uv );\n\t\t\t\t#endif\n\t\n\t\t\t\t#include <alphamap_frag>\n\t\n\t\t\t\t#ifdef ALPHATEST\n\t\t\t\t\tif ( outColor.a < ALPHATEST ) discard;\n\t\t\t\t#endif\n\t\n\t\t\t\toutColor.rgb *= strength;\n\t\n\t\t\t\tgl_FragColor = outColor;\n\t\t\t}\n\t\t`},gbufferShader:{name:"ec_gbuffer_ng",defines:{G_USE_ROUGHNESSMAP:!1},uniforms:{roughness:.5,roughnessMap:null},vertexShader:`\n\t\t\t#include <common_vert>\n\t\t\t#include <morphtarget_pars_vert>\n\t\t\t#include <skinning_pars_vert>\n\t\t\t#include <normal_pars_vert>\n\t\t\t#include <uv_pars_vert>\n\t\t\t#include <logdepthbuf_pars_vert>\n\t\t\t${eg.instance_pars_vert}\n\t\t\tvoid main() {\n\t\t\t\t#include <uv_vert>\n\t\t\t\t#include <begin_vert>\n\t\t\t\t#include <morphtarget_vert>\n\t\t\t\t#include <morphnormal_vert>\n\t\t\t\t#include <skinning_vert>\n\t\t\t\t#include <skinnormal_vert>\n\t\t\t\t${eg.instance_position_vert}\n\t\t\t\t${eg.instance_normal_vert}\n\t\t\t\t#include <normal_vert>\n\t\t\t\t#include <pvm_vert>\n\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t}\n\t\t`,fragmentShader:"\n\t\t\t#include <common_frag>\n\t\t\t#include <diffuseMap_pars_frag>\n\t\n\t\t\t#include <uv_pars_frag>\n\t\n\t\t\t#include <packing>\n\t\t\t#include <normal_pars_frag>\n\t\n\t\t\tuniform float roughness;\n\t\n\t\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\t\tuniform sampler2D roughnessMap;\n\t\t\t#endif\n\t\n\t\t\t#include <logdepthbuf_pars_frag>\n\t\n\t\t\tvoid main() {\n\t\t\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\t\tvec4 texelColor = texture2D(diffuseMap, v_Uv);\n\t\t\t\t\tfloat alpha = texelColor.a * u_Opacity;\n\t\t\t\t\tif(alpha < ALPHATEST) discard;\n\t\t\t\t#endif\n\t\n\t\t\t\t#include <logdepthbuf_frag>\n\t\n\t\t\t\tvec3 normal = normalize(v_Normal);\n\t\n\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t\t#endif \n\t\n\t\t\t\tfloat roughnessFactor = roughness;\n\t\t\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\t\t\troughnessFactor *= texture2D(roughnessMap, v_Uv).g;\n\t\t\t\t#endif\n\t\n\t\t\t\tvec4 packedNormalGlossiness;\n\t\t\t\tpackedNormalGlossiness.xyz = normal * 0.5 + 0.5;\n\t\t\t\tpackedNormalGlossiness.w = clamp(1. - roughnessFactor, 0., 1.);\n\t\t\t\t\n\t\t\t\tgl_FragColor = packedNormalGlossiness;\n\t\t\t}\n\t\t"},pickBufferShader:{}},Nb={MarkBuffer:(e,t)=>{const r=new bp(Ib.markerShader);return r.isFatLineMarkMaterial=!0,r.premultipliedAlpha=!0,r.transparent=!0,r.blending=Bc.ADD,r.drawMode=t.isDrawMode,r.defines=z_(r.defines,e.defines),r.uniforms=z_(r.uniforms,e.uniforms),r},ColorMarkBuffer:(e,t)=>{const r=new bp(Ib.colorMarkerShader);return r.isFatLineColorMaterial=!0,r.premultipliedAlpha=!1,r.drawMode=t.isDrawMode,r.defines=z_(r.defines,e.defines),r.uniforms=z_(r.uniforms,e.uniforms),r},GBuffer:(e,t)=>e.clone(),PickBuffer:(e,t)=>{const r=e.clone();return r.isFatLinePickerMaterial=!0,r.isShaderMaterial=!0,r.defines.USE_GPUPICKER=!0,t.isMerged&&(r.defines.USE_ATTRIBUTES_ID=!0),r}},Bb="\n#include <common_vert>\n#include <logdepthbuf_pars_vert>\n\nattribute vec2 a_Uv;\n#ifdef USE_DIFFUSE_MAP\n\tvarying vec2 v_Uv;\n\tuniform mat3 uvTransform;\n#endif\n#include <alphamap_pars_vert>\n\nattribute vec3 instancePrev2;\nattribute vec3 instancePrev1;\nattribute vec3 instanceNext1;\nattribute vec3 instanceNext2;\n\nattribute float instancePrevDist;\nattribute float instanceNextDist;\n\nattribute float instancePrevDist2;\nattribute float instanceNextDist2;\n\nattribute float instancePrevBreak;\nattribute float instanceNextBreak;\n\nvarying float vDiscard;\n\nuniform float lineWidth;\nuniform vec2 resolution;\n\nuniform float cornerThreshold;\n\nvoid trimSegment(const in vec4 start, inout vec4 end) {\n\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t// conservative estimate of the near plane\n\tfloat a = u_Projection[2][2]; // 3nd entry in 3th column\n\tfloat b = u_Projection[3][2]; // 3nd entry in 4th column\n\tfloat nearEstimate = -0.5 * b / a;\n\n\tfloat alpha = (nearEstimate - start.z) / (end.z - start.z);\n\n\tend.xyz = mix(start.xyz, end.xyz, alpha);\n}\n\nvoid main() {\n\tvec3 position = a_Position;\n\n\tmat4 modelViewMatrix = u_View * u_Model;\n\n\tfloat aspect = resolution.x / resolution.y;\n\tfloat flagY = position.y * 0.5 + 0.5;\n\n\t// camera space\n\tvec4 prev = modelViewMatrix * vec4(mix(instancePrev2, instancePrev1, flagY), 1.0);\n\tvec4 curr = modelViewMatrix * vec4(mix(instancePrev1, instanceNext1, flagY), 1.0);\n\tvec4 next = modelViewMatrix * vec4(mix(instanceNext1, instanceNext2, flagY), 1.0);\n\n\tvDiscard = instancePrevBreak * instanceNextBreak;\n\tif (position.y > 0.0 && instanceNextBreak > 0.5) {\n\t\tnext = curr;\n\t} else if (position.y < 0.0 && instancePrevBreak > 0.5) {\n\t\tprev = curr;\n\t}\n\t\t\n\t// #endif\n\n\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\tbool perspective = (u_Projection[2][3] == -1.0); // 4th entry in the 3rd column\n\n\tif (perspective) {\n\t\tif (position.y < 0.) {\n\t\t\tif (curr.z < 0.0 && next.z >= 0.0) {\n\t\t\t\ttrimSegment(curr, next);\n\t\t\t} else if (next.z < 0.0 && curr.z >= 0.0) {\n\t\t\t\ttrimSegment(next, curr);\n\t\t\t}\n\n\t\t\tif (prev.z < 0.0 && curr.z >= 0.0) {\n\t\t\t\ttrimSegment(prev, curr);\n\t\t\t} else if (curr.z < 0.0 && prev.z >= 0.0) {\n\t\t\t\ttrimSegment(curr, prev);\n\t\t\t}\n\t\t} else {\n\t\t\tif (prev.z < 0.0 && curr.z >= 0.0) {\n\t\t\t\ttrimSegment(prev, curr);\n\t\t\t} else if (curr.z < 0.0 && prev.z >= 0.0) {\n\t\t\t\ttrimSegment(curr, prev);\n\t\t\t}\n\n\t\t\tif (curr.z < 0.0 && next.z >= 0.0) {\n\t\t\t\ttrimSegment(curr, next);\n\t\t\t} else if (next.z < 0.0 && curr.z >= 0.0) {\n\t\t\t\ttrimSegment(next, curr);\n\t\t\t}\n\t\t} \n\t}\n\n\t// clip space\n\tvec4 clipPrev = u_Projection * prev;\n\tvec4 clipCurr = u_Projection * curr;\n\tvec4 clipNext = u_Projection * next;\n\n\t// ndc space\n\tvec2 ndcPrev = clipPrev.xy / clipPrev.w;\n\tvec2 ndcCurr = clipCurr.xy / clipCurr.w;\n\tvec2 ndcNext = clipNext.xy / clipNext.w;\n\n\t// direction\n\tvec2 dir, dir1, dir2;\n\tfloat w = 1.0;\n\n\tif (prev == curr) {\n\t\tdir = ndcNext - ndcCurr;\n\t\tdir.x *= aspect;\n\t\tdir = normalize(dir);\n\t} else if(curr == next) {\n\t\tdir = ndcCurr - ndcPrev;\n\t\tdir.x *= aspect;\n\t\tdir = normalize(dir);\n\t} else {\n\t\tdir1 = ndcCurr - ndcPrev;\n\t\tdir1.x *= aspect;\n\t\t\n\t\tdir2 = ndcNext - ndcCurr;\n\t\tdir2.x *= aspect;\n\n\t\tdir1 = normalize(dir1);\n\t\tdir2 = normalize(dir2);\n\n\t\tdir = normalize(dir1 + dir2);\n\n\t\tw = dot(dir1, dir);\n\n\t\t#ifdef DISABLE_CORNER_BROKEN  \n\t\t\tw = 1.0 / max(w, cornerThreshold);\n\t\t#else\n\t\t\tfloat flagT = step(w, cornerThreshold);\n\t\t\tw = 1.0 / mix(w, 1.0, flagT);\n\t\t\tdir = mix(dir, mix(dir2, dir1, flagY), flagT);\n\t\t#endif\n\t}\n\n\t// perpendicular to dir\n\tvec2 offset = vec2(dir.y, -dir.x);\n\n\t// undo aspect ratio adjustment\n\toffset.x /= aspect;\n\n\t// sign flip\n\toffset *= float(sign(position.x));\n\n\t// adjust for lineWidth\n\toffset *= lineWidth * w;\n\t\n\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\toffset /= resolution.y;\n\t\n\t// select end\n\tvec4 clip = clipCurr;\n\n\t// back to clip space\n\toffset *= clip.w;\n\n\tclip.xy += offset;\n\n\tgl_Position = clip;\n\t\n\t#ifdef USE_LOGDEPTHBUF\n\t\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\t\tvFragDepth = 1.0 + gl_Position.w - logDepthCameraNear;\n\t\t\t// vIsPerspective = float( isPerspectiveMatrix( u_Projection ) );\n\t\t\tvIsPerspective = isPerspectiveMatrix( u_Projection ) ? 1.0 : 0.0;\n\t\t#else\n\t\t\tif ( isPerspectiveMatrix( u_Projection ) ) {\n\t\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w - logDepthCameraNear + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\t\tgl_Position.z *= gl_Position.w;\n\t\t\t}\n\t\t#endif\n\t#endif\n\n\t#ifdef FLAT_W\n\t\tif (gl_Position.w > -1.0) {\n\t\t\tgl_Position.xyz /= gl_Position.w;\n\t\t\tgl_Position.w = 1.0;\n\t\t}\n\t#endif\n\n\t// uv\n\t// TODO trim uv\n\tvec2 tUv = vec2(0.0, 0.0);\n\tvec2 tUv2 = vec2(0.0, 0.0);\n\n\t#ifdef SIMPLE_UV\n\t\ttUv = a_Uv;\n\t#else\n\t\t#ifdef SCREEN_UV\n\t\t\ttUv = a_Uv;\n\t\t#else\n\t\t\t#ifdef USE_ALPHA_MAP\n\t\t\t\t#if (USE_ALPHA_MAP == 3)        // whether use uv2?\n\t\t\t\t\ttUv.x = a_Uv.x;\n\t\t\t\t\ttUv.y = mix(instancePrevDist, instanceNextDist, flagY);\n\n\t\t\t\t\ttUv2.x = a_Uv.x;\n\t\t\t\t\ttUv2.y = mix(instancePrevDist2, instanceNextDist2, flagY);\n\t\t\t\t#else\n\t\t\t\t\ttUv.x = a_Uv.x;\n\t\t\t\t\ttUv.y = mix(instancePrevDist, instanceNextDist, flagY);\n\t\t\t\t#endif\n\t\t\t#else\n\t\t\t\ttUv.x = a_Uv.x;\n\t\t\t\ttUv.y = mix(instancePrevDist, instanceNextDist, flagY);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t#ifdef SWAP_UV\n\t\ttUv = tUv.yx;\n\t\ttUv2 = tUv2.yx;\n\t#endif\n\n\t#ifdef USE_DIFFUSE_MAP\n\t\tv_Uv = (uvTransform * vec3(tUv, 1.)).xy;\n\t#endif\n\t#ifdef USE_ALPHA_MAP\n\t\t#if (USE_ALPHA_MAP == 3)\n\t\t\tvAlphaMapUV = (alphaMapUVTransform * vec3(tUv2, 1.)).xy;\n\t\t#else\n\t\t\tvAlphaMapUV = (alphaMapUVTransform * vec3(tUv, 1.)).xy;\n\t\t#endif\n\t#endif\n}\n",Ib={markerShader:{name:"ec_fatLine_mark",defines:{},uniforms:{mColor:[1,1,1,1]},vertexShader:Bb,fragmentShader:`\n\t\t\t#include <common_frag>\n\t\t\t#include <fog_pars_frag>\n\t\t\t#include <logdepthbuf_pars_frag>\n\t\n\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\tvarying vec2 v_Uv;\n\t\t\t\tuniform sampler2D diffuseMap;\n\t\t\t#endif\n\t\t\t#include <alphamap_pars_frag>\n\t\n\t\t\t#ifdef USE_FOG\n\t\t\t\tvarying float vDepth;\n\t\t\t#endif\n\t\n\t\t\tvarying float vDiscard;\n\t\n\t\t\tuniform vec4 mColor;\n\t\n\t\t\tvoid main() {\n\t\t\t\t\n\t\t\t\tif (vDiscard > 0.5) {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t\n\t\t\t\t${Jm}\n\t\n\t\t\t\tvec4 outColor = vec4(u_Color, u_Opacity);\n\t\n\t\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\t\toutColor *= texture2D(diffuseMap, v_Uv);\n\t\t\t\t#endif\n\t\n\t\t\t\t#ifdef USE_ALPHA_MAP\n\t\t\t\t\toutColor.a *= texture2D(alphaMap, vAlphaMapUV).g;\n\t\t\t\t#endif\n\t\n\t\t\t\t#ifdef ALPHATEST\n\t\t\t\t\tif ( outColor.a < ALPHATEST ) discard;\n\t\t\t\t#endif\n\t\t\t\t\n\t\t\t\t#include <logdepthbuf_frag>\n\t\n\t\t\t\tgl_FragColor = mColor;\n\t\t\t}\n\t\t`},colorMarkerShader:{name:"ec_fatLine_color",defines:{},uniforms:{strength:1},vertexShader:Bb,fragmentShader:`\n\t\t\t#include <common_frag>\n\t\t\t#include <fog_pars_frag>\n\t\t\t#include <logdepthbuf_pars_frag>\n\t\n\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\tvarying vec2 v_Uv;\n\t\t\t\tuniform sampler2D diffuseMap;\n\t\t\t#endif\n\t\t\t#include <alphamap_pars_frag>\n\t\n\t\t\tvarying float vDiscard;\n\t\n\t\t\tuniform float strength;\n\t\n\t\t\tvoid main() {\n\t\t\t\t#include <logdepthbuf_frag>\n\t\n\t\t\t\tif (vDiscard > 0.5) {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t\n\t\t\t\t${Jm}\n\t\n\t\t\t\tvec4 outColor = vec4(u_Color, u_Opacity);\n\t\n\t\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\t\toutColor *= texture2D(diffuseMap, v_Uv);\n\t\t\t\t#endif\n\t\n\t\t\t\t#ifdef USE_ALPHA_MAP\n\t\t\t\t\toutColor.a *= texture2D(alphaMap, vAlphaMapUV).g;\n\t\t\t\t#endif\n\t\n\t\t\t\t#ifdef ALPHATEST\n\t\t\t\t\tif ( outColor.a < ALPHATEST ) discard;\n\t\t\t\t#endif\n\t\t\t\t\n\t\t\t\toutColor.rgb *= strength;\n\t\n\t\t\t\tgl_FragColor = outColor;\n\t\t\t}\n\t\t`},gbufferShader:{},pickBufferShader:{}},Ob={MarkBuffer:(e,t)=>{const r=e.clone();return r.isShaderMaterial=!0,r.isShaderMarkMaterial=!0,r.shaderName="CUSTOM_EC_MARK",r.defines.USE_MARK_BUFFER=!0,r.premultipliedAlpha=!0,r.transparent=!0,r.blending=Bc.ADD,r.drawMode=t.isDrawMode,r},ColorMarkBuffer:(e,t)=>{const r=e.clone();return r.isShaderMaterial=!0,r.isShaderColorMaterial=!0,r.shaderName="CUSTOM_EC_COLOR",r.defines.USE_COLOR_MARK_BUFFER=!0,r.alphaTest=.1,r.premultipliedAlpha=!1,r.drawMode=t.isDrawMode,r},GBuffer:(e,t)=>{const r=e.clone();return r.isShaderMaterial=!0,r.isShaderGBufferMaterial=!0,r.shaderName="CUSTOM_NORMAL_GLOSSINESS",r.defines.USE_GBUFFER=!0,r.shading=t.isFlatShading?Uc.FLAT_SHADING:Uc.SMOOTH_SHADING,r.alphaTest=t.isDiffuseMap?.999:0,r.side=e.side,t.isInstance&&(r.defines.USE_INSTANCING=!0),r},PickBuffer:(e,t)=>{const r=e.clone();return r.isShaderPickerMaterial=!0,r.isShaderMaterial=!0,r.defines.USE_GPUPICKER=!0,t.isMerged&&(r.defines.USE_ATTRIBUTES_ID=!0),r}};class kb{constructor(e="Default",t=[]){this._bufferName=e,this._version_key=`_prevVersion_${e}`,this._bufferFocus=t,this._map=new Map,this._weakMap=new WeakMap,this._materialStates={}}getMaterial(e){const{material:t}=e,r=this._weakMap,n=this._version_key;let i=r.get(t);if(i&&t.userData[n]===t.version){const{material:t}=i;return this._syncAttribute(t,e),t}const a=this._materialStates;for(const e in a)delete a[e];const s=this._bufferFocus;for(let t=0,r=s.length;t<r;t++){const r=s[t];a[r]=xb[r](e)}const o=this._getCacheKey(),l=this._map;let u=l.get(o);if(!u){const t=this._createMaterial(this._bufferName,e);u={refCount:0,material:t},l.set(o,u)}r.has(t)&&i.refCount--,t.userData=t.userData||{},t.userData[n]=t.version,r.set(t,u),u.refCount++;const c=()=>{t.removeEventListener("dispose",c),r.delete(t),u.refCount--,u.refCount<=0&&l.delete(o)};return t.addEventListener("dispose",c),this._syncAttribute(u.material,e),u.material}_createMaterial(e,t){switch(this._materialStates.isType){case"Common":return Cb[e](t.material,this._materialStates);case"Points":return Eb[e](t.material,this._materialStates);case"Sprite":return Fb[e](t.material,this._materialStates);case"InstancedLine":return Nb[e](t.material,this._materialStates);case"Shader":return Ob[e](t.material,this._materialStates)}}_getCacheKey(){let e="";for(let t in this._materialStates)e+=`${t}:${this._materialStates[t]}-`;return e}_syncAttribute(){}dispose(){this._bufferFocus=[],this._map.clear(),this._materialStates={}}}class Lb extends kb{constructor(){super("ColorMarkBuffer",["isSkinning","isInstance","isMorphTargets","isDiffuseMap","isAlphaMap","isType","isDrawMode","isClipping","isEmissiveMap"])}_syncAttribute(e,t){const{material:r}=t;e.isPointsColorMaterial||e.isSpriteColorMaterial||e.isFatLineColorMaterial?z_(e.uniforms,r.uniforms):e.isShaderColorMaterial&&(e.uniforms=r.uniforms),e.transparent=r.transparent,e.opacity=r.opacity,e.blending=r.blending,e.depthTest=r.depthTest,e.depthWrite=r.depthWrite,e.colorWrite=r.colorWrite,e.drawMode=r.drawMode,e.side=r.side,e.diffuse.copy(r.diffuse),e.diffuseMap=r.diffuseMap,e.diffuseMapTransform.copy(r.diffuseMapTransform),e.diffuseMapCoord=r.diffuseMapCoord,e.alphaMap=r.alphaMap,e.alphaMapTransform.copy(r.alphaMapTransform),e.alphaMapCoord=r.alphaMapCoord,e.emissive.copy(r.emissive),e.emissiveMap=r.emissiveMap,e.emissiveMapTransform.copy(r.emissiveMapTransform),e.emissiveMapCoord=r.emissiveMapCoord,e.clippingPlanes=r.clippingPlanes}}class Ub extends kb{constructor(){super("MarkBuffer",["isSkinning","isInstance","isMorphTargets","isDiffuseMap","isAlphaMap","isType","isDrawMode","isClipping"])}_syncAttribute(e,t){const{material:r}=t;e.isPointsMarkMaterial||e.isSpriteMarkMaterial||e.isFatLineMarkMaterial?z_(e.uniforms,r.uniforms):e.isShaderMarkMaterial&&(e.uniforms=r.uniforms),e.opacity=r.opacity,e.depthTest=r.depthTest,e.depthWrite=r.depthWrite,e.colorWrite=r.colorWrite,e.drawMode=r.drawMode,e.diffuseMap=r.diffuseMap,e.diffuseMapTransform.copy(r.diffuseMapTransform),e.diffuseMapCoord=r.diffuseMapCoord,e.alphaMap=r.alphaMap,e.alphaMapTransform.copy(r.alphaMapTransform),e.alphaMapCoord=r.alphaMapCoord,e.clippingPlanes=r.clippingPlanes}}class zb extends kb{constructor(){super("GBuffer",["isSkinning","isInstance","isMorphTargets","isRoughnessMap","isDiffuseMap","isMorphNormals","isSideType","isFlatShading","isType","isClipping"])}_syncAttribute(e,t){const{material:r}=t;e.clippingPlanes=r.clippingPlanes,e.depthTest=r.depthTest,e.depthWrite=r.depthWrite,e.colorWrite=r.colorWrite,e.drawMode=r.drawMode}}class jb extends kb{constructor(){super("PickBuffer",["isSkinning","isInstance","isShaderId","isAlphaMap","isDiffuseMap","isMerged","isType","isClipping"])}_syncAttribute(e,t){const{object:r,material:n}=t;e.isPointsPickerMaterial||e.isSpritePickerMaterial||e.isFatLinePickerMaterial?(z_(e.uniforms,n.uniforms),z_(e.defines,n.defines)):e.isShaderMaterial&&(e.uniforms=n.uniforms,z_(e.defines,n.defines)),e.uniforms.baseId=r.id,e.diffuseMap=n.diffuseMap,e.alphaMap=n.alphaMap,e.side=n.side,e.depthTest=n.depthTest,e.depthWrite=n.depthWrite,e.colorWrite=n.colorWrite,e.drawMode=n.drawMode,e.clippingPlanes=n.clippingPlanes}}var Vb=new bc,Gb={computeNormals:function(e){var t=e.index,r=e.attributes,n=r.a_Position;if(void 0!==n){var i=r.a_Normal;if(void 0===i)i=new up(new cp(new Float32Array(3*n.buffer.count),3)),e.addAttribute("a_Normal",i);else{for(let e=0;e<i.buffer.array.length;e++)i.buffer.array[e]=0;i.buffer.version++}var a=new bc,s=new bc,o=new bc,l=new bc,u=new bc,c=new bc,h=new bc,d=new bc;if(t)for(let e=0,r=t.buffer.count;e<r;e+=3){var p=t.buffer.array[e+0],f=t.buffer.array[e+1],m=t.buffer.array[e+2];a.fromArray(n.buffer.array,3*p),s.fromArray(n.buffer.array,3*f),o.fromArray(n.buffer.array,3*m),h.subVectors(o,s),d.subVectors(a,s),h.cross(d),l.fromArray(i.buffer.array,3*p),u.fromArray(i.buffer.array,3*f),c.fromArray(i.buffer.array,3*m),l.add(h),u.add(h),c.add(h),l.toArray(i.buffer.array,3*p),u.toArray(i.buffer.array,3*f),c.toArray(i.buffer.array,3*m)}else for(let e=0,t=3*n.buffer.count;e<t;e+=9)a.fromArray(n.buffer.array,e+0),s.fromArray(n.buffer.array,e+3),o.fromArray(n.buffer.array,e+6),h.subVectors(o,s),d.subVectors(a,s),h.cross(d),h.toArray(i.buffer.array,e+0),h.toArray(i.buffer.array,e+3),h.toArray(i.buffer.array,e+6);this.normalizeNormals(e)}else console.warn("t3d.Geometry: Missing required attributes (position) in GeometryUtils.computeNormals()")},normalizeNormals:function(e){const t=e.attributes.a_Normal.buffer;for(let e=0;e<t.array.length;e+=3)Vb.fromArray(t.array,e),Vb.normalize(),Vb.toArray(t.array,e)},computeTangents:function(e){var t=e.index,r=e.attributes;if(null!==t&&void 0!==r.a_Position&&void 0!==r.a_Normal&&void 0!==r.a_Uv){var n=t.buffer.array,i=r.a_Position.buffer.array,a=r.a_Normal.buffer.array,s=r.a_Uv.buffer.array,o=i.length/3;void 0===r.tangent&&e.addAttribute("a_Tangent",new up(new cp(new Float32Array(4*o),4)));for(var l=r.a_Tangent.buffer.array,u=[],c=[],h=0;h<o;h++)u[h]=new bc,c[h]=new bc;var d=new bc,p=new bc,f=new bc,m=new xh,g=new xh,_=new xh,v=new bc,y=new bc,x=e.groups;0===x.length&&(x=[{start:0,count:n.length}]);h=0;for(var b=x.length;h<b;++h)for(var A=R=(F=x[h]).start,S=R+F.count;A<S;A+=3)N(n[A+0],n[A+1],n[A+2]);var E,w,C,T=new bc,D=new bc,M=new bc,P=new bc;for(h=0,b=x.length;h<b;++h){var F,R;for(A=R=(F=x[h]).start,S=R+F.count;A<S;A+=3)B(n[A+0]),B(n[A+1]),B(n[A+2])}}else console.warn("t3d.Geometry: Missing required attributes (index, position, normal or uv) in GeometryUtils.computeTangents()");function N(e,t,r){d.fromArray(i,3*e),p.fromArray(i,3*t),f.fromArray(i,3*r),m.fromArray(s,2*e),g.fromArray(s,2*t),_.fromArray(s,2*r),p.sub(d),f.sub(d),g.sub(m),_.sub(m);var n=1/(g.x*_.y-_.x*g.y);isFinite(n)&&(v.copy(p).multiplyScalar(_.y).addScaledVector(f,-g.y).multiplyScalar(n),y.copy(f).multiplyScalar(g.x).addScaledVector(p,-_.x).multiplyScalar(n),u[e].add(v),u[t].add(v),u[r].add(v),c[e].add(y),c[t].add(y),c[r].add(y))}function B(e){M.fromArray(a,3*e),P.copy(M),w=u[e],T.copy(w),T.sub(M.multiplyScalar(M.dot(w))).normalize(),D.crossVectors(P,w),C=D.dot(c[e]),E=C<0?-1:1,l[4*e]=T.x,l[4*e+1]=T.y,l[4*e+2]=T.z,l[4*e+3]=-E}},mergeGeometries:function(e,t){for(var r=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),i={},a=new _p,s=0,o=0;o<e.length;++o){var l=e[o];if(r!==(null!==l.index))return null;for(var u in l.attributes){if(!n.has(u))return null;void 0===i[u]&&(i[u]=[]),i[u].push(l.attributes[u])}if(t){var c;if(r)c=l.index.buffer.count;else{if(void 0===l.attributes.a_Position)return null;c=l.attributes.a_Position.buffer.count}a.addGroup(s,c,o),s+=c}}if(r){var h=0,d=[];for(o=0;o<e.length;++o){for(var p=e[o].index,f=0;f<p.buffer.count;++f)d.push(p.buffer.array[f]+h);h+=e[o].attributes.a_Position.buffer.count}a.setIndex(d)}for(var u in i){var m=this.mergeBufferAttributes(i[u]);if(!m)return null;a.addAttribute(u,m)}return a},mergeBufferAttributes:function(e){for(var t,r,n,i=0,a=0;a<e.length;++a){var s=e[a];if(s.buffer.stride!==s.size)return null;if(void 0===t&&(t=s.buffer.array.constructor),t!==s.buffer.array.constructor)return null;if(void 0===r&&(r=s.size),r!==s.size)return null;if(void 0===n&&(n=s.normalized),n!==s.normalized)return null;i+=s.buffer.array.length}var o=new t(i),l=0;for(a=0;a<e.length;++a)o.set(e[a].buffer.array,l),l+=e[a].buffer.array.length;return new up(new cp(o,r),r,0,n)},applyMatrix4:function(){var e=new bc,t=new Ph;return function(r,n,i){var a,s,o=r.attributes.a_Position;if(void 0!==o){a=o.buffer.array,s=o.buffer.count;for(var l=0;l<s;l++)e.fromArray(a,3*l),e.applyMatrix4(n),e.toArray(a,3*l);o.buffer.version++}var u=r.attributes.a_Normal;if(void 0!==u){a=u.buffer.array,s=u.buffer.count;var c=t.setFromMatrix4(n).inverse().transpose();for(l=0;l<s;l++)e.fromArray(a,3*l),e.applyMatrix3(c).normalize(),e.toArray(a,3*l);u.buffer.version++}var h=r.attributes.a_Tangent;if(void 0!==h){a=h.buffer.array,s=h.buffer.count;for(l=0;l<s;l++)e.fromArray(a,3*l),e.transformDirection(n),e.toArray(a,3*l);h.buffer.version++}null!==r.boundingBox&&i&&r.computeBoundingBox(),null!==r.boundingSphere&&i&&r.computeBoundingSphere()}}(),getWireframeAttribute(e){const t=[],r=e.index,n=e.attributes.a_Position;if(null!==r){const e=r.buffer.array;for(let r=0,n=e.length;r<n;r+=3){const n=e[r+0],i=e[r+1],a=e[r+2];t.push(n,i,i,a,a,n)}}else{for(let e=0,r=n.buffer.array.length/3-1;e<r;e+=3){const r=e+0,n=e+1,i=e+2;t.push(r,n,n,i,i,r)}}return new up(new cp(n.buffer.array.length/3>65536?new Uint32Array(t):new Uint16Array(t),1))}};class Wb{constructor(){this._weakMap=new WeakMap}getGeometry(e){return e.material.wireframe?this._getWireframeGeometry(e.geometry):e.geometry}_getWireframeGeometry(e){const t=this._weakMap;if(t.has(e))return t.get(e);{const r=new _p;r.attributes=e.attributes,r.morphAttributes=e.morphAttributes,r.index=Gb.getWireframeAttribute(e),r.boundingBox=e.boundingBox,r.boundingSphere=e.boundingSphere,r.instanceCount=e.instanceCount,t.set(e,r);const n=e=>{const r=e.target;r.removeEventListener("dispose",n),t.has(r)&&(t.get(r).dispose(),t.delete(r))};return e.addEventListener("dispose",n),r}}}const Hb=new Sc,qb=new Sc,Xb=new Sc,Qb=new Mc,Kb=new Mc;class Yb extends eh{constructor(){super(),this._root=new _b(this),this._overlayRoot=new _b(this),this.$pickNodeCache=new Ux,this.$auxiliaryMarkerBufferManager=new Ub,this.$auxiliaryColorMarkerBufferManager=new Lb,this.$auxiliaryGBufferManager=new zb,this.$auxiliaryPickBufferManager=new jb,this.$wireframeManager=new Wb,this.$materialDisposeManager=new Lx,this.$transformCache=new vb,this.$effectsManager=new Ix,this.$effectsBufferDirtyManager=new yb;const e=new om;this._renderInfo=e,this._renderInfoCollection={drawCalls:0,points:0,triangles:0,lines:0,textures:0,geometries:0,nodes:0,programs:0,materials:0},this.$animationPlayers=new Set,this.$ikSolvers=new Set,this.$textureAnimationPlayers=new Set,this.$billboardProcessors=new Set,this.$subNodeAttachers=new Set,this._resolution=new xh(512,512),this._renderOptions={environment:{quaternion:null}},this._skyBox=null}enable(e,t){"TransformCache"===e?this.$transformCache.enabled=t:"EffectsBufferDirty"===e&&(this.$effectsBufferDirtyManager.enabled=t)}isEnabled(e){return"TransformCache"===e?this.$transformCache.enabled:"EffectsBufferDirty"===e?this.$effectsBufferDirtyManager.enabled:void 0}getRoot(){return this._root}getOverlayRoot(){return this._overlayRoot}setEnvironment(e){e?e.$texture.isTextureCube?this._root.$node.environment=e.$texture:console.warn("The environment map has been set with an invalid texture type!"):this._root.$node.environment=null}setEnvironmentLightIntensity(e){this._root.$node.environmentLightIntensity=e}setSkyBox(e){this._skyBox=e}setRenderOptions(e){this._renderOptions=e;const t=e.environment.quaternion;if(t){if(this._skyBox){const e=this._skyBox.material.uniforms;Qb.fromArray(t),Qb.toMatrix4(Hb),Kb.fromArray(this._root.$quaternionOffset),Kb.toMatrix4(Xb),Xb.inverse(),qb.fromArray(e.rotationMatrix),qb.multiply(Xb),qb.multiply(Hb),qb.toArray(e.rotationMatrix)}this._root.$quaternionOffset=t}}getRenderOptions(){return this._renderOptions}beforeRender(e){this.$animationPlayers.size>0&&(this.$animationPlayers.forEach((t=>t.$update(e))),this.$effectsBufferDirtyManager.dirtyEffectBuffers=!0),this.$ikSolvers.size>0&&this.$ikSolvers.forEach((e=>e.$update())),this.$textureAnimationPlayers.size>0&&this.$textureAnimationPlayers.forEach((t=>t.$update(e))),this.$transformCache.active?(this.$transformCache.update(),this._root.$updateInstancedMatrixWorld(),this._overlayRoot.$updateInstancedMatrixWorld()):(this._root.$node.updateMatrix(),this._overlayRoot.$node.updateMatrix()),this.$subNodeAttachers.size>0&&this.$subNodeAttachers.forEach((e=>e.$update())),this._root.$syncPickBoxTransform()}afterRender(e){this.$materialDisposeManager.update(e),this.$transformCache.clear(),this.$effectsManager.getStates().forEach((e=>{e.enableChanged&&(e.enableChanged=!1),e.dirty&&(e.dirty=!1)})),this.$effectsManager._states.clearDisableStates()}getRenderState(){return this._renderInfoCollection}dispose(){this._root&&(this._root.dispose(),this._root=null),this._overlayRoot&&(this._overlayRoot.dispose(),this._overlayRoot=null),this.$pickNodeCache.dispose(),this.$materialDisposeManager.clear(),this.$transformCache.clearAll(),this.$auxiliaryMarkerBufferManager.dispose(),this.$auxiliaryColorMarkerBufferManager.dispose(),this.$auxiliaryGBufferManager.dispose(),this.$auxiliaryPickBufferManager.dispose()}clearCache(e){if(!this._root||!e)return;const t=this._root._node.getRenderQueue(e._node);t&&t.layerMap.forEach((e=>{e._cache=[]}))}$syncResolution(e){this._resolution.equals(e._size)||(this._resolution.copy(e._size),this.dispatchEvent({type:"u-scene-resize",resolution:this._resolution}))}get $resolution(){return this._resolution}}class Zb{constructor(e,t){this.ray=new jh(e,t)}set(e,t){this.ray.set(e,t)}setFromCamera(e,t,r){"orthographic"==(r=r||"perspective")?(this.ray.origin.set(e.x,e.y,t.projectionMatrix.elements[14]).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.worldMatrix)):(this.ray.origin.setFromMatrixPosition(t.worldMatrix),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize())}intersectObject(e,t){const r=[];return $b(e,this,r,t),r.sort(Jb),r}intersectObjects(e,t){const r=[];if(!1===Array.isArray(e))return console.warn("Raycaster.intersectObjects: objects is not an Array."),r;for(let n=0,i=e.length;n<i;n++)$b(e[n],this,r,t);return r.sort(Jb),r}}function Jb(e,t){return e.distance-t.distance}function $b(e,t,r,n){if(e.raycast(t.ray,r),!0===n){const n=e.children;for(let e=0,i=n.length;e<i;e++)$b(n[e],t,r,!0)}}class eA{constructor(){this.opFlags=new tA,this.texFlags=new tA,this.otherFlags=new tA,this.resetValues()}isOrigin(){return this.opFlags.isOrigin()&&this.texFlags.isOrigin()&&this.otherFlags.isOrigin()}copy(e){this.colorOp=e.colorOp,this.opacityOp=e.opacityOp,this.roughnessOp=e.roughnessOp,this.metalnessOp=e.metalnessOp,this.emissiveOp=e.emissiveOp,this.diffuseTex=e.diffuseTex,this.uvMatrix=e.uvMatrix?e.uvMatrix.clone():null,this.alphaTex=e.alphaTex,this.alphaUvMatrix=e.alphaUvMatrix?e.alphaUvMatrix.clone():null,this.envTex=e.envTex,this.envMapIntensity=e.envMapIntensity,this.closeEnvTex=e.closeEnvTex,this.aoTex=e.aoTex,this.aoMapIntensity=e.aoMapIntensity,this.colorMappingTex=e.colorMappingTex,this.colorMappingIntensity=e.colorMappingIntensity,this.normalTex=e.normalTex,this.emissiveTex=e.emissiveTex,this.emissiveUvMatrix=e.emissiveUvMatrix?e.emissiveUvMatrix.clone():null,this.verticalEmissive=e.verticalEmissive,this.specularFactor=e.specularFactor,this.fresnelInverse=e.fresnelInverse,this.fresnelPower=e.fresnelPower,this.transparent=e.transparent,this.blending=e.blending,this.side=e.side,this.clippingPlanes=e.clippingPlanes?e.clippingPlanes.map((e=>e.clone())):null,this.wireframe=e.wireframe,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.lights=e.lights,this.uniforms=e.uniforms?j_(e.uniforms):null,this.defines=e.defines?j_(e.defines):null,this.opFlags.copy(e.opFlags),this.texFlags.copy(e.texFlags),this.otherFlags.copy(e.otherFlags)}resetValues(){this.colorOp=sA.colorOp,this.opacityOp=sA.opacityOp,this.roughnessOp=sA.roughnessOp,this.metalnessOp=sA.metalnessOp,this.emissiveOp=sA.emissiveOp,this.diffuseTex=sA.diffuseTex,this.uvMatrix=sA.uvMatrix,this.alphaTex=sA.alphaTex,this.alphaUvMatrix=sA.alphaUvMatrix,this.envTex=sA.envTex,this.envMapIntensity=sA.envMapIntensity,this.closeEnvTex=sA.closeEnvTex,this.aoTex=sA.aoTex,this.aoMapIntensity=sA.aoMapIntensity,this.colorMappingTex=sA.colorMappingTex,this.colorMappingIntensity=sA.colorMappingIntensity,this.normalTex=sA.normalTex,this.emissiveTex=sA.emissiveTex,this.emissiveUvMatrix=sA.emissiveUvMatrix,this.verticalEmissive=sA.verticalEmissive,this.specularFactor=sA.specularFactor,this.fresnelInverse=sA.fresnelInverse,this.fresnelPower=sA.fresnelPower,this.transparent=sA.transparent,this.blending=sA.blending,this.side=sA.side,this.clippingPlanes=sA.clippingPlanes,this.wireframe=sA.wireframe,this.depthTest=sA.depthTest,this.depthWrite=sA.depthWrite,this.lights=sA.lights,this.uniforms=sA.uniforms,this.defines=sA.defines}resetFlags(){this.opFlags.reset(),this.texFlags.reset(),this.otherFlags.reset()}reset(){this.resetValues(),this.resetFlags()}}class tA{constructor(){this._value=0}enable(e,t=!0){const r=this._value;return t?this._value|=e:this._value&e&&(this._value^=e),r!=this._value}has(e){return!!(this._value&e)}isOrigin(){return 0===this._value}copy(e){this._value=e._value}reset(){this._value=0}}const rA=(e=[],t={})=>{for(let r=0,n=e.length;r<n;r++){t[e[r]]=1<<r}return t},nA={colorOp:null,opacityOp:null,roughnessOp:null,metalnessOp:null,emissiveOp:null},iA={diffuseTex:null,uvMatrix:null,envTex:null,envMapIntensity:1,closeEnvTex:null,alphaTex:null,alphaUvMatrix:null,aoTex:null,aoMapIntensity:1,emissiveTex:null,emissiveUvMatrix:null,verticalEmissive:!1,normalTex:null,normalTex:null,colorMappingTex:null,colorMappingIntensity:1},aA={specularFactor:1,fresnelPower:0,fresnelInverse:!1,transparent:null,blending:null,side:null,clippingPlanes:null,wireframe:null,depthTest:null,depthWrite:null,lights:!0,uniforms:null,defines:null},sA={...nA,...iA,...aA},oA=rA(Object.keys(nA));rA(Object.keys(iA),oA),rA(Object.keys(aA),oA);const lA=function(e){const t=e.clone();return e._$hasDefaultTextureAnimation&&(t.diffuseMapTransform=e.diffuseMapTransform,t.alphaMapTransform=e.alphaMapTransform,t.emissiveMapTransform=e.emissiveMapTransform),t};class uA{constructor(e){this._map=new Map,this._reverseMap=new Map,this._reflectFunction=e||lA,this._active=!!e}get active(){return this._active}setByNodes(e){this._active||(e.forEach((e=>this.setByNode(e))),this._active=!0)}clearByNodes(e){this._active&&(e.forEach((e=>this.clearByNode(e))),this._active=!1)}setByNode(e,t){return e.$isContainer||e.$getRenderableList().forEach((e=>{if(Array.isArray(e.material))e.material=e.material.map((e=>{let r=this._setReflect(e);return t&&1===r.count&&t.push({reflectMaterial:r.material,originMaterial:e}),r.material}));else{let r=this._setReflect(e.material);t&&1===r.count&&t.push({reflectMaterial:r.material,originMaterial:e.material}),e.material=r.material}})),t}addByNode(e){e.$isContainer||e.$getRenderableList().forEach((e=>{if(Array.isArray(e.material)){const t=e.material;for(let e=0,r=t.length;e<r;e++){const r=t[e];this._addReflectByMaterial(r)}}else this._addReflectByMaterial(e.material)}))}clearByNode(e){if(e.$isContainer)return;let t=e.$uScene.$materialDisposeManager;e.$getRenderableList().forEach((e=>{if(Array.isArray(e.material))e.material=e.material.map((e=>{let r=this._reverseMap.get(e);return this._deleteReflectByMaterial(e,t),r}));else{let r=this._reverseMap.get(e.material);this._deleteReflectByMaterial(e.material,t),e.material=r}}))}getAllReflects(){return this._map}isEmpty(){return 0===this._map.size&&0===this._reverseMap.size}dispose(){this._map.forEach((e=>e.material.dispose())),this._map.clear(),this._reverseMap.clear()}_setReflect(e){let t;if(this._map.has(e))t=this._map.get(e);else{let r=this._reflectFunction(e);t={count:0,material:r},this._map.set(e,t),this._reverseMap.set(r,e)}return t.count++,t}_addReflectByMaterial(e){const t=this._reverseMap.get(e);this._map.get(t).count++}_deleteReflectByMaterial(e,t){let r=this._reverseMap.get(e),n=this._map.get(r);n.count--,0===n.count&&(t.push(e),this._map.delete(r),this._reverseMap.delete(e))}}const cA=["glow","innerGlow","lineBloom","tailing","radial","ghosting"],hA=["glow"],dA=e=>e?(hA[0]=e,hA):cA;class pA{constructor(e){this._style=e,this._state={glow:null,innerGlow:null,lineBloom:null,tailing:null,radial:null,ghosting:null},this._outline=!1,this._outlineColor=new Eh(1,1,1)}equals(e){const t=this._state,r=e._state;return t.glow===r.glow&&t.innerGlow===r.innerGlow&&t.lineBloom===r.lineBloom&&t.tailing===r.tailing&&t.radial===r.radial&&t.ghosting===r.ghosting&&this._outline===e._outline&&this._outlineColor.r===e._outlineColor.r&&this._outlineColor.g===e._outlineColor.g&&this._outlineColor.b===e._outlineColor.b}setState(e,t){const r=this._state;"glow1"!=e&&"glow2"!=e&&"glow3"!=e?r[e]!==t&&(r[e]=t,this.applyAll(e)):console.warn('THING.T3D deprecated "'+e+'" interface, Please use "glow" to achieve the same effect')}getState(e){if("glow1"!=e&&"glow2"!=e&&"glow3"!=e)return this._state[e];console.warn('THING.T3D deprecated "'+e+'" interface, Please use "glow" to achieve the same effect')}setOutlineColor(e){e?(this._outline&&(this._outline=!1,this.applyAll("outline")),this._outline=!0,this._outlineColor.copy(e)):this._outline=!1,this.applyAll("outline")}getOutlineColor(){return this._outline?this._outlineColor:null}apply(e,t){if(e.$isContainer)return;const r=this._state,n=e.$uScene.$effectsManager;e.$getRenderableList().forEach((e=>{if("outline"!==t&&dA(t).forEach((t=>{let i=r[t],a=F_[t];null===i?e._cachedEffects&&e._cachedEffects[a]?n.setEffect(e,a,e._cachedEffects[a]):n.setEffect(e,a,0):n.setEffect(e,a,i)})),!t||"outline"===t){if(e.userData&&e.userData.skipOutline)return;n.setEffect(e,"outline_0x"+this._outlineColor.getHexString(),this._outline?1:0)}}))}clear(e){if(e.$isContainer)return;const t=this._state,r=e.$uScene.$effectsManager;e.$getRenderableList().forEach((e=>{if(!e.isSprite&&!e.isPoints){for(let n in t){let i=t[n],a=F_[n];i&&(e._cachedEffects&&e._cachedEffects[a]?r.setEffect(e,a,e._cachedEffects[a]):r.setEffect(e,a,0))}this._outline&&r.setEffect(e,"outline_0x"+this._outlineColor.getHexString(),0)}}))}applyAll(e){this._style._linkedNodes.size>0&&this._style._linkedNodes.forEach((t=>this.apply(t,e))),this.applyInstancing()}applyInstancing(e){if(this._style._linkedNodes.size>0&&this._style._instancing.enable){const t=this._state;const r=this._style._linkedNodes.values().next().value.$uScene.$effectsManager;this._style._instancing._group.traverse((n=>{n.isEdge||(n.isMesh||n.isLine)&&("outline"!==e&&dA(e).forEach((e=>{let i=t[e],a=F_[e];null===i?n._cachedEffects&&n._cachedEffects[a]?r.setEffect(n,a,n._cachedEffects[a]):r.setEffect(n,a,0):r.setEffect(n,a,i)})),e&&"outline"!==e||r.setEffect(n,"outline_0x"+this._outlineColor.getHexString(),this._outline?1:0))}))}}isOrigin(){const e=this._state;for(let t in e)if(null!==e[t])return!1;return!this._outline}copy(e){const t=this._state;for(let r in t)t[r]=e._state[r];this._outline=e._outline,this._outlineColor.copy(e._outlineColor),this.applyAll()}reset(){const e=this._state;for(let t in e)e[t]=null;this._outline=!1,this.applyAll()}dispose(){this.reset(),this._style=null}}const fA=new Sc,mA=new Sc,gA=(new Sc).makeScale(1e-9,1e-9,1e-9),_A=["a_Position","a_Normal","a_Uv","a_Uv2","a_Uv3","a_Color"],vA=e=>{const t=r=>{r.target.removeEventListener("set-uv3",t);const n=r.uv3.clone();n.divisor=1,e.addAttribute("a_Uv3",n)};e.addEventListener("set-uv3",t);const r=n=>{n.target.removeEventListener("dispose",r),e.removeEventListener("set-uv3",t)};e.addEventListener("dispose",r)},yA=e=>{const t=e.$uScene.getRoot().$instancedOffset,r=e.getSceneVisible()?e.$node.worldMatrix:gA;return t.isOrigin?r:(fA.copy(r),fA.elements[12]-=t.x,fA.elements[13]-=t.y,fA.elements[14]-=t.z,fA)},xA=(e,t)=>{e.$node.updateMatrix=function(r){if((this.matrixAutoUpdate||this.matrixNeedsUpdate)&&(this.matrix.transform(this.position,this.scale,this.quaternion),this.matrixNeedsUpdate=!1,this.worldMatrixNeedsUpdate=!0),this.worldMatrixNeedsUpdate||r){if(this.worldMatrix.copy(this.matrix),this.parent){var n=this.parent.worldMatrix;this.worldMatrix.premultiply(n)}t.updateNodeMatrix(e),this.worldMatrixNeedsUpdate=!1,r=!0}for(var i=this.children,a=0,s=i.length;a<s;a++)i[a].updateMatrix(r)}},bA=e=>{delete e.$node.updateMatrix};class AA{constructor(e){this._maxLimit=e,this._maxCount=0,this._releasedIndices=[],this._map=new Map}set maxLimit(e){this._maxLimit=e}get maxLimit(){return this._maxLimit}get size(){return this._maxCount}allocateIndex(e){if(this._map.has(e))return console.error("Instancing: node index already allocated."),this._map.get(e);let t;return this._releasedIndices.length>0?t=this._releasedIndices.shift():(t=this._maxCount,this._maxCount++,this._maxCount>this._maxLimit&&(console.warn("Instancing: max limit is <"+this._maxLimit+"> ."),t--)),this._map.set(e,t),t}getIndex(e){return this._map.has(e)?this._map.get(e):(console.error("Instancing: can not find node index."),this.allocateIndex(e))}hasIndex(e){return this._map.has(e)}releaseIndex(e){if(!this._map.has(e))return;const t=this._map.get(e);this._map.delete(e),this._releasedIndices.push(t)}clear(){this._maxCount=0,this._releasedIndices.length=0,this._map.clear()}}class SA{constructor(e,t=1e3){this._style=e,this._enable=!1,this._group=new od,this._indices=new AA(t),this._visibleCount=0;const r=this;this._onVisibleChange=function(e){let t=e.target;t.$isContainer?t.$traverse((e=>{e.$isContainer||r.updateNodeMatrix(e)})):r.updateNodeMatrix(t),t.getSceneVisible()?(0==r._visibleCount&&(r._group.visible=!0),r._visibleCount++):(r._visibleCount--,0==r._visibleCount&&(r._group.visible=!1))},this._onPickableChange=function(e){const t=e.target;t.$isContainer?t.$traverse((e=>{e.$isContainer||r.updatePickable(e)})):r.updatePickable(t)}}set instancedMaxCount(e){e>this._indices.maxLimit&&(this._indices.maxLimit=e,this._group.children.forEach((t=>((e,t)=>{e.geometry.dispose(),vA(e.geometry);const r=e.geometry.getAttribute("instanceMatrix"),n=new up(new cp(new Float32Array(16*t),16),16);n.buffer.array.set(r.buffer.array),n.divisor=1,e.geometry.addAttribute("instanceMatrix",n),e.children[0]&&e.children[0].geometry.addAttribute("instanceMatrix",n);const i=e.geometry.getAttribute("instanceColor");if(i){const r=new up(new cp(new Float32Array(3*t).fill(1),3),3);r.buffer.array.set(i.buffer.array),r.divisor=1,e.geometry.addAttribute("instanceColor",r),e.children[0]&&e.children[0].geometry.addAttribute("instanceColor",r)}const a=e.geometry.getAttribute("instanceID");if(a){const r=new up(new cp(new Float32Array(t),1),1);r.buffer.array.set(a.buffer.array),r.divisor=1,e.geometry.addAttribute("instanceID",r)}const s=e.geometry.getAttribute("instanceStates");if(s){const r=new up(new cp(new Float32Array(t),1),1);r.buffer.array.set(s.buffer.array),r.divisor=1,e.geometry.addAttribute("instanceStates",r)}})(t,e))))}get instancedMaxCount(){return this._indices.maxLimit}set enable(e){if(this._enable!==e){let t=null;const r=this._style._linkedNodes;let n=0;for(let e of r.values()){if(!e.$isContainer){t=e;break}e.getSceneVisible()&&n++}t&&(e?(this._visibleCount=n,this._generateInstancedMeshes(t)):(this._visibleCount=0,this._destroyInstancedMeshes(t))),this._enable=e}}get enable(){return this._enable}updatePickable(e){const t=this._indices.getIndex(e);this._group.children.forEach((r=>{const n=r.geometry.getAttribute("instanceStates");n&&(n.buffer.array[t]=e.$pickable?1:0,n.buffer.version++)}))}updateNodeMatrix(e){let t=this._indices.getIndex(e);this._group.children.forEach((r=>{const n=r.geometry.getAttribute("instanceMatrix");if(n){yA(e).toArray(n.buffer.array,16*t),n.buffer.version++}}))}addNode(e){if(e.getSceneVisible()&&this._visibleCount++,e.$isContainer||e.getSceneVisible()&&(this._visibleCount++,1==this._visibleCount&&(this._group.visible=!0)),this._group.parent){if(!e.$isContainer){const t=[];if(e.$getRenderableList().forEach((e=>{e.isMesh&&t.push(e)})),0===t.length)return;e.$node.updateWorldMatrix(!0,!0);let r=this._indices.allocateIndex(e);e.$internalVisible=!1,xA(e,this);const n=e.$uScene.$pickNodeCache;t.forEach((e=>{n.map.has(e.id)||n.createPickCache(e)})),this._group.children.forEach(((n,i)=>{const a=n.geometry.getAttribute("instanceMatrix");yA(e).toArray(a.buffer.array,r*a.size),a.buffer.version++;const s=n.geometry.getAttribute("instanceID");s.buffer.array[r*s.size]=t[i].id,s.buffer.version++;const o=n.geometry.getAttribute("instanceStates");o.buffer.array[r*o.size]=e.$pickable?1:0,o.buffer.version++,n.geometry.instanceCount=this._indices.size,n.children[0]&&(n.children[0].geometry.instanceCount=this._indices.size)})),e.addEventListener("pickable-changed",this._onPickableChange),e.addEventListener("scene-visible-changed",this._onVisibleChange)}}else e.$isContainer||this._generateInstancedMeshes(e)}removeNode(e){if(e.getSceneVisible()&&this._visibleCount--,0!==this._style._linkedNodes.size){if(this._indices.hasIndex(e)){let t=this._indices.getIndex(e);this._indices.releaseIndex(e),this._group.children.forEach((r=>{const n=r.geometry.getAttribute("instanceMatrix"),i=(e=>{const t=e.$uScene.getRoot().$instancedOffset;return t.isOrigin?gA:(fA.copy(gA),fA.elements[12]-=t.x,fA.elements[13]-=t.y,fA.elements[14]-=t.z,fA)})(e);i.toArray(n.buffer.array,16*t),n.buffer.version++;const a=r.geometry.getAttribute("instanceID");a.buffer.array[t*a.size]=0,a.buffer.version++;const s=r.geometry.getAttribute("instanceStates");s.buffer.array[t*s.size]=0,s.buffer.version++,r.geometry.instanceCount=this._indices.size,r.children[0]&&(r.children[0].geometry.instanceCount=this._indices.size)}))}e.$internalVisible=!0,bA(e),e.removeEventListener("pickable-changed",this._onPickableChange),e.removeEventListener("scene-visible-changed",this._onVisibleChange)}else this._group.parent&&this._destroyInstancedMeshes(e)}dispose(){if(this._style){let e=Array.from(this._style._linkedNodes.values()).filter((e=>!e.$isContainer));if(e.length>0&&this._group.parent){let t=e[0];this._destroyInstancedMeshes(t)}this._style=null,this._visibleCount=0}}_generateInstancedMeshes(e){let t=[];if(e.$getRenderableList().forEach((e=>{e.isMesh&&t.push(e)})),0===t.length)return;e.$node.updateWorldMatrix(!0,!0),e.$uScene.getRoot().$addInstancedNode(this._group);const r=this._indices._maxLimit;t.forEach((t=>{this._group.add(this._generateInstancedMesh(t,e,r))})),this._style._effects.applyInstancing(),this._style._linkedNodes.forEach((e=>{if(!e.$isContainer){let t=[];if(e.$getRenderableList().forEach((e=>{e.isMesh&&t.push(e)})),0===t.length)return;let r=this._indices.allocateIndex(e);e.$internalVisible=!1,xA(e,this);const n=e.$uScene.$pickNodeCache;t.forEach((e=>{n.map.has(e.id)||n.createPickCache(e)})),this._group.children.forEach(((n,i)=>{e.$node.updateWorldMatrix(!0,!1);const a=n.geometry.getAttribute("instanceMatrix");yA(e).toArray(a.buffer.array,r*a.size);const s=n.geometry.getAttribute("instanceID");s.buffer.array[r*s.size]=t[i].id;const o=n.geometry.getAttribute("instanceStates");o.buffer.array[r*o.size]=e.$pickable?1:0,n.geometry.instanceCount=this._indices.size})),e.addEventListener("pickable-changed",this._onPickableChange),e.addEventListener("scene-visible-changed",this._onVisibleChange)}}))}_generateInstancedMesh(e,t,r){Array.isArray(e.material)?(e.material.forEach((e=>e.needsUpdate=!0)),e.material.isMatArray=!0):e.material.needsUpdate=!0;let n=null,i=null;const a=N_(e,t.$node,fA),s=e.isSkinnedMesh,o=t._res;if(s){const r=e.bindMatrix,i=e.bindMatrixInverse,s=t.$uScene._root.$node.anchorMatrix,l=!s.isIdentity(),u=mA.getInverse(s);e.skeleton.updateBones({useAnchorMatrix:l,anchorMatrixInverse:u});const c=e.skeleton.boneMatrices;n=o.getGeometryFromSkinned(e.geometry,{bindMatrix:r,bindMatrixInverse:i,boneMatrices:c,offsetMatrix:a})}else o?n=o.getGeometry(e,{offsetMatrix:a}):(n=e.geometry.clone(),a.isIdentity()||Gb.applyMatrix4(n,a,!0));if(o){i=new _p;for(let e=0,t=_A.length;e<t;e++){const t=_A[e];n.attributes[t]&&(i.attributes[t]=n.attributes[t])}i.index=n.index,i.groups=n.groups,i.boundingBox.copy(n.boundingBox),i.boundingSphere.copy(n.boundingSphere)}else i=n;const l=((e,t,r)=>{vA(e);const n=new up(new cp(new Float32Array(r),1),1);n.divisor=1;const i=new up(new cp(new Float32Array(16*r),16),16);i.divisor=1;const a=new up(new cp(new Float32Array(3*r).fill(1),3),3);a.divisor=1;const s=new up(new cp(new Float32Array(r).fill(1),1),1);s.divisor=1,e.addAttribute("instanceID",n),e.addAttribute("instanceStates",s),e.addAttribute("instanceMatrix",i),e.addAttribute("instanceColor",a),e.instanceCount=r,t.isMatArray?t.forEach((e=>e.defines.USE_INSTANCING=!0)):t.defines.USE_INSTANCING=!0;const o=new ap(e,t);return o.isInstancedMesh=!0,o})(i,e.material,r);if(l.castShadow=e.castShadow,l.receiveShadow=e.receiveShadow,l.frustumCulled=!1,e.effects){const t=U_({},e.effects);l.effects=t}if(e._cachedEffects){const t=U_({},e._cachedEffects);l._cachedEffects=t}if(e.userData){const t=U_(l.userData,e.userData);l.userData=t}return l}_destroyInstancedMeshes(e){e.$uScene.getRoot().$removeInstancedNode(this._group),this._group.children.forEach((t=>{t.geometry.dispose(),t.parent=null,e.$uScene.$effectsManager.clearAllEffects(t),t.children.length>0&&t.children.forEach((t=>{e.$uScene.$effectsManager.clearAllEffects(t)})),Array.isArray(t.material)?t.material.forEach((e=>{e.defines.USE_INSTANCING=!1,e.needsUpdate=!0})):(t.material.defines.USE_INSTANCING=!1,t.material.needsUpdate=!0)})),this._group.children=[],0===this._style._linkedNodes.size&&e?(e.$internalVisible=!0,bA(e),e.removeEventListener("scene-visible-changed",this._onVisibleChange),e.removeEventListener("pickable-changed",this._onPickableChange)):this._style._linkedNodes.forEach((e=>{e.$internalVisible=!0,bA(e),e.removeEventListener("scene-visible-changed",this._onVisibleChange),e.removeEventListener("pickable-changed",this._onPickableChange)})),this._indices.clear()}}const EA=`\n#include <common_vert>\n${ig.uv_pars_vert}\n#include <color_pars_vert>\n\n#if defined(USE_ENV_MAP) && !defined(USE_VERTEX_ENVDIR)\n    #include <modelPos_pars_vert>\n    #include <normal_pars_vert>\n#endif\n\n#include <envMap_pars_vert>\n#include <alphamap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <logdepthbuf_pars_vert>\n${eg.instance_pars_vert}\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <skinning_vert>\n\t${eg.instance_position_vert}\n    #include <pvm_vert>\n    #include <logdepthbuf_vert>\n\n    #include <uv_vert>\n    #include <color_vert>\n    ${eg.instance_color_vert}\n\n    #ifdef USE_ENV_MAP\n        #include <morphnormal_vert>\n        #include <skinnormal_vert>\n\n        #ifndef USE_VERTEX_ENVDIR\n            #include <modelPos_vert>\n            #include <normal_vert>\n        #endif  \n    #endif\n\n    #include <envMap_vert>\n    ${ig.alphamap_vert}\n}\n`,wA=`\n#include <common_frag>\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <alphamap_pars_frag>\n\n#if defined(USE_ENV_MAP) && !defined(USE_VERTEX_ENVDIR)\n    #include <normalMap_pars_frag>\n    #include <normal_pars_frag>\n\n    #include <modelPos_pars_frag>\n#endif\n\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <fog_pars_frag>\n#include <logdepthbuf_pars_frag>\n${rg.colormapping_pars_frag}\nvoid main() {\n    #include <begin_frag>\n    #include <logdepthbuf_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphamap_frag>\n    ${rg.colormapping_frag}\n    #include <alphaTest_frag>\n\n    #if defined(USE_ENV_MAP) && !defined(USE_VERTEX_ENVDIR)\n        #include <normal_frag>\n    #endif\n\n    #include <envMap_frag>\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}\n`;class CA extends gm{constructor(){super(...arguments),this.type=Nc.SHADER,this.shaderName="CUSTOM_LINE",this.vertexShader=EA,this.fragmentShader=wA,this.aoMapCoord=1,this.defines={USE_INSTANCING:!1,USE_UV3:!1}}}CA.prototype.useDefaultBufferMaterial=!0;var TA={getGeometryData:function(e,t,r={}){const n=void 0!==r.thresholdAngle?r.thresholdAngle:1;let i,a,s,o,l,u,c,h,d=[],p={},f=[],m=[],g=Math.pow(10,4);for(s=e.length/3,i=0;i<s;i++)u=e[3*i+0],c=e[3*i+1],h=e[3*i+2],o=Math.round(u*g)+"_"+Math.round(c*g)+"_"+Math.round(h*g),void 0===p[o]?(p[o]=i,f.push(u,c,h),m[i]=f.length/3-1):m[i]=m[p[o]];let _=[];if(t)for(s=t.length/3,i=0;i<s;i++)l={i:[0,0,0],n:[1,1,1]},l.i[0]=m[t[3*i+0]],l.i[1]=m[t[3*i+1]],l.i[2]=m[t[3*i+2]],MA(l,f),_.push(l);else for(i=0;i<s;i++)l={i:[0,0,0],n:[1,1,1]},l.i[0]=m[3*i+0],l.i[1]=m[3*i+1],l.i[2]=m[3*i+2],MA(l,f),_.push(l);let v,y,x=[0,0],b={};for(i=0,s=_.length;i<s;i++)for(l=_[i],a=0;a<3;a++)v=l.i[a],y=l.i[(a+1)%3],x[0]=Math.min(v,y),x[1]=Math.max(v,y),o=x[0]+","+x[1],void 0===b[o]?b[o]={index1:x[0],index2:x[1],face1:i,face2:void 0}:b[o].face2=i;let A=Math.cos(PA*n);for(o in b){let e=b[o];(void 0===e.face2||DA(_[e.face1].n,_[e.face2].n)<=A)&&d.push(f[3*e.index1+0],f[3*e.index1+1],f[3*e.index1+2],f[3*e.index2+0],f[3*e.index2+1],f[3*e.index2+2])}return{positions:d}}};function DA(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function MA(e,t){let r=t[3*e.i[0]+0],n=t[3*e.i[0]+1],i=t[3*e.i[0]+2],a=t[3*e.i[1]+0],s=t[3*e.i[1]+1],o=t[3*e.i[1]+2],l=t[3*e.i[2]+0]-a,u=t[3*e.i[2]+1]-s,c=t[3*e.i[2]+2]-o,h=r-a,d=n-s,p=i-o,f=u*p-c*d,m=c*h-l*p,g=l*d-u*h,_=Math.sqrt(f*f+m*m+g*g);f/=_,m/=_,g/=_,e.n[0]=f,e.n[1]=m,e.n[2]=g}const PA=Math.PI/180,FA=new Sc,RA=new WeakMap,NA=new up(new cp(new Float32Array,3)),BA=new up(new cp(new Float32Array,1)),IA=(e,t,r={thresholdAngle:.5})=>{e.getAttribute("a_Position")&&e.index||(e.addAttribute("a_Position",NA),e.setIndex(BA));const n=TA.getGeometryData(e.getAttribute("a_Position").buffer.array,e.index.buffer.array,r.thresholdAngle);t.addAttribute("a_Position",new up(new cp(new Float32Array(n.positions),3))),t.computeBoundingSphere(),t.version++},OA=e=>{const t=[];return e.traverse((e=>{e.isEdge&&t.push(e)})),t.forEach((e=>e.parent.remove(e))),t},kA=(e,t,r)=>{let n=e.geometry;if(e.isSkinnedMesh){const t=e.bindMatrix,i=e.bindMatrixInverse,a=r.$uScene._root.$node.anchorMatrix,s=!a.isIdentity(),o=FA.getInverse(a);e.skeleton.updateBones({useAnchorMatrix:s,anchorMatrixInverse:o});const l=e.skeleton.boneMatrices;n=r._res.getEdgeGeometryFromSkinned(n,{bindMatrix:t,bindMatrixInverse:i,boneMatrices:l})}const i=new ap((e=>{if(!RA.has(e)){const t=new _p;IA(e,t,{thresholdAngle:.5});const r=()=>{t.dispose()},n=e=>{const t=e.data,r=RA.get(t);r&&IA(t,r)};e.addEventListener("dispose",r),e.addEventListener("updateData",n),RA.set(e,t)}return RA.get(e)})(n),t);return i.isEdge=!0,i.renderOrder=e.renderOrder+1e-5,i.worldMatrix.copy(e.worldMatrix),i.matrixNeedsUpdate=!1,i.matrixAutoUpdate=!1,i.worldMatrixNeedsUpdate=!1,e.add(i),i};class LA{constructor(e){this._style=e,this._material=null,this._state={enable:!1,color:[1,1,1],opacity:1,glow:!1}}equals(e){const t=this._state,r=e._state;return t.enable===r.enable&&t.opacity===r.opacity&&t.glow===r.glow&&t.color[0]===r.color[0]&&t.color[1]===r.color[1]&&t.color[2]===r.color[2]}set enable(e){this._state.enable!==e&&(this.getMaterial(),this._style._linkedNodes.size>0&&this._style._linkedNodes.forEach((t=>e?this.apply(t):this.clear(t))),this._state.enable=e,this.applyInstancing())}get enable(){return this._state.enable}setGlow(e){if(this._state.glow!==e&&(this._state.glow=e,this._state.enable&&this._style._linkedNodes.size>0)){const e=this._style._linkedNodes.values().next().value.$uScene.$effectsManager;this._style._linkedNodes.forEach((t=>{t.$isContainer||t.$node.traverse((t=>{t.isEdge&&e.setEffect(t,"Glow",this._state.glow?1:0)}))})),this._style._instancing.enable&&this._style._instancing._group.traverse((t=>{t.isEdge&&e.setEffect(t,"Glow",this._state.glow?1:0)}))}}getGlow(){return this._state.glow}setColorAndOpacity(e,t){if(void 0===e||void 0===t)return;const r=this._state;r.color[0]=e[0],r.color[1]=e[1],r.color[2]=e[2],r.opacity=t;const n=this.getMaterial();n.diffuse.fromArray(r.color),n.opacity=r.opacity,n.transparent=r.opacity<1}getState(){return this._state}getMaterial(){return this._material||(this._material=new CA),this._material}apply(e){if(e.$isContainer)return;const t=this.getMaterial(),r=e.$uScene.$effectsManager;e.$getRenderableList().forEach((n=>{if(n.isMesh&&n.geometry){const i=kA(n,t,e);this.$updateEdgesAttribute(i,n),this._state.glow&&r.setEffect(i,"Glow",1)}}))}clear(e){if(e.$isContainer)return;const t=OA(e.$node);if(this._state.glow){const r=e.$uScene.$effectsManager;t.forEach((e=>r.clearAllEffects(e)))}}clearInstancing(){const e=this.getMaterial();e.defines.USE_INSTANCING&&(e.needsUpdate=!0,e.defines.USE_INSTANCING=!1)}applyInstancing(){if(this._style._linkedNodes.size>0&&this._style._instancing.enable){const e=this.getMaterial();e.needsUpdate=!0;const t=this._style._linkedNodes.values().next().value,r=t.$uScene.$effectsManager;if(this._state.enable)O_(this._style._instancing._group,(n=>{if(n.isInstancedMesh){let i=n.children[0];i&&i.isEdge||(i=kA(n,e,t)),this.$updateEdgesAttribute(i,n),this._state.glow&&r.setEffect(i,"Glow",1)}}));else{const e=OA(this._style._instancing._group);this._state.glow&&e.forEach((e=>r.clearAllEffects(e)))}}}$updateEdgesAttribute(e,t){if(!t.isInstancedMesh)return;const r=t.geometry.getAttribute("instanceMatrix");e.geometry.addAttribute("instanceMatrix",r),e.geometry.instanceCount=t.geometry.instanceCount,e.geometry.version++,e.material.defines.USE_INSTANCING=!0,e.isInstancedMesh=!0,e.frustumCulled=!1}copy(e){e._material&&this.getMaterial().copy(e._material),e._state.enable===this._state.enable?this.setGlow(e._state.glow):(this._state.glow=e._state.glow,this.enable=e.enable)}dispose(){this._material&&this._material.dispose(),this._style=null}}const UA={USE_INSTANCING:!0,COLOR_MAPPING:!0,USE_UV3:!0,USE_SIDE_EMISSIVE:!0,UV_DISCARD:!0,SIMULATE_BASIC:!0},zA={specularFactor:!0,colorMapping:!0,imageRatio:!0,center:!0,rotation:!0,fresnelPower:!0,fresnelInverse:!0},jA={Front:Lc.FRONT,Back:Lc.BACK,Double:Lc.DOUBLE},VA={NoBlending:Bc.NONE,NormalBlending:Bc.NORMAL,AdditiveBlending:Bc.ADD,SubtractiveBlending:Bc.SUB,MultiplyBlending:Bc.MUL},GA=[0,0,0],WA={uniforms:(e,t,r)=>{if(e.otherFlags.has(oA.uniforms)){const n=t.uniforms,i=r.uniforms;for(const t in n){if(UA[t])continue;const r=e.uniforms.get(t);n[t]=void 0!==r?r:i[t]}}else{const e=t.uniforms,n=r.uniforms;for(const t in n)zA[t]||(e[t]=n[t])}},defines:(e,t,r)=>{if(e.otherFlags.has(oA.defines)){const n=t.defines,i=r.defines;for(const r in n){if(UA[r])continue;const a=e.defines.get(r);void 0!==a?n[r]!==a&&(n[r]=a,t.needsUpdate=!0):n[r]!==i[r]&&(n[r]=i[r],t.needsUpdate=!0)}}else{const e=t.defines,n=r.defines;for(const r in n)UA[r]||e[r]===n[r]||(e[r]=n[r],t.needsUpdate=!0)}},colorOp:(e,t,r)=>{e.opFlags.has(oA.colorOp)?t.diffuse.fromArray(e.colorOp(r.diffuse.toArray(GA))):t.diffuse.copy(r.diffuse)},opacityOp:(e,t,r)=>{e.opFlags.has(oA.opacityOp)?t.opacity=e.opacityOp(r.opacity):t.opacity=r.opacity},roughnessOp:(e,t,r)=>{void 0!==r.roughness&&(e.opFlags.has(oA.roughnessOp)?t.roughness=e.roughnessOp(r.roughness):t.roughness=r.roughness)},metalnessOp:(e,t,r)=>{void 0!==r.metalness&&(e.opFlags.has(oA.metalnessOp)?t.metalness=e.metalnessOp(r.metalness):t.metalness=r.metalness)},specularFactor:(e,t,r)=>{void 0!==r.specularFactor&&(t.specularFactor=e.specularFactor)},fresnelPower:(e,t,r)=>{void 0!==r.fresnelPower&&(t.fresnelPower=e.fresnelPower)},fresnelInverse:(e,t,r)=>{void 0!==r.fresnelInverse&&(t.fresnelInverse=e.fresnelInverse)},transparent:(e,t,r)=>{e.otherFlags.has(oA.transparent)?t.transparent=e.transparent:t.transparent=t.opacity<1||r.transparent},blending:(e,t,r)=>{e.otherFlags.has(oA.blending)&&void 0!==VA[e.blending]?t.blending=VA[e.blending]:t.blending=r.blending},side:(e,t,r)=>{e.otherFlags.has(oA.side)&&void 0!==jA[e.side]?t.side=jA[e.side]:t.side=r.side},diffuseTex:(e,t,r)=>{e.texFlags.has(oA.diffuseTex)?(!t.diffuseMap!=!e.diffuseTex.$texture&&(t.needsUpdate=!0),t.diffuseMap=e.diffuseTex.$texture):(!t.diffuseMap!=!r.diffuseMap&&(t.needsUpdate=!0),t.diffuseMap=r.diffuseMap)},alphaTex:(e,t,r)=>{e.texFlags.has(oA.alphaTex)?(!t.alphaMap!=!e.alphaTex.$texture&&(t.needsUpdate=!0),t.alphaMap=e.alphaTex.$texture):(!t.alphaMap!=!r.alphaMap&&(t.needsUpdate=!0),t.alphaMap=r.alphaMap)},aoTex:(e,t,r)=>{e.texFlags.has(oA.aoTex)?(!t.aoMap!=!e.aoTex.$texture&&(t.needsUpdate=!0),t.aoMap=e.aoTex.$texture):(!t.aoMap!=!r.aoMap&&(t.needsUpdate=!0),t.aoMap=r.aoMap)},aoMapIntensity:(e,t,r)=>{void 0!==r.aoMapIntensity&&(t.aoMapIntensity=e.aoMapIntensity)},envTex:(e,t,r)=>{e.closeEnvTex||(e.texFlags.has(oA.envTex)&&void 0!==r.envMap?(!t.envMap!=!e.envTex.$texture&&(t.needsUpdate=!0),t.envMap=e.envTex.$texture):(!t.envMap!=!r.envMap&&(t.needsUpdate=!0),t.envMap=r.envMap))},envMapIntensity:(e,t,r)=>{void 0!==t.envMapIntensity&&(t.envMapIntensity=e.envMapIntensity)},closeEnvTex:(e,t,r)=>{e.texFlags.has(oA.closeEnvTex)?e.closeEnvTex?(void 0!==t.envMap&&(t.needsUpdate=!0),t.envMap=void 0):e.texFlags.has(oA.envTex)?(!t.envMap!=!e.envTex.$texture&&(t.needsUpdate=!0),t.envMap=e.envTex.$texture):(null!==t.envMap&&(t.needsUpdate=!0),t.envMap=null):e.texFlags.has(oA.envTex)&&void 0!==r.envMap?(!t.envMap!=!e.envTex.$texture&&(t.needsUpdate=!0),t.envMap=e.envTex.$texture):(!t.envMap!=!r.envMap&&(t.needsUpdate=!0),t.envMap=r.envMap)},uvMatrix:(e,t,r)=>{e.texFlags.has(oA.uvMatrix)?t.diffuseMapTransform=e.uvMatrix:t.diffuseMapTransform=r.diffuseMapTransform},alphaUvMatrix:(e,t,r)=>{e.texFlags.has(oA.alphaUvMatrix)?t.alphaMapTransform=e.alphaUvMatrix:t.alphaMapTransform=r.alphaMapTransform},emissiveUvMatrix:(e,t,r)=>{e.texFlags.has(oA.emissiveUvMatrix)?t.emissiveMapTransform=e.emissiveUvMatrix:t.emissiveMapTransform=r.emissiveMapTransform},emissiveOp:(e,t,r)=>{void 0!==r.emissive&&(e.opFlags.has(oA.emissiveOp)?t.emissive.fromArray(e.emissiveOp(r.emissive.toArray(GA))):t.emissive.copy(r.emissive))},emissiveTex:(e,t,r)=>{e.texFlags.has(oA.emissiveTex)?(!t.emissiveMap!=!e.emissiveTex.$texture&&(t.needsUpdate=!0),t.emissiveMap=e.emissiveTex.$texture):(!t.emissiveMap!=!r.emissiveMap&&(t.needsUpdate=!0),t.emissiveMap=r.emissiveMap)},verticalEmissive:(e,t,r)=>{void 0!==r.verticalEmissive&&(t.verticalEmissive=e.verticalEmissive)},normalTex:(e,t,r)=>{e.texFlags.has(oA.normalTex)?(!t.normalMap!=!e.normalTex.$texture&&(t.needsUpdate=!0),t.normalMap=e.normalTex.$texture):(!t.normalMap!=!r.normalMap&&(t.needsUpdate=!0),t.normalMap=r.normalMap)},colorMappingTex:(e,t,r)=>{void 0!==r.colorMapping&&(e.texFlags.has(oA.colorMappingTex)?t.colorMapping=e.colorMappingTex.$texture:t.colorMapping=null)},colorMappingIntensity:(e,t,r)=>{void 0!==r.colorMappingIntensity&&(t.colorMappingIntensity=e.colorMappingIntensity)},lights:(e,t,r)=>{void 0!==r.simulateBasic&&(t.simulateBasic=!e.lights)},wireframe:(e,t,r)=>{e.otherFlags.has(oA.wireframe)?t.wireframe=e.wireframe:t.wireframe=r.wireframe},depthTest:(e,t,r)=>{e.otherFlags.has(oA.depthTest)?t.depthTest=e.depthTest:t.depthTest=r.depthTest},depthWrite:(e,t,r)=>{e.otherFlags.has(oA.depthWrite)?t.depthWrite=e.depthWrite:t.depthWrite=r.depthWrite},clippingPlanes:(e,t,r)=>{void 0!==r.clippingPlanes&&(e.otherFlags.has(oA.clippingPlanes)?t.clippingPlanes=e.clippingPlanes:t.clippingPlanes=r.clippingPlanes)}},HA=Object.values(WA),qA=new Eh;class XA{constructor(e,t){this._uuid=$h(),this._linkedNodes=new Set,this._state=new eA,this._reflects=new uA(t?t.reflectFunction:void 0),this._materialReflect=t,this._effects=new pA(this),this._instancing=new SA(this,e),this._edges=new LA(this),this._matFuncsQueue=[],this._applyLocked=!1}getUUID(){return this._uuid}begin(){this._applyLocked=!0}end(){this._applyLocked=!1,this._applyAllMaterials()}setTransparent(e){const t=this._state;t.transparent=e,e!==sA.transparent?t.otherFlags.enable(oA.transparent,!0):t.otherFlags.enable(oA.transparent,!1),this._matFuncsQueue.push(WA.transparent),this._applyAllMaterials()}getTransparent(){return this._state.transparent}setBlendingType(e){const t=this._state;t.blending=e,e!==sA.blending?t.otherFlags.enable(oA.blending,!0):t.otherFlags.enable(oA.blending,!1),this._matFuncsQueue.push(WA.blending),this._applyAllMaterials()}getBlendingType(){return this._state.blending}setSideType(e){const t=this._state;t.side=e,e!==sA.side?t.otherFlags.enable(oA.side,!0):t.otherFlags.enable(oA.side,!1),this._matFuncsQueue.push(WA.side),this._applyAllMaterials()}getSideType(){return this._state.side}setAttribute(e,t){const r=this._state;switch(e){case"SpecularFactor":r.specularFactor=t,t!==sA.specularFactor?r.otherFlags.enable(oA.specularFactor,!0):r.otherFlags.enable(oA.specularFactor,!1),this._matFuncsQueue.push(WA.specularFactor),this._applyAllMaterials();break;case"FresnelPower":r.fresnelPower=t,t!==sA.fresnelPower?r.otherFlags.enable(oA.fresnelPower,!0):r.otherFlags.enable(oA.fresnelPower,!1),this._matFuncsQueue.push(WA.fresnelPower),this._applyAllMaterials();break;case"FresnelInverse":r.fresnelInverse=t,t!==sA.fresnelInverse?r.otherFlags.enable(oA.fresnelInverse,!0):r.otherFlags.enable(oA.fresnelInverse,!1),this._matFuncsQueue.push(WA.fresnelInverse),this._applyAllMaterials();break;case"ColorMappingIntensity":r.colorMappingIntensity=t,t!==sA.colorMappingIntensity?r.texFlags.enable(oA.colorMappingIntensity,!0):r.texFlags.enable(oA.colorMappingIntensity,!1),this._matFuncsQueue.push(WA.colorMappingIntensity),this._applyAllMaterials();break;case"AOMapIntensity":r.aoMapIntensity=t,t!==sA.aoMapIntensity?r.texFlags.enable(oA.aoMapIntensity,!0):r.texFlags.enable(oA.aoMapIntensity,!1),this._matFuncsQueue.push(WA.aoMapIntensity),this._applyAllMaterials();break;case"EnvMapIntensity":r.envMapIntensity=t,t!==sA.envMapIntensity?r.texFlags.enable(oA.envMapIntensity,!0):r.texFlags.enable(oA.envMapIntensity,!1),this._matFuncsQueue.push(WA.envMapIntensity),this._applyAllMaterials();break;case"Lights":r.lights=t,t!==sA.lights?r.otherFlags.enable(oA.lights,!0):r.otherFlags.enable(oA.lights,!1),this._matFuncsQueue.push(WA.lights),this._applyAllMaterials();break;case"AlwaysOnTop":break;case"VerticalEmissive":r.verticalEmissive=t,t!==sA.verticalEmissive?r.texFlags.enable(oA.verticalEmissive,!0):r.texFlags.enable(oA.verticalEmissive,!1),this._matFuncsQueue.push(WA.verticalEmissive),this._applyAllMaterials()}}getAttribute(e){const t=this._state;switch(e){case"SpecularFactor":return t.specularFactor;case"ColorMappingIntensity":return t.colorMappingIntensity;case"AOMapIntensity":return t.aoMapIntensity;case"EnvMapIntensity":return t.envMapIntensity;case"Lights":return t.lights;case"AlwaysOnTop":return!1;case"VerticalEmissive":return t.verticalEmissive;default:return null}}setUniform(e,t){const r=this._state;if(null===t){if(null===r.uniforms)return;r.uniforms.delete(e),r.uniforms.size<=0&&(r.uniforms=null)}else{const n=r.uniforms=r.uniforms||new Map;let i=n.get(e);if(null==i)i=Array.isArray(t)?[...t]:t instanceof Float32Array?new Float32Array(t):t.isUImageTextureResource?t.$texture:t;else if(Array.isArray(t)||t instanceof Float32Array)for(let e=0,r=t.length;e<r;e++)i[e]=t[e];else i=t.isUImageTextureResource?t.$texture:t;n.set(e,i)}r.uniforms!==sA.uniforms?r.otherFlags.enable(oA.uniforms,!0):r.otherFlags.enable(oA.uniforms,!1),this._matFuncsQueue.push(WA.uniforms),this._applyAllMaterials()}defineMacro(e,t){const r=this._state;if(null===t){if(null===r.defines)return;r.defines.delete(e),r.defines.size<=0&&(r.defines=null)}else{(r.defines=r.defines||new Map).set(e,t)}r.defines!==sA.defines?r.otherFlags.enable(oA.defines,!0):r.otherFlags.enable(oA.defines,!1),this._matFuncsQueue.push(WA.defines),this._applyAllMaterials()}setImage(e,t){const r=this._state;switch(e){case"Map":r.diffuseTex=t,t!==sA.diffuseTex?r.texFlags.enable(oA.diffuseTex,!0):r.texFlags.enable(oA.diffuseTex,!1),this._matFuncsQueue.push(WA.diffuseTex),this._applyAllMaterials();break;case"EnvMap":r.envTex=t,t!==sA.envTex?r.texFlags.enable(oA.envTex,!0):r.texFlags.enable(oA.envTex,!1),this._matFuncsQueue.push(WA.envTex),this._applyAllMaterials();break;case"AlphaMap":r.alphaTex=t,t!==sA.alphaTex?r.texFlags.enable(oA.alphaTex,!0):r.texFlags.enable(oA.alphaTex,!1),this._matFuncsQueue.push(WA.alphaTex),this._applyAllMaterials();break;case"AOMap":r.aoTex=t,t!==sA.aoTex?r.texFlags.enable(oA.aoTex,!0):r.texFlags.enable(oA.aoTex,!1),this._matFuncsQueue.push(WA.aoTex),this._applyAllMaterials();break;case"EmissiveMap":r.emissiveTex=t,t!==sA.emissiveTex?(this._linkedNodes.forEach((e=>{e._res&&e._res.generateUv3()})),r.texFlags.enable(oA.emissiveTex,!0)):r.texFlags.enable(oA.emissiveTex,!1),this._matFuncsQueue.push(WA.emissiveTex),this._applyAllMaterials();break;case"NormalMap":r.normalTex=t,t!==sA.normalTex?r.texFlags.enable(oA.normalTex,!0):r.texFlags.enable(oA.normalTex,!1),this._matFuncsQueue.push(WA.normalTex),this._applyAllMaterials();break;case"ColorMapping":r.colorMappingTex=t,t!==sA.colorMappingTex?r.texFlags.enable(oA.colorMappingTex,!0):r.texFlags.enable(oA.colorMappingTex,!1),this._matFuncsQueue.push(WA.colorMappingTex),this._applyAllMaterials()}}getImage(e){let t=this._state;switch(e){case"Map":return t.diffuseTex;case"EnvMap":return t.envTex;case"AlphaMap":return t.alphaTex;case"AOMap":return t.aoTex;case"EmissiveMap":return t.emissiveTex;case"NormalMap":return t.normalTex;case"ColorMapping":return t.colorMappingTex;default:return null}}setColorOp(e){const t=this._state;t.colorOp=e,e!==sA.colorOp?t.opFlags.enable(oA.colorOp,!0):t.opFlags.enable(oA.colorOp,!1),this._matFuncsQueue.push(WA.colorOp),this._applyAllMaterials()}getColorOp(){return this._state.colorOp}setOpacityOp(e){const t=this._state;t.opacityOp=e,e!==sA.opacityOp?t.opFlags.enable(oA.opacityOp,!0):t.opFlags.enable(oA.opacityOp,!1),this._matFuncsQueue.push(WA.opacityOp),this._matFuncsQueue.push(WA.transparent),this._applyAllMaterials()}getOpacityOp(){return this._state.opacityOp}setEmissiveOp(e){const t=this._state;t.emissiveOp=e,e!==sA.emissiveOp?t.opFlags.enable(oA.emissiveOp,!0):t.opFlags.enable(oA.emissiveOp,!1),this._matFuncsQueue.push(WA.emissiveOp),this._applyAllMaterials()}getEmissiveOp(){return this._state.emissiveOp}setRoughnessOp(e){const t=this._state;t.roughnessOp=e,e!==sA.roughnessOp?t.opFlags.enable(oA.roughnessOp,!0):t.opFlags.enable(oA.roughnessOp,!1),this._matFuncsQueue.push(WA.roughnessOp),this._applyAllMaterials()}getRoughnessOp(){return this._state.roughnessOp}setMetalnessOp(e){const t=this._state;t.metalnessOp=e,e!==sA.metalnessOp?t.opFlags.enable(oA.metalnessOp,!0):t.opFlags.enable(oA.metalnessOp,!1),this._matFuncsQueue.push(WA.metalnessOp),this._applyAllMaterials()}getMetalnessOp(){return this._state.metalnessOp}setSpecularFactor(e){console.warn("This interface will be deprecated, please use setAttribute");const t=this._state;t.specularFactor=e,e!==sA.specularFactor?t.otherFlags.enable(oA.specularFactor,!0):t.otherFlags.enable(oA.specularFactor,!1),this._matFuncsQueue.push(WA.specularFactor),this._applyAllMaterials()}getSpecularFactor(){return console.warn("This interface will be deprecated, please use getAttribute"),this._state.specularFactor}setColorMappingIntensity(e){console.warn("This interface will be deprecated, please use setAttribute");const t=this._state;t.colorMappingIntensity=e,e!==sA.colorMappingIntensity?t.texFlags.enable(oA.colorMappingIntensity,!0):t.texFlags.enable(oA.colorMappingIntensity,!1),this._matFuncsQueue.push(WA.colorMappingIntensity),this._applyAllMaterials()}getColorMappingIntensity(){return console.warn("This interface will be deprecated, please use getAttribute"),this._state.colorMappingIntensity}setClippingPlanes(e){const t=this._state;t.clippingPlanes=e?e.map((e=>new Nh((new bc).fromArray(e.direction),e.height))):[],e!==sA.clippingPlanes?t.otherFlags.enable(oA.clippingPlanes,!0):t.otherFlags.enable(oA.clippingPlanes,!1),this._matFuncsQueue.push(WA.clippingPlanes),this._applyAllMaterials()}getClippingPlanes(e=[]){return this._state.clippingPlanes.forEach(((t,r)=>{e[r]={direction:t.normal.toArray([]),height:t.constant}})),e.length=this._state.clippingPlanes.length,e}setUVMatrix(e,t){const r=this._state;switch(e){case"Map":t!==sA.uvMatrix?(r.uvMatrix?r.uvMatrix.fromArray(t):r.uvMatrix=(new Ph).fromArray(t),r.texFlags.enable(oA.uvMatrix,!0)):(r.uvMatrix=sA.uvMatrix,r.texFlags.enable(oA.uvMatrix,!1)),this._matFuncsQueue.push(WA.uvMatrix),this._applyAllMaterials();break;case"AlphaMap":t!==sA.alphaUvMatrix?(r.alphaUvMatrix?r.alphaUvMatrix.fromArray(t):r.alphaUvMatrix=(new Ph).fromArray(t),r.texFlags.enable(oA.alphaUvMatrix,!0)):(r.alphaUvMatrix=sA.alphaUvMatrix,r.texFlags.enable(oA.alphaUvMatrix,!1)),this._matFuncsQueue.push(WA.alphaUvMatrix),this._applyAllMaterials();break;case"EmissiveMap":t!==sA.emissiveUvMatrix?(r.emissiveUvMatrix?r.emissiveUvMatrix.fromArray(t):r.emissiveUvMatrix=(new Ph).fromArray(t),r.texFlags.enable(oA.emissiveUvMatrix,!0)):(r.emissiveUvMatrix=sA.emissiveUvMatrix,r.texFlags.enable(oA.emissiveUvMatrix,!1)),this._matFuncsQueue.push(WA.emissiveUvMatrix),this._applyAllMaterials()}}getUVMatrix(e,t=[]){const r=this._state;switch(e){case"Map":return r.uvMatrix?r.uvMatrix.toArray(t):null;case"AlphaMap":return r.alphaUvMatrix?r.alphaUvMatrix.toArray(t):null;case"EmissiveMap":return r.emissiveUvMatrix?r.emissiveUvMatrix.toArray(t):null;default:return null}}setEdge(e){const t=this._edges;e.enable&&(t.setColorAndOpacity(e.color,e.opacity),t.setGlow(e.glow)),t.enable=e.enable}getEdge(){return this._edges.getState()}setOutlineColor(e){e?this._effects.setOutlineColor(qA.fromArray(e)):this._effects.setOutlineColor(e)}getOutlineColor(e){const t=this._effects.getOutlineColor();return t?t.toArray(e):null}setEffect(e,t){this._effects.setState(e,t)}getEffect(e){return this._effects.getState(e)}equals(e,t){const r=this._state,n=e._state;if(r.opFlags._value!==n.opFlags._value||r.texFlags._value!==n.texFlags._value||r.otherFlags._value!==n.otherFlags._value)return!1;if(!this._effects.equals(e._effects)||!this._edges.equals(e._edges)||this._instancing.enable!==e._instancing.enable)return!1;for(const e in oA)if(r[e]!==n[e])return!1;return t&&t(),!0}enable(e,t){const r=this._state;switch(e){case"InstancedDrawing":this._instancing.enable!==!!t&&(t?this._reflects.setByNodes(this._linkedNodes):t||!r.isOrigin()||this._materialReflect||this._reflects.clearByNodes(this._linkedNodes),this._instancing.enable=!!t,t?(this._effects.applyInstancing(),this._edges.applyInstancing()):this._edges.clearInstancing());break;case"AlwaysOnTop":break;case"EnvMap":t!==sA.closeEnvTex?(r.closeEnvTex=!t,r.texFlags.enable(oA.closeEnvTex,!0)):(r.closeEnvTex=t,r.texFlags.enable(oA.closeEnvTex,!1)),this._matFuncsQueue.push(WA.closeEnvTex),this._applyAllMaterials();break;case"Wireframe":r.wireframe=t,t!==sA.wireframe?r.otherFlags.enable(oA.wireframe,!0):r.otherFlags.enable(oA.wireframe,!1),this._matFuncsQueue.push(WA.wireframe),this._applyAllMaterials();break;case"DepthTest":r.depthTest=t,t!==sA.depthTest?r.otherFlags.enable(oA.depthTest,!0):r.otherFlags.enable(oA.depthTest,!1),this._matFuncsQueue.push(WA.depthTest),this._applyAllMaterials();break;case"DepthWrite":r.depthWrite=t,t!==sA.depthWrite?r.otherFlags.enable(oA.depthWrite,!0):r.otherFlags.enable(oA.depthWrite,!1),this._matFuncsQueue.push(WA.depthWrite),this._applyAllMaterials();break;case"VerticalEmissive":r.verticalEmissive=t,t!==sA.verticalEmissive?r.texFlags.enable(oA.verticalEmissive,!0):r.texFlags.enable(oA.verticalEmissive,!1),this._matFuncsQueue.push(WA.verticalEmissive),this._applyAllMaterials()}}isEnabled(e){const t=this._state;switch(e){case"InstancedDrawing":return this._instancing.enable;case"AlwaysOnTop":break;case"EnvMap":return t.closeEnvTex===sA.closeEnvTex?t.closeEnvTex:!t.closeEnvTex;case"Wireframe":return t.wireframe;case"DepthTest":return t.depthTest;case"DepthWrite":return t.depthWrite;case"VerticalEmissive":return t.verticalEmissive;default:return!1}}tidyUpInstanceBuffer(){const e=this._instancing,t=e._indices,r=t._releasedIndices,n=r.length;if(0!=r.length){r.sort(),t._maxCount-=n,e._group.children.forEach((e=>{const i=e.geometry.getAttribute("instanceMatrix"),a=i.buffer.array,s=a.length/16,o=e.geometry.getAttribute("instanceID"),l=o.buffer.array;for(let e=n-1;e>=0;e--){const t=r[e];for(let e=t;e<s-1;e++)for(let t=0;t<16;t++){const r=a[16*e+t];a[16*e+t]=a[16*e+t+16],a[16*e+t+16]=r}for(let e=t;e<l.length-1;e++){const t=l[e];l[e]=l[e+1],l[e+1]=t}}i.buffer.version++,o.buffer.version++,e.geometry.instanceCount=t.size}));for(let[e,i]of t._map){let a=i,s=0;for(let e=0;e<n;e++)r[e]<a&&s++;s>0&&t._map.set(e,a-s)}r.length=0}}setInstancedMaxCount(e){this._instancing.instancedMaxCount=e}getInstancedMaxCount(){return this._instancing.instancedMaxCount}reset(){this._state.isOrigin()&&!this._instancing.enable||(this._state.reset(),this._instancing.enable=!1,this._applyAllMaterials(),this._reflects.isEmpty()||this._materialReflect||(console.warn("UStyle: material dispose count error."),this._reflects.dispose())),this._effects.isOrigin()||this._effects.reset(),this._edges.enable=!1}copy(e){this._state.copy(e._state),this._instancing.enable=e._instancing.enable,this._matFuncsQueue.push(...HA),this._applyAllMaterials(),this._effects.copy(e._effects),this._edges.copy(e._edges)}clone(){const e=new XA(this._instancing.instancedMaxCount,this._materialReflect);return e.copy(this),e}dispose(){this._materialReflect=null,this.reset(),this._effects.dispose(),this._effects=null,this._instancing.dispose(),this._instancing=null,this._edges.dispose(),this._edges=null,this._reflects.dispose(),this._reflects=null,this._linkedNodes.clear(),this._linkedNodes=null,this._matFuncsQueue=null}$onAdd(e){this.$addNode(e)}$onRemove(e){this.$removeNode(e)}$addNode(e,t=!1){if(!this._linkedNodes.has(e)){if(this._linkedNodes.add(e),this._reflects.active)if(t)this._reflects.addByNode(e);else{const t=[];this._reflects.setByNode(e,t);const r=this._state;t.forEach((e=>{const t=e.reflectMaterial,n=e.originMaterial;for(let e=0,i=HA.length;e<i;e++)HA[e](r,t,n)})),this._state.emissiveTex&&e._res&&e._res.generateUv3()}this._effects.isOrigin()||this._effects.apply(e),this._edges.enable&&this._edges.apply(e),this._instancing.enable?(this._instancing.addNode(e),this._effects.isOrigin()||this._effects.applyInstancing(),this._edges.enable&&this._edges.applyInstancing()):this._edges.clearInstancing()}}$removeNode(e){this._linkedNodes.has(e)&&(this._reflects.active&&this._reflects.clearByNode(e),this._effects&&!this._effects.isOrigin()&&this._effects.clear(e),this._edges&&this._edges.enable&&this._edges.clear(e),this._linkedNodes.delete(e),this._instancing.enable&&this._instancing.removeNode(e))}$parseOptions(e){return void 0!==e.colorOp&&this.setColorOp(e.colorOp),void 0!==e.opacityOp&&this.setOpacityOp(e.opacityOp),this}_applyAllMaterials(){if(this._applyLocked)return;const e=this._matFuncsQueue,t=this._reflects;if(!this._state.isOrigin()||this._instancing.enable||this._materialReflect){t.setByNodes(this._linkedNodes);const r=this._state;t.getAllReflects().forEach(((t,n)=>{const i=t.material;for(let t=0,a=e.length;t<a;t++)e[t](r,i,n)}))}else t.clearByNodes(this._linkedNodes);e.length=0}}class QA extends th{constructor(e){super(e),this.timeScale=1,this.totalTime=0,this.loop="Repeat",this.repetitions=1/0,this._loopTime=0,this.loopTimeCount=0,this._pause=!1,this._loopEvent={type:"loop",action:this,loopTime:this._loopTime},this._finishEvent={type:"finished",action:this,direction:this.timeScale>0?1:-1}}_initialPlayAttribute(e){e?(void 0!==e.loopType&&(this.loop=e.loopType),void 0!==e.loopTimes&&(this.repetitions=e.loopTimes)):(this.loop="Repeat",this.repetitions=1/0)}play(e){this.time=0,this._loopTime=0,this._initialPlayAttribute(e),this.weight=1}stop(){this.weight=0,this.time=0,this.totalTime=0,this.loopTimeCount=0,this.timeScale=1}pause(){this._pause=!0,this._effectiveTimeScale=this.timeScale,this.timeScale=0}resume(){this._pause=!1,this._effectiveTimeScale?this.timeScale=this._effectiveTimeScale:this.timeScale=1}isRunning(){return 0!==this.weight}_stopWhenFinish(e){if(this._loopTime>=this.repetitions)switch(e){case"Up":this.timeScale=0,this.time=this.clip.duration;break;case"Down":this.timeScale=0,this.time=0}}update(e){if(0==this.timeScale)return;this.totalTime+=e*Math.abs(this.timeScale);const t=0===this.clip.duration?1e-11:this.clip.duration;this._loopTime=Math.floor(this.totalTime/t),1!==this.repetitions&&this._loopTime-this.loopTimeCount>=1&&(this._loopEvent.loopTime=this._loopTime,this.dispatchEvent(this._loopEvent),this.loopTimeCount=this._loopTime),this.repetitions!==1/0&&this._loopTime==this.repetitions&&(this._finishEvent.direction=this.timeScale>0?1:-1,this.dispatchEvent(this._finishEvent)),"Repeat"===this.loop?this.timeScale>=0?(this.time=this.totalTime%t,this._stopWhenFinish("Up")):(this.time=t-this.totalTime%t,this._stopWhenFinish("Down")):"PingPong"===this.loop&&(this.timeScale>=0?0===Math.abs(parseInt(this.totalTime/t)%2)?(this.time=this.totalTime%t,this._stopWhenFinish("Up")):(this.time=t-this.totalTime%t,this._stopWhenFinish("Down")):0===Math.abs(parseInt(this.totalTime/t)%2)?(this.time=t-this.totalTime%t,this._stopWhenFinish("Down")):(this.time=this.totalTime%t,this._stopWhenFinish("Up")))}}const KA="Playing",YA="Paused",ZA="Stopped",JA={Repeat:"Repeat",PingPong:"PingPong"},$A={};for(let e in JA)$A[JA[e]]=e;class eS extends eh{constructor(e){super(),this._unode=null,this._clips=e,this._mixer=null,this._actions=new Map}setAttribute(e,t,r){const n=this._actions.get(e);n||console.error("Can not find animation <"+e+">"),"TimeScale"===t&&(0==n._pause?n.timeScale=r:n._effectiveTimeScale=r)}getAttribute(e,t){const r=this._actions.get(e);if(r||console.error("Can not find animation <"+e+">"),"TimeScale"===t)return r.timeScale;if("Duration"===t)return r.clip.duration;if("FramesRange"===t);else{if("LoopType"===t)return $A[r.loop];if("LoopTimes"===t)return r.repetitions}}getNames(e=[]){return this._actions.forEach(((t,r)=>{e.push(r)})),e}getState(e){const t=this._actions.get(e);return t||console.error("Can not find animation <"+e+">"),t.isRunning()&&0!==t.timeScale?KA:t.isRunning()&&0===t.timeScale?YA:ZA}play(e,t){const r=this._actions.get(e);r||console.error("Can not find animation <"+e+">"),r.play(t),this.$update(0),this._unode.$childrenMatrixAutoUpdate||this._unode.$markChildrenMatrixAutoUpdate(!0),this._unode.$uScene.$animationPlayers.add(this),this._unode.$uScene.$transformCache.addResident(this._unode)}_hasNoActionsInUse(){const e=this._mixer._actions;for(let t=0;t<e.length;t++)if(e[t].isRunning())return!1;return!0}stop(e){const t=this._actions.get(e);t||console.error("Can not find animation <"+e+">"),t.stop(),this.$update(0),this._hasNoActionsInUse()&&(this._unode.$uScene.$animationPlayers.delete(this),this._unode.$uScene.$transformCache.removeResident(this._unode))}pause(e){const t=this._actions.get(e);t||console.error("Can not find animation <"+e+">"),t.pause()}resume(e){const t=this._actions.get(e);t||console.error("Can not find animation <"+e+">"),t.resume()}dispose(){this._clips=null;const e=this._unode.$uScene.$animationPlayers;e.has(this)&&e.delete(this),this._unode.$uScene.$transformCache.removeResident(this._unode),this._listeners&&(this._listeners=void 0)}copy(e){return this._clips=e.clips,this}clone(){return new this.constructor(this._clips)}$onAdd(e){this._unode=e,this._mixer=new dh,this._clips.forEach((e=>{const t=new QA(e);t.addEventListener("finished",(e=>{this.dispatchEvent({type:"finished",name:e.action.clip.name,direction:e.direction})})),t.addEventListener("loop",(e=>{this.dispatchEvent({type:"loop",name:e.action.clip.name,loopTime:e.loopTime})})),this._mixer.addAction(t),this._actions.set(e.name,t)}))}$onRemove(e){this._mixer&&this._mixer._listeners&&(this._mixer._listeners=void 0),this._unode=null,this._mixer=null,this._actions.clear()}$update(e){this._unode.$hasComponent(jx)&&(this._unode.$boundingBox.selfBoundingBoxNeedsUpdate=!0),this._mixer&&this._mixer.update(e)}}const tS=function(e,t,r){const n=new Map,i=new Map,a=e.clone();return rS(e,a,(function(e,t){n.set(t,e),i.set(e,t)})),a.traverse((function(e){if(!e.skeleton)return;const t=e,r=n.get(e),a=r.skeleton.bones;t.skeleton=r.skeleton.clone(),t.bindMatrix.copy(r.bindMatrix),t.skeleton.bones=a.map((function(e){return i.get(e)}))})),t&&t.length>0&&t.forEach((function(e){const t=e.tracks.map((function(e){return new e.constructor(i.get(e.target),e.propertyPath,e.times,e.values,e.interpolant)})),n=new ph(e.name,t,e.duration);r.push(n)})),a};function rS(e,t,r){r(e,t);for(let n=0;n<e.children.length;n++)rS(e.children[n],t.children[n],r)}const nS=new Sh,iS=new Sc,aS=new Sc,sS=new Sc,oS=new bc,lS=new Ph,uS=e=>e._visible;class cS{constructor(){this._unode=null,this._selfBoundingBox=null,this._boundingBox=null,this._selfBoundingBoxDirty=!0,this.selfBoundingBoxLock=!1}set selfBoundingBoxNeedsUpdate(e){this._selfBoundingBoxDirty=e}get selfBoundingBox(){return this._updateSelfBoundingBox(),this._selfBoundingBox}copy(e){this._selfBoundingBox.copy(e._selfBoundingBox),this._boundingBox.copy(e._boundingBox),this._selfBoundingBoxDirty=e._selfBoundingBoxDirty,this.selfBoundingBoxLock=e.selfBoundingBoxLock}getOBB(e,t,r=!0,n=!1){r&&this._unode._node.updateWorldMatrix(!0),this._updateBoundingBox(t),e.fromBox3(this._boundingBox),((e,t)=>{const r=t.elements;let n=oS.set(r[0],r[1],r[2]).getLength();const i=oS.set(r[4],r[5],r[6]).getLength(),a=oS.set(r[8],r[9],r[10]).getLength();t.determinant()<0&&(n=-n),lS.setFromMatrix4(t);const s=1/n,o=1/i,l=1/a;lS.elements[0]*=s,lS.elements[1]*=s,lS.elements[2]*=s,lS.elements[3]*=o,lS.elements[4]*=o,lS.elements[5]*=o,lS.elements[6]*=l,lS.elements[7]*=l,lS.elements[8]*=l,e.rotation.multiply(lS),e.halfSize.x*=n,e.halfSize.y*=i,e.halfSize.z*=a,e.center.applyMatrix4(t)})(e,n?this._unode._node.matrix:this._unode._node.worldMatrix)}getAABB(e,t,r=!0,n=!1){return r&&this._unode._node.updateWorldMatrix(!0),this._updateBoundingBox(t,n?1:2),e.copy(this._boundingBox),e}dispose(){}$onAdd(e){this._unode=e,this._selfBoundingBox=new Sh,this._boundingBox=new Sh}$onRemove(){this._unode=null,this._selfBoundingBox=null,this._boundingBox=null}_updateBoundingBox(e=uS,t=0){this._unode.$isContainer?(this._unode._node.updateMatrix(),this.selfBoundingBoxLock||this._selfBoundingBox.makeEmpty(),this._boundingBox.makeEmpty(),this._unode.$traverseBranch((r=>{if(!e(r))return!1;if(!r.isRenderableNode)return!0;if(r.$isContainer){if(r.$boundingBox.selfBoundingBoxLock)return nS.copy(r.$boundingBox._selfBoundingBox),nS.isEmpty()||(2===t?nS.applyMatrix4(r._node.worldMatrix):1===t?(iS.getInverse(this._unode._node.worldMatrix),iS.multiply(r._node.worldMatrix),iS.premultiply(this._unode._node.matrix),nS.applyMatrix4(iS)):0===t&&(iS.getInverse(this._unode._node.worldMatrix),iS.multiply(r._node.worldMatrix),nS.applyMatrix4(iS)),this._boundingBox.expandByPoint(nS.min),this._boundingBox.expandByPoint(nS.max)),!1}else{if(r.$boundingBox._updateSelfBoundingBox(),nS.copy(r.$boundingBox._selfBoundingBox),nS.isEmpty())return!0;2===t?nS.applyMatrix4(r._node.worldMatrix):1===t?(iS.getInverse(this._unode._node.worldMatrix),iS.multiply(r._node.worldMatrix),iS.premultiply(this._unode._node.matrix),nS.applyMatrix4(iS)):0===t&&(iS.getInverse(this._unode._node.worldMatrix),iS.multiply(r._node.worldMatrix),nS.applyMatrix4(iS)),this._boundingBox.expandByPoint(nS.min),this._boundingBox.expandByPoint(nS.max)}return!0}))):e(this._unode)?(this._updateSelfBoundingBox(),this._boundingBox.copy(this._selfBoundingBox),2===t?this._boundingBox.applyMatrix4(this._unode._node.worldMatrix):1===t&&this._boundingBox.applyMatrix4(this._unode._node.matrix)):this._boundingBox.makeEmpty()}_updateSelfBoundingBox(){this._selfBoundingBoxDirty&&!this.selfBoundingBoxLock&&(this._selfBoundingBox.makeEmpty(),this._unode.$isContainer||(this._unode._node.updateMatrix(),this._unode.$getRenderableList().forEach((e=>{let t=e.geometry,r=e.visible||e===this._unode._node;if(void 0!==t&&r){if(null===t.boundingBox&&t.computeBoundingBox(),nS.copy(t.boundingBox),nS.isEmpty())return;iS.copy(this._unode._node.worldMatrix),aS.copy(e.worldMatrix).premultiply(sS.getInverse(iS)),nS.applyMatrix4(aS),this._selfBoundingBox.expandByPoint(nS.min),this._selfBoundingBox.expandByPoint(nS.max)}}))),this._selfBoundingBoxDirty=!1)}}const hS="waiting",dS="loading",pS="loaded";let fS=class{constructor(e){this._url=e,this._state=hS,this._promise=null,this._data=null}get url(){return this._url}get state(){return this._state}get data(){return this._data}get promise(){return this._promise}load(){}dispose(){}};const mS=(e,t)=>{const r=new WeakMap;e.traverse((e=>{if(!e.material)return;const n=t(e.material,r);e.material=n}))},gS=(e,t={})=>{let r=e.clone();return r.isPBRMaterial&&(void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.image&&(r.diffuseMap=t.image.$texture),void 0!==t.color&&r.diffuse.fromArray(t.color),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.envMap&&!1===t.envMap&&(r.envMap=void 0)),r},_S=e=>{const t=new T_;return t.defines=U_(t.defines,e.defines),t.uniforms=U_(t.uniforms,e.uniforms),t.diffuse=e.diffuse,t.diffuseMap=e.diffuseMap,t.opacity=e.opacity,t.transparent=e.transparent,t.aoMap=e.aoMap,t.aoMapIntensity=e.aoMapIntensity,t.alphaMap=e.alphaMap,t.envMap=e.envMap,t.envMapIntensity=e.envMapIntensity,t.needsUpdate=!0,t};function vS(e,t,r){r.forEach((r=>{r.material===e&&(r.material=t)}))}const yS=new Sc,xS=(e,t,r)=>{const n=new Map;e.traverse((e=>{if(e.isMesh){let t=e.material;n.has(t)||n.set(t,[]),n.get(t).push({offset:e.worldMatrix.clone(),geometry:e.geometry})}}));const i=[];return n.forEach(((e,n)=>{const a=[];e.forEach((e=>{t.forEach(((t,n)=>{const i=e.geometry.clone();if(yS.fromArray(t).multiply(e.offset),Gb.applyMatrix4(i,yS),r){const e=i.getAttribute("a_Position").buffer.count,t=r[n];i.addAttribute("ids",new up(new cp(new Float32Array(e).fill(t),1)))}i.boundingBox=null,i.boundingSphere=null,a.push(i)}))}));const s=Gb.mergeGeometries(a,!1);r&&(s.__pickIds=r.slice(0)),a[0]&&0!==a[0].groups.length&&(s.groups=a[0].groups.map((e=>({start:0,count:e.count*t.length,materialIndex:e.materialIndex})))),s.computeBoundingBox(),s.computeBoundingSphere(),i.push(new ap(s,n))})),n.clear(),i};let bS=null;const AS=new Mv,SS=new bc,ES=new Sc,wS=new Sc,CS=new Sc,TS=new Sc,DS=new Ph,MS=new bc,PS=new bc,FS=new Zh,RS=new Zh,NS=new Zh,BS=new Zh,IS=new Zh,OS=(e,t)=>{const r=e.elements;return r[0]*=t,r[4]*=t,r[8]*=t,r[12]*=t,r[1]*=t,r[5]*=t,r[9]*=t,r[13]*=t,r[2]*=t,r[6]*=t,r[10]*=t,r[14]*=t,r[3]*=t,r[7]*=t,r[11]*=t,r[15]*=t,e},kS=(e,t)=>{const r=e.elements,n=t.elements;return r[0]+=n[0],r[4]+=n[4],r[8]+=n[8],r[12]+=n[12],r[1]+=n[1],r[5]+=n[5],r[9]+=n[9],r[13]+=n[13],r[2]+=n[2],r[6]+=n[6],r[10]+=n[10],r[14]+=n[14],r[3]+=n[3],r[7]+=n[7],r[11]+=n[11],r[15]+=n[15],e},LS={9728:"NearestFilter",9729:"LinearFilter",9984:"NearestMipmapNearestFilter",9985:"LinearMipmapNearestFilter",9986:"NearestMipmapLinearFilter",9987:"LinearMipmapLinearFilter"},US={33071:"ClampToEdge",33648:"MirroredRepeat",10497:"Repeat"},zS=e=>{const t=e.scale;for(let r=0;r<e.children.length;r++){const n=e.children[r];SS.copy(n.position);const i=n.scale;SS.applyQuaternion(e.quaternion),n.position.copy(SS),n.scale.set(t.x*i.x,t.y*i.y,t.z*i.z),n.quaternion.premultiply(e.quaternion)}if(e.children.length>0){e.quaternion.set(0,0,0,1),e.scale.set(1,1,1);for(let t=0;t<e.children.length;t++){const r=e.children[t];r.isMesh||zS(r)}}};const jS=["diffuseMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","alphaMap","specularMap"],VS=(e,t)=>{let r,n,i;t&&(r=t._weakCache,n=t._weakCache2,i=t._weakCache3),e.traverse((e=>{if(e.geometry){const a=e.geometry;if(t){const e=r.get(a);e&&e.dispose();const t=n.get(a);t&&t.dispose();const s=i.get(a);s&&s.dispose()}a.dispose()}if(e.material){const t=e.material;Array.isArray(t)?t.forEach((e=>{e.dispose(),jS.forEach((t=>{e[t]&&e[t].isTexture2D&&e[t].dispose()}))})):(t.dispose(),jS.forEach((e=>{t[e]&&t[e].isTexture&&t[e].dispose()})))}e.skeleton&&e.skeleton.boneTexture&&e.skeleton.boneTexture.dispose()}))},GS=new Map([["baseColorTexture","diffuseMap"],["maskTexture","alphaMap"],["emissiveTexture","emissiveMap"]]),WS=(e,t)=>{(Array.isArray(e)?e:[e]).forEach((e=>{e.userData&&e.userData.gltfExtensions&&GS.forEach(((r,n)=>{let i,a=e.userData.gltfExtensions[n];a&&(Array.isArray(a.textureExtensions)?(a.textureExtensions.length>1&&console.warn("complex animation not supported yet!"),i=a.textureExtensions[0].extensions):i=a,i&&(i.multiFramesAnim?t.push({material:e,key:r,anim:HS(i)}):(i.scrollAnim||i.rotateAnim||i.scaleAnim||i.scroll||i.scale)&&t.push({material:e,key:r,anim:qS(i)})))}))}))},HS=e=>{const t=e.multiFramesAnim.tilesX,r=e.multiFramesAnim.tilesY,n={type:"frames",start:{offset:[0,0],repeat:[1,1],rotation:0},wrapMode:999+(void 0!==e.wrapMode?parseInt(e.wrapMode):1),numberOfTiles:t*r,tileDisplayDuration:1/e.multiFramesAnim.animSpeed||1,tilesX:t,tilesY:r,loop:void 0!==e.multiFramesAnim.loop?parseInt(e.multiFramesAnim.loop):1/0,random:void 0!==e.multiFramesAnim.random&&!!e.multiFramesAnim.random,interval:void 0!==e.multiFramesAnim.interval?parseInt(e.multiFramesAnim.interval):0};return e.scroll&&(n.start.offset[0]=e.scroll[0],n.start.offset[1]=e.scroll[1]),n.start.repeat[0]=1/t,n.start.repeat[1]=1/r,n},qS=e=>{const t={type:"transform",start:{offset:[0,0],repeat:[1,1],rotation:0},offset:[0,0],scale:0,rotation:0,offsetRandom:[0,0],scaleRandom:0,rotationRandom:0,offsetLoop:1/0,scaleLoop:1/0,rotationLoop:1/0,offsetInterval:0,scaleInterval:0,rotationInterval:0};e.scroll&&(t.start.offset[0]=e.scroll[0],t.start.offset[1]=e.scroll[1]);let r=e.scale||e.repeat;return r&&(Array.isArray(r)?(t.start.repeat[0]=1/r[0],t.start.repeat[1]=1/r[1]):(t.start.repeat[0]=1/r,t.start.repeat[1]=1/r)),e.scrollAnim&&(void 0!==e.scrollAnim.speed?(t.offset[0]=-e.scrollAnim.speed[0],t.offset[1]=-e.scrollAnim.speed[1],void 0!==e.scrollAnim.T&&void 0!==e.scrollAnim.A&&(t.offsetRandom[0]=0==e.scrollAnim.T[0]?0:e.scrollAnim.A[0]/e.scrollAnim.T[0],t.offsetRandom[1]=0==e.scrollAnim.T[1]?0:e.scrollAnim.A[1]/e.scrollAnim.T[1]),void 0!==e.scrollAnim.loop&&(t.offsetLoop=parseInt(e.scrollAnim.loop)),void 0!==e.scrollAnim.interval&&(t.offsetInterval=parseFloat(e.scrollAnim.interval))):(t.offset[0]=-e.scrollAnim[0],t.offset[1]=-e.scrollAnim[1])),e.scaleAnim&&(void 0!==e.scaleAnim.speed?(t.scale=e.scaleAnim.speed,void 0!==e.scaleAnim.T&&void 0!==e.scaleAnim.A&&(t.scaleRandom=e.scaleAnim.A/e.scaleAnim.T),void 0!==e.scaleAnim.loop&&(t.scaleLoop=Number(e.scaleAnim.loop)),void 0!==e.scaleAnim.interval&&(t.scaleInterval=parseFloat(e.scaleAnim.interval))):t.scale=e.scaleAnim),e.rotateAnim&&(void 0!==e.rotateAnim.speed?(t.rotation=e.rotateAnim.speed/180*Math.PI,void 0!==e.rotateAnim.T&&void 0!==e.rotateAnim.A&&(t.rotationRandom=e.rotateAnim.A/e.rotateAnim.T),void 0!==e.rotateAnim.loop&&(t.rotationLoop=Number(e.rotateAnim.loop)),void 0!==e.rotateAnim.interval&&(t.rotationInterval=parseFloat(e.rotateAnim.interval))):t.rotation=e.rotateAnim/180*Math.PI),t},XS=(e,t)=>(e.forEach((e=>{t.push({material:e.material,key:e.key,anim:e.anim})})),t),QS=new Sc,KS=(e,t)=>{const r=N_(e,t,QS),n=e.geometry;if(n&&!n.getAttribute("a_Uv3")){const e=n.getAttribute("a_Position"),t=new up(new cp(new Float32Array(2*e.buffer.count),2)),i=MS;let a=-1/0,s=1/0;for(let n=0;n<e.buffer.count;n++)i.fromArray(e.buffer.array,3*n).applyMatrix4(r),t.buffer.array[2*n+0]=.5,t.buffer.array[2*n+1]=i.y,a=Math.max(a,i.y),s=Math.min(s,i.y);const o=a-s;for(let r=0;r<e.buffer.count;r++)t.buffer.array[2*r+1]=t.buffer.array[2*r+1]/o;n.addAttribute("a_Uv3",t),n.dispatchEvent({type:"set-uv3",uv3:t})}};class YS extends gh{constructor(e){super(e)}load(e,t,r,n){const i=this,a=new _h(this.manager);a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){void 0!==t&&t(i.parse(e))}),r,n)}parse(e){const t=0,r=1,n=2,i=3,a=9,s=10,o=11,l=48,u=4,c=0,h=1,d=3;e.length<19&&console.error("TGALoader.parse: Not enough data to contain header.");let p=0;const f=new Uint8Array(e),m={id_length:f[p++],colormap_type:f[p++],image_type:f[p++],colormap_index:f[p++]|f[p++]<<8,colormap_length:f[p++]|f[p++]<<8,colormap_size:f[p++],origin:[f[p++]|f[p++]<<8,f[p++]|f[p++]<<8],width:f[p++]|f[p++]<<8,height:f[p++]|f[p++]<<8,pixel_size:f[p++],flags:f[p++]};!function(e){switch(e.image_type){case r:case a:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("TGALoader.parse.tgaCheckHeader: Invalid type colormap data for indexed type.");break;case n:case i:case s:case o:e.colormap_type&&console.error("TGALoader.parse.tgaCheckHeader: Invalid type colormap data for colormap type.");break;case t:console.error("TGALoader.parse.tgaCheckHeader: No data.");default:console.error('TGALoader.parse.tgaCheckHeader: Invalid type " '+e.image_type+'".')}(e.width<=0||e.height<=0)&&console.error("TGALoader.parse.tgaCheckHeader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('TGALoader.parse.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'".')}(m),m.id_length+p>e.length&&console.error("TGALoader.parse: No data."),p+=m.id_length;let g=!1,_=!1,v=!1;switch(m.image_type){case a:g=!0,_=!0;break;case r:_=!0;break;case s:g=!0;break;case n:break;case o:g=!0,v=!0;break;case i:v=!0}const y=new Uint8Array(m.width*m.height*4),x=function(e,t,r,n,i){let a,s;const o=r.pixel_size>>3,l=r.width*r.height*o;if(t&&(s=i.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),e){let e,t,r;a=new Uint8Array(l);let s=0;const u=new Uint8Array(o);for(;s<l;)if(e=i[n++],t=1+(127&e),128&e){for(r=0;r<o;++r)u[r]=i[n++];for(r=0;r<t;++r)a.set(u,s+r*o);s+=o*t}else{for(t*=o,r=0;r<t;++r)a[s+r]=i[n++];s+=t}}else a=i.subarray(n,n+=t?r.width*r.height:l);return{pixel_data:a,palettes:s}}(g,_,m,p,f);return function(e,t,r,n,i){let a,s,o,p,f,g;switch((m.flags&l)>>u){case c:a=0,o=1,f=t,s=r-1,p=-1,g=-1;break;case d:a=t-1,o=-1,f=-1,s=0,p=1,g=r;break;case h:a=t-1,o=-1,f=-1,s=r-1,p=-1,g=-1;break;default:a=0,o=1,f=t,s=0,p=1,g=r}if(v)switch(m.pixel_size){case 8:!function(e,t,r,n,i,a,s,o){let l,u,c,h=0;const d=m.width;for(c=t;c!==n;c+=r)for(u=i;u!==s;u+=a,h++)l=o[h],e[4*(u+d*c)+0]=l,e[4*(u+d*c)+1]=l,e[4*(u+d*c)+2]=l,e[4*(u+d*c)+3]=255}(e,s,p,g,a,o,f,n);break;case 16:!function(e,t,r,n,i,a,s,o){let l,u,c=0;const h=m.width;for(u=t;u!==n;u+=r)for(l=i;l!==s;l+=a,c+=2)e[4*(l+h*u)+0]=o[c+0],e[4*(l+h*u)+1]=o[c+0],e[4*(l+h*u)+2]=o[c+0],e[4*(l+h*u)+3]=o[c+1]}(e,s,p,g,a,o,f,n);break;default:console.error("TGALoader.parse.getTgaRGBA: not support this format")}else switch(m.pixel_size){case 8:!function(e,t,r,n,i,a,s,o,l){const u=l;let c,h,d,p=0;const f=m.width;for(d=t;d!==n;d+=r)for(h=i;h!==s;h+=a,p++)c=o[p],e[4*(h+f*d)+3]=255,e[4*(h+f*d)+2]=u[3*c+0],e[4*(h+f*d)+1]=u[3*c+1],e[4*(h+f*d)+0]=u[3*c+2]}(e,s,p,g,a,o,f,n,i);break;case 16:!function(e,t,r,n,i,a,s,o){let l,u,c,h=0;const d=m.width;for(c=t;c!==n;c+=r)for(u=i;u!==s;u+=a,h+=2)l=o[h+0]+(o[h+1]<<8),e[4*(u+d*c)+0]=(31744&l)>>7,e[4*(u+d*c)+1]=(992&l)>>2,e[4*(u+d*c)+2]=(31&l)>>3,e[4*(u+d*c)+3]=32768&l?0:255}(e,s,p,g,a,o,f,n);break;case 24:!function(e,t,r,n,i,a,s,o){let l,u,c=0;const h=m.width;for(u=t;u!==n;u+=r)for(l=i;l!==s;l+=a,c+=3)e[4*(l+h*u)+3]=255,e[4*(l+h*u)+2]=o[c+0],e[4*(l+h*u)+1]=o[c+1],e[4*(l+h*u)+0]=o[c+2]}(e,s,p,g,a,o,f,n);break;case 32:!function(e,t,r,n,i,a,s,o){let l,u,c=0;const h=m.width;for(u=t;u!==n;u+=r)for(l=i;l!==s;l+=a,c+=4)e[4*(l+h*u)+2]=o[c+0],e[4*(l+h*u)+1]=o[c+1],e[4*(l+h*u)+0]=o[c+2],e[4*(l+h*u)+3]=o[c+3]}(e,s,p,g,a,o,f,n);break;default:console.error("TGALoader.parse.getTgaRGBA: not support this format")}}(y,m.width,m.height,x.pixel_data,x.palettes),{data:y,width:m.width,height:m.height,flipY:!0,generateMipmaps:!0,minFilter:Vc.LINEAR_MIPMAP_LINEAR}}}const ZS=new _h;ZS.setResponseType("json");class JS extends gh{constructor(e){super(e)}load(e,t,r,n){const i=this,a=new _h(this.manager);a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){void 0!==t&&t(i.parse(e,!0))}),r,n)}parse(e,t){const r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e,t,r,n){const i=r*n*4,a=new Uint8Array(e,t,i),s=new Uint8Array(i);let o=0,l=0;for(let e=0;e<n;e++)for(let e=0;e<r;e++){const e=a[l];l++;const t=a[l];l++;const r=a[l];l++;const n=a[l];l++,s[o]=r,o++,s[o]=t,o++,s[o]=e,o++,s[o]=n,o++}return s}const a=n("DXT1"),s=n("DXT3"),o=n("DXT5"),l=n("ETC1"),u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("DDSLoader.parse: Invalid magic number in DDS header."),r;let c;const h=u[21];let d=!1;switch(h){case a:c=8,r.format=zc.RGB_S3TC_DXT1;break;case s:c=16,r.format=zc.RGBA_S3TC_DXT3;break;case o:c=16,r.format=zc.RGBA_S3TC_DXT5;break;case l:c=8,r.format=zc.RGB_ETC1;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("DDSLoader.parse: Unsupported FourCC code ",(p=h,String.fromCharCode(255&p,p>>8&255,p>>16&255,p>>24&255))),r;d=!0,c=64,r.format=zc.RGBA}var p;r.mipmapCount=1,131072&u[2]&&!1!==t&&(r.mipmapCount=Math.max(1,u[7]));const f=u[28];if(r.isCubemap=!!(512&f),r.isCubemap&&(!(1024&f)||!(2048&f)||!(4096&f)||!(8192&f)||!(16384&f)||!(32768&f)))return console.error("DDSLoader.parse: Incomplete cubemap faces"),r;r.width=u[4],r.height=u[3];let m=u[1]+4;const g=r.isCubemap?6:1;for(let t=0;t<g;t++){let t=r.width,n=r.height;for(let a=0;a<r.mipmapCount;a++){let a,s;d?(a=i(e,m,t,n),s=a.length):(s=Math.max(4,t)/4*Math.max(4,n)/4*c,a=new Uint8Array(e,m,s));const o={data:a,width:t,height:n};r.mipmaps.push(o),m+=s,t=Math.max(t>>1,1),n=Math.max(n>>1,1)}}return r}}class $S extends gh{constructor(e){super(e)}load(e,t,r,n){const i=this,a=new _h(this.manager);a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){void 0!==t&&t(i.parse(e,!0))}),r,n)}parse(e,t){const r=new Uint32Array(e,0,13),n={buffer:e,header:r,loadMipmaps:t};return 55727696===r[0]?function(e){const t=e.header;let r,n;const i=t[12],a=t[2],s=t[6],o=t[7],l=t[10],u=t[11];switch(a){case 0:r=2,n=zc.RGB_PVRTC_2BPPV1;break;case 1:r=2,n=zc.RGBA_PVRTC_2BPPV1;break;case 2:r=4,n=zc.RGB_PVRTC_4BPPV1;break;case 3:r=4,n=zc.RGBA_PVRTC_4BPPV1;break;default:console.error("PVRLoader: Unsupported PVR format:",a)}return e.dataPtr=52+i,e.bpp=r,e.format=n,e.width=o,e.height=s,e.numSurfaces=l,e.numMipmaps=u,e.isCubemap=6===l,eE(e)}(n):559044176===r[11]?function(e){const t=e.header,r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[10],l=t[12],u=24,c=255&s;let h,d;const p=o>0;25===c?(d=p?zc.RGBA_PVRTC_4BPPV1:zc.RGB_PVRTC_4BPPV1,h=4):c===u?(d=p?zc.RGBA_PVRTC_2BPPV1:zc.RGB_PVRTC_2BPPV1,h=2):console.error("PVRLoader: Unknown PVR format:",c);return e.dataPtr=r,e.bpp=h,e.format=d,e.width=i,e.height=n,e.numSurfaces=l,e.numMipmaps=a+1,e.isCubemap=6===l,eE(e)}(n):void console.error("PVRLoader: Unknown PVR format.")}}function eE(e){const t={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},r=e.buffer;let n=e.dataPtr,i=0,a=0,s=0,o=0,l=0,u=0;const c=e.bpp,h=e.numSurfaces;2===c?(s=8,o=4):(s=4,o=4),a=s*o*c/8,t.mipmaps.length=e.numMipmaps*h;let d=0;for(;d<e.numMipmaps;){const c=e.width>>d,p=e.height>>d;l=c/s,u=p/o,l<2&&(l=2),u<2&&(u=2),i=l*u*a;for(let a=0;a<h;a++){const s={data:new Uint8Array(r,n,i),width:c,height:p};t.mipmaps[a*e.numMipmaps+d]=s,n+=i}d++}return t}const tE="model",rE="image",nE="json",iE="compressed_texture",aE=new Map([[tE,class extends fS{constructor(e){super(e),this._modelInfo={},this._callBackArr=[],this._errorBackArr=[];const t=bS;this._overrideTextureLoader=t?function(e,r){const n=t(e,{flipY:!1,magFilter:LS[(i=r).magFilter]||"LinearFilter",minFilter:LS[i.minFilter]||"LinearMipmapLinearFilter",wrapS:US[i.wrapS]||"Repeat",wrapT:US[i.wrapT]||"Repeat"});var i;return n?n.then((e=>e?e.$texture:null)):Promise.resolve(null)}:null,this._prefabs=new Map,this._weakCache=new WeakMap,this._weakCache2=new WeakMap,this._weakCache3=new WeakMap}load(){this._state=dS;const e=AS;return this._promise=new Promise(((t,r)=>{e.loadFromURL({url:this._url,onLoadTexture:this._overrideTextureLoader}).then((e=>{this._state=pS,this._promise=null,this._data=e;const r=[],n={Glow:0,InnerGlow:0};this._data.node.updateMatrix(!0);let i=!1;this._data.node.traverse((e=>{if(e.material&&WS(e.material,r),e.castShadow=!0,e.receiveShadow=!0,e.effects)for(let t in e.effects)void 0!==n[t]&&void 0!==e.effects[t]&&e.effects[t]>0&&"skip"!==e._cachedEffects[t]&&n[t]++;e.userData.billboard&&(i=!0)})),this._data.textureAnimClips=r,this._data.effectCounts=n,this._data.billboard=i,t(this)})).catch((e=>{this._state=hS,this._promise=null,this._data=null,r(e)}))})),this._promise}_getDataByKey(e,t){let r;if(this._prefabs.has(e))r=this._prefabs.get(e);else{const n=[],i=tS(this._data.node,this._data.animations,n);t.applyTransposeToMesh&&zS(i),r={node:i,textureAnimClips:[],animations:n},XS(this._data.textureAnimClips,r.textureAnimClips),0==t.lights?((e,t=[],r={})=>{mS(e,((e,n)=>{if(Array.isArray(e))return e.map((e=>{if(!e.isPBRMaterial)return e;let r;return n.has(e)?r=n.get(e):(r=_S(e),vS(e,r,t),n.set(e,r)),r}));{if(!e.isPBRMaterial)return e;let i;return n.has(e)?i=n.get(e):(i=_S(e),void 0!==r.image&&(i.diffuseMap=image.$texture),void 0!==r.color&&i.diffuse.fromArray(r.color),void 0!==r.transparent&&(i.transparent=r.transparent),void 0!==r.opacity&&(i.opacity=r.opacity),void 0!==r.envMap&&!1===r.envMap&&(i.envMap=void 0),vS(e,i,t),n.set(e,i)),i}}))})(r.node,r.textureAnimClips,t):((e,t,r=[])=>{mS(e,((e,n)=>{if(Array.isArray(e))return e.map((e=>{if(!e.isPBRMaterial)return e;let i;return n.has(e)?i=n.get(e):(i=gS(e,t),vS(e,i,r),n.set(e,i)),i}));{if(!e.isPBRMaterial)return e;let i;return n.has(e)?i=n.get(e):(i=gS(e,t),vS(e,i,r),n.set(e,i)),i}}))})(r.node,t,r.textureAnimClips),this._prefabs.set(e,r)}return r}_getCacheKey(e){let t="";return!1===e.lights?t="lights-"+e.lights:void 0===e.metalness&&void 0===e.roughness||(t+="metalness-"+e.metalness+"roughness-"+e.roughness),void 0!==e.image&&(t+="image-"+e.image.$texture.id),void 0!==e.color&&(t+="color-"+e.color[0]+e.color[1]+e.color[2]),void 0!==e.transparent&&(t+="transparent-"+e.transparent),void 0!==e.opacity&&(t+="opacity-"+e.opacity),e.applyTransposeToMesh&&(t+="applyTransposeToMesh"),void 0!==e.envMap&&(t+="envMap-"+e.envMap),t}getData(e={}){if(!this._data)return null;let t,r;return r=void 0!==e.id?e.id:this._getCacheKey(e),t=r?this._getDataByKey(r,e):this._data,{node:t.node,textureAnimClips:XS(t.textureAnimClips,[]),animations:t.animations,billboard:t.billboard,effectCounts:t.effectCounts,ik:t.ik}}getGeometryFromSkinned(e,t={}){if(!e)return null;let r=this._weakCache.get(e);if(r)return r;if(!t.bindMatrix||!t.bindMatrixInverse||!t.boneMatrices)return null;r=e.clone();const n=t.bindMatrix,i=t.bindMatrixInverse,a=t.boneMatrices,s=t.offsetMatrix,o=r.attributes.a_Position,l=r.attributes.skinIndex,u=r.attributes.skinWeight;delete r.attributes.skinIndex,delete r.attributes.skinWeight;const c=l.buffer.array,h=u.buffer.array;if(void 0!==o&&void 0!==l&&void 0!==a){const e=o.buffer.array,t=o.buffer.count;for(let r=0;r<t;r++)MS.fromArray(e,3*r),NS.set(MS.x,MS.y,MS.z,1),NS.applyMatrix4(n),FS.fromArray(c,4*r),RS.fromArray(h,4*r),ES.fromArray(a,16*FS.x),wS.fromArray(a,16*FS.y),CS.fromArray(a,16*FS.z),TS.fromArray(a,16*FS.w),BS.set(0,0,0,0),IS.copy(MS),IS.applyMatrix4(ES),IS.multiplyScalar(RS.x),BS.add(IS),IS.copy(MS),IS.applyMatrix4(wS),IS.multiplyScalar(RS.y),BS.add(IS),IS.copy(MS),IS.applyMatrix4(CS),IS.multiplyScalar(RS.z),BS.add(IS),IS.copy(MS),IS.applyMatrix4(TS),IS.multiplyScalar(RS.w),BS.add(IS),BS.applyMatrix4(i),BS.multiplyScalar(1/BS.w),MS.set(BS.x,BS.y,BS.z),s&&MS.applyMatrix4(s),MS.toArray(e,3*r);o.buffer.version++}const d=r.attributes.a_Normal,p=e.attributes.a_Tangent,f=void 0===p?void 0:p.buffer.array;if(void 0!==d){const e=d.buffer.array,t=d.buffer.count;for(let r=0;r<t;r++){if(FS.fromArray(c,4*r),RS.fromArray(h,4*r),ES.fromArray(a,16*FS.x),wS.fromArray(a,16*FS.y),CS.fromArray(a,16*FS.z),TS.fromArray(a,16*FS.w),QS.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),OS(ES,RS.x),kS(QS,ES),OS(wS,RS.y),kS(QS,wS),OS(CS,RS.z),kS(QS,CS),OS(TS,RS.w),kS(QS,TS),QS.multiply(n),QS.premultiply(i),MS.fromArray(e,3*r),NS.set(MS.x,MS.y,MS.z,0),NS.applyMatrix4(QS),MS.set(NS.x,NS.y,NS.z),void 0!==f&&(PS.fromArray(f,3*r),NS.set(PS.x,PS.y,PS.z,0),NS.applyMatrix4(QS),PS.set(NS.x,NS.y,NS.z)),s){const e=DS.setFromMatrix4(s).inverse().transpose();MS.applyMatrix3(e).normalize(),void 0!==f&&PS.transformDirection(s)}void 0!==f&&PS.toArray(f,3*r),MS.toArray(e,3*r)}d.buffer.version++,void 0!==f&&p.buffer.version++}return r.computeBoundingBox(),r.computeBoundingSphere(),this._weakCache.set(e,r),r}getEdgeGeometryFromSkinned(e,t={}){if(!e)return null;let r=this._weakCache2.get(e);if(r)return r;if(!t.bindMatrix||!t.bindMatrixInverse||!t.boneMatrices)return null;r=e.clone();const n=t.bindMatrix,i=t.bindMatrixInverse,a=t.boneMatrices,s=t.offsetMatrix,o=r.attributes.a_Position,l=r.attributes.skinIndex,u=r.attributes.skinWeight;delete r.attributes.skinIndex,delete r.attributes.skinWeight;const c=l.buffer.array,h=u.buffer.array;if(void 0!==o&&void 0!==l&&void 0!==a){const e=o.buffer.array,t=o.buffer.count;for(var d=0;d<t;d++)MS.fromArray(e,3*d),NS.set(MS.x,MS.y,MS.z,1),NS.applyMatrix4(n),FS.fromArray(c,4*d),RS.fromArray(h,4*d),ES.fromArray(a,16*FS.x),wS.fromArray(a,16*FS.y),CS.fromArray(a,16*FS.z),TS.fromArray(a,16*FS.w),BS.set(0,0,0,0),IS.copy(MS),IS.applyMatrix4(ES),IS.multiplyScalar(RS.x),BS.add(IS),IS.copy(MS),IS.applyMatrix4(wS),IS.multiplyScalar(RS.y),BS.add(IS),IS.copy(MS),IS.applyMatrix4(CS),IS.multiplyScalar(RS.z),BS.add(IS),IS.copy(MS),IS.applyMatrix4(TS),IS.multiplyScalar(RS.w),BS.add(IS),BS.applyMatrix4(i),BS.multiplyScalar(1/BS.w),MS.set(BS.x,BS.y,BS.z),s&&MS.applyMatrix4(s),MS.toArray(e,3*d);o.buffer.version++}return r.computeBoundingBox(),r.computeBoundingSphere(),this._weakCache2.set(e,r),r}getGeometry(e,t={}){if(!e)return null;let r=this._weakCache3.get(e);if(r)return r;r=e.geometry.clone();const n=t.offsetMatrix;return n&&!n.isIdentity()&&Gb.applyMatrix4(r,n,!0),this._weakCache3.set(e,r),r}generateUv3(){if(!this._data)return;if(this._data.hasUv3)return;const e=this._data.node;e.traverse((t=>{t.geometry&&KS(t,e)})),this._data.hasUv3=!0}$getInfo(){if(!this._modelInfo.vertices){let e=0,t=0;O_(this._data.node,(r=>{if(r.isMesh||r.isSprite||r.isLine||r.isPoints)if(r.geometry.index){let n=r.geometry.index.buffer.array.length;e+=n,t+=n/3}else{let n=r.geometry.getAttribute("a_Position").buffer.count;e+=n,t+=n/3}})),this._modelInfo.vertices=e,this._modelInfo.triangles=t}return this._modelInfo}dispose(){this._data&&VS(this._data.node,this),this._prefabs.forEach((e=>VS(e.node))),this._prefabs.clear(),this._modelInfo={}}}],[rE,class extends fS{constructor(e){super(e),this._textures=new Map,this._callBackArr=[],this._errorBackArr=[]}load(){return this._state=dS,this._promise=new Promise(((e,t)=>{const r=new Bp,n=this._url.search(/\.(tga)$/)>0||0===this._url.search(/^data\:image\/tga/),i=this;(n?new YS:new yh).load(i._url,(function(t){r.format=zc.RGBA,r.image=t,r.version++,i._state=pS,i._promise=null,i._data=r,r.dispatchEvent({type:"onload"}),e(i)}),void 0,(e=>{i._state=hS,i._promise=null,i._data=null,t(i)}))})),this._promise}getTexture(e){if(!this._data)return null;const t=void 0!==e.wrap?e.wrap:Gc.CLAMP_TO_EDGE,r=void 0!==e.anisotropy?e.anisotropy:1,n=t+"_"+r;if(!this._textures.has(n)){const e=this._data.clone();e.wrapS=e.wrapT=t,e.anisotropy=r,e.version++,this._textures.set(n,e)}return this._textures.get(n)}}],[nE,class extends fS{constructor(e){super(e),this._callBackArr=[],this._errorBackArr=[]}load(){return this._state=dS,this._promise=new Promise(((e,t)=>{ZS.load(this._url,(t=>{this._state=pS,this._promise=null,this._data=t,e(this)}),void 0,(()=>{this._state=hS,this._promise=null,this._data=null,t(this)}))})),this._promise}}],[iE,class extends fS{constructor(e){super(e),this._callBackArr=[],this._errorBackArr=[]}load(){return this._state=dS,this._promise=new Promise(((e,t)=>{const r=this._url.search(/\.(dds)$/)>0||0===this._url.search(/^data\:image\/dds/),n=this._url.search(/\.(pvr)$/)>0;(r?new JS:n?new $S:new yh).load(this._url,(t=>{this._state=pS,this._promise=null,this._data=t,e(this)}),void 0,(e=>{this._state=hS,this._promise=null,this._data=null,t(this)}))})),this._promise}getCompressedTexture(e){}}]]),sE=new Map,oE=(e,t,r,n)=>{let i;sE.has(e)?i=sE.get(e):(i={refCount:0,res:new(aE.get(t))(e)},sE.set(e,i));let a,s=i.res;return s.state===hS&&(a=s.load(),a.then((e=>{e._callBackArr.forEach((t=>{t(e)})),e._callBackArr=[],e._errorBackArr=[]})).catch((e=>{s._errorBackArr.forEach((t=>{t&&t(e)})),s._callBackArr=[],s._errorBackArr=[]}))),s.state===dS&&(n&&s._callBackArr.push(n),r&&s._errorBackArr.push(r)),s.state===pS&&n&&n(s),n||a?a:Promise.resolve(s)},lE=e=>{sE.get(e)&&sE.get(e).refCount++},uE=e=>{let t=sE.get(e);t&&(t.refCount--,t.refCount<=0&&(console.info("release resource :"+e),sE.delete(e),t.res.dispose()))},cE=new Sc,hE=new Sc,dE=["a_Position","a_Normal","a_Uv","a_Uv2","a_Uv3","a_Color"],pE=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fE=(e,t,r=0,n=0)=>{e[r+0]=t[n+0],e[r+1]=t[n+4],e[r+2]=t[n+8],e[r+3]=t[n+12],e[r+4]=t[n+1],e[r+5]=t[n+5],e[r+6]=t[n+9],e[r+7]=t[n+13],e[r+8]=t[n+2],e[r+9]=t[n+6],e[r+10]=t[n+10],e[r+11]=t[n+14],e[r+12]=t[n+3],e[r+13]=t[n+7],e[r+14]=t[n+11],e[r+15]=t[n+15]};class mE{constructor(){this._instancedMaxCount=0,this._instancedCount=0,this._group=new od,this._instanceMatrix=null,this._instancedIds=null,this._defaultPickId=0,this._matrices=new Float32Array,this._pickIds=new Float32Array,this._matricesDirty=!0,this._pickIdsDirty=!0,this._autoUpdate=!0,this._cachedMeshes=[]}setMaxCount(e){if(this._instancedMaxCount===e)return;this._instancedMaxCount=e;const t=this._matrices,r=this._pickIds,n=new Float32Array(16*e),i=new Float32Array(e);for(let e=0,r=n.length,i=t.length;e<r;e+=16)if(e<i)for(let r=0;r<16;r++)n[e+r]=t[e+r];else fE(n,pE,e,0);for(let e=0,t=i.length,n=r.length;e<t;e++)i[e]=e<n?r[e]:this._defaultPickId;this._matrices=n,this._pickIds=i,this._autoUpdate&&this._updateAttributes()}getMaxCount(){return this._instancedMaxCount}setCount(e){this._instancedCount=e,this._group.children.forEach((t=>{t.geometry.instanceCount=e}))}getCount(){return this._instancedCount}setMatrices(e){const t=this._matrices;for(let r=0;r<t.length;r+=16)fE(t,e,r,r);this._matricesDirty=!0,this._autoUpdate&&this._updateAttributes()}getMatrices(e){e.length=0;const t=this._matrices;for(let r=0;r<t.length;r+=16)fE(e,t,r,r);return e}setPickedIds(e){const t=this._pickIds;for(let r=0;r<t.length;r++)t[r]=e[r];this._pickIdsDirty=!0,this._autoUpdate&&this._updateAttributes()}getPickedIds(e){e.length=0;const t=this._pickIds;for(let r=0;r<t.length;r++)e[r]=t[r];return e}begin(){this._autoUpdate=!1}end(){this._updateAttributes(),this._autoUpdate=!0}dispose(){}$onAdd(e){let t;this._unode=e,e.$hasComponent(zx)&&(t=e.$getComponent(zx),e.$removeComponent(zx)),this._group.renderOrder=e.getRenderOrder(),e.$node.add(this._group);const r=e.$uScene.$pickNodeCache;this._defaultPickId=this._group.id,e.$getRenderableList().forEach((t=>{if(t.isMesh){e.$node!==t?t.visible=!1:t.renderable=!1,this._cachedMeshes.push(t);const r=this._generateInstancedMesh(t,e);this._group.add(r)}})),r.map.set(this._defaultPickId,{object:null,uNode:this._unode}),this._updateAttributes(),e.$renderableListDirty(),t&&e.setStyle(t)}$onRemove(){const e=this._unode.$uScene.$pickNodeCache;this._unode.$node.remove(this._group);const t=this._unode.$node;if(this._unode=null,this._cachedMeshes.forEach((e=>{t!==e?e.visible=!0:e.renderable=!0})),this._cachedMeshes.length=0,this._instanceMatrix=null,this._instancedIds=null,this._pickIds.length>0)for(let t=0;t<this._pickIds.length;t++)e.map.delete(this._pickIds[t]);e.map.delete(this._defaultPickId),this._matrices=new Float32Array,this._pickIds=new Float32Array;this._group.children.slice(0).forEach((e=>{e.material.isMatArray?e.material.forEach((e=>e.dispose())):e.material.dispose(),e.geometry.dispose(),this._group.remove(e)}))}_generateInstancedMesh(e,t){let r;Array.isArray(e.material)?(r=e.material.map((e=>{const t=e.clone();return t.needsUpdate=!0,t})),r.isMatArray=!0):(r=e.material.clone(),r.needsUpdate=!0);let n=null,i=null;const a=N_(e,t.$node,cE),s=e.isSkinnedMesh,o=t._res;if(s){const r=e.bindMatrix,i=e.bindMatrixInverse,s=t.$uScene._root.$node.anchorMatrix,l=!s.isIdentity(),u=hE.getInverse(s);e.skeleton.updateBones({useAnchorMatrix:l,anchorMatrixInverse:u});const c=e.skeleton.boneMatrices;n=o.getGeometryFromSkinned(e.geometry,{bindMatrix:r,bindMatrixInverse:i,boneMatrices:c,offsetMatrix:a})}else o?n=o.getGeometry(e,{offsetMatrix:a}):(n=e.geometry.clone(),a.isIdentity()||Gb.applyMatrix4(n,a,!0));if(o){i=new _p;for(let e=0,t=dE.length;e<t;e++){const t=dE[e];n.attributes[t]&&(i.attributes[t]=n.attributes[t])}i.index=n.index,i.groups=n.groups,i.boundingBox.copy(n.boundingBox),i.boundingSphere.copy(n.boundingSphere)}else i=n;const l=((e,t,r)=>{(e=>{const t=r=>{r.target.removeEventListener("set-uv3",t);const n=r.uv3.clone();n.divisor=1,e.addAttribute("a_Uv3",n)};e.addEventListener("set-uv3",t);const r=n=>{n.target.removeEventListener("dispose",r),e.removeEventListener("set-uv3",t)};e.addEventListener("dispose",r)})(e);const n=new up(new cp(new Float32Array(r),1),1);n.divisor=1;const i=new up(new cp(new Float32Array(16*r),16),16);i.divisor=1;const a=new up(new cp(new Float32Array(r).fill(1),1),1);a.divisor=1,e.addAttribute("instanceID",n),e.addAttribute("instanceMatrix",i),e.addAttribute("instanceStates",a),e.instanceCount=r,t.isMatArray?t.forEach((e=>e.defines.USE_INSTANCING=!0)):t.defines.USE_INSTANCING=!0;const s=new ap(e,t);return s.isInstancedMesh=!0,s})(i,r,0);return l.frustumCulled=!1,l.renderOrder=this._unode.getRenderOrder(),l.castShadow=this._unode.getCastShadow(),l.receiveShadow=this._unode.getReceiveShadow(),l}_updateAttributes(){let e=!1;this._instanceMatrix&&this._matrices.length===this._instanceMatrix.buffer.array.length?this._matricesDirty&&(this._instanceMatrix.buffer.array.set(this._matrices),this._instanceMatrix.buffer.version++):(this._instanceMatrix=new up(new cp(this._matrices,16)),this._instanceMatrix.divisor=1,e=!0),this._instancedColors&&this._instancedIds.buffer.array.length===this._instancedCount||(this._instancedColors=new up(new cp(new Float32Array(3*this._instancedCount).fill(1),3),3),this._instancedColors.divisor=1,e=!0),this._instancedStates&&this._instancedIds.buffer.array.length===this._instancedCount||(this._instancedStates=new up(new cp(new Float32Array(this._instancedCount).fill(1),1),1),this._instancedStates.divisor=1,e=!0);const t=this._unode.$uScene.$pickNodeCache,r=this._instancedIds;if(r)for(let e=0;e<r.buffer.array.length;e++)t.map.delete(r.buffer.array[e]);this._instancedIds&&this._pickIds.length===this._instancedIds.buffer.array.length?this._pickIdsDirty&&this._instancedIds.buffer.array.set(this._pickIds):(this._instancedIds=new up(new cp(this._pickIds,1)),this._instancedIds.divisor=1,e=!0);for(let e=0;e<this._instancedIds.buffer.array.length;e++)t.map.set(this._instancedIds.buffer.array[e],{object:null,uNode:this._unode});const n=this._unode.$getComponent(zx);this._group.children.forEach((t=>{e&&(t.geometry.dispose(),t.geometry.addAttribute("instanceMatrix",this._instanceMatrix),t.geometry.addAttribute("instanceID",this._instancedIds),t.geometry.addAttribute("instanceStates",this._instancedStates),t.geometry.version++),t.geometry.instanceCount=this._instancedCount;const r=t.children[0];n&&r&&r.isEdge&&n._edges.$updateEdgesAttribute(r,t)}))}}const gE=(new Mc).setFromEuler(new Dh(Math.PI/2,0,0)).toMatrix4(),_E=new Map,vE=new Map,yE=new E_;yE.diffuse.setHex(16777215);const xE=e=>{_E.get(e)&&_E.get(e).geoCount++},bE=(e,t)=>{let r=((e,t)=>{let r,n,i;"Sphere"===e?(r=t.widthSegments||16,n=t.heightSegments||12):(r=t.widthSegments||1,n=t.heightSegments||1);const a=((e,t,r)=>("Box"!==e&&"Sphere"!==e&&"Plane"!==e&&(e="Box"),e+"_"+t+"_"+r))(e,r,n);if(_E.has(a))i=_E.get(a);else{switch(e){case"Box":default:i={geoCount:0,geoRes:{geo:new cm(1,1,1,r,n),cacheKey:a}};break;case"Sphere":i={geoCount:0,geoRes:{geo:new dm(.5,r,n),cacheKey:a}};break;case"Plane":i={geoCount:0,geoRes:{geo:new vp(1,1,r,n),cacheKey:a}},Gb.applyMatrix4(i.geoRes.geo,gE,!0)}_E.set(a,i)}return i.geoRes})(e,t);return r};class AE{constructor(e,t=[]){this.bones=e,this.iks=t,this.target=new bc,this._valid()}update(){const e=this.iks;for(let t=0,r=e.length;t<r;t++)this.updateOne(e[t]);return this}updateOne(e){const t=this.bones,r=Math,n=t[e.effector],i=e.links;for(let a=0;a<9;a++){let a=!1;for(let s=0,o=i.length;s<o;s++){const o=t[i[s].index];if(!1===i[s].enabled)break;const l=i[s].limitation,u=i[s].rotationMin,c=i[s].rotationMax;o.worldMatrix.decompose(TE,DE,ME),DE.conjugate(),wE.setFromMatrixPosition(n.worldMatrix),CE.subVectors(wE,TE),CE.applyQuaternion(DE),CE.normalize(),EE.subVectors(this.target,TE),EE.applyQuaternion(DE),EE.normalize();let h=EE.dot(CE);if(h>1?h=1:h<-1&&(h=-1),h=r.acos(h),!(h<1e-5)){if(void 0!==e.minAngle&&h<e.minAngle&&(h=e.minAngle),void 0!==e.maxAngle&&h>e.maxAngle&&(h=e.maxAngle),PE.crossVectors(CE,EE),PE.normalize(),SE.setFromAxisAngle(PE,h),o.quaternion.multiply(SE),void 0!==l){let e=o.quaternion.w;e>1&&(e=1);const t=r.sqrt(1-e*e);o.quaternion.set(l.x*t,l.y*t,l.z*t,e)}void 0!==u&&(FE.set(o.euler.x,o.euler.y,o.euler.z).max(u),o.euler.set(FE.x,FE.y,FE.z),o.matrixNeedsUpdate=!0),void 0!==c&&(FE.set(o.euler.x,o.euler.y,o.euler.z).min(c),o.euler.set(FE.x,FE.y,FE.z),o.matrixNeedsUpdate=!0),o.updateMatrix(!0),a=!0}}if(!a)break}return this}_valid(){const e=this.bones,t=this.iks;for(let r=0,n=t.length;r<n;r++){const n=t[r],i=e[n.effector],a=n.links;let s,o;s=i;for(let t=0,r=a.length;t<r;t++)o=e[a[t].index],s.parent!==o&&console.warn("CCDIKSolver: bone "+s.name+" is not the child of bone "+o.name),s=o}}dispose(){this.bones=null,this.iks=null,this.target=null}}const SE=new Mc,EE=new bc,wE=new bc,CE=new bc,TE=new bc,DE=new Mc,ME=new bc,PE=new bc,FE=new bc,RE=new bc;class NE{constructor(e){this._uNode=null,this._solver=null,this._config=e}$onAdd(e){let t;this._uNode=e,e._node.traverse((e=>{e.skeleton&&(t=e.skeleton.bones)})),t&&this._config&&(this._solver=new AE(t,this._config)),this._uNode.$uScene.$transformCache.addResident(this._uNode)}$onRemove(e){this._uNode.$uScene.$transformCache.removeResident(this._uNode),this._uNode=null}init(){this._uNode.$uScene.$ikSolvers.add(this)}setTarget(e){RE.fromArray(e),this._solver.target.copy(RE)}$update(){this._solver&&this._solver.update()}dispose(){const e=this._unode.$uScene.$ikSolvers;e.has(this)&&e.delete(this),this._solver.dispose(),this._solver=null,this._config=null}}const BE=new Sh,IE=new Dg,OE=new Sc,kE=new Sc,LE=new Mc,UE=new Zb,zE=new Mc,jE=new bc,VE=new Mc,GE=new bc,WE=new bc,HE=(e,t,r,n)=>{if(e.isEdge||e.raycast(t.ray,r),!0===n){const n=e.children;for(let e=0,i=n.length;e<i;e++)n[e].visible&&HE(n[e],t,r,!0)}},qE=new cm,XE=new T_;class QE extends mb{constructor(e,t=new od){super(e),this._node=t,this.$initNode(this._node),this._matrixAutoUpdate=!0,this.$pickable=!0,this.$skipParentStyleChange=!1,this._ignoreOriginEffects=!1,this._res=null,this._geoRes=null,this._renderableList=null}get isRenderableNode(){return!0}getType(){return"Node"}setAttribute(e,t){super.setAttribute(e,t),"Pickable"===e?this.$pickable!==t&&(this.$pickable=t,this._node.userData.$pickable=t,this.$isContainer?this._children.forEach((r=>{r.isRenderableNode&&r.setAttribute(e,t)})):this._node.traverse((e=>{e.userData.$pickable=t})),this.dispatchEvent({type:"pickable-changed",value:t})):"Instancing"===e?!t&&this.hasInstancing()&&this.$removeComponent(Wx):"SkipParentStyleChange"===e&&(this.$skipParentStyleChange=t)}getAttribute(e){let t=super.getAttribute(e);if("AnimationPlayer"===e){if(this.$hasComponent(Vx))return this.$getComponent(Vx);if(this.hasAnimation()){const e=new eS(this._res.data.animations);return this.$addComponent(Vx,e),e}}else{if("Pickable"===e)return this.$pickable;if("Instancing"===e){if(this.$hasComponent(Wx))return this.$getComponent(Wx);{const e=new mE;return this.$addComponent(Wx,e),e}}if("SkipParentStyleChange"===e)return this.$skipParentStyleChange;if("IKSolver"===e){if(this.$hasComponent(Xx))return this.$getComponent(Xx);{const e=new NE;return this.$addComponent(Xx,e),e.init(),e}}}return t}hasAnimation(){return this._res&&this._res.data.animations&&this._res.data.animations.length>0}hasInstancing(){return this.$hasComponent(Wx)}getAABB(e,t,r,n){return this.$boundingBox.getAABB(BE,t,r,n),IE.fromBox3(BE),IE.center.toArray(e.center),IE.halfSize.toArray(e.halfSize),e}getOBB(e,t,r,n){this.$boundingBox.getOBB(IE,t,r,n),IE.center.toArray(e.center),IE.halfSize.toArray(e.halfSize);for(let t=0;t<e.halfSize.length;t++)e.halfSize[t]=Math.abs(e.halfSize[t]);return LE.setFromRotationMatrix3(IE.rotation),LE.toArray(e.rotation),e}getLocalBoundingBox(e){const t=this.$boundingBox;return IE.fromBox3(t.selfBoundingBox),IE.center.toArray(e.center),IE.halfSize.toArray(e.halfSize),e}setLocalBoundingBox(e){const t=this.$boundingBox;t.selfBoundingBoxLock=!0,IE.center.fromArray(e.center),IE.halfSize.fromArray(e.halfSize);const r=t.selfBoundingBox;r.min.copy(IE.center).sub(IE.halfSize),r.max.copy(IE.center).add(IE.halfSize)}clearLocalBoundingBox(){const e=this.$boundingBox;e.selfBoundingBoxLock=!1,e.selfBoundingBoxNeedsUpdate=!0}setStyle(e){this.$hasComponent(zx)&&this.$removeComponent(zx),null!==e&&this.$addComponent(zx,e),this._children.forEach((t=>{t.isRenderableNode&&!t.$skipParentStyleChange&&t.setStyle(e)}))}getStyle(){return this.$hasComponent(zx)||this.$addComponent(zx,new XA),this.$getComponent(zx)}hasStyle(){return this.$hasComponent(zx)}dispose(){this.$hasComponent(zx)&&this.$removeComponent(zx),this.$hasComponent(jx)&&(this.$getComponent(jx).dispose(),this.$removeComponent(jx)),this.$hasComponent(Vx)&&(this.$getComponent(Vx).dispose(),this.$removeComponent(Vx)),this.$hasComponent(Gx)&&(this.$getComponent(Gx).dispose(),this.$removeComponent(Gx)),this.$hasComponent(Hx)&&(this.$getComponent(Hx).dispose(),this.$removeComponent(Hx)),this.$hasComponent(Wx)&&(this.$getComponent(Wx).dispose(),this.$removeComponent(Wx)),super.dispose(),this._res&&(uE(this._res.url),this._res=null),this._geoRes&&((e=>{let t=_E.get(e);t&&(t.geoCount--,t.geoCount<=0&&(console.info("dispose geoRes :"+e),_E.delete(e),t.geoRes.geo.dispose()))})(this._geoRes.cacheKey),this._geoRes=null)}setRenderOrder(e){this._node.renderOrder=e,this.$isContainer?this._children.forEach((t=>{t.isRenderableNode&&t.setRenderOrder(e)})):this._node.traverse((t=>{t.isEdge?t.renderOrder=e+1e-5:t.renderOrder=e}))}getRenderOrder(){return this._node.renderOrder}setCastShadow(e){this._node.castShadow=e,this.$isContainer?this._children.forEach((t=>{t.isRenderableNode&&t.setCastShadow(e)})):O_(this._node,(t=>{t.castShadow=e}))}getCastShadow(){return this._node.castShadow}setReceiveShadow(e){this._node.receiveShadow=e,this.$isContainer?this._children.forEach((t=>{t.isRenderableNode&&t.setReceiveShadow(e)})):O_(this._node,(t=>{t.receiveShadow=e}))}getReceiveShadow(){return this._node.receiveShadow}setRenderTag(e,t){if(this.$isContainer){const r=this._children;for(let n=0,i=r.length;n<i;n++){r[n].setRenderTag(e,t)}}else{const r=this.$getRenderableList();for(let n=0,i=r.length;n<i;n++){r[n].userData[e]=t}}}getRenderTag(e){if(this.$isContainer){const t=this._children;let r;for(let n=0,i=t.length;n<i;n++){if(r=t[n].getRenderTag(e),r)break}return r}return this.$getRenderableList()[0]?.userData[e]}deleteRenderTag(e){if(this.$isContainer){const t=this._children;for(let r=0,n=t.length;r<n;r++){t[r].deleteRenderTag(e)}}else{const t=this.$getRenderableList();for(let r=0,n=t.length;r<n;r++){const n=t[r];void 0!==n.userData[e]&&delete n.userData[e]}}}setRenderLayer(e=0){const t=this._node;if(!t)return;const r=2==e?1:1==e?8:0==e?0:e;t.traverse((e=>{e.renderLayer=r}))}getRenderLayer(){const e=this._node;if(!e)return;return 0==e.renderLayer?0:8==e.renderLayer?1:1==e.renderLayer?2:layer}getSubNodes(e,t=this){return this.$isContainer?this._children.forEach((r=>r.getSubNodes(e,t))):O_(this._node,((r,n)=>{r.name&&e.push({_parent:this,_id:r.id,depth:n,root:t,name:r.name,matrix:t?N_(r,t._node,OE).toArray([]):null,isLeaf:0===r.children.length,isRenderable:r.isMesh||r.isSprite||r.isLine||r.isPoints})}),0),e}getSubNodeNumber(e){const t=e.filter;let r=0;return this.$isContainer?this._children.forEach((t=>{r+=t.getSubNodeNumber(e)})):O_(this._node,(e=>{t({root:null,matrix:null,name:e.name,isLeaf:0===e.children.length,isRenderable:e.isMesh||e.isSprite||e.isLine||e.isPoints})&&r++})),r}attachSubNode(e){const t=e._parent,r=t._node.getObjectByName(e.name);if(!r)return void console.error("Can not extract node name <"+e.name+">");const n=new QE(this._uScene,r);let i;return n.setRenderOrder(t.getRenderOrder()),n._matrixAutoUpdate=t._matrixAutoUpdate,t.$hasComponent(zx)&&(i=t.$getComponent(zx),t.$removeComponent(zx)),t.$hasComponent(jx)&&(t.$getComponent(jx).selfBoundingBoxNeedsUpdate=!0),t.$renderableListDirty(),t._res&&(lE(t._res.url),n._res=t._res),this.attach(n),i&&(i.isEnabled("InstancedDrawing")&&(i=i.clone(),i.enable("InstancedDrawing",!1)),t.setStyle(i),n.setStyle(i)),n}setSubNodeMatrix(e,t){const r=e._parent,n=r._node.getObjectByProperty("id",e._id);OE.fromArray(t),OE.toArray(e.matrix),((e,t,r)=>{let n=e.parent;for(B_.identity();n!==t&&null!==n;)(n.matrixAutoUpdate||n.matrixNeedsUpdate)&&(n.matrix.transform(n.position,n.scale,n.quaternion),n.matrixNeedsUpdate=!1,n.worldMatrixNeedsUpdate=!0),B_.premultiply(n.matrix),n=n.parent;I_.getInverse(B_),r.premultiply(I_)})(n,e.root._node,OE),n.matrix.copy(OE),n.matrix.decompose(n.position,n.quaternion,n.scale),r._node.worldMatrixNeedsUpdate=!0,r._uScene.$transformCache.markDirty(r),r._uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}getVerticesInfo(){const e=[],t=[],r=this._node,n=this.$getRenderableList();for(let i=0;i<n.length;i++){const a=n[i],s=Array.isArray(a.material)?a.material[0]:a.material;if(!(!!s&&s.drawMode===Kc.TRIANGLES))continue;const o=N_(a,r,kE),l=e.length/3,u=a.geometry.getAttribute("a_Position"),c=a.geometry.index;if(c){const e=c.buffer.array;for(let r=0;r<e.length;r++)t.push(e[r]+l)}else for(let e=0;e<u.buffer.count;e++)t.push(e+l);const h=u.buffer.array;for(let t=0;t<h.length;t+=3)WE.fromArray(h,t).applyMatrix4(o).toArray(e,e.length)}return{vertices:e,indexes:t}}copy(e,t=!0,r=!1){if(r?(this._visible=e._visible,this._internalVisible=e._internalVisible):super.copy(e),!this.$isContainer){let r=null;if(e.$hasComponent(Gx)&&e.$hasComponent(zx)&&t&&(r=e.$getComponent(zx),e.$removeComponent(zx)),e._res&&(lE(e._res.url),this._res=e._res,this._res.data.effectCounts&&!this._ignoreOriginEffects&&this.$uScene.$effectsManager.addCounts(this._res.data.effectCounts)),e._geoRes&&(xE(e._geoRes.cacheKey),this._geoRes=e._geoRes),e._components.has(Vx))if(t){const t=e._components.get(Vx),r=[],n=tS(e._node,t._clips,r);this._node.children.forEach((e=>this._node.remove(e))),n.children.forEach((e=>this._node.add(e)));const i=new eS(r);this.$addComponent(Vx,i),this.$renderableListDirty()}else{const t=e._components.get(Vx).clone();this.$addComponent(Vx,t)}else t&&(e._node.children.forEach((e=>this._node.add(e.clone(!0)))),this.$renderableListDirty());if(e._components.has(Gx)){const t=e._components.get(Gx).clone();this.$addComponent(Gx,t),t.play()}if(e._components.has(jx)){const t=e._components.get(jx);if(this._components.has(jx))this._components.get(jx).copy(t);else{const e=new cS;this.$addComponent(jx,e),e.copy(t)}}else this.$removeComponent(jx);if(r)e.$addComponent(zx,r),this.$addComponent(zx,r);else if(e.$hasComponent(zx)){const r=e.$getComponent(zx);this._components.set(zx,r),r.$addNode(this,t)}}return this._matrixAutoUpdate=e._matrixAutoUpdate,this._ignoreOriginEffects=e._ignoreOriginEffects,this}clone(){return new this.constructor(this._uScene,this._node.clone()).copy(this,!0,!0)}_setPickBoxTag(e){this._node._usePickBox=e,this.$isContainer?this._children.forEach((t=>{t.isRenderableNode&&t._setPickBoxTag(e)})):this._node.traverse((t=>{t._usePickBox=e}))}setPickBoundingBox(e){if(!e)return;const{halfSize:t,center:r}=e;if(t){this._node.worldMatrix.decompose(jE,VE,GE);const e=(new Sh).setFromArray([-.5,-.5,-.5,.5,.5,.5]);e.applyMatrix4(this._node.worldMatrix);const n=r?(new bc).fromArray(r):e.getCenter();this._pickBoxValue={halfSize:t,center:n.clone().toArray()},n.sub(jE);const i=new bc(2*t[0],2*t[1],2*t[2]);i.x*=1/GE.x,i.y*=1/GE.y,i.z*=1/GE.z,this._pickBoxMesh||(this._pickBoxMesh=new ap(qE,XE),this._pickBoxMesh.name="PickBoxMesh",this._pickBoxMesh._isPickBoxMesh=!0,this._pickBoxMesh.renderLayer=7,this._pickBoxMesh._linkUNode=this);const a=(new Sc).transform(n,i,zE);e.applyMatrix4(a),this._pickBoxMesh.scale=i,this._pickBoxMesh.position=n,this._pickBoxMesh.syncTransform=()=>{this._node&&(this._pickBoxMesh.worldMatrix.transform(this._pickBoxMesh.position,this._pickBoxMesh.scale,this._pickBoxMesh.quaternion),this._pickBoxMesh.worldMatrix.premultiply(this._node.worldMatrix),e.setFromArray([-.5,-.5,-.5,.5,.5,.5]),e.applyMatrix4(a),e.applyMatrix4(this._node.worldMatrix))},this._pickBoxMesh.updateMatrix=function(){},this._pickBox||(this._setPickBoxTag(!0),this._uScene._root.$addPickBoxNode(this._pickBoxMesh)),this._pickBox=e}}getPickBoundingBox(e){return e?(e.halfSize=this._pickBoxValue.halfSize,e.center=this._pickBoxValue.center,e):this._pickBoxValue}clearPickBoundingBox(){this._pickBox&&(this._setPickBoxTag(null),this._uScene._root.$removePickBoxNode(this._pickBoxMesh),this._uScene.$pickNodeCache.releasePickCache(this._pickBoxMesh),this._pickBoxMesh._linkUNode=null,this._pickBoxMesh.syncTransform=null,this._pickBoxMesh=null,this._pickBox=null,this._pickBoxValue=null)}raycast(e,t){if(this.getVisible()&&(!this.isRenderableNode||this.$pickable))if(this.isRenderableNode&&!this.$isContainer){UE.ray.origin.fromArray(e.origin),UE.ray.direction.fromArray(e.direction).normalize();const r=[];if(this.$raycast(UE,r),r.sort(k_),r[0]){const e={};e.node=r[0]._node,e.distance=r[0].distance,Object.defineProperty(e,"position",{get:()=>r[0].point.toArray([])}),t.push(e)}}else this._children.forEach((r=>r.raycast(e,t)))}get $isContainer(){return this._children.length>0}get $boundingBox(){return this.$hasComponent(jx)||this.$addComponent(jx,new cS),this.$getComponent(jx)}$markChildrenMatrixAutoUpdate(e){this._matrixAutoUpdate=e,this.$isContainer?this._children.forEach((t=>t.$markChildrenMatrixAutoUpdate(e))):this._node.children.forEach((t=>{t.traverse((t=>t.matrixAutoUpdate=e))}))}get $childrenMatrixAutoUpdate(){return this._matrixAutoUpdate}$raycast(e,t){const r=t.length;if(this._pickBox){if(e.ray.intersectBox(this._pickBox)){if(HE(this._pickBoxMesh,e,t,!0),t.length!==r)for(let e=t.length-1;e>=r;e--)t[e]._node=this;return}}if(this.$boundingBox.getAABB(BE,void 0,!1),e.ray.intersectsBox(BE)&&(HE(this._node,e,t,!0),t.length!==r))for(let e=t.length-1;e>=r;e--)t[e]._node=this}$getRenderableList(){return this._renderableList||(this._renderableList=[],this._node.traverse((e=>{e.isEdge||(e.isMesh||e.isSprite||e.isLine||e.isPoints)&&this._renderableList.push(e)}))),this._renderableList}$renderableListDirty(){this._renderableList=null}$initNode(e){e.$unode=this,e.castShadow=!0,e.receiveShadow=!0,e.matrixAutoUpdate=!1}}const KE=new E_,YE=new _p;YE.addAttribute("a_Position",new up(new cp(new Float32Array,3)));class ZE extends QE{constructor(e,t,r){const n=r?r.$getMaterial():KE,i=t?t.$getGeometry():YE,a=new ap(i,n);super(e,a),t&&t.$disposeArray?a.raycast=function(){}:delete a.raycast,a.castShadow=!0,a.receiveShadow=!0,this._mesh=a,this._materialResource=r,this._geometryResource=t,this.$markChildrenMatrixAutoUpdate(!1),this.$boundingBox.selfBoundingBoxNeedsUpdate=!0}getType(){return"CustomNode"}dispose(){const e=this._geometryResource;if(e&&e.$getGeometry()){const t=e.$getGeometry().getAttribute("ids");if(t){const e=t.buffer.array,r=this.$uScene.$pickNodeCache;for(let t=0,n=e.length;t<n;t++)r.map.delete(e[t])}}super.dispose(),this._geometryResource=null,this._materialResource=null,this._mesh.geometry=null,this._mesh.material=null,this._mesh=null}copy(e){return super.copy(e,!1,!1),this}clone(){return new this.constructor(this._uScene,this._geometryResource,this._materialResource).copy(this)}}const JE={name:"CUSTOM_SPRITE",defines:{USE_SIZEATTENUATION:!0},uniforms:{rotation:0,center:[.5,.5]},vertexShader:"\n\t\t#include <common_vert>\n\t\t#include <logdepthbuf_pars_vert>\n\n\t\tattribute vec2 position;\n\t\tattribute vec2 uv;\n\n\t\tuniform float rotation;\n\t\tuniform vec2 center;\n\n\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\tvarying vec2 v_Uv;\n\t\t\tuniform mat3 uvTransform;\n\t\t#endif\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\tv_Uv = (uvTransform * vec3(uv, 1.)).xy;\n\t\t\t#endif\n\n\t\t\tvec4 mvPosition = u_View * u_Model * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\tvec2 scale;\n\t\t\tscale.x = length(vec3(u_Model[0].x, u_Model[0].y, u_Model[0].z));\n\t\t\tscale.y = length(vec3(u_Model[1].x, u_Model[1].y, u_Model[1].z));\n\n\t\t\t#ifndef USE_SIZEATTENUATION\n\t\t\t\tbool isPerspective = isPerspectiveMatrix(u_Projection);\n\t\t\t\tif (isPerspective) scale *= - mvPosition.z;\n\t\t\t#endif\n\n\t\t\tvec2 alignedPosition = (position.xy - (center - vec2(0.5))) * scale;\n\n\t\t\tvec2 rotatedPosition;\n\t\t\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\t\t\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\t\t\tvec4 finalPosition;\n\n\t\t\tfinalPosition = u_View * u_Model * vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\tfinalPosition.xy += rotatedPosition;\n\t\t\tfinalPosition = u_Projection * finalPosition;\n\n\t\t\tgl_Position = finalPosition;\n\n\t\t\t#include <logdepthbuf_vert>\n\n\t\t}\n    ",fragmentShader:`\n        #ifdef USE_DIFFUSE_MAP\n\t\t   uniform sampler2D diffuseMap;\n\t\t   varying vec2 v_Uv;\n\t\t#endif\n\n\t\tuniform vec3 u_Color;\n\t\tuniform float u_Opacity;\n\n\t\t#include <fog_pars_frag>\n\t\t#include <logdepthbuf_pars_frag>\n\n\t\tvoid main() {\n\n            ${Jm}\n\n\t\t\t#include <logdepthbuf_frag>\n\n\t\t\tvec4 outColor = vec4(u_Color, u_Opacity);\n\n\t\t\t#ifdef USE_DIFFUSE_MAP\n\t\t\t\toutColor *= texture2D( diffuseMap, v_Uv );\n\t\t\t#endif\n\n\t\t\t#ifdef ALPHATEST\n\t\t\t\tif ( outColor.a < ALPHATEST ) discard;\n\t\t\t#endif\n\n\t\t\tgl_FragColor = outColor;\n\n\t\t\t#include <fog_frag>\n\n\t\t}\n    `};class $E extends bp{constructor(){super(JE)}}$E.prototype.useDefaultBufferMaterial=!0;const ew=function(){var e=new _p,t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),r=new cp(t,4);return e.addAttribute("position",new up(r,2,0)),e.addAttribute("uv",new up(r,2,2)),e.setIndex(new up(new cp(new Uint16Array([0,1,2,0,2,3]),1))),e.computeBoundingBox(),e.computeBoundingSphere(),e}();class tw extends ap{constructor(){super(...arguments),this.geometry=ew,this.material=new $E,this.renderLayer=8}raycast(e,t){}}tw.prototype.isSprite=!0;class rw extends QE{constructor(e){const t=new tw;super(e,t),this._spriteNode=t,this._spriteNode.castShadow=!1,this._spriteNode.receiveShadow=!1,this.$markChildrenMatrixAutoUpdate(!1)}getType(){return"Sprite"}setAttribute(e,t){switch(e){case"Center":this._spriteNode.material.uniforms.center=t;break;case"Rotation":this._spriteNode.material.uniforms.rotation=t}super.setAttribute(e,t)}getAttribute(e){switch(e){case"Center":return this._spriteNode.material.uniforms.center;case"Rotation":return this._spriteNode.material.uniforms.rotation}return super.getAttribute(e)}dispose(){super.dispose(),this._spriteNode=null}copy(e){return super.copy(e,!1),this._spriteNode.material.uniforms.center=e._spriteNode.material.uniforms.center,this._spriteNode.material.uniforms.rotation=e._spriteNode.material.uniforms.rotation,this}}const nw={distributions:{BOX:1,SPHERE:2,DISC:3,LINE:4},valueOverLifetimeLength:4},iw={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,r){return typeof e===t?e:r},ensureArrayTypedArg:function(e,t,r){if(Array.isArray(e)){for(let n=e.length-1;n>=0;--n)if(typeof e[n]!==t)return r;return e}return this.ensureTypedArg(e,t,r)},ensureInstanceOf:function(e,t,r){return void 0!==t&&e instanceof t?e:r},ensureArrayInstanceOf:function(e,t,r){if(Array.isArray(e)){for(let n=e.length-1;n>=0;--n)if(void 0!==t&&e[n]instanceof t==!1)return r;return e}return this.ensureInstanceOf(e,t,r)},ensureValueOverLifetimeCompliance:function(e,t,r){t=t||3,r=r||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);let n=this.clamp(e._value.length,t,r),i=this.clamp(e._spread.length,t,r),a=Math.max(n,i);e._value.length!==a&&(e._value=this.interpolateArray(e._value,a)),e._spread.length!==a&&(e._spread=this.interpolateArray(e._spread,a))},interpolateArray:function(e,t){let r=e.length,n=["function"==typeof e[0].clone?e[0].clone():e[0]],i=(r-1)/(t-1);for(let r=1;r<t-1;++r){let t=r*i,a=Math.floor(t),s=Math.ceil(t),o=t-a;n[r]=this.lerpTypeAgnostic(e[a],e[s],o)}return n.push("function"==typeof e[r-1].clone?e[r-1].clone():e[r-1]),n},clamp:function(e,t,r){return Math.max(t,Math.min(e,r))},zeroToEpsilon:function(e,t){let r=1e-5,n=e;return n=t?Math.random()*r*10:r,e<0&&e>-1e-5&&(n=-n),n},lerpTypeAgnostic:function(e,t,r){let n,i=this.types;return typeof e===i.NUMBER&&typeof t===i.NUMBER?e+(t-e)*r:e instanceof xh&&t instanceof xh||typeof e.x==i.NUMBER&&typeof e.y==i.NUMBER&&null==e.z&&null==e.z&&typeof t.x==i.NUMBER&&typeof t.y==i.NUMBER&&null==t.z&&null==t.z?(e instanceof xh?n=(new xh).copy(e):(n={},n.x=e.x,n.y=e.y),n.x=this.lerp(e.x,t.x,r),n.y=this.lerp(e.y,t.y,r),n):e instanceof bc&&t instanceof bc||typeof e.x==i.NUMBER&&typeof e.y==i.NUMBER&&typeof e.z==i.NUMBER&&null==e.w&&null==e.w&&typeof t.x==i.NUMBER&&typeof t.y==i.NUMBER&&typeof t.z==i.NUMBER&&null==t.w&&null==t.w?(e instanceof bc?n=(new bc).copy(e):(n={},n.x=e.x,n.y=e.y,n.z=e.z),n.x=this.lerp(e.x,t.x,r),n.y=this.lerp(e.y,t.y,r),n.z=this.lerp(e.z,t.z,r),n):e instanceof Zh&&t instanceof Zh||typeof e.x==i.NUMBER&&typeof e.y==i.NUMBER&&typeof e.z==i.NUMBER&&typeof e.w==i.NUMBER&&typeof t.x==i.NUMBER&&typeof t.y==i.NUMBER&&typeof t.z==i.NUMBER&&typeof t.w==i.NUMBER?(e instanceof bc?n=(new Zh).copy(e):(n={},n.x=e.x,n.y=e.y,n.z=e.z,n.w=e.w),n.x=this.lerp(e.x,t.x,r),n.y=this.lerp(e.y,t.y,r),n.z=this.lerp(e.z,t.z,r),n.w=this.lerp(e.w,t.w,r),n):e instanceof Eh&&t instanceof Eh||typeof e.r==i.NUMBER&&typeof e.g==i.NUMBER&&typeof e.b==i.NUMBER&&typeof t.r==i.NUMBER&&typeof t.g==i.NUMBER&&typeof t.b==i.NUMBER?(e instanceof bc?n=(new Eh).copy(e):(n={},n.r=e.r,n.g=e.g,n.b=e.b),n.r=this.lerp(e.r,t.r,r),n.g=this.lerp(e.g,t.g,r),n.b=this.lerp(e.b,t.b,r),n):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,r){return e+(t-e)*r},roundToNearestMultiple:function(e,t){let r=0;return 0===t?e:(r=Math.abs(e)%t,0===r?e:e<0?-(Math.abs(e)-r):e+t-r)},arrayValuesAreEqual:function(e){for(let t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){return e+t*(Math.random()-.5)},getRandomVector3:function(e,t,r,n,i){let a=r.x+(Math.random()*n.x-.5*n.x),s=r.y+(Math.random()*n.y-.5*n.y),o=r.z+(Math.random()*n.z-.5*n.z);return i&&(a=.5*-i.x+this.roundToNearestMultiple(a,i.x),s=.5*-i.y+this.roundToNearestMultiple(s,i.y),o=.5*-i.z+this.roundToNearestMultiple(o,i.z)),e[t+0]=a,e[t+1]=s,e[t+2]=o,e},getRandomVector3OnSphere:function(e,t,r,n,i,a,s,o){let l=2*Math.random()-1,u=6.2832*Math.random(),c=Math.sqrt(1-l*l),h=this.randomFloat(n,i),d=0,p=0,f=0;return s&&(h=Math.round(h/s)*s),d=c*Math.cos(u)*h,p=c*Math.sin(u)*h,f=l*h,d*=a.x,p*=a.y,f*=a.z,d+=r.x,p+=r.y,f+=r.z,e[t+0]=d,e[t+1]=p,e[t+2]=f,e},getRandomVector3OnDisc:function(e,t,r,n,i,a,s){let o=6.2832*Math.random(),l=Math.abs(this.randomFloat(n,i)),u=0,c=0,h=0;return s&&(l=Math.round(l/s)*s),u=Math.cos(o)*l,c=Math.sin(o)*l,u*=a.x,c*=a.y,u+=r.x,c+=r.y,h+=r.z,e[t+0]=u,e[t+1]=c,e[t+2]=h,e},getRandomVector3OnLine:function(){const e=new bc;return function(t,r,n,i){return e.lerpVectors(n,i,Math.random()),e.toArray(t,r),t}}(),getRandomDirectionVector3OnSphere:function(){const e=new bc;return function(t,r,n,i,a,s,o,l){return e.copy(s),e.x-=n,e.y-=i,e.z-=a,e.normalize().multiplyScalar(-this.randomFloat(o,l)),e.toArray(t,r),t}}(),getRandomDirectionVector3OnDisc:function(){const e=new bc;return function(t,r,n,i,a,s,o,l){return e.copy(s),e.x-=n,e.y-=i,e.z-=a,e.normalize().multiplyScalar(-this.randomFloat(o,l)),e.toArray(t,r),t[r+2]=0,t}}(),getRotationAxis:function(){const e=new bc;return function(t,r,n){return t.copy(r).normalize(),e.copy(n).normalize(),t.x+=.5*-n.x+Math.random()*n.x,t.y+=.5*-n.y+Math.random()*n.y,t.z+=.5*-n.z+Math.random()*n.z,t.normalize(),t}}()};class aw{constructor(e,t,r,n){this.componentSize=r||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=n||0}setSize(e,t){let r=this.array.length;return t||(e*=this.componentSize),e<r?this.shrink(e):e>r?this.grow(e):void console.info("TypedArray is already of size:",e+".","Will not resize.")}shrink(e){return this.array=this.array.subarray(0,e),this.size=e,this}grow(e){let t=this.array,r=new this.TypedArrayConstructor(e);return r.set(t),this.array=r,this.size=e,this}splice(e,t){e*=this.componentSize,t*=this.componentSize;let r=[],n=this.array,i=n.length;for(let a=0;a<i;++a)(a<e||a>=t)&&r.push(n[a]);return this.setFromArray(0,r),this}setFromArray(e,t){let r=e+t.length;return r>this.array.length?this.grow(r):r<this.array.length&&this.shrink(r),this.array.set(t,this.indexOffset+e),this}setVec2(e,t){return this.setVec2Components(e,t.x,t.y)}setVec2Components(e,t,r){let n=this.array,i=this.indexOffset+e*this.componentSize;return n[i]=t,n[i+1]=r,this}setVec3(e,t){return this.setVec3Components(e,t.x,t.y,t.z)}setVec3Components(e,t,r,n){let i=this.array,a=this.indexOffset+e*this.componentSize;return i[a]=t,i[a+1]=r,i[a+2]=n,this}setVec4(e,t){return this.setVec4Components(e,t.x,t.y,t.z,t.w)}setVec4Components(e,t,r,n,i){let a=this.array,s=this.indexOffset+e*this.componentSize;return a[s]=t,a[s+1]=r,a[s+2]=n,a[s+3]=i,this}setMat3(e,t){return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)}setMat4(e,t){return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)}setColor(e,t){return this.setVec3Components(e,t.r,t.g,t.b)}setNumber(e,t){return this.array[this.indexOffset+e*this.componentSize]=t,this}getValueAtIndex(e){return this.array[this.indexOffset+e]}getComponentValueAtIndex(e){return this.array.subarray(this.indexOffset+e*this.componentSize)}}const sw={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16};class ow{constructor(e,t,r){let n=sw;this.type="string"==typeof e&&n.hasOwnProperty(e)?e:"f",this.componentSize=n[this.type],this.arrayType=r||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0}setUpdateRange(e,t){this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)}flagUpdate(){let e=this.bufferAttribute,t=e.buffer.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),e.buffer.version++}resetUpdateRange(){this.updateMin=0,this.updateMax=0}resetDynamic(){this.bufferAttribute.buffer.usage=this.dynamicBuffer?Jc.DYNAMIC_DRAW:Jc.STREAM_DRAW}splice(e,t){this.typedArray.splice(e,t),this.forceUpdateAll()}forceUpdateAll(){this.bufferAttribute.buffer.array=this.typedArray.array,this.bufferAttribute.buffer.updateRange.offset=0,this.bufferAttribute.buffer.updateRange.count=-1,this.bufferAttribute.buffer.usage=Jc.STATIC_DRAW,this.bufferAttribute.buffer.version++}_ensureTypedArray(e){null!==this.typedArray&&this.typedArray.size===e*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==e?this.typedArray.setSize(e):null===this.typedArray&&(this.typedArray=new aw(this.arrayType,e,this.componentSize)))}_createBufferAttribute(e){if(this._ensureTypedArray(e),null!==this.bufferAttribute)return this.bufferAttribute.buffer.array=this.typedArray.array,this.bufferAttribute.buffer.count=this.bufferAttribute.buffer.array.length/this.bufferAttribute.buffer.stride,void this.bufferAttribute.buffer.version++;this.bufferAttribute=new up(new cp(this.typedArray.array,this.componentSize)),this.bufferAttribute.usage=this.dynamicBuffer?Jc.DYNAMIC_DRAW:Jc.STATIC_DRAW}getLength(){return null===this.typedArray?0:this.typedArray.array.length}}var lw={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D tex;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;"].join("\n"),varyings:["varying vec4 vColor;","#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return u_View * u_Model * vec4( a_Position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","    #endif","","    vec4 rotatedTexture = texture2D( tex, vUv );"].join("\n")},uw={vertex:[lw.defines,lw.uniforms,lw.attributes,lw.varyings,of.common_vert,of.logdepthbuf_pars_vert,lw.branchAvoidanceFunctions,lw.unpackColor,lw.unpackRotationAxis,lw.floatOverLifetime,lw.colorOverLifetime,lw.paramFetchingFunctions,lw.forceFetchingFunctions,lw.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( a_Position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = u_View * u_Model * vec4( pos, 1.0 );","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    #ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    #endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = u_Projection * mvPosition;",of.logdepthbuf_vert,"}"].join("\n"),fragment:[lw.uniforms,of.common_frag,of.fog_pars_frag,of.logdepthbuf_pars_frag,lw.varyings,lw.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",lw.rotateTexture,of.logdepthbuf_frag,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",of.fog_frag,"}"].join("\n")};class cw{constructor(e){this.uuid=$h();const t=iw.types,r=nw.valueOverLifetimeLength;(e=iw.ensureTypedArg(e,t.OBJECT,{})).position=iw.ensureTypedArg(e.position,t.OBJECT,{}),e.velocity=iw.ensureTypedArg(e.velocity,t.OBJECT,{}),e.acceleration=iw.ensureTypedArg(e.acceleration,t.OBJECT,{}),e.radius=iw.ensureTypedArg(e.radius,t.OBJECT,{}),e.drag=iw.ensureTypedArg(e.drag,t.OBJECT,{}),e.rotation=iw.ensureTypedArg(e.rotation,t.OBJECT,{}),e.color=iw.ensureTypedArg(e.color,t.OBJECT,{}),e.opacity=iw.ensureTypedArg(e.opacity,t.OBJECT,{}),e.size=iw.ensureTypedArg(e.size,t.OBJECT,{}),e.angle=iw.ensureTypedArg(e.angle,t.OBJECT,{}),e.wiggle=iw.ensureTypedArg(e.wiggle,t.OBJECT,{}),e.maxAge=iw.ensureTypedArg(e.maxAge,t.OBJECT,{}),this.type=iw.ensureTypedArg(e.type,t.NUMBER,nw.distributions.BOX),this.position={_value:iw.ensureInstanceOf(e.position.value,bc,new bc),_spread:iw.ensureInstanceOf(e.position.spread,bc,new bc),_spreadClamp:iw.ensureInstanceOf(e.position.spreadClamp,bc,new bc),_distribution:iw.ensureTypedArg(e.position.distribution,t.NUMBER,this.type),_randomise:iw.ensureTypedArg(e.position.randomise,t.BOOLEAN,!1),_radius:iw.ensureTypedArg(e.position.radius,t.NUMBER,10),_radiusScale:iw.ensureInstanceOf(e.position.radiusScale,bc,new bc(1,1,1))},this.velocity={_value:iw.ensureInstanceOf(e.velocity.value,bc,new bc),_spread:iw.ensureInstanceOf(e.velocity.spread,bc,new bc),_distribution:iw.ensureTypedArg(e.velocity.distribution,t.NUMBER,this.type),_randomise:iw.ensureTypedArg(e.velocity.randomise,t.BOOLEAN,!1)},this.acceleration={_value:iw.ensureInstanceOf(e.acceleration.value,bc,new bc),_spread:iw.ensureInstanceOf(e.acceleration.spread,bc,new bc),_distribution:iw.ensureTypedArg(e.acceleration.distribution,t.NUMBER,this.type),_randomise:iw.ensureTypedArg(e.acceleration.randomise,t.BOOLEAN,!1)},this.drag={_value:iw.ensureTypedArg(e.drag.value,t.NUMBER,0),_spread:iw.ensureTypedArg(e.drag.spread,t.NUMBER,0),_randomise:iw.ensureTypedArg(e.drag.randomise,t.BOOLEAN,!1)},this.wiggle={_value:iw.ensureTypedArg(e.wiggle.value,t.NUMBER,0),_spread:iw.ensureTypedArg(e.wiggle.spread,t.NUMBER,0)},this.rotation={_axis:iw.ensureInstanceOf(e.rotation.axis,bc,new bc(0,1,0)),_axisSpread:iw.ensureInstanceOf(e.rotation.axisSpread,bc,new bc),_angle:iw.ensureTypedArg(e.rotation.angle,t.NUMBER,0),_angleSpread:iw.ensureTypedArg(e.rotation.angleSpread,t.NUMBER,0),_static:iw.ensureTypedArg(e.rotation.static,t.BOOLEAN,!1),_center:iw.ensureInstanceOf(e.rotation.center,bc,this.position._value.clone()),_randomise:iw.ensureTypedArg(e.rotation.randomise,t.BOOLEAN,!1)},this.maxAge={_value:iw.ensureTypedArg(e.maxAge.value,t.NUMBER,2),_spread:iw.ensureTypedArg(e.maxAge.spread,t.NUMBER,0)},this.color={_value:iw.ensureArrayInstanceOf(e.color.value,Eh,new Eh(1,1,1)),_spread:iw.ensureArrayInstanceOf(e.color.spread,bc,new bc),_randomise:iw.ensureTypedArg(e.color.randomise,t.BOOLEAN,!1)},this.opacity={_value:iw.ensureArrayTypedArg(e.opacity.value,t.NUMBER,1),_spread:iw.ensureArrayTypedArg(e.opacity.spread,t.NUMBER,0),_randomise:iw.ensureTypedArg(e.opacity.randomise,t.BOOLEAN,!1)},this.size={_value:iw.ensureArrayTypedArg(e.size.value,t.NUMBER,1),_spread:iw.ensureArrayTypedArg(e.size.spread,t.NUMBER,0),_randomise:iw.ensureTypedArg(e.size.randomise,t.BOOLEAN,!1)},this.angle={_value:iw.ensureArrayTypedArg(e.angle.value,t.NUMBER,0),_spread:iw.ensureArrayTypedArg(e.angle.spread,t.NUMBER,0),_randomise:iw.ensureTypedArg(e.angle.randomise,t.BOOLEAN,!1)},this.resetFlags={position:iw.ensureTypedArg(e.position.randomise,t.BOOLEAN,!1)||iw.ensureTypedArg(e.radius.randomise,t.BOOLEAN,!1),velocity:iw.ensureTypedArg(e.velocity.randomise,t.BOOLEAN,!1),acceleration:iw.ensureTypedArg(e.acceleration.randomise,t.BOOLEAN,!1)||iw.ensureTypedArg(e.drag.randomise,t.BOOLEAN,!1),rotation:iw.ensureTypedArg(e.rotation.randomise,t.BOOLEAN,!1),size:iw.ensureTypedArg(e.size.randomise,t.BOOLEAN,!1),color:iw.ensureTypedArg(e.color.randomise,t.BOOLEAN,!1),opacity:iw.ensureTypedArg(e.opacity.randomise,t.BOOLEAN,!1),angle:iw.ensureTypedArg(e.angle.randomise,t.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"};for(const e in this.updateMap)this.updateMap.hasOwnProperty(e)&&(this.updateCounts[this.updateMap[e]]=0,this.updateFlags[this.updateMap[e]]=!1,this._createGetterSetters(this[e],e));iw.ensureValueOverLifetimeCompliance(this.color,r,r),iw.ensureValueOverLifetimeCompliance(this.opacity,r,r),iw.ensureValueOverLifetimeCompliance(this.size,r,r),iw.ensureValueOverLifetimeCompliance(this.angle,r,r),this.particleCount=iw.ensureTypedArg(e.particleCount,t.NUMBER,100),this.duration=iw.ensureTypedArg(e.duration,t.NUMBER,null),this.isStatic=iw.ensureTypedArg(e.isStatic,t.BOOLEAN,!1),this.activeMultiplier=iw.ensureTypedArg(e.activeMultiplier,t.NUMBER,1),this.direction=iw.ensureTypedArg(e.direction,t.NUMBER,1),this.isLookAtCamera=iw.ensureTypedArg(e.isLookAtCamera,t.BOOLEAN,!1),this.isLookAtCameraOnlyY=iw.ensureTypedArg(e.isLookAtCameraOnlyY,t.BOOLEAN,!1),this.alive=iw.ensureTypedArg(e.alive,t.BOOLEAN,!0),this.particlesPerSecond=0,this.calculatePPSValue(),this.age=0,this.group=null}_createGetterSetters(e,t){const r=this;for(const n in e)if(e.hasOwnProperty(n)){const i=n.replace("_","");Object.defineProperty(e,i,{get:function(e){return function(){return this[e]}}(n),set:function(e){return function(n){const i=r.updateMap[t],a=this[e],s=nw.valueOverLifetimeLength;"_randomise"===e?r.resetFlags[i]=n:(r.updateFlags[i]=!0,r.updateCounts[i]=0),this[e]=n,r.group.$updateDefines(r),Array.isArray(a)&&iw.ensureValueOverLifetimeCompliance(r[t],s,s)}}(n)})}}calculatePPSValue(){const e=this.particleCount,t=this.maxAge._value+Math.abs(.5*this.maxAge._spread);return null!==this.duration?this.particlesPerSecond=e/Math.min(t,this.duration):this.particlesPerSecond=e/t,this}enable(){return this.alive=!0,this}disable(){return this.alive=!1,this}remove(){return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this}reset(e){}_assignValue(){}_assignPositionValue(e,t){const r=nw.distributions,n=this.position,i=n._value,a=n._spread;switch(n._distribution){case r.BOX:iw.getRandomVector3(e,t,i,a,n._spreadClamp);break;case r.SPHERE:iw.getRandomVector3OnSphere(e,t,i,n._radius,n._spread.x,n._radiusScale,n._spreadClamp.x,n._distributionClamp||this.particleCount);break;case r.DISC:iw.getRandomVector3OnDisc(e,t,i,n._radius,n._spread.x,n._radiusScale,n._spreadClamp.x);break;case r.LINE:iw.getRandomVector3OnLine(e,t,i,a)}return e}_assignForceValue(e,t,r,n){const i=nw.distributions,a=this[r],s=a._value,o=a._spread;switch(a._distribution){case i.BOX:iw.getRandomVector3(e,t,s,o);break;case i.SPHERE:iw.getRandomDirectionVector3OnSphere(e,t,n[0],n[1],n[2],this.position.value,s.x,o.x);break;case i.DISC:iw.getRandomDirectionVector3OnDisc(e,t,n[0],n[1],n[2],this.position.value,s.x,o.x);break;case i.LINE:iw.getRandomVector3OnLine(e,t,s,o)}if("acceleration"===r){const r=iw.clamp(iw.randomFloat(this.drag._value,this.drag._spread),0,1);e[t+3]=r}return e}_assignAbsLifetimeValue(e,t,r){const n=this[r];if(iw.arrayValuesAreEqual(n._value)&&iw.arrayValuesAreEqual(n._spread)){const r=Math.abs(iw.randomFloat(n._value[0],n._spread[0]));e[t+0]=r,e[t+1]=r,e[t+2]=r,e[t+3]=r}else e[t+0]=Math.abs(iw.randomFloat(n._value[0],n._spread[0])),e[t+1]=Math.abs(iw.randomFloat(n._value[1],n._spread[1])),e[t+2]=Math.abs(iw.randomFloat(n._value[2],n._spread[2])),e[t+3]=Math.abs(iw.randomFloat(n._value[3],n._spread[3]));return e}_assignAngleValue(e,t){const r=this.angle;if(iw.arrayValuesAreEqual(r._value)&&iw.arrayValuesAreEqual(r._spread)){const n=iw.randomFloat(r._value[0],r._spread[0]);e[t+0]=n,e[t+1]=n,e[t+2]=n,e[t+3]=n}else e[t+0]=iw.randomFloat(r._value[0],r._spread[0]),e[t+1]=iw.randomFloat(r._value[1],r._spread[1]),e[t+2]=iw.randomFloat(r._value[2],r._spread[2]),e[t+3]=iw.randomFloat(r._value[3],r._spread[3]);return e}_assignParamsValue(e,t,r){return e[t+0]=r?this.isStatic?1:0:1,e[t+1]=0,e[t+2]=iw.randomFloat(this.maxAge._value,this.maxAge._spread),e[t+3]=iw.randomFloat(this.wiggle._value,this.wiggle._spread),e}_assignRotationValue(e,t,r,n,i){const a=iw.getRotationAxis(hw,this.rotation._axis,this.rotation._axisSpread);i?(a.x+=1,a.y+=1,a.z+=1,a.multiplyScalar(.5),dw.setRGB(a.x,a.y,a.z),e[t+0]=dw.getHex(),e[t+1]=iw.randomFloat(this.rotation._angle,this.rotation._angleSpread),e[t+2]=this.rotation._static?0:1):(e[t+0]=a.x,e[t+1]=a.y,e[t+2]=a.z,e[t+3]=iw.randomFloat(this.rotation._angle,this.rotation._angleSpread),e[t+4]=this.rotation._static?0:1),this.rotation._center.toArray(r,n)}_assignColorValue(e,t,r){const n=this.color._value,i=this.color._spread,a=n.length;for(let s=0;s<a;++s){const a=i[s];dw.copy(n[s]),dw.r+=Math.random()*a.x-.5*a.x,dw.g+=Math.random()*a.y-.5*a.y,dw.b+=Math.random()*a.z-.5*a.z,dw.r=iw.clamp(dw.r,0,1),dw.g=iw.clamp(dw.g,0,1),dw.b=iw.clamp(dw.b,0,1),r?e[t+s]=dw.getHex():dw.toArray(e,t+3*s)}}}const hw=new bc,dw=new Eh;let pw=class extends cw{constructor(e){super(e),this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.activeParticleCount=0,this.attributes=null,this.paramsArray=null,this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0}tick(e){if(this.isStatic)return;null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);const t=this.attributeOffset,r=t+this.particleCount,n=this.paramsArray,i=this.particlesPerSecond*this.activeMultiplier*e,a=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(t,r,n,e),!1===this.alive)return void(this.age=0);if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);const s=1===this.particleCount?a:0|a,o=Math.min(s+i,this.activationEnd),l=o-this.activationIndex|0,u=l>0?e/l:0;this._activateParticles(s,o,n,u),this.activationIndex+=i,this.activationIndex>r&&(this.activationIndex=t),this.age+=e}reset(e){if(this.age=0,this.alive=!1,!0===e){const e=this.attributeOffset,t=e+this.particleCount,r=this.paramsArray,n=this.attributes.params.bufferAttribute;for(let n,i=t-1;i>=e;--i)n=4*i,r[n]=0,r[n+1]=0;n.updateRange.offset=0,n.updateRange.count=-1,n.needsUpdate=!0}return this}_assignValue(e,t){let r,n,i,a,s;switch(e){case"position":r=this.attributes.position.typedArray,this._assignPositionValue(r.array,r.componentSize*t);break;case"velocity":case"acceleration":r=this.attributes.position.typedArray,i=r.array[3*t+0],a=r.array[3*t+1],s=r.array[3*t+2],r=this.attributes[e].typedArray,this._assignForceValue(r.array,r.componentSize*t,e,[i,a,s]);break;case"size":case"opacity":r=this.attributes[e].typedArray,this._assignAbsLifetimeValue(r.array,r.componentSize*t,e);break;case"angle":r=this.attributes.angle.typedArray,this._assignAngleValue(r.array,r.componentSize*t);break;case"params":r=this.attributes.params.typedArray,this._assignParamsValue(r.array,r.componentSize*t,!0);break;case"rotation":r=this.attributes.rotation.typedArray,n=this.attributes.rotationCenter.typedArray,this._assignRotationValue(r.array,r.componentSize*t,n.array,n.componentSize*t,!0);break;case"color":r=this.attributes.color.typedArray,this._assignColorValue(r.array,r.componentSize*t,!0)}}_resetParticle(e){const t=this.resetFlags,r=this.updateFlags,n=this.updateCounts,i=this.attributeKeys;let a,s;for(let o=this.attributeCount-1;o>=0;--o)a=i[o],s=r[a],!0!==t[a]&&!0!==s||(this._assignValue(a,e),this._updateAttributeUpdateRange(a,e),!0===s&&n[a]===this.particleCount?(r[a]=!1,n[a]=0):1==s&&++n[a])}_setBufferUpdateRanges(e){this.attributeKeys=e,this.attributeCount=e.length;for(let t=this.attributeCount-1;t>=0;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}}_setAttributeOffset(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount}_updateAttributeUpdateRange(e,t){const r=this.bufferUpdateRanges[e];r.min=Math.min(t,r.min),r.max=Math.max(t,r.max)}_resetBufferRanges(){const e=this.bufferUpdateRanges,t=this.bufferUpdateKeys;let r,n=this.bufferUpdateCount-1;for(;n>=0;--n)r=t[n],e[r].min=Number.POSITIVE_INFINITY,e[r].max=Number.NEGATIVE_INFINITY}_onRemove(){this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0}_decrementParticleCount(){--this.activeParticleCount}_incrementParticleCount(){++this.activeParticleCount}_checkParticleAges(e,t,r,n){for(let i,a,s,o,l=t-1;l>=e;--l)i=4*l,o=r[i],0!==o&&(s=r[i+1],a=r[i+2],1===this.direction?(s+=n,s>=a&&(s=0,o=0,this._decrementParticleCount())):(s-=n,s<=0&&(s=a,o=0,this._decrementParticleCount())),r[i]=o,r[i+1]=s,this._updateAttributeUpdateRange("params",l))}_activateParticles(e,t,r,n){const i=this.direction;for(let a,s,o=e;o<t;++o)a=4*o,0!=r[a]&&1!==this.particleCount||(this._incrementParticleCount(),r[a]=1,this._resetParticle(o),s=n*(o-e),s<=r[a+1]&&(r[a+1]=-1===i?r[a+2]-s:s),this._updateAttributeUpdateRange("params",o))}};class fw{constructor(e){this.uuid=$h();const t=iw.types;e.texture=iw.ensureTypedArg(e.texture,t.OBJECT,{}),this.fixedTimeStep=iw.ensureTypedArg(e.fixedTimeStep,t.NUMBER,.016),this.hasPerspective=iw.ensureTypedArg(e.hasPerspective,t.BOOLEAN,!0),this.colorize=iw.ensureTypedArg(e.colorize,t.BOOLEAN,!0),this._emitters=[]}addEmitter(e){}removeEmitter(e){}tick(e){}dispose(){}_setMaterial(e,t){const r=iw.types;e.uniforms.tex=iw.ensureInstanceOf(t.texture.value,Bp,mw),e.blending=iw.ensureTypedArg(t.blending,r.STRING,Bc.ADD),e.transparent=iw.ensureTypedArg(t.transparent,r.BOOLEAN,!0),e.alphaTest=iw.ensureTypedArg(t.alphaTest,r.NUMBER,0),e.depthWrite=iw.ensureTypedArg(t.depthWrite,r.BOOLEAN,!1),e.depthTest=iw.ensureTypedArg(t.depthTest,r.BOOLEAN,!0),e.fog=iw.ensureTypedArg(t.fog,r.BOOLEAN,!0)}}const mw=new Bp;mw.image={data:new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]),width:2,height:2},mw.magFilter=Vc.NEAREST,mw.minFilter=Vc.NEAREST,mw.generateMipmaps=!1;let gw=class extends fw{constructor(e){let t=iw,r=t.types;super(e=iw.ensureTypedArg(e,r.OBJECT,{})),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,r.NUMBER,null),null===this.maxParticleCount&&console.warn("ParticleGroup: No maxParticleCount specified. Adding emitters after rendering will probably cause errors."),this.textureFrames=iw.ensureInstanceOf(e.texture.frames,xh,new xh(1,1)),this.textureFrames.max(new xh(1,1)),this.textureFrameCount=iw.ensureTypedArg(e.texture.frameCount,r.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=iw.ensureTypedArg(e.texture.loop,r.NUMBER,1),this.material=new bp({defines:{HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:nw.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},uniforms:{tex:null,textureAnimation:[this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1)],scale:t.ensureTypedArg(e.scale,r.NUMBER,300),deltaTime:0,runTime:0},vertexShader:uw.vertex,fragmentShader:uw.fragment}),this._setMaterial(this.material,e),this.material.drawMode=Kc.POINTS,this.uniforms=this.material.uniforms,this.defines=this.material.defines,this.geometry=new _p,this.geometry.addGroup(0,this.particleCount,0),this.mesh=new ap(this.geometry,[this.material]),this.mesh.frustumCulled=!1,this.attributes={position:new ow("v3",!0),acceleration:new ow("v4",!0),velocity:new ow("v3",!0),rotation:new ow("v4",!0),rotationCenter:new ow("v3",!0),params:new ow("v4",!0),size:new ow("v4",!0),angle:new ow("v4",!0),color:new ow("v4",!0),opacity:new ow("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0}addEmitter(e){if(e instanceof pw==!1)return void console.error("`emitter` argument must be instance of ParticleEmitter. Was provided with:",e);if(this._emitters.indexOf(e)>-1)return void console.error("ParticleEmitter already exists in this group. Will not add again.");if(null!==e.group)return void console.error("ParticleEmitter already belongs to another group. Will not add to requested group.");let t=this.attributes,r=this.particleCount,n=r+e.particleCount;this.particleCount=n,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("ParticleGroup: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(r),e.group=this,e.attributes=this.attributes;for(const e in t)t.hasOwnProperty(e)&&t[e]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(let t=r;t<n;++t)e._assignValue("position",t),e._assignValue("velocity",t),e._assignValue("acceleration",t),e._assignValue("size",t),e._assignValue("opacity",t),e._assignValue("angle",t),e._assignValue("params",t),e._assignValue("rotation",t),e._assignValue("color",t);return this._applyAttributesToGeometry(),this._emitters.push(e),this.$updateDefines(e),this._attributesNeedRefresh=!0,this}removeEmitter(e){const t=this._emitters.indexOf(e);if(e instanceof pw==!1)return void console.error("`emitter` argument must be instance of ParticleEmitter. Was provided with:",e);if(-1===t)return void console.error("ParticleEmitter does not exist in this group. Will not remove.");const r=e.attributeOffset,n=r+e.particleCount,i=this.attributes.params.typedArray;for(let e=r;e<n;++e)i.array[4*e]=0,i.array[4*e+1]=0;this._emitters.splice(t,1);for(const e in this.attributes)this.attributes.hasOwnProperty(e)&&this.attributes[e].splice(r,n);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0}tick(e){const t=this._emitters,r=t.length,n=e||this.fixedTimeStep,i=this.attributeKeys,a=this.attributes;let s,o;for(this.uniforms.runTime+=n,this.uniforms.deltaTime=n,s=this.attributeCount-1;s>=0;--s)a[i[s]].resetUpdateRange();if(0!==r||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(o=0;o<r;++o){const e=t[o];e.tick(n);const r=e.bufferUpdateRanges;let l,u,c;for(s=this.attributeCount-1;s>=0;--s)l=i[s],u=r[l],c=a[l],c.setUpdateRange(u.min,u.max),c.flagUpdate()}if(!0===this._attributesNeedDynamicReset){for(s=this.attributeCount-1;s>=0;--s)a[i[s]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(s=this.attributeCount-1;s>=0;--s)a[i[s]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}}dispose(){return this.mesh.geometry.dispose(),this.mesh.material[0].dispose(),this}$updateDefines(){const e=this._emitters,t=this.defines;let r,n=e.length-1;for(;n>=0;--n)r=e[n],t.SHOULD_CALCULATE_SPRITE||(t.SHOULD_ROTATE_TEXTURE=t.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,r.angle.value),Math.max.apply(null,r.angle.spread))),t.SHOULD_ROTATE_PARTICLES=t.SHOULD_ROTATE_PARTICLES||!!Math.max(r.rotation.angle,r.rotation.angleSpread),t.SHOULD_WIGGLE_PARTICLES=t.SHOULD_WIGGLE_PARTICLES||!!Math.max(r.wiggle.value,r.wiggle.spread);this.material.needsUpdate=!0}_applyAttributesToGeometry(){const e=this.attributes,t=this.geometry,r=t.attributes;let n,i;for(const a in e)e.hasOwnProperty(a)&&(n=e[a],i=r["position"===a?"a_Position":a],i||t.addAttribute("position"===a?"a_Position":a,n.bufferAttribute));this.geometry.version++,this.geometry.groups[0].count=this.particleCount}};const _w={name:"mesh_particle_shader",uniforms:{tex:null},vertexShader:"\n\t\t#include <common_vert>\n\n\t\tattribute vec3 mcol0;\n\t\tattribute vec3 mcol1;\n\t\tattribute vec3 mcol2;\n\t\tattribute vec3 mcol3;\n\t\tattribute vec4 color;\n\n\t\tattribute vec2 a_Uv;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 varyColor;\n\n\t\t#include <logdepthbuf_pars_vert>\n\n\t\tvoid main() {\n\t\t\tmat4 matrix = mat4(\n\t\t\t\tvec4(mcol0, 0),\n\t\t\t\tvec4(mcol1, 0),\n\t\t\t\tvec4(mcol2, 0),\n\t\t\t\tvec4(mcol3, 1)\n\t\t\t);\n\n\t\t\tvec4 worldPosition = u_Model * matrix * vec4(a_Position, 1.0);\n\t\t\tgl_Position = u_ProjectionView * worldPosition;\n\n\t\t\tvaryColor = color;\n\t\t\tvUv = a_Uv;\n\n\t\t\t#include <logdepthbuf_vert>\n\t\t}\n\t",fragmentShader:"\n\t\tuniform sampler2D tex;\n\n\t\t#include <common_frag>\n\t\t#include <fog_pars_frag>\n\t\t#include <logdepthbuf_pars_frag>\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 varyColor;\n\n\t\tvoid main() {\n\t\t\t#include <logdepthbuf_frag>\n\n\t\t\tgl_FragColor = varyColor * texture2D(tex, vUv);\n\n\t\t\t#include <fog_frag>\n\t\t}\n\t"};class vw{constructor(){this._matrix=new Sc,this._color=new Eh(1,1,1),this._opacity=1,this._originPosition=[0,0,0],this._originVelocity=[0,0,0],this._originAcceleration=[0,0,0,0],this._originOpacityArray=[],this._originSizeArray=[],this._originAngleArray=[],this._originColorArray=[1,1,1,1,1,1,1,1,1,1,1,1],this._originParams=[0,0,0,0],this._originRotation=[0,1,0,0,0],this._originRotationCenter=[0,0,0]}isAlive(){return!!this._originParams[0]}tick(e,t,r){this._originParams[1]+=e,this._originParams[1]>this._originParams[2]&&(this._originParams[0]=0),0!==this._originParams[0]?this._update(t,r):this._originParams[1]=0}submit(e,t){const r=16*t,n=this._matrix.elements;e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[4],e[r+4]=n[5],e[r+5]=n[6],e[r+6]=n[8],e[r+7]=n[9],e[r+8]=n[10],e[r+9]=n[12],e[r+10]=n[13],e[r+11]=n[14],e[r+12]=this._color.r,e[r+13]=this._color.g,e[r+14]=this._color.b,e[r+15]=this._opacity}_update(e,t){const r=this._originParams[1],n=r/this._originParams[2],i=yw.fromArray(this._originAcceleration);if(t.SHOULD_DRAG_PARTICLES){const e=1-.5*n*this._originAcceleration[3];i.multiplyScalar(e)}Sw.fromArray(this._originVelocity).multiplyScalar(r);const a=i.multiplyScalar(r*r*.5);if(Sw.add(xw.fromArray(this._originPosition)).add(a),t.SHOULD_WIGGLE_PARTICLES){const e=n*this._originParams[3]*Math.PI,t=Math.sin(e),r=Math.cos(e);Sw.x+=t,Sw.y+=r,Sw.z+=t}if(t.SHOULD_ROTATE_PARTICLES){const e=this._originRotation[3];if(0!==e){let t=0;t=0===this._originRotation[4]?e:iw.lerp(0,e,n);const r=yw.fromArray(this._originRotation),i=Aw.makeRotationAxis(r,t),a=yw.fromArray(this._originRotationCenter).sub(Sw);a.applyMatrix4(i),Sw.fromArray(this._originRotationCenter).sub(a)}}if(ww.set(1,1,1),t.SHOULD_SIZE_PARTICLES){const e=Cw(n,this._originSizeArray);ww.set(e,e,e)}if(t.isLookAtCamera||t.isLookAtCameraOnlyY)t.isLookAtCamera?Ew.copy(e.quaternion):t.isLookAtCameraOnlyY&&(Aw.getInverse(t.group.mesh.worldMatrix),Aw.multiply(e.worldMatrix),yw.setFromMatrixPosition(Aw),xw.copy(Sw).sub(yw),xw.y=0,Ew.setFromUnitVectors(yw.set(0,0,-1),xw.normalize()));else if(t.SHOULD_ANGLE_PARTICLES){const e=Cw(n,this._originAngleArray);bw.set(e,e,e),Ew.setFromEuler(bw,!1)}this._matrix.transform(Sw,ww,Ew),t.SHOULD_COLORIZE_PARTICLES?(!function(e,t,r){const n=nw.valueOverLifetimeLength-1;if(e<=0)r.fromArray(t,0);else if(e>=1)r.fromArray(t,3*n);else{const i=e*n;let a,s,o;for(let e=0;e<n;e++)if(i>e&&i<e+1){a=i-e,s=3*e,o=s+3,r.r=a*(t[o+0]-t[s+0])+t[s+0],r.g=a*(t[o+1]-t[s+1])+t[s+1],r.b=a*(t[o+2]-t[s+2])+t[s+2];break}}}(n,this._originColorArray,this._color),this._opacity=Cw(n,this._originOpacityArray)):(this._color.setRGB(1,1,1),this._opacity=1)}}const yw=new bc,xw=new bc,bw=new Dh,Aw=new Sc,Sw=new bc,Ew=new Mc,ww=new bc;function Cw(e,t){const r=nw.valueOverLifetimeLength-1;let n=0;if(e<=0)n=0;else if(e>=1)n=t[r];else{const i=e*r;for(let e=0;e<r;e++)if(i>e&&i<e+1){n+=iw.lerp(t[e],t[e+1],i-e);break}}return n}class Tw extends cw{constructor(e){super(e),this._activeParticles=new Array,this._particlePool=new Array}tick(e,t){if(this.isStatic)return;if(!1===this.alive)return void(this.age=0);const r=null!==this.duration&&this.age>this.duration;if(!r){const t=this._activeParticles.length,r=this.particlesPerSecond*this.activeMultiplier*e,n=Math.min(t+r,this.particleCount)-t;for(let e=0;e<n;e++){const e=this._particlePool.length<=0?new vw:this._particlePool.shift();this._resetParticle(e),this._activeParticles.push(e)}}for(let r=0,n=this._activeParticles.length;r<n;r++)if(this._activeParticles[r].tick(e,t,this),this._activeParticles[r].isAlive()){const e=this.group;this._activeParticles[r].submit(e.$instanceBuffer.array,e.$allocBufferIndex())}else this._particlePool.push(this._activeParticles[r]),this._activeParticles.splice(r,1),n--,r--;r&&this._activeParticles.length<=0&&(this.alive=!1,this.age=0),this.alive&&(this.age+=e)}reset(e){this.alive=!1,this.age=0,e&&(this._activeParticles=[],this._particlePool=[])}$updateFlags(e){this.SHOULD_DRAG_PARTICLES=!!Math.max(this.drag._value,this.drag._spread),this.SHOULD_WIGGLE_PARTICLES=!!Math.max(this.wiggle._value,this.wiggle._spread),this.SHOULD_ROTATE_PARTICLES=!!Math.max(this.rotation._angle,this.rotation._angleSpread),this.SHOULD_COLORIZE_PARTICLES=e.colorize,this.SHOULD_SIZE_PARTICLES=!0,this.SHOULD_ANGLE_PARTICLES=!0}_assignValue(e,t,r,n){switch(e){case"position":this._assignPositionValue(t,0);break;case"velocity":case"acceleration":this._assignForceValue(t,0,e,r);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,0,e);break;case"angle":this._assignAngleValue(t,0);break;case"params":this._assignParamsValue(t,0);break;case"rotation":this._assignRotationValue(t,0,n,0);break;case"color":this._assignColorValue(t,0)}}_resetParticle(e){this._assignValue("position",e._originPosition),this._assignValue("velocity",e._originVelocity,e._originPosition),this._assignValue("acceleration",e._originAcceleration,e._originPosition),this._assignValue("opacity",e._originOpacityArray),this._assignValue("size",e._originSizeArray),this._assignValue("angle",e._originAngleArray),this._assignValue("color",e._originColorArray),this._assignValue("params",e._originParams),this._assignValue("rotation",e._originRotation,void 0,e._originRotationCenter)}}class Dw extends fw{constructor(e){const t=iw.types;super(e=iw.ensureTypedArg(e,t.OBJECT,{})),void 0===e.maxParticleCount&&(console.warn("MeshParticleGroup: options.maxParticleCount is not provided, set to 1000 by default."),e.maxParticleCount=1e3),this.maxParticleCount=e.maxParticleCount,e.geometry&&e.geometry instanceof _p||(console.warn("MeshParticleGroup: options.geometry is not provided, set a box geometry by default."),e.geometry=new cm(1,1,1));const r=function(e,t){const r=e.clone(),n=new cp(new Float32Array(16*t),16);n.usage=Jc.DYNAMIC_DRAW;const i=new up(n,3,0),a=new up(n,3,3),s=new up(n,3,6),o=new up(n,3,9),l=new up(n,4,12);return i.divisor=1,a.divisor=1,s.divisor=1,o.divisor=1,l.divisor=1,r.addAttribute("mcol0",i),r.addAttribute("mcol1",a),r.addAttribute("mcol2",s),r.addAttribute("mcol3",o),r.addAttribute("color",l),r}(e.geometry,this.maxParticleCount),n=new bp(_w);this._setMaterial(n,e),this.mesh=new ap(r,n),this.mesh.frustumCulled=!1,this.$instanceBuffer=r.attributes.mcol0.buffer,this._geometry=r,this._particleCount=0,this._aliveParticleCount=0}addEmitter(e){if(e instanceof Tw!=!1)if(this._emitters.indexOf(e)>-1)console.error("MeshParticleEmitter already exists in this group. Will not add again.");else{if(null===e.group)return this._particleCount+=e.particleCount,this._particleCount>this.maxParticleCount&&console.warn("MeshParticleGroup: maxParticleCount exceeded. Requesting",this._particleCount,"particles, can support only",this.maxParticleCount),e.group=this,this._emitters.push(e),this.$updateDefines(e),this;console.error("MeshParticleEmitter already belongs to another group. Will not add to requested group.")}else console.error("`emitter` argument must be instance of MeshParticleEmitter. Was provided with:",e)}removeEmitter(e){const t=this._emitters.indexOf(e);if(e instanceof Tw!=!1){if(-1!==t)return this._particleCount-=e.particleCount,e.group=null,this._emitters.splice(t,1),this;console.error("MeshParticleEmitter does not exist in this group. Will not remove.")}else console.error("`emitter` argument must be instance of MeshParticleEmitter. Was provided with:",e)}tick(e,t){const r=this._emitters,n=r.length,i=e||this.fixedTimeStep;if(0!==n){this._aliveParticleCount=0;for(let e=0;e<n;e++)r[e].tick(i,t);this.$instanceBuffer.version++,this._geometry.instanceCount=this._aliveParticleCount}}dispose(){this.mesh.geometry.dispose(),this.mesh.material.dispose();for(let e=0,t=this._emitters.length;e<t;e++)this._emitters[e].group=null;return this._emitters=[],this._particleCount=0,this._aliveParticleCount=0,this}get particleCount(){return this._particleCount}get aliveParticleCount(){return this._aliveParticleCount}$updateDefines(e){e.$updateFlags(this)}$allocBufferIndex(){return this._aliveParticleCount++}}const Mw="ParticleCount",Pw="Distribution",Fw="Duration",Rw="IsLookAtCamera",Nw="IsLookAtCameraOnlyY",Bw="MaxAge",Iw="Position",Ow="Velocity",kw="Acceleration",Lw="Drag",Uw="Rotation",zw="ListColor",jw="ListOpacity",Vw="ListSize",Gw="ListAngle";class Ww{constructor(e){this._useMesh=e&&e.useMesh||!1;const t=e&&e.parsed||!1;e.emitterOptions=e&&e.emitterOptions||{},this._parseEmitterOptions(e,t),this._emitter=this._useMesh?new Tw(this._emitterOptions):new pw(this._emitterOptions),this._group=e&&e.group||this._emitter.group,this._applyLocked=!1,this._attributesFuncsQueue=[]}getType(){return"ParticleEmitter"}begin(){this._applyLocked=!0,this._attributesFuncsQueue.length=0}end(){this._applyLocked=!1,this._applyAllAttributes()}getAttribute(e){let t={};switch(e){case Mw:return this._emitter.particleCount;case Pw:return this._emitter.type;case Fw:return this._emitter.duration;case Rw:return this._emitter.isLookAtCamera;case Nw:return this._emitter.isLookAtCameraOnlyY;case Bw:return this._emitter.maxAge;case Lw:return this._emitter.drag;case jw:return this._emitter.opacity;case Vw:return this._emitter.size;case Gw:return this._emitter.angle;case Iw:return t.value=[this._emitter.position.value.x,this._emitter.position.value.y,this._emitter.position.value.z],t.spread=[this._emitter.position.spread.x,this._emitter.position.spread.y,this._emitter.position.spread.z],t.spreadClamp=[this._emitter.position.spreadClamp.x,this._emitter.position.spreadClamp.y,this._emitter.position.spreadClamp.z],t.radius=this._emitter.position.radius,t.radiusScale=[this._emitter.position.radiusScale.x,this._emitter.position.radiusScale.y,this._emitter.position.radiusScale.z],t.distribution=this._emitter.position.distribution,t.randomise=this._emitter.position.randomise,t;case Ow:return t.value=[this._emitter.velocity.value.x,this._emitter.velocity.value.y,this._emitter.velocity.value.z],t.spread=[this._emitter.velocity.spread.x,this._emitter.velocity.spread.y,this._emitter.velocity.spread.z],t.distribution=this._emitter.velocity.distribution,t.randomise=this._emitter.velocity.randomise,t;case kw:return t.value=[this._emitter.acceleration.value.x,this._emitter.acceleration.value.y,this._emitter.acceleration.value.z],t.spread=[this._emitter.acceleration.spread.x,this._emitter.acceleration.spread.y,this._emitter.acceleration.spread.z],t.distribution=this._emitter.acceleration.distribution,t.randomise=this._emitter.acceleration.randomise,t;case Uw:return t.axis=[this._emitter.rotation.axis.x,this._emitter.rotation.axis.y,this._emitter.rotation.axis.z],t.axisSpread=[this._emitter.rotation.axisSpread.x,this._emitter.rotation.axisSpread.y,this._emitter.rotation.axisSpread.z],t.angle=this._emitter.rotation.angle,t.angleSpread=this._emitter.rotation.angleSpread,t.static=this._emitter.rotation.static,t.center=[this._emitter.rotation.center.x,this._emitter.rotation.center.y,this._emitter.rotation.center.z],t.randomise=this._emitter.rotation.randomise,t;case zw:let e=[],r=[];for(let t=0;t<this._emitter.color.value.length;t++)e.push([this._emitter.color.value[t].r,this._emitter.color.value[t].g,this._emitter.color.value[t].b]),r.push([this._emitter.color.spread[t].x,this._emitter.color.spread[t].y,this._emitter.color.spread[t].z]);return t.value=e,t.spread=r,t.randomise=this._emitter.color.randomise,t;default:return null}}setAttribute(e,t){switch(e){case Mw:if(t!==this._emitter.particleCount){if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});let r=0;if(this._emitter.group._emitters.forEach((e=>{r+=e.particleCount})),r-this._emitter.particleCount+t<=this._emitter.group.maxParticleCount)this._group||(this._group=this._emitter.group),this._group.removeEmitter(this),this._emitter.particleCount=t,this._emitter.calculatePPSValue(),this._group.addEmitter(this);else{if(this._emitter.particleCount=t,this._emitter.calculatePPSValue(),this._group||(this._group=this._emitter.group),!this._group._parent)return void console.warn("_parent is undefined.Please use setParent to set _parent for UParticleGroup！");let e=this._group;e._groupOptions.maxParticleCount=r-this._emitterOptions.particleCount+t;let n=[];for(let t=0;t<e._emitters.length;t++)n.push(e._emitters[t]),n[t]._emitter.group=null;e.removeEmitter(this),e._group.dispose(),e._parent.$node.remove(e._group.mesh),e._group=null,e._group=this._useMesh?new Dw(e._groupOptions):new gw(e._groupOptions),e._emitters.length=0;for(let t=0;t<n.length;t++)e._emitters.push(n[t]),e._group.addEmitter(n[t]._emitter);n.length=0,e._group.mesh.userData.isParticleMesh=!0,e._group.mesh.frustumCulled=!1,e._parent.$node.add(e._group.mesh)}this._emitterOptions.particleCount=t}break;case Pw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._emitter.type=t||1,this._emitterOptions.type=t;break;case Fw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._emitter.duration=t||null,this._emitterOptions.duration=t;break;case Rw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._emitter.isLookAtCamera=t||!1,this._emitterOptions.isLookAtCamera=t;break;case Nw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._emitter.isLookAtCameraOnlyY=t||!1,this._emitterOptions.isLookAtCameraOnlyY=t;break;case Bw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._emitter.maxAge.value=t.value||2,this._emitter.maxAge.spread=t.spread||0,this._emitterOptions.maxAge=t;break;case Iw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._emitterOptions.position.value=t.value?new bc(t.value[0],t.value[1],t.value[2]):new bc(0,0,0),this._emitterOptions.position.spread=t.spread?new bc(t.spread[0],t.spread[1],t.spread[2]):new bc(0,0,0),this._emitterOptions.position.spreadClamp=t.spreadClamp?new bc(t.spreadClamp[0],t.spreadClamp[1],t.spreadClamp[2]):new bc(0,0,0),this._emitterOptions.position.radius=t.radius||10,this._emitterOptions.position.radiusScale=t.radiusScale?new bc(t.radiusScale[0],t.radiusScale[1],t.radiusScale[2]):new bc(1,1,1),this._emitterOptions.position.distribution=t.distribution||this._emitterOptions.type,this._emitterOptions.position.randomise=t.randomise||!1,this._emitter.position.value=this._emitterOptions.position.value,this._emitter.position.spread=this._emitterOptions.position.spread,this._emitter.position.spreadClamp=this._emitterOptions.position.spreadClamp,this._emitter.position.radius=this._emitterOptions.position.radius,this._emitter.position.radiusScale=this._emitterOptions.position.radiusScale,this._emitter.position.distribution=this._emitterOptions.position.distribution,this._emitter.position.randomise=this._emitterOptions.position.randomise;break;case Ow:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._emitterOptions.velocity.value=t.value?new bc(t.value[0],t.value[1],t.value[2]):new bc(0,0,0),this._emitterOptions.velocity.spread=t.spread?new bc(t.spread[0],t.spread[1],t.spread[2]):new bc(0,0,0),this._emitterOptions.velocity.randomise=t.randomise||!1,this._emitterOptions.velocity.distribution=t.distribution||this._emitterOptions.type,this._emitter.velocity.value=this._emitterOptions.velocity.value,this._emitter.velocity.spread=this._emitterOptions.velocity.spread,this._emitter.velocity.distribution=this._emitterOptions.velocity.distribution,this._emitter.velocity.randomise=this._emitterOptions.velocity.randomise;break;case kw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._emitterOptions.acceleration.value=t.value?new bc(t.value[0],t.value[1],t.value[2]):new bc(0,0,0),this._emitterOptions.acceleration.spread=t.spread?new bc(t.spread[0],t.spread[1],t.spread[2]):new bc(0,0,0),this._emitterOptions.acceleration.distribution=t.distribution||this._emitterOptions.type,this._emitterOptions.acceleration.randomise=t.randomise||!1,this._emitter.acceleration.value=this._emitterOptions.acceleration.value,this._emitter.acceleration.spread=this._emitterOptions.acceleration.spread,this._emitter.acceleration.distribution=this._emitterOptions.acceleration.distribution,this._emitter.acceleration.randomise=this._emitterOptions.acceleration.randomise;break;case Lw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._emitterOptions.drag=t,this._emitter.drag.value=t.value||0,this._emitter.drag.spread=t.spread||0,this._emitter.drag.randomise=t.randomise||!1;break;case Uw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._emitterOptions.rotation.axis=t.axis?new bc(t.axis[0],t.axis[1],t.axis[2]):new bc(0,1,0),this._emitterOptions.rotation.axisSpread=t.axisSpread?new bc(t.axisSpread[0],t.axisSpread[1],t.axisSpread[2]):new bc(0,0,0),this._emitterOptions.rotation.angle=t.angle||0,this._emitterOptions.rotation.angleSpread=t.angleSpread||0,this._emitterOptions.rotation.static=t.static||!1,this._emitterOptions.rotation.center=t.center?new bc(t.center[0],t.center[1],t.center[2]):this._emitterOptions.position.value,this._emitterOptions.rotation.randomise=t.randomise||!1,this._emitter.rotation.axis=this._emitterOptions.rotation.axis,this._emitter.rotation.axisSpread=this._emitterOptions.rotation.axisSpread,this._emitter.rotation.angle=this._emitterOptions.rotation.angle,this._emitter.rotation.angleSpread=this._emitterOptions.rotation.angleSpread,this._emitter.rotation.static=this._emitterOptions.rotation.static,this._emitter.rotation.center=this._emitterOptions.rotation.center,this._emitter.rotation.randomise=this._emitterOptions.rotation.randomise;break;case zw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});let r=[],n=[],i=[];for(let e=0;e<t.value.length;e++)r.push(t.value?new Eh(t.value[e][0],t.value[e][1],t.value[e][2]):new Eh(1,1,1)),n.push(t.spread?new bc(t.spread[e][0],t.spread[e][1],t.spread[e][2]):new bc(0,0,0)),i.push(!!t.randomise&&t.randomise[e]);this._emitterOptions.color.value=r||this._emitterOptions.color.value,this._emitterOptions.color.spread=n||this._emitterOptions.color.spread,this._emitterOptions.color.randomise=i||this._emitterOptions.color.randomise,this._emitter.color.value=this._emitterOptions.color.value,this._emitter.color.spread=this._emitterOptions.color.spread,this._emitter.color.randomise=this._emitterOptions.color.randomise;break;case jw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});let a=[],s=[],o=[];for(let e=0;e<t.value.length;e++)a.push(t.value?t.value[e]:1),s.push(t.spread?t.spread[e]:0),o.push(!!t.randomise&&t.randomise[e]);this._emitterOptions.opacity.value=a||this._emitterOptions.opacity.value,this._emitterOptions.opacity.spread=s||this._emitterOptions.opacity.spread,this._emitterOptions.opacity.randomise=o||this._emitterOptions.opacity.randomise,this._emitter.opacity.value=this._emitterOptions.opacity.value,this._emitter.opacity.spread=this._emitterOptions.opacity.spread,this._emitter.opacity.randomise=this._emitterOptions.opacity.randomise;break;case Vw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});let l=[],u=[],c=[];for(let e=0;e<t.value.length;e++)l.push(t.value?t.value[e]:1),u.push(t.spread?t.spread[e]:0),c.push(!!t.randomise&&t.randomise[e]);this._emitterOptions.size.value=l||this._emitterOptions.size.value,this._emitterOptions.size.spread=u||this._emitterOptions.size.spread,this._emitterOptions.size.randomise=c||this._emitterOptions.size.randomise,this._emitter.size.value=this._emitterOptions.size.value,this._emitter.size.spread=this._emitterOptions.size.spread,this._emitter.size.randomise=this._emitterOptions.size.randomise;break;case Gw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});let h=[],d=[],p=[];for(let e=0;e<t.value.length;e++)h.push(t.value?t.value[e]:0),d.push(t.spread?t.spread[e]:0),p.push(!!t.randomise&&t.randomise[e]);this._emitterOptions.angle.value=h||this._emitterOptions.angle.value,this._emitterOptions.angle.spread=d||this._emitterOptions.angle.spread,this._emitterOptions.angle.randomise=p||this._emitterOptions.angle.randomise,this._emitter.angle.value=this._emitterOptions.angle.value,this._emitter.angle.spread=this._emitterOptions.angle.spread,this._emitter.angle.randomise=this._emitterOptions.angle.randomise}}setGroup(e){this._group=e}getGroup(){return this._group}_applyAllAttributes(){this._attributesFuncsQueue.forEach((e=>{this.setAttribute(e.key,e.value)}))}_parseEmitterOptions(e,t){if(e&&e.emitterOptions&&(this._emitterOptions=e.emitterOptions,!t)){if(this._emitterOptions.type=this._emitterOptions.type||1,this._emitterOptions.position||(this._emitterOptions.position={}),this._emitterOptions.position.value=(new bc).fromArray(this._emitterOptions.position.value||[0,0,0]),this._emitterOptions.position.spread=(new bc).fromArray(this._emitterOptions.position.spread||[0,0,0]),this._emitterOptions.position.spreadClamp=(new bc).fromArray(this._emitterOptions.position.spreadClamp||[0,0,0]),this._emitterOptions.position.radius=void 0===this._emitterOptions.position.radius?10:this._emitterOptions.position.radius,this._emitterOptions.position.radiusScale=(new bc).fromArray(this._emitterOptions.position.radiusScale||[1,1,1]),this._emitterOptions.position.distribution=this._emitterOptions.position.distribution||this._emitterOptions.type,this._emitterOptions.position.randomise=this._emitterOptions.position.randomise||!1,this._emitterOptions.velocity||(this._emitterOptions.velocity={}),this._emitterOptions.velocity.value=(new bc).fromArray(this._emitterOptions.velocity.value||[0,0,0]),this._emitterOptions.velocity.spread=(new bc).fromArray(this._emitterOptions.velocity.spread||[0,0,0]),this._emitterOptions.velocity.distribution=this._emitterOptions.velocity.distribution||this._emitterOptions.type,this._emitterOptions.velocity.randomise=this._emitterOptions.velocity.randomise||!1,this._emitterOptions.acceleration||(this._emitterOptions.acceleration={}),this._emitterOptions.acceleration.value=(new bc).fromArray(this._emitterOptions.acceleration.value||[0,0,0]),this._emitterOptions.acceleration.spread=(new bc).fromArray(this._emitterOptions.acceleration.spread||[0,0,0]),this._emitterOptions.acceleration.distribution=this._emitterOptions.acceleration.distribution||this._emitterOptions.type,this._emitterOptions.acceleration.randomise=this._emitterOptions.acceleration.randomise||!1,this._emitterOptions.rotation||(this._emitterOptions.rotation={}),this._emitterOptions.rotation.axis=(new bc).fromArray(this._emitterOptions.rotation.axis||[0,1,0]),this._emitterOptions.rotation.axisSpread=(new bc).fromArray(this._emitterOptions.rotation.axisSpread||[0,0,0]),this._emitterOptions.rotation.angle=this._emitterOptions.rotation.angle||0,this._emitterOptions.rotation.angleSpread=this._emitterOptions.rotation.angleSpread||0,this._emitterOptions.rotation.static=this._emitterOptions.rotation.static||0,this._emitterOptions.rotation.center=this._emitterOptions.rotation.center?(new bc).fromArray(this._emitterOptions.rotation.center):this._emitterOptions.position.value,this._emitterOptions.rotation.randomise=this._emitterOptions.rotation.randomise||!1,this._emitterOptions.angle){let e=[],t=[],r=[];for(let n=0,i=this._emitterOptions.angle.value.length;n<i;n++)e.push(this._emitterOptions.angle.value[n]||0),t.push(this._emitterOptions.angle.spread&&this._emitterOptions.angle.spread[n]||0),r.push(this._emitterOptions.angle.randomise&&this._emitterOptions.angle.randomise[n]||!1);this._emitterOptions.angle.value=e,this._emitterOptions.angle.spread=t,this._emitterOptions.angle.randomise=r}else this._emitterOptions.angle={},this._emitterOptions.angle.value=[0],this._emitterOptions.angle.spread=[0],this._emitterOptions.angle.randomise=[!1];if(this._emitterOptions.opacity){let e=[],t=[],r=[];for(let n=0,i=this._emitterOptions.opacity.value.length;n<i;n++)e.push(void 0===this._emitterOptions.opacity.value[n]?1:this._emitterOptions.opacity.value[n]),t.push(this._emitterOptions.opacity.spread&&this._emitterOptions.opacity.spread[n]||0),r.push(this._emitterOptions.opacity.randomise&&this._emitterOptions.opacity.randomise[n]||!1);this._emitterOptions.opacity.value=e,this._emitterOptions.opacity.spread=t,this._emitterOptions.opacity.randomise=r}else this._emitterOptions.opacity={},this._emitterOptions.opacity.value=[1],this._emitterOptions.opacity.spread=[0],this._emitterOptions.opacity.randomise=[!1];if(this._emitterOptions.drag||(this._emitterOptions.drag={}),this._emitterOptions.drag.value=this._emitterOptions.drag.value||0,this._emitterOptions.drag.spread=this._emitterOptions.drag.spread||0,this._emitterOptions.drag.randomise=this._emitterOptions.drag.randomise||!1,this._emitterOptions.maxAge||(this._emitterOptions.maxAge={}),this._emitterOptions.maxAge.value=void 0===this._emitterOptions.maxAge.value?2:this._emitterOptions.maxAge.value,this._emitterOptions.maxAge.spread=this._emitterOptions.maxAge.spread||0,this._emitterOptions.wiggle||(this._emitterOptions.wiggle={}),this._emitterOptions.wiggle.value=this._emitterOptions.wiggle.value||0,this._emitterOptions.wiggle.spread=this._emitterOptions.wiggle.spread||0,this._emitterOptions.size){let e=[],t=[],r=[];for(let n=0;n<this._emitterOptions.size.value.length;n++)e.push(void 0===this._emitterOptions.size.value[n]?1:this._emitterOptions.size.value[n]),t.push(this._emitterOptions.size.spread&&this._emitterOptions.size.spread[n]||0),r.push(this._emitterOptions.size.randomise&&this._emitterOptions.size.randomise[n]||!1);this._emitterOptions.size.value=e,this._emitterOptions.size.spread=t,this._emitterOptions.size.randomise=r}else this._emitterOptions.size={},this._emitterOptions.size.value=[1],this._emitterOptions.size.spread=[0],this._emitterOptions.size.randomise=[!1];if(this._emitterOptions.color){let e=[],t=[],r=[];for(let n=0;n<this._emitterOptions.color.value.length;n++)e.push((new Eh).fromArray(this._emitterOptions.color.value[n]||[1,1,1])),t.push((new bc).fromArray(this._emitterOptions.color.spread&&this._emitterOptions.color.spread[n]||[0,0,0])),r.push(this._emitterOptions.color.randomise&&this._emitterOptions.color.randomise[n]||!1);this._emitterOptions.color.value=e,this._emitterOptions.color.spread=t,this._emitterOptions.color.randomise=r}else this._emitterOptions.color={},this._emitterOptions.color.value=[new Eh(1,1,1)],this._emitterOptions.color.spread=[new bc],this._emitterOptions.color.randomise=[!1];this._emitterOptions.activeultiplier=void 0===this._emitterOptions.activeultiplier?1:this._emitterOptions.activeultiplier,this._emitterOptions.direction=void 0===this._emitterOptions.direction?1:this._emitterOptions.direction,this._emitterOptions.duration=this._emitterOptions.duration||null,this._emitterOptions.isStatic=this._emitterOptions.isStatic||!1,this._emitterOptions.isLookAtCamera=this._emitterOptions.isLookAtCamera||!1,this._emitterOptions.isLookAtCameraOnlyY=this._emitterOptions.isLookAtCameraOnlyY||!1,this._emitterOptions.particleCount=void 0===this._emitterOptions.particleCount?200:this._emitterOptions.particleCount}}}const Hw="UseMesh",qw="MeshUrl",Xw="MaxParticleCount",Qw="Texture",Kw="BlendingMode",Yw="IsTransparent",Zw="AlphaTest",Jw="Url",$w="DepthWrite",eC="DepthTest",tC=["none","normal","add","sub","mul","custom"],rC=(new Mc).setFromEuler(new Dh(Math.PI/2,0,0)).toMatrix4(),nC={Box:new cm(1,1,1),Plane:new vp(1,1),Sphere:new dm(1,8,8)},iC=e=>{let t=null;return e.strMeshUrl.indexOf("BuildIn")>=0?(e.strMeshUrl.indexOf("Box")>=0&&(t=e.params&&e.params.length>=3?new cm(e.params[0],e.params[1],e.params[2]):nC.Box),e.strMeshUrl.indexOf("Plane")>=0&&(t=e.params&&e.params.length>=2?new vp(e.params[0],e.params[1]):nC.Plane,Gb.applyMatrix4(t,rC,!0)),e.strMeshUrl.indexOf("Sphere")>=0&&(t=e.params&&e.params.length>=3?new dm(e.params[0],e.params[1]<=12?e.params[1]:12,e.params[2]<=12?e.params[2]:12):nC.Sphere)):console.warn("UParticleSystem not support .obj or .json model resource yet."),t};class aC{constructor(e){if(this._useMesh=e&&e.useMesh||!1,e.groupOptions=e&&e.groupOptions||{},this._parseGroupOptions(e),this._useMesh){const e={strMeshUrl:this._groupOptions.meshUrl||"BuildIn/Plane",params:this._groupOptions.arrayMeshParams||[1,1,1,1,1,1]};this._groupOptions.meshUrl=e.strMeshUrl,this._groupOptions.geometry=iC(e)}this._group=this._useMesh?new Dw(this._groupOptions):new gw(this._groupOptions),this._group.mesh.userData.skipOutline=!0,this._emitters=[],this._parent=e&&e.parent,this._applyLocked=!1,this._attributesFuncsQueue=[],this._groupOptions.useTexture2D=!0}getType(){return"ParticleGroup"}begin(){this._applyLocked=!0,this._attributesFuncsQueue.length=0}end(){this._applyLocked=!1,this._applyAllAttributes()}getAttribute(e){let t;switch(e){case Hw:return this._useMesh;case qw:return this._groupOptions.meshUrl;case Xw:return this._groupOptions.maxParticleCount;case Qw:return this._groupOptions.texture.value;case Jw:return this._groupOptions.texture.url;case Kw:return t=Array.isArray(this._group.mesh.material)?this._group.mesh.material[0]:this._group.mesh.material,t.blending;case Yw:return t=Array.isArray(this._group.mesh.material)?this._group.mesh.material[0]:this._group.mesh.material,t.transparent;case Zw:return t=Array.isArray(this._group.mesh.material)?this._group.mesh.material[0]:this._group.mesh.material,t.alphaTest;case eC:return t=Array.isArray(this._group.mesh.material)?this._group.mesh.material[0]:this._group.mesh.material,t.depthTest;case $w:return t=Array.isArray(this._group.mesh.material)?this._group.mesh.material[0]:this._group.mesh.material,t.depthWrite;default:return null}}setAttribute(e,t){let r;switch(e){case Hw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});t!==this._useMesh&&(this._useMesh=t,this._groupOptions.useMesh=t,this._createParticleGroup(!0));break;case qw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});t!==this._groupOptions.meshUrl&&this._useMesh&&(this._groupOptions.meshUrl=t,this._createParticleGroup(!0));break;case Qw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._groupOptions.useTexture2D=!1,this._groupOptions.texture.value=t,r=this._group.mesh.material instanceof bp?this._group.mesh.material:this._group.mesh.material[0],r.uniforms.tex=this._groupOptions.texture.value.textureResource.$texture;break;case Jw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});const n=this._parent.$getTextureURL(this._parent.rootPath,t);this._groupOptions.texture.url=t,this._group.mesh.visible=!1;const i=this;i._groupOptions.texture.url=t,oE(n,rE,null,(e=>{if(e){const t=e.getTexture({});i._groupOptions.useTexture2D=!0,i._groupOptions.texture.value=t,r=i._group.mesh.material instanceof bp?i._group.mesh.material:i._group.mesh.material[0],r.uniforms.tex=t,i._group.mesh.visible=!0}}));break;case Kw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._groupOptions.blending=t,r=this._group.mesh.material instanceof bp?this._group.mesh.material:this._group.mesh.material[0],r.blending=tC[t];break;case Yw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._groupOptions.transparent=t,r=this._group.mesh.material instanceof bp?this._group.mesh.material:this._group.mesh.material[0],r.transparent=t;break;case Zw:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._groupOptions.alphaTest=t,r=this._group.mesh.material instanceof bp?this._group.mesh.material:this._group.mesh.material[0],r.alphaTest=t;break;case eC:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._groupOptions.depthTest=t,r=this._group.mesh.material instanceof bp?this._group.mesh.material:this._group.mesh.material[0],r.depthTest=t;break;case $w:if(this._applyLocked)return void this._attributesFuncsQueue.push({key:e,value:t});this._groupOptions.depthWrite=t,r=this._group.mesh.material instanceof bp?this._group.mesh.material:this._group.mesh.material[0],r.depthWrite=t}}addEmitter(e){e instanceof Ww&&(e.getGroup()||e.setGroup(this),this._emitters.push(e),this._group.addEmitter(e._emitter))}removeEmitter(e){if(e instanceof Ww){const t=this._emitters.findIndex((t=>t===e));-1!==t&&(this._emitters.splice(t,1),this._group.removeEmitter(e._emitter))}}getEmitters(){return this._emitters}setParent(e){this._parent=e}getParent(){return this._parent}dispose(){this._group.dispose()}_createParticleGroup(e){if(!this._parent)return void console.warn("_parent is undefined.Please use setParent to set _parent for UParticleGroup!");let t=[];for(let e=0;e<this._emitters.length;e++)t.push(this._emitters[e]._emitterOptions);if(this._group.dispose(),this._parent.$node.remove(this._group.mesh),this._group=null,e){const e={strMeshUrl:this._groupOptions.meshUrl,params:this._groupOptions.arrayMeshParams};this._groupOptions.geometry=iC(e)}this._group=this._useMesh?new Dw(this._groupOptions):new gw(this._groupOptions),this._emitters.length=0;for(let e=0;e<t.length;e++){const r=new Ww({emitterOptions:t[e],useMesh:this._useMesh,group:this._group,parsed:!0});this._emitters.push(r),this._group.addEmitter(r._emitter)}t.length=0,this._group.mesh.userData.isParticleMesh=!0,this._group.mesh.frustumCulled=!1,this._parent.$node.add(this._group.mesh)}_applyAllAttributes(){let e=-1,t=-1;this._attributesFuncsQueue.forEach(((r,n)=>{if("UseMesh"===r.key)e=n;else{if("MeshUrl"!==r.key)return;t=n}})),e<0&&t<0?this._attributesFuncsQueue.forEach((e=>{this.setAttribute(e.key,e.value),console.log(e.key)})):e>-1&&t>-1?this._attributesFuncsQueue[e].value?this._attributesFuncsQueue.forEach((e=>{"UseMesh"!==e.key?(this.setAttribute(e.key,e.value),console.log(e.key)):this._useMesh=!0})):this._attributesFuncsQueue.forEach((e=>{"MeshUrl"!==e.key&&(this.setAttribute(e.key,e.value),console.log(e.key))})):this._attributesFuncsQueue.forEach((e=>{this.setAttribute(e.key,e.value),console.log(e.key)}))}_parseGroupOptions(e){if(e&&e.groupOptions){this._groupOptions=e.groupOptions,this._groupOptions.texture=this._groupOptions.texture?this._groupOptions.texture:{},this._groupOptions.texture.frames=this._groupOptions.texture.frames?new xh(this._groupOptions.texture.frames[0],this._groupOptions.texture.frames[1]):new xh(1,1),this._groupOptions.texture.frameCount=this._groupOptions.texture.frameCount,this._groupOptions.texture.loop=this._groupOptions.texture.loop;const t=this._groupOptions.vec4Quaternion;this._groupOptions.vec4Quaternion=t?new Mc(t[0],t[1],t[2],t[3]):new Mc,this._groupOptions.fixedTimeStep=this._groupOptions.fixedTimeStep||.016,this._groupOptions.alphaTest=this._groupOptions.alphaTest||0,this._groupOptions.scale=this._groupOptions.scale||300,this._groupOptions.maxParticleCount=this._groupOptions.maxParticleCount,this._groupOptions.blending=this._groupOptions.blending||2,this._groupOptions.arrayMeshParams=this._groupOptions.arrayMeshParams||[1,1,1,1,1,1],this._groupOptions.meshUrl=this._groupOptions.meshUrl||"BuildIn/Plane"}}}class sC extends QE{constructor(e){super(e),this.$groups=[],this.rootPath=""}getType(){return"ParticleSystem"}setWorldScale(e){this.$groups.forEach((t=>{if(!t._groupOptions.useMesh){const r=Math.min(e[0],e[1],e[2]);t._group.mesh.material[0].uniforms.scale=t._groupOptions.scale*r}})),super.setWorldScale(e)}setScale(e){this.$groups.forEach((t=>{if(!t._groupOptions.useMesh){const r=Math.min(e[0],e[1],e[2]);t._group.mesh.material[0].uniforms.scale=t._groupOptions.scale*r}})),super.setScale(e)}$getTextureURL(e,t){return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data")||t.startsWith(e)||(t.startsWith(".")?(t=t.slice(t.indexOf("/"),t.length),t=e.concat(t)):t=e.concat(t)),t}$parseGroupOptions(e,t,r,n){const i=(r.screenSize||[1,1])[1];let a;a=n?{texture:{value:t,frames:e.texture.frames,frameCount:e.texture.frameCount,loop:e.texture.loop},fixedTimeStep:e.fixedTimeStep,hasPerspective:"false"!=e.hasPerspective,colorize:"false"!=e.isColorize,blending:e.blendingMode,transparent:"false"!=e.transparent,alphaTest:e.alphaTest,depthWrite:"true"==e.depthWrite,depthTest:"false"!=e.depthTest,fog:"false"!=e.fog,scale:i/2,maxParticleCount:e.maxParticleCount,useMesh:"true"==e.useMesh,listEmitters:e.emitters,meshUrl:e.meshType}:{texture:{value:t,frames:e.texture.vec2Frames,frameCount:e.texture.iFrameCount,loop:e.texture.iLoop},fixedTimeStep:e.fFixedTimeStep,hasPerspective:"false"!=e.strHasPerspective,colorize:"false"!=e.strIsColorize,blending:e.iBlendingMode,transparent:"false"!=e.strIsTransparent,alphaTest:e.fAlphaTest,depthWrite:"true"==e.strIsDepthWrite,depthTest:"false"!=e.strIsDepthTest,fog:"false"!=e.strIsFog,scale:i/2,maxParticleCount:e.iMaxParticleCount,useMesh:"true"==e.strUseMesh,listEmitters:e.listEmitters,meshUrl:e.strMeshUrl};const s=e.vec4Quaternion;return s&&(a.vec4Quaternion=[s.x,s.y,s.z,s.w]),a}$parseEmitterOptions(e,t,r){let n;if(r){let t,r,i;t=!(!e.position||"true"!=e.position.randomise),r=!(!e.acceleration||"true"!=e.acceleration.randomise),i="true"==e.isStatic;let a=!1;a=!(!e.rotation||"true"!=e.rotation.static);let s,o,l,u,c,h,d,p=!1;p=!(!e.rotation||"true"!=e.rotation.randomise),s=e.maxAge?{value:e.maxAge.value,spread:e.maxAge.spread}:{},o=e.position?{value:e.position.value,spread:e.position.spread,spreadClamp:e.position.spreadClamp,radius:e.position.radius,radiusScale:e.position.radiusScale,distribution:e.position.distribution,randomise:t}:{},l=e.velocity?{value:e.velocity.value,spread:e.velocity.spread,distribution:e.velocity.distribution,randomise:e.velocity.randomise}:{},u=u?{value:e.acceleration.value,spread:e.acceleration.spread,distribution:e.acceleration.distribution,randomise:r}:{},c=e.drag?{value:e.drag.value,spread:e.drag.spread}:{},h=e.wiggle?{value:e.wiggle.value,spread:e.wiggle.spread}:{},d=e.rotation?{axis:e.rotation.axis,axisSpread:e.rotation.axisSpread,angle:e.rotation.angle,angleSpread:e.rotation.angleSpread,static:a,center:e.rotation.center,randomise:p}:{};const f=[],m=[],g=[];if(e.colors&&e.colors.length>0)for(let t=0,r=e.colors.length;t<r;t++)f.push(e.colors[t].value),m.push(e.colors[t].spread),"true"==e.colors[t].randomise.valueOf()?g.push(!0):g.push(!1);else f.push([1,1,1]),m.push([0,0,0]),g.push(!1);let _={value:f,spread:m,randomise:g};const v=[],y=[],x=[];if(e.opacities&&e.opacities.length>0)for(let t=0,r=e.opacities.length;t<r;t++)v.push(e.opacities[t].value),y.push(e.opacities[t].spread),"true"==e.opacities[t].randomise.valueOf()?x.push(!0):x.push(!1);else v.push(1),y.push(0),x.push(!1);let b={value:v,spread:y,randomise:x};const A=[],S=[],E=[];if(e.sizes&&e.sizes.length>0)for(let t=0,r=e.sizes.length;t<r;t++)A.push(e.sizes[t].value),S.push(e.sizes[t].spread),"true"==e.sizes[t].randomise.valueOf()?E.push(!0):E.push(!1);else A.push(1),S.push(0),E.push(!1);let w={value:A,spread:S,randomise:E};const C=[],T=[],D=[];if(e.angles&&e.angles.length>0)for(let t=0,r=e.angles.length;t<r;t++)C.push(e.angles[t].value),T.push(e.angles[t].spread),"true"==e.angles[t].randomise.valueOf()?E.push(!0):D.push(!1);else C.push(0),T.push(0),D.push(!1);let M={value:C,spread:T,randomise:D};n={type:e.distribution,particleCount:e.particleCount,duration:e.duration<=0?void 0:e.duration,isStatic:i,isLookAtCamera:"true"==e.isLookAtCamera,isLookAtCameraOnlyY:"true"==e.isLookAtCameraOnlyY,activeMultiplier:e.activeMultiplier,direction:e.direction,maxAge:s,position:o,radius:{value:5,spread:0,scale:[1,1,1],spreadClamp:[2,2,2]},velocity:l,acceleration:u,drag:c,wiggle:h,rotation:d,color:_,opacity:b,size:w,angle:M}}else{const r=[e.position.vec3Value.x,e.position.vec3Value.y,e.position.vec3Value.z],i=[e.position.vec3Spread.x,e.position.vec3Spread.y,e.position.vec3Spread.z],a=[e.position.vec3SpreadClamp.x,e.position.vec3SpreadClamp.y,e.position.vec3SpreadClamp.z];let s=!1;s="true"==e.position.strIsRandomise.valueOf();const o=[e.velocity.vec3Value.x,e.velocity.vec3Value.y,e.velocity.vec3Value.z],l=[e.velocity.vec3Spread.x,e.velocity.vec3Spread.y,e.velocity.vec3Spread.z],u=[e.acceleration.vec3Value.x,e.acceleration.vec3Value.y,e.acceleration.vec3Value.z],c=[e.acceleration.vec3Spread.x,e.acceleration.vec3Spread.y,e.acceleration.vec3Spread.z];let h=!1;h="true"==e.acceleration.strIsRandomise.valueOf();let d=!1;d="true"==e.strIsStatic.valueOf();const p=[e.rotation.vec3Axis.x,e.rotation.vec3Axis.y,e.rotation.vec3Axis.z],f=[e.rotation.vec3AxisSpread.x,e.rotation.vec3AxisSpread.y,e.rotation.vec3AxisSpread.z],m=[e.rotation.vec3Center.x,e.rotation.vec3Center.y,e.rotation.vec3Center.z];let g=!1;g="true"==e.rotation.strIsStatic.valueOf();let _=!1;_="true"==e.rotation.strIsRandomise.valueOf();const v=[],y=[],x=[];if(e.listColor.length>0)for(let t=0,r=e.listColor.length;t<r;t++)v.push([e.listColor[t].vec3Value.x,e.listColor[t].vec3Value.y,e.listColor[t].vec3Value.z]),y.push([e.listColor[t].vec3Spread.x,e.listColor[t].vec3Spread.y,e.listColor[t].vec3Spread.z]),"true"==e.listColor[t].strIsRandomise.valueOf()?x.push(!0):x.push(!1);else v.push([1,1,1]),y.push([0,0,0]),x.push(!1);const b=[],A=[],S=[];if(e.listOpacity.length>0)for(let t=0,r=e.listOpacity.length;t<r;t++)b.push(e.listOpacity[t].fValue),A.push(e.listOpacity[t].fSpread),"true"==e.listOpacity[t].strIsRandomise.valueOf()?S.push(!0):S.push(!1);else b.push(1),A.push(0),S.push(!1);const E=[],w=[],C=[];if(e.listSize.length>0)for(let t=0,r=e.listSize.length;t<r;t++)E.push(e.listSize[t].fValue),w.push(e.listSize[t].fSpread),"true"==e.listSize[t].strIsRandomise.valueOf()?C.push(!0):C.push(!1);else E.push(1),w.push(0),C.push(!1);const T=[],D=[],M=[];if(e.listAngle.length>0)for(let t=0,r=e.listAngle.length;t<r;t++)T.push(e.listAngle[t].fValue),D.push(e.listAngle[t].fSpread),"true"==e.listAngle[t].strIsRandomise.valueOf()?C.push(!0):M.push(!1);else T.push(0),D.push(0),M.push(!1);n={type:e.iDistribution,particleCount:e.iParticleCount,duration:e.fDuration<=0?void 0:e.fDuration,isStatic:d,isLookAtCamera:"true"==e.strIsLookAtCamera,isLookAtCameraOnlyY:"true"==e.strIsLookAtCameraOnlyY,activeMultiplier:e.fActiveMultiplier,direction:e.iDirection,maxAge:{value:e.maxAge.fValue,spread:e.maxAge.fSpread},position:{value:r,spread:i,spreadClamp:a,radius:e.position.fRadius,radiusScale:[1,1,1],distribution:e.position.iDistribution,randomise:s},radius:{value:5,spread:0,scale:[1,1,1],spreadClamp:[2,2,2]},velocity:{value:o,spread:l,distribution:e.velocity.iDistribution,randomise:!1},acceleration:{value:u,spread:c,distribution:e.acceleration.iDistribution,randomise:h},drag:{value:e.drag.fValue,spread:e.drag.fSpread},wiggle:{value:e.wiggle.fValue,spread:e.wiggle.fSpread},rotation:{axis:p,axisSpread:f,angle:e.rotation.fAngle,angleSpread:e.rotation.fAngleSpread,static:g,center:m,randomise:_},color:{value:v,spread:y,randomise:x},opacity:{value:b,spread:A,randomise:S},size:{value:E,spread:w,randomise:C},angle:{value:T,spread:D,randomise:M}};t.maxVaryings>=8&&(n.trail={value:e.trail.fValue,spread:e.trail.fSpread,step:e.trail.fStep,stepSpread:e.trail.fStepSpread})}return n}$setupParticleEmitters(e,t,r,n){const i=this.$parseEmitterOptions(t,r,n);r.maxVaryings<8&&delete t.trail;const a=new Ww({emitterOptions:i,useMesh:e._useMesh,group:e});e._emitters.push(a),e._group.addEmitter(a._emitter)}$setupParticleGroups(e,t,r){const n=new aC({groupOptions:e,useMesh:e.useMesh,parent:this});e.listEmitters.forEach((e=>{this.$setupParticleEmitters(n,e,t,r);const i=n._group.mesh;i&&(i.userData.isParticleMesh=!0,this.$node.add(i),i.frustumCulled=!1)})),this.$groups.push(n)}setup(e){this.rootPath=e.url||"";const t=e.data,r=e.options,n=!(!t.version||2!=t.version[0]),i=t;if(n)for(let e=0,t=i.groups.length;e<t;e++){const t=i.groups[e],a=this.$parseGroupOptions(t,null,r,n);if(a.arrayMeshParams=t.meshParams,this.$setupParticleGroups(a,r,n),this.$groups[e]&&t.texture.url.trim().length){a.texture.url=t.texture.url;const r=this.$getTextureURL(this.rootPath,t.texture.url);this.$groups[e].setAttribute("Url",r)}}else for(let e=0,t=i.listGroups.length;e<t;e++){const t=i.listGroups[e],a=this.$parseGroupOptions(t,null,r,n);if(a.arrayMeshParams=t.arrayMeshParams,this.$setupParticleGroups(a,r,n),this.$groups[e]&&t.texture.url.trim().length){a.texture.url=t.texture.url;const r=this.$getTextureURL(this.rootPath,t.texture.url);this.$groups[e].setAttribute("Url",r)}}}update(e,t){this.$groups.forEach((r=>{r._group.tick(e,t.$node)}))}dispose(){super.dispose();const e=this.$groups;for(let t=0,r=e.length;t<r;t++)e[t].dispose()}addGroup(e){if(e instanceof aC){e.getParent()||e.setParent(this);const t=e._group.mesh;t&&(t.userData.isParticleMesh=!0,this.$node.add(t),t.frustumCulled=!1),this.$groups.push(e)}}removeGroup(e){if(e instanceof aC){const t=this.$groups.findIndex((t=>t===e));-1!==t&&(this.$groups.splice(t,1),this.$node.remove(e._group.mesh))}}getGroups(){return this.$groups}$getEmitterOptions(e,t){const r=[];if(t)for(let t=0,n=e.length;t<n;t++){const n=e[t]._emitter,i=[];for(let r=0,n=e[t]._emitterOptions.size.value.length;r<n;r++){const n={randomise:e[t]._emitterOptions.size.randomise[r]?"true":"false",spread:e[t]._emitterOptions.size.spread[r],value:e[t]._emitterOptions.size.value[r]};i.push(n)}const a=[];for(let r=0,n=e[t]._emitterOptions.angle.value.length;r<n;r++){const n={randomise:e[t]._emitterOptions.angle.randomise[r]?"true":"false",spread:e[t]._emitterOptions.angle.spread[r],value:e[t]._emitterOptions.angle.value[r]};a.push(n)}const s=[];for(let r=0,n=e[t]._emitterOptions.color.value.length;r<n;r++){const n={randomise:e[t]._emitterOptions.color.randomise[r]?"true":"false",value:[e[t]._emitterOptions.color.value[r].r,e[t]._emitterOptions.color.value[r].g,e[t]._emitterOptions.color.value[r].b],spread:[e[t]._emitterOptions.color.spread[r].x,e[t]._emitterOptions.color.spread[r].y,e[t]._emitterOptions.color.spread[r].z]};s.push(n)}const o=[];for(let r=0,n=e[t]._emitterOptions.opacity.value.length;r<n;r++){const n={randomise:e[t]._emitterOptions.opacity.randomise[r]?"true":"false",spread:e[t]._emitterOptions.opacity.spread[r],value:e[t]._emitterOptions.opacity.value[r]};o.push(n)}const l={isLookAtCameraOnlyY:n.isLookAtCameraOnlyY?"true":"false",wiggle:{spread:n.wiggle.spread,value:n.wiggle.value},direction:n.type,rotation:{axisSpread:[n.rotation.axisSpread.x,n.rotation.axisSpread.y,n.rotation.axisSpread.z],randomise:n.rotation.randomise?"true":"false",angleSpread:n.rotation.angleSpread,center:[n.rotation.center.x,n.rotation.center.y,n.rotation.center.z],angle:n.rotation.angle,static:n.rotation.static?"true":"false",axis:[n.rotation.axis.x,n.rotation.axis.y,n.rotation.axis.z]},activeMultiplier:n.activeMultiplier,velocity:{randomise:n.velocity.randomise?"true":"false",value:[n.velocity.value.x,n.velocity.value.y,n.velocity.value.z],distribution:n.velocity.distribution,spread:[n.velocity.spread.x,n.velocity.spread.y,n.velocity.spread.z]},sizes:i,acceleration:{randomise:n.acceleration.randomise?"true":"false",value:[n.acceleration.value.x,n.acceleration.value.y,n.acceleration.value.z],distribution:n.acceleration.distribution,spread:[n.acceleration.spread.x,n.acceleration.spread.y,n.acceleration.spread.z]},maxAge:{spread:n.maxAge.spread,value:n.maxAge.value},angles:a,duration:n.duration?n.duration:-1,colors:s,isStatic:n.isStatic?"true":"false",position:{randomise:n.position.randomise?"true":"false",radius:n.position.radius,spreadClamp:[n.position.spreadClamp.x,n.position.spreadClamp.y,n.position.spreadClamp.z],value:[n.position.value.x,n.position.value.y,n.position.value.z],radiusScale:[n.position.radiusScale.x,n.position.radiusScale.y,n.position.radiusScale.z],distribution:n.position.distribution,spread:[n.position.spread.x,n.position.spread.y,n.position.spread.z]},drag:{randomise:n.drag.randomise?"true":"false",spread:n.drag.spread,value:n.drag.value},distribution:n.type,particleCount:n.particleCount,opacities:o,isLookAtCamera:n.isLookAtCamera?"true":"false"};r.push(l)}else for(let t=0,n=e.length;t<n;t++){const n=e[t]._emitter,i=[];for(let r=0,n=e[t]._emitterOptions.size.value.length;r<n;r++){const n={strIsRandomise:e[t]._emitterOptions.size.randomise[r]?"true":"false",fSpread:e[t]._emitterOptions.size.spread[r],fValue:e[t]._emitterOptions.size.value[r]};i.push(n)}const a=[];for(let r=0,n=e[t]._emitterOptions.angle.value.length;r<n;r++){const n={strIsRandomise:e[t]._emitterOptions.angle.randomise[r]?"true":"false",fSpread:e[t]._emitterOptions.angle.spread[r],fValue:e[t]._emitterOptions.angle.value[r]};a.push(n)}const s=[];for(let r=0,n=e[t]._emitterOptions.color.value.length;r<n;r++){const n={strIsRandomise:e[t]._emitterOptions.color.randomise[r]?"true":"false",vec3Value:{x:e[t]._emitterOptions.color.value[r].r,y:e[t]._emitterOptions.color.value[r].g,z:e[t]._emitterOptions.color.value[r].b},vec3Spread:{x:e[t]._emitterOptions.color.spread[r].x,y:e[t]._emitterOptions.color.spread[r].y,z:e[t]._emitterOptions.color.spread[r].z}};s.push(n)}const o=[];for(let r=0,n=e[t]._emitterOptions.opacity.value.length;r<n;r++){const n={strIsRandomise:e[t]._emitterOptions.opacity.randomise[r]?"true":"false",fSpread:e[t]._emitterOptions.opacity.spread[r],fValue:e[t]._emitterOptions.opacity.value[r]};o.push(n)}const l={wiggle:{fSpread:n.wiggle.spread,fValue:n.wiggle.value},strId:THING.T3D.generateUUID(),iDirection:n.type,rotation:{vec3AxisSpread:{x:n.rotation.axisSpread.x,y:n.rotation.axisSpread.y,z:n.rotation.axisSpread.z},strIsRandomise:n.rotation.randomise?"true":"false",fAngleSpread:n.rotation.angleSpread,vec3Center:{x:n.rotation.center.x,y:n.rotation.center.y,z:n.rotation.center.z},fAngle:n.rotation.angle,strIsStatic:n.rotation.static?"true":"false",vec3Axis:{x:n.rotation.axis.x,y:n.rotation.axis.y,z:n.rotation.axis.z}},fActiveMultiplier:n.activeMultiplier,velocity:{strIsRandomise:n.velocity.randomise?"true":"false",vec3Value:{x:n.velocity.value.x,y:n.velocity.value.y,z:n.velocity.value.z},iDistribution:n.velocity.distribution,vec3Spread:{x:n.velocity.spread.x,y:n.velocity.spread.y,z:n.velocity.spread.z}},listSize:i,acceleration:{strIsRandomise:n.acceleration.randomise?"true":"false",vec3Value:{x:n.acceleration.value.x,y:n.acceleration.value.y,z:n.acceleration.value.z},iDistribution:n.acceleration.distribution,vec3Spread:{x:n.acceleration.spread.x,y:n.acceleration.spread.y,z:n.acceleration.spread.z}},trail:{fSpread:0,fStep:0,fStepSpread:0,fValue:0},maxAge:{fSpread:n.maxAge.spread,fValue:n.maxAge.value},listAngle:a,fDuration:n.duration?n.duration:-1,listColor:s,strIsStatic:n.isStatic?"true":"false",position:{strIsRandomise:n.position.randomise?"true":"false",fRadius:n.position.radius,vec3SpreadClamp:{x:n.position.spreadClamp.x,y:n.position.spreadClamp.y,z:n.position.spreadClamp.z},vec3Value:{x:n.position.value.x,y:n.position.value.y,z:n.position.value.z},vec3RadiusScale:{x:n.position.radiusScale.x,y:n.position.radiusScale.y,z:n.position.radiusScale.z},iDistribution:n.position.distribution,vec3Spread:{x:n.position.spread.x,y:n.position.spread.y,z:n.position.spread.z}},drag:{strIsRandomise:n.drag.randomise?"true":"false",fSpread:n.drag.spread,fValue:n.drag.value},iDistribution:n.type,iParticleCount:n.particleCount,listOpacity:o};r.push(l)}return r}$getGroupOptions(e,t){const r=this.$getEmitterOptions(e._emitters,t);let n;return n=t?{maxParticleCount:e._groupOptions.maxParticleCount,texture:{url:e._groupOptions.texture&&e._groupOptions.texture.url?e._groupOptions.texture.url:" "},depthWrite:e._groupOptions.depthWrite?"true":"false",scale:e._groupOptions.scale,useMesh:e._groupOptions.useMesh?"true":"false",hasPerspective:e._groupOptions.hasPerspective?"true":"false",isColorize:e._groupOptions.colorize?"true":"false",blendingMode:e._groupOptions.blending,transparent:e._groupOptions.transparent?"true":"false",meshType:e._groupOptions.meshUrl,fixedTimeStep:e._groupOptions.fixedTimeStep,alphaTest:e._groupOptions.alphaTest,depthTest:e._groupOptions.depthTest?"true":"false",emitters:r,fog:e._groupOptions.fog?"true":"false",meshParams:e._groupOptions.arrayMeshParams}:{iMaxParticleCount:e._groupOptions.maxParticleCount,strId:THING.T3D.generateUUID(),texture:{iLoop:e._groupOptions.texture&&e._groupOptions.texture.loop,name:" ",vec2Frames:{x:e._groupOptions.texture.frames&&e._groupOptions.texture.frames.x,y:e._groupOptions.texture.frames&&e._groupOptions.texture.frames.y},iFrameCount:e._groupOptions.texture&&e._groupOptions.texture.frameCount,url:e._groupOptions.texture&&e._groupOptions.texture.url?e._groupOptions.texture.url:" "},strIsDepthWrite:e._groupOptions.depthWrite?"true":"false",fScale:e._groupOptions.scale,strUseMesh:e._groupOptions.useMesh?"true":"false",strHasPerspective:e._groupOptions.hasPerspective?"true":"false",strIsColorize:e._groupOptions.colorize?"true":"false",iBlendingMode:e._groupOptions.blending,strEnableTrail:!1,strIsTransparent:e._groupOptions.transparent?"true":"false",vec4Quaternion:{w:e._groupOptions.vec4Quaternion.w,x:e._groupOptions.vec4Quaternion.x,y:e._groupOptions.vec4Quaternion.y,z:e._groupOptions.vec4Quaternion.z},arrayMeshParams:e._groupOptions.arrayMeshParams,strMeshUrl:e._groupOptions.meshUrl,fFixedTimeStep:e._groupOptions.fixedTimeStep,fAlphaTest:e._groupOptions.alphaTest,strIsDepthTest:e._groupOptions.depthTest?"true":"false",listEmitters:r,strIsFog:e._groupOptions.fog?"true":"false"},n}getParticleData(e){const t=e&&e.dataVersion2||!1;let r,n,i=[];for(let e=0,t=this.$groups.length;e<t;e++)this.$groups[e]._groupOptions.texture.value&&this.$groups[e]._groupOptions.texture.value instanceof THING.T3D.Texture2D&&i.push({index:e,value:this.$groups[e]._groupOptions.texture.value});if(e&&e.callback){r=callback(i);for(let e=0,t=r.length;e<t;e++)this.$groups[r[e].index]._groupOptions.texture.url=r[e].url}n=t?{version:"2.0.1",groups:[]}:{strId:THING.T3D.generateUUID(),listGroups:[],_attr:"ParticleData",fPPAfterImageValue:0};for(let e=0,r=this.$groups.length;e<r;e++){const r=this.$groups[e],i=this.$getGroupOptions(r,t);t?n.groups.push(i):n.listGroups.push(i)}return n}setRootPath(e){this.rootPath=e}getRootPath(){return this.rootPath}}let oC=class extends QE{constructor(e,t){super(e,t),this._node.castShadow=!1,this._node.receiveShadow=!1,this._points=[]}setPoints(e){this._points=e}getPoints(e){return this._points}dispose(){super.dispose(),this._points=[]}copy(e){return super.copy(e,!1),this._points=e._points.map((e=>e.clone())),this}};const lC="Tile",uC="Stretch";let cC=class extends oC{constructor(e,t){super(e,t),this._dynamic=!1,this._uvMode=lC,this._groups=[],this._groupIds=[],this._autoUpdate=!0}setDynamic(e){this._dynamic=e}getDynamic(){return this._dynamic}setUVMode(e){this._uvMode!==e&&(this._uvMode=e,this._changeUVMode())}getUVMode(){return this._uvMode}_changeUVMode(){}setPoints(e){super.setPoints(e),this._autoUpdate&&this._updateGeometry()}setGroups(e){this._groups=e.map((e=>e.slice(0))),this._autoUpdate&&this._updateGeometry()}getGroups(e){return e.length=0,this._groups.forEach((t=>{e.push(t.slice(0))})),e}setGroupPickedIds(e){this._groupIds=e.slice(0),this._autoUpdate&&this._updateGeometry()}getGroupPickedIds(e){return e.length=0,this._groupIds.forEach((t=>{e.push(t)})),e}begin(){this._autoUpdate=!1}end(){this._updateGeometry(),this._autoUpdate=!0}_updateGeometry(){}};function hC(e,t){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}const dC=new T_;class pC extends cC{constructor(e,t){const r=new ap(new _p,t?t.$getMaterial():dC);super(e,r),r.material.drawMode=Kc.LINE_STRIP,r._lineDrawMode_=Kc.LINE_STRIP,r.geometry.addAttribute("a_Position",new up(new cp(new Float32Array,3))),r.castShadow=!0,r.receiveShadow=!0,r.onBeforeRender=function(e,t){e.object._lineDrawMode_&&(t.drawMode=e.object._lineDrawMode_)},this.$markChildrenMatrixAutoUpdate(!1),this._mesh=r,this._autoClose=!1,this._uvAttribute=null}getType(){return"PixelLine"}setPoints(e){super.setPoints(e),this._autoUpdate&&this._updateGeometry()}setAttribute(e,t){if("Closure"===e){if(this._autoClose===t)return;this._autoClose=t,this._autoUpdate&&this._updateGeometry()}super.setAttribute(e,t)}getAttribute(e){if("Closure"===e)return this._autoClose;return super.getAttribute(e)}dispose(){super.dispose(),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null}copy(e){return super.copy(e),this._updateGeometry(),this}_updateGeometry(){const e=this._points,t=this._groups,r=t.length>0;let n=this._groupIds.length>0;n&&this._groupIds.length!==t.length&&(console.warn("Set group ids failed: groudIds.length = "+this._groupIds.length+" group.length = "+t.length),n=!1),this._mesh.geometry.dispose();const i=new _p,a=[],s=[],o=[],l=[],u=[];let c;if(r)c=t.map((t=>{const r=e.slice(t[0],t[0]+t[1]);return this._autoClose&&r.length>1&&!hC(r[r.length-1],r[0])&&r.push(r[0]),r}));else if(this._autoClose&&e.length>1&&!hC(e[e.length-1],e[0])){const t=e.slice(0);t.push(t[0]),c=[t]}else c=[e];let h=0;c.forEach(((e,t)=>{const i=[];let c=0;e.forEach(((s,o)=>{var d,p,f,m,g;a.push(s[0],s[1],s[2]),n&&l.push(this._groupIds[t]),0!==o&&(c+=(d=s,p=e[o-1],f=d[0]-p[0],m=d[1]-p[1],g=d[2]-p[2],Math.sqrt(f*f+m*m+g*g))),i.push(c),0!==o&&r&&u.push(h+o-1,h+o)})),i.forEach((e=>{s.push(e,.5),o.push(c>0?e/c:0,.5)})),h+=e.length})),this._uvAttribute=new up(new cp(new Float32Array(o),2)),i.addAttribute("a_Position",new up(new cp(new Float32Array(a),3))),i.addAttribute("a_Uv",new up(new cp(new Float32Array(s),2))),i.addAttribute("a_Uv2",this._uvAttribute),n&&(i.addAttribute("ids",new up(new cp(new Float32Array(l),1))),i.__pickIds=this._groupIds.slice(0)),r?(i.setIndex(new up(new cp(a.length/3>65536?new Uint32Array(u):new Uint16Array(u),1))),this._mesh.isLineSegments=!0,this._mesh.material.drawMode=Kc.LINES,this._mesh._lineDrawMode_=Kc.LINES,this._mesh.raycast=function(){}):(this._mesh.material.drawMode=Kc.LINE_STRIP,this._mesh._lineDrawMode_=Kc.LINE_STRIP,delete this._mesh.isLineSegments,delete this._mesh.raycast),this._mesh.geometry=i,this._uvMode===uC&&this._changeUVMode(),this._mesh.geometry.computeBoundingBox(),this._mesh.geometry.computeBoundingSphere(),this.$boundingBox.selfBoundingBoxNeedsUpdate=!0}_changeUVMode(){if(!this._uvAttribute)return;const e=this._mesh.geometry,t=e.getAttribute("a_Uv");e.addAttribute("a_Uv",this._uvAttribute),this._uvAttribute=t,e.version++}}const fC=[-1,1,0,1,1,0,-1,-1,0,1,-1,0],mC=[0,1,1,1,0,0,1,0],gC=[0,2,1,2,3,1],_C=new bc,vC=new bc;class yC extends _p{constructor(){super(),this.setIndex(new up(new cp(new Uint16Array(gC),1))),this.addAttribute("a_Position",new up(new cp(new Float32Array(fC),3))),this.addAttribute("a_Uv",new up(new cp(new Float32Array(mC),2)))}setFromPoints(e,t=[]){const r=[],n=e.length,i=e[0]&&void 0!==e[0].x;let a=0,s=0;e.forEach(((o,l)=>{let u=i?o:_C.fromArray(o);if(l>0){let t=i?e[l-1]:vC.fromArray(e[l-1]);a+=u.distanceTo(t)}let c=0;t[s]===l?(c=1,s++,a=0):t[s]===l+1&&(c=1),r.push(u.x,u.y,u.z,a,a,c),0!==l&&l!==n-1||r.push(u.x,u.y,u.z,a,a,c)}));const o=new cp(new Float32Array(r),6);let l;return o.count=Math.max(0,o.count-3),l=new up(o,3,0),l.divisor=1,this.addAttribute("instancePrev2",l),l=new up(o,3,6),l.divisor=1,this.addAttribute("instancePrev1",l),l=new up(o,3,12),l.divisor=1,this.addAttribute("instanceNext1",l),l=new up(o,3,18),l.divisor=1,this.addAttribute("instanceNext2",l),l=new up(o,1,9),l.divisor=1,this.addAttribute("instancePrevDist",l),l=new up(o,1,15),l.divisor=1,this.addAttribute("instanceNextDist",l),l=new up(o,1,10),l.divisor=1,this.addAttribute("instancePrevDist2",l),l=new up(o,1,16),l.divisor=1,this.addAttribute("instanceNextDist2",l),l=new up(o,1,11),l.divisor=1,this.addAttribute("instancePrevBreak",l),l=new up(o,1,17),l.divisor=1,this.addAttribute("instanceNextBreak",l),this.version++,this.instanceCount=o.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}computeBoundingBox(){const e=this.attributes.instancePrev1;void 0!==e&&e.buffer.count>0?function(e,t){let r=1/0,n=1/0,i=1/0,a=-1/0,s=-1/0,o=-1/0;for(let e=0,l=t.count+2;e<l;e++){const l=t.array[e*t.stride+0],u=t.array[e*t.stride+1],c=t.array[e*t.stride+2];l<r&&(r=l),u<n&&(n=u),c<i&&(i=c),l>a&&(a=l),u>s&&(s=u),c>o&&(o=c)}e.min.set(r,n,i),e.max.set(a,s,o)}(this.boundingBox,e.buffer):this.boundingBox.makeEmpty()}computeBoundingSphere(){this.computeBoundingBox();const e=this.attributes.instancePrev1;if(void 0!==e&&e.buffer.count>0){const t=this.boundingSphere.center;this.boundingBox.getCenter(t);let r=0;for(let n=0,i=e.buffer.count+2;n<i;n++)_C.fromArray(e.buffer.array,n*e.buffer.stride),r=Math.max(r,t.distanceToSquared(_C));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("InstancedLineGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}else this.boundingSphere.makeEmpty()}}const xC={name:"instanced_line",defines:{DISABLE_CORNER_BROKEN:!1,FLAT_W:!1,SWAP_UV:!0,SIMPLE_UV:!1,SCREEN_UV:!1},uniforms:{resolution:[512,512],lineWidth:5,cornerThreshold:.4},vertexShader:"\n        #include <common_vert>\n        #include <logdepthbuf_pars_vert>\n\n        #ifdef USE_GPUPICKER\n\t        #ifdef USE_INSTANCING\n\t\t        attribute float instanceID;\n\t        #endif\n\n\t        #ifdef USE_ATTRIBUTES_ID\n\t\t        attribute float ids;\n\t        #endif\n\n\t        uniform float baseId;\n\t\n\t        varying vec3 vPickColor;\n\n\t        vec3 packPickIdToRGB(float pickId) {\n\t\t        vec3 a = fract(vec3(1.0 / 255.0, 1.0 / (255.0 * 255.0), 1.0 / (255.0 * 255.0 * 255.0)) * pickId);\n\t\t        a -= a.xxy * vec3(0.0, 1.0 / 255.0, 1.0 / 255.0);\n\t\t        return a;\n\t        }\n        #endif\n\n        #ifdef USE_FOG\n            varying float vDepth;\n        #endif\n\n        attribute vec2 a_Uv;\n        #ifdef USE_DIFFUSE_MAP\n            varying vec2 v_Uv;\n            uniform mat3 uvTransform;\n        #endif\n        #include <alphamap_pars_vert>\n\n        attribute vec3 instancePrev2;\n        attribute vec3 instancePrev1;\n        attribute vec3 instanceNext1;\n        attribute vec3 instanceNext2;\n\n        attribute float instancePrevDist;\n        attribute float instanceNextDist;\n\n        attribute float instancePrevDist2;\n        attribute float instanceNextDist2;\n\n        attribute float instancePrevBreak;\n        attribute float instanceNextBreak;\n\n        varying float vDiscard;\n\n        uniform float lineWidth;\n        uniform vec2 resolution;\n\n        uniform float cornerThreshold;\n\n        void trimSegment(const in vec4 start, inout vec4 end) {\n            // trim end segment so it terminates between the camera plane and the near plane\n        \n            // conservative estimate of the near plane\n            float a = u_Projection[2][2]; // 3nd entry in 3th column\n            float b = u_Projection[3][2]; // 3nd entry in 4th column\n            float nearEstimate = -0.5 * b / a;\n        \n            float alpha = (nearEstimate - start.z) / (end.z - start.z);\n        \n            end.xyz = mix(start.xyz, end.xyz, alpha);\n        }\n\n        void main() {\n            vec3 position = a_Position;\n\n            #ifdef USE_GPUPICKER\n\t            #ifdef USE_ATTRIBUTES_ID\n\t\t            vPickColor = packPickIdToRGB(ids);\n\t            #else\n\t\t            #ifdef USE_INSTANCING\n\t\t\t            vPickColor = packPickIdToRGB(instanceID);\n\t\t            #else\n\t\t\t            vPickColor = packPickIdToRGB(baseId);\n\t\t            #endif\n\t            #endif\n            #endif\n\n            mat4 modelViewMatrix = u_View * u_Model;\n\n            float aspect = resolution.x / resolution.y;\n            float flagY = position.y * 0.5 + 0.5;\n\n            // camera space\n            vec4 prev = modelViewMatrix * vec4(mix(instancePrev2, instancePrev1, flagY), 1.0);\n            vec4 curr = modelViewMatrix * vec4(mix(instancePrev1, instanceNext1, flagY), 1.0);\n            vec4 next = modelViewMatrix * vec4(mix(instanceNext1, instanceNext2, flagY), 1.0);\n\n            vDiscard = instancePrevBreak * instanceNextBreak;\n            if (position.y > 0.0 && instanceNextBreak > 0.5) {\n                next = curr;\n            } else if (position.y < 0.0 && instancePrevBreak > 0.5) {\n                prev = curr;\n            }\n               \n            // #endif\n\n            // special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n            bool perspective = (u_Projection[2][3] == -1.0); // 4th entry in the 3rd column\n\n            if (perspective) {\n                if (position.y < 0.) {\n                    if (curr.z < 0.0 && next.z >= 0.0) {\n                        trimSegment(curr, next);\n                    } else if (next.z < 0.0 && curr.z >= 0.0) {\n                        trimSegment(next, curr);\n                    }\n\n                    if (prev.z < 0.0 && curr.z >= 0.0) {\n                        trimSegment(prev, curr);\n                    } else if (curr.z < 0.0 && prev.z >= 0.0) {\n                        trimSegment(curr, prev);\n                    }\n                } else {\n                    if (prev.z < 0.0 && curr.z >= 0.0) {\n                        trimSegment(prev, curr);\n                    } else if (curr.z < 0.0 && prev.z >= 0.0) {\n                        trimSegment(curr, prev);\n                    }\n\n                    if (curr.z < 0.0 && next.z >= 0.0) {\n                        trimSegment(curr, next);\n                    } else if (next.z < 0.0 && curr.z >= 0.0) {\n                        trimSegment(next, curr);\n                    }\n                } \n            }\n\n            // clip space\n            vec4 clipPrev = u_Projection * prev;\n            vec4 clipCurr = u_Projection * curr;\n            vec4 clipNext = u_Projection * next;\n\n            // ndc space\n            vec2 ndcPrev = clipPrev.xy / clipPrev.w;\n            vec2 ndcCurr = clipCurr.xy / clipCurr.w;\n            vec2 ndcNext = clipNext.xy / clipNext.w;\n\n            // direction\n            vec2 dir, dir1, dir2;\n            float w = 1.0;\n\n            if (prev == curr) {\n                dir = ndcNext - ndcCurr;\n                dir.x *= aspect;\n                dir = normalize(dir);\n            } else if(curr == next) {\n                dir = ndcCurr - ndcPrev;\n                dir.x *= aspect;\n                dir = normalize(dir);\n            } else {\n                dir1 = ndcCurr - ndcPrev;\n                dir1.x *= aspect;\n                \n                dir2 = ndcNext - ndcCurr;\n                dir2.x *= aspect;\n\n                dir1 = normalize(dir1);\n                dir2 = normalize(dir2);\n\n                dir = normalize(dir1 + dir2);\n\n                w = dot(dir1, dir);\n\n                #ifdef DISABLE_CORNER_BROKEN  \n                    w = 1.0 / max(w, cornerThreshold);\n                #else\n                    float flagT = step(w, cornerThreshold);\n                    w = 1.0 / mix(w, 1.0, flagT);\n                    dir = mix(dir, mix(dir2, dir1, flagY), flagT);\n                #endif\n            }\n\n            // perpendicular to dir\n            vec2 offset = vec2(dir.y, -dir.x);\n\n            // undo aspect ratio adjustment\n            offset.x /= aspect;\n\n            // sign flip\n            offset *= float(sign(position.x));\n\n            // adjust for lineWidth\n            offset *= lineWidth * w;\n            \n            // adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n            offset /= resolution.y;\n            \n            // select end\n            vec4 clip = clipCurr;\n\n            // back to clip space\n            offset *= clip.w;\n\n            clip.xy += offset;\n\n            gl_Position = clip;\n\n            #ifdef USE_FOG\n                vDepth = -curr.z;\n            #endif\n            \n            #ifdef USE_LOGDEPTHBUF\n                #ifdef USE_LOGDEPTHBUF_EXT\n                    vFragDepth = 1.0 + gl_Position.w - logDepthCameraNear;\n                    // vIsPerspective = float( isPerspectiveMatrix( u_Projection ) );\n                    vIsPerspective = isPerspectiveMatrix( u_Projection ) ? 1.0 : 0.0;\n                #else\n                    if ( isPerspectiveMatrix( u_Projection ) ) {\n                        gl_Position.z = log2( max( EPSILON, gl_Position.w - logDepthCameraNear + 1.0 ) ) * logDepthBufFC - 1.0;\n                        gl_Position.z *= gl_Position.w;\n                    }\n                #endif\n            #endif\n\n            #ifdef FLAT_W\n                if (gl_Position.w > -1.0) {\n                    gl_Position.xyz /= gl_Position.w;\n                    gl_Position.w = 1.0;\n                }\n            #endif\n\n            // uv\n            // TODO trim uv\n            vec2 tUv = vec2(0.0, 0.0);\n            vec2 tUv2 = vec2(0.0, 0.0);\n\n            #ifdef SIMPLE_UV\n                tUv = a_Uv;\n            #else\n                #ifdef SCREEN_UV\n                    tUv = a_Uv;\n                #else\n                    #ifdef USE_ALPHA_MAP\n                        #if (USE_ALPHA_MAP == 3)        // whether use uv2?\n                            tUv.x = a_Uv.x;\n                            tUv.y = mix(instancePrevDist, instanceNextDist, flagY);\n\n                            tUv2.x = a_Uv.x;\n                            tUv2.y = mix(instancePrevDist2, instanceNextDist2, flagY);\n                        #else\n                            tUv.x = a_Uv.x;\n                            tUv.y = mix(instancePrevDist, instanceNextDist, flagY);\n                        #endif\n                    #else\n                        tUv.x = a_Uv.x;\n                        tUv.y = mix(instancePrevDist, instanceNextDist, flagY);\n                    #endif\n                #endif\n            #endif\n\n            #ifdef SWAP_UV\n                tUv = tUv.yx;\n                tUv2 = tUv2.yx;\n            #endif\n\n            #ifdef USE_DIFFUSE_MAP\n                v_Uv = (uvTransform * vec3(tUv, 1.)).xy;\n            #endif\n            #ifdef USE_ALPHA_MAP\n                #if (USE_ALPHA_MAP == 3)\n                    vAlphaMapUV = (alphaMapUVTransform * vec3(tUv2, 1.)).xy;\n                #else\n                    vAlphaMapUV = (alphaMapUVTransform * vec3(tUv, 1.)).xy;\n                #endif\n            #endif\n        }\n    ",fragmentShader:"\n        #include <common_frag>\n\n        #ifdef USE_DIFFUSE_MAP\n            varying vec2 v_Uv;\n            uniform sampler2D diffuseMap;\n        #endif\n        #include <alphamap_pars_frag>\n\n        #ifdef USE_FOG\n            varying float vDepth;\n        #endif\n\n        #include <fog_pars_frag>\n        #include <logdepthbuf_pars_frag>\n\n        #ifdef USE_GPUPICKER\n\t        varying vec3 vPickColor;\n        #endif\n\n        varying float vDiscard;\n\n        void main() {\n            if (vDiscard > 0.5) {\n                discard;\n            }\n                \n            vec4 outColor = vec4(u_Color, u_Opacity);\n\n            #ifdef USE_DIFFUSE_MAP\n                outColor *= texture2D(diffuseMap, v_Uv);\n            #endif\n        \n            #ifdef USE_ALPHA_MAP\n                outColor.a *= texture2D(alphaMap, vAlphaMapUV).g;\n            #endif\n        \n            gl_FragColor = outColor;\n        \n            #ifdef USE_FOG\n                float depth = vDepth;\n                #ifdef USE_EXP2_FOG\n                    float fogFactor = whiteCompliment( exp2( - u_FogDensity * u_FogDensity * depth * depth * LOG2 ) );\n                #else\n                    float fogFactor = smoothstep( u_FogNear, u_FogFar, depth );\n                #endif\n                gl_FragColor.rgb = mix( gl_FragColor.rgb, u_FogColor, fogFactor );\n            #endif\n            #include <logdepthbuf_frag>\n\n            #ifdef USE_GPUPICKER\n\t            gl_FragColor = vec4(vPickColor, 1.);\n            #endif\n        }\n    "};class bC extends bp{constructor(){super(xC),this._wireframe=!1}set wireframe(e){e!==this._wireframe&&(this._wireframe=e,this.drawMode=e?Kc.LINES:Kc.TRIANGLES)}get wireframe(){return this._wireframe}copy(e){return super.copy(e),this.wireframe=e.wireframe,this}}const AC=new bC;class SC extends ap{constructor(e){super(new yC,e?e.$getMaterial():AC)}raycast(){}}SC.prototype.isInstancedLine=!0;class EC extends cC{constructor(e,t){const r=new SC(t);super(e,r),r.castShadow=!1,r.receiveShadow=!1;const n=this;r.onBeforeRender=function(t,r){r.uniforms.lineWidth=n._width,r.uniforms.cornerThreshold=n._cornerThreshold,r.uniforms.resolution=e.$resolution.toArray()},this.$markChildrenMatrixAutoUpdate(!1),this._mesh=r,this._width=1,this._cornerThreshold=.4}getType(){return"FatLine"}setWidth(e){this._width=e}getWidth(){return this._width}setCornerThreshold(e){this._cornerThreshold=e}getCornerThreshold(){return this._cornerThreshold}dispose(){super.dispose(),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,this._binding=null}copy(e){return super.copy(e),this._updateGeometry(),this}_changeUvModeDist(e,t,r,n){const i=this._mesh.geometry.getAttribute(r).buffer.array,a=i.length;let s=0;e&&t.forEach((e=>{const t=i[6*e+n];if(0!==t){let r;for(r=s;r<=6*e;r+=6)i[r+n]/=t;s=r+6}}));const o=i[a-6+n];if(0!==o)for(let e=s;e<a;e+=6)i[e+n]/=o}_updateGeometry(){this._mesh.geometry.dispose(),delete this._mesh.geometry.__pickIds,this._mesh.geometry.removeAttribute("ids");const e=this._groups,t=e.length>0,r=[];if(t){let t=0;const n=e.map(((n,i)=>{const a=n[0]+n[1],s=this._points.slice(n[0],a);var o,l;return 2===s.length&&(s[2]=s[1],s[1]=(o=function(e,t){const r=[];return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}(s[0],s[2]),l=.5,o[0]*=l,o[1]*=l,o[2]*=l,o)),t+=s.length,i!==e.length-1&&r.push(t),s}));let i=[];if(n.forEach((e=>{i.push(...e)})),this._mesh.geometry.setFromPoints(i,r),this._groupIds.length>0)if(this._groupIds.length===e.length){const e=[];let t;n.forEach(((r,n)=>{t=this._groupIds[n];for(let n=0;n<r.length;n++)e.push(t)}));const r=new up(new cp(new Float32Array(e),1));r.divisor=1,this._mesh.geometry.addAttribute("ids",r),this._mesh.geometry.__pickIds=this._groupIds.slice(0)}else console.warn("Set group ids failed: groudIds.length = "+this._groupIds.length+" group.length = "+e.length)}else this._mesh.geometry.setFromPoints(this._points);this._changeUvModeDist(t,r,"instancePrevDist2",4),this._uvMode===uC&&this._changeUvModeDist(t,r,"instancePrevDist",3),this._mesh.geometry.computeBoundingBox(),this._mesh.geometry.computeBoundingSphere(),this.$boundingBox.selfBoundingBoxNeedsUpdate=!0}_changeUVMode(){this._autoUpdate&&this._updateGeometry()}setCastShadow(e){}getCastShadow(){return!1}setReceiveShadow(e){}getReceiveShadow(){return!1}}let wC=class{constructor(){this.arcLengthDivisions=200,this.cacheArcLengths=null,this.needsUpdate=!0}getPoint(){return console.warn("t3d.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,n=this.getPoint(0),i=0;t.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),i+=r.distanceTo(n),t.push(i),n=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let n=0;const i=r.length;let a;a=t||e*r[i-1];let s,o=0,l=i-1;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),s=r[n]-a,s<0)o=n+1;else{if(!(s>0)){l=n;break}l=n-1}if(n=l,r[n]===a)return n/(i-1);const u=r[n];return(n+(a-u)/(r[n+1]-u))/(i-1)}};(class extends wC{constructor(e=new xh,t=new xh){super(),this.v1=e,this.v2=t}getPoint(e,t=new xh){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}}).prototype.isLineCurve2=!0;let CC=class extends wC{constructor(e=new bc,t=new bc){super(),this.v1=e,this.v2=t}getPoint(e,t=new bc){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}};CC.prototype.isLineCurve3=!0;let TC=class{static hilbert2D(e=new bc(0,0,0),t=10,r=1,n=0,i=1,a=2,s=3){const o=t/2,l=[new bc(e.x-o,e.y,e.z-o),new bc(e.x-o,e.y,e.z+o),new bc(e.x+o,e.y,e.z+o),new bc(e.x+o,e.y,e.z-o)],u=[l[n],l[i],l[a],l[s]];if(0<=--r){const e=[];return Array.prototype.push.apply(e,this.hilbert2D(u[0],o,r,n,s,a,i)),Array.prototype.push.apply(e,this.hilbert2D(u[1],o,r,n,i,a,s)),Array.prototype.push.apply(e,this.hilbert2D(u[2],o,r,n,i,a,s)),Array.prototype.push.apply(e,this.hilbert2D(u[3],o,r,a,i,n,s)),e}return u}static hilbert3D(e=new bc(0,0,0),t=10,r=1,n=0,i=1,a=2,s=3,o=4,l=5,u=6,c=7){const h=t/2,d=[new bc(e.x-h,e.y+h,e.z-h),new bc(e.x-h,e.y+h,e.z+h),new bc(e.x-h,e.y-h,e.z+h),new bc(e.x-h,e.y-h,e.z-h),new bc(e.x+h,e.y-h,e.z-h),new bc(e.x+h,e.y-h,e.z+h),new bc(e.x+h,e.y+h,e.z+h),new bc(e.x+h,e.y+h,e.z-h)],p=[d[n],d[i],d[a],d[s],d[o],d[l],d[u],d[c]];if(--r>=0){const e=[];return Array.prototype.push.apply(e,this.hilbert3D(p[0],h,r,n,s,o,c,u,l,a,i)),Array.prototype.push.apply(e,this.hilbert3D(p[1],h,r,n,c,u,i,a,l,o,s)),Array.prototype.push.apply(e,this.hilbert3D(p[2],h,r,n,c,u,i,a,l,o,s)),Array.prototype.push.apply(e,this.hilbert3D(p[3],h,r,a,s,n,i,u,c,o,l)),Array.prototype.push.apply(e,this.hilbert3D(p[4],h,r,a,s,n,i,u,c,o,l)),Array.prototype.push.apply(e,this.hilbert3D(p[5],h,r,o,s,a,l,u,i,n,c)),Array.prototype.push.apply(e,this.hilbert3D(p[6],h,r,o,s,a,l,u,i,n,c)),Array.prototype.push.apply(e,this.hilbert3D(p[7],h,r,u,l,a,i,n,s,o,c)),e}return p}static quadraticBezier(e,t,r,n){return function(e,t){const r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}static cubicBezier(e,t,r,n,i){return function(e,t){const r=1-e;return r*r*r*t}(e,t)+function(e,t){const r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}};(class extends wC{constructor(e=new xh,t=new xh,r=new xh){super(),this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new xh){const r=t,n=this.v0,i=this.v1,a=this.v2;return r.set(TC.quadraticBezier(e,n.x,i.x,a.x),TC.quadraticBezier(e,n.y,i.y,a.y)),r}}).prototype.isQuadraticBezierCurve2=!0;let DC=class extends wC{constructor(e=new bc,t=new bc,r=new bc){super(),this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new bc){const r=t,n=this.v0,i=this.v1,a=this.v2;return r.set(TC.quadraticBezier(e,n.x,i.x,a.x),TC.quadraticBezier(e,n.y,i.y,a.y),TC.quadraticBezier(e,n.z,i.z,a.z)),r}};DC.prototype.isQuadraticBezierCurve3=!0;(class extends wC{constructor(e=new xh,t=new xh,r=new xh,n=new xh){super(),this.v0=e,this.v1=t,this.v2=r,this.v3=n}getPoint(e,t=new xh){const r=t,n=this.v0,i=this.v1,a=this.v2,s=this.v3;return r.set(TC.cubicBezier(e,n.x,i.x,a.x,s.x),TC.cubicBezier(e,n.y,i.y,a.y,s.y)),r}}).prototype.isCubicBezierCurve2=!0;(class extends wC{constructor(e=new bc,t=new bc,r=new bc,n=new bc){super(),this.v0=e,this.v1=t,this.v2=r,this.v3=n}getPoint(e,t=new bc){const r=t,n=this.v0,i=this.v1,a=this.v2,s=this.v3;return r.set(TC.cubicBezier(e,n.x,i.x,a.x,s.x),TC.cubicBezier(e,n.y,i.y,a.y,s.y),TC.cubicBezier(e,n.z,i.z,a.z,s.z)),r}}).prototype.isCubicBezierCurve3=!0;const MC=new bc,PC=new bc,FC=new Sc;let RC=class{constructor(){this.curves=[]}setFromPoints(e,t={}){const r=t.bevelRadius||0,n=t.close||!1;let i=e.length;if(i<2)return void console.warn("CurvePath3.setFromPoints: points length less than 2.");n&&!e[0].equals(e[i-1])&&(e.push((new bc).copy(e[0])),i++);const a=(new bc).copy(e[0]);for(let t=1;t<i;t++){const s=e[t],o=t===i-1;if(r>0&&!(o&&!n)){const n=o?e[1]:e[t+1],i=MC.subVectors(s,a),l=PC.subVectors(n,s),u=i.getLength(),c=l.getLength(),h=Math.min(.999999*(1===t?u/2:u),r),d=Math.min(c/2*.999999,r);i.normalize(),l.normalize();const p=new CC;p.v1.copy(a),p.v2.copy(s).sub(i.multiplyScalar(h)),this.curves.push(p);const f=new DC;f.v0.copy(p.v2),f.v1.copy(s),f.v2.copy(s).add(l.multiplyScalar(d)),this.curves.push(f),a.copy(f.v2)}else{const e=new CC;e.v1.copy(a),e.v2.copy(s),this.curves.push(e),a.copy(s)}}n&&this.curves[0].v1.copy(a)}getPoints(e=12){const t=[];for(let r=0,n=this.curves;r<n.length;r++){const i=n[r],a=i.isLineCurve2||i.isLineCurve3?1:e,s=i.getPoints(a);for(let e=0,i=r===n.length-1?s.length:s.length-1;e<i;e++){const r=s[e];t.push(r)}}return t}computeFrames(e={}){const t=e.up,r=void 0!==e.divisions?e.divisions:12,n=void 0===e.frenet||e.frenet,i=void 0===e.fixLine||e.fixLine,a=void 0!==e.close&&e.close,s=[],o=[],l=[],u=[],c=[],h=[],d=[],p=[];let f=0;for(let e=0,t=this.curves;e<t.length;e++){const n=t[e],a=n.isLineCurve2||n.isLineCurve3,o=a?1:r,l=n.getPoints(o),u=e===t.length-1;if(i&&a&&!u){const r=t[e+1];r.isLineCurve2||r.isLineCurve3||(f=1)}for(let e=0,t=u?l.length:l.length-1;e<t;e++){const t=l[e];s.push(t),p.push(f),1===f?f++:2===f&&(f=0)}}if(o[0]=new bc,l[0]=new bc,u[0]=new bc,o[0].subVectors(s[1],s[0]).normalize(),t)l[0].copy(t);else{let e=Number.MAX_VALUE;const t=Math.abs(o[0].x),r=Math.abs(o[0].y),n=Math.abs(o[0].z);t<e&&(e=t,l[0].set(1,0,0)),r<e&&(e=r,l[0].set(0,1,0)),n<e&&l[0].set(0,0,1)}u[0].crossVectors(o[0],l[0]).normalize(),l[0].crossVectors(u[0],o[0]).normalize(),c[0]=0,h[0]=1,d[0]=!1;const m=new bc,g=new bc;for(let e=1;e<s.length-1;e++){const t=new bc,r=new bc,i=new bc;m.subVectors(s[e],s[e-1]),g.subVectors(s[e+1],s[e]);const a=m.getLength();m.normalize(),g.normalize();const f=p[e];if(1===f?t.copy(g):2===f?t.copy(m):t.addVectors(m,g).normalize(),n){r.copy(l[e-1]);const n=i.crossVectors(o[e-1],t);if(n.getLength()>Number.EPSILON){n.normalize();const i=Math.acos(Math.min(Math.max(o[e-1].dot(t),-1),1));r.applyMatrix4(FC.makeRotationAxis(n,i))}i.crossVectors(t,r).normalize()}else r.copy(l[e-1]),1===t.dot(r)?i.crossVectors(g,r).normalize():i.crossVectors(t,r).normalize(),r.crossVectors(i,t).normalize();o[e]=t,l[e]=r,u[e]=i;const _=m.dot(g);c[e]=c[e-1]+a,h[e]=Math.min(1/Math.sqrt((1+_)/2),1.415)||1,d[e]=Math.abs(_-1)>.05}const _=s.length-1,v=new bc,y=new bc,x=new bc;v.subVectors(s[_],s[_-1]);const b=v.getLength();a?v.copy(o[0]):v.normalize(),y.copy(l[_-1]);const A=x.crossVectors(o[_-1],v);if(A.getLength()>Number.EPSILON){A.normalize();const e=Math.acos(Math.min(Math.max(o[_-1].dot(v),-1),1));y.applyMatrix4(FC.makeRotationAxis(A,e))}return x.crossVectors(v,y).normalize(),o[_]=v,l[_]=y,u[_]=x,c[_]=c[_-1]+b,h[_]=1,d[_]=!1,a&&(o[0].copy(v),l[0].copy(y),u[0].copy(x)),{points:s,tangents:o,normals:l,binormals:u,lengths:c,widthScales:h,sharps:d,tangentTypes:p}}};var NC=function(e,t={}){const r=void 0!==t.radius?t.radius:.1,n=Math.max(2,void 0!==t.radialSegments?t.radialSegments:8),i=void 0!==t.startRad?t.startRad:0;var a=[],s=[],o=[],l=[],u=[];const c=e.points.length,h=c-1,d=2*r*Math.PI,p=e.lengths[h],f=new bc,m=new Mc;let g=0;for(let t=0;t<c;t++){const c=e.lengths[t]/d,h=e.lengths[t]/p;for(let u=0;u<=n;u++){let d=u;d==n&&(d=0),f.copy(e.normals[t]),m.setFromAxisAngle(e.tangents[t],i+2*Math.PI*d/n),f.applyQuaternion(m).normalize(),a.push(e.points[t].x+f.x*r*e.widthScales[t],e.points[t].y+f.y*r*e.widthScales[t],e.points[t].z+f.z*r*e.widthScales[t]),s.push(f.x,f.y,f.z),o.push(c,u/n),l.push(h,u/n),g++}if(t>0){const e=g-2*(n+1),t=g-(n+1);for(let r=0;r<n;r++)u.push(t+r,e+r,e+r+1,t+r,e+r+1,t+r+1)}}return{positions:a,normals:s,uvs:o,uvs2:l,indices:u}};const BC=new E_;BC.roughness=.5,BC.metalness=.5,BC.transparent=!0,BC.side=Lc.DOUBLE;class IC extends cC{constructor(e,t){const r=new _p,n=new ap(r,t?t.$getMaterial():BC);super(e,n),n.castShadow=!0,n.receiveShadow=!0,n.geometry.addAttribute("a_Position",new up(new cp(new Float32Array,3))),this.$markChildrenMatrixAutoUpdate(!1),this._mesh=n,this._curvePath3Lists=[],this._autoClose=!1,this._radius=.5,this._cornerRadius=.3,this._cornerSplit=10,this._radialSegments=8,this._startRad=0,this._uvAttribute=null}getType(){return"PolygonLine"}setPoints(e){this._points=e.map((e=>(new bc).fromArray(e))),this._autoUpdate&&this._updateGeometry()}getPoints(e){return e.length=0,this._points.forEach((t=>{e.push(t.toArray([]))})),e}setRadius(e){this._radius!==e&&(this._radius=e,this._autoUpdate&&this._updateGeometry(!1))}getRadius(){return this._radius}setCornerRadius(e){this._cornerRadius!==e&&(this._cornerRadius=e,this._autoUpdate&&this._updateGeometry())}getCornerRadius(){return this._cornerRadius}setCornerSplit(e){this._cornerSplit!==e&&(this._cornerSplit=e,this._autoUpdate&&this._updateGeometry(!1))}getCornerSplit(){return this._cornerSplit}setRadialSegments(e){this._radialSegments!==e&&(this._radialSegments=e,this._autoUpdate&&this._updateGeometry(!1))}getRadialSegments(){return this._radialSegments}setStartRad(e){this._startRad!==e&&(this._startRad=e,this._autoUpdate&&this._updateGeometry(!1))}getStartRad(){return this._startRad}setAttribute(e,t){if("Closure"===e){if(this._autoClose===t)return;this._autoClose=t,this._autoUpdate&&this._updateGeometry()}super.setAttribute(e,t)}getAttribute(e){if("Closure"===e)return this._autoClose;return super.getAttribute(e)}dispose(){super.dispose(),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null}copy(e){return super.copy(e),this._radius=e._radius,this._progress=e._progress,this._cornerRadius=e._cornerRadius,this._updateGeometry(),this}_updateGeometryAttribute(e,t){const r=this,n=t.computeFrames({divisions:r._cornerSplit,close:r._autoClose}),i=NC(n,{radius:r._radius,radialSegments:r._radialSegments,startRad:r._startRad});i&&(e.addAttribute("a_Position",new up(new cp(new Float32Array(i.positions),3))),e.addAttribute("a_Normal",new up(new cp(new Float32Array(i.normals),3))),e.addAttribute("a_Uv",new up(new cp(new Float32Array(i.uvs),2))),e.addAttribute("a_Uv2",new up(new cp(new Float32Array(i.uvs2),2))),e.setIndex(new up(new cp(i.positions.length/3>65536?new Uint32Array(i.indices):new Uint16Array(i.indices),1))),e.version++)}_updateGeometry(e=!0){const t=this._points,r=this._groups,n=r.length>0,i=this._mesh.geometry,a=this._autoClose,s=this._curvePath3Lists;if(t.length<2)i.dispose();else{if(e){let e;e=n?r.map((e=>t.slice(e[0],e[0]+e[1]))):a?[t.slice(0)]:[t],e.forEach(((e,t)=>{s[t]||(s[t]=new RC),s[t].curves=[],s[t].setFromPoints(e,{bevelRadius:this._cornerRadius,close:this._autoClose})})),s.length=e.length}if(this._dynamic&&!n)this._updateGeometryAttribute(i,s[0]);else if(i.dispose(),n){const e=s.map((e=>{const t=new _p;return this._updateGeometryAttribute(t,e),t}));this._groupIds.length>0&&(this._groupIds.length===r.length?e.forEach(((e,t)=>{const r=e.getAttribute("a_Position").buffer.count,n=this._groupIds[t];e.addAttribute("ids",new up(new cp(new Float32Array(r).fill(n),1)))})):console.warn("Set group Ids failed: groupIds.length = "+this._groupIds.length+" group.length = "+r.length));const t=Gb.mergeGeometries(e,!1);i.copy(t),i.__pickIds=this._groupIds.slice(0)}else this._updateGeometryAttribute(i,s[0]);this._uvAttribute=i.getAttribute("a_Uv2"),this._uvMode===uC&&this._changeUVMode(),i.computeBoundingBox(),i.computeBoundingSphere(),i.dispatchEvent({type:"updateData",data:i}),this.$boundingBox.selfBoundingBoxNeedsUpdate=!0}}_changeUVMode(){if(!this._uvAttribute)return;const e=this._mesh.geometry,t=e.getAttribute("a_Uv");e.addAttribute("a_Uv",this._uvAttribute),this._uvAttribute=t,e.version++}}var OC=function(e,t={}){const r=void 0!==t.width?t.width:.1,n=void 0===t.arrow||t.arrow,i=void 0!==t.side?t.side:"both",a=void 0!==t.sharp&&t.sharp;var s=[],o=[],l=[],u=[],c=[];const h=e.points.length,d=h-1,p=r/2,f="both"!==i?r/2:r,m=e.lengths[d],g=p/f,_=p/m,v=new bc,y=new bc,x=new bc,b=new bc,A=new bc,S=new bc;let E=0;for(let t=0;t<h;t++){const r=e.lengths[t]/f,n=e.lengths[t]/m;"left"!==i?S.copy(e.binormals[t]).multiplyScalar(p*e.widthScales[t]):S.set(0,0,0),"right"!==i?A.copy(e.binormals[t]).multiplyScalar(-p*e.widthScales[t]):A.set(0,0,0);const h=e.normals[t];if(S.add(e.points[t]),A.add(e.points[t]),a&&e.sharps[t]){y.fromArray(s,s.length-3).sub(S),v.fromArray(s,s.length-6).sub(A);const i=y.getLength(),a=v.getLength()-i;let d,p;a>0?(d=v,p=A):(d=y,p=S),x.copy(d).normalize(Math.abs(a)).add(p);let f=b.copy(p).sub(x).normalize().dot(e.tangents[t])*b.copy(p).sub(x).getLength()*2;b.copy(e.tangents[t]).normalize(f).add(x),a>0?(s.push(x.x,x.y,x.z,S.x,S.y,S.z,A.x,A.y,A.z,S.x,S.y,S.z,b.x,b.y,b.z,S.x,S.y,S.z),E+=6,c.push(E-6,E-8,E-7,E-6,E-7,E-5,E-4,E-6,E-5,E-2,E-4,E-1)):(s.push(A.x,A.y,A.z,x.x,x.y,x.z,A.x,A.y,A.z,S.x,S.y,S.z,A.x,A.y,A.z,b.x,b.y,b.z),E+=6,c.push(E-6,E-8,E-7,E-6,E-7,E-5,E-6,E-5,E-3,E-2,E-3,E-1)),o.push(h.x,h.y,h.z,h.x,h.y,h.z,h.x,h.y,h.z,h.x,h.y,h.z,h.x,h.y,h.z,h.x,h.y,h.z),l.push(r-g,0,r-g,1,r,0,r,1,r+g,0,r+g,1),u.push(n-_,0,n-_,1,n,0,n,1,n+_,0,n+_,1)}else s.push(A.x,A.y,A.z,S.x,S.y,S.z),o.push(h.x,h.y,h.z,h.x,h.y,h.z),l.push(r,0,r,1),u.push(n,0,n,1),E+=2,t>0&&c.push(E-2,E-4,E-3,E-2,E-3,E-1)}if(n){const t=e.lengths[d]/f,n=e.lengths[d]/m,a=e.normals[d];"left"!==i?S.copy(e.binormals[d]).multiplyScalar(2*p):S.set(0,0,0),"right"!==i?A.copy(e.binormals[d]).multiplyScalar(2*-p):A.set(0,0,0);const h=x.copy(e.tangents[d]).normalize(3*p);S.add(e.points[d]),A.add(e.points[d]),h.add(e.points[d]),s.push(A.x,A.y,A.z,S.x,S.y,S.z,h.x,h.y,h.z),o.push(a.x,a.y,a.z,a.x,a.y,a.z,a.x,a.y,a.z),l.push(t,"both"!==i?"right"!==i?-2:0:-.5,t,"both"!==i?"left"!==i?2:0:1.5,t+1.5,"both"!==i?0:.5),u.push(n,"both"!==i?"right"!==i?-2:0:-.5,n,"both"!==i?"left"!==i?2:0:1.5,n+1.5*r/m,"both"!==i?0:.5),E+=3,c.push(E-1,E-3,E-2)}return{positions:s,normals:o,uvs:l,uvs2:u,indices:c}};const kC=new bc,LC=new T_;LC.side=Lc.DOUBLE,LC.transparent=!0;class UC extends cC{constructor(e,t){const r=new _p,n=new ap(r,t?t.$getMaterial():LC);super(e,n),n.castShadow=!0,n.receiveShadow=!0,n.geometry.addAttribute("a_Position",new up(new cp(new Float32Array,3))),this.$markChildrenMatrixAutoUpdate(!1),this._mesh=n,this._pathPointLists=[],this._autoClose=!1,this._up=new bc(0,1,0),this._width=1,this._cornerRadius=.3,this._cornerSplit=10,this._arrow=!1,this._uvAttribute=null}getType(){return"RouteLine"}setPoints(e){this._points=e.map((e=>(new bc).fromArray(e))),this._autoUpdate&&this._updateGeometry()}getPoints(e){return e.length=0,this._points.forEach((t=>{e.push(t.toArray([]))})),e}setUpDirection(e){this._up.equals(kC.fromArray(e))||(this._up.fromArray(e),this._autoUpdate&&this._updateGeometry(!1))}getUpDirection(e){return this._up.toArray(e)}setWidth(e){this._width!==e&&(this._width=e,this._autoUpdate&&this._updateGeometry(!1))}getWidth(){return this._width}setCornerRadius(e){this._cornerRadius!==e&&(this._cornerRadius=e,this._autoUpdate&&this._updateGeometry())}getCornerRadius(){return this._cornerRadius}setCornerSplit(e){this._cornerSplit!==e&&(this._cornerSplit=e,this._autoUpdate&&this._updateGeometry(!1))}getCornerSplit(){return this._cornerSplit}setArrow(e){this._arrow!==e&&(this._arrow=e,this._autoUpdate&&this._updateGeometry(!1))}getArrow(){return this._arrow}setAttribute(e,t){if("Closure"===e){if(this._autoClose===t)return;this._autoClose=t,this._autoUpdate&&this._updateGeometry()}super.setAttribute(e,t)}getAttribute(e){if("Closure"===e)return this._autoClose;return super.getAttribute(e)}dispose(){super.dispose(),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null}copy(e){return super.copy(e),this._width=e._width,this._progress=e._progress,this._cornerRadius=e._cornerRadius,this._up.copy(e._up),this._updateGeometry(),this}_updateGeometryAttribute(e,t){const r=this,n=t.computeFrames({up:r._up,divisions:r._cornerSplit,close:r._autoClose}),i=OC(n,{width:r._width,side:"both",arrow:r._arrow});e.addAttribute("a_Position",new up(new cp(new Float32Array(i.positions),3))),e.addAttribute("a_Normal",new up(new cp(new Float32Array(i.normals),3))),e.addAttribute("a_Uv",new up(new cp(new Float32Array(i.uvs),2))),e.addAttribute("a_Uv2",new up(new cp(new Float32Array(i.uvs2),2))),e.setIndex(new up(new cp(i.positions.length/3>65536?new Uint32Array(i.indices):new Uint16Array(i.indices),1))),e.version++}_updateGeometry(e=!0){const t=this._points,r=this._groups,n=r.length>0,i=this._mesh.geometry,a=this._autoClose,s=this._pathPointLists;if(t.length<2)i.dispose();else{if(e){let e;e=n?r.map((e=>t.slice(e[0],e[0]+e[1]))):a?[t.slice(0)]:[t],e.forEach(((e,t)=>{s[t]||(s[t]=new RC),s[t].curves=[],s[t].setFromPoints(e,{bevelRadius:this._cornerRadius,close:this._autoClose})})),s.length=e.length}if(this._dynamic&&!n)this._updateGeometryAttribute(i,s[0]);else if(i.dispose(),n){const e=s.map((e=>{const t=new _p;return this._updateGeometryAttribute(t,e),t}));this._groupIds.length>0&&(this._groupIds.length===r.length?e.forEach(((e,t)=>{const r=e.getAttribute("a_Position").buffer.count,n=this._groupIds[t];e.addAttribute("ids",new up(new cp(new Float32Array(r).fill(n),1)))})):console.warn("Set group ids failed: groudIds.length = "+this._groupIds.length+" group.length = "+r.length));const t=Gb.mergeGeometries(e,!1);i.copy(t),i.__pickIds=this._groupIds.slice(0)}else this._updateGeometryAttribute(i,s[0]);this._uvAttribute=i.getAttribute("a_Uv2"),this._uvMode===uC&&this._changeUVMode(),i.computeBoundingBox(),i.computeBoundingSphere(),i.dispatchEvent({type:"updateData",data:i}),this.$boundingBox.selfBoundingBoxNeedsUpdate=!0}}_changeUVMode(){if(!this._uvAttribute)return;const e=this._mesh.geometry,t=e.getAttribute("a_Uv");e.addAttribute("a_Uv",this._uvAttribute),this._uvAttribute=t,e.version++}}const zC=function(e,t,r){r=r||2;const n=t&&t.length,i=n?t[0]*r:e.length;let a=jC(e,0,i,r,!0);const s=[];if(!a||a.next===a.prev)return s;let o,l,u,c,h,d,p;if(n&&(a=function(e,t,r,n){const i=[];let a,s,o,l,u;for(a=0,s=t.length;a<s;a++)o=t[a]*n,l=a<s-1?t[a+1]*n:e.length,u=jC(e,o,l,n,!1),u===u.next&&(u.steiner=!0),i.push(JC(u));for(i.sort(QC),a=0;a<i.length;a++)KC(i[a],r),r=VC(r,r.next);return r}(e,t,a,r)),e.length>80*r){o=u=e[0],l=c=e[1];for(let t=r;t<i;t+=r)h=e[t],d=e[t+1],h<o&&(o=h),d<l&&(l=d),h>u&&(u=h),d>c&&(c=d);p=Math.max(u-o,c-l),p=0!==p?1/p:0}return GC(a,s,r,o,l,p),s};function jC(e,t,r,n,i){let a,s;if(i===function(e,t,r,n){let i=0;for(let a=t,s=r-n;a<r;a+=n)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}(e,t,r,n)>0)for(a=t;a<r;a+=n)s=lT(a,e[a],e[a+1],s);else for(a=r-n;a>=t;a-=n)s=lT(a,e[a],e[a+1],s);return s&&rT(s,s.next)&&(uT(s),s=s.next),s}function VC(e,t){if(!e)return e;t||(t=e);let r,n=e;do{if(r=!1,n.steiner||!rT(n,n.next)&&0!==tT(n.prev,n,n.next))n=n.next;else{if(uT(n),n=t=n.prev,n===n.next)break;r=!0}}while(r||n!==t);return t}function GC(e,t,r,n,i,a,s){if(!e)return;!s&&a&&function(e,t,r,n){let i=e;do{null===i.z&&(i.z=ZC(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,r,n,i,a,s,o,l,u=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,n=r,o=0,t=0;t<u&&(o++,n=n.nextZ,n);t++);for(l=u;o>0||l>0&&n;)0!==o&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(s>1)}(i)}(e,n,i,a);let o,l,u=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,a?HC(e,n,i,a):WC(e))t.push(o.i/r),t.push(e.i/r),t.push(l.i/r),uT(e),e=l.next,u=l.next;else if((e=l)===u){s?1===s?GC(e=qC(VC(e),t,r),t,r,n,i,a,2):2===s&&XC(e,t,r,n,i,a):GC(VC(e),t,r,n,i,a,1);break}}function WC(e){const t=e.prev,r=e,n=e.next;if(tT(t,r,n)>=0)return!1;let i=e.next.next;for(;i!==e.prev;){if($C(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&tT(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function HC(e,t,r,n){const i=e.prev,a=e,s=e.next;if(tT(i,a,s)>=0)return!1;const o=i.x<a.x?i.x<s.x?i.x:s.x:a.x<s.x?a.x:s.x,l=i.y<a.y?i.y<s.y?i.y:s.y:a.y<s.y?a.y:s.y,u=i.x>a.x?i.x>s.x?i.x:s.x:a.x>s.x?a.x:s.x,c=i.y>a.y?i.y>s.y?i.y:s.y:a.y>s.y?a.y:s.y,h=ZC(o,l,t,r,n),d=ZC(u,c,t,r,n);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&$C(i.x,i.y,a.x,a.y,s.x,s.y,p.x,p.y)&&tT(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&$C(i.x,i.y,a.x,a.y,s.x,s.y,f.x,f.y)&&tT(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&$C(i.x,i.y,a.x,a.y,s.x,s.y,p.x,p.y)&&tT(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&$C(i.x,i.y,a.x,a.y,s.x,s.y,f.x,f.y)&&tT(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function qC(e,t,r){let n=e;do{const i=n.prev,a=n.next.next;!rT(i,a)&&nT(i,n,n.next,a)&&sT(i,a)&&sT(a,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(a.i/r),uT(n),uT(n.next),n=e=a),n=n.next}while(n!==e);return VC(n)}function XC(e,t,r,n,i,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&eT(s,e)){let o=oT(s,e);return s=VC(s,s.next),o=VC(o,o.next),GC(s,t,r,n,i,a),void GC(o,t,r,n,i,a)}e=e.next}s=s.next}while(s!==e)}function QC(e,t){return e.x-t.x}function KC(e,t){if(t=function(e,t){let r=t;const n=e.x,i=e.y;let a,s=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const e=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=n&&e>s){if(s=e,e===n){if(i===r.y)return r;if(i===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!a)return null;if(n===s)return a;const o=a,l=a.x,u=a.y;let c,h=1/0;r=a;do{n>=r.x&&r.x>=l&&n!==r.x&&$C(i<u?n:s,i,l,u,i<u?s:n,i,r.x,r.y)&&(c=Math.abs(i-r.y)/(n-r.x),sT(r,e)&&(c<h||c===h&&(r.x>a.x||r.x===a.x&&YC(a,r)))&&(a=r,h=c)),r=r.next}while(r!==o);return a}(e,t),t){const r=oT(t,e);VC(t,t.next),VC(r,r.next)}}function YC(e,t){return tT(e.prev,e,t.prev)<0&&tT(t.next,e,e.next)<0}function ZC(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function JC(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function $C(e,t,r,n,i,a,s,o){return(i-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(n-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(i-s)*(n-o)>=0}function eT(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&nT(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(sT(e,t)&&sT(t,e)&&function(e,t){let r=e,n=!1;const i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(tT(e.prev,e,t.prev)||tT(e,t.prev,t))||rT(e,t)&&tT(e.prev,e,e.next)>0&&tT(t.prev,t,t.next)>0)}function tT(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function rT(e,t){return e.x===t.x&&e.y===t.y}function nT(e,t,r,n){const i=aT(tT(e,t,r)),a=aT(tT(e,t,n)),s=aT(tT(r,n,e)),o=aT(tT(r,n,t));return i!==a&&s!==o||(!(0!==i||!iT(e,r,t))||(!(0!==a||!iT(e,n,t))||(!(0!==s||!iT(r,e,n))||!(0!==o||!iT(r,t,n)))))}function iT(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function aT(e){return e>0?1:e<0?-1:0}function sT(e,t){return tT(e.prev,e,e.next)<0?tT(e,t,e.next)>=0&&tT(e,e.prev,t)>=0:tT(e,t,e.prev)<0||tT(e,e.next,t)<0}function oT(e,t){const r=new cT(e.i,e.x,e.y),n=new cT(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function lT(e,t,r,n){const i=new cT(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function uT(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function cT(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var hT=function(e,t,r){var n=e.contour,i=e.holes;if(dT(n)||(n=n.reverse()),i)for(var a=0,s=i.length;a<s;a++){var o=i[a];dT(o)&&(i[a]=o.reverse())}if(t=t||[],r=r||[],pT(n),fT(t,n),i){var l=n.length;i.forEach(pT);for(a=0;a<i.length;a++)r.push(l),l+=i[a].length,fT(t,i[a])}};function dT(e){return function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n][0]*e[i][1]-e[i][0]*e[n][1];return.5*r}(e)<0}function pT(e){var t=e.length;t>2&&function(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}(e[t-1],e[0])&&e.pop()}function fT(e,t){for(var r=0;r<t.length;r++)e.push(t[r][0]),e.push(t[r][1])}var mT={getGeometryData:function(e){var t=void 0!==e.depth?e.depth:1,r=t<0,n=[],i=[];hT(e,n,i);for(var a=zC(n,i),s=[],o=[],l=[],u=0,c=0,h=n.length;c<h;c+=2)s.push(n[c],n[c+1],0),o.push(r?-n[c]:n[c],n[c+1]);for(c=0,h=a.length;c<h;c+=3)r?l.push(a[c+0],a[c+2],a[c+1]):l.push(a[c+0],a[c+1],a[c+2]);u=s.length/3;for(c=0,h=n.length;c<h;c+=2)s.push(n[c],n[c+1],-t),o.push(r?n[c]:-n[c],n[c+1]);for(c=0,h=a.length;c<h;c+=3)r?l.push(u+a[c+1],u+a[c+2],u+a[c+0]):l.push(u+a[c+2],u+a[c+1],u+a[c+0]);u=s.length/3;var d=[];if(i.length){d.push([0,2*i[0]]);for(c=0;c<i.length-1;c++)d.push([2*i[c],2*i[c+1]]);d.push([2*i[c],n.length])}else d.push([0,n.length]);for(c=0;c<d.length;c++)for(var p=0,f=d[c][0],m=d[c][1],g=f;g<m;g+=2){var _=g,v=g+2>=m?f:g+2;s.push(n[_+0],n[_+1],0),s.push(n[_+0],n[_+1],-t),o.push(p,0),o.push(p,-t),s.push(n[v+0],n[v+1],0),s.push(n[v+0],n[v+1],-t),p-=gT(n[_+0],n[_+1],n[v+0],n[v+1]),o.push(p,0),o.push(p,-t),r?(l.push(u+0,u+1,u+2),l.push(u+1,u+3,u+2)):(l.push(u+0,u+2,u+1),l.push(u+1,u+2,u+3)),u+=4}return{positions:s,uvs:o,indices:l}}};function gT(e,t,r,n){var i=r-e,a=n-t;return Math.sqrt(i*i+a*a)}var _T=function(e){var t=[],r=[];hT(e,t,r);var n=zC(t,r),i=[],a=[],s=[];for(let e=0,r=t.length;e<r;e+=2)i.push(t[e],t[e+1],0),a.push(0,0,1),s.push(t[e],t[e+1]);return{positions:i,normals:a,uvs:s,indices:n}};const vT=(new Mc).setFromEuler(new Dh(-Math.PI/2,0,0)).toMatrix4(),yT=new E_;yT.diffuse.setHex(16777215);const xT={positions:3,normals:3,uvs:2},bT={positions:"a_Position",normals:"a_Normal",uvs:"a_Uv"};class AT extends QE{constructor(e,t){const r=t?t.$getMaterial():yT,n=new ap(void 0,r);super(e,n),n.castShadow=!0,n.receiveShadow=!0,this._mesh=n,this._points=[],this._holes=[],this.height=0,this._autoGenerate=!0,this.$markChildrenMatrixAutoUpdate(!1)}getType(){return"ExtrudeShape"}begin(){this._autoGenerate=!1}end(){this._generateGeometry(),this._autoGenerate=!0}setPoints(e){this._points=e.map((e=>(e[1]=-e[1],e))),this._autoGenerate&&this._generateGeometry()}getPoints(e=[]){return e.length=0,this._points.forEach((t=>{e.push([t[0],-t[1]])})),e}setHoles(e){this._holes=e.map((e=>e.map((e=>(e[1]=-e[1],e))))),this._autoGenerate&&this._generateGeometry()}getHoles(e=[]){return e.length=0,this._holes.forEach((t=>{e.push(t.map((e=>(e[1]=-e[1],e))))})),e}setHeight(e){this._height=e,this._autoGenerate&&this._generateGeometry()}getHeight(){return this._height}dispose(){super.dispose(),this._points=[],this._holes=[],this._mesh.geometry&&this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null}copy(e){return super.copy(e,!1,!1),this._points=L_([],e._points),this._holes=L_([],e._holes),this._height=e._height,this._generateGeometry(),this}clone(){return new this.constructor(this._uScene).copy(this)}_generateGeometry(){const e={contour:this._points,holes:this._holes};let t;this._height>0?(e.depth=-this._height,t=mT.getGeometryData(e)):t=_T(e),this._mesh.geometry?(this._mesh.geometry.dispose(),this._mesh.geometry.getAttribute("a_Normal")&&this._mesh.geometry.removeAttribute("a_Normal")):this._mesh.geometry=new _p,this._mesh.geometry.setIndex(new up(new cp(t.positions.length/3>65536?new Uint32Array(t.indices):new Uint16Array(t.indices),1))),delete t.indices;for(const e in t){const r=t[e],n=bT[e]?bT[e]:e,i=xT[e]?xT[e]:3;this._mesh.geometry.addAttribute(n,new up(new cp(new Float32Array(r),i)))}t.normals||Gb.computeNormals(this._mesh.geometry),Gb.applyMatrix4(this._mesh.geometry,vT,!0),this.$boundingBox.selfBoundingBoxNeedsUpdate=!0}}const ST="CUSTOM_WATER",ET={time:0,offset:[0,0],flow1:[.059,.034,.0097,1/4],flow2:[.053,-.032,.0093,1/4],flow3:[.01,.011,1e-4,1/4],flow4:[-.009,.009,.1,1/4]},wT="\n\t\t#ifdef USE_NORMAL_MAP\n\t\t\tuniform float time;\n\t\t\tuniform vec4 flow1;\t// .xy is x-direction, y-direction velocity; .z is uv scale size; .w is normal specific gravity.\n\t\t\tuniform vec4 flow2;\n\t\t\tuniform vec4 flow3;\n\t\t\tuniform vec4 flow4;\n\t\t\tuniform vec2 offset;\n\n\t\t\tvec4 getNoise(vec2 uv) {\n\t\t\t\tvec2 uv1 = (uv + time * flow1.xy) * flow1.z;\n\t\t\t\tvec2 uv2 = (uv + time * flow2.xy) * flow2.z;\n\t\t\t\tvec2 uv3 = (uv + time * flow3.xy) * flow3.z;\n\t\t\t\tvec2 uv4 = (uv + time * flow4.xy) * flow4.z;\n\t\t\t\tvec4 noise = texture2D(normalMap, uv1) * flow1 .w\n\t\t\t\t+ texture2D(normalMap, uv2) * flow2.w\n\t\t\t\t+ texture2D(normalMap, uv3) * flow3.w\n\t\t\t\t+ texture2D(normalMap, uv4) * flow4.w;\n\n\t\t\t\treturn noise;\n\t\t\t}\n\t\t#endif\n\t",CT="\n\t\t// Use v_modelPos from modelPos_pars_frag\n\n\t\t#ifdef FLAT_SHADED\n\t\t\tvec3 fdx = dFdx(v_modelPos);\n\t\t\tvec3 fdy = dFdy(v_modelPos);\n\t\t\tvec3 N = normalize(cross(fdx, fdy));\n\t\t#else\n\t\t\tvec3 N = normalize(v_Normal);\n\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\tN = N * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t#endif\n\t\t#endif\n\n\t\t#ifdef USE_TBN\n\t\t\tvec3 tangent = normalize(v_Tangent);\n\t\t\tvec3 bitangent = normalize(v_Bitangent);\n\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\ttangent = tangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t\tbitangent = bitangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t#endif\n\t\t\tmat3 tspace = mat3(tangent, bitangent, N);\n\t\t#endif\n\n\t\t// non perturbed normal\n\t\tvec3 geometryNormal = N;\n\n\t\t#ifdef USE_NORMAL_MAP\n\t\t\tvec3 mapN = getNoise(v_Uv + offset).rgb * 2.0 - 1.0;\t// @water-modify\n\t\t\tmapN.xy *= normalScale;\n\t\t\t#ifdef USE_TBN\n\t\t\t\tN = normalize(tspace * mapN);\n\t\t\t#else\n\t\t\t\tmapN.xy *= (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t\tN = normalize(tsn(N, v_modelPos, v_Uv) * mapN);\n\t\t\t#endif\n\t\t#elif defined(USE_BUMPMAP)\n\t\t\tN = perturbNormalArb(v_modelPos, N, dHdxy_fwd(v_Uv));\n\t\t#endif\n\n\t\t#ifdef USE_CLEARCOAT\n\t\t\tvec3 clearcoatNormal = geometryNormal;\n\t\t#endif\n\n\t\t#ifdef USE_CLEARCOAT_NORMALMAP\n\t\t\tvec3 clearcoatMapN = texture2D(clearcoatNormalMap, v_Uv).xyz * 2.0 - 1.0;\n\t\t\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t\t\t#ifdef USE_TBN\n\t\t\t\tclearcoatNormal = normalize(tspace * clearcoatMapN);\n\t\t\t#else\n\t\t\t\tclearcoatMapN.xy *= (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t\tclearcoatNormal = normalize(tsn(clearcoatNormal, v_modelPos, v_Uv) * clearcoatMapN);\n\t\t\t#endif\n\t\t#endif\n\t";class TT extends E_{constructor(){super(...arguments);let e=this.fragmentShader;e=e.replace("#include <clippingPlanes_pars_frag>",`\n\t\t\t#include <clippingPlanes_pars_frag>\n\t\t\t\t\n\t\t\t${wT}\n\t\t`),e=e.replace("#include <normal_frag>",`\n\t\t\t${CT}\n\t\t`),this.fragmentShader=e,this.shaderName=ST,z_(this.uniforms,ET),this.diffuse.fromArray([0,.3,.5]),this.transparent=!0,this._wireframe=!1}set wireframe(e){e!==this._wireframe&&(this._wireframe=e,this.drawMode=e?Kc.LINES:Kc.TRIANGLES)}get wireframe(){return this._wireframe}copy(e){return super.copy(e),this.wireframe=e.wireframe,this}}TT.prototype.useDefaultBufferMaterial=!0;class DT extends _p{constructor(e){super(),this.type="ShapeGeometry";const t=_T(e);this.setIndex(new up(new cp(t.positions.length/3>65536?new Uint32Array(t.indices):new Uint16Array(t.indices),1))),this.addAttribute("a_Position",new up(new cp(new Float32Array(t.positions),3))),this.addAttribute("a_Normal",new up(new cp(new Float32Array(t.normals),3))),this.addAttribute("a_Uv",new up(new cp(new Float32Array(t.uvs),2))),this.computeBoundingBox(),this.computeBoundingSphere()}}const MT=(new Mc).setFromEuler(new Dh(-Math.PI/2,0,0)).toMatrix4();class PT extends QE{constructor(e){const t=new TT,r=new ap(void 0,t);r.material.uniforms.size=new Float32Array([5,5]),super(e,r),r.castShadow=!1,r.receiveShadow=!1;const n=this,i=r.addBeforeRenderFunction((function(e,t){t.uniforms.time=n._noiseTime,t.normalScale.set(n._flowWeight,n._flowWeight)}),"water-uniforms-binding");this._points=[],this._holes=[],this._autoGenerate=!0,this._mesh=r,this._binding=i,this._noiseTime=0,this._noiseTimeScale=1,this._flowWeight=1,this._flowOffset=[.3,.3],this._reflectDistortion=2,this._reflectWeight=1,this.$markChildrenMatrixAutoUpdate(!1)}getType(){return"Water"}begin(){this._autoGenerate=!1}end(){this._generateGeometry(),this._autoGenerate=!0}setPoints(e){this._points=e.map((e=>(e[1]=-e[1],e))),this._autoGenerate&&this._generateGeometry()}getPoints(e){return e.length=0,this._points.forEach((t=>{e.push([t[0],-t[1]])})),e}setHoles(e){this._holes=e.map((e=>e.map((e=>(e[1]=-e[1],e))))),this._autoGenerate&&this._generateGeometry()}getHoles(e){return e.length=0,this._holes.forEach((t=>{e.push(t.map((e=>(e[1]=-e[1],e))))})),e}setFlowWeight(e){this._flowWeight=e}getFlowWeight(){return this._flowWeight}setNoiseTimeScale(e){this._noiseTimeScale=e}getNoiseTimeScale(){return this._noiseTimeScale}setFlowOffset(e){this._flowOffset[0]=e[0],this._flowOffset[1]=e[1],this.getStyle().setUniform("offset",this._flowOffset)}getFlowOffset(e){return e||(e=[]),e[0]=this._flowOffset[0],e[1]=this._flowOffset[1],e}setReflectDistortion(e){console.warn("UWater: .setReflectDistortion is discarded!"),this._reflectDistortion=e}getReflectDistortion(){return console.warn("UWater: .getReflectDistortion is discarded!"),this._reflectDistortion}setReflectWeight(e){console.warn("UWater: .setReflectWeight is discarded!"),this._reflectWeight=e}getReflectWeight(){return console.warn("UWater: .getReflectWeight is discarded!"),this._reflectWeight}update(e){this._noiseTime+=e*this._noiseTimeScale}dispose(){super.dispose(),this._mesh.removeBeforeRenderFunction(this._binding),this._points=[],this._holes=[],this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,this._binding=null}copy(e){return super.copy(e,!1),this._points=L_([],e._points),this._holes=L_([],e._holes),this._generateGeometry(),this._noiseTime=e._noiseTime,this._noiseTimeScale=e._noiseTimeScale,this._flowWeight=e._flowWeight,this}_generateGeometry(){if(0==this._points.length)return;const e={contour:this._points,holes:this._holes},t=new DT(e);Gb.applyMatrix4(t,MT,!0),this._mesh.geometry&&this._mesh.geometry.dispose(),this._mesh.geometry=t,this.$boundingBox.selfBoundingBoxNeedsUpdate=!0}}class FT extends mb{constructor(e){super(e),this._node=new Om,this._node.shadow.radius=1,this._node.$unode=this,this._node.shadow.autoUpdate=!1}get isLight(){return!0}getType(){return"DirectionalLight"}setColor(e){this._node.color.fromArray(e)}getColor(e){return this._node.color.toArray(e)}setIntensity(e){this._node.intensity=e}getIntensity(){return this._node.intensity}setCastShadow(e){this._node.castShadow=e}getCastShadow(){return this._node.castShadow}setShadowRange(e){const t=this._node.shadow;t.windowSize=e.width,t.cameraNear=e.near,t.cameraFar=e.far}getShadowRange(e){const t=this._node.shadow;return e.width=t.windowSize,e.height=t.windowSize,e.near=t.cameraNear,e.far=t.cameraFar,e}setShadowQuality(e){const t=this._node.shadow.mapSize;t.x===e&&t.y===e||t.set(e,e)}getShadowQuality(){return this._node.shadow.mapSize.x}setShadowBias(e){this._node.shadow.bias=e}getShadowBias(){return this._node.shadow.bias}setShadowNormalBias(e){this._node.shadow.normalBias=e}getShadowNormalBias(){return this._node.shadow.normalBias}setFrustumEdgeFalloff(e){this._node.shadow.frustumEdgeFalloff=e}getFrustumEdgeFalloff(){return this._node.shadow.frustumEdgeFalloff}setShadowRadius(e){this._node.shadow.radius=e}getShadowRadius(){return this._node.shadow.radius}updateShadow(){!1===this._node.shadow.needsUpdate&&(this._node.shadow.needsUpdate=!0)}$parseOptions(e){return super.$parseOptions(e),e.color&&this.setColor(e.color),void 0!==e.intensity&&this.setIntensity(e.intensity),void 0!==e.castShadow&&this.setCastShadow(e.castShadow),this}}class RT extends ap{constructor(){const e=new bp(OT);e.depthWrite=!1,super(NT,e),this.renderLayer=5,this.frustumCulled=!1,this.lensflareElements=[]}set occlusionScale(e){this.material.uniforms.scale[1]=e}get occlusionScale(){return this.material.uniforms.scale[1]}}const NT=new _p,BT=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),IT=new cp(BT,5);NT.setIndex(new up(new cp(new Uint16Array([0,1,2,0,2,3]),1))),NT.addAttribute("a_Position",new up(IT,3,0)),NT.addAttribute("a_Uv",new up(IT,2,3));const OT={name:"lensflare_marker",defines:{},uniforms:{scale:[.1,.1],screenPosition:[0,0,0]},vertexShader:"\n        uniform vec3 screenPosition;\n        uniform vec2 scale;\n\n        attribute vec3 a_Position;\n        attribute vec2 a_Uv;\n\n        varying vec2 v_Uv;\n\n        void main() {\n            v_Uv = a_Uv;\n            vec2 pos = a_Position.xy;\n            gl_Position = vec4(pos * scale + screenPosition.xy, screenPosition.z, 1.0);\n        }\n    ",fragmentShader:"\n        uniform sampler2D map;\n        uniform vec3 color;\n\n        varying vec2 v_Uv;\n\n        void main() {\t\t// draw circle\n            float dist = length(v_Uv - vec2(0.5));\n            float mask = 1.0 - smoothstep(0.49, 0.5, dist);\n            gl_FragColor = vec4(mask, mask, mask, 1.);\n        }\n    "};class kT extends mb{constructor(e){super(e),this._node=new RT}setOcclusionScale(e){this._node.occlusionScale=e}getOcclusionScale(){return this._node.occlusionScale}addElement(e){this._node.lensflareElements.push({texture:e.imageTexture._texture,color:new Eh(e.color[0],e.color[1],e.color[2]),scale:e.scale,offset:e.offset})}setRenderLayer(){console.log("lensflare can not set renderLayer")}removeElement(e){this._node.lensflareElements.splice(e,1)}clearElements(){this._node.lensflareElements=[]}getAllElements(){return this._node.lensflareElements}}class LT extends mb{constructor(e){super(e),this._node=new jm,this._node.shadow.radius=1,this._node.$unode=this,this._node.shadow.autoUpdate=!1}get isLight(){return!0}getType(){return"SpotLight"}setColor(e){this._node.color.fromArray(e)}getColor(e){return this._node.color.toArray(e)}setIntensity(e){this._node.intensity=e}getIntensity(){return this._node.intensity}setDistance(e){this._node.distance=e}getDistance(){return this._node.distance}setAngle(e){this._node.angle=e}getAngle(){return this._node.angle}setPenumbra(e){this._node.penumbra=e}getPenumbra(){return this._node.penumbra}setDecay(e){this._node.decay=e}getDecay(){return this._node.decay}setCastShadow(e){this._node.castShadow=e}getCastShadow(){return this._node.castShadow}setShadowRange(e){const t=this._node.shadow;t.cameraNear=e.near,t.camera.setPerspective(2*this._node.angle,1,t.cameraNear,t.cameraFar)}getShadowRange(e){const t=this._node.shadow.camera;return e.near=t.near,e}setShadowQuality(e){const t=this._node.shadow.mapSize;t.x===e&&t.y===e||t.set(e,e)}getShadowQuality(){return this._node.shadow.mapSize.x}setShadowBias(e){this._node.shadow.bias=e}getShadowBias(){return this._node.shadow.bias}setShadowNormalBias(e){this._node.shadow.normalBias=e}getShadowNormalBias(){return this._node.shadow.normalBias}setFrustumEdgeFalloff(e){this._node.shadow.frustumEdgeFalloff=e}getFrustumEdgeFalloff(){return this._node.shadow.frustumEdgeFalloff}setShadowRadius(e){this._node.shadow.radius=e}getShadowRadius(){return this._node.shadow.radius}updateShadow(){!1===this._node.shadow.needsUpdate&&(this._node.shadow.needsUpdate=!0)}$parseOptions(e){return super.$parseOptions(e),e.color&&this.setColor(e.color),void 0!==e.intensity&&this.setIntensity(e.intensity),void 0!==e.distance&&this.setDistance(e.distance),void 0!==e.angle&&this.setAngle(e.angle),void 0!==e.penumbra&&this.setPenumbra(e.penumbra),void 0!==e.decay&&this.setDecay(e.decay),void 0!==e.castShadow&&this.setCastShadow(e.castShadow),this}}class UT extends mb{constructor(e){super(e),this._node=new Um,this._node.shadow.radius=1,this._node.$unode=this,this._node.shadow.autoUpdate=!1,this._node.shadow.cameraFar=this._node.distance}get isLight(){return!0}getType(){return"PointLight"}setColor(e){this._node.color.fromArray(e)}getColor(e){return this._node.color.toArray(e)}setIntensity(e){this._node.intensity=e}getIntensity(){return this._node.intensity}setDistance(e){this._node.distance=e,this._node.shadow.cameraFar=e}getDistance(){return this._node.distance}setDecay(e){this._node.decay=e}getDecay(){return this._node.decay}setCastShadow(e){this._node.shadow.autoUpdate=e,this._node.castShadow=e}getCastShadow(){return this._node.castShadow}setShadowRange(e){const t=this._node.shadow;t.cameraNear=e.near,t.camera.setPerspective(.5*Math.PI,1,t.cameraNear,t.cameraFar)}getShadowRange(e){const t=this._node.shadow;return e.near=t.cameraNear,e}setShadowQuality(e){const t=this._node.shadow.mapSize;t.x===e&&t.y===e||t.set(e,e)}getShadowQuality(){return this._node.shadow.mapSize.x}setShadowBias(e){this._node.shadow.bias=e}getShadowBias(){return this._node.shadow.bias}setShadowNormalBias(e){this._node.shadow.normalBias=e}getShadowNormalBias(){return this._node.shadow.normalBias}setShadowRadius(e){this._node.shadow.radius=e}getShadowRadius(){return this._node.shadow.radius}updateShadow(){!1===this._node.shadow.needsUpdate&&(this._node.shadow.needsUpdate=!0)}$parseOptions(e){return super.$parseOptions(e),e.color&&this.setColor(e.color),void 0!==e.intensity&&this.setIntensity(e.intensity),void 0!==e.distance&&this.setDistance(e.distance),void 0!==e.decay&&this.setDecay(e.decay),void 0!==e.castShadow&&this.setCastShadow(e.castShadow),this}}class zT extends mb{constructor(e){super(e),this._node=new Nm,this._node.$unode=this}get isLight(){return!0}getType(){return"AmbientLight"}setColor(e){this._node.color.fromArray(e)}getColor(e){return this._node.color.toArray(e)}setIntensity(e){this._node.intensity=e}getIntensity(){return this._node.intensity}$parseOptions(e){return super.$parseOptions(e),void 0!==e.color&&this.setColor(e.color),void 0!==e.intensity&&this.setIntensity(e.intensity),this}}class jT extends mb{constructor(e){super(e),this._node=new km,this._node.$unode=this}get isLight(){return!0}getType(){return"HemisphereLight"}setColor(e){this._node.color.fromArray(e)}getColor(e){return this._node.color.toArray(e)}setGroundColor(e){this._node.groundColor.fromArray(e)}getGroundColor(e){return this._node.groundColor.toArray(e)}setIntensity(e){this._node.intensity=e}getIntensity(){return this._node.intensity}$parseOptions(e){return super.$parseOptions(e),e.color&&this.setColor(e.color),e.groundColor&&this.setGroundColor(e.groundColor),void 0!==e.intensity&&this.setIntensity(e.intensity),this}}const VT=(new Mc).setFromEuler(new Dh(Math.PI/2,0,0)).toMatrix4();class GT extends ap{constructor(e){const t=new vp(2,2);Gb.applyMatrix4(t,VT,!0);const r=new bp(GT.SkyPlaneShader);r.side=Lc.FRONT,super(t,r),e&&(this.texture=e),this.material=r,this.frustumCulled=!1}get gamma(){return this.material.defines.GAMMA}set gamma(e){this.material.defines.GAMMA=e,this.material.needsUpdate=!0}get texture(){return this.material.diffuseMap}set texture(e){e.isTexture2D&&(this.material.diffuseMap=e,e.addEventListener("onload",(()=>this.material.needsUpdate=!0))),this.material.needsUpdate=!0}get isSkyPlane(){return!0}}GT.SkyPlaneShader={defines:{GAMMA:!1},uniforms:{},vertexShader:["attribute vec2 a_Uv;","attribute vec3 a_Position;","uniform mat3 uvTransform;","varying vec2 vUv;","void main() {","    vUv = ( uvTransform * vec3( a_Uv, 1 ) ).xy;","    gl_Position = vec4( a_Position.xy, 1.0, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D diffuseMap;","varying vec2 vUv;","void main() {","   vec4 texColor = texture2D( diffuseMap, vUv );","   gl_FragColor = mapTexelToLinear( texColor );","\t#ifdef GAMMA","   #include <encodings_frag>","\t#endif","}"].join("\n")};class WT extends ap{constructor(){const e=new vp(2,2);Gb.applyMatrix4(e,VT,!0);const t=new bp(WT.SkyColorPlaneShader);t.side=Lc.FRONT,t.transparent=!0,super(e,t),this.material=t,this.frustumCulled=!1}get isSkyColorPlane(){return!0}}WT.SkyColorPlaneShader={defines:{},uniforms:{},vertexShader:"\n\t\tattribute vec3 a_Position;\n\n\t\tvoid main() {\n\t\t   \tgl_Position = vec4( a_Position.xy, 1.0, 1.0 );\n\t\t}\n\t",fragmentShader:"\n\t\tuniform float u_Opacity;\n\t\tuniform vec3 u_Color;\n\t\tuniform sampler2D diffuseMap;\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t   gl_FragColor = vec4(u_Color,u_Opacity);\n\n\t\t}\n\t"};const HT=new Sc;class qT extends Bd{constructor(e=50,t=1,r=.1,n=2e3){super(),this._projectionWeight=1,this.near=r,this.far=n,this.zoom=1,this._view=null,this._fov=e*Math.PI/180,this._aspect=t,this._orthographicDistance=r+(n-r)/2,this._left=-1,this._right=1,this._bottom=-1,this._top=1,this.updateOrthographicRect()}get isPerspectiveCamera(){return this._projectionWeight>=.5}get isOrthographicCamera(){return this._projectionWeight<.5}set fov(e){this._fov=e*Math.PI/180,this.updateOrthographicRect()}get fov(){return 180*this._fov/Math.PI}set aspect(e){this._aspect=e,this.updateOrthographicRect()}get aspect(){return this._aspect}set left(e){console.warning("Set camera left :"+e)}get left(){return this._left}set right(e){console.warning("Set camera right :"+e)}get right(){return this._right}set bottom(e){console.warning("Set camera bottom :"+e)}get bottom(){return this._bottom}set top(e){console.warning("Set camera top :"+e)}get top(){return this._top}set view(e){console.warning("Set camera view :"+e)}get view(){return this._view}set orthographicDistance(e){this._orthographicDistance=e,this.updateOrthographicRect()}get orthographicDistance(){return this._orthographicDistance}set projectionWeight(e){this._projectionWeight=e}get projectionWeight(){return this._projectionWeight}getEffectiveFOV(){return 180/Math.PI*2*Math.atan(Math.tan(Math.PI/180*.5*this._fov)/this.zoom)}setViewOffset(e,t,r,n,i,a){}clearViewOffset(){}updateOrthographicRect(){const e=this._orthographicDistance,t=Math.tan(this._fov/2)*e,r=this._aspect*t;this._left=-r,this._right=r,this._top=t,this._bottom=-t}updateProjectionMatrix(){0===this._projectionWeight?this.setOrtho(this._left,this._right,this._bottom,this._top,this.near,this.far):1===this._projectionWeight?this.setPerspective(this._fov,this._aspect,this.near,this.far):this.lerpMatrixUpdate()}lerpMatrixUpdate(){const e=this._projectionWeight;this.setOrtho(this._left,this._right,this._bottom,this._top,this.near,this.far),HT.copy(this.projectionMatrix);const t=HT.elements;this.setPerspective(this._fov,this._aspect,this.near,this.far);const r=this.projectionMatrix.elements;for(let n=0;n<16;n++)this.projectionMatrix.elements[n]=t[n]*(1-e)+r[n]*e;this.projectionMatrixInverse.getInverse(this.projectionMatrix)}copy(e){super.copy(e),this._projectionWeight=e._projectionWeight,this._orthographicDistance=e._orthographicDistance,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this._view=e._view,this._fov=e._fov,this._aspect=e._aspect,this._left=e._left,this._right=e._right,this._bottom=e._bottom,this._top=e._top}toJSON(){}}const XT=new bc,QT=new xh,KT=new bh,YT=new Zb,ZT=(e,t,r,n)=>{e.getVisible()&&(e.isRenderableNode&&!e.$pickable||(e.isRenderableNode&&!e.$isContainer?e.$raycast(t,r):n&&e._children.forEach((e=>ZT(e,t,r,!0)))))};const JT=new xh,$T=new Zb,eD=new xh(.5,.5);class tD{constructor(e){this._camera=e,this._renderTarget=null,this._array=null,this._size=new xh,this._needsUpdate=!0,this._timer=0,this._interval=.25,this.renderOptions=(e=>{const t=e.$uScene.$pickNodeCache,r=e.$uScene.$auxiliaryPickBufferManager;return{ifRender:e=>{const r=e.material,n=e.object,i=n.userData;if(n._usePickBox)return!1;if(i.isParticleMesh)return!1;if(void 0!==i.$pickable&&!1===i.$pickable)return!1;if(!r.opacity)return!1;if(n.isSkyBox)return!1;if(n.isEdge||n.__destroyed)return!1;let a=t.map.get(n.id);if(!a){const r=e.geometry;if(r&&r.getAttribute("ids")&&r.getAttribute("ids").buffer.array){a=t.createPickCache(n,!0);const e=new Set;r.__pickIds?r.__pickIds.forEach((t=>e.add(t))):r.getAttribute("ids").buffer.array.forEach((t=>e.add(t))),e.forEach((e=>{t.map.set(e,{object:n,uNode:a.uNode,merged:!0})}))}else n.isInstancedMesh||(a=t.createPickCache(n,!1))}return!(a&&a.uNode&&!a.uNode.$pickable)},getMaterial:e=>r.getMaterial(e)}})(e)}pick(e){const t=this._camera.$uScene;let r=JT.copy(this._camera._size);this._renderTarget?this._size.equals(r)||this._updateBuffer(r):this._initBuffer(r),this._needsUpdate&&(this._camera.$renderPickingBuffer(t.getRoot(),this),this._camera.$uAppView.$renderer.renderPass.setRenderTarget(this._renderTarget),this._camera.$uAppView.$renderer.renderPass.readRenderTargetPixels(0,0,this._size.x,this._size.y,this._array),this._needsUpdate=!1),JT.fromArray(e).multiplyScalar(.5).add(eD).clampScalar(0,1).multiply(this._size).round();const n=JT.x+Math.max(0,JT.y-1)*this._size.x,i=this._array,a=255*i[4*n+2]*255+255*i[4*n+1]+i[4*n+0];if(isNaN(a))return null;let s=t.$pickNodeCache.map.get(a);if(!s)return null;if(void 0===s.uNode&&(s.uNode=t.$pickNodeCache.getUNodeByPickedObject(s.object)),!s.uNode||!s.uNode.$pickable)return null;let o={},l=s.uNode,u=this._camera;o.node=l,o.mesh=s.object,o.subNodeName=s.object?.name,(s.merged||l.hasInstancing())&&(o.pickedId=a),JT.fromArray(e),$T.setFromCamera(JT,u._node,u._node.isPerspectiveCamera?"perspective":"orthographic");const c={origin:$T.ray.origin.toArray([]),direction:$T.ray.direction.toArray([])};return Object.defineProperty(o,"position",{get(){$T.ray.origin.fromArray(c.origin),$T.ray.direction.fromArray(c.direction),$T.camera=u._node;let e=[];return l.$raycast($T,e),e.sort(k_),e[0]?e[0].point.toArray([]):null}}),Object.defineProperty(o,"normal",{get(){$T.ray.origin.fromArray(c.origin),$T.ray.direction.fromArray(c.direction),$T.camera=u._node;let e=[];return l.$raycast($T,e),e.sort(k_),e[0]?e[0].face.normal.transformDirection(e[0].object.worldMatrix).toArray([]):null}}),o}update(e){this._renderTarget&&(this._timer+=e,this._timer>this._interval&&(this._timer=0,this._needsUpdate=!0))}dispose(){this._camera=null,this._array=null,this.renderOptions=null,this._renderTarget&&this._renderTarget.dispose()}_initBuffer(e){this._renderTarget=new Em(e.x,e.y),this._renderTarget.texture.minFilter=Vc.LINEAR,this._renderTarget.texture.generateMipmaps=!1,this._array=new Uint8Array(4*e.x*e.y),this._size.copy(e)}_updateBuffer(e){this._renderTarget.resize(e.x,e.y),this._array=new Uint8Array(4*e.x*e.y),this._size.copy(e),this._needsUpdate=!0}}class rD extends jv{constructor(){super(),this.bufferDependencies=[{key:"SceneBuffer"},{key:"GBuffer"}],this._ssrPass=new Ap(sD),this.maxRayDistance=200,this.pixelStride=16,this.pixelStrideZCutoff=50,this.screenEdgeFadeStart=.9,this.eyeFadeStart=.4,this.eyeFadeEnd=.8,this.minGlossiness=.2,this._blurPass=new Ap(Gv),this._blurPass.material.defines.NORMALTEX_ENABLED=1,this._blurPass.material.defines.DEPTHTEX_ENABLED=1,this.blurSize=2,this.depthRange=1,this._blendPass=new Ap(Wv),this._blendPass.material.premultipliedAlpha=!0}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(0),s=t._renderTargetCache.allocate(0),o=t.getBuffer("SceneBuffer"),l=t.getBuffer("GBuffer"),u=l.getCurrentRenderStates();nD.copy(u.camera.projectionMatrix),iD.copy(u.camera.projectionMatrix).inverse(),aD.copy(u.camera.viewMatrix).inverse().transpose(),e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,1),e.renderPass.clear(!0,!0,!1),this._ssrPass.uniforms.colorTex=o.output()._attachments[Zc.COLOR_ATTACHMENT0],this._ssrPass.uniforms.gBufferTexture1=l.output()._attachments[Zc.COLOR_ATTACHMENT0],this._ssrPass.uniforms.gBufferTexture2=l.output()._attachments[Zc.DEPTH_STENCIL_ATTACHMENT],this._ssrPass.uniforms.viewportSize[0]=l.output().width,this._ssrPass.uniforms.viewportSize[1]=l.output().height,nD.toArray(this._ssrPass.uniforms.projection),iD.toArray(this._ssrPass.uniforms.projectionInv),aD.toArray(this._ssrPass.uniforms.viewInverseTranspose),this._ssrPass.uniforms.maxRayDistance=this.maxRayDistance,this._ssrPass.uniforms.pixelStride=this.pixelStride,this._ssrPass.uniforms.pixelStrideZCutoff=this.pixelStrideZCutoff,this._ssrPass.uniforms.screenEdgeFadeStart=this.screenEdgeFadeStart,this._ssrPass.uniforms.eyeFadeStart=this.eyeFadeStart,this._ssrPass.uniforms.eyeFadeEnd=this.eyeFadeEnd,this._ssrPass.uniforms.minGlossiness=this.minGlossiness,this._ssrPass.render(e),e.renderPass.setRenderTarget(s),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.normalTex=l.output()._attachments[Zc.COLOR_ATTACHMENT0],this._blurPass.uniforms.depthTex=l.output()._attachments[Zc.DEPTH_STENCIL_ATTACHMENT],this._blurPass.uniforms.textureSize[0]=l.output().width,this._blurPass.uniforms.textureSize[1]=l.output().height,nD.toArray(this._blurPass.uniforms.projection),aD.toArray(this._blurPass.uniforms.viewInverseTranspose),this._blurPass.uniforms.blurSize=this.blurSize,this._blurPass.uniforms.depthRange=this.depthRange,this._blurPass.uniforms.direction=0,this._blurPass.uniforms.tDiffuse=a.texture,this._blurPass.render(e),e.renderPass.setRenderTarget(r?a:n),e.renderPass.clear(!0,!0,!1),this._blurPass.uniforms.direction=1,this._blurPass.uniforms.tDiffuse=s.texture,this._blurPass.render(e),r&&(e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=a.texture,this._blendPass.uniforms.colorWeight1=1,this._blendPass.uniforms.alphaWeight1=1,this._blendPass.uniforms.colorWeight2=1,this._blendPass.uniforms.alphaWeight2=0,i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1))),t._renderTargetCache.release(a,0),t._renderTargetCache.release(s,0)}}const nD=new Sc,iD=new Sc,aD=new Sc,sD={name:"ec_ssr",defines:{},uniforms:{colorTex:null,gBufferTexture1:null,gBufferTexture2:null,projection:new Float32Array(16),projectionInv:new Float32Array(16),viewInverseTranspose:new Float32Array(16),maxRayDistance:4,pixelStride:16,pixelStrideZCutoff:10,screenEdgeFadeStart:.9,eyeFadeStart:.4,eyeFadeEnd:.8,minGlossiness:.2,zThicknessThreshold:.1,jitterOffset:0,nearZ:0,viewportSize:[512,512],maxMipmapLevel:5},vertexShader:Vv,fragmentShader:"\n\t\t#define MAX_ITERATION 20;\n\t\t#define MAX_BINARY_SEARCH_ITERATION 5;\n\n\t\tvarying vec2 v_Uv;\n\n\t\tuniform sampler2D colorTex;\n\t\tuniform sampler2D gBufferTexture1;\n\t\tuniform sampler2D gBufferTexture2;\n\n\t\tuniform mat4 projection;\n\t\tuniform mat4 projectionInv;\n\t\tuniform mat4 viewInverseTranspose;\n\n\t\tuniform float maxRayDistance;\n\n\t\tuniform float pixelStride;\n\t\t// ray origin Z at this distance will have a pixel stride of 1.0\n\t\tuniform float pixelStrideZCutoff;\n\n\t\t// distance to screen edge that ray hits will start to fade (0.0 -> 1.0)\n\t\tuniform float screenEdgeFadeStart;\n\n\t\t// ray direction's Z that ray hits will start to fade (0.0 -> 1.0)\n\t\tuniform float eyeFadeStart;\n\t\t// ray direction's Z that ray hits will be cut (0.0 -> 1.0)\n\t\tuniform float eyeFadeEnd;\n\n\t\t// Object larger than minGlossiness will have ssr effect\n\t\tuniform float minGlossiness;\n\t\tuniform float zThicknessThreshold;\n\t\tuniform float jitterOffset;\n\n\t\tuniform float nearZ;\n\t\tuniform vec2 viewportSize;\n\n\t\tuniform float maxMipmapLevel;\n\n\t\tfloat fetchDepth(sampler2D depthTexture, vec2 uv) {\n\t\t\tvec4 depthTexel = texture2D(depthTexture, uv);\n\t\t\treturn depthTexel.r * 2.0 - 1.0;\n\t\t}\n\n\t\tfloat linearDepth(float depth) {\n\t\t\treturn projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n\t\t}\n\n\t\tbool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel) {\n\t\t\t// Swap if bigger\n\t\t\tif (rayZFar > rayZNear) {\n\t\t\t\tfloat t = rayZFar; rayZFar = rayZNear; rayZNear = t;\n\t\t\t}\n\t\t\tfloat cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));\n\t\t\t// float cameraBackZ = linearDepth(fetchDepth(backDepthTex, hitPixel));\n\t\t\t// Cross z\n\t\t\treturn rayZFar <= cameraZ && rayZNear >= cameraZ - zThicknessThreshold;\n\t\t}\n\n\t\t// Trace a ray in screenspace from rayOrigin (in camera space) pointing in rayDir (in camera space)\n\t\t//\n\t\t// With perspective correct interpolation\n\t\t//\n\t\t// Returns true if the ray hits a pixel in the depth buffer\n\t\t// and outputs the hitPixel (in UV space), the hitPoint (in camera space) and the number\n\t\t// of iterations it took to get there.\n\t\t//\n\t\t// Based on Morgan McGuire & Mike Mara's GLSL implementation:\n\t\t// http://casual-effects.blogspot.com/2014/08/screen-space-ray-tracing.html\n\t\tbool traceScreenSpaceRay(vec3 rayOrigin, vec3 rayDir, float jitter, out vec2 hitPixel, out vec3 hitPoint, out float iterationCount) {\n\t\t\t// Clip to the near plane\n\t\t\tfloat rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) > -nearZ) ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;\n\n\t\t\tvec3 rayEnd = rayOrigin + rayDir * rayLength;\n\n\t\t\t// Project into homogeneous clip space\n\t\t\tvec4 H0 = projection * vec4(rayOrigin, 1.0);\n\t\t\tvec4 H1 = projection * vec4(rayEnd, 1.0);\n\n\t\t\tfloat k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\n\n\t\t\t// The interpolated homogeneous version of the camera space points\n\t\t\tvec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;\n\n\t\t\t// Screen space endpoints\n\t\t\t// PENDING viewportSize ?\n\t\t\tvec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;\n\t\t\tvec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;\n\n\t\t\t// If the line is degenerate, make it cover at least one pixel to avoid handling\n\t\t\t// zero-pixel extent as a special case later\n\t\t\tP1 += dot(P1 - P0, P1 - P0) < 0.0001 ? 0.01 : 0.0;\n\t\t\tvec2 delta = P1 - P0;\n\n\t\t\t// Permute so that the primary iteration is in x to collapse\n\t\t\t// all quadrant-specific DDA case later\n\t\t\tbool permute = false;\n\t\t\tif (abs(delta.x) < abs(delta.y)) {\n\t\t\t\t// More vertical line\n\t\t\t\tpermute = true;\n\t\t\t\tdelta = delta.yx;\n\t\t\t\tP0 = P0.yx;\n\t\t\t\tP1 = P1.yx;\n\t\t\t}\n\t\t\tfloat stepDir = sign(delta.x);\n\t\t\tfloat invdx = stepDir / delta.x;\n\n\t\t\t// Track the derivatives of Q and K\n\t\t\tvec3 dQ = (Q1 - Q0) * invdx;\n\t\t\tfloat dk = (k1 - k0) * invdx;\n\n\t\t\tvec2 dP = vec2(stepDir, delta.y * invdx);\n\n\t\t\t// Calculate pixel stride based on distance of ray origin from camera.\n\t\t\t// Since perspective means distant objects will be smaller in screen space\n\t\t\t// we can use this to have higher quality reflections for far away objects\n\t\t\t// while still using a large pixel stride for near objects (and increase performance)\n\t\t\t// this also helps mitigate artifacts on distant reflections when we use a large\n\t\t\t// pixel stride.\n\t\t\tfloat strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);\n\t\t\tfloat pixStride = 1.0 + strideScaler * pixelStride;\n\n\t\t\t// Scale derivatives by the desired pixel stride and the offset the starting values by the jitter fraction\n\t\t\tdP *= pixStride; dQ *= pixStride; dk *= pixStride;\n\n\t\t\t// Track ray step and derivatives in a vec4 to parallelize\n\t\t\tvec4 pqk = vec4(P0, Q0.z, k0);\n\t\t\tvec4 dPQK = vec4(dP, dQ.z, dk);\n\n\t\t\tpqk += dPQK * jitter;\n\t\t\tfloat rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\t\t\tfloat rayZNear;\n\n\t\t\tbool intersect = false;\n\n\t\t\tvec2 texelSize = 1.0 / viewportSize;\n\n\t\t\titerationCount = 0.0;\n\n\t\t\tfor (int i = 0; i < 20; i++) {\n\t\t\t\tpqk += dPQK;\n\n\t\t\t\trayZNear = rayZFar;\n\t\t\t\trayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\n\t\t\t\thitPixel = permute ? pqk.yx : pqk.xy;\n\t\t\t\thitPixel *= texelSize;\n\n\t\t\t\tintersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);\n\n\t\t\t\titerationCount += 1.0;\n\n\t\t\t\t// PENDING Right on all platforms?\n\t\t\t\tif (intersect) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Binary search refinement\n\t\t\t// FIXME If intersect in first iteration binary search may easily lead to the pixel of reflect object it self\n\t\t\tif (pixStride > 1.0 && intersect && iterationCount > 1.0) {\n\t\t\t\t// Roll back\n\t\t\t\tpqk -= dPQK;\n\t\t\t\tdPQK /= pixStride;\n\n\t\t\t\tfloat originalStride = pixStride * 0.5;\n\t\t\t\tfloat stride = originalStride;\n\n\t\t\t\trayZNear = pqk.z / pqk.w;\n\t\t\t\trayZFar = rayZNear;\n\n\t\t\t\tfor (int j = 0; j < 5; j++) {\n\t\t\t\t\tpqk += dPQK * stride;\n\t\t\t\t\trayZNear = rayZFar;\n\t\t\t\t\trayZFar = (dPQK.z * -0.5 + pqk.z) / (dPQK.w * -0.5 + pqk.w);\n\t\t\t\t\thitPixel = permute ? pqk.yx : pqk.xy;\n\t\t\t\t\thitPixel *= texelSize;\n\n\t\t\t\t\toriginalStride *= 0.5;\n\t\t\t\t\tstride = rayIntersectDepth(rayZNear, rayZFar, hitPixel) ? -originalStride : originalStride;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tQ0.xy += dQ.xy * iterationCount;\n\t\t\tQ0.z = pqk.z;\n\t\t\thitPoint = Q0 / pqk.w;\n\n\t\t\treturn intersect;\n\t\t}\n\n\t\tfloat calculateAlpha(float iterationCount, float reflectivity, vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir) {\n\t\t\tfloat alpha = clamp(reflectivity, 0.0, 1.0);\n\t\t\t// Fade ray hits that approach the maximum iterations\n\t\t\talpha *= 1.0 - (iterationCount / float(20));\n\t\t\t// Fade ray hits that approach the screen edge\n\t\t\tvec2 hitPixelNDC = hitPixel * 2.0 - 1.0;\n\t\t\tfloat maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));\n\t\t\talpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);\n\n\t\t\t// Fade ray hits base on how much they face the camera\n\t\t\tfloat _eyeFadeStart = eyeFadeStart;\n\t\t\tfloat _eyeFadeEnd = eyeFadeEnd;\n\t\t\tif (_eyeFadeStart > _eyeFadeEnd) {\n\t\t\t\tfloat tmp = _eyeFadeEnd;\n\t\t\t\t_eyeFadeEnd = _eyeFadeStart;\n\t\t\t\t_eyeFadeStart = tmp;\n\t\t\t}\n\n\t\t\tfloat eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);\n\t\t\talpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);\n\n\t\t\t// Fade ray hits based on distance from ray origin\n\t\t\talpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);\n\n\t\t\treturn alpha;\n\t\t}\n\n\t\tvoid main() {\n\t\t\tvec4 normalAndGloss = texture2D(gBufferTexture1, v_Uv);\n\n\t\t\t// Is empty\n\t\t\tif (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat g = normalAndGloss.a;\n\t\t\tif (g <= minGlossiness) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat reflectivity = (g - minGlossiness) / (1.0 - minGlossiness);\n\n\t\t\tvec3 N = normalAndGloss.rgb * 2.0 - 1.0;\n\t\t\tN = normalize((viewInverseTranspose * vec4(N, 0.0)).xyz);\n\n\t\t\t// Position in view\n\t\t\tvec4 projectedPos = vec4(v_Uv * 2.0 - 1.0, fetchDepth(gBufferTexture2, v_Uv), 1.0);\n\t\t\tvec4 pos = projectionInv * projectedPos;\n\t\t\tvec3 rayOrigin = pos.xyz / pos.w;\n\n\t\t\tvec3 rayDir = normalize(reflect(normalize(rayOrigin), N));\n\t\t\tvec2 hitPixel;\n\t\t\tvec3 hitPoint;\n\t\t\tfloat iterationCount;\n\n\t\t\t// Get jitter\n\t\t\tvec2 uv2 = v_Uv * viewportSize;\n\t\t\tfloat jitter = fract((uv2.x + uv2.y) * 0.25);\n\n\t\t\tbool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);\n\n\t\t\tfloat dist = distance(rayOrigin, hitPoint);\n\n\t\t\tfloat alpha = calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir) * float(intersect);\n\n\t\t\tvec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;\n\t\t\thitNormal = normalize((viewInverseTranspose * vec4(hitNormal, 0.0)).xyz);\n\n\t\t\t// Ignore the pixel not face the ray\n\t\t\t// TODO fadeout ?\n\t\t\t// PENDING Can be configured?\n\t\t\tif (dot(hitNormal, rayDir) >= 0.0) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\t// vec4 color = decodeHDR(texture2DLodEXT(colorTex, hitPixel, clamp(dist / maxRayDistance, 0.0, 1.0) * maxMipmapLevel));\n\n\t\t\tif (!intersect) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tvec4 color = texture2D(colorTex, hitPixel);\n\t\t\tgl_FragColor = vec4(color.rgb * alpha, color.a);\n\n\t\t\t// gl_FragColor = vec4(vec3(iterationCount / 2.0), 1.0);\n\n\t\t}\n    "};class oD{constructor(e,t,r){this._rt=new Em(e,t),this._rt.texture.minFilter=Vc.NEAREST,this._rt.texture.magFilter=Vc.NEAREST,this._rt.texture.generateMipmaps=!1,this._uvMaterialCache=new lD}render(e,t,r,n){e.renderPass.setRenderTarget(this._rt),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!1);const i=this._uvMaterialCache,a=r.getRenderStates(n),s=r.getRenderQueue(n).getLayer(0);e.renderRenderableList(s.opaque,a,{getMaterial:e=>{const t=i.getUvMaterial(e);return t.side=e.material.side,t},ifRender:e=>!!e.geometry.getAttribute("a_Uv")}),e.renderRenderableList(s.transparent,a,{getMaterial:e=>{const t=i.getUvMaterial(e);return t.side=e.material.side,t},ifRender:e=>!!e.geometry.getAttribute("a_Uv")})}output(){return this._rt}resize(e,t){this._rt.resize(e,t)}dispose(){this._rt.dispose()}}class lD{constructor(){this._map=new Map,this._weakMap=new WeakMap}getUvMaterial(e){let t=this._weakMap.get(e.material);if(!t){const r=e.object.isSkinnedMesh&&e.object.skeleton,n=!!e.object.morphTargetInfluences;let i=0;r&&(i=e.object.skeleton.boneTexture?1024:e.object.skeleton.bones.length);const a=r+"_"+i+"_"+n;if(t=this._map.get(a),!t){const o=new bp(uD);t={refCount:0,material:o},this._map.set(a,t)}function s(){e.material.removeEventListener("dispose",s),this._weakMap.delete(e.material),t.refCount--,t.refCount<=0&&this._map.delete(a)}this._weakMap.set(e.material,t),t.refCount++,e.material.addEventListener("dispose",s)}return t.material}}const uD={name:"uv_shader",defines:{},uniforms:{},vertexShader:"\n        #include <common_vert>\n        #include <morphtarget_pars_vert>\n        #include <skinning_pars_vert>\n        \n        uniform mat3 uvTransform;\n        attribute vec2 a_Uv;\n        varying vec2 v_Uv;\n\n\t\t#include <logdepthbuf_pars_vert>\n        void main() {\n        \tv_Uv = (uvTransform * vec3(a_Uv, 1.)).xy;\n        \t#include <begin_vert>\n        \t#include <morphtarget_vert>\n        \t#include <skinning_vert>\n        \t#include <pvm_vert>\n\t\t\t#include <logdepthbuf_vert>\n        }\n    ",fragmentShader:"\n        #include <common_frag>\n\n        varying vec2 v_Uv;\n\n\t\t#include <logdepthbuf_pars_frag>\n\n        void main() {\n\t\t\t#include <logdepthbuf_frag>\n\n            int whichColorX = int(mod(v_Uv.x * 10.0, 2.0));\n            int whichColorY = int(mod(v_Uv.y * 10.0, 2.0));\n\n            float c = abs(float(sign(whichColorX + whichColorY - 1)));\n\n            gl_FragColor = vec4(vec3(c), 1.);\n        }\n    "};class cD extends Cx{constructor(){super(),this.bufferDependencies=["UVBuffer"],this._mainPass=new Ap(qv)}render(e,t,r){e.renderPass.setRenderTarget(r),e.renderPass.setClearColor(0,0,0,1),e.renderPass.clear(!0,!0,!1);const n=t.getBuffer("UVBuffer");this._mainPass.uniforms.tDiffuse=n.output()._attachments[Zc.COLOR_ATTACHMENT0],this._mainPass.render(e)}}class hD{constructor(e,t){this._occlusionRenderTarget=new Em(e,t),this._occlusionRenderTarget.texture.minFilter=Vc.NEAREST,this._occlusionRenderTarget.texture.magFilter=Vc.NEAREST,this._occlusionRenderTarget.texture.generateMipmaps=!1,this.lensflareInfos=[]}syncDepthAttachments(e,t){const r=this._occlusionRenderTarget;r.dispose(),$v(e)?(r.attach(e,Zc.DEPTH_STENCIL_ATTACHMENT),r.detach(Zc.DEPTH_ATTACHMENT)):(r.attach(e,Zc.DEPTH_ATTACHMENT),r.detach(Zc.DEPTH_STENCIL_ATTACHMENT))}render(e,t,r,n){const i=r.getRenderStates(n),a=r.getRenderQueue(n).getLayer(5);if(!a)return;e.renderPass.setRenderTarget(this._occlusionRenderTarget),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!1,!1);const s=this._occlusionRenderTarget.height/this._occlusionRenderTarget.width;this.lensflareInfos.length=0,e.renderRenderableList(a.opaque,i,{beforeRender:e=>{const{object:t,material:r}=e;dD.setFromMatrixPosition(t.worldMatrix).applyMatrix4(n.viewMatrix).applyMatrix4(n.projectionMatrix),dD.toArray(r.uniforms.screenPosition),r.uniforms.scale[0]=r.uniforms.scale[1]*s,this.lensflareInfos.push({screenX:dD.x,screenY:dD.y,scaleX:r.uniforms.scale[0],scaleY:r.uniforms.scale[1],elements:t.lensflareElements})}})}output(){return this._occlusionRenderTarget}resize(e,t){this._occlusionRenderTarget.resize(e,t)}dispose(){this._occlusionRenderTarget.dispose()}}const dD=new bc;class pD extends jv{constructor(){super(),this.bufferDependencies=[{key:"SceneBuffer"},{key:"LensflareBuffer"}],this._clipPass=new Ap(fD),this._lensflarePass=new Ap(mD),this._lensflarePass.material.transparent=!0,this._lensflarePass.material.blending=Bc.ADD,this._lensflarePass.material.depthWrite=!1,this._blendPass=new Ap(Wv),this._clippedRT=new Em(64,64),this._clippedRT.texture.minFilter=Vc.NEAREST,this._clippedRT.texture.magFilter=Vc.NEAREST,this._clippedRT.texture.generateMipmaps=!1,this.active=!1}render(e,t,r,n,i){const a=t._renderTargetCache.allocate(0),s=t.getBuffer("LensflareBuffer"),o=s.lensflareInfos;e.renderPass.setRenderTarget(a),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!0),o.forEach((({screenX:t,screenY:r,scaleX:n,scaleY:i,elements:o})=>{e.renderPass.setRenderTarget(this._clippedRT),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!0),this._clipPass.uniforms.tDiffuse=s.output().texture,this._clipPass.uniforms.clipRect[0]=.5*(t-n)+.5,this._clipPass.uniforms.clipRect[1]=.5*(r-i)+.5,this._clipPass.uniforms.clipRect[2]=n,this._clipPass.uniforms.clipRect[3]=i,this._clipPass.render(e),e.renderPass.setRenderTarget(a),o.forEach((({texture:n,color:i,scale:s,offset:o})=>{const l=2*-t,u=2*-r,c=this._lensflarePass.material;c.uniforms.map=n,c.uniforms.occlusionMap=this._clippedRT.texture,c.uniforms.screenPosition[0]=t+l*o,c.uniforms.screenPosition[1]=r+u*o,c.uniforms.scale[0]=s*a.height/a.width,c.uniforms.scale[1]=s,i.toArray(c.uniforms.color),e.renderPass.render(this._lensflarePass.renderQueueLayer.opaque[0],this._lensflarePass.renderStates,this._lensflarePass.renderConfig)}))})),e.renderPass.setRenderTarget(n),e.renderPass.setClearColor(0,0,0,0),i?e.renderPass.clear(t.clearColor,t.clearDepth,t.clearStencil):e.renderPass.clear(!0,!0,!1),this._blendPass.uniforms.texture1=r.texture,this._blendPass.uniforms.texture2=a.texture,this._blendPass.uniforms.colorWeight1=1,this._blendPass.uniforms.alphaWeight1=1,this._blendPass.uniforms.colorWeight2=1,this._blendPass.uniforms.alphaWeight2=1,i&&(this._blendPass.material.transparent=t._tempClearColor[3]<1||!t.clearColor,this._blendPass.renderStates.camera.rect.fromArray(t._tempViewport)),this._blendPass.render(e),i&&(this._blendPass.material.transparent=!1,this._blendPass.renderStates.camera.rect.set(0,0,1,1)),t._renderTargetCache.release(a,0)}resize(e,t){}dispose(){this._clippedRT.dispose()}}const fD={name:"lensflare_clip",defines:{},uniforms:{tDiffuse:null,clipRect:[0,0,1,1]},vertexShader:"\n\t\tattribute vec3 a_Position;\n\t\tattribute vec2 a_Uv;\n\n\t\tuniform mat4 u_ProjectionView;\n\t\tuniform mat4 u_Model;\n\n\t\tuniform vec4 clipRect;\n\n\t\tvarying vec2 v_Uv;\n\n\t\tvoid main() {\n\t\t\tv_Uv = a_Uv * clipRect.zw + clipRect.xy;\n\t\t\tgl_Position = u_ProjectionView * u_Model * vec4(a_Position, 1.0);\n\t\t}\n\t",fragmentShader:"\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 v_Uv;\n\n\t\tvoid main() {\n\t\t\tvec4 texel = texture2D(tDiffuse, v_Uv);\n\t\t\tgl_FragColor = texel;\n\t\t}\n\t"},mD={name:"lensflare",defines:{},uniforms:{map:null,occlusionMap:null,color:[1,1,1],scale:[1,1],screenPosition:[0,0,0]},vertexShader:"\n\t\tuniform vec3 screenPosition;\n\t\tuniform vec2 scale;\n\n\t\tuniform sampler2D occlusionMap;\n\n\t\tattribute vec3 a_Position;\n\t\tattribute vec2 a_Uv;\n\n\t\tvarying vec2 v_Uv;\n\t\tvarying float v_Visibility;\n\n\t\tvoid main() {\n\t\t\tv_Uv = a_Uv;\n\n\t\t\tvec2 pos = a_Position.xz;\n\t\t\tpos.y = -pos.y;\n\n\t\t\tvec4 visibility = texture2D(occlusionMap, vec2(0.5, 0.5)) * 0.2;\n\t\t\tvisibility += texture2D(occlusionMap, vec2(0.34, 0.34)) * 0.1;\n\t\t\tvisibility += texture2D(occlusionMap, vec2(0.34, 0.66)) * 0.1;\n\t\t\tvisibility += texture2D(occlusionMap, vec2(0.66, 0.34)) * 0.1;\n\t\t\tvisibility += texture2D(occlusionMap, vec2(0.66, 0.66)) * 0.1;\n\t\t\tvisibility += texture2D(occlusionMap, vec2(0.18, 0.5)) * 0.1;\n\t\t\tvisibility += texture2D(occlusionMap, vec2(0.82, 0.5)) * 0.1;\n\t\t\tvisibility += texture2D(occlusionMap, vec2(0.5, 0.18)) * 0.1;\n\t\t\tvisibility += texture2D(occlusionMap, vec2(0.5, 0.82)) * 0.1;\n\n\t\t\tv_Visibility = visibility.r;\n\n\t\t\tgl_Position = vec4(pos * scale + screenPosition.xy, screenPosition.z, 1.0);\n\t\t}\n\t",fragmentShader:"\n\t\tuniform sampler2D map;\n\t\tuniform vec3 color;\n\n\t\tvarying vec2 v_Uv;\n\t\tvarying float v_Visibility;\n\n\t\tvoid main() {\n\t\t\tvec4 texture = texture2D(map, v_Uv);\n\t\t\ttexture.a *= v_Visibility;\n\t\t\tgl_FragColor = texture;\n\t\t\tgl_FragColor.rgb *= color;\n\t\t}\n\t"};class gD extends Cx{constructor(){super(),this.bufferDependencies=["SceneBuffer","LensflareBuffer"],this._mainPass=new Ap(qv)}render(e,t,r){e.renderPass.setRenderTarget(r),e.renderPass.setClearColor(0,0,0,1),e.renderPass.clear(!0,!0,!1);const n=t.getBuffer("LensflareBuffer");this._mainPass.uniforms.tDiffuse=n.output()._attachments[Zc.COLOR_ATTACHMENT0],this._mainPass.render(e)}}const _D={temporalSuperSampling:{enable:!1,size:30},postEffect:{enable:!0,bloom:{enable:!1,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!1,radius:.2,quality:"Medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},screenSpaceReflection:{enable:!1,maxRayDistance:200,pixelStride:16,pixelStrideZCutoff:50,screenEdgeFadeStart:.9,eyeFadeStart:.4,eyeFadeEnd:.8,minGlossiness:.2,temporalFilter:!0},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.1,saturation:1.1,gamma:1},dof:{enable:!1,focalDepth:1,focalLength:24,fstop:.9,maxblur:1,threshold:.9,gain:1,bias:.5,dithering:1e-4},vignetting:{enable:!1,color:[0,0,0],offset:1},blurEdge:{enable:!1,offset:1},film:{enable:!1,grayscale:!0,noiseIntensity:.35,scanlinesIntensity:.5,scanlinesCount:2048},chromaticAberration:{enable:!1,chromaFactor:.025},FXAA:{enable:!1},MSAA:{enable:!0}}};let vD,yD,xD,bD,AD,SD,ED,wD;class CD extends wx{constructor(){super(...arguments),this.isWebgl2=!!arguments[2].webgl2,this.removeEffect("SSR"),this.addEffect("SSR",new rD,1),this.addBuffer("UVBuffer",new oD(arguments[0],arguments[1],{})),this.addBuffer("LensflareBuffer",new hD(arguments[0],arguments[1])),this.addEffect("Lensflare",new pD,101.5),this._syncAttachments(),this._effectList.forEach((e=>{e.effect.$enable=!0,e.effect.enable=function(e){this.active=this.$enable&&e}})),this._config=U_({},_D),this._syncConfig()}setConfig(e){this._config=U_(this._config,e),this._syncConfig()}getConfig(){return this._config}_syncConfig(){const e=this._config,t=this.getEffect("Bloom"),r=e.postEffect.bloom;t.enable(e.postEffect.enable&&r.enable),t.threshold=r.threshold,t.strength=r.strength,t.blurSize=5*r.radius;const n=this.getEffect("SSAO"),i=e.postEffect.screenSpaceAmbientOcclusion;n.enable(e.postEffect.enable&&i.enable),n.radius=i.radius,n.intensity=i.intensity,n.quality=(e=>{if(!e)return;let t=e;return t=t.toLowerCase(),t.charAt(0).toUpperCase()+t.slice(1)})(i.quality);const a=this.getEffect("SSR"),s=e.postEffect.screenSpaceReflection;a.enable(e.postEffect.enable&&s.enable),a.maxRayDistance=s.maxRayDistance,a.pixelStride=s.pixelStride,a.pixelStrideZCutoff=s.pixelStrideZCutoff,a.screenEdgeFadeStart=s.screenEdgeFadeStart,a.eyeFadeStart=s.eyeFadeStart,a.eyeFadeEnd=s.eyeFadeEnd,a.minGlossiness=s.minGlossiness;const o=this.getEffect("ColorCorrection"),l=e.postEffect.colorCorrection;o.enable(e.postEffect.enable&&l.enable),o.exposure=l.exposure,o.brightness=l.brightness,o.contrast=l.contrast,o.saturation=l.saturation,o.gamma=l.gamma;const u=this.getEffect("DOF"),c=e.postEffect.dof;u.enable(e.postEffect.enable&&c.enable),u.focalDepth=c.focalDepth,u.focalLength=c.focalLength,u.fstop=c.fstop,u.maxblur=c.maxblur,u.threshold=c.threshold,u.gain=c.gain,u.bias=c.bias,u.dithering=c.dithering;const h=this.getEffect("FXAA"),d=e.postEffect.FXAA;h.enable(e.postEffect.enable&&d.enable);const p=e.postEffect.MSAA;this.sceneMSAA=this.isWebgl2&&p.enable,this.isWebgl2||console.warn("MSAA is not supported in webgl1, use FXAA instead.");const f=this.getEffect("ChromaticAberration"),m=e.postEffect.chromaticAberration;f.enable(e.postEffect.enable&&m.enable),f.chromaFactor=m.chromaFactor;const g=e.postEffect.vignetting;if(g){const t=this.getEffect("Vignetting");t.enable(e.postEffect.enable&&g.enable),t.color.fromArray(g.color),t.offset=g.offset}const _=e.postEffect.blurEdge;if(_){const t=this.getEffect("BlurEdge");t.enable(e.postEffect.enable&&_.enable),t.offset=_.offset}const v=this.getEffect("Film"),y=e.postEffect.film;v.enable(e.postEffect.enable&&y.enable),v.grayscale=y.grayscale,v.noiseIntensity=y.noiseIntensity,v.scanlinesIntensity=y.scanlinesIntensity,v.scanlinesCount=y.scanlinesCount}$setDebug(e){switch(e[0]){case"GBuffer":vD||(vD=new Dx),vD.debugType=void 0!==Dx.DebugTypes[e[1]]?Dx.DebugTypes[e[1]]:Dx.DebugTypes.Depth,this.debugger=vD;break;case"SSAO":yD||(yD=new Nx),this.debugger=yD;break;case"SSR":xD||(xD=new Bx),this.debugger=xD;break;case"NonDepthMarkBuffer":bD||(bD=new Rx),bD.channel=e[1]?e[1]:"",bD.mask=ey[e[2]]?ey[e[2]]:ey.ALL,this.debugger=bD;break;case"MarkBuffer":AD||(AD=new Fx),AD.channel=e[1]?e[1]:"",AD.mask=ey[e[2]]?ey[e[2]]:ey.ALL,this.debugger=AD;break;case"ColorMarkBuffer":SD||(SD=new Tx),SD.channel=e[1]?e[1]:"",SD.mask=ey[e[2]]?ey[e[2]]:ey.ALL,this.debugger=SD;break;case"LensflareBuffer":ED||(ED=new gD),this.debugger=ED;break;case"UVBuffer":wD||(wD=new cD),this.debugger=wD}}}class TD{constructor(e){this._customRenderLayers=e.getBuffer("SceneBuffer").renderLayers,this.layerMap=new Map,this.layerMap.set("MarkerLayer",{id:8,mask:15}),this._customRenderLayers.push({id:8,mask:15})}_insertFirst(e,t){this.layerMap.has(e)||(this.layerMap.set(e,t),this._customRenderLayers.unshift(t))}add(e,t){this.layerMap.has(e)||(this.layerMap.set(e,t),this._customRenderLayers.splice(this._customRenderLayers.length-1,0,t))}remove(e){const t=this.layerMap.get(e),r=this._customRenderLayers.indexOf(t);-1!==r&&this._customRenderLayers.splice(r,1),this.layerMap.delete(e)}has(e){return!!this.layerMap.get(e)}getIndex(e){const t=this.layerMap.get(e);return this._customRenderLayers.indexOf(t)}count(){return this._customRenderLayers.length}reset(){this._customRenderLayers.length=0,this.layerMap.clear()}}const DD=["GBufferNormal","GBufferPosition","GBufferDepth","GBufferGlossiness","SSAO","SSR","NonDepthMarkBuffer","MarkBuffer","ColorMarkBuffer","LensflareBuffer","UVBuffer","GPUPick"],MD=e=>{let t;switch(e){case"All":t="ALL";break;case"Opaque":t="OPAQUE";break;case"Transparent":t="TRANSPARENT"}return t},PD=new bc,FD=new Sc,RD=new Sc,ND=new Sc,BD=new Mc,ID=new Map,OD=[],kD=[],LD=new Em(4,4);LD.texture.minFilter=Vc.NEAREST,LD.texture.magFilter=Vc.NEAREST,LD.texture.generateMipmaps=!1;const UD=new Ap({name:"empty_shader",uniforms:{},vertexShader:"\n\t\tvoid main() {\n\t\t\tgl_Position = vec4(0., 0., 0., 1.);\n\t\t}\n\t",fragmentShader:"\n\t\tvoid main() {\n\t\t\tgl_FragColor = vec4(0., 0., 0., 0.);\n\t\t}\n\t"}),zD={direction:{directGLShadowMaps:[],directional:[],directionalShadow:[],directionalShadowMatrix:[]}};class jD extends mb{constructor(e,t,r={}){super(e),this.$uAppView=t,this._size=new xh(512,512),this._node=new qT,this._node.$unode=this,this._node.gammaFactor=1.5,this._node.outputEncoding=Xc.GAMMA,this._skyBox=new Zm,this._skyBox.renderLayer=2,this._skyBox.userData.layerMask=-1,this._skyPlane=new GT,this._skyPlane.renderLayer=2,this._skyPlane.userData.layerMask=-1,this._colorPlane=new WT,this._colorPlane.renderLayer=2,this._colorPlane.userData.layerMask=-1,this.$background=null,this._picker=new class{constructor(e){this._camera=e}pick(e,t=this._camera.$uScene.getRoot()){let r;QT.fromArray(e),this._camera._node.isOrthographicCamera&&(r="orthographic"),YT.setFromCamera(QT,this._camera._node,r);let n=[];if(ZT(t,YT,n,!0),n.sort(k_),!n[0])return null;let i={};const a=n[0];return i.node=a._node,i.mesh=a.object,i.subNodeName=a.object.name,Object.defineProperty(i,"position",{get:()=>a.point.toArray([])}),Object.defineProperty(i,"normal",{get:()=>a.face.normal.transformDirection(a.object.worldMatrix).toArray([])}),i}intersectNodeInRegion(e,t,r=.01){let n=!1;return KT.min.fromArray(e,0),KT.max.fromArray(e,2),O_(t._node,(e=>{e.isMesh&&!n&&(n=((e,t,r,n)=>{const i=e.geometry,a=e.worldMatrix,s=i.index,o=i.getAttribute("a_Position"),l=o.buffer.array;if(null!==s){const e=s.buffer.array,i=Math.max(1,Math.floor(s.buffer.count*n));for(let n=0,o=s.buffer.count;n<o;n+=i)if(XT.set(l[3*e[n]],l[3*e[n]+1],l[3*e[n]+2]),XT.applyMatrix4(a).project(t),r.containsPoint(XT))return!0}else if(void 0!==o){const e=Math.max(1,Math.floor(o.buffer.count*n));for(let n=0,i=o.buffer.count;n<i;n+=e){const e=o.buffer.array;if(XT.set(e[n],e[n+1],e[n+2]),XT.applyMatrix4(a).project(t),r.containsPoint(XT))return!0}}return!1})(e,this._camera._node,KT,r))})),n}dispose(){this._camera=null}}(this),this._gpuPicker=new tD(this),this._viewport=new Zh(0,0,512,512),this._cameraRect=new Zh(0,0,1,1),this._tempViewport=[0,0,1,1];const n=new Bd;n._left=-10,n._right=10,n._bottom=-10,n._top=10,n._near=.1,n._far=10,n.setOrtho(-10,10,-10,10,.1,10),n.updateMatrix(),this._overlayCamera=n,this._msaaSamplerNumber=Math.min(t.$renderer.renderPass.capabilities.maxSamples,5);const i=new CD(512,512,{samplerNumber:this._msaaSamplerNumber,webgl2:2===t.$renderer.renderPass.capabilities.version,floatColorBuffer:!!t.$renderer.renderPass.capabilities.getExtension("EXT_color_buffer_float"),stencil:r.stencil,inputTexture:r.inputTexture,inputDepthTexture:r.inputDepthTexture});this._composer=i;const a=this._node,s=function(e){let t=e.object.userData.layerMask;if(-1===t)return!0;t=void 0===t?1:t;let r=a.userData.layerMask;return r=void 0===r?1:r,!!(r&t)};this.customRenderLayerManager=new TD(i),this.customRenderLayerManager._insertFirst("BackgroundLayer",{id:2,mask:15});const o=i.getBuffer("SceneBuffer"),l=i.getBuffer("NonDepthMarkBuffer"),u=i.getBuffer("GBuffer"),c=i.getBuffer("MarkBuffer"),h=i.getBuffer("ColorMarkBuffer");o.setOutputEncoding(Xc.GAMMA),o._sceneRenderOptions.renderInfo=e._renderInfo;const d=o.renderLayers.findIndex((e=>0===e.id));o.renderLayers[d].options={getGeometry:e=>g.getGeometry(e),ifRender:s,renderInfo:e._renderInfo},o._sceneRenderOptions.lastRenderOrder=0,o._sceneRenderOptions.beforeRender=e=>{e.renderOrder!==o._sceneRenderOptions.lastRenderOrder&&(t.$renderer.renderPass.clear(!1,!0,!1),o._sceneRenderOptions.lastRenderOrder=e.renderOrder)},l.layers.push(1,8),u.layers.push(1,8),c.layers.push(1,8),h.layers.push(1,8);const p=e.$auxiliaryMarkerBufferManager;c.setMaterialReplaceFunction((e=>p.getMaterial(e))),l.setMaterialReplaceFunction((e=>p.getMaterial(e)));const f=e.$auxiliaryColorMarkerBufferManager;h.setMaterialReplaceFunction((e=>f.getMaterial(e)));const m=e.$auxiliaryGBufferManager;u.setMaterialReplaceFunction((e=>m.getMaterial(e)));const g=e.$wireframeManager;h.setGeometryReplaceFunction((e=>g.getGeometry(e))),u.setGeometryReplaceFunction((e=>g.getGeometry(e))),c.setGeometryReplaceFunction((e=>g.getGeometry(e))),l.setGeometryReplaceFunction((e=>g.getGeometry(e))),o.setGeometryReplaceFunction((e=>g.getGeometry(e))),t.$renderer.shadowMapPass.getGeometry=e=>g.getGeometry(e),h.setIfRenderReplaceFunction(s),u.setIfRenderReplaceFunction(s),c.setIfRenderReplaceFunction(s),l.setIfRenderReplaceFunction(s),o.setIfRenderReplaceFunction(s),t.$renderer.shadowMapPass.ifRender=function(e){return!!s(e)&&(e.object.castShadow&&e.object.material.opacity>1e-8)},this._clearColorBuffer=!0,this._clearDepthBuffer=!0,this._clearStencilBuffer=!0,this._fogConfig={enable:!1,type:"Linear",color:[1,1,1],near:1,far:1e3,density:25e-5},this.$pickBufferDebug=!1,e.$transformCache.addResident(this),this._glColorAttachment=null,this._glDepthAttachment=null,this._colorAttachment=null,this._depthAttachment=null,this._skyBoxRotation=new Mc,this._debuggerType=null,this._renderFunctionList=[],this._onAfterShadowRender=null}get isCamera(){return!0}getType(){return"Camera"}getDebuggerType(){return this._debuggerType}setDebuggerType(e,t){-1===DD.indexOf(e)&&null!==e&&(console.warn("setDebuggerType: Invalid type value <"+e+">."),e=null);const r=[];switch(e){case"GBufferNormal":r[0]="GBuffer",r[1]="Normal";break;case"GBufferPosition":r[0]="GBuffer",r[1]="Position";break;case"GBufferDepth":r[0]="GBuffer",r[1]="Depth";break;case"GBufferGlossiness":r[0]="GBuffer",r[1]="Glossiness";break;case"SSAO":case"SSR":case"LensflareBuffer":case"UVBuffer":r[0]=e;break;case"GPUPick":this._composer.debugger=null,this.$pickBufferDebug=!0;break;case"NonDepthMarkBuffer":const i=t.channel?t.channel:"outline";let a;t.color&&(a=Array.isArray(t.color)?"0x"+("000000"+(255*(n=t.color)[0]<<16^255*n[1]<<8^255*n[1]<<0).toString(16)).slice(-6):t.color),r[0]=e,r[1]=i+"_"+a,r[2]=t.mode?MD(t.mode):"ALL";break;case"MarkBuffer":case"ColorMarkBuffer":r[0]=e,r[1]=t.channel?t.channel:"Glow",r[2]=t.mode?MD(t.mode):"ALL";break;default:this.$pickBufferDebug=!1,this._composer.debugger=null}var n;0!==r.length&&(this.$pickBufferDebug=!1,this._composer.$setDebug(r)),this._debuggerType=e}addRenderFunction(e){this._renderFunctionList.push(e)}removeRenderFunction(e){const t=this._renderFunctionList,r=this._renderFunctionList.indexOf(e);r>-1&&t.splice(r,1)}_traverseBuffers(e,t){const r=e.bufferDependencies,n=this._composer;for(let e=0,i=r.length;e<i;e++){const i=r[e].key;if("SceneBuffer"===i)continue;t(n.getBuffer(i))}}_traverseOutlineEffect(e){const t=this.$uScene.$effectsManager._outlineManager,r=this._composer._effectList;for(let n=0,i=r.length;n<i;n++){const i=r[n].effect;t.isOutlineEffect(i.name)&&e(i)}}_getEffect(e){return this._composer.getEffect(F_[e])}_dirtyOutlineEffect(){const e=this;this._traverseOutlineEffect((t=>{e._traverseBuffers(t,(e=>{e.needsUpdate=!0}))}))}_dirtyCommonEffect(e){const t=this._getEffect(e);this._traverseBuffers(t,(e=>{e.needsUpdate=!0}))}dirtyEffect(e){if(e)"outline"===e?this._dirtyOutlineEffect():this._dirtyCommonEffect(e);else{for(const e in F_)this._dirtyCommonEffect(e);this._dirtyOutlineEffect()}}_setAutoUpdateOutlineEffect(e){const t=this;this._traverseOutlineEffect((r=>{t._traverseBuffers(r,(t=>{t.autoUpdate=e}))}))}_setAutoUpdateCommonEffect(e,t){const r=this._getEffect(e);this._traverseBuffers(r,(e=>{e.autoUpdate=t}))}setAutoUpdateEffect(e,t){if(e)"outline"===e?this._setAutoUpdateOutlineEffect(t):this._setAutoUpdateCommonEffect(e,t);else{for(const e in F_)this._setAutoUpdateCommonEffect(e,t);this._setAutoUpdateOutlineEffect(t)}}setAttribute(e,t){"OrthoDistance"===e?(this._node.orthographicDistance=t,this._node.updateProjectionMatrix()):"ClearColorBuffer"===e?this._clearColorBuffer=t:"ClearDepthBuffer"===e?this._clearDepthBuffer=t:"ClearStencilBuffer"===e?this._clearStencilBuffer=t:"AfterRenderShadow"===e&&(this._onAfterShadowRender=t),super.setAttribute(e,t)}getAttribute(e){if("OrthoDistance"===e)return this._node.orthographicDistance;if("ClearColorBuffer"===e)return this._clearColorBuffer;if("ClearDepthBuffer"===e)return this._clearDepthBuffer;if("ClearStencilBuffer"===e)return this._clearStencilBuffer;if("ShowPickerBuffer"===e)return this.$pickBufferDebug;return super.getAttribute(e)}getForward(e){this._node.updateWorldMatrix(!0);let t=this._node.worldMatrix.elements;return PD.set(-t[8],-t[9],-t[10]).normalize().toArray(e)}setSize(e){this._size.fromArray(e),this._node.aspect=this._size.x/this._size.y,this._node.updateProjectionMatrix(),this._composer.resize(this._size.x,this._size.y);const t=this._overlayCamera;t._left=-this._size.x/2,t._right=this._size.x/2,t._bottom=-this._size.y/2,t._top=this._size.y/2,t.setOrtho(t._left,t._right,t._bottom,t._top,t._near,t._far),t.updateMatrix()}getSize(e){return this._size.toArray(e)}getAspect(){return this._node.aspect}setFov(e){this._node.fov=e,this._node.updateProjectionMatrix()}getFov(){return this._node.fov}getOrthographicRect(e){return e[0]=this._node.left,e[1]=this._node.right,e[2]=this._node.bottom,e[3]=this._node.top,e}setNear(e){this._node.near=e,this._node.updateProjectionMatrix()}getNear(){return this._node.near}setFar(e){this._node.far=e,this._node.updateProjectionMatrix()}getFar(){return this._node.far}setProjectionMatrixWeight(e){this._node.projectionWeight=e,this._node.lerpMatrixUpdate()}getProjectionMatrixWeight(){return this._node.projectionWeight}getProjectionMatrix(e){return this._node.projectionMatrix.toArray(e)}screenToWorld(e,t){const r=this._screenToNDC(e,OD),n=void 0!==e[2]&&null!==e[2]?e[2]:-1;return PD.fromArray([r[0],r[1],n]).unproject(this._node).toArray(t)}worldToScreen(e,t){var r=this._size,n=r.x/2,i=r.y/2;return PD.fromArray(e).project(this._node).toArray(t),t[0]=Math.round(t[0]*n+n),t[1]=Math.round(-t[1]*i+i),t}copy(e){return super.copy(e),this._size.copy(e._size),this.$background=e.$background,this._viewport.copy(e._viewport),this._overlayCamera.copy(e._overlayCamera),this._composer.resize(e._size.x,e._size.y),this._clearColorBuffer=e._clearColorBuffer,this._clearDepthBuffer=e._clearDepthBuffer,this._clearStencilBuffer=e._clearStencilBuffer,this.$pickBufferDebug=e.$pickBufferDebug,this}clone(){return new this.constructor(this._uScene,this.$uAppView).copy(this)}dispose(){this._uScene.$transformCache.removeResident(this),super.dispose(),this._picker.dispose(),this._gpuPicker.dispose(),this._composer.dispose(),ID.delete(this)}setBackground(e,t){switch(this.clearBackground(),e){case"Color":this._colorPlane.material.diffuse.fromArray(t),void 0!==t[3]?this._colorPlane.material.opacity=t[3]:this._colorPlane.material.opacity=1,this.$background=this._colorPlane,this.$uScene.setSkyBox(null);break;case"Texture":"UV"==t._mapping?(this._skyPlane.texture=t.$texture,this.$background=this._skyPlane,this.$uScene.setSkyBox(null)):(this._skyBox.texture=t.$texture,this.$background=this._skyBox,this.$uScene.setSkyBox(this._skyBox)),this.$background.gamma=!0}}clearBackground(){this.$background=null}setSkyBoxRotation(e){if(!this.$background||!this.$background.isSkyBox)return;const t=this.$background.material.uniforms;BD.fromArray(e),BD.toMatrix4(FD),this._skyBoxRotation.toMatrix4(ND),ND.inverse(),RD.fromArray(t.rotationMatrix),ND.multiply(RD),FD.multiply(ND),FD.toArray(t.rotationMatrix),this._skyBoxRotation.fromArray(e)}getSkyBoxRotation(){return this._skyBoxRotation.toArray()}setFog(e){this._fogConfig=e}getFog(){return this._fogConfig}pick(e,t){const r=this._screenToNDC(e,OD);return this._picker.pick(r,t)}intersectNodeInRegion(e,t,r){const n=this._screenToNDC([e[0],e[1]+e[3]],OD),i=this._screenToNDC([e[0]+e[2],e[1]],kD);return this._picker.intersectNodeInRegion([n[0],n[1],i[0],i[1]],t,r)}pickFromGPU(e){const t=this._screenToNDC(e,OD);return this._gpuPicker.pick(t)}update(e){this._gpuPicker.update(e)}setViewport(e){this._viewport.fromArray(e)}getViewport(e){return this._viewport.toArray(e)}$updateRect(e,t){let r=ID.get(this);if(r||(r=[],ID.set(this,r)),0!==r.length&&e.equals(r[0])&&t.width==r[1]&&t.height==r[2])return;const n=this._viewport.x/t.width,i=this._viewport.y/t.height,a=n+this._viewport.z/t.width,s=i+this._viewport.w/t.height;this.$node.rect.set(n,1-s,a,1-i),r[0]?r[0].copy(e):r[0]=new Zh(e.x,e.y,e.z,e.w),r[1]=t.width,r[2]=t.height}setPostEffect(e){this._composer.setConfig(e)}getPostEffect(){return this._composer.getConfig()}setEffect(e,t){if("glow1"==e||"glow2"==e||"glow3"==e)return void console.warn('THING.T3D deprecated "'+e+'" interface, Please use "glow" to achieve the same effect');const r=this.$uScene.$effectsManager,n=F_[e],i=this._composer.getEffect(n);if(i)switch(e){case"glow":if(void 0!==t.enable){i.$enable=t.enable;const e=r.getStates().get(n);i.enable(!!e&&e.enable)}void 0!==t.strength&&(i.strength=t.strength),void 0!==t.threshold&&(i.threshold=t.threshold),void 0!==t.radius&&(i.radius=t.radius),void 0!==t.smoothWidth&&(i.smoothWidth=t.smoothWidth);break;case"innerGlow":if(void 0!==t.enable){i.$enable=t.enable;const e=r.getStates().get(n);i.enable(!!e&&e.enable)}void 0!==t.strength&&(i.strength=t.strength),void 0!==t.stride&&(i.stride=t.stride),void 0!==t.color&&i.color.fromArray(t.color);break;case"tailing":if(void 0!==t.enable){i.$enable=t.enable;const e=r.getStates().get(n);i.enable(!!e&&e.enable)}void 0!==t.direction&&i.direction.fromArray(t.direction),void 0!==t.center&&i.center.fromArray(t.center),void 0!==t.strength&&(i.strength=t.strength);break;case"radial":if(void 0!==t.enable){i.$enable=t.enable;const e=r.getStates().get(n);i.enable(!!e&&e.enable)}void 0!==t.center&&i.center.fromArray(t.center),void 0!==t.strength&&(i.strength=t.strength);break;case"ghosting":if(void 0!==t.enable){i.$enable=t.enable;const e=r.getStates().get(n);i.enable(!!e&&e.enable)}void 0!==t.center&&i.center.fromArray(t.center),void 0!==t.strength&&(i.strength=t.strength);break;case"lineBloom":if(void 0!==t.enable){i.$enable=t.enable;const e=r.getStates().get(n);i.enable(!!e&&e.enable)}void 0!==t.blurSize&&(i.blurSize=t.blurSize),void 0!==t.strength&&(i.strength=t.strength),void 0!==t.blendRate&&(i.blendRate=t.blendRate)}else console.warn("UCamera.setEffect: Unrecognized key <"+e+">.")}getEffect(e,t){if("glow1"==e||"glow2"==e||"glow3"==e)return void console.warn('THING.T3D deprecated "'+e+'" interface, Please use "glow" to achieve the same effect');const r=this._composer.getEffect(F_[e]);if(!r)return void console.warn("UCamera.getEffect: Unrecognized key <"+e+">.");const n=t||{};switch(e){case"glow":n.enable=r.$enable,n.strength=r.strength,n.threshold=r.threshold,n.radius=r.radius,n.smoothWidth=r.smoothWidth;break;case"innerGlow":n.enable=r.$enable,n.strength=r.strength,n.stride=r.stride,n.color=r.color.toArray([]);break;case"tailing":n.enable=r.$enable,n.direction=r.direction.toArray([]),n.center=r.center.toArray([]),n.strength=r.strength;break;case"radial":case"ghosting":n.enable=r.$enable,n.center=r.center.toArray([]),n.strength=r.strength;break;case"lineBloom":n.enable=r.$enable,n.blurSize=r.blurSize,n.strength=r.strength,n.blendRate=r.blendRate}return n}setInputBufferClear(e,t,r){const n=this._composer.getBuffer("SceneBuffer");n.clearColor=e,n.clearDepth=t,n.clearStencil=r}setInputTextures(e,t){if(e&&t&&(this._glColorAttachment!==e||this._glDepthAttachment!==t)){this._glColorAttachment=e,this._glDepthAttachment=t,this._colorAttachment&&this._colorAttachment.dispose(),this._depthAttachment&&this._depthAttachment.dispose();const r=this.$uAppView.$renderer.renderPass;this._colorAttachment=new Bp,r.setTextureExternal(this._colorAttachment,e),this._depthAttachment=new Bp,this._depthAttachment.type=jc.UNSIGNED_INT_24_8,this._depthAttachment.format=zc.DEPTH_STENCIL,r.setTextureExternal(this._depthAttachment,t),this._composer.setExternalAttachment(this._colorAttachment,this._depthAttachment)}}setInputRenderBuffer(e,t,{depthRenderBufferFormat:r=zc.DEPTH_COMPONENT16}){if(e&&t&&(this._glColorAttachment!==e||this._glDepthAttachment!==t)){this._glColorAttachment=e,this._glDepthAttachment=t,this._colorAttachment&&this._colorAttachment.dispose(),this._depthAttachment&&this._depthAttachment.dispose();const n=this.$uAppView.$renderer.renderPass,i=this._composer.getSize();this._colorAttachment=new Sm,this._colorAttachment.width=i.x,this._colorAttachment.height=i.y,this._colorAttachment.format=zc.RGBA8,this._colorAttachment.multipleSampling=this._msaaSamplerNumber,n.setRenderBufferExternal(this._colorAttachment,e),this._depthAttachment=new Sm,this._depthAttachment.width=i.x,this._depthAttachment.height=i.y,this._depthAttachment.format=r,this._depthAttachment.multipleSampling=this._msaaSamplerNumber,n.setRenderBufferExternal(this._depthAttachment,t),this._composer.setExternalAttachment(this._colorAttachment,this._depthAttachment)}}_collectShadowLightInfo(e,t){const r=e.getRoot().$node.getRenderStates(t.$node).lights,n=r.directShadowNum,i=r.directionalShadowMap,a=r.directionalShadowMatrix,s=r.directional,o=r.directionalShadow,l=t.$uAppView._renderer.renderPass._textures,u=zD.direction;u.directionalShadowMatrix.length>a.length&&(u.directionalShadowMatrix.length=0);for(let e=0;e<a.length;e++)u.directionalShadowMatrix[e]=a[e];u.directGLShadowMaps.length>n&&(u.directGLShadowMaps.length=0,u.directional.length=0,u.directionalShadow.length=0);for(let e=0;e<n;e++){const t=i[e],r=l.get(t);u.directGLShadowMaps[e]=r,u.directional[e]=s[e],u.directionalShadow[e]=o[e]}return zD}render(e){const t=this.$uScene,r=this.$uAppView,n=r.$renderer,i=t.getRoot(),a=this._composer;i.$node.fog=function(e){let t=null;e.enable&&("Linear"===e.type?(t=VD,t.color.fromArray(e.color),t.near=e.near,t.far=e.far):"Exp2"===e.type&&(t=GD,t.color.fromArray(e.color),t.density=e.density));return t}(this._fogConfig),this.$background?(this.$node.add(this.$background),this.$background.updateMatrix(),this.$background.isSkyColorPlane?n.renderPass.setClearColor(0,0,0,0):n.renderPass.setClearColor(0,0,0,this._clearColorBuffer?1:0)):n.renderPass.setClearColor(0,0,0,0),i.$node.logarithmicDepthBuffer=r._logarithmicDepthBuffer,i.$node.logarithmicDepthNear=r._logarithmicDepthNear,i.$node.logarithmicDepthFar=r._logarithmicDepthFar,t.$syncResolution(this),i.$node.updateRenderStates(this.$node),i.$node.updateRenderQueue(this.$node);const s=i.$node.getRenderQueue(this.$node);if(s.getLayer(8)||s.createLayer(8),s.getLayer(1)||s.createLayer(1),t.$billboardProcessors.size>0&&t.$billboardProcessors.forEach((e=>e.$update(PD.setFromMatrixPosition(this._node.worldMatrix)))),n.shadowMapPass.render(n,i.$node),this._onAfterShadowRender){const e=this._collectShadowLightInfo(t,this);this._onAfterShadowRender(e)}const o=t.$effectsBufferDirtyManager;o.active&&o.dirtyEffectBuffers&&this.dirtyEffect(),t.$effectsManager.update(a),this.$uAppView.$flushTextures();const l=s.layerMap.get(5);let u;!l||0===l.opaque.length&&0===l.transparent.length?a.getEffect("Lensflare").active=!1:a.getEffect("Lensflare").active=!0,2===n.renderPass.capabilities.version&&"ios"===r.deviceType&&(n.renderPass.setRenderTarget(LD),UD.render(n)),e?(u=e.$renderTarget,this.$updateRect(this._viewport,u)):(u=n.backRenderTarget,this.$updateRect(this._viewport,u));for(let e=0;e<this._renderFunctionList.length;e++)this._renderFunctionList[e](i,n,this);a.clearColor=this._clearColorBuffer,a.clearDepth=this._clearDepthBuffer,a.clearStencil=this._clearStencilBuffer,t._renderInfo.reset(),a.render(n,i.$node,this.$node,u),t._renderInfoCollection.drawCalls=t._renderInfo.render.calls,t._renderInfoCollection.points=t._renderInfo.render.points,t._renderInfoCollection.lines=t._renderInfo.render.lines,t._renderInfoCollection.triangles=t._renderInfo.render.triangles,t._renderInfoCollection.geometries=r._renderer.renderPass._geometries.size(),t._renderInfoCollection.programs=r._renderer.renderPass._programs._programs.length,t._renderInfoCollection.materials=r._renderer.renderPass._materials.size(),t._renderInfoCollection.textures=r._renderer.renderPass._textures.size(),this.$background&&this.$node.remove(this.$background),u.texture&&n.renderPass.updateRenderTargetMipmap(u),i.$node.fog=null,o.clear(),this.$pickBufferDebug&&this.$renderPickingBuffer(i)}renderOverlay(e){const t=this.$uScene,r=this.$uAppView.$renderer,n=t.getOverlayRoot(),i=r.renderPass._state.depthBuffer;let a;e?(a=e.$renderTarget,this.$updateRect(this._viewport,a)):(a=r.backRenderTarget,this.$updateRect(this._viewport,a)),r.renderPass.setRenderTarget(a),(this._clearColorBuffer||this._clearDepthBuffer||this._clearStencilBuffer)&&r.renderPass.clear(this._clearColorBuffer,this._clearDepthBuffer,this._clearStencilBuffer),i.setTest(!1),i.setMask(!1),i.setLocked(!0);const s=n.$node.updateRenderStates(this._overlayCamera),o=n.$node.updateRenderQueue(this._overlayCamera);if(o){const e=o.getLayer(0),t=o.getLayer(8);r.renderRenderableList(e.opaque,s,{}),r.renderRenderableList(e.transparent,s,{}),t&&(r.renderRenderableList(t.opaque,s,{}),r.renderRenderableList(t.transparent,s,{}))}e&&e.generateMipmaps&&r.renderPass.updateRenderTargetMipmap(a),i.setLocked(!1),i.setTest(!0),i.setMask(!0)}_screenToNDC(e,t){const r=this._viewport,n=this._size;return t[0]=(e[0]-r.x)/n.x*2-1,t[1]=-(e[1]-r.y)/n.y*2+1,t}$parseOptions(e){return super.$parseOptions(e),void 0!==e.width&&void 0!==e.height&&this.setSize([e.width,e.height]),this}$renderPickingBuffer(e,t){const r=this.$uAppView.$renderer,n=this._gpuPicker.renderOptions;r.renderPass.setRenderTarget(t?t._renderTarget:r.backRenderTarget),r.renderPass.clear();const i=e.$node.getRenderStates(this.$node),a=e.$node.getRenderQueue(this.$node);if(!a)return;const s=this._node;s.rect.toArray(this._tempViewport),s.rect.set(0,0,1,1),i.camera.rect.set(0,0,1,1);const o=a.getLayer(0),l=a.getLayer(1),u=a.getLayer(7),c=a.getLayer(8);r.renderRenderableList(o.opaque,i,{ifRender:n.ifRender,getMaterial:n.getMaterial}),r.renderRenderableList(o.transparent,i,{ifRender:n.ifRender,getMaterial:n.getMaterial}),u&&u.opaqueCount>0&&r.renderRenderableList(u.opaque,i,{ifRender:n.ifRender,getMaterial:n.getMaterial}),c&&c.opaqueCount+c.transparentCount>0&&(r.renderRenderableList(c.opaque,i,{ifRender:n.ifRender,getMaterial:n.getMaterial}),r.renderRenderableList(c.transparent,i,{ifRender:n.ifRender,getMaterial:n.getMaterial})),l&&l.opaqueCount+l.transparentCount>0&&(r.renderPass.clear(!1,!0,!1),r.renderRenderableList(l.opaque,i,{ifRender:n.ifRender,getMaterial:n.getMaterial}),r.renderRenderableList(l.transparent,i,{ifRender:n.ifRender,getMaterial:n.getMaterial})),s.rect.fromArray(this._tempViewport),i.camera.rect.fromArray(this._tempViewport)}}const VD=new lm,GD=new um;const WD={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},HD={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3};var qD={type:"change"},XD={type:"preStart"},QD={type:"start"},KD={type:"preEnd"},YD={type:"end"};class ZD extends eh{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new bc,this.up=new bc(0,1,0),this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:WD.ROTATE,MIDDLE:WD.DOLLY,RIGHT:WD.PAN},this.touches={ONE:HD.ROTATE,TWO:HD.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._mode=15,this._cycle=new Set,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",W),this._domElementKeyEvents=e},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(qD),r.update(),a=n.NONE},this.stop=function(){a!==n.NONE&&(r.domElement.ownerDocument.removeEventListener("mousemove",V,!1),r.domElement.ownerDocument.removeEventListener("mouseup",z,!1),a=n.NONE),r._mode=i.END,r._cycle.clear()},this.update=function(){var e=new bc,t=(new Mc).setFromUnitVectors(new bc(0,1,0),new bc(0,1,0)),d=t.clone().inverse(),p=null,f=null,m=!1,g=2*Math.PI;return function(){var _=r.object.position;e.copy(_).sub(r.target),e.applyQuaternion(t),o.setFromVector3(e),r.autoRotate&&a===n.NONE&&A(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(o.theta+=l.theta*r.dampingFactor,o.phi+=l.phi*r.dampingFactor):(o.theta+=l.theta,o.phi+=l.phi);var v=r.minAzimuthAngle,y=r.maxAzimuthAngle;let x;isFinite(v)&&isFinite(y)&&(v<-Math.PI?v+=g:v>Math.PI&&(v-=g),y<-Math.PI?y+=g:y>Math.PI&&(y-=g),o.theta=v<y?Math.max(v,Math.min(y,o.theta)):o.theta>(v+y)/2?Math.max(v,o.theta):Math.min(y,o.theta)),o.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=u,o.radius=Math.max(r.minDistance,Math.min(r.maxDistance,o.radius)),!0===r.enableDamping?r.target.addScaledVector(c,r.dampingFactor):r.target.add(c),e.setFromSpherical(o),e.applyQuaternion(d),_.copy(r.target).add(e),r.object.lookAt(r.target,r.up),!0===r.enableDamping?(l.theta*=1-r.dampingFactor,l.phi*=1-r.dampingFactor,c.multiplyScalar(1-r.dampingFactor)):(l.set(0,0,0),c.set(0,0,0)),u=1,null==p&&null==f&&((p=new bc).copy(r.object.position),(f=new Mc).copy(r.object.quaternion)),h||p.distanceToSquared(r.object.position)>s||8*(1-f.dot(r.object.quaternion))>s?((r._mode==i.CHANGE||r._mode==i.PREEND&&r._cycle.has(i.START))&&r.dispatchEvent(qD),p.copy(r.object.position),f.copy(r.object.quaternion),h=!1,x=!0):(p.copy(r.object.position),f.copy(r.object.quaternion),x=!1),x!==m?1==x?r._mode==i.PRESTART&&(r._cycle.clear(),r._mode=i.START,r._cycle.add(i.START),r.dispatchEvent(QD)):r._cycle.has(i.PREEND)&&r._cycle.has(i.START)&&(r._mode=i.END,r._cycle.add(i.END),r.dispatchEvent(YD),r._cycle.clear()):1==x?r._mode==i.START&&(r._mode=i.CHANGE,r._cycle.add(i.CHANGE),r.dispatchEvent(qD)):r._cycle.has(i.PREEND)&&r._cycle.has(i.START)&&(r._mode=i.END,r._cycle.add(i.END),r.dispatchEvent(YD),r._cycle.clear()),m=x}}(),this.stopDamping=function(){l.set(0,0,0),c.set(0,0,0),r.update()},this.dispose=function(){r.domElement.removeEventListener("contextmenu",Q),r.domElement.removeEventListener("mousedown",j,!1),r.domElement.removeEventListener("wheel",G),r.domElement.removeEventListener("touchstart",H,!1),r.domElement.removeEventListener("touchend",X,!1),r.domElement.removeEventListener("touchmove",q,!1),r.domElement.ownerDocument.removeEventListener("mousemove",V,!1),r.domElement.ownerDocument.removeEventListener("mouseup",z,!1),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",W)};var r=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},i={PRESTART:10,START:11,CHANGE:12,CHANGEPAUSE:13,PREEND:14,END:15},a=n.NONE,s=1e-6,o=new Hh,l=new Hh,u=1,c=new bc,h=!1,d=new xh,p=new xh,f=new xh,m=new xh,g=new xh,_=new xh,v=new xh,y=new xh,x=new xh;function b(){return Math.pow(.95,r.zoomSpeed)}function A(e){l.theta-=e}function S(e){l.phi-=e}var E,w,C=(E=new bc,function(e,t){E.setFromMatrixColumn(t,0),E.multiplyScalar(-e),c.add(E)}),T=function(){var e=new bc;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.up,e)),e.multiplyScalar(t),c.add(e)}}(),D=(w=new bc,function(e,t){var n=r.domElement;if(r.object.isPerspectiveCamera){const i=r.object.position;w.copy(i).sub(r.target);let a=w.length();a*=Math.tan(r.object.fov/2*Math.PI/180),C(2*e*a/n.clientHeight,r.object.matrix),T(2*t*a/n.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(C(e*(r.object.right-r.object.left)/r.object.zoom/n.clientWidth,r.object.matrix),T(t*(r.object.top-r.object.bottom)/r.object.zoom/n.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)});function M(e){u/=e,r.object.isOrthographicCamera&&(r.object.orthographicDistance=Math.max(r.minDistance,Math.min(r.maxDistance,r.object.orthographicDistance/e)),r.object.updateProjectionMatrix())}function P(e){u*=e,r.object.isOrthographicCamera&&(r.object.orthographicDistance=Math.max(r.minDistance,Math.min(r.maxDistance,r.object.orthographicDistance*e)),r.object.updateProjectionMatrix())}function F(e){d.set(e.clientX,e.clientY)}function R(e){m.set(e.clientX,e.clientY)}function N(e){e.deltaY<0?P(b()):e.deltaY>0&&M(b()),r.update()}function B(e){if(1==e.touches.length)d.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);d.set(t,r)}}function I(e){if(1==e.touches.length)m.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);m.set(t,r)}}function O(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);v.set(0,n)}function k(e){if(1==e.touches.length)p.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);p.set(t,n)}f.subVectors(p,d).multiplyScalar(r.rotateSpeed);var i=r.domElement;A(2*Math.PI*f.x/i.clientHeight),S(2*Math.PI*f.y/i.clientHeight),d.copy(p)}function L(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,n)}_.subVectors(g,m).multiplyScalar(r.panSpeed),D(_.x,_.y),m.copy(g)}function U(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);y.set(0,i),x.set(0,Math.pow(y.y/v.y,r.zoomSpeed)),M(x.y),v.copy(y)}function z(e){!1!==r.enabled&&(r.domElement.ownerDocument.removeEventListener("mousemove",V,!1),r.domElement.ownerDocument.removeEventListener("mouseup",z,!1),r._mode=i.PREEND,r._cycle.add(i.PREEND),r.dispatchEvent(KD),a=n.NONE)}function j(e){if(!1!==r.enabled){var t;switch(e.preventDefault(),r.domElement.focus?r.domElement.focus():window.focus(),e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case WD.DOLLY:if(!1===r.enableZoom)return;!function(e){v.set(e.clientX,e.clientY)}(e),a=n.DOLLY;break;case WD.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;R(e),a=n.PAN}else{if(!1===r.enableRotate)return;F(e),a=n.ROTATE}break;case WD.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;F(e),a=n.ROTATE}else{if(!1===r.enablePan)return;R(e),a=n.PAN}break;default:a=n.NONE}a!==n.NONE&&(r.domElement.ownerDocument.addEventListener("mousemove",V,!1),r.domElement.ownerDocument.addEventListener("mouseup",z,!1),r._mode==i.PREEND&&r._cycle.has(i.START)&&(r._mode=i.END,r._cycle.add(i.END),r.dispatchEvent(YD),r._cycle.clear()),r._mode=i.PRESTART,r._cycle.add(i.PRESTART),r.dispatchEvent(XD),(l.phi>s||l.theta>s||l.radius>s||c.x>s||c.y>s||c.z>s)&&(r._cycle.has(i.START)||(r._cycle.clear(),r._mode=i.START,r._cycle.add(i.START),r.dispatchEvent(QD))))}}function V(e){switch(a){case n.ROTATE:if(!1===r.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),f.subVectors(p,d).multiplyScalar(r.rotateSpeed);var t=r.domElement===document?r.domElement.body:r.domElement;A(2*Math.PI*f.x/t.clientHeight),S(2*Math.PI*f.y/t.clientHeight),d.copy(p),r.update()}(e);break;case n.DOLLY:if(!1===r.enableZoom)return;!function(e){y.set(e.clientX,e.clientY),x.subVectors(y,v),x.y>0?M(b()):x.y<0&&P(b()),v.copy(y),r.update()}(e);break;case n.PAN:if(!1===r.enablePan)return;!function(e){g.set(e.clientX,e.clientY),_.subVectors(g,m).multiplyScalar(r.panSpeed),D(_.x,_.y),m.copy(g),r.update()}(e)}}function G(e){!1===r.enabled||!1===r.enableZoom||a!==n.NONE&&a!==n.ROTATE||(e.preventDefault(),r._cycle.has(i.CHANGE)?(N(e),r.dispatchEvent(qD)):(r._cycle.clear(),r._mode=i.START,r._cycle.add(i.START),r.dispatchEvent(QD),N(e),r._mode=i.CHANGE,r._cycle.add(i.CHANGE),r.dispatchEvent(qD),r._mode=i.END,r._cycle.add(i.END),r.dispatchEvent(YD),r._cycle.clear()))}function W(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){var t=!1;switch(e.keyCode){case r.keys.UP:D(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:D(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:D(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:D(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function H(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(r.touches.ONE){case HD.ROTATE:if(!1===r.enableRotate)return;B(e),a=n.TOUCH_ROTATE;break;case HD.PAN:if(!1===r.enablePan)return;I(e),a=n.TOUCH_PAN;break;default:a=n.NONE}break;case 2:switch(r.touches.TWO){case HD.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&O(e),r.enablePan&&I(e)}(e),a=n.TOUCH_DOLLY_PAN;break;case HD.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&O(e),r.enableRotate&&B(e)}(e),a=n.TOUCH_DOLLY_ROTATE;break;default:a=n.NONE}break;default:a=n.NONE}a!==n.NONE&&(r.domElement.ownerDocument.addEventListener("mousemove",V,!1),r.domElement.ownerDocument.addEventListener("mouseup",z,!1),r._mode==i.PREEND&&r._cycle.has(i.START)&&(r._mode=i.END,r._cycle.add(i.END),r.dispatchEvent(YD),r._cycle.clear()),r._mode=i.PRESTART,r._cycle.add(i.PRESTART),r.dispatchEvent(XD),(l.phi>s||l.theta>s||l.radius>s||c.x>s||c.y>s||c.z>s)&&(r._cycle.has(i.START)||(r._cycle.clear(),r._mode=i.START,r._cycle.add(i.START),r.dispatchEvent(QD))))}}function q(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),a){case n.TOUCH_ROTATE:if(!1===r.enableRotate)return;k(e),r.update();break;case n.TOUCH_PAN:if(!1===r.enablePan)return;L(e),r.update();break;case n.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&U(e),r.enablePan&&L(e)}(e),r.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&U(e),r.enableRotate&&k(e)}(e),r.update();break;default:a=n.NONE}}function X(e){!1!==r.enabled&&(r._mode=i.PREEND,r._cycle.add(i.PREEND),r.dispatchEvent(KD),a=n.NONE)}function Q(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",Q,!1),r.domElement.addEventListener("mousedown",j,!1),r.domElement.addEventListener("wheel",G,{passive:!1}),r.domElement.addEventListener("touchstart",H,{passive:!1}),r.domElement.addEventListener("touchend",X,{passive:!1}),r.domElement.addEventListener("touchmove",q,{passive:!1}),-1===r.domElement.tabIndex&&(r.domElement.tabIndex=0),this.update()}}const JD=new Dg;class $D{constructor(e,t){this._camera=e,this._control=new ZD(e.$node,t),this._control.listenToKeyEvents(t);const r=e=>{!1!==this._control.enabled&&!1!==this._control.enableZoom&&(e.preventDefault(),e.stopPropagation(),this._control.dispatchEvent({type:"wheel",delta:e.deltaY}))};this._wheelBinding=r,t.addEventListener("wheel",r,{passive:!1});const n=new Sh;this._targetBoundary=n,this._control.target.add=function(e){bc.prototype.add.call(this,e),n.isEmpty()||this.clamp(n.min,n.max)},this._control.target.addScaledVector=function(e,t){bc.prototype.addScaledVector.call(this,e,t),n.isEmpty()||this.clamp(n.min,n.max)}}dispose(){this._control.domElement.removeEventListener("wheel",this._wheelBinding,!1),delete this._control.target.add,delete this._control.target.addScaledVector,this._targetBoundary=null,this._camera=null,this._control.dispose()}addEventListener(e,t){this._control.addEventListener(e,t)}dispatchEvent(e){this._control.dispatchEvent(e)}removeEventListener(e,t){this._control.removeEventListener(e,t)}setUpDirection(e){this._control.up.fromArray(e)}getUpDirection(e){return this._control.up.toArray(e)}update(e){this._control.enabled&&this._control.update(e)}stopDamping(){this._control.stopDamping()}getCamera(){return this._camera}active(e){this._control.enabled=e,!1===e&&this._control.stop()}stop(){this._control.stop()}isActivated(){return this._control.enabled}enable(e,t){switch(e){case"Damping":this._control.enableDamping=t;break;case"Rotate":this._control.enableRotate=t;break;case"Pan":this._control.enablePan=t;break;case"MapControl":this._control.mouseButtons.LEFT=t?WD.PAN:WD.ROTATE,this._control.mouseButtons.RIGHT=t?WD.ROTATE:WD.PAN,this._control.touches.ONE=t?HD.PAN:HD.DOLLY_ROTATE,this._control.touches.TWO=t?HD.DOLLY_ROTATE:HD.PAN;break;case"Zoom":this._control.enableZoom=t}}isEnabled(e){switch(e){case"Damping":return this._control.enableDamping;case"Rotate":return this._control.enableRotate;case"Pan":return this._control.enablePan;case"MapControl":return this._control.mouseButtons.LEFT===WD.PAN;case"Zoom":return this._control.enableZoom}}setDampingFactor(e){this._control.dampingFactor=e}getDampingFactor(){return this._control.dampingFactor}setZoomSpeed(e){this._control.zoomSpeed=e}getZoomSpeed(){return this._control.zoomSpeed}setRotateSpeed(e){this._control.rotateSpeed=e}getRotateSpeed(){return this._control.rotateSpeed}setPanSpeed(e){this._control.panSpeed=e}getPanSpeed(){return this._control.panSpeed}setKeyPanSpeed(e){this._control.keyPanSpeed=e}getKeyPanSpeed(){return this._control.keyPanSpeed}setMinDistance(e){this._control.minDistance=e}getMinDistance(){return this._control.minDistance}setMaxDistance(e){this._control.maxDistance=e}getMaxDistance(){return this._control.maxDistance}setMinPolarAngle(e){this._control.minPolarAngle=e}getMinPolarAngle(){return this._control.minPolarAngle}setMaxPolarAngle(e){this._control.maxPolarAngle=e}getMaxPolarAngle(){return this._control.maxPolarAngle}setMinAzimuthAngle(e){this._control.minAzimuthAngle=e}getMinAzimuthAngle(){return this._control.minAzimuthAngle}setMaxAzimuthAngle(e){this._control.maxAzimuthAngle=e}getMaxAzimuthAngle(){return this._control.maxAzimuthAngle}setTargetWorldPosition(e){this._control.target.fromArray(e)}getTargetWorldPosition(e){return this._control.target.toArray(e)}setScreenSpacePanning(e){this._control.screenSpacePanning=e}getScreenSpacePanning(){return this._control.screenSpacePanning}setBoundary(e){e?(JD.center.fromArray(e.center),JD.halfSize.fromArray(e.halfSize),this._targetBoundary.min.copy(JD.center).sub(JD.halfSize),this._targetBoundary.max.copy(JD.center).add(JD.halfSize)):this._targetBoundary.makeEmpty()}getBoundary(e){return this._targetBoundary.isEmpty()?null:(JD.fromBox3(this._targetBoundary),JD.center.toArray(e.center),JD.halfSize.toArray(e.halfSize),e)}clone(){}$parseOptions(e){return this._control.minDistance=void 0!==e.minDistance?e.minDistance:1e-4,this._control.autoRotate=void 0!==e.autoRotate&&e.autoRotate,this._control.enableDamping=void 0===e.enableDamping||e.enableDamping,this._control.minPolarAngle=void 0!==e.minPolarAngle?e.minPolarAngle:0,this._control.maxPolarAngle=void 0!==e.maxPolarAngle?e.maxPolarAngle:Math.PI,this._control.keyPanSpeed=void 0!==e.keyPanSpeed?e.keyPanSpeed:.1,this._control.panSpeed=void 0!==e.panSpeed?e.panSpeed:.1,this._control.rotateSpeed=void 0!==e.rotateSpeed?e.rotateSpeed:.07,this._control.dampingFactor=void 0!==e.dampingFactor?e.dampingFactor:.078,this._control.screenSpacePanning=void 0===e.screenSpacePanning||e.screenSpacePanning,this._control.enabled=void 0===e.enabled||e.enabled,this}}const eM=2*Math.PI;let tM;const rM=e=>{const t=[];for(let r=0,n=e.length;r<n;r++){const n=e[r],i={};for(let e in n)"material"===e?i[e]=n[e]:"object"==typeof n[e]?i[e]=U_({},n[e]):i[e]=n[e];t[r]=i}return t};class nM extends eh{constructor(e){super(),this._unode=null,this._clips=e,this._mixer=null}setAttribute(e,t){}getAttribute(e){return[]}play(){this._unode.$uScene.$textureAnimationPlayers.add(this),this._mixer._actions.forEach((e=>e.reset()))}stop(){this._unode.$uScene.$textureAnimationPlayers.delete(this)}pause(){}resume(){}dispose(){this._clips.forEach((e=>{e.material.dispose()})),this._clips=null;this._unode.$uScene.$textureAnimationPlayers.has(this)&&this._unode.$uScene.$textureAnimationPlayers.delete(this)}copy(e){return this._clips=rM(e.clips),this}clone(){return new this.constructor(rM(this._clips))}$onAdd(e){this._unode=e,this._mixer=new iM;const t=new WeakMap;this._clips.forEach((e=>{const r=((e,t=new WeakMap)=>{const r=e.material;let n=t.get(r);return n||(n=r.clone(),n._$hasDefaultTextureAnimation=!0,t.set(r,n)),n})(e,t);e.material=r,this._mixer.clipAction(e)})),((e,t)=>{e.$getRenderableList().forEach((e=>{e.material&&(Array.isArray(e.material)?e.material=e.material.map((e=>t.has(e)?t.get(e):e)):t.has(e.material)&&(e.material=t.get(e.material)))}))})(e,t)}$onRemove(e){this._unode=null,this._mixer=null}$update(e){this._mixer&&this._mixer.update(e)}}class iM{constructor(){this._actions=[]}clipAction(e){let t;"frames"===e.anim.type?t=new oM(e):"transform"===e.anim.type&&(t=new sM(e)),t&&this._actions.push(t)}update(e){this._actions.forEach((t=>{t.running&&t.update(e)}))}}class aM{constructor(e){this.clip=e,this.timeScale=1,this.running=!0,this._offset=new xh,this._repeat=new xh,this._center=new xh(0,0),this._rotation=0}reset(){const e=this.clip,t=e.anim;this._offset.fromArray(t.start.offset),this._repeat.fromArray(t.start.repeat),this._center.set(0,0),this._rotation=t.start.rotation,"diffuseMap"===e.key?(e.material.diffuseMapTransform||(e.material.diffuseMapTransform=new Ph),e.material.diffuseMapTransform.setUvTransform(this._offset.x,this._offset.y,this._repeat.x,this._repeat.y,this._rotation,this._center.x,this._center.y)):"alphaMap"===e.key?(e.material.alphaMapTransform||(e.material.alphaMapTransform=new Ph),e.material.alphaMapTransform.setUvTransform(this._offset.x,this._offset.y,this._repeat.x,this._repeat.y,this._rotation,this._center.x,this._center.y)):"emissiveMap"===e.key&&(e.material.emissiveMapTransform||(e.material.emissiveMapTransform=new Ph),e.material.emissiveMapTransform.setUvTransform(this._offset.x,this._offset.y,this._repeat.x,this._repeat.y,this._rotation,this._center.x,this._center.y))}update(e){}}class sM extends aM{constructor(e){super(e),this.offsetLoop=e.anim.offsetLoop,this.scaleLoop=e.anim.scaleLoop,this.rotationLoop=e.anim.rotationLoop,this.currentScaleWithoutRandom=1/e.anim.start.repeat[0],this.offsetIntervalTime=0,this.scaleIntervalTime=0,this.rotationIntervalTime=0}update(e){const t=this.clip,r=t.anim;if(this.offsetIntervalTime>0?(this.offsetIntervalTime-=e*this.timeScale,this._offset.fromArray(r.start.offset)):(this._offset.x+=r.offset[0]*e*this.timeScale*(1+(2*Math.random()-1)*r.offsetRandom[0]),this._offset.y+=r.offset[1]*e*this.timeScale*(1+(2*Math.random()-1)*r.offsetRandom[1]),this._offset.x>r.start.offset[0]+1&&(tM=Math.trunc(this._offset.x),this._offset.x=this._offset.x%(r.start.offset[0]+1),this.offsetLoop-=tM,this.offsetIntervalTime=r.offsetInterval),this._offset.x<r.start.offset[0]-1&&(tM=Math.trunc(this._offset.x),this._offset.x=this._offset.x%(r.start.offset[0]-1),this.offsetLoop+=tM,this.offsetIntervalTime=r.offsetInterval),this._offset.y>r.start.offset[1]+1&&(this._offset.y=this._offset.y%(r.start.offset[1]+1)),this._offset.y<r.start.offset[1]-1&&(this._offset.y=this._offset.y%(r.start.offset[1]-1)),r.offsetLoop<=0&&(this.running=!1,this._offset.fromArray(r.start.offset))),this.scaleIntervalTime>0)this.scaleIntervalTime-=e*this.timeScale,this._repeat.fromArray(r.start.repeat);else if(0!==r.scale){let t=r.scale*e*this.timeScale,n=t*(1+(2*Math.random()-1)*r.scaleRandom),i=1/this._repeat.x+n,a=1/this._repeat.y+n;for(this.currentScaleWithoutRandom+=t;this.currentScaleWithoutRandom>1;)this.currentScaleWithoutRandom-=1,this.scaleLoop--,this.scaleIntervalTime=r.scaleInterval;for(;this.currentScaleWithoutRandom<=0;)this.currentScaleWithoutRandom+=1,this.scaleLoop--,this.scaleIntervalTime=r.scaleInterval;for(;i>1;)i-=1,a-=1;for(;i<=0;)i+=1,a+=1;this._repeat.set(1/i,1/a),this.scaleLoop<=0&&(this.running=!1,this._repeat.fromArray(r.start.repeat))}if(this.rotationIntervalTime>0)this.rotationIntervalTime-=e*this.timeScale,this._rotation=r.start.rotation;else{for(this._rotation+=r.rotation*e*this.timeScale*(1+(2*Math.random()-1)*r.rotationRandom);this._rotation>r.start.rotation+eM;)this._rotation-=eM,this.rotationLoop--,this.rotationIntervalTime=r.rotationInterval;for(;this._rotation<r.start.rotation-eM;)this._rotation+=eM,this.rotationLoop--,this.rotationIntervalTime=r.rotationInterval;this.rotationLoop<=0&&(this.running=!1,this._rotation=r.start.rotation)}0===r.rotation&&0===r.scale&&1===this._repeat.x&&1===this._repeat.y||this._center.set(.5,.5),"diffuseMap"===t.key?t.material.diffuseMapTransform.setUvTransform(this._offset.x,this._offset.y,this._repeat.x,this._repeat.y,this._rotation,this._center.x,this._center.y):"alphaMap"===t.key?t.material.alphaMapTransform.setUvTransform(this._offset.x,this._offset.y,this._repeat.x,this._repeat.y,this._rotation,this._center.x,this._center.y):"emissiveMap"===t.key&&t.material.emissiveMapTransform.setUvTransform(this._offset.x,this._offset.y,this._repeat.x,this._repeat.y,this._rotation,this._center.x,this._center.y)}}class oM extends aM{constructor(e){super(e),this.loop=e.anim.loop,this.currentDisplayTime=0,this.currentTile=0,this.intervalTime=0}update(e){const t=this.clip,r=t.anim;if(this.intervalTime>0)this.intervalTime-=r.interval;else for(this.currentDisplayTime+=e*this.timeScale;this.currentDisplayTime>r.tileDisplayDuration;)if(this.currentDisplayTime-=r.tileDisplayDuration,this.currentTile++,this.currentTile==r.numberOfTiles&&(this.currentTile=0,this.loop--,this.intervalTime=r.interval),this.loop>0){const e=r.random?Math.floor(Math.random()*r.numberOfTiles):this.currentTile,n=e%r.tilesX,i=Math.floor(e/r.tilesX);this._offset.set(n/r.tilesX,i/r.tilesY),"diffuseMap"===t.key?t.material.diffuseMapTransform.setUvTransform(this._offset.x,this._offset.y,this._repeat.x,this._repeat.y,this._rotation,this._center.x,this._center.y):"alphaMap"===t.key?t.material.alphaMapTransform.setUvTransform(this._offset.x,this._offset.y,this._repeat.x,this._repeat.y,this._rotation,this._center.x,this._center.y):"emissiveMap"===t.key&&t.material.emissiveMapTransform.setUvTransform(this._offset.x,this._offset.y,this._repeat.x,this._repeat.y,this._rotation,this._center.x,this._center.y)}else this.running=!1}}const lM=new bc(0,1,0),uM=new bc,cM=new Sc,hM=new Mc,dM=new Dh;class pM{constructor(){this._nodes=[],this._unode=null}$onAdd(e){this._unode=e,this._unode._node.traverse((e=>{e.userData.billboard&&this._nodes.push(e)})),this._unode.$uScene.$transformCache.addResident(this._unode)}$onRemove(e){this._unode.$uScene.$transformCache.removeResident(this._unode),this._unode=null}init(){this._unode.$uScene.$billboardProcessors.add(this)}$update(e){this._nodes.forEach((t=>{!function(e,t,r){const{type:n,axis:i}=e.userData.billboard,a=e.parent;uM.setFromMatrixPosition(e.worldMatrix),e.isCamera||e.isLight?cM.lookAtRH(uM,t,r):cM.lookAtRH(t,uM,r);e.quaternion.setFromRotationMatrix(cM),dM.order="YXZ",dM.setFromQuaternion(e.quaternion),"axis"==n&&"y"==i&&(dM.x=0,dM.z=0);e.quaternion.setFromEuler(dM),a&&(cM.extractRotation(a.worldMatrix),hM.setFromRotationMatrix(cM),e.quaternion.premultiply(hM.inverse()));e.matrixNeedsUpdate=!0}(t,e,lM)}))}dispose(){this._nodes=[]}}const fM={Repeat:Gc.REPEAT,ClampToEdge:Gc.CLAMP_TO_EDGE,MirroredRepeat:Gc.MIRRORED_REPEAT},mM={};for(let e in fM)mM[fM[e]]=e;const gM={NearestFilter:Vc.NEAREST,NearestMipmapNearestFilter:Vc.NEAREST_MIPMAP_NEAREST,NearestMipmapLinearFilter:Vc.NEAREST_MIPMAP_LINEAR,LinearFilter:Vc.LINEAR,LinearMipmapNearestFilter:Vc.LINEAR_MIPMAP_NEAREST,LinearMipmapLinearFilter:Vc.LINEAR_MIPMAP_LINEAR},_M={};for(let e in gM)_M[gM[e]]=e;const vM={UV:"UV",CubeReflection:"CubeReflection",CubeRefraction:"CubeRefraction",EquirectangularReflection:"EquirectangularReflection",EquirectangularRefraction:"EquirectangularRefraction",CubeUVReflection:"CubeUVReflection",CubeUVRefraction:"CubeUVRefraction"},yM={};for(let e in vM)yM[vM[e]]=e;const xM={RGB:zc.RGB,RGBA:zc.RGBA,ASTC_4x4:zc.RGBA_ASTC_4x4,BC7_M6_OPAQUE_ONLY:zc.RGBA_BPTC,BC1:zc.RGB_S3TC_DXT1,BC3:zc.RGBA_S3TC_DXT5,ETC1:zc.RGB_ETC1,PVRTC1_4_RGB:zc.RGB_PVRTC_4BPPV1,PVRTC1_4_RGBA:zc.RGBA_PVRTC_4BPPV1},bM={};for(let e in xM)bM[xM[e]]=e;const AM="HTMLElement",SM="ArrayImage",EM="CompressedImage",wM="DataImage",CM=e=>"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?AM:Array.isArray(e)&&6===e.length?SM:e.format&&void 0!==xM[e.format]&&e.mipmaps?EM:e.data instanceof Uint8Array&&e.width&&e.height?wM:"NoImage";class TM{constructor(){this._mapping="UV"}setMapping(e){this._mapping=vM[e]}getMapping(){return yM[this.mapping]}setColorFormat(e){this._texture.format=xM[e],this._texture.version++}getColorFormat(){return _FORMAT_REVERSE[this._texture.format]}setWrapS(e){this._texture.wrapS=fM[e],this._texture.version++}getWrapS(){return mM[this._texture.wrapS]}setWrapT(e){this._texture.wrapT=fM[e],this._texture.version++}getWrapT(){return mM[this._texture.wrapT]}setMinFilter(e){this._texture.minFilter=gM[e],this._texture.version++}getMinFilter(){return _M[this._texture.minFilter]}setMagFilter(e){this._texture.magFilter=gM[e],this._texture.version++}getMagFilter(){return _M[this._texture.magFilter]}setAnisotropy(e){this._texture.anisotropy=e,this._texture.version++}getAnisotropy(){return this._texture.anisotropy}enable(e,t){"PremultiplyAlpha"===e?(this._texture.premultiplyAlpha=t,this._texture.version++):"FlipY"===e?(this._texture.flipY=t,this._texture.version++):"GenerateMipmaps"===e&&(this._texture.generateMipmaps=t,this._texture.version++)}isEnabled(e){return"PremultiplyAlpha"===e?this._texture.premultiplyAlpha:"FlipY"===e?this._texture.flipY:"GenerateMipmaps"===e&&this._texture.generateMipmaps}dispose(){this._texture.dispose()}get $texture(){return this._texture}}const DM=new Sc;class MM{constructor(e){this._uScene=e,this._styleMap=new Map}setTextureOptions(e={}){var t;e.onLoadTexture&&(t=e.onLoadTexture,bS=t)}preloadTextures(e){return Promise.all(e.map((e=>oE(e,rE))))}loadParticle(e,t,r,n,i={}){const a=e._appendPath("index.json");return oE(a,nE).then((n=>{let a=new sC(this._uScene);a.setup({url:e,data:n.data,options:i});const s={node:a};return r&&r(),t&&t(s),s})).catch((e=>{n&&n(e)}))}_createCampusTree(e,t,r){let n;if(!(e.userData.info&&e.userData.info.extras&&e.userData.info.extras.type))return n=new QE(this._uScene,e.clone()),r&&r(n),void t.add(n);{const i=e.children.slice();e.children=[],n=new QE(this._uScene,e.clone()),r&&r(n),e.children=i,t.add(n),e.children.forEach((e=>{this._createCampusTree(e,n||t,r)}))}}_collectNodeLayer(e,t){if(!e)return;e.needRemove=!0;for(let r=0;r<e.children.length;r++)if(!t(!!e.children[r].userData.info&&e.children[r].userData.info.extras)){e.needRemove=!1;break}const r=[],n=[];for(n.push(e);0!==n.length;){const e=[],t=n.length;for(let r=0;r<t;r++){const t=n[r],i={};i.parent=t,i.children=[];for(let e=0;e<t.children.length;e++)n.push(t.children[e]),i.children.push(t.children[e]);e.push(i)}n.splice(0,t),r.push(e)}for(let e=r.length-1;e>=0;e--)for(let n=0;n<r[e].length;n++){const i=r[e][n],a=i.parent,s=i.children,o=[];for(let e=0;e<s.length;e++)t(!!s[e].userData.info&&s[e].userData.info.extras)&&(s[e].$unode||new QE(this._uScene,s[e]),o.push(s[e].$unode));if(t(!!a.userData.info&&a.userData.info.extras)){a.$unode||new QE(this._uScene,a);for(let e=0;e<o.length;e++)a.remove(o[e]._node),a.$unode.add(o[e])}else{let e=a;for(;!t(!!e.userData.info&&e.userData.info.extras)&&e.parent;)e=e.parent;e.$unode||new QE(this._uScene,e);for(let t=0;t<o.length;t++){const r=N_(o[t]._node,e,DM);o[t]._node.matrix.multiply(r),o[t]._node.matrixNeedsUpdate=!0,r.decompose(o[t]._node.position,o[t]._node.quaternion,o[t]._node.scale),a.remove(o[t]._node),e.$unode.add(o[t])}}o.length=0}return r.length=0,e}_loadModel(e,t,r){let n;t.billboardNodes=[];const i=e.data.extensions,a=e.data.sourcefile?e.data.sourcefile:e.url,s=r.nodeName?t.node.getObjectByProperty("name",r.nodeName):t.node;if(r.nodeName&&!s)return void error("Can not find node "+r.nodeName);if(r.matrices){const i=new Wm;xS(s,r.matrices,r.pickIds).forEach((e=>i.add(e))),n=new QE(this._uScene,i),t.animations&&t.animations.length>0&&console.warn("UresourceManager.loadModel: try to merge multiple models with animations, animation has been dropped!",t.animations),t.textureAnimClips&&t.textureAnimClips.length>0&&console.warn("UresourceManager.loadModel: try to merge multiple models with textureAnimClips, animation has been dropped!",t.textureAnimClips),n._res=e}else{if(r.nodeName){let e;if(r.excludeNodeNames){let t=s.children.slice();"All"==r.excludeNodeNames?s.children=[]:s.children=s.children.filter((e=>r.excludeNodeNames.indexOf(e.name)<0)),e=s.clone(),s.children=t}else e=s.clone();if(r.useParentMatrix){const r=N_(s,t.node,DM);e.matrix.multiply(r),e.matrixNeedsUpdate=!0,r.decompose(e.position,e.quaternion,e.scale)}n=new QE(this._uScene,e)}else if(t.animations&&t.animations.length>0){const e=[];n=new QE(this._uScene,tS(s,t.animations,e));const r=new eS(e);n.$addComponent(Vx,r)}else n=new QE(this._uScene,s.clone());if(n._res=e,t.textureAnimClips&&t.textureAnimClips.length>0){const e=new nM(t.textureAnimClips);n.$addComponent(Gx,e),e.play()}if(t.billboard){const e=new pM;n.$addComponent(Hx,e),e.init()}if(t.effectCounts&&this._uScene.$effectsManager.addCounts(e.data.effectCounts),t.ik){const e=new NE(t.ik);n.$addComponent(Xx,e),e.init()}if(r.useInstance){const t=this._getInstanceStyle(e.url,n,r.instanceCount?r.instanceCount:512);n.setStyle(t)}}n.$markChildrenMatrixAutoUpdate(!1);const o={node:n};return i&&(o.extensions=i),o.info={name:a},o}_loadScene(e,t,r){const n=r.onTraverseNode,i=e.data.extensions,a=t.node,s=this._collectNodeLayer(a.clone(),n),o=s.$unode;o._res=e,o.$markChildrenMatrixAutoUpdate(!1);const l={node:o};return l.sceneInfo={removeRoot:s.needRemove},i&&(l.extensions=i),l}loadModel(t,r,n,i,a){a=a||{},oE(t,tE,i,(s=>{if(s){let e=s.getData(a);const t=a.onCheckSceneResource;let i;return i=!!t&&t(e.node.userData)?this._loadScene(s,e,a):this._loadModel(s,e,a),n&&n({}),r&&r(i),i}i&&i(e),uE(t)})),lE(t)}_getInstanceStyle(e,t,r){let n;if(this._styleMap.has(e)){const t=this._styleMap.get(e);for(let e=t.length-1;e>=0;e--){if(t[e].count<t[e].style.getInstancedMaxCount()){n=t[e].style,t[e].count+=1;break}if(t[e].count<2048&&2*t[e].count<=2048){t[e].style.setInstancedMaxCount(2*t[e].count),n=t[e].style,t[e].count+=1;break}}if(!n){const i={};n=new XA(r),n._url=e,n.enable("InstancedDrawing",!0),i.style=n,i.count=1,t.push(i)}}else{const t=[];n=new XA(r),n._url=e,n.enable("InstancedDrawing",!0);const i={};i.style=n,i.count=1,t.push(i),this._styleMap.set(e,t)}const i=e=>{e.target.removeEventListener("u-dispose",i);const t=n,r=t._url,a=this._styleMap.get(r),s=a.findIndex((e=>e.style==t)),o=a[s];o.count-=1,o.count<=0&&(t.dispose(),a.splice(s,1)),0==a.length&&this._styleMap.delete(r)};return t.addEventListener("u-dispose",i),n}loadCompressedTextureData(e,t,r,n){oE(e,iE,n,(e=>{const{data:n}=e,i={};for(let e in n)i[e]=n[e];return i.format&&(i.format=bM[i.format]),r&&r(),t&&t(i),i}))}destory(){this._uScene=null}}const PM=new xh,FM=new xh,RM=new xh,NM=new xh,BM=new xh,IM=new xh,OM=new xh,kM=new E_;kM.diffuse.setHex(13421772),kM.roughness=.8,kM.metalness=.4;const LM=new E_;LM.defines.USE_ATTRIBUTES_ID=!0,LM.diffuse.setHex(13421772),LM.roughness=.8,LM.metalness=.4;const UM=new Map,zM=(e,t,r,n)=>{const i=(t.y-e.y)*(n.x-r.x)-(e.x-t.x)*(r.y-n.y);return[((t.x-e.x)*(n.x-r.x)*(r.y-e.y)+(t.y-e.y)*(n.x-r.x)*e.x-(n.y-r.y)*(t.x-e.x)*r.x)/i,-((t.y-e.y)*(n.y-r.y)*(r.x-e.x)+(t.x-e.x)*(n.y-r.y)*e.y-(n.x-r.x)*(t.y-e.y)*r.y)/i]},jM=(e,t)=>{const r=!!t.pickIds,n=new Map;let i=e.map(((e,i)=>{let a={startCorner:null,endCorner:null,startLeft:[],startRight:[],endLeft:[],endRight:[],fixPoints:[void 0,void 0,void 0,void 0],dir:[],length:0,halfThickness:e.thickness/2,height:e.height,holes:[],uvrepeat:e.uvrepeat?e.uvrepeat.slice(0):[1,1,1,1],leftTexture:e.lefttexture,rightTexture:e.righttexture};r&&Object.assign(a,{pickId:t.pickIds[i]});let s,o=PM.fromArray(e.points),l=o.x+"-"+o.y;n.has(l)?s=n.get(l):(s={position:o.toArray([]),walls:[]},n.set(l,s)),a.startCorner=s,s.walls.push(a);let u,c=FM.fromArray(e.points,2),h=c.x+"-"+c.y;n.has(h)?u=n.get(h):(u={position:c.toArray([]),walls:[]},n.set(h,u)),a.endCorner=u,u.walls.push(a);let d=RM.subVectors(c,o);const p=d.length();return a.length=p,0!==p&&d.normalize().toArray(a.dir),e.holes&&e.holes.length&&(e.holes.forEach((e=>{let t=[];t[0]=e.loc[0]*a.length-e.size[0]/2,t[1]=e.loc[1]*a.height,t[2]=e.size[0],t[3]=e.size[1],t[1]+t[3]>a.height&&(t[3]=Math.max(a.height-t[1],0)),t[1]=Math.max(t[1],0),a.holes.push({loc:e.loc[0],rect:t,openTop:t[1]+t[3]>=a.height,openBottom:t[1]<=0})})),a.holes.sort(((e,t)=>e.loc-t.loc))),a}));i=i.filter((e=>e.dir.length>0)),n.forEach((e=>{e.walls.sort(((t,r)=>(t.startCorner===e?PM.fromArray(t.dir):PM.fromArray(t.dir).negate(),r.startCorner===e?FM.fromArray(r.dir):FM.fromArray(r.dir).negate(),PM.angle()-FM.angle())));for(let t=0,r=e.walls.length;t<r;t++){let n=e.walls[t],i=e.walls[(t+1)%r],a=PM.fromArray(n.dir);n.startCorner!==e&&a.negate();let s=FM.fromArray(i.dir);i.startCorner!==e&&s.negate();let o=a.dot(s);if(.866>o&&o>-.996&&n.height===i.height){let t=0,r=0,a=PM.set(n.dir[1],-n.dir[0]).normalize().multiplyScalar(n.halfThickness),s=FM.fromArray(e.position),o=RM;n.startCorner===e?(o.fromArray(n.endCorner.position),s.sub(a),o.sub(a),t=1):(o.fromArray(n.startCorner.position),s.add(a),o.add(a),t=2);let l=PM.set(i.dir[1],-i.dir[0]).normalize().multiplyScalar(i.halfThickness),u=NM.fromArray(e.position),c=BM;i.startCorner===e?(c.fromArray(i.endCorner.position),u.add(l),c.add(l),r=0):(c.fromArray(i.startCorner.position),u.sub(l),c.sub(l),r=3);let h=zM(s,o,u,c);n.fixPoints[t]=h,i.fixPoints[r]=h}}}));const a=new Map,s=[],o=[],l=[],u=[];i.forEach((e=>{let t,n,i,c,h=PM.fromArray(e.startCorner.position),d=FM.fromArray(e.endCorner.position),p=RM.fromArray(e.dir),f=e.height,m=NM.set(p.y,-p.x).normalize().multiplyScalar(e.halfThickness);e.fixPoints[0]?t=e.startLeft=e.fixPoints[0].slice(0):(BM.addVectors(h,m),t=BM.toArray(e.startLeft)),e.fixPoints[1]?n=e.startRight=e.fixPoints[1].slice(0):(BM.subVectors(h,m),n=BM.toArray(e.startRight)),e.fixPoints[2]?i=e.endLeft=e.fixPoints[2].slice(0):(BM.addVectors(d,m),i=BM.toArray(e.endLeft)),e.fixPoints[3]?c=e.endRight=e.fixPoints[3].slice(0):(BM.subVectors(d,m),c=BM.toArray(e.endRight)),IM.fromArray(t),OM.fromArray(i);let g=OM.sub(IM).length();IM.fromArray(n),OM.fromArray(c);let _=OM.sub(IM).length(),v=[[t[0],f,t[1]],[t[0],0,t[1]]],y=[[g/f,1],[g/f,0]],x=[[1,1],[1,0]],b=[[n[0],f,n[1]],[n[0],0,n[1]]],A=[[0,1],[0,0]],S=[[0,1],[0,0]],E=[],w=[];e.holes.forEach((e=>{let r,i=e.rect,a=BM.copy(h).add(IM.copy(p).multiplyScalar(i[0])).toArray([]),s=BM.copy(h).add(IM.copy(p).multiplyScalar(i[0]+i[2])).toArray([]);IM.fromArray(a).add(m),v.unshift([IM.x,f,IM.y],[IM.x,0,IM.y]),r=OM.fromArray(t).sub(IM).length(),y.unshift([(g-r)/f,1],[(g-r)/f,0]),x.unshift([1-r/g,1],[1-r/g,0]),IM.fromArray(a).sub(m),b.push([IM.x,f,IM.y],[IM.x,0,IM.y]),r=OM.fromArray(n).sub(IM).length(),A.push([r/f,1],[r/f,0]),S.push([r/_,1],[r/_,0]),e.openTop||(IM.fromArray(a).add(m),v.unshift([IM.x,f,IM.y],[IM.x,i[1]+i[3],IM.y]),r=OM.fromArray(t).sub(IM).length(),y.unshift([(g-r)/f,1],[(g-r)/f,(i[1]+i[3])/f]),x.unshift([1-r/g,1],[1-r/g,(i[1]+i[3])/f]),IM.fromArray(s).add(m),v.unshift([IM.x,f,IM.y],[IM.x,i[1]+i[3],IM.y]),r=OM.fromArray(t).sub(IM).length(),y.unshift([(g-r)/f,1],[(g-r)/f,(i[1]+i[3])/f]),x.unshift([1-r/g,1],[1-r/g,(i[1]+i[3])/f]),IM.fromArray(a).sub(m),b.push([IM.x,f,IM.y],[IM.x,i[1]+i[3],IM.y]),r=OM.fromArray(n).sub(IM).length(),A.push([r/f,1],[r/f,(i[1]+i[3])/f]),S.push([r/_,1],[r/_,(i[1]+i[3])/f]),IM.fromArray(s).sub(m),b.push([IM.x,f,IM.y],[IM.x,i[1]+i[3],IM.y]),r=OM.fromArray(n).sub(IM).length(),A.push([r/f,1],[r/f,(i[1]+i[3])/f]),S.push([r/_,1],[r/_,(i[1]+i[3])/f]),IM.fromArray(s).sub(m),E.push([IM.x,i[1]+i[3],IM.y]),IM.fromArray(a).sub(m),E.push([IM.x,i[1]+i[3],IM.y]),IM.fromArray(s).add(m),E.push([IM.x,i[1]+i[3],IM.y]),IM.fromArray(a).add(m),E.push([IM.x,i[1]+i[3],IM.y]),w.push([0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0])),IM.fromArray(a).sub(m),E.push([IM.x,i[1]+i[3],IM.y],[IM.x,i[1],IM.y]),IM.fromArray(a).add(m),E.push([IM.x,i[1]+i[3],IM.y],[IM.x,i[1],IM.y]),w.push([p.x,0,p.y],[p.x,0,p.y],[p.x,0,p.y],[p.x,0,p.y]),IM.fromArray(s).add(m),E.push([IM.x,i[1]+i[3],IM.y],[IM.x,i[1],IM.y]),IM.fromArray(s).sub(m),E.push([IM.x,i[1]+i[3],IM.y],[IM.x,i[1],IM.y]),w.push([-p.x,0,-p.y],[-p.x,0,-p.y],[-p.x,0,-p.y],[-p.x,0,-p.y]),e.openBottom||(IM.fromArray(a).add(m),v.unshift([IM.x,i[1],IM.y],[IM.x,0,IM.y]),r=OM.fromArray(t).sub(IM).length(),y.unshift([(g-r)/f,i[1]/f],[(g-r)/f,0]),x.unshift([1-r/g,i[1]/f],[1-r/g,0]),IM.fromArray(s).add(m),v.unshift([IM.x,i[1],IM.y],[IM.x,0,IM.y]),r=OM.fromArray(t).sub(IM).length(),y.unshift([(g-r)/f,i[1]/f],[(g-r)/f,0]),x.unshift([1-r/g,i[1]/f],[1-r/g,0]),IM.fromArray(a).sub(m),b.push([IM.x,i[1],IM.y],[IM.x,0,IM.y]),r=OM.fromArray(n).sub(IM).length(),A.push([r/f,i[1]/f],[r/f,0]),S.push([r/_,i[1]/f],[r/_,0]),IM.fromArray(s).sub(m),b.push([IM.x,i[1],IM.y],[IM.x,0,IM.y]),r=OM.fromArray(n).sub(IM).length(),A.push([r/f,i[1]/f],[r/f,0]),S.push([r/_,i[1]/f],[r/_,0]),IM.fromArray(a).sub(m),E.push([IM.x,i[1],IM.y]),IM.fromArray(s).sub(m),E.push([IM.x,i[1],IM.y]),IM.fromArray(a).add(m),E.push([IM.x,i[1],IM.y]),IM.fromArray(s).add(m),E.push([IM.x,i[1],IM.y]),w.push([0,1,0],[0,1,0],[0,1,0],[0,1,0])),IM.fromArray(s).add(m),v.unshift([IM.x,f,IM.y],[IM.x,0,IM.y]),r=OM.fromArray(t).sub(IM).length(),y.unshift([(g-r)/f,1],[(g-r)/f,0]),x.unshift([1-r/g,1],[1-r/g,0]),IM.fromArray(s).sub(m),b.push([IM.x,f,IM.y],[IM.x,0,IM.y]),r=OM.fromArray(n).sub(IM).length(),A.push([r/f,1],[r/f,0]),S.push([r/_,1],[r/_,0])})),v.unshift([i[0],f,i[1]],[i[0],0,i[1]]),y.unshift([0,1],[0,0]),x.unshift([0,1],[0,0]),b.push([c[0],f,c[1]],[c[0],0,c[1]]),A.push([_/f,1],[_/f,0]),S.push([1,1],[1,0]);let C=e.uvrepeat[0]||1,T=e.uvrepeat[1]||1;const D=e.pickId;a.has(e.leftTexture)||a.set(e.leftTexture,{vertices:[],normals:[],uvs:[],uvs2:[],indices:[],pickIds:[],_pickId:[]});let M,P,F=a.get(e.leftTexture),R=F.vertices,N=F.normals,B=F.uvs,I=F.uvs2;r&&(M=F.pickIds,P=F._pickId,P.push(D));for(let e=0,t=v.length;e<t;e+=4)R.push(v[e+0][0],v[e+0][1],v[e+0][2]),R.push(v[e+1][0],v[e+1][1],v[e+1][2]),R.push(v[e+2][0],v[e+2][1],v[e+2][2]),R.push(v[e+3][0],v[e+3][1],v[e+3][2]),N.push(m.x,0,m.y),N.push(m.x,0,m.y),N.push(m.x,0,m.y),N.push(m.x,0,m.y),B.push(y[e+0][0]*C,y[e+0][1]*T),B.push(y[e+1][0]*C,y[e+1][1]*T),B.push(y[e+2][0]*C,y[e+2][1]*T),B.push(y[e+3][0]*C,y[e+3][1]*T),I.push(x[e+0][0],x[e+0][1]),I.push(x[e+1][0],x[e+1][1]),I.push(x[e+2][0],x[e+2][1]),I.push(x[e+3][0],x[e+3][1]),r&&(M.push(D),M.push(D),M.push(D),M.push(D));C=e.uvrepeat[2]||1,T=e.uvrepeat[3]||1,a.has(e.rightTexture)||a.set(e.rightTexture,{vertices:[],normals:[],uvs:[],uvs2:[],indices:[],pickIds:[],_pickId:[]});let O,k,L=a.get(e.rightTexture),U=L.vertices,z=L.normals,j=L.uvs,V=L.uvs2;r&&(O=L.pickIds,k=L._pickId,k.push(D));for(let e=0,t=b.length;e<t;e+=4)U.push(b[e+0][0],b[e+0][1],b[e+0][2]),U.push(b[e+1][0],b[e+1][1],b[e+1][2]),U.push(b[e+2][0],b[e+2][1],b[e+2][2]),U.push(b[e+3][0],b[e+3][1],b[e+3][2]),z.push(-m.x,0,-m.y),z.push(-m.x,0,-m.y),z.push(-m.x,0,-m.y),z.push(-m.x,0,-m.y),j.push(A[e+0][0]*C,A[e+0][1]*T),j.push(A[e+1][0]*C,A[e+1][1]*T),j.push(A[e+2][0]*C,A[e+2][1]*T),j.push(A[e+3][0]*C,A[e+3][1]*T),V.push(S[e+0][0],S[e+0][1]),V.push(S[e+1][0],S[e+1][1]),V.push(S[e+2][0],S[e+2][1]),V.push(S[e+3][0],S[e+3][1]),r&&(O.push(D),O.push(D),O.push(D),O.push(D));r&&u.push(D);const G=e.holes.filter((e=>e.openTop)).reverse();let W=[i[0],i[1]],H=[c[0],c[1]];G.forEach((e=>{let t=e.rect,n=BM.copy(h).add(IM.copy(p).multiplyScalar(t[0])).toArray([]),i=BM.copy(h).add(IM.copy(p).multiplyScalar(t[0]+t[2])).toArray([]);IM.fromArray(i).add(m),s.push(W[0],f,W[1]),s.push(IM.x,f,IM.y),o.push(0,1,0),o.push(0,1,0),IM.fromArray(i).sub(m),s.push(H[0],f,H[1]),s.push(IM.x,f,IM.y),o.push(0,1,0),o.push(0,1,0),r&&(l.push(D),l.push(D),l.push(D),l.push(D)),IM.fromArray(n).add(m),IM.toArray(W),IM.fromArray(n).sub(m),IM.toArray(H)})),s.push(i[0],f,i[1]),s.push(t[0],f,t[1]),s.push(c[0],f,c[1]),s.push(n[0],f,n[1]),o.push(0,1,0),o.push(0,1,0),o.push(0,1,0),o.push(0,1,0),r&&(l.push(D),l.push(D),l.push(D),l.push(D)),void 0===e.fixPoints[0]&&void 0===e.fixPoints[1]&&(s.push(t[0],f,t[1]),s.push(t[0],0,t[1]),o.push(-p.x,0,-p.y),o.push(-p.x,0,-p.y),s.push(n[0],f,n[1]),s.push(n[0],0,n[1]),o.push(-p.x,0,-p.y),o.push(-p.x,0,-p.y),r&&(l.push(D),l.push(D),l.push(D),l.push(D))),void 0===e.fixPoints[2]&&void 0===e.fixPoints[3]&&(s.push(c[0],f,c[1]),s.push(c[0],0,c[1]),o.push(p.x,0,p.y),o.push(p.x,0,p.y),s.push(i[0],f,i[1]),s.push(i[0],0,i[1]),o.push(p.x,0,p.y),o.push(p.x,0,p.y),r&&(l.push(D),l.push(D),l.push(D),l.push(D)));for(let e=0;e<E.length;e+=4)s.push(E[e+0][0],E[e+0][1],E[e+0][2]),s.push(E[e+1][0],E[e+1][1],E[e+1][2]),s.push(E[e+2][0],E[e+2][1],E[e+2][2]),s.push(E[e+3][0],E[e+3][1],E[e+3][2]),o.push(w[e+0][0],w[e+0][1],w[e+0][2]),o.push(w[e+1][0],w[e+1][1],w[e+1][2]),o.push(w[e+2][0],w[e+2][1],w[e+2][2]),o.push(w[e+3][0],w[e+3][1],w[e+3][2]),r&&(l.push(D),l.push(D),l.push(D),l.push(D))})),a.forEach((e=>{for(let t=0,r=e.vertices.length/12;t<r;t++)e.indices.push(4*t+0,4*t+1,4*t+2),e.indices.push(4*t+1,4*t+3,4*t+2)}));const c=[];for(let e=0;e<s.length/12;e++)c.push(4*e+0,4*e+1,4*e+2),c.push(4*e+1,4*e+3,4*e+2);n.forEach((e=>{let t=[];if(e.walls.forEach((r=>{let n;r.startCorner===e?(n=r.fixPoints[0],void 0===n&&void 0!==r.fixPoints[1]&&(n=r.startLeft)):(n=r.fixPoints[3],void 0===n&&void 0!==r.fixPoints[2]&&(n=r.endRight)),void 0!==n&&t.push(n)})),t.length>2){let n=e.walls[0].height,i=s.length/3,a=i+t.length,u=e.walls[0].pickId;t.forEach((e=>{s.push(e[0],n,e[1]),o.push(0,1,0),r&&l.push(u)}));for(let e=i+1;e<a-1;e++)c.push(i,e+1,e)}}));const h=[];a.forEach(((e,n)=>{const i=new _p;i.addAttribute("a_Position",new up(new cp(new Float32Array(e.vertices),3))),i.addAttribute("a_Normal",new up(new cp(new Float32Array(e.normals),3))),i.addAttribute("a_Uv",new up(new cp(new Float32Array(e.uvs),2))),i.addAttribute("a_Uv2",new up(new cp(new Float32Array(e.uvs2),2))),i.setIndex(new up(new cp(e.vertices.length/3>65536?new Uint32Array(e.indices):new Uint16Array(e.indices),1))),r&&(i.addAttribute("ids",new up(new cp(new Float32Array(e.pickIds),1))),i.__pickIds=e._pickId.slice(0)),i.computeBoundingBox(),i.computeBoundingSphere();const a=((e,t,r)=>{let n,i=e?"texture_"+e:"texture_null";return i+="_usePickId_"+r,UM.has(i)?n=UM.get(i):(n=new E_,r&&(n.defines.USE_ATTRIBUTES_ID=!0),n.diffuse.setHex(16777215),n.roughness=1,n.metalness=.3,UM.set(i,n),t?(oE(e,rE,null,(e=>{e&&(n.diffuseMap=e.getTexture({wrap:Gc.REPEAT,anisotropy:16}),n.needsUpdate=!0)})),oE(t,rE,null,(e=>{e&&(n.aoMap=e.getTexture({anisotropy:16}),n.needsUpdate=!0)}))):oE(e,rE,null,(e=>{e&&(n.diffuseMap=e.getTexture({wrap:Gc.REPEAT,anisotropy:16}),n.needsUpdate=!0)}))),n})(n,t.aoMaps?t.aoMaps[n]:void 0,r);h.push(new ap(i,a))}));const d=new _p;d.addAttribute("a_Position",new up(new cp(new Float32Array(s),3))),d.addAttribute("a_Normal",new up(new cp(new Float32Array(o),3))),d.setIndex(new up(new cp(s.length/3>65536?new Uint32Array(c):new Uint16Array(c),1))),r&&(d.addAttribute("ids",new up(new cp(new Float32Array(l),1))),d.__pickIds=u.slice(0)),d.computeBoundingBox(),d.computeBoundingSphere();const p=new ap(d,r?LM:kM);return h.push(p),i.forEach((e=>{e.startCorner=null,e.endCorner=null})),n.forEach((e=>{e.walls=null})),n.clear(),h},VM=new Sc;class GM{constructor(e){this._uScene=e}parseWall(e,t={}){const r=jM(e,t);let n=new QE(this._uScene);return r.forEach((e=>n.$node.add(e))),n.$markChildrenMatrixAutoUpdate(!1),n}parseParticle(e,t={}){let r=new sC(this._uScene);return r.setup({url:t.rootPath,data:e,options:t}),r}parseModel(e,t={}){const r=bE(e,t),n=new ap(r.geo,(e=>{const t=e.lights,r=e.envMap;if(!1===t){let e="lights";if(!1===r&&(e+="_envMap"),!vE.has(e)){const t=_S(yE);!1===r&&(t.envMap=void 0),vE.set(e,t)}return vE.get(e)}if(void 0!==e.metalness||void 0!==e.roughness||void 0!==e.envMap){const t="metalness-"+e.metalness+"roughness-"+e.roughness+"envMap-"+e.envMap;return vE.has(t)||vE.set(t,gS(yE,e)),vE.get(t)}return yE})(t));let i=new QE(this._uScene,n);if(void 0!==t.renderLayer&&i.setRenderLayer(t.renderLayer),t&&t.matrices){xS(n,t.matrices).forEach((e=>i.$node.add(e)))}else n.$unode=i,n.castShadow=!0,n.receiveShadow=!0,n.matrixAutoUpdate=!1;return i._geoRes=r,i.$markChildrenMatrixAutoUpdate(!1),xE(r.cacheKey),i}merge(e,t){if(!e)return;const r=new Map;for(let n=0;n<e.length;n++)e[n].$getRenderableList().forEach((e=>{let i=e.material;r.has(i)||r.set(i,[]),r.get(i).push({offset:t?e.worldMatrix.clone().multiply(VM.fromArray(t[n])):e.worldMatrix.clone(),geometry:e.geometry})}));const n=new od;r.forEach(((e,t)=>{const r=[];e.forEach((e=>{const t=e.geometry.clone();Gb.applyMatrix4(t,e.offset),t.boundingBox=null,t.boundingSphere=null,r.push(t)}));const i=Gb.mergeGeometries(r,!1);r[0]&&0!==r[0].groups.length&&(i.groups=r[0].groups.map((e=>({start:0,count:e.count,materialIndex:e.materialIndex})))),i.computeBoundingBox(),i.computeBoundingSphere(),n.add(new ap(i,t))}));return new QE(this._uScene,n)}destory(){this._uScene=null}}class WM extends QE{constructor(e,t=0){const r=new _p;r.addAttribute("a_Position",new up(new cp(new Float32Array(3*t),3))),r.addAttribute("a_Color",new up(new cp(new Float32Array(3*t),3))),r.addGroup(0,t);const n=new T_;n.drawMode=Kc.LINES,n.vertexColors=Yc.RGB;const i=new ap(r,[n]);super(e,i),i.castShadow=!1,i.receiveShadow=!1,this._mesh=i,this.$markChildrenMatrixAutoUpdate(!1)}getType(){return"LineSegments"}setSize(e){const t=this._mesh.geometry;e!==t.getAttribute("a_Position").buffer.count&&(t.dispose(),t.addAttribute("a_Position",new up(new cp(new Float32Array(3*e),3))),t.addAttribute("a_Color",new up(new cp(new Float32Array(3*e),3))),t.groups[0].count=e,this.$boundingBox.selfBoundingBoxNeedsUpdate=!0)}getSize(){return this._mesh.geometry.getAttribute("a_Position").buffer.count}setPoints(e){const t=this._mesh.geometry,r=t.getAttribute("a_Position"),n=r.size,i=r.buffer.array;for(let t=0,r=e.length;t<r;t++){const r=t*n;i[r+0]=e[t][0],i[r+1]=e[t][1],i[r+2]=e[t][2]}this._mesh.geometry.groups[0].count=e.length,r.buffer.version++,t.computeBoundingBox(),t.computeBoundingSphere(),this.$boundingBox.selfBoundingBoxNeedsUpdate=!0}getPoints(){return this._mesh.geometry.getAttribute("a_Position").buffer.array}setColors(e){const t=this._mesh.geometry.getAttribute("a_Color"),r=t.size,n=t.buffer.array;for(let t=0,i=e.length;t<i;t++){const i=t*r;n[i+0]=e[t][0],n[i+1]=e[t][1],n[i+2]=e[t][2]}t.buffer.version++}getColors(){return this._mesh.geometry.getAttribute("a_Color").buffer.array}dispose(){super.dispose(),this._mesh.geometry.dispose(),this._mesh.material[0].dispose(),this._mesh=null}copy(e){return super.copy(e,!1,!1),this._mesh.geometry.copy(e._mesh.geometry),this}clone(){return new this.constructor(this._uScene).copy(this)}}const HM=new Wh,qM=new Sc,XM=new jh,QM=new bc,KM=(e,t,r,n,i,a,s)=>{const o=XM.distanceSqToPoint(e);if(o<r){const r=new bc;XM.closestPointToPoint(e,r),r.applyMatrix4(n);const l=i.origin.distanceTo(r);if(l<0||l>Infinity)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:r,index:t,face:null,object:s})}};let YM=class extends ap{constructor(){super(...arguments),this.geometry=new _p,this.geometry.addAttribute("a_Position",new up(new cp(new Float32Array,3))),this.material=new G_,this.material.defines.UV_DISCARD=!0}raycast(e,t){const r=this.geometry,n=this.worldMatrix;if(r.boundingSphere.isEmpty()&&r.computeBoundingSphere(),HM.copy(r.boundingSphere),HM.applyMatrix4(n),HM.radius+=1,!e.intersectsSphere(HM))return;qM.getInverse(n),XM.copy(e).applyMatrix4(qM);const i=1/((this.scale.x+this.scale.y+this.scale.z)/3),a=i*i,s=r.getAttribute("a_Position");for(let r=0,i=s.buffer.count;r<i;r++)QM.fromArray(s.buffer.array,3*r),KM(QM,r,a,n,e,t,this)}};YM.prototype.isPoints=!0;class ZM extends oC{constructor(e){const t=new YM;super(e,t);const r=this;t.onBeforeRender=function(e,t){t.size=r._size,t.imageRatio=r._imageRatio,t.sizeAttenuation!==r._sizeAttenuation&&(t.sizeAttenuation=r._sizeAttenuation,t.needsUpdate=!0)},this._mesh=t,this._size=1,this._imageRatio=1,this._sizeAttenuation=!0,this._pickedIds=[],this._autoUpdate=!0,this.$markChildrenMatrixAutoUpdate(!1)}getType(){return"Points"}setSize(e){this._size=e}getSize(){return this._size}setImageRatio(e){this._imageRatio=e}getImageRatio(){return this._imageRatio}setSizeAttenuation(e){this._sizeAttenuation=e}getSizeAttenuation(){return this._sizeAttenuation}setPoints(e){super.setPoints(e),this._autoUpdate&&this._updateGeometry()}setPickedIds(e){this._pickedIds=e.slice(0),this._autoUpdate&&this._updateGeometry()}getPickedIds(e){return e.length=0,this._pickedIds.forEach((t=>{e.push(t)})),e}begin(){this._autoUpdate=!1}end(){this._updateGeometry(),this._autoUpdate=!0}dispose(){super.dispose(),this._mesh.onBeforeRender=()=>{},this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null}copy(e){super.copy(e),this._size=e._size,this._imageRatio=e._imageRatio,this._sizeAttenuation=e._sizeAttenuation,this._updateGeometry()}_updateGeometry(){this._mesh.geometry.dispose();const e=this._points.flat(2);this._mesh.geometry.addAttribute("a_Position",new up(new cp(new Float32Array(e),3))),this._pickedIds.length>0?this._mesh.geometry.addAttribute("ids",new up(new cp(new Float32Array(this._pickedIds.slice(0)),1))):0==this._pickedIds.length&&this._mesh.geometry.getAttribute("ids")&&this._mesh.geometry.removeAttribute("ids"),this._mesh.geometry.computeBoundingBox(),this._mesh.geometry.computeBoundingSphere(),this.$boundingBox.selfBoundingBoxNeedsUpdate=!0}}class JM{constructor(e){this.camera=new Bd,this.targets=[new bc(1,0,0),new bc(-1,0,0),new bc(0,1,0),new bc(0,-1,0),new bc(0,0,1),new bc(0,0,-1)],this.ups=[new bc(0,-1,0),new bc(0,-1,0),new bc(0,0,1),new bc(0,0,-1),new bc(0,-1,0),new bc(0,-1,0)],this.camera.setPerspective(.5*Math.PI,1,1,1e3),this.position=new bc,this.lookTarget=new bc,this.renderTarget=e||new Cm(512,512),this.renderTexture=this.renderTarget.texture,this.renderTexture.minFilter=Vc.LINEAR_MIPMAP_LINEAR,this.renderOption={ifRender:function(e){return!e.object.skipReflectionProbe}}}render(e,t){const r=e.renderPass;this.camera.position.copy(this.position);for(let n=0;n<6;n++){this.lookTarget.set(this.targets[n].x+this.camera.position.x,this.targets[n].y+this.camera.position.y,this.targets[n].z+this.camera.position.z),this.camera.lookAt(this.lookTarget,this.ups[n]),this.camera.updateMatrix(),this.renderTarget.activeCubeFace=n,r.setRenderTarget(this.renderTarget),r.clear(!0,!0,!0);const i=t.updateRenderStates(this.camera,!1),a=t.updateRenderQueue(this.camera,!1,!1);let s;for(let t=0,r=a.layerList.length;t<r;t++)s=a.layerList[t],e.renderRenderableList(s.opaque,i,this.renderOption),e.renderRenderableList(s.transparent,i,this.renderOption);r.updateRenderTargetMipmap(this.renderTarget)}}}class $M{static prefilterEnvironmentMap(e,t,r={}){const n=r.sampleSize||1024,i=t.isTextureCube;let a;a=i?0===t.images.length?16:t.images[0].width:t.image.width/4;const s=Math.floor(Math.log2(a));a=Math.pow(2,s);const o=e.renderPass.capabilities;o.version>1?o.getExtension("EXT_color_buffer_float"):(o.getExtension("OES_texture_half_float"),o.getExtension("OES_texture_half_float_linear")),o.getExtension("OES_texture_float_linear"),o.getExtension("EXT_color_buffer_half_float");let l=jc.HALF_FLOAT,u=Uint16Array,c=zc.RGBA;const h=r.outputTexture||new Ip;h.type=l,h.format=c,h.generateMipmaps=!1;const d=new Cm(a,a);d.texture.type=l,d.texture.format=c,d.texture.magFilter=Vc.LINEAR,d.texture.minFilter=Vc.LINEAR,d.texture.generateMipmaps=!1;const p=new cm(1,1,1),f=new bp(eP);f.side=Lc.BACK,f.cubeMap=t,f.uniforms.environmentMap=t,i?(f.uniforms.envMapFlip=t.images[0]&&t.images[0].rtt?-1:1,f.defines.PANORAMA=!1):(f.uniforms.envMapFlip=1,f.defines.PANORAMA=!0);const m=function(e,t){e=e||256,t=t||1024;const r=new Bp,n=new Float32Array(t*e*4);r.image={width:e,height:t,data:n},r.type=jc.FLOAT,r.minFilter=Vc.NEAREST,r.magFilter=Vc.NEAREST,r.generateMipmaps=!1,r.version++;const i=[];for(let r=0;r<e;r++){const a=r/e,s=a*a;for(let e=0;e<t;e++){let t=(e<<16|e>>>16)>>>0;t=((1431655765&t)<<1|(2863311530&t)>>>1)>>>0,t=((858993459&t)<<2|(3435973836&t)>>>2)>>>0,t=((252645135&t)<<4|(4042322160&t)>>>4)>>>0,t=(((16711935&t)<<8|(4278255360&t)>>>8)>>>0)/4294967296;const r=Math.sqrt((1-t)/(1+(s*s-1)*t));i[e]=r}for(let a=0;a<t;a++){const s=4*(a*e+r),o=i[a],l=Math.sqrt(1-o*o),u=a/t,c=2*Math.PI*u;n[s]=l*Math.cos(c),n[s+1]=o,n[s+2]=l*Math.sin(c),n[s+3]=1}}return r}(256,n);f.uniforms.normalDistribution=m;const g=new ap(p,f);g.frustumCulled=!1;const _=new Nd,v=new JM(d);v.camera.add(g),_.add(v.camera);const y=r.onBeforeFilter;y&&y(h,v);const x=r.compatibleRender;for(let t=0;t<s+1;t++){f.uniforms.roughness=Math.max(t-1,0)/s,v.render(e,_),x||(h.mipmaps[t]=[]);for(let r=0;r<6;r++){const n=new u(d.width*d.height*4);d.activeCubeFace=r,e.renderPass.setRenderTarget(d),e.renderPass.readRenderTargetPixels(0,0,d.width,d.height,n),0===t&&(h.images[r]={width:d.width,height:d.height,data:n}),x||h.mipmaps[t].push({width:d.width,height:d.height,data:n})}d.resize(d.width/2,d.height/2)}return d.dispose(),p.dispose(),f.dispose(),m.dispose(),h.version++,h}}const eP={name:"rmrem",defines:{PANORAMA:!1,SAMPLE_NUMBER:1024},uniforms:{environmentMap:null,normalDistribution:null,roughness:.5,envMapFlip:1},vertexShader:"\n\t\t#include <common_vert>\n\t\tvarying vec3 vDir;\n\t\tvoid main() {\n\t\t\tvDir = (u_Model * vec4(a_Position, 0.0)).xyz;\n\t\t\tgl_Position = u_ProjectionView * u_Model * vec4(a_Position, 1.0);\n\t\t\tgl_Position.z = gl_Position.w; // set z to camera.far\n\t\t}\n\t",fragmentShader:"\n\t\t#include <common_frag>\n\t\t#ifdef PANORAMA\n\t\t\tuniform sampler2D environmentMap;\n\t\t#else\n\t\t\tuniform samplerCube environmentMap;\n\t\t#endif\n\t\tuniform sampler2D normalDistribution;\n\t\tuniform float roughness;\n\t\tuniform float envMapFlip;\n\t\tvarying vec3 vDir;\n\n\t\tvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\n\t\t\tvec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\n\t\t\n\t\t\tvec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n\t\t\tvec3 tangentX = normalize(cross(N, upVector));\n\t\t\tvec3 tangentZ = cross(N, tangentX);\n\t\t\t// Tangent to world space\n\t\t\treturn normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tvec3 V = normalize(vDir);\n\n\t\t\tvec3 N = V;\n\n\t\t\tvec3 prefilteredColor = vec3(0.0);\n\t\t\tfloat totalWeight = 0.0;\n\t\t\tfloat fMaxSampleNumber = float(SAMPLE_NUMBER);\n\n\t\t\tfor (int i = 0; i < SAMPLE_NUMBER; i++) {\n\t\t\t\tvec3 H = importanceSampleNormal(float(i) / fMaxSampleNumber, roughness, N);\n\t\t\t\tvec3 L = reflect(-V, H);\n\t\t\n\t\t\t\tfloat NoL = clamp(dot(N, L), 0.0, 1.0);\n\t\t\t\tif (NoL > 0.0) {\n\t\t\t\t\t#ifdef PANORAMA\n\t\t\t\t\t\tfloat phi = acos(L.y);\n\t\t\t\t\t\tfloat theta = envMapFlip * atan(L.x, L.z) + PI * 0.5;\n\t\t\t\t\t\tvec2 uv = vec2(theta / 2.0 / PI, -phi / PI);\n\t\t\t\t\t\tprefilteredColor += mapTexelToLinear(texture2D(environmentMap, fract(uv))).rgb * NoL;\n\t\t\t\t\t#else\n\t\t\t\t\t\tprefilteredColor += mapTexelToLinear(textureCube(environmentMap, vec3(envMapFlip * L.x, L.yz))).rgb * NoL;\n\t\t\t\t\t#endif\n\t\t\t\t\ttotalWeight += NoL;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4(prefilteredColor / totalWeight, 1.0);\n\t\t\t#include <encodings_frag>\n\t\t}\n\t"};class tP extends TM{constructor(e={},t,r){super(),this.$uAppView=t,this.$uScene=r,this._EquirectangularReflectionToCubeMap=null,this._textureVersion=0,this._textureType=void 0===e.textureType?null:e.textureType,e.textureType===AM||CM(e)===AM?(this._mapping="UV",this._texture=new Bp,t._compatibleRender&&(this._texture.encoding=Xc.GAMMA),null===this._textureType&&(this._texture.image=e,this._texture.version++)):e.textureType===EM||e.format&&xM[e.format]&&e.mipmaps?this._createCompressedTexture(e,t._compatibleRender):e.textureType===wM||e.data instanceof Uint8Array&&e.width&&e.height?(this._mapping="UV",this._texture=new Bp,t._compatibleRender&&(this._texture.encoding=Xc.GAMMA),null===this._textureType&&(this._texture.image=e,this._texture.version++),this._texture.format=zc.RGBA,this._texture.minFilter=Vc.NEAREST,this._texture.magFilter=Vc.NEAREST,this._texture.generateMipmaps=!1,this._texture.flipY=!1):console.warn("ImageTextureResource: unsupported image type.")}_createCompressedTexture(e,t){this.$uAppView.getExtensions().has("WEBGL_compressed_texture_s3tc"),this.$uAppView.getExtensions().has("WEBGL_compressed_texture_pvrtc"),this._texture||(this._texture=new Bp,t&&(this._texture.encoding=Xc.GAMMA)),this._texture.image=e,this._texture.image.isCompressed=!0,this._texture.mipmaps=e.mipmaps,1===e.mipmapCount&&(this._texture.minFilter=Vc.LINEAR),this._texture.flipY=!1,this._texture.format=xM[e.format],this._texture.generateMipmaps=!1,this._texture.version++}setMapping(e){"EquirectangularReflection"!==e&&null!==this._EquirectangularReflectionToCubeMap&&(this._EquirectangularReflectionToCubeMap.dispose(),this._EquirectangularReflectionToCubeMap=null),this.$uAppView.$markTexture(this),this._mapping=vM[e]}setColorFormat(e){super.setColorFormat(e),this.$uAppView.$markTexture(this)}refresh(){this._texture.version++,this.$uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}setImage(e){null===this._textureType||this._textureType===CM(e)||CM(e)===EM?(this.$uAppView.$markTexture(this),this._texture.image=e,this._texture.version++,e.format&&e.mipmaps&&this._createCompressedTexture(e,this.$uAppView._compatibleRender),this.$uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0):console.warn("ImageTextureResource: unsupported image type.")}getImage(){return this._texture.image}$preprocessEquTex(){const e=this._texture,t=this._EquirectangularReflectionToCubeMap;if(e.image&&this._textureVersion!==e.version&&t){const r=this.$uAppView._compatibleRender;t.images.length=0,$M.prefilterEnvironmentMap(this.$uAppView._renderer,e,{outputTexture:t,compatibleRender:r,onBeforeFilter:(t,n)=>{r&&(t.encoding=e.encoding,t.generateMipmaps=e.generateMipmaps,t.minFilter=e.minFilter,t.magFilter=e.magFilter,n.renderTarget.texture.encoding=e.encoding),n.camera.gammaFactor=1.5,n.camera.outputEncoding=Xc.GAMMA}}),this._textureVersion=e.version}}dispose(){this._texture.dispose(),this._EquirectangularReflectionToCubeMap&&this._EquirectangularReflectionToCubeMap.dispose(),this.$uAppView=null}get isUImageTextureResource(){return!0}get $texture(){return"EquirectangularReflection"==this._mapping?(null==this._EquirectangularReflectionToCubeMap&&(this._EquirectangularReflectionToCubeMap=new Ip,this.$uAppView.$markTexture(this)),this._EquirectangularReflectionToCubeMap):this._texture}}class rP extends TM{constructor(e={},t,r){if(super(),this.$uAppView=t,this.$uScene=r,this._textureType=void 0===e.textureType?null:e.textureType,e.textureType===EM||e.format&&xM[e.format]&&e.mipmaps)this._createCompressedTexture(e,t._compatibleRender);else if(e.textureType===SM||Array.isArray(e)&&6===e.length){this._mapping="CubeReflection";const r=new Ip;if(null===this._textureType){const t=r.images;for(let r=0;r<6;r++)t[r]=e[r];r.version++}this._texture=r,t._compatibleRender&&(this._texture.encoding=Xc.GAMMA)}else console.warn("CubeTextureResource: unsupported image type.")}refresh(){this._texture.version++,this.$uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0}setImages(e){null===this._textureType||this._textureType===CM(e)?(e.format&&e.mipmaps?this._createCompressedTexture(e,this.$uAppView._compatibleRender):"CubeReflection"===this._mapping||this._texture.isTextureCube?(this._texture.images=e,this._texture.version++):console.warn("CubeTextureResource: only support cube image resource."),this.$uScene.$effectsBufferDirtyManager.dirtyEffectBuffers=!0):console.warn("CubeTextureResource: unsupported image type.")}getImages(){return this._texture.images}getImageByIndex(e){return this._texture.images[e]}_createCompressedTexture(e,t){if(this.$uAppView.getExtensions().has("WEBGL_compressed_texture_s3tc"),this.$uAppView.getExtensions().has("WEBGL_compressed_texture_pvrtc"),this._texture||(this._texture=new Ip,t&&(this._texture.encoding=Xc.GAMMA)),!0===e.isCubemap){this._texture&&this._texture.isTextureCube||(this._texture=new Ip);const t=e.mipmaps.length/e.mipmapCount;this._texture.mipmaps[0]=[];for(let r=0;r<t;r++)this._texture.images[r]=e.mipmaps[r*e.mipmapCount],this._texture.images[r].isCompressed=!0;for(let r=0;r<e.mipmapCount;r++){this._texture.mipmaps[r]=[];for(let n=0;n<t;n++)this._texture.mipmaps[r].push(e.mipmaps[n*e.mipmapCount+r])}1===e.mipmapCount&&(this._texture.minFilter=Vc.LINEAR),this._texture.flipY=!1,this._texture.format=xM[e.format],this._texture.generateMipmaps=!1,this._texture.version++}else console.warn("CubeTextureResource: need cube compressed texture data.")}get isUCubeTextureResource(){return!0}get $Texture(){return this._texture}}class nP extends TM{constructor(e={},t){super(),this.$uAppView=t,this._texture=new Bp}setMapping(e){this._mapping=vM[e]}refresh(){}setImage(){}getImage(){return null}dispose(){this._texture.dispose(),this.$uAppView=null}get isUEmptyTextureResource(){return!0}get $texture(){return null}}function iP(e,t,r,n){if(Array.isArray(e)){const i=iP(new Float64Array(e),t,r,n);for(let t=0;t<e.length;t++)e[t]=i[t];return e}if(!t||!r)throw Error("Bad dimensions");n||(n=e.length/(t*r));let i=r>>1,a=t*n,s=new(0,e.constructor)(t*n);for(let t=0;t<i;++t){let n=t*a,i=(r-t-1)*a;s.set(e.subarray(n,n+a)),e.copyWithin(n,i,i+a),e.set(s,i)}return e}class aP extends TM{constructor(e){super(),this.$uAppView=e,this._captureBuffer=new Uint8Array(1048576),this._renderTarget=new Em(256,256),this._renderTarget.texture.minFilter=Vc.LINEAR,this._renderTarget.texture.magFilter=Vc.LINEAR,this._renderTarget.texture.format=zc.RGBA,this._texture=this._renderTarget.texture,Object.defineProperty(this._texture,"needsUpdate",{set:function(){}})}setSize(e){this._renderTarget.resize(e[0],e[1]);const t=4*e[0]*e[1];this._captureBuffer.length!==t&&(this._captureBuffer=new Uint8Array(t))}getSize(e){return e[0]=this._renderTarget.width,e[1]=this._renderTarget.height,e}getPixelBuffer(){return this.$uAppView.$renderer.renderPass.setRenderTarget(this._renderTarget),this.$uAppView.$renderer.renderPass.readRenderTargetPixels(0,0,this._renderTarget.width,this._renderTarget.height,this._captureBuffer),iP(this._captureBuffer,this._renderTarget.width,this._renderTarget.height),this._captureBuffer}dispose(){this._renderTarget.dispose(),this.$uAppView=null}get $renderTarget(){return this._renderTarget}}const sP=e=>{const t=new T_;return t.diffuseMap=e.diffuseMap,t.diffuse.copy(e.diffuse),t};class oP{constructor(e=sP){this._uuid=$h(),this._reflectFunction=e}get reflectFunction(){return this._reflectFunction}}const lP=`\n#define USE_LAMBERT\n\n#include <common_vert>\n#include <normal_pars_vert>\n${ig.uv_pars_vert}\n#include <color_pars_vert>\n#include <modelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <aoMap_pars_vert>\n#include <alphamap_pars_vert>\n#include <emissiveMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <morphtarget_pars_vert>\n#include <skinning_pars_vert>\n#include <logdepthbuf_pars_vert>\n${eg.instance_pars_vert}\nvoid main() {\n    #include <begin_vert>\n    #include <morphtarget_vert>\n    #include <morphnormal_vert>\n    #include <skinning_vert>\n    #include <skinnormal_vert>\n    ${eg.instance_position_vert}\n    #include <pvm_vert>\n    ${eg.instance_normal_vert}\n    #include <normal_vert>\n    #include <logdepthbuf_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    ${eg.instance_color_vert}\n    #include <modelPos_vert>\n    #include <envMap_vert>\n    #include <aoMap_vert>\n    ${ig.alphamap_vert}\n    ${ig.emissivemap_vert}\n    #include <shadowMap_vert>\n}\n`,uP=`\n#define USE_LAMBERT\n\n#include <common_frag>\n#include <dithering_pars_frag>\n\nuniform vec3 emissive;\n\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <normalMap_pars_frag>\n#include <alphamap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <modelPos_pars_frag>\n#include <bsdfs>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <logdepthbuf_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <logdepthbuf_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphamap_frag>\n    #include <alphaTest_frag>\n    #include <normal_frag>\n\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n    #include <light_frag>\n    #include <aoMap_frag>\n    outColor.xyz = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\n    #include <envMap_frag>\n    #include <shadowMap_frag>\n\n    vec3 totalEmissiveRadiance = emissive;\n    ${ig.emissivemap_frag}\n    outColor.xyz += totalEmissiveRadiance;\n\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n    #include <dithering_frag>\n}\n`;class cP extends mm{constructor(){super(...arguments),this.type=Nc.SHADER,this.shaderName="CUSTOM_LAMBERT",this.name="",this.vertexShader=lP,this.fragmentShader=uP,this.defines={USE_INSTANCING:!1,USE_UV3:!1,USE_SIDE_EMISSIVE:!1},this._verticalEmissive=!1,this._wireframe=!1}set verticalEmissive(e){this._verticalEmissive!==e&&(this._verticalEmissive=e,e?(this.defines.USE_UV3=!0,this.defines.USE_SIDE_EMISSIVE=!0,this.emissiveMapCoord=2):(this.defines.USE_UV3=!1,this.defines.USE_SIDE_EMISSIVE=!1,this.emissiveMapCoord=0),this.needsUpdate=!0)}get verticalEmissive(){return this._verticalEmissive}set wireframe(e){e!==this._wireframe&&(this._wireframe=e,this.drawMode=e?Kc.LINES:Kc.TRIANGLES)}get wireframe(){return this._wireframe}copy(e){return super.copy(e),this.verticalEmissive=e.verticalEmissive,this.wireframe=e.wireframe,this.name=e.name,e.userData&&(this.userData=cloneJson(e.userData)),this}s;get isLambertMaterial(){return!0}}cP.prototype.useDefaultBufferMaterial=!0;const hP="Unlit",dP="Standard",pP="Lambert",fP="FatLine",mP="Water",gP={Front:Lc.FRONT,Back:Lc.BACK,Double:Lc.DOUBLE},_P={};for(let e in gP)_P[gP[e]]=e;const vP={NoBlending:Bc.NONE,NormalBlending:Bc.NORMAL,AdditiveBlending:Bc.ADD,SubtractiveBlending:Bc.SUB,MultiplyBlending:Bc.MUL},yP={};for(let e in vP)yP[vP[e]]=e;class xP{constructor(e={}){this.uuid=$h(),this._material=null,this._map=null,this._alphaMap=null,this._aoMap=null,this._emissiveMap=null,this._envMap=null,this._normalMap=null;const{type:t,material:r}=e;r?this._material=r:(this._generateMaterialByType(t),this._initMaterial(e))}_generateMaterialByType(e="Standard"){switch(e){case hP:this._material=new T_;break;case dP:this._material=new E_;break;case pP:this._material=new cP;break;case fP:this._material=new bC;break;case mP:this._material=new TT}}_initMaterial(e={}){void 0!==e.side&&(this._material.side=gP[e.side]),void 0!==e.metalness&&this._material.isPBRMaterial&&(this._material.metalness=e.metalness),void 0!==e.roughness&&this._material.isPBRMaterial&&(this._material.roughness=e.roughness),void 0!==e.specularFactor&&this._material.isPBRMaterial&&(this._material.specularFactor=e.specularFactor),void 0!==e.map&&(this._map=e.map,this._material.diffuseMap=e.map.$texture),void 0!==e.normalMap&&(this._normalMap=e.normalMap,this._material.normalMap=e.normalMap.$texture),void 0!==e.normalScale&&this._material.normalScale.fromArray(e.normalScale),void 0!==e.uvMatrix&&this._material.diffuseMapTransform.fromArray(e.uvMatrix),void 0!==e.alphaMap&&(this._alphaMap=e.alphaMap,this._material.alphaMap=e.alphaMap.$texture),void 0!==e.alphaUvMatrix&&this._material.alphaMapTransform.fromArray(e.alphaUvMatrix),void 0!==e.alphaMapCoord&&(this._material.alphaMapCoord=e.alphaMapCoord),void 0!==e.aoMap&&(this._aoMap=e.aoMap,this._material.aoMap=e.aoMap.$texture),void 0!==e.aoUvMatrix&&this._material.aoMapTransform.fromArray(e.aoUvMatrix),void 0!==e.aoMapIntensity&&(this._material.aoMapIntensity=e.aoMapIntensity),void 0!==e.depthWrite&&(this._material.depthWrite=e.depthWrite),void 0!==e.depthTest&&(this._material.depthTest=e.depthTest),void 0!==e.transparent&&(this._material.transparent=e.transparent),void 0!==e.blending&&(this._material.blending=vP[e.blending]),void 0!==e.color&&this._material.diffuse.fromArray(e.color),void 0!==e.emissive&&this._material.emissive.fromArray(e.emissive),void 0!==e.emissiveMap&&(this._emissiveMap=e.emissiveMap,this._material.emissiveMap=e.emissiveMap.$texture),void 0!==e.emissiveUvMatrix&&this._material.emissiveMapTransform.fromArray(e.emissiveUvMatrix),void 0!==e.envMap&&(this._envMap=e.envMap,this._material.envMap=e.envMap.$texture),void 0!==e.envMapIntensity&&(this._material.envMapIntensity=e.envMapIntensity),void 0!==e.opacity&&(this._material.opacity=e.opacity),void 0!==e.lights&&this._material.isPBRMaterial&&(this._material.simulateBasic=!e.lights)}setMacro(e,t){void 0!==this._material.defines[e]&&this._material.defines[e]!==t&&(this._material.defines[e]=t,this._material.needsUpdate=!0)}getMacro(e){if(void 0!==this._material.defines[e])return this._material.defines[e]}setUniform(e,t){void 0!==this._material.uniforms[e]&&(this._material.uniforms[e]=t)}getUniform(e){if(void 0!==this._material.uniforms[e])return this._material.uniforms[e]}set side(e){this._material.side=gP[e]}get side(){return _P[this._material.side]}set metalness(e){this._material.isPBRMaterial&&(this._material.metalness=e)}get metalness(){if(this._material.isPBRMaterial)return this._material.metalness}set specularFactor(e){this._material.isPBRMaterial&&(this._material.specularFactor=e)}get specularFactor(){if(this._material.isPBRMaterial)return this._material.specularFactor}set roughness(e){this._material.isPBRMaterial&&(this._material.roughness=e)}get roughness(){if(this._material.isPBRMaterial)return this._material.roughness}set map(e){this._map!=e&&(this._map=e,this._material.diffuseMap=e?e.$texture:e,this._material.needsUpdate=!0)}get map(){return this._map}set normalMap(e){this._normalMap!=e&&(this._normalMap=e,this._material.normalMap=e?e.$texture:e,this._material.needsUpdate=!0)}get normalMap(){return this._normalMap}set alphaMap(e){this._alphaMap!=e&&(this._alphaMap=e,this._material.alphaMap=e?e.$texture:e,this._material.needsUpdate=!0)}get alphaMap(){return this._alphaMap}set aoMap(e){this._aoMap!=e&&(this._aoMap=e,this._material.aoMap=e?e.$texture:e,this._material.needsUpdate=!0)}get aoMap(){return this._aoMap}set aoMapIntensity(e){this._material.aoMapIntensity=e}get aoMapIntensity(){return this._material.aoMapIntensity}set alphaMapCoord(e){this._material.alphaMapCoord=e}get alphaMapCoord(){return this._material.alphaMapCoord}set uvMatrix(e){this._material.diffuseMapTransform.fromArray(e)}get uvMatrix(){return this._material.diffuseMapTransform.toArray()}set normalScale(e){this._material.normalScale.fromArray(e)}get normalScale(){return this._material.normalScale.toArray()}set alphaUvMatrix(e){this._material.alphaMapTransform.fromArray(e)}get alphaUvMatrix(){return this._material.alphaMapTransform.toArray()}set aoUvMatrix(e){this._material.aoMapTransform.fromArray(e)}get aoUvMatrix(){return this._material.aoMapTransform.toArray()}set depthWrite(e){this._material.depthWrite=e}get depthWrite(){return this._material.depthWrite}set depthTest(e){this._material.depthTest=e}get depthTest(){return this._material.depthTest}set transparent(e){this._material.transparent=e}get transparent(){return this._material.transparent}set blending(e){this._material.blending=vP[e]}get blending(){return yP[this.material.blending]}set color(e){this._material.diffuse.fromArray(e)}get color(){return this._material.diffuse.toArray()}set emissive(e){this._material.emissive.fromArray(e)}get emissive(){return this._material.emissive.toArray()}set emissiveMap(e){this._emissiveMap!=e&&(this._emissiveMap=e,this._material.emissiveMap=e?e.$texture:e,this._material.needsUpdate=!0)}get emissiveMap(){return this._emissiveMap}set emissiveUvMatrix(e){this._material.emissiveMapTransform.fromArray(e)}get emissiveUvMatrix(){return this._material.emissiveMapTransform.toArray()}set envMap(e){this._envMap!=e&&(this._envMap=e,this._material.envMap=e?e.$texture:e,this._material.needsUpdate=!0)}get envMap(){return this._envMap}set envMapIntensity(e){this._material.envMapIntensity=e}get envMapIntensity(){return this._material.envMapIntensity}set opacity(e){this._material.opacity=e}get opacity(){return this._material.opacity}set lights(e){this._material.isPBRMaterial&&(this._material.simulateBasic=!e)}get lights(){return!this._material.simulateBasic}dispose(){this._material&&(this._material.dispose(),this._material=null)}copy(e){return this._material&&e._material&&this._material.copy(e._material),this}clone(){return(new this.constructor).copy(this)}$getMaterial(){return this._material}}const bP=(new Mc).setFromEuler(new Dh(-Math.PI/2,0,0)).toMatrix4(),AP={positions:3,normals:3,uvs:2,uvs2:2,uvs3:2,uvs4:2,uvs5:2,ids:1},SP={positions:"a_Position",normals:"a_Normal",uvs:"a_Uv",uvs2:"a_Uv2"};class EP{static getExtrudeShapeGeometryResource(e,t){if(!e)return;let r;e.depth>0?(e.depth=-e.depth,r=mT.getGeometryData(e)):r=_T(e);const n=new EP;return r=(e=>{if(0===Object.keys(e).length||e.attributes)return;console.warn("The vertexData format has changed, please use the new format");const t={vertexBuffer:[],attributes:{},indices:[]};for(let r in e)if("indices"==r)t[r]=e[r];else{let n=AP[r];if(!AP)continue;t.vertexBuffer.push({array:e[r],stride:n}),t.attributes[r]=t.vertexBuffer.length-1}return t})(r),n.setVertexData(r,t),Gb.applyMatrix4(n._geometry,bP,!0),n}constructor(){this.uuid=$h(),this._geometry=new _p,this._geometry.addAttribute("a_Position",new up(new cp(new Float32Array,3))),this._vertexData=null,this._disposeArray=!1,this._attributes=[]}setVertexData(e,t=!1){e&&(this._vertexData=e,this._disposeArray=t,this._initAttribute(),this._generateGeometry())}getVertexData(){return this._vertexData}computeNormals(){this._geometry&&Gb.computeNormals(this._geometry)}setAttributeIndex(e,t){this._disposeArray||t>this._vertexData.vertexBuffer.length-1?console.warn("Invalid buffer subscript value"):(this._vertexData.attributes[e]=t,e=SP[e]?SP[e]:e,this._geometry.addAttribute(e,this._attributes[t]),this._geometry.version++)}setAttribute(e,t){switch(e=SP[e]?SP[e]:e){case"a_Position":this._geometry.attributes.a_Position&&this._geometry.index?this._geometry.attributes.a_Position.buffer.array.length===t.length?(this._geometry.attributes.a_Position.buffer.array=t,this._geometry.attributes.a_Position.buffer.version++,this.computeNormals()):console.warn("The length of position array is not equal to the previous,please check the data given."):(this._geometry.attributes.a_Position=new up(new cp(t,3)),this.computeNormals());break;case"a_Normal":this._geometry.attributes.a_Normal?this._geometry.attributes.a_Normal.buffer.array.length===t.length?(this._geometry.attributes.a_Normal.buffer.array=t,this._geometry.attributes.a_Normal.buffer.version++):console.warn("The length of normal array is not equal to the previous,please check the data given."):this._geometry.attributes.a_Normal=new up(new cp(t,3));break;case"a_Uv":this._geometry.attributes.a_Uv?this._geometry.attributes.a_Uv.buffer.array.length===t.length?(this._geometry.attributes.a_Uv.buffer.array=t,this._geometry.attributes.a_Uv.buffer.version++):console.warn("The length of uv array is not equal to the previous,please check the data given."):this._geometry.attributes.a_Uv=new up(new cp(t,2));break;case"a_Uv2":this._geometry.attributes.a_Uv2?this._geometry.attributes.a_Uv2.buffer.array.length===t.length?(this._geometry.attributes.a_Uv2.buffer.array=t,this._geometry.attributes.a_Uv2.buffer.version++):console.warn("The length of uv2 array is not equal to the previous,please check the data given."):this._geometry.attributes.a_Uv2=new up(new cp(t,2))}this._geometry.version++}getAttribute(e){let t=null;switch(e=SP[e]?SP[e]:e){case"a_Position":this._geometry.attributes.a_Position&&(t=this._geometry.attributes.a_Position.buffer.array);break;case"a_Normal":this._geometry.attributes.a_Normal&&(t=this._geometry.attributes.a_Normal.buffer.array);break;case"a_Uv":this._geometry.attributes.a_Uv&&(t=this._geometry.attributes.a_Uv.buffer.array);break;case"a_Uv2":this._geometry.attributes.a_Uv2&&(t=this._geometry.attributes.a_Uv2.buffer.array)}return t}dispose(){this._geometry&&this._geometry.dispose(),this._geometry=null,this._vertexData=null,this._disposeArray=!1,this._attributes=[]}copy(e){if(e._disposeArray)return console.warn("UGeometryResource: Can not copy when disposeArray is true."),this;this._disposeArray=e._disposeArray,e._geometry&&this._geometry?this._geometry.copy(e._geometry):e._geometry&&(this._geometry=e._geometry.clone()),e._vertexData&&(this._vertexData=id(e._vertexData));const t=new WeakMap;for(let r=0,n=e._attributes.length;r<n;r++)this._attributes[r]=e._attributes[r].clone(t);return this}clone(){return(new this.constructor).copy(this)}_initAttribute(){const e=this._vertexData.vertexBuffer;this._attributes.length=0;const t=this._attributes;for(let r=0,n=e.length;r<n;r++){const n=e[r].array,i=e[r].stride;let a;a=Array.isArray(n)?new up(new cp(new Float32Array(n),i)):new up(new cp(n,i)),t.push(a)}return t}_generateGeometry(){const e=this._geometry;e.dispose(),e.setIndex(null);for(const t in e.attributes)e.removeAttribute(t);const t=this._vertexData,r=t.attributes;t.indices&&e.setIndex(t.indices);for(let t in r){const n=r[t],i=this._attributes[n];this._disposeArray&&"ids"!==t&&(i.buffer.onUploadCallback=wP),SP[t]?e.addAttribute(SP[t],i):e.addAttribute(t,i)}e.computeBoundingBox(),e.computeBoundingSphere(),e.version++,this._disposeArray&&(this._vertexData=null,this._attributes=[])}get $disposeArray(){return this._disposeArray}$setGeometry(e){e&&(this._geometry=e)}$getGeometry(){return this._geometry}}function wP(){this.array=null}class CP extends TM{constructor(e){super(),this._texture=new Bp,this._texture.image=e,this._texture.format=zc.RGBA,this._texture.magFilter=Vc.LINEAR,this._texture.minFilter=Vc.LINEAR,this._texture.generateMipmaps=!1;const t=this._texture,r=()=>{t.version++,e.requestVideoFrameCallback(r)};this._updateVideo=r,"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(r)}setImage(e){"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?(this._texture.image=e,"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(this._updateVideo)):console.warn("VideoTextureResource: unsupported image type.")}getImage(){return this._texture.image}}let TP=class{constructor(){this._uAppView=null,this._uScene=null}createObject(e,t={}){const r=this._createObject(e,t);return r?("AppView"===e?this._uAppView=r:"Scene"===e&&(this._uScene=r),r):null}_createObject(e,t){switch(e){case"Node":return new QE(this._uScene).$parseOptions(t);case"CustomNode":return new ZE(this._uScene,t.geometryResource,t.materialResource);case"Sprite":return new rw(this._uScene);case"Points":return new ZM(this._uScene);case"ParticleSystem":return new sC(this._uScene);case"ParticleGroup":return new aC(t);case"ParticleEmitter":return new Ww(t);case"PixelLine":return new pC(this._uScene,t.materialResource);case"FatLine":return new EC(this._uScene,t.materialResource);case"RouteLine":return new UC(this._uScene,t.materialResource);case"PolygonLine":return new IC(this._uScene,t.materialResource);case"ExtrudeShape":return new AT(this._uScene,t.materialResource);case"Water":return new PT(this._uScene);case"Camera":return new jD(this._uScene,this._uAppView,t).$parseOptions(t);case"AmbientLight":return new zT(this._uScene).$parseOptions(t);case"DirectionalLight":return new FT(this._uScene).$parseOptions(t);case"Lensflare":return new kT(this._uScene);case"SpotLight":return new LT(this._uScene).$parseOptions(t);case"PointLight":return new UT(this._uScene).$parseOptions(t);case"HemisphereLight":return new jT(this._uScene).$parseOptions(t);case"LineSegments":return new WM(this._uScene,t.size);case"Style":return new XA(t.instancedMaxCount||1e3,t.materialReflect).$parseOptions(t);case"ImageTextureResource":{const e=void 0!==t.data?t.data:t;return new tP(e,this._uAppView,this._uScene)}case"CubeTextureResource":{const e=void 0!==t.data?t.data:t;return new rP(e,this._uAppView,this._uScene)}case"EmptyTextureResource":return new nP(t,this._uAppView);case"VideoTextureResource":return new CP(t.data);case"RenderTextureResource":return new aP(this._uAppView);case"MaterialReflect":return new oP(t.reflectFunction);case"MaterialResource":return new xP(t);case"GeometryResource":return new EP;case"Scene":return new Yb;case"OrbitControls":{const e=t.appDelegate.getAttribute("Container");return new $D(t.camera,e).$parseOptions(t)}case"ResourceManager":return new MM(this._uScene);case"ParserManager":return new GM(this._uScene);case"AppView":{const e=t.appDelegate,r=t.compatibleMode,n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=new Uv({canvas:n,alpha:!0,antialias:!0,compatibleMode:r}),a=[0,0];return e.getSize(a),i.setSize(a),e.setAttribute("Canvas",n),i}default:return null}}};class DP extends gh{constructor(e){super(e)}load(e,t,r,n){const i=new Bp,a=new yh(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){i.image=e,i.version++,t&&t(i)}),r,n),i}}var MP=Object.freeze({__proto__:null,ATTACHMENT:Zc,AmbientLight:Nm,AnimationAction:th,AnimationMixer:dh,Attribute:up,AxesHelper:class extends od{constructor(e){super();const t=new Float32Array([0,0,0,e,0,0]);var r=this.createAxisMesh(t,16711680);super.add(r);const n=new Float32Array([0,0,0,0,e,0]);var i=this.createAxisMesh(n,65280);super.add(i);const a=new Float32Array([0,0,0,0,0,e]);var s=this.createAxisMesh(a,255);super.add(s),this.userData.isDebuggerNode=!0}createAxisMesh(e,t){const r=new _p,n=new cp(e,3);r.addAttribute("a_Position",new up(n,3,0)),r.setIndex(new up(new cp(new Uint16Array([0,1]),1))),r.computeBoundingBox(),r.computeBoundingSphere();const i=new fm;i.diffuse.setHex(t),i.depthTest=!1,i.depthWrite=!1,i.transparent=!0,i.side=Lc.DOUBLE,i.drawMode=Kc.LINES;const a=new ap(r,i);return a.position.set(0,0,0),a.castShadow=!0,a.renderOrder=1e3,a.userData.isDebuggerNode=!0,a}update(){}},BLEND_EQUATION:Ic,BLEND_FACTOR:Oc,BLEND_TYPE:Bc,BUFFER_USAGE:Jc,BasicMaterial:fm,Bone:Vm,BooleanKeyframeTrack:vc,Box2:bh,Box3:Sh,Box3Helper:class extends od{constructor(e,t=16776960){super(),this.box=e,this.type="Box3Helper";var r=this.genVertexArr(),n=this.genIndexArr(),i=this.createBoxMesh(r,n,t);super.add(i),this.userData.isDebuggerNode=!0}genVertexArr(){var e=this.box.min.x,t=this.box.min.y,r=this.box.min.z,n=this.box.max.x,i=this.box.max.y,a=this.box.max.z;return new Float32Array([e,t,r,n,t,r,n,i,r,e,i,r,e,t,a,n,t,a,n,i,a,e,i,a])}genIndexArr(){return new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7])}createBoxMesh(e,t,r){const n=new _p,i=new cp(e,3);n.addAttribute("a_Position",new up(i,3,0)),n.setIndex(new up(new cp(t,1))),n.computeBoundingBox(),n.computeBoundingSphere();const a=new fm;a.diffuse=r,a.depthTest=!1,a.depthWrite=!1,a.transparent=!0,a.side=Lc.DOUBLE,a.drawMode=Kc.LINES;const s=new ap(n,a);return s.position.set(0,0,0),s.castShadow=!0,s.renderOrder=1e3,s.userData.isDebuggerNode=!0,s}update(){}},BoxGeometry:cm,Buffer:cp,COMPARE_FUNC:Wc,CULL_FACE_TYPE:kc,Camera:Bd,Color3:Eh,ColorKeyframeTrack:yc,CubeGeometry:cm,CylinderGeometry:hm,DRAW_MODE:Kc,DRAW_SIDE:Lc,DefaultLoadingManager:mh,DepthMaterial:Sp,DirectionalLight:Om,DirectionalLightShadow:Im,DistanceMaterial:Ep,ENVMAP_COMBINE_TYPE:Qc,EdgesBuilder:TA,EnvironmentMapPass:Hm,Euler:Dh,EventDispatcher:eh,ExtendBasicMaterial:T_,ExtendPBRMaterial:E_,ExtendPointsMaterial:G_,ExtrudeShapeBuilder:mT,FOG_TYPE:Km,Factory:TP,FileLoader:_h,Fog:lm,FogExp2:um,Frustum:Ih,Geometry:_p,GeometryUtils:Gb,Group:Wm,HemisphereLight:km,ImageLoader:yh,KeyframeClip:ph,KeyframeTrack:_c,LIGHT_TYPE:Xm,LambertMaterial:mm,Light:Fm,LightData:pd,LightShadow:Bm,LineMaterial:gm,Loader:gh,LoadingManager:fh,MATERIAL_TYPE:Nc,MatcapMaterial:_m,Material:xp,Matrix3:Ph,Matrix4:Sc,Mesh:ap,NumberKeyframeTrack:xc,OBJECT_TYPE:Qm,OPERATION:Hc,Object3D:od,PBR2Material:vm,PBRMaterial:ym,PIXEL_FORMAT:zc,PIXEL_TYPE:jc,PhongMaterial:xm,Plane:Nh,PlaneGeometry:vp,PointLight:Um,PointLightShadow:Lm,PointsMaterial:bm,PropertyBindingMixer:rh,QUERY_TYPE:$c,Quaternion:Mc,QuaternionKeyframeTrack:Pc,Query:Dm,Ray:jh,RenderBuffer:Sm,RenderInfo:om,RenderQueue:Ed,RenderQueueLayer:Sd,RenderStates:Rd,RenderTarget2D:Em,RenderTargetBack:wm,RenderTargetBase:Am,RenderTargetCube:Cm,Renderer:sm,SHADING_TYPE:Uc,SHADOW_TYPE:qc,Scene:Nd,SceneData:Pd,ShaderChunk:of,ShaderLib:uf,ShaderMaterial:bp,ShaderPostPass:Ap,ShadowMapPass:wp,ShapeGeometry:DT,Skeleton:Pm,SkinnedMesh:Gm,Sphere:Wh,SphereGeometry:dm,Spherical:Hh,SpotLight:jm,SpotLightShadow:zm,StringKeyframeTrack:Fc,TEXEL_ENCODING_TYPE:Xc,TEXTURE_FILTER:Vc,TEXTURE_WRAP:Gc,Texture2D:Bp,Texture2DLoader:DP,Texture3D:Op,TextureBase:Np,TextureCube:Ip,TorusKnotGeometry:pm,Triangle:Yh,UCustomNode:ZE,UGeometryResource:EP,UNode:QE,UPoints:ZM,VERTEX_COLOR:Yc,Vector2:xh,Vector3:bc,Vector4:Zh,VectorKeyframeTrack:Rc,VertexNormalsHelper:class extends od{constructor(e,t,r){super(),this.object=e,this.size=void 0!==t?t:.1,this.type="VertexNormalsHelper",this.color=this.genColor(r),this.userData.isDebuggerNode=!0,this.data=this.getNormalData(),this.data&&(this.mattrix=null,this.normalsMesh=this.createNormalsMesh(),super.add(this.normalsMesh))}getNormalData(){var e,t,r=this.object.geometry;if(r&&r.attributes.a_Normal&&r.attributes.a_Position&&(e=r.attributes.a_Normal.buffer,t=r.attributes.a_Position.buffer),!e||!t||e.count!=t.count)return null;return{posBuffer:t.clone(),normalBuffer:e.clone(),count:e.count}}genColor(e){return e=void 0!==e?e:16711680,(new Eh).setHex(e)}genVertexArr(){return new Float32Array(6*this.data.count)}genIndexArr(){const e=new Uint16Array(this.data.count);for(let t=0;t<this.data.count;t++)e[t]=t;return e}createNormalsMesh(){let e=this.genVertexArr(),t=this.genIndexArr();const r=new _p,n=new cp(e,3);r.addAttribute("a_Position",new up(n,3,0)),r.setIndex(new up(new cp(t,1))),r.computeBoundingBox(),r.computeBoundingSphere();const i=new fm;i.diffuse=this.color,i.depthTest=!1,i.depthWrite=!1,i.transparent=!0,i.side=Lc.DOUBLE,i.drawMode=Kc.LINES;const a=new ap(r,i);return a.position.set(0,0,0),a.castShadow=!0,a.renderOrder=1e3,a.userData.isDebuggerNode=!0,a}update(){this.data&&(this.updateForWorldMatrixChange(),this.updateForGeometryChange())}updateForWorldMatrixChange(){if(this.object.updateWorldMatrix(!0),this.mattrix&&this.mattrix.equals(this.object.worldMatrix))return;this.mattrix=this.object.worldMatrix.clone();let e=new bc,t=new bc,r=new Ph;r=r.setFromMatrix4(this.mattrix).inverse().transpose();let n=this.normalsMesh.geometry.attributes.a_Position.buffer.array,i=this.data;for(let a=0;a<this.data.count;a++){let s=6*a,o=3*a;t.x=i.posBuffer.array[o],t.y=i.posBuffer.array[o+1],t.z=i.posBuffer.array[o+2],t.applyMatrix4(this.mattrix),n[s]=t.x,n[s+1]=t.y,n[s+2]=t.z,e.x=i.normalBuffer.array[o],e.y=i.normalBuffer.array[o+1],e.z=i.normalBuffer.array[o+2],e.applyMatrix3(r).normalize(),n[s+3]=n[s]+this.size*e.x,n[s+4]=n[s+1]+this.size*e.y,n[s+5]=n[s+2]+this.size*e.z}this.normalsMesh.geometry.attributes.a_Position.buffer.version++}updateForGeometryChange(){var e=this.object.geometry;let t=e.attributes.a_Normal.buffer,r=e.attributes.a_Position.buffer;t.version===this.data.normalBuffer.version&&r.version===this.data.posBuffer.version||(this.data=this.getNormalData(),this.data&&(super.remove(this.normalsMesh),this.mattrix=null,this.normalsMesh=this.createNormalsMesh(),super.add(this.normalsMesh)))}},WEBGL_COMPARE_FUNC:Wc,WEBGL_OP:Hc,WEBGL_PIXEL_FORMAT:zc,WEBGL_PIXEL_TYPE:jc,WEBGL_TEXTURE_FILTER:Vc,WEBGL_TEXTURE_TYPE:qm,WEBGL_TEXTURE_WRAP:Gc,WaterMaterial:TT,WebGLAttribute:tf,WebGLCapabilities:Af,WebGLGeometries:Hf,WebGLProgram:nf,WebGLPrograms:cf,WebGLProperties:Pf,WebGLQueries:Qf,WebGLRenderBuffers:Uf,WebGLRenderPass:am,WebGLState:Mf,WebGLTextures:Ff,WebGLUniforms:ef,cloneJson:id,cloneUniforms:nd,colorMappingShader:rg,fresnelShader:ng,generateUUID:$h,gpu_pickerShader:tg,instanceShader:eg,isPowerOfTwo:ed,lightShader:ag,nearestPowerOfTwo:td,nextPowerOfTwo:rd,skyBox_vert:$m,uvShader:ig,uv_discard_frag:Jm});function PP(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function FP(e){return FP="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},FP(e)}function RP(e){var t=function(e,t){if("object"!==FP(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==FP(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===FP(t)?t:String(t)}function NP(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,RP(n.key),n)}}function BP(e,t,r){return t&&NP(e.prototype,t),r&&NP(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function IP(e){return IP=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},IP(e)}function OP(){return OP="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=IP(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},OP.apply(this,arguments)}function kP(e,t){return kP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},kP(e,t)}function LP(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kP(e,t)}function UP(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zP(e,t){if(t&&("object"===FP(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return UP(e)}var jP=function(e,t,r){r=r||2;var n,i,a,s,o,l,u,c=t&&t.length,h=c?t[0]*r:e.length,d=VP(e,0,h,r,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function(e,t,r,n){var i,a,s,o=[];for(i=0,a=t.length;i<a;i++)(s=VP(e,t[i]*n,i<a-1?t[i+1]*n:e.length,n,!1))===s.next&&(s.steiner=!0),o.push($P(s));for(o.sort(KP),i=0;i<o.length;i++)YP(o[i],r),r=GP(r,r.next);return r}(e,t,d,r)),e.length>80*r){n=a=e[0],i=s=e[1];for(var f=r;f<h;f+=r)(o=e[f])<n&&(n=o),(l=e[f+1])<i&&(i=l),o>a&&(a=o),l>s&&(s=l);u=0!==(u=Math.max(a-n,s-i))?1/u:0}return WP(d,p,r,n,i,u),p};function VP(e,t,r,n,i){var a,s;if(i===function(e,t,r,n){for(var i=0,a=t,s=r-n;a<r;a+=n)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}(e,t,r,n)>0)for(a=t;a<r;a+=n)s=uF(a,e[a],e[a+1],s);else for(a=r-n;a>=t;a-=n)s=uF(a,e[a],e[a+1],s);return s&&nF(s,s.next)&&(cF(s),s=s.next),s}function GP(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!nF(n,n.next)&&0!==rF(n.prev,n,n.next))n=n.next;else{if(cF(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function WP(e,t,r,n,i,a,s){if(e){!s&&a&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=JP(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,s,o,l,u=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,n=r,o=0,t=0;t<u&&(o++,n=n.nextZ);t++);for(l=u;o>0||l>0&&n;)0!==o&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(s>1)}(i)}(e,n,i,a);for(var o,l,u=e;e.prev!==e.next;)if(o=e.prev,l=e.next,a?qP(e,n,i,a):HP(e))t.push(o.i/r),t.push(e.i/r),t.push(l.i/r),cF(e),e=l.next,u=l.next;else if((e=l)===u){s?1===s?WP(e=XP(GP(e),t,r),t,r,n,i,a,2):2===s&&QP(e,t,r,n,i,a):WP(GP(e),t,r,n,i,a,1);break}}}function HP(e){var t=e.prev,r=e,n=e.next;if(rF(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(eF(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&rF(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function qP(e,t,r,n){var i=e.prev,a=e,s=e.next;if(rF(i,a,s)>=0)return!1;for(var o=i.x<a.x?i.x<s.x?i.x:s.x:a.x<s.x?a.x:s.x,l=i.y<a.y?i.y<s.y?i.y:s.y:a.y<s.y?a.y:s.y,u=i.x>a.x?i.x>s.x?i.x:s.x:a.x>s.x?a.x:s.x,c=i.y>a.y?i.y>s.y?i.y:s.y:a.y>s.y?a.y:s.y,h=JP(o,l,t,r,n),d=JP(u,c,t,r,n),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&eF(i.x,i.y,a.x,a.y,s.x,s.y,p.x,p.y)&&rF(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&eF(i.x,i.y,a.x,a.y,s.x,s.y,f.x,f.y)&&rF(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&eF(i.x,i.y,a.x,a.y,s.x,s.y,p.x,p.y)&&rF(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&eF(i.x,i.y,a.x,a.y,s.x,s.y,f.x,f.y)&&rF(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function XP(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!nF(i,a)&&iF(i,n,n.next,a)&&oF(i,a)&&oF(a,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(a.i/r),cF(n),cF(n.next),n=e=a),n=n.next}while(n!==e);return GP(n)}function QP(e,t,r,n,i,a){var s=e;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&tF(s,o)){var l=lF(s,o);return s=GP(s,s.next),l=GP(l,l.next),WP(s,t,r,n,i,a),void WP(l,t,r,n,i,a)}o=o.next}s=s.next}while(s!==e)}function KP(e,t){return e.x-t.x}function YP(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>s){if(s=o,o===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r;var l,u=r,c=r.x,h=r.y,d=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&eF(a<h?i:s,a,c,h,a<h?s:i,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(i-n.x),oF(n,e)&&(l<d||l===d&&(n.x>r.x||n.x===r.x&&ZP(r,n)))&&(r=n,d=l)),n=n.next}while(n!==u);return r}(e,t),t){var r=lF(t,e);GP(t,t.next),GP(r,r.next)}}function ZP(e,t){return rF(e.prev,e,t.prev)<0&&rF(t.next,e,e.next)<0}function JP(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function $P(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function eF(e,t,r,n,i,a,s,o){return(i-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(n-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(i-s)*(n-o)>=0}function tF(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&iF(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(oF(e,t)&&oF(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(rF(e.prev,e,t.prev)||rF(e,t.prev,t))||nF(e,t)&&rF(e.prev,e,e.next)>0&&rF(t.prev,t,t.next)>0)}function rF(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function nF(e,t){return e.x===t.x&&e.y===t.y}function iF(e,t,r,n){var i=sF(rF(e,t,r)),a=sF(rF(e,t,n)),s=sF(rF(r,n,e)),o=sF(rF(r,n,t));return i!==a&&s!==o||(!(0!==i||!aF(e,r,t))||(!(0!==a||!aF(e,n,t))||(!(0!==s||!aF(r,e,n))||!(0!==o||!aF(r,t,n)))))}function aF(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function sF(e){return e>0?1:e<0?-1:0}function oF(e,t){return rF(e.prev,e,e.next)<0?rF(e,t,e.next)>=0&&rF(e,e.prev,t)>=0:rF(e,t,e.prev)<0||rF(e,e.next,t)<0}function lF(e,t){var r=new hF(e.i,e.x,e.y),n=new hF(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function uF(e,t,r,n){var i=new hF(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function cF(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function hF(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var dF=function(e,t,r){var n=e.contour,i=e.holes;if(pF(n)||(n=n.reverse()),i)for(var a=0,s=i.length;a<s;a++){var o=i[a];pF(o)&&(i[a]=o.reverse())}if(t=t||[],r=r||[],fF(n),mF(t,n),i){var l=n.length;i.forEach(fF);for(a=0;a<i.length;a++)r.push(l),l+=i[a].length,mF(t,i[a])}};function pF(e){return function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n][0]*e[i][1]-e[i][0]*e[n][1];return.5*r}(e)<0}function fF(e){var t=e.length;t>2&&function(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}(e[t-1],e[0])&&e.pop()}function mF(e,t){for(var r=0;r<t.length;r++)e.push(t[r][0]),e.push(t[r][1])}var gF=function(e){var t=[],r=[];dF(e,t,r);for(var n=jP(t,r),i=[],a=[],s=[],o=0,l=t.length;o<l;o+=2)i.push(t[o],0,t[o+1]),a.push(0,1,0),s.push(t[o],1-t[o+1]);return{positions:i,normals:a,uvs:s,indices:n}};function _F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var vF={uniforms:{tDiffuse:null,colormap:null,transparentCheck:null,extrudeHeight:1},vertexShader:"\n\t\t#include <common_vert>\n\t\t#include <logdepthbuf_pars_vert>\n\t\tattribute vec2 a_Uv;\n\t\tvarying vec2 vUV;\n\t\tvarying vec3 vNormal;\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float max;\n\t\tuniform float min;\n\t\tuniform float extrudeHeight;\n\t\tvoid main() {\n\t\t\tvUV = a_Uv;\n\t\t\tmat4 normalMatrix = inverse(u_View * u_Model);\n            normalMatrix = transpose(normalMatrix);\n            vec4 nor = normalMatrix * vec4(a_Normal, 1.0);\n\t\t\tvNormal = normalize( nor.xyz );\n\t\t\tfloat dv = texture2D( tDiffuse, vUV ).w;\n\t\t\tfloat df = extrudeHeight*dv;\n\t\t\tvec3 newPosition = vec3(a_Position.x,a_Position.y +df,a_Position.z);\n\t\t\tgl_Position =  u_Projection *  u_View * u_Model * vec4( newPosition, 1.0 );\n\t\t\t#include <logdepthbuf_vert>\n        }\n    ",fragmentShader:"\n\t\t#include <fog_pars_frag>\n\t\t#include <logdepthbuf_pars_frag>\n\n\t\tuniform sampler2D colormap;\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float u_Opacity;\n\t\t// uniform vec3 color;\n\t\tuniform bool transparentCheck;\n\t\tvarying vec3 vNormal;\n\n\t\tvarying vec2 vUV;\n\n\t\tvoid main(void) {\n\t\t\tvec4 dv = texture2D( tDiffuse, vUV);\n\t\t\t// if (dv.a == dv.r ) discard;\n\n\t\t\tvec3 finalcolor =  texture2D( colormap, vec2(dv.w,0.5) ).rgb;\n\t\t\tfloat opacity2 = u_Opacity ;\n\t\t\tif(transparentCheck){\n\t\t\t\topacity2 = u_Opacity * dv.w *2.0;\n\t\t\t}\n\t\t\tgl_FragColor = vec4(finalcolor,opacity2);\n\t\t\t#include <logdepthbuf_frag>\n\t\t\t#include <fog_frag>\n        }\n    "},yF=function(e){LP(r,e);var t=_F(r);function r(e){var n;return PP(this,r),(n=t.call(this,{type:"3DheatmapMaterial",defines:{},uniforms:vF.uniforms,vertexShader:vF.vertexShader,fragmentShader:vF.fragmentShader})).transparent=!0,n.side=Lc.DOUBLE,n.depthTest=!0,n.color=[1,1,1],n._wireframe=e,n}return BP(r,[{key:"wireframe",get:function(){return this._wireframe},set:function(e){e!==this._wireframe&&(this._wireframe=e,this.drawMode=e?Kc.LINES:Kc.TRIANGLES)}}]),r}(bp);function xF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var bF={uniforms:{color:[1,1,1],tDiffuse:null,texSize:[640,640],mosaicSize:[16,16]},vertexShader:"\n\t\t#include <common_vert>\n\t\t#include <logdepthbuf_pars_vert> \n\t\tattribute vec2 a_Uv;\n\t\tvarying vec2 vUV;\n        void main() {\n\t\t\tvUV = a_Uv;\n\t\t\tgl_Position = u_Projection * u_View * u_Model * vec4(a_Position,1.0);;\n\t\t\t#include <logdepthbuf_vert>\n        }\n    ",fragmentShader:"\n\t\tuniform\tfloat u_Opacity;\n\t\t#include <logdepthbuf_pars_frag>\n\t\t#include <fog_pars_frag>\n\n        uniform sampler2D tDiffuse;\n        uniform vec2 texSize;\n        uniform vec2 mosaicSize;\n\n\t\tuniform vec3 color;\n        varying vec2 vUV;\n\n        void main(void) {\n\t\t\tvec4 originColor = texture2D(tDiffuse, vUV);\n\n\t\t\tif (originColor.a < 0.0001) discard;\n\n\t\t\t#include <logdepthbuf_frag>\n\n            vec2 xy = vec2(vUV.x * texSize.x, vUV.y * texSize.y);\n            \n            vec2 xyMosaic = vec2(floor(xy.x / mosaicSize.x) * mosaicSize.x, \n                    floor(xy.y / mosaicSize.y) * mosaicSize.y )\n                    + .5*mosaicSize;\n            \n            vec2 delXY = xyMosaic - xy;\n            float delL = length(delXY);\n            \n            vec2 uvMosaic = vec2(xyMosaic.x / texSize.x, xyMosaic.y / texSize.y);\n\n            float percent = smoothstep(0., 1., 1. - delL * 2.4 / mosaicSize.x) * 0.7 + 0.3;\n\n            vec4 centerColor = texture2D(tDiffuse, uvMosaic);\n            \n            vec4 resultColor = vec4(mix(originColor.rgb, centerColor.rgb, percent)*color, centerColor.a * percent *u_Opacity);\n            \n\t\t\tgl_FragColor = resultColor;\n\t\t\t\n\t\t\t#include <fog_frag>\n        }\n    "},AF=function(e){LP(r,e);var t=xF(r);function r(){var e;return PP(this,r),(e=t.call(this,{type:"PointMosaic heatmap",defines:{},uniforms:bF.uniforms,vertexShader:bF.vertexShader,fragmentShader:bF.fragmentShader})).transparent=!0,e.side=Lc.DOUBLE,e.depthTest=!0,e.color=[1,1,1],e._wireframe=!1,e}return BP(r,[{key:"wireframe",get:function(){return this._wireframe},set:function(e){e!==this._wireframe&&(this._wireframe=e,this.drawMode=e?Kc.LINES:Kc.TRIANGLES)}}]),r}(bp);function SF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var EF={uniforms:{transparentCheck:!1,grayTexture:null,colormap:null},vertexShader:"#include <common_vert>\n\tattribute vec2 a_Uv;\n\tvarying vec2 vUv;\n\t#include <logdepthbuf_pars_vert>\n\tvoid main(){\n\t\tvUv = a_Uv;\n\t\tgl_Position = u_Projection * u_View * u_Model * vec4(a_Position,1.0);\n\t\t#include <logdepthbuf_vert>\n\t}",fragmentShader:"precision highp float;\n\tuniform bool transparentCheck;\n\tuniform float u_Opacity;\n\tuniform sampler2D grayTexture;\n\tuniform sampler2D colormap;\n\tvarying vec2 vUv;\n\t#include <logdepthbuf_pars_frag>\n\t#include <fog_pars_frag>\n\tvoid main(){\n\t\t#include <logdepthbuf_frag>\n\t\tvec4 color1 = texture2D( grayTexture, vUv );\n\t\tvec3 tarcolor1 =color1.rgb;\n\t\tfloat f1 =color1.a;\n\t\t\n\t\tvec4 color2 = texture2D( colormap, vec2(  f1,0.5) );\n\t\tvec3 tarcolor2 =color2.rgb;\n\t\tfloat opacity2 = u_Opacity ;\n\t\tif(transparentCheck){\n\t\t\topacity2 =  u_Opacity * f1 *2.0;\n\t\t}\n\t\tgl_FragColor = vec4(tarcolor2, opacity2);\n\t\t#include <fog_frag>\n\t}"},wF=function(e){LP(r,e);var t=SF(r);function r(e){var n;return PP(this,r),(n=t.call(this,{type:"2DheatmapMaterial",defines:{},uniforms:EF.uniforms,vertexShader:EF.vertexShader,fragmentShader:EF.fragmentShader})).transparent=!0,n.side=Lc.DOUBLE,n.depthTest=!0,n._wireframe=e,n}return BP(r,[{key:"wireframe",get:function(){return this._wireframe},set:function(e){e!==this._wireframe&&(this._wireframe=e,this.drawMode=e?Kc.LINES:Kc.TRIANGLES)}}]),r}(bp);function CF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var TF=function(e){LP(r,e);var t=CF(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),(e=t.call(this,n.external.uScene))._colorRamp=null,e._renderer=null,e._params={},e._mesh=null,e._2DMaterial=null,e._3DMaterial=null,e._mosaicMaterial=null,e._pointGeometry=null,e._renderer=n.external.param.renderer,e._initParameter(n.external.param),e._beforeSetup(),e._createNode(n.external.param),e._draw(),e.$markChildrenMatrixAutoUpdate(!1),e}return BP(r,[{key:"_beforeSetup",value:function(){var e=this._params.gradient,t=this._createCanvas();t.width=256,t.height=1,this._gradCtx=t.getContext("2d"),this._gradTexture=null,this._originalGrad=e,this._colorRamp=this._gradient(e);var r=this._params.areaWidth,n=this._params.areaHeight;this.scene1=new Nd,this.scene2=new Nd,this.renderTarget1=new Em(r,n),this.renderTarget2=new Em(r,n),this.renderTarget1.texture.minFilter=Vc.LINEAR,this.renderTarget1.texture.magFilter=Vc.LINEAR,this.renderTarget1.texture.encoding=Xc.GAMMA,this.renderTarget1.texture.generateMipmaps=!1,this.renderTarget2.texture.minFilter=Vc.LINEAR,this.renderTarget2.texture.magFilter=Vc.LINEAR,this.renderTarget2.texture.encoding=Xc.GAMMA,this.renderTarget2.texture.generateMipmaps=!1;var i=new Bd;i.position.set(0,0,10),i.updateMatrix(),i.lookAt(new bc(0,0,0),new bc(0,1,0)),i.setOrtho(r/-2,r/2,n/-2,n/2,.01,1e3),this.camera=i;var a=new Bd;a.position.set(0,0,10),a.updateMatrix(),a.lookAt(new bc(0,0,0),new bc(0,1,0)),a.setOrtho(r/-2,r/2,n/-2,n/2,.01,1e3),this.camera2=a}},{key:"_createPolygonGeometry",value:function(e){var t=new _p;e.index&&(t.index=new up(new cp(e.index,1)));var r=new cp(e.position instanceof Float32Array?e.position:new Float32Array(e.position),3);r.usage=Jc.DYNAMIC_DRAW,t.addAttribute("a_Position",new up(r,3));var n=new cp(e.uv instanceof Float32Array?e.uv:new Float32Array(e.uv),2);n.usage=Jc.DYNAMIC_DRAW,t.addAttribute("a_Uv",new up(n,2));var i=new cp(e.uv instanceof Float32Array?e.uv:new Float32Array(e.uv),2);if(i.usage=Jc.DYNAMIC_DRAW,t.addAttribute("a_Uv2",new up(i,2)),e.normal){var a=new cp(e.normal instanceof Float32Array?e.normal:new Float32Array(e.normal),3);a.usage=Jc.DYNAMIC_DRAW,t.addAttribute("a_Normal",new up(a,3))}return t}},{key:"_createNode",value:function(e){var t,r,n=this._params.areaWidth,i=this._params.areaHeight;if(void 0!==e.geometry)t=this._createPolygonGeometry(e.geometry);else if(e.mask||e.clipShape){var a=e.mask||e.clipShape,s=a.points||a.shape,o=gF({contour:s,holes:a.holes});t=new _p;for(var l=o.uvs,u=0;u<l.length/2;u++){var c=o.positions[3*u+0],h=o.positions[3*u+2];l[2*u+0]=(c+n/2)/n,l[2*u+1]=1-(h+i/2)/i}t.addAttribute("a_Position",new up(new cp(new Float32Array(o.positions),3))),t.addAttribute("a_Normal",new up(new cp(new Float32Array(o.normals),3))),t.addAttribute("a_Uv",new up(new cp(new Float32Array(l),2))),t.setIndex(new up(new cp(o.positions.length/3>65536?new Uint32Array(o.indices):new Uint16Array(o.indices),1)))}else{t=new vp(n,i,this._params.mapSize,this._params.mapSize);for(var d=(this._params.extent.maxX+this._params.extent.minX)/2,p=(this._params.extent.maxY+this._params.extent.minY)/2,f=0;f<t.attributes.a_Position.buffer.count;f++)t.attributes.a_Position.buffer.array[3*f]+=d,t.attributes.a_Position.buffer.array[3*f+2]+=p,t.attributes.a_Uv.buffer.array[2*f]=(t.attributes.a_Position.buffer.array[3*f]+n/2)/n,t.attributes.a_Uv.buffer.array[2*f+1]=1-(t.attributes.a_Position.buffer.array[3*f+2]+i/2)/i}this._2DMaterial=this._createHeatMaterial(this.renderTarget1.texture),"mosaic"===e.type?((r=new AF).uniforms.tDiffuse=this.renderTarget2.texture,r.isMosaic=!0):"3Dheatmap"===e.type?((r=this._3DMaterial=new yF).uniforms.tDiffuse=this.renderTarget1.texture,r.uniforms.extrudeHeight=this._params.extrudeHeight,r.uniforms.transparentCheck=this._params.alpha,r.isMosaic=!1):r=this._2DMaterial,r.uniforms.colormap=this._colorRamp,this._geometry=t,this._mesh||(this._mesh=new ap(this._geometry,r),this._mesh.geometry.computeBoundingSphere(),this._mesh.geometry.computeBoundingBox(),this._mesh.userData.skipEnvMap=!0,this._mesh.matrixAutoUpdate=!0,this._mesh.material.needsUpdate=!0,this._mesh.userData.skipOutline=!0,this._node.add(this._mesh))}},{key:"_updateGeometry",value:function(e){if("3Dheatmap"===this._params.type)this.updateSubBuffer("position",e.position),this.updateSubBuffer("normal",e.normal);else{var t=this._createPolygonGeometry(e);this._geometry=t,this._mesh.geometry=t}}},{key:"_initParameter",value:function(e){this._params.areaWidth=THING.Utils.parseValue(e.width,10),this._params.areaHeight=THING.Utils.parseValue(e.height,10),this._params.mapSize=THING.Utils.parseValue(e.mapSize,256),this._params.alpha=!!e.alpha;var t=THING.Utils.parseValue(e.gradient,{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"});this._params.gradient=t,this._params.minValue=void 0!==e.minValue?e.minValue:10,this._params.maxValue=void 0!==e.maxValue?e.maxValue:50,this._params.radius=THING.Utils.parseValue(e.radius,5),this._params.data=THING.Utils.parseValue(e.data,[]),this._params.mosaicSize=THING.Utils.parseValue(e.mosaicSize,3),this._params.extrudeHeight=THING.Utils.parseValue(e.extrudeHeight,1),this._params.type=THING.Utils.parseValue(e.type,"heatmap"),this._params.sigma=THING.Utils.parseValue(e.sigma,.158),this._params.extent=e.extent}},{key:"_updateWidthHeightAndData",value:function(e){this._params.areaWidth=e.width,this._params.areaHeight=e.height,this.renderTarget1.resize(e.width,e.height),this.renderTarget2.resize(e.width,e.height),this.camera.setOrtho(this._params.areaWidth/-2,this._params.areaWidth/2,this._params.areaHeight/-2,this._params.areaHeight/2,.01,1e3),this.camera2.setOrtho(this._params.areaWidth/-2,this._params.areaWidth/2,this._params.areaHeight/-2,this._params.areaHeight/2,.01,1e3),this._params.data=e.data,this._draw()}},{key:"_draw",value:function(){var e=this._params;this._createRTTMesh(),"mosaic"===e.type?(this._mesh.material.uniforms.mosaicSize?(this._mesh.material.uniforms.texSize=[this._params.areaWidth,this._params.areaHeight],this._mesh.material.uniforms.mosaicSize=[this._params.mosaicSize,this._params.mosaicSize]):(this._setMaterial(e),this._mesh.material.uniforms.texSize=[this._params.areaWidth,this._params.areaHeight],this._mesh.material.uniforms.mosaicSize=[this._params.mosaicSize,this._params.mosaicSize]),this.scene2.children[0].material.uniforms.colormap=this._colorRamp,this.scene2.children[0].material.uniforms.transparentCheck=this._params.alpha):"3Dheatmap"===e.type?this._mesh.material.uniforms.extrudeHeight?(this._mesh.material.uniforms.tDiffuse=this.renderTarget1.texture,this._mesh.material.uniforms.transparentCheck=this._params.alpha,this._mesh.material.uniforms.extrudeHeight=this._params.extrudeHeight,this._mesh.material.needsUpdate=!0):(this._setMaterial(e),this._mesh.material.uniforms.extrudeHeight=this._params.extrudeHeight):((this._mesh.material.uniforms.extrudeHeight||this._mesh.material.uniforms.mosaicSize)&&this._setMaterial(e),this._mesh.material.uniforms.grayTexture=this.renderTarget1.texture,this._mesh.material.uniforms.transparentCheck=this._params.alpha,this._mesh.material.needsUpdate=!0),this._mesh.material.uniforms.colormap=this._colorRamp,this.scene1.updateMatrix(),this.scene1.updateRenderStates(this.camera),this.scene1.updateRenderQueue(this.camera),this.scene2.updateMatrix(),this.scene2.updateRenderStates(this.camera2),this.scene2.updateRenderQueue(this.camera2),this._update()}},{key:"_createRTTMesh",value:function(){var e=this._params.data;if(e&&e.length){if(null==this._pointGeometry){for(var t=new _p,r=[],n=0;n<e.length;n++)r.push(e[n][0]),r.push(e[n][1]),r.push(0),r.push(e[n][2]);var i=new cp(new Float32Array(r),4);i.usage=Jc.DYNAMIC_DRAW;var a=new up(i,3,0);t.addAttribute("a_Position",a);var s=new up(i,1,3);t.addAttribute("strength",s),this._pointGeometry=t}else this._updatePointGeo(e);if(null==this._pointMaterial&&(this._pointMaterial=this._createGrayMaterial()),0==this.scene1.children.length){var o=new ap(this._pointGeometry,this._pointMaterial);this.scene1.add(o),this.scene1.add(this.camera)}else this.scene1.children[0].geometry=this._pointGeometry,this.scene1.children[0].material.needsUpdate=!0,this.scene1.children[0].material.uniforms.radius=this._params.radius,this.scene1.children[0].material.uniforms.u_minClick=this._params.minValue,this.scene1.children[0].material.uniforms.u_maxClick=this._params.maxValue}if(0==this.scene2.children.length){var l=new vp(this._params.areaWidth,this._params.areaHeight),u=new ap(l,this._2DMaterial);u.euler.x=Math.PI/2,u.matrixAutoUpdate=!0,this.scene2.add(u),this.scene2.add(this.camera2)}else this.scene2.children[0].material.needsUpdate=!0}},{key:"_setMaterial",value:function(e){var t;"mosaic"==e.type?(this._mosaicMaterial||(this._mosaicMaterial=new AF),this._mosaicMaterial.uniforms.tDiffuse=this.renderTarget2.texture,this._mosaicMaterial.isMosaic=!0,t=this._mosaicMaterial):"3Dheatmap"==e.type?(this._3DMaterial||(this._3DMaterial=new yF),this._3DMaterial.uniforms.tDiffuse=this.renderTarget1.texture,this._3DMaterial.uniforms.transparentCheck=this._params.alpha,this._3DMaterial.uniforms.extrudeHeight=this._params.extrudeHeight,this._3DMaterial.isMosaic=!1,t=this._3DMaterial):(this._2DMaterial.uniforms.grayTexture=this.renderTarget1.texture,t=this._2DMaterial),t.uniforms.colormap=this._colorRamp,this._mesh.material=t,this._mesh.material.needsUpdate=!0}},{key:"_createGrayMaterial",value:function(){var e={radius:this._params.radius,u_maxClick:this._params.maxValue,u_minClick:this._params.minValue,u_sigma:this._params.sigma},t=new bp({uniforms:e,blending:Bc.ADD,vertexShader:"\t\t\t#include <common_vert>\n\t\t\tattribute float strength;\n\t\t\tvarying float vStrength;\n\t\t\tuniform float radius;\n\t\t\tuniform float u_maxClick;\n\t\t\tuniform float u_minClick;\t\n\t\t\tvoid main(){\n\t\t\t\tgl_PointSize = radius *2. ;\n\t\t\t\tvStrength = strength;\t\t\n\t\t\t\tvec4 transformed = vec4(a_Position, 1.0);\n\t\t\t\tgl_Position = u_Projection * u_View * u_Model * transformed;\n\t\t\t}\t\t\t",fragmentShader:"\t\t\tprecision highp float;\n\t\t\tvarying float vStrength;\n\t\t\tuniform float radius;\n\t\t\tuniform float u_maxClick;\n\t\t\tuniform float u_minClick;\n\t\t\tuniform float u_sigma;\n\t\t\tvoid main(){\n\t\t\t\tfloat dx = gl_PointCoord.x -0.5;\n\t\t\t\tfloat dy = 1.-gl_PointCoord.y -0.5;\n\t\t\t\tfloat SigmaSquare = u_sigma *u_sigma;//\n\t\t\t\t// SigmaSquare =0.025;\n\t\t\t\tfloat pxAlpha=0.0;\n\t\t\t\tif(u_maxClick>= vStrength && vStrength> u_minClick){\n\t\t\t\t\tpxAlpha = (vStrength-u_minClick)/(u_maxClick-u_minClick);\n\t\t\t\t}\n\t\t\t\tif(vStrength>= u_maxClick){\n\t\t\t\t\tpxAlpha = 1.0;\n\t\t\t\t}\n\t\t\t\tif(vStrength <0.1){\n\t\t\t\t\tpxAlpha = 0.1;\n\t\t\t\t}\n\t\t\t\t// float R = (dx*dx + dy*dy );  R<radius *radius? -6.* pow(R,5.)+15.*pow(R,4.)-10.*pow(R,3.):0.;//  \n\t\t\t\tfloat gaussianKernel = exp(-(dx*dx + dy*dy )/(2.*SigmaSquare ));\n\t\t\t\tgl_FragColor = vec4(0., 0.,0., pxAlpha* gaussianKernel );//\n\t\t\t}\t\t\t"});return t.transparent=!0,t.drawMode=Kc.POINTS,t.depthTest=!0,t.depthWrite=!1,t}},{key:"_createHeatMaterial",value:function(e){var t={transparentCheck:this._params.alpha,grayTexture:e,colormap:this._colorRamp},r=new wF;for(var n in t)r.uniforms[n]=t[n];return r}},{key:"_getGradientCode",value:function(e){var t="grad:(";for(var r in e)t+=r+":"+e[r]+",";return t+=")"}},{key:"_gradient",value:function(e){if(this._getGradientCode(this._originalGrad)===this._getGradientCode(e)&&null!=this._gradTexture)return this._gradTexture;var t=this._gradCtx.createLinearGradient(0,0,256,0);for(var r in e)t.addColorStop(+r,e[r]);this._gradCtx.fillStyle=t,this._gradCtx.fillRect(0,0,256,1);var n=new Bp;return n.image=this._gradCtx.canvas,n.version++,this._gradTexture=n,n}},{key:"_createCanvas",value:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}},{key:"addData",value:function(e){this._params.data.push(e),this._draw()}},{key:"setData",value:function(e){this._params.data=e,this._draw()}},{key:"setAlpha",value:function(e){this._params.alpha=e,this._draw()}},{key:"transparent",get:function(){return this._params.alpha},set:function(e){this._params.alpha=e,"mosaic"!==this._params.type?this._mesh.material&&this._mesh.material.uniforms&&(this._mesh.material.uniforms.transparentCheck=e):this._draw()}},{key:"radius",get:function(){return this._params.radius},set:function(e){this._params.radius=e,this.scene1.children.length>0&&(this.scene1.children[0].material.uniforms.radius=e),this._draw()}},{key:"gradient",get:function(){return this._params.gradient},set:function(e){this._params.gradient=e,this._colorRamp=this._gradient(e),this._originalGrad=e,this._draw()}},{key:"extrudeHeight",get:function(){return this._params.extrudeHeight},set:function(e){this._params.extrudeHeight=e,"3Dheatmap"===this.type&&(this._mesh.material.uniforms.extrudeHeight=e)}},{key:"mosaicSize",get:function(){return this._params.mosaicSize},set:function(e){this._params.mosaicSize=e,this._mesh.material.uniforms.mosaicSize=[this._params.mosaicSize,this._params.mosaicSize]}},{key:"type",get:function(){return this._params.type},set:function(e){this._params.type!==e&&(this._params.type=e,this._setMaterial(this._params),this._mesh.material.needsUpdate=!1)}},{key:"minValue",get:function(){return this._params.minValue},set:function(e){this._params.minValue=e}},{key:"maxValue",get:function(){return this._params.maxValue},set:function(e){this._params.maxValue=e}},{key:"areaWidth",get:function(){return this._params.areaWidth},set:function(e){this._params.areaWidth=e,this.renderTarget1.resize(this._params.areaWidth,this._params.areaHeight),this.renderTarget2.resize(this._params.areaWidth,this._params.areaHeight),this.camera.setOrtho(this._params.areaWidth/-2,this._params.areaWidth/2,this._params.areaHeight/-2,this._params.areaHeight/2,.01,1e3),this.camera2.setOrtho(this._params.areaWidth/-2,this._params.areaWidth/2,this._params.areaHeight/-2,this._params.areaHeight/2,.01,1e3)}},{key:"areaHeight",get:function(){return this._params.areaHeight},set:function(e){this._params.areaHeight=e,this.renderTarget1.resize(this._params.areaWidth,this._params.areaHeight),this.renderTarget2.resize(this._params.areaWidth,this._params.areaHeight),this.camera.setOrtho(this._params.areaWidth/-2,this._params.areaWidth/2,this._params.areaHeight/-2,this._params.areaHeight/2,.01,1e3),this.camera2.setOrtho(this._params.areaWidth/-2,this._params.areaWidth/2,this._params.areaHeight/-2,this._params.areaHeight/2,.01,1e3)}},{key:"data",get:function(){return this._params.data},set:function(e){this._params.data=e}},{key:"_update",value:function(){var e=this._renderer;e.renderPass.setRenderTarget(this.renderTarget1),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!0),e.renderScene(this.scene1,this.camera),this.scene2.children[0]&&this.scene2.children[0].isMesh&&(this.scene2.children[0].material.uniforms.grayTexture=this.renderTarget1.texture),e.renderPass.setRenderTarget(this.renderTarget2),e.renderPass.setClearColor(0,0,0,0),e.renderPass.clear(!0,!0,!0),e.renderScene(this.scene2,this.camera2)}},{key:"getGrayTexture",value:function(){return this.renderTarget1.texture}},{key:"getTexture",value:function(){return this.renderTarget2.texture}},{key:"refresh",value:function(){this._draw()}},{key:"updateSubBuffer",value:function(e,t){switch(e){case"position":this._geometry.attributes.a_Position.buffer.array=t,this._geometry.attributes.a_Position.buffer.version++;break;case"normal":this._geometry.attributes.a_Normal.buffer.array=t,this._geometry.attributes.a_Normal.buffer.version++;break;case"uv":this._geometry.attributes.a_Uv.buffer.array=t,this._geometry.attributes.a_Uv.buffer.version++,this._geometry.attributes.a_Uv2.buffer.array=t,this._geometry.attributes.a_Uv2.buffer.version++;break;case"index":this._geometry.index.buffer.array=t,this._geometry.index.buffer.version++}}},{key:"_updatePointGeo",value:function(e){for(var t=e,r=[],n=[],i=0;i<t.length;i++)r.push(t[i][0]),r.push(t[i][1]),r.push(0),n.push(t[i][2]);this._pointGeometry.attributes.a_Position.buffer=new cp(new Float32Array(r),3),this._pointGeometry.attributes.strength.buffer=new cp(new Float32Array(n),1),this._pointGeometry.attributes.a_Position.buffer.version++,this._pointGeometry.attributes.strength.buffer.version++,this._pointGeometry.version++}},{key:"dispose",value:function(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this._colorRamp.dispose(),this.scene1.children[0].material.dispose(),this.scene1.children[0].geometry.dispose(),this.scene2.children[0]&&(this.scene2.children[0].material.dispose(),this.scene2.children[0].geometry.dispose()),OP(IP(r.prototype),"dispose",this).call(this)}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this}}]),r}(QE);function DF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var MF=new bp({defines:{},vertexShader:"    #include <common_vert>\n    precision mediump float;\n    attribute vec2 a_Uv;\n    varying vec2 v_Uv;\n    \n    void main() {\n        v_Uv = a_Uv;\n        vec4 position =vec4( a_Position.xyz, 1);\n        gl_Position = u_ProjectionView * u_Model * position;\n    }\n    ",fragmentShader:"    #include <common_frag>\n    precision mediump float;\n\tuniform float idw_distanceThreshold;\n\tuniform float idw_exponent;\n\tuniform float idw_linearFadeFactor;\n\tuniform float idw_minValue;\n\tuniform float idw_maxValue;\n\tuniform vec2 dataResolution;\n\tuniform vec2 originPoint;\n\tuniform float pointTextureSize;\n\tuniform sampler2D pointTexture;\n\tuniform sampler2D colorRampTexture;\n\tuniform int pointsNum;\n\tuniform bool isolineCheck;\n\tuniform float contourSpacingValue;\n\tuniform float lineThickness;\n\tuniform bool auxiliaryLine;\n\tvarying vec2 v_Uv;\n\n\tfloat isoline(float val, float lg, float ref, float pas, float thickness) {\n\t\t// thickness the thickness of the line;\n\t\t// pas   the Contour spacing value\n\t\t// ref   offset value,set to 0; \n\t\tfloat v = abs(mod(val - ref + pas * .5, pas) - pas * .5) / lg - .1 * thickness;\n\t\treturn smoothstep(.2, .8, v);\n\t}\n\tstruct Accumulator\n\t{\n\t\tfloat m_sumOfWeightedValues;\n\t\tfloat m_sumOfWeights;\n\t};\n\tfloat GetWeightedAverage(Accumulator acc)\n\t{\n\t\treturn acc.m_sumOfWeightedValues / acc.m_sumOfWeights;\n\t}\n\t\t\n\tvoid main() {\n\t\tfloat exactThreshold = 0.01; // if we are very close to a point then avoid a divide by zero and set to exact weight of the point\n\n\t\tAccumulator acc = Accumulator(0.0f,0.0f);\n\n\t\tvec2 st = (2.*v_Uv-1.)*0.5;\n\t\tvec2 fragCoord = st * dataResolution.xy;\n\t\tfloat interpolatedValue = 0.;\n\t\t\n\t\tfor (int i = 0; i < pointsNum; ++i) \n\t\t{\n\t\t\tfloat i_float = float(i);\n\t\t\tfloat j = i_float * 1.0;\n\t\t\tfloat x = mod( j, float( pointTextureSize ) );\n\t\t\tfloat y = floor( j / float( pointTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( pointTextureSize );\n\t\t\tfloat dy = 1.0 / float( pointTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 pointSampler = texture2D( pointTexture, vec2( dx * ( x + 0.5 ), y ) );\n\n\t\t\tfloat dist = max(exactThreshold, length(fragCoord.xy  - pointSampler.xz));  \n\t\t\tif (dist < idw_distanceThreshold) \n\t\t\t{\n\n\t\t\t\tfloat weight = 1.0f / pow(dist, idw_exponent);\n\t\t\t\tweight *= (1.0f - idw_linearFadeFactor * (dist / idw_distanceThreshold));\n\n\t\t\t\tacc.m_sumOfWeights += weight;\n\t\t\t\tacc.m_sumOfWeightedValues += weight * pointSampler.w;\n\t\t\t}\n\t\t}\n\n\t\tinterpolatedValue = GetWeightedAverage(acc);\n\t\t// interpolatedValue = (interpolatedValue- idw_minValue) /(idw_maxValue -idw_minValue+0.0000001);\n\t\t// interpolatedValue = clamp(interpolatedValue, 0.0, 1.0);\n\n\t\tfloat lg = 2.*length(vec2(dFdx(interpolatedValue), dFdy(interpolatedValue)));\n\t\tfloat k1 = isoline(interpolatedValue, lg, .0, contourSpacingValue, lineThickness);\n\t\tfloat k2 = isoline(interpolatedValue, lg, .0, contourSpacingValue*0.1, .1*lineThickness);\n\t\t\n\t\t//normailize the interpolatedValue\n\t\tinterpolatedValue = (interpolatedValue- idw_minValue) /(idw_maxValue -idw_minValue+0.0000001);\n\t\t// color map the value\n\t\tvec3 col = texture2D( colorRampTexture, vec2( interpolatedValue, 0.5)).rgb;\n\t\t\n\t\t// apply isoline to color\n\t\tif(isolineCheck && lg>0.005){\n\t\t\tcol *= (.3+(k1*.7));\n\t\t\tif( auxiliaryLine ){ col *= (.7+(k2*.3)); }\n\t\t}\n\t\tgl_FragColor = vec4(col, u_Opacity);\n\t}\n\t\n\t",uniforms:{idw_exponent:2,idw_distanceThreshold:1,idw_linearFadeFactor:0,idw_minValue:1,idw_maxValue:10,pointTexture:null,colorRampTexture:null,pointTextureSize:1,pointsNum:1,isolineCheck:!1,dataResolution:[1,1],originPoint:[0,0],contourSpacingValue:10,lineThickness:1,auxiliaryLine:!0}}),PF=function(e){LP(r,e);var t=DF(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),(e=t.call(this,n.external.uScene))._mesh=null,e._exponent=THING.Utils.parseValue(n.external.param.exponent,2),e._radius=THING.Utils.parseValue(n.external.param.radius,100),e._minValue=THING.Utils.parseValue(n.external.param.minValue,0),e._maxValue=THING.Utils.parseValue(n.external.param.maxValue,1),e._width=THING.Utils.parseValue(n.external.param.width,10),e._height=THING.Utils.parseValue(n.external.param.height,10),e._isolineCheck=THING.Utils.parseValue(n.external.param.isoline,!1),e._auxiliaryLine=THING.Utils.parseValue(n.external.param.auxiliaryLine,!0),e._range=THING.Utils.parseValue(n.external.param.range,null),e._originPoint=THING.Utils.parseValue(n.external.param.originPoint,null);var i=THING.Utils.parseValue(n.external.param.data,[]);e._grad=THING.Utils.parseValue(n.external.param.gradient,{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"});var a=e._createCanvas();a.width=256,a.height=1,e._gradCtx=a.getContext("2d"),e._originalGrad=e._grad,e._gradTexture=e._gradient(e._grad),MF.uniforms.colorRampTexture=e._gradTexture,MF.uniforms.idw_exponent=e._exponent,MF.uniforms.idw_minValue=e._minValue,MF.uniforms.idw_maxValue=e._maxValue,MF.uniforms.idw_distanceThreshold=e._radius,MF.uniforms.isolineCheck=e._isolineCheck,MF.uniforms.auxiliaryLine=e._auxiliaryLine,e.rttscene=new Nd,e.rttcamera=new Bd,e.rttcamera.position.set(0,1,0),e.rttcamera.lookAt(new bc(0,0,0),new bc(0,0,-1)),e.rttcamera.setOrtho(-1,1,-1,1,.01,1e3),e.rttscene.add(e.rttcamera);var s=new vp(2,2);if(e._rttplane=new ap(s,MF),e.rttscene.add(e._rttplane),e.renderer=n.external.param.renderer,e.backRenderTarget=e.renderer.backRenderTarget,e.resize(),i.length>0){var o=new Bp;o.type=jc.FLOAT,o.magFilter=Vc.NEAREST,o.minFilter=Vc.NEAREST,o.generateMipmaps=!1,o.internalformat=zc.RGBA32F,o.format=zc.RGBA,o.flipY=!1,e._pointTexture=o,e.setData(i)}return e.drawTexture(),e._createNode(n.external.param),e}return BP(r,[{key:"exponent",get:function(){return this._exponent},set:function(e){this._exponent=e,MF.uniforms.idw_exponent=this._exponent,this.drawTexture()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius=e,MF.uniforms.idw_distanceThreshold=this._radius,this.drawTexture()}},{key:"isolineCheck",get:function(){return this._isolineCheck},set:function(e){this._isolineCheck=e,MF.uniforms.isolineCheck=this._isolineCheck,this.drawTexture()}},{key:"auxiliaryLine",get:function(){return this._auxiliaryLine},set:function(e){this._auxiliaryLine=e,MF.uniforms.auxiliaryLine=this._auxiliaryLine,this.drawTexture()}},{key:"minValue",get:function(){return this._minValue},set:function(e){this._minValue=e,MF.uniforms.idw_minValue=this._minValue,this.drawTexture()}},{key:"maxValue",get:function(){return this._maxValue},set:function(e){this._maxValue=e,MF.uniforms.idw_maxValue=this._maxValue,this.drawTexture()}},{key:"gradient",get:function(){return this._grad},set:function(e){this._originalGrad=this._grad,MF.uniforms.colorRampTexture=null,"object"===FP(e)&&null!==e&&Object.keys(e).length>0&&(this._gradTexture=this._gradient(e),MF.uniforms.colorRampTexture=this._gradTexture),this._grad=e,this.drawTexture()}},{key:"_createNode",value:function(e){var t;if(void 0!==e.geometry){var r=e.geometry,n=new _p;r.index&&(n.index=new up(new cp(r.index,1)));var i=new cp(new Float32Array(r.position),3);i.usage=Jc.DYNAMIC_DRAW,n.addAttribute("a_Position",new up(i,3));var a=new cp(new Float32Array(r.uv),2);a.usage=Jc.DYNAMIC_DRAW,n.addAttribute("a_Uv",new up(a,2));var s=new cp(new Float32Array(r.uv),2);if(s.usage=Jc.DYNAMIC_DRAW,n.addAttribute("a_Uv2",new up(s,2)),r.normal){var o=new cp(new Float32Array(r.normal),3);o.usage=Jc.DYNAMIC_DRAW,n.addAttribute("a_Normal",new up(o,3))}t=n}else if(e.vertexData){var l=e.vertexData;t=new _p,l.index&&t.setIndex(new up(new cp(new Float16Array(l.index),1))),t.addAttribute("a_Position",new up(new cp(new Float32Array(l.position),3))),l.normals&&t.addAttribute("a_Normal",new up(new cp(new Float32Array(l.normals),3))),t.addAttribute("a_Uv",new up(new cp(new Float32Array(l.uv),2)))}else if(e.mask||e.clipShape){var u=e.mask||e.clipShape,c=u.points||u.shape,h=gF({contour:c,holes:u.holes});t=new _p;for(var d=h.uvs,p=0;p<d.length/2;p++){var f=h.positions[3*p+0],m=h.positions[3*p+2];d[2*p+0]=(f+this._width/2)/this._width,d[2*p+1]=1-(m+this._height/2)/this._height}t.addAttribute("a_Position",new up(new cp(new Float32Array(h.positions),3))),t.addAttribute("a_Normal",new up(new cp(new Float32Array(h.normals),3))),t.addAttribute("a_Uv",new up(new cp(new Float32Array(d),2))),t.setIndex(new up(new cp(h.positions.length/3>65536?new Uint32Array(h.indices):new Uint16Array(h.indices),1)))}else{t=new vp(this._width,this._height);for(var g=(e.extent.maxX+e.extent.minX)/2,_=(e.extent.maxY+e.extent.minY)/2,v=0;v<t.attributes.a_Position.buffer.count;v++)t.attributes.a_Position.buffer.array[3*v]+=g,t.attributes.a_Position.buffer.array[3*v+2]+=_,t.attributes.a_Uv.buffer.array[2*v]=(t.attributes.a_Position.buffer.array[3*v]+this._width/2)/this._width,t.attributes.a_Uv.buffer.array[2*v+1]=1-(t.attributes.a_Position.buffer.array[3*v+2]+this._height/2)/this._height}t.computeBoundingBox(),t.computeBoundingSphere();var y=new T_;y.side=Lc.DOUBLE,y.transparent=!0,y.diffuseMap=this.renderTarget.texture,this._mesh||(this._mesh=new ap(t,y),this._node.add(this._mesh),this.$markChildrenMatrixAutoUpdate(!1))}},{key:"drawTexture",value:function(){this.rttscene.add(this.rttcamera),this.rttscene.updateMatrix(),this.rttscene.updateRenderStates(this.rttcamera),this.rttscene.updateRenderQueue(this.rttcamera),this.renderer.renderPass.setRenderTarget(this.renderTarget),this.renderer.renderPass.setClearColor(0,0,0,0),this.renderer.renderPass.clear(!0,!0,!0),this.renderer.renderScene(this.rttscene,this.rttcamera)}},{key:"draw",value:function(){}},{key:"setData",value:function(e){var t=Math.sqrt(e.length);t=this._nextPowerOfTwo(Math.ceil(t)),t=Math.max(4,t);for(var r=new Float32Array(t*t*4),n=[],i=[],a=[],s=0;s<e.length;s++)n.push(e[s][0]),i.push(e[s][1]),a.push(e[s][2]);var o=[Math.min.apply(Math,n),Math.min.apply(Math,i)],l=this._range?this._range[0]:Math.max.apply(Math,n)-o[0],u=this._range?this._range[1]:Math.max.apply(Math,i)-o[1];this._originPoint=this._originPoint?this._originPoint:[.5*(Math.max.apply(Math,n)+o[0]),.5*(Math.max.apply(Math,i)+o[1])];for(var c=0;c<e.length;c++)r[4*c]=e[c][0],r[4*c+1]=0,r[4*c+2]=e[c][1],r[4*c+3]=e[c][2];this._pointTexture.image={data:r,width:t,height:t},this._pointTexture.version++,this._rttplane.material.uniforms.pointTextureSize=t,this._rttplane.material.uniforms.pointsNum=e.length,this._rttplane.material.uniforms.pointTexture=this._pointTexture,this._rttplane.material.uniforms.dataResolution=[l,u],this._rttplane.material.uniforms.originPoint=this._originPoint}},{key:"updateData",value:function(e){this.setData(e),this.drawTexture()}},{key:"setIsoline",value:function(e,t){MF.uniforms.contourSpacingValue=e,MF.uniforms.lineThickness=t,this.drawTexture()}},{key:"resize",value:function(){var e,t,r=this.renderer.renderPass.capabilities;r.version>1?r.getExtension("EXT_color_buffer_float")&&r.getExtension("OES_texture_float_linear")?(e=jc.FLOAT,t=zc.RGBA32F):(e=jc.HALF_FLOAT,t=zc.RGBA16F):r.getExtension("OES_texture_float")&&r.getExtension("OES_texture_float_linear")?(e=jc.FLOAT,t=zc.RGBA32F):r.getExtension("OES_texture_half_float")&&r.getExtension("OES_texture_half_float_linear")?(e=jc.HALF_FLOAT,t=zc.RGBA16F):(e=jc.UNSIGNED_BYTE,t=null,console.warn("Half float texture is not supported!")),this.renderTarget=new Em(1024,1024),this.renderTarget.texture.magFilter=Vc.LINEAR,this.renderTarget.texture.minFilter=Vc.LINEAR,this.renderTarget.texture.type=e,this.renderTarget.texture.format=zc.RGBA,this.renderTarget.texture.internalformat=t,this.renderTarget.texture.generateMipmaps=!1}},{key:"dispose",value:function(){this.renderTarget.dispose(),this._gradTexture.dispose(),this._pointTexture.dispose(),this._rttplane.material.dispose(),this._rttplane.geometry.dispose(),this._grad=null,this._originalGrad=null,this._gradCtx=null,this._mesh&&(this._mesh.material.dispose(),this._mesh.geometry.dispose()),OP(IP(r.prototype),"dispose",this).call(this)}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this}},{key:"_getGradientCode",value:function(e){var t="grad:(";for(var r in e)t+=r+":"+e[r]+",";return t+=")"}},{key:"_gradient",value:function(e){if(this._getGradientCode(this._originalGrad)===this._getGradientCode(e)&&null!=this._gradTexture)return this._gradTexture;var t=this._gradCtx.createLinearGradient(0,0,256,0);for(var r in e)t.addColorStop(+r,e[r]);this._gradCtx.fillStyle=t,this._gradCtx.fillRect(0,0,256,1);var n=new Bp;return n.image=this._gradCtx.canvas,n.version++,this._gradTexture=n,n}},{key:"_createCanvas",value:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}},{key:"_nextPowerOfTwo",value:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}}]),r}(QE);function FF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var RF=function(e){LP(r,e);var t=FF(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),(e=t.call(this,n)).modifyShader(),e.shaderName="UFixLightNodeMaterialShader",e}return BP(r,[{key:"modifyShader",value:function(){this.uniforms.earthDirection=[1,0,0],this.uniforms.ratio=1;this.fragmentShader=this.fragmentShader.replace("#include <clippingPlanes_pars_frag>","\n            #include <clippingPlanes_pars_frag>\n            ".concat("\n            uniform vec3 earthDirection;\n            uniform float ratio;\n\n            varying vec3 v_CustomNormal;\n        ","\n        "));this.fragmentShader=this.fragmentShader.replace("#include <end_frag>","\n            #include <end_frag>\n            ".concat("\n            float intensity = dot(normalize(earthDirection), v_CustomNormal);\n            \n            vec4 finalColor = vec4(1.0, 1.0, 1.0, 1.0);\n            #ifdef USE_DIFFUSE_MAP\n                finalColor = texture2D(diffuseMap, vec2((intensity + 1.0) / 2.0,0.1));\n            #endif\n        \n            float colorR = finalColor.r + (1.0 - finalColor.r) * (1.0 - ratio);\n            float colorG = finalColor.g + (1.0 - finalColor.g) * (1.0 - ratio);\n            float colorB = finalColor.b + (1.0 - finalColor.b) * (1.0 - ratio);\n        \n            gl_FragColor = vec4(colorR, colorG, colorB, finalColor.a * u_Opacity);\n        ","\n        "));this.vertexShader=this.vertexShader.replace("#include <logdepthbuf_pars_vert>","\n            #include <logdepthbuf_pars_vert>\n            ".concat("\n            varying vec3 v_CustomNormal;\n        ","\n        ")),this.vertexShader=this.vertexShader.replace("#include <normal_vert>","\n            #include <normal_vert>\n            ".concat("\n            mat4 normalMatrix = inverse(u_View * u_Model);\n            normalMatrix = transpose(normalMatrix);\n            vec4 nor = normalMatrix * vec4(a_Normal, 1.0);\n            v_CustomNormal = normalize( nor.rgb );\n        ","\n        "))}}]),r}(E_);function NF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var BF=function(e){LP(r,e);var t=NF(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),(e=t.call(this,n.uScene))._direction=void 0===n.param.gradientMapDirection?[1,0,0]:n.param.gradientMapDirection,e._ratio=void 0===n.param.ratio?1:n.param.ratio;var i=void 0===n.param.radius?6378e3:n.param.radius,a=new dm(1*i,160,160),s=new RF;s.acceptLight=!1,s.transparent=!0,s.blending=Bc.CUSTOM,s.blendSrc=Oc.ZERO,s.blendDst=Oc.SRC_COLOR,s.blendSrcAlpha=Oc.ZERO,s.blendDstAlpha=Oc.SRC_ALPHA,s.fog=!1;var o=e._mesh=new ap(a,s);o.renderOrder=-500,o.castShadow=!1,o.receiveShadow=!1,a.computeBoundingBox(),a.computeBoundingSphere(),o.raycast=function(){},e._node.add(o);var l=UP(e);return e._mesh.addBeforeRenderFunction((function(e,t){l._mesh.material.uniforms.ratio=l._ratio,l._mesh.material.uniforms.earthDirection=l._direction}),"Interpolant-uniforms-binding"),e}return BP(r,[{key:"ratio",get:function(){return this._ratio},set:function(e){this._ratio=e}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=e}},{key:"dispose",value:function(){OP(IP(r.prototype),"dispose",this).call(this)}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this}}]),r}(QE);function IF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var OF=function(e){LP(r,e);var t=IF(r);function r(){var e;return PP(this,r),(e=t.apply(this,arguments)).modifyShader(),e.shaderName="UCanvasNodeMaterialShader",e}return BP(r,[{key:"modifyShader",value:function(){this.defines.USE_MOSAIC=!1,this.uniforms.texSize=[640,640],this.uniforms.mosaicSize=[0,0];this.fragmentShader=this.fragmentShader.replace(rg.colormapping_pars_frag,"\n            ".concat(rg.colormapping_pars_frag,"\n            ").concat("\n            uniform vec2 colorRange;\n            #ifdef USE_MOSAIC\n                uniform vec2 texSize;\n                uniform vec2 mosaicSize;\n            #endif\n        ","\n        "));this.fragmentShader=this.fragmentShader.replace(rg.colormapping_frag,"\n            ".concat("\n            // if (outColor.a < 0.0001) discard;\n\n            // mosaic\n            #ifdef USE_MOSAIC\n                vec2 xy = vec2(v_Uv.x * texSize.x, v_Uv.y * texSize.y);\n                vec2 xyMosaic = vec2(floor(xy.x / mosaicSize.x) * mosaicSize.x,\n                                        floor(xy.y / mosaicSize.y) * mosaicSize.y )+ .5*mosaicSize;\n                vec2 delXY = xyMosaic - xy;\n                float delL = length(delXY);\n                vec2 uvMosaic = vec2(xyMosaic.x / texSize.x, xyMosaic.y / texSize.y);\n                vec4 centerColor = texture2D(diffuseMap, uvMosaic);\n                float percent = smoothstep(0., 1., 1. - delL * 2.4 / mosaicSize.x) * 0.7 + 0.3;\n            #endif\n        ","\n        ")),this.fragmentShader=this.fragmentShader.replace("#include <end_frag>","\n            #include <end_frag>\n            ".concat("\n            #ifdef USE_MOSAIC\n                gl_FragColor = vec4(mix(outColor.rgb, centerColor.rgb, percent), centerColor.a * percent * outColor.a);\n                #ifdef USE_VCOLOR_RGB\n                    gl_FragColor = vec4(gl_FragColor.r * v_Color.r, gl_FragColor.g * v_Color.g, gl_FragColor.b * v_Color.b, gl_FragColor.a);\n                #endif\n                #ifdef USE_VCOLOR_RGBA\n                    gl_FragColor = vec4(gl_FragColor.r * v_Color.r, gl_FragColor.g * v_Color.g, gl_FragColor.b * v_Color.b, gl_FragColor.a);\n                #endif\n                \n            #else\n                gl_FragColor = outColor;\n            #endif\n        ","\n        "))}}]),r}(E_);function kF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var LF=function(e){LP(r,e);var t=kF(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),(e=t.call(this,n.uScene))._mosaic=void 0===n.param.symbol.mosaic||n.param.symbol.mosaic,e._mosaicSize=void 0===n.param.symbol.mosaicSize?[0,0]:n.param.symbol.mosaicSize;var i=n.param.vertexData.top,a=new _p;i.index&&a.setIndex(new up(new cp(new Float16Array(i.index),1))),a.addAttribute("a_Position",new up(new cp(new Float32Array(i.position),3))),a.addAttribute("a_Uv",new up(new cp(new Float32Array(i.uv),2))),a.addAttribute("a_Uv2",new up(new cp(new Float32Array(i.uv),2))),a.addAttribute("a_Normal",new up(new cp(new Float32Array(i.normal),3))),a.computeBoundingSphere(),a.computeBoundingBox();var s=new OF;s.transparent=!0,e._mesh=new ap(a,s),e._node.add(e._mesh),e.$markChildrenMatrixAutoUpdate(!1);var o=UP(e);return e._mesh.addBeforeRenderFunction((function(e,t){o._mesh.material.uniforms.mosaicSize=o._mosaicSize,o._mesh.material.defines.USE_MOSAIC!=o._mosaic&&(o._mesh.material.defines.USE_MOSAIC=o._mosaic,o._mesh.material.needsUpdate=!0)}),"mosaic-uniforms-binding"),e}return BP(r,[{key:"mosaic",get:function(){return this._mosaic},set:function(e){this._mosaic=e}},{key:"mosaicSize",get:function(){return this._mosaicSize},set:function(e){this._mosaicSize=e}},{key:"dispose",value:function(){OP(IP(r.prototype),"dispose",this).call(this)}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this}}]),r}(QE);function UF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var zF=new Map,jF=function(e){LP(r,e);var t=UF(r);function r(){var e,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(PP(this,r),(e=t.call(this,i.external.uScene))._disposeArray=void 0===i.external.disposeArray||i.external.disposeArray,i.materialResource)n=i.materialResource.$getMaterial();else if(!(n=zF.get("_defaultWaterMaterial_"))){var a=new TT;zF.set("_defaultWaterMaterial_",a),n=zF.get("_defaultWaterMaterial_")}var s=new _p,o=new cp(i.external.vertexData.position,3);if(o.usage=Jc.DYNAMIC_DRAW,s.addAttribute("a_Position",new up(o,3)),i.external.vertexData.normal){var l=new cp(i.external.vertexData.normal,3);l.usage=Jc.DYNAMIC_DRAW,s.addAttribute("a_Normal",new up(l,3))}else Gb.computeNormals(s);var u=new cp(i.external.vertexData.uv,2);u.usage=Jc.DYNAMIC_DRAW,s.addAttribute("a_Uv",new up(u,2)),i.external.vertexData.index&&s.setIndex(new up(new cp(i.external.vertexData.position.length/3>65536?new Uint32Array(i.external.vertexData.index):new Uint16Array(i.external.vertexData.index),1))),i.external.vertexData.index=null,i.external.vertexData.position=null,i.external.vertexData.normal=null,i.external.vertexData.uv=null;var c=new ap(s,n);s.computeBoundingBox(),s.computeBoundingSphere(),e._size=[i.external.size[0],i.external.size[1]],c.material.uniforms.size=e._size,c.castShadow=!1,c.receiveShadow=!1,e._node.add(c);var h=UP(e),d=c.addBeforeRenderFunction((function(e,t){t.uniforms.offset=[-1*h._flowOffset[0],-1*h._flowOffset[1]],t.uniforms.waveStrength=h._flowWeight,t.uniforms.distortionScale=h._reflectDistortion,t.uniforms.reflectWeight=h._reflectWeight,t.uniforms.time=h._noiseTime,t.uniforms.size=h._size}),"water-uniforms-binding");return e.$markChildrenMatrixAutoUpdate(!1),e._mesh=c,e._binding=d,e._flowOffset=[.3,.3],e._flowWeight=.5,e._reflectDistortion=2,e._reflectWeight=1,e._noiseTime=0,e._noiseTimeScale=1,e}return BP(r,[{key:"getType",value:function(){return"Water"}},{key:"setNormalMap",value:function(e){(new yh).load(e,(function(e){this._mesh.material.normalMap=new Bp,this._mesh.material.normalMap.image=e,this._mesh.material.normalMap.wrapS=this._mesh.material.normalMap.wrapT=Gc.REPEAT,this._mesh.material.normalMap.version++}))}},{key:"setFlowOffset",value:function(e){this._flowOffset=e.slice()}},{key:"getFlowOffset",value:function(e){return e||(e=[]),e[0]=this._flowOffset[0],e[1]=this._flowOffset[1],e}},{key:"setSize",value:function(e){this._size=e.slice()}},{key:"getSize",value:function(e){return e||(e=[]),e[0]=this._size[0],e[1]=this._size[1],e}},{key:"setFlowWeight",value:function(e){this._flowWeight=e}},{key:"getFlowWeight",value:function(){return this._flowWeight}},{key:"setReflectDistortion",value:function(e){this._reflectDistortion=e}},{key:"getReflectDistortion",value:function(){return this._reflectDistortion}},{key:"setReflectWeight",value:function(e){this._reflectWeight=e}},{key:"getReflectWeight",value:function(){return this._reflectWeight}},{key:"setNoiseTimeScale",value:function(e){this._noiseTimeScale=e}},{key:"getNoiseTimeScale",value:function(){return this._noiseTimeScale}},{key:"update",value:function(e){this._noiseTime+=e*this._noiseTimeScale*.108}},{key:"dispose",value:function(){OP(IP(r.prototype),"dispose",this).call(this),this._mesh.removeBeforeRenderFunction(this._binding),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,this._binding=null}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e,!1),this._flowOffset=e._flowOffset.slice(),this._flowWeight=e._flowWeight,this._reflectDistortion=e._reflectDistortion,this._reflectWeight=e._reflectWeight,this._noiseTime=e._noiseTime,this._noiseTimeScale=e._noiseTimeScale,this._size=e._size,this}}]),r}(QE);function VF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var GF=function(e){LP(r,e);var t=VF(r);function r(){var e;return PP(this,r),(e=t.apply(this,arguments)).modifyShader(),e.useDefaultBufferMaterial=!1,e}return BP(r,[{key:"modifyShader",value:function(){this.shaderName="UExtrudeBuildingNodePBRMaterialShader",this.defines.USE_BATCHID=!1,this.defines.USE_DYNHEIGHT=!1,this.uniforms.mColor=[1,1,1,1],this.uniforms.strength=1,this.uniforms.roughness=.5;var e=this.vertexShader;e=(e=(e=(e=e.replace("#include <emissiveMap_pars_vert>","\n\t\t\t#ifdef USE_EMISSIVEMAP\n\n\t\t\t\tattribute vec2 a_Uv4;\n\t\t\t\tuniform mat3 emissiveMapUVTransform;\n\t\t\t\tvarying vec2 vEmissiveMapUV;\n\t\t\t\n\t\t\t#endif\n\t\t\t#ifdef USE_BATCHID\n\n\t\t\t\tattribute float show;\n\n\t\t\t#endif\n\t\t\t#ifdef USE_DYNHEIGHT\n\t\t\t\tattribute vec4 flagValue;\n\t\t\t\tattribute float extValue;\n\t\t\t#endif\n\n\t\t\t".concat(tg.gpu_picker_pars_vert,"\n\t\t"))).replace("#include <begin_vert>","\n\t\t\t#include <begin_vert>\n\t\t\t#ifdef USE_DYNHEIGHT\n\t\t\t\t// TODO: 关于offsetHeight抬高的解决办法:沿[0,1,0]方向减去offsetHeight(抵消translateY影响modelMatrix导致的抬高),\n\t\t\t\t// 再沿normalize(transformed - flagValue.xyz)方向加上offsetHeight。\n\t\t\t\tif (flagValue.w == 0.0) { // 顶面点\n\t\t\t\t\t// vec3 dir = vec3(0.0, 1.0, 0.0);\n\t\t\t\t\tvec3 dir = normalize(transformed - flagValue.xyz);\n\t\t\t\t\tvec3 temp = flagValue.xyz + dir * extValue;\n\t\t\t\t\ttransformed = temp;\n\t\t\t\t}\n\t\t\t#endif\n\t\t")).replace("#include <shadowMap_vert>","\n\t\t\t#include <shadowMap_vert>\n\n\t\t\t#ifdef USE_BATCHID\n\n\t\t\t\tgl_Position *= show;\n\n\t\t\t#endif\n\t\t\t".concat(tg.gpu_picker_id_vert,"\n\t\t"))).replace(ig.emissivemap_vert,"\n\t\t\t#ifdef USE_EMISSIVEMAP\n\n\t\t\t\tvEmissiveMapUV = (emissiveMapUVTransform * vec3(a_Uv4, 1.)).xy;\n\n\t\t\t#endif\n\t\t"),this.vertexShader=e;var t=this.fragmentShader;t=(t=t.replace("#include <emissiveMap_pars_frag>","\n\t\t\t#include <emissiveMap_pars_frag>\n\t\t\t".concat(tg.gpu_picker_pars_frag,"\n\t\t\t#ifdef USE_MARK_BUFFER\n\t\t\t\tuniform vec4 mColor;\n\t\t\t#endif\n\t\t\t#ifdef USE_COLOR_MARK_BUFFER\n\t\t\t\tuniform float strength;\n\t\t\t#endif\n\t\t"))).replace("#include <dithering_frag>","\n\t\t\t#include <dithering_frag>\n\t\t\t".concat(tg.gpu_picker_id_frag,"\n\t\t\t#ifdef USE_MARK_BUFFER\n\t\t\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\tvec4 texelColor = texture2D(diffuseMap, v_Uv);\n\n\t\t\t\t#ifdef USE_ALPHA_MAP\n\t\t\t\t\ttexelColor.a *= texture2D(alphaMap, vAlphaMapUV).g;\n\t\t\t\t#endif\n\n\t\t\t\tfloat alpha = texelColor.a * u_Opacity;\n\t\t\t\tif(alpha < ALPHATEST) discard;\n\t\t\t\t#endif\n\n\t\t\t\tgl_FragColor = mColor;\n\t\t\t#endif\n\t\t\t#ifdef USE_COLOR_MARK_BUFFER\n\t\t\t\t#ifdef ALPHATEST\n\t\t\t\t\tif(outColor.a < ALPHATEST) discard;\n\t\t\t\t#endif\n\n\t\t\t\toutColor.rgb *= strength;\n\n\t\t\t\tgl_FragColor = outColor;\n\t\t\t#endif\n\t\t\t#ifdef USE_GBUFFER\n\t\t\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\t\tvec4 texelColor_GBuffer = texture2D(diffuseMap, v_Uv);\n\t\t\t\t\tfloat alpha_GBuffer = texelColor_GBuffer.a * u_Opacity;\n\t\t\t\t\tif(alpha_GBuffer < ALPHATEST) discard;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 normal = normalize(v_Normal);\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t\t#endif \n\n\t\t\t\tfloat roughnessFactor_GBuffer = roughness;\n\t\t\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\t\t\troughnessFactor_GBuffer *= texture2D(roughnessMap, v_Uv).g;\n\t\t\t\t#endif\n\n\t\t\t\tvec4 packedNormalGlossiness;\n\t\t\t\tpackedNormalGlossiness.xyz = normal * 0.5 + 0.5;\n\t\t\t\tpackedNormalGlossiness.w = clamp(1. - roughnessFactor_GBuffer, 0., 1.);\n\t\t\t\t\n\t\t\t\tgl_FragColor = packedNormalGlossiness;\n\t\t\t#endif\n\t\t")),this.fragmentShader=t}}]),r}(E_);function WF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var HF=new GF,qF=function(){var e;return(e=HF).diffuse.setHex(16777215),e},XF=function(e){LP(r,e);var t=WF(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),e=t.call(this,n.uScene,n.geometryResource,n.materialResource),n.materialResource||(e._mesh.material=qF()),e}return BP(r)}(ZE);function QF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var KF=function(e){LP(r,e);var t=QF(r);function r(){var e;return PP(this,r),(e=t.apply(this,arguments)).modifyShader(),e.useDefaultBufferMaterial=!1,e}return BP(r,[{key:"modifyShader",value:function(){this.shaderName="UExtrudeBuildingTopNodePBRMaterialShader",this.defines.USE_BATCHID=!1,this.defines.USE_DYNHEIGHT=!1,this.uniforms.mColor=[1,1,1,1],this.uniforms.strength=1;var e=this.vertexShader;e=(e=(e=e.replace("#include <emissiveMap_pars_vert>","\n\t\t\t#ifdef USE_BATCHID\n\t\t\t\n\t\t\t\tattribute float show;\n\n\t\t\t#endif\n\t\t\t#ifdef USE_DYNHEIGHT\n\t\t\t\tattribute vec4 flagValue;\n\t\t\t\tattribute float extValue;\n\t\t\t#endif\n\n\t\t\t".concat(tg.gpu_picker_pars_vert,"\n\t\t"))).replace("#include <begin_vert>","\n\t\t\t#include <begin_vert>\n\t\t\t#ifdef USE_DYNHEIGHT\n\t\t\t\tif (flagValue.w == 0.0) { // 顶面点\n\t\t\t\t\t// vec3 dir = vec3(0.0, 1.0, 0.0);\n\t\t\t\t\tvec3 dir = normalize(transformed - flagValue.xyz);\n\t\t\t\t\tvec3 temp = flagValue.xyz + dir * extValue;\n\t\t\t\t\ttransformed = temp;\n\t\t\t\t}\n\t\t\t#endif\n\t\t")).replace("#include <shadowMap_vert>","\n\t\t\t#include <shadowMap_vert>\n\n\t\t\t#ifdef USE_BATCHID\n\n\t\t\t\tgl_Position *= show;\n\n\t\t\t#endif\n\n\t\t\t".concat(tg.gpu_picker_id_vert,"\n\t\t")),this.vertexShader=e;var t=this.fragmentShader;t=(t=t.replace("#include <emissiveMap_pars_frag>","\n\t\t\t#include <emissiveMap_pars_frag>\n\t\t\t".concat(tg.gpu_picker_pars_frag,"\n\t\t\t#ifdef USE_MARK_BUFFER\n\t\t\t\tuniform vec4 mColor;\n\t\t\t#endif\n\t\t\t#ifdef USE_COLOR_MARK_BUFFER\n\t\t\t\tuniform float strength;\n\t\t\t#endif\n\t\t"))).replace("#include <dithering_frag>","\n\t\t\t#include <dithering_frag>\n\t\t\t".concat(tg.gpu_picker_id_frag,"\n\t\t\t#ifdef USE_MARK_BUFFER\n\t\t\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\tvec4 texelColor = texture2D(diffuseMap, v_Uv);\n\n\t\t\t\t#ifdef USE_ALPHA_MAP\n\t\t\t\t\ttexelColor.a *= texture2D(alphaMap, vAlphaMapUV).g;\n\t\t\t\t#endif\n\n\t\t\t\tfloat alpha = texelColor.a * u_Opacity;\n\t\t\t\tif(alpha < ALPHATEST) discard;\n\t\t\t\t#endif\n\n\t\t\t\tgl_FragColor = mColor;\n\t\t\t#endif\n\t\t\t#ifdef USE_COLOR_MARK_BUFFER\n\t\t\t\t#ifdef ALPHATEST\n\t\t\t\t\tif(outColor.a < ALPHATEST) discard;\n\t\t\t\t#endif\n\n\t\t\t\toutColor.rgb *= strength;\n\n\t\t\t\tgl_FragColor = outColor;\n\t\t\t#endif\n\t\t\t#ifdef USE_GBUFFER\n\t\t\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\t\tvec4 texelColor_GBuffer = texture2D(diffuseMap, v_Uv);\n\t\t\t\t\tfloat alpha_GBuffer = texelColor_GBuffer.a * u_Opacity;\n\t\t\t\t\tif(alpha_GBuffer < ALPHATEST) discard;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 normal = normalize(v_Normal);\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t\t#endif \n\n\t\t\t\tfloat roughnessFactor_GBuffer = roughness;\n\t\t\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\t\t\troughnessFactor_GBuffer *= texture2D(roughnessMap, v_Uv).g;\n\t\t\t\t#endif\n\n\t\t\t\tvec4 packedNormalGlossiness;\n\t\t\t\tpackedNormalGlossiness.xyz = normal * 0.5 + 0.5;\n\t\t\t\tpackedNormalGlossiness.w = clamp(1. - roughnessFactor_GBuffer, 0., 1.);\n\t\t\t\t\n\t\t\t\tgl_FragColor = packedNormalGlossiness;\n\t\t\t#endif\n\t\t")),this.fragmentShader=t}}]),r}(E_);function YF(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var ZF=new KF,JF=function(){var e;return(e=ZF).diffuse.setHex(16777215),e},$F=function(e){LP(r,e);var t=YF(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),e=t.call(this,n.uScene,n.geometryResource,n.materialResource),n.materialResource||(e._mesh.material=JF()),e}return BP(r)}(ZE);function eR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var tR=function(e){LP(r,e);var t=eR(r);function r(){var e;return PP(this,r),(e=t.apply(this,arguments)).modifyShader(),e}return BP(r,[{key:"modifyShader",value:function(){this.shaderName="UBoundaryNodePBRMaterialShader",this.defines.USE_DIFFUSE_MAP2=!1,this.uniforms.diffuseMap2=null,this.uniforms.diffuseMap2Offset=[0,0],this.uniforms.diffuseMap2Repeat=[1,1];var e=this.vertexShader;e=(e=e.replace(ig.uv_pars_vert,"\n            #if defined(USE_UV1) || defined(USE_UV2)\n                uniform mat3 uvTransform;\n            #endif\n            \n            #ifdef USE_DIFFUSE_MAP2\n                attribute vec2 a_Uv;\n                varying vec2 diffuseMap2Uv;\n            #endif\n\n            #ifdef USE_UV1\n                #ifndef USE_DIFFUSE_MAP2\n                    attribute vec2 a_Uv;\n                #endif\n                varying vec2 v_Uv;\n            #endif\n            \n            #ifdef USE_UV2\n                attribute vec2 a_Uv2;\n                varying vec2 v_Uv2;\n            #endif\n            \n            #ifdef USE_UV3\n                attribute vec2 a_Uv3;\n            #endif\n        ")).replace("#include <uv_vert>","\n            #ifdef USE_UV1\n                v_Uv = (uvTransform * vec3(a_Uv, 1.)).xy;\n                #ifdef USE_DIFFUSE_MAP2\n                    diffuseMap2Uv = a_Uv;\n                #endif\n            #endif\n            \n            #ifdef USE_UV2\n                v_Uv2 = (uvTransform * vec3(a_Uv2, 1.)).xy;\n                #ifdef USE_DIFFUSE_MAP2\n                    diffuseMap2Uv = a_Uv2;\n                #endif\n            #endif\n        "),this.vertexShader=e;var t=this.fragmentShader;t=(t=t.replace("#include <diffuseMap_pars_frag>","\n            #include <diffuseMap_pars_frag>\n            #ifdef USE_DIFFUSE_MAP2\n                uniform sampler2D diffuseMap2;\n                uniform vec2 diffuseMap2Offset;\n                uniform vec2 diffuseMap2Repeat;\n                varying vec2 diffuseMap2Uv;\n            #endif\n        ")).replace("#include <diffuseMap_frag>","\n            #include <diffuseMap_frag>\n            #ifdef USE_DIFFUSE_MAP2\n                vec2 _diffuseMap2Uv = vec2(diffuseMap2Uv[0] * diffuseMap2Repeat[0] + diffuseMap2Offset[0], diffuseMap2Uv[1] * diffuseMap2Repeat[1] + diffuseMap2Offset[1]);\n                vec4 texelColor2 = texture2D(diffuseMap2, _diffuseMap2Uv);\n                \n                vec4 colorAndOpacity = vec4(u_Color, u_Opacity);\n                \n                texelColor2 = mapTexelToLinear(texelColor2 * colorAndOpacity);\n            \n                outColor.rgb = texelColor2.rgb * texelColor2.a + outColor.rgb * (1. - texelColor2.a);\n                outColor.a = texelColor2.a + outColor.a;\n                // outColor *= texelColor2;\n            #endif\n        "),this.fragmentShader=t}}]),r}(E_);function rR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var nR=new tR,iR=function(){var e;return(e=nR).diffuse.setHex(16777215),e.side="double",e},aR=function(e){LP(r,e);var t=rR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),e=t.call(this,n.uScene,n.geometryResource,n.materialResource),n.materialResource||(e._mesh.material=iR()),e}return BP(r)}(ZE);function sR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var oR=function(e){LP(r,e);var t=sR(r);function r(){var e;return PP(this,r),(e=t.apply(this,arguments)).modifyShader(),e.useDefaultBufferMaterial=!1,e}return BP(r,[{key:"modifyShader",value:function(){this.defines.USE_BATCHID=!1,this.defines.USE_Custom_Alpha=!1,this.uniforms.customAlphaMap=null,this.uniforms.customUvOffset=[0,0],this.uniforms.mColor=[1,1,1,1],this.uniforms.strength=1;var e=this.vertexShader;e=(e=(e=e.replace("#include <color_pars_vert>","\n\t\t\t#include <color_pars_vert>\n\n\t\t\tattribute vec2 customUv;\n\t\t\tvarying vec2 vCustomUv;\n\n\t\t\t#ifdef USE_BATCHID\n\t\t\t\n\t\t\t\tattribute float show;\n\n\t\t\t#endif\n\t\t\t".concat(tg.gpu_picker_pars_vert,"\n        "))).replace("#include <begin_vert>","\n\t\t\t#include <begin_vert>\n\n\t\t\tvCustomUv = customUv;\n\t\t")).replace("#include <logdepthbuf_vert>","\n\t\t\t#ifdef USE_BATCHID\n\n\t\t\t\t// gl_Position *= show; // 这种写法MacOS下有问题\n\t\t\t\tgl_PointSize *= show;\n\n\t\t\t#endif\n\n\t\t\t".concat(tg.gpu_picker_id_vert,"\n\n\t\t\t#include <logdepthbuf_vert>\n\t\t")),this.vertexShader=e;var t=this.fragmentShader;t=(t=t.replace("#include <alphamap_pars_frag>","\n\t\t\t#include <alphamap_pars_frag>\n\t\t\t".concat(tg.gpu_picker_pars_frag,"\n\t\t\tvarying vec2 vCustomUv;\n\t\t\t#if defined(USE_Custom_Alpha)\n\t\t\t\tuniform sampler2D customAlphaMap;\n\t\t\t\tuniform vec2 customUvOffset;\n\t\t\t#endif\n\t\t\t#ifdef USE_MARK_BUFFER\n\t\t\t\tuniform vec4 mColor;\n\t\t\t#endif\n\t\t\t#ifdef USE_COLOR_MARK_BUFFER\n\t\t\t\tuniform float strength;\n\t\t\t#endif\n\t\t"))).replace("#include <end_frag>","\n\t\t\t#include <end_frag>\n\n\t\t\t#if defined(USE_Custom_Alpha)\n\t\t\t\tgl_FragColor.a *= texture2D( customAlphaMap, vCustomUv + customUvOffset ).g;\n\t\t\t#endif\n\t\t\t".concat(tg.gpu_picker_id_frag,"\n\n\t\t\t#ifdef USE_MARK_BUFFER\n\t\t\t\t#ifdef ALPHATEST\n\t\t\t\t\tif(gl_FragColor.a < ALPHATEST) discard;\n\t\t\t\t#endif\n\t\t\t\tgl_FragColor = mColor;\n\t\t\t#endif\n\t\t\t#ifdef USE_COLOR_MARK_BUFFER\n\t\t\t\t#ifdef ALPHATEST\n\t\t\t\t\tif(gl_FragColor.a < ALPHATEST) discard;\n\t\t\t\t#endif\n\n\t\t\t\tgl_FragColor.rgb *= strength;\n\t\t\t#endif\n\t\t\t// TODO: Add GBuffer code.\n        ")),this.fragmentShader=t}}]),r}(G_);function lR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var uR=function(e){LP(r,e);var t=lR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),(e=t.call(this,n.uScene))._mesh.material=new oR,e._mesh.material.defines.UV_DISCARD=!0,e.setPoints([]),e}return BP(r,[{key:"getCustomUv",value:function(){return this._customUv}},{key:"setCustomUv",value:function(e){this._customUv=e,this._updateGeometry("customUv")}},{key:"getCustomVis",value:function(){return this._customVis}},{key:"setCustomVis",value:function(e){this._customVis=e,this._updateGeometry("customVis")}},{key:"_updateGeometry",value:function(e){OP(IP(r.prototype),"_updateGeometry",this).call(this),"customUv"===e?this._customUv?this._mesh.geometry.addAttribute("customUv",new up(new cp(new Float32Array(this._customUv),2))):this._mesh.geometry.removeAttribute("customUv"):"customVis"===e&&(this._customVis?this._mesh.geometry.addAttribute("show",new up(new cp(new Float32Array(this._customVis),1))):this._mesh.geometry.removeAttribute("show"))}}]),r}(ZM);function cR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var hR=function(e){LP(r,e);var t=cR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),(e=t.call(this,n.uScene,n.geometryResource,n.materialResource))._mesh.material=e._getShaderMaterial(),e}return BP(r,[{key:"_getShaderMaterial",value:function(){var e=new bp({name:"diffusionCylinderShader",vertexShader:"\n                #include <common_vert>\n                #include <logdepthbuf_pars_vert>\n\n                attribute vec2 a_Uv;\n        \n                varying vec2 vUv;\n                \n                void main() {\n                    vec4 worldPosition = u_Model * vec4(a_Position, 1.0);\n                    gl_Position = u_ProjectionView * worldPosition;\n            \n                    vUv = a_Uv;\n            \n                    #include <logdepthbuf_vert>\n                }\n            ",fragmentShader:"\n                #include <common_frag>\n                #include <logdepthbuf_pars_frag>\n\n                varying vec2 vUv;\n                \n                void main() {\n                    #include <logdepthbuf_frag>\n                    gl_FragColor = vec4( u_Color, (1.0 - vUv.y) * u_Opacity );\n                }\n            "});return e.side="double",e}}]),r}(ZE),dR=function(){function e(){PP(this,e),this.arcLengthDivisions=200,this.cacheArcLengths=null,this.needsUpdate=!0}return BP(e,[{key:"getPoint",value:function(){return console.warn("t3d.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r=[],n=this.getPoint(0),i=0;r.push(0);for(var a=1;a<=e;a++)i+=(t=this.getPoint(a/e)).distanceTo(n),r.push(i),n=t;return this.cacheArcLengths=r,r}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var r,n=this.getLengths(),i=0,a=n.length;r=t||e*n[a-1];for(var s,o=0,l=a-1;o<=l;)if((s=n[i=Math.floor(o+(l-o)/2)]-r)<0)o=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(a-1);var u=n[i];return(i+(r-u)/(n[i+1]-u))/(a-1)}}]),e}();function pR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var fR=function(e){LP(r,e);var t=pR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xh,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xh;return PP(this,r),(e=t.call(this)).v1=n,e.v2=i,e}return BP(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xh;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}}]),r}(dR);fR.prototype.isLineCurve2=!0;var mR=function(){function e(){PP(this,e)}return BP(e,null,[{key:"hilbert2D",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new bc(0,0,0),t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,s=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:10)/2,o=[new bc(e.x-s,e.y,e.z-s),new bc(e.x-s,e.y,e.z+s),new bc(e.x+s,e.y,e.z+s),new bc(e.x+s,e.y,e.z-s)],l=[o[r],o[n],o[i],o[a]];if(0<=--t){var u=[];return Array.prototype.push.apply(u,this.hilbert2D(l[0],s,t,r,a,i,n)),Array.prototype.push.apply(u,this.hilbert2D(l[1],s,t,r,n,i,a)),Array.prototype.push.apply(u,this.hilbert2D(l[2],s,t,r,n,i,a)),Array.prototype.push.apply(u,this.hilbert2D(l[3],s,t,i,n,r,a)),u}return l}},{key:"hilbert3D",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new bc(0,0,0),t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:6,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:7,c=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:10)/2,h=[new bc(e.x-c,e.y+c,e.z-c),new bc(e.x-c,e.y+c,e.z+c),new bc(e.x-c,e.y-c,e.z+c),new bc(e.x-c,e.y-c,e.z-c),new bc(e.x+c,e.y-c,e.z-c),new bc(e.x+c,e.y-c,e.z+c),new bc(e.x+c,e.y+c,e.z+c),new bc(e.x+c,e.y+c,e.z-c)],d=[h[r],h[n],h[i],h[a],h[s],h[o],h[l],h[u]];if(--t>=0){var p=[];return Array.prototype.push.apply(p,this.hilbert3D(d[0],c,t,r,a,s,u,l,o,i,n)),Array.prototype.push.apply(p,this.hilbert3D(d[1],c,t,r,u,l,n,i,o,s,a)),Array.prototype.push.apply(p,this.hilbert3D(d[2],c,t,r,u,l,n,i,o,s,a)),Array.prototype.push.apply(p,this.hilbert3D(d[3],c,t,i,a,r,n,l,u,s,o)),Array.prototype.push.apply(p,this.hilbert3D(d[4],c,t,i,a,r,n,l,u,s,o)),Array.prototype.push.apply(p,this.hilbert3D(d[5],c,t,s,a,i,o,l,n,r,u)),Array.prototype.push.apply(p,this.hilbert3D(d[6],c,t,s,a,i,o,l,n,r,u)),Array.prototype.push.apply(p,this.hilbert3D(d[7],c,t,l,o,i,n,r,a,s,u)),p}return d}},{key:"quadraticBezier",value:function(e,t,r,n){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}},{key:"cubicBezier",value:function(e,t,r,n,i){return function(e,t){var r=1-e;return r*r*r*t}(e,t)+function(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}}]),e}();function gR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var _R=function(e){LP(r,e);var t=gR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xh,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xh,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new xh;return PP(this,r),(e=t.call(this)).v0=n,e.v1=i,e.v2=a,e}return BP(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xh,r=this.v0,n=this.v1,i=this.v2;return t.set(mR.quadraticBezier(e,r.x,n.x,i.x),mR.quadraticBezier(e,r.y,n.y,i.y)),t}}]),r}(dR);function vR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}_R.prototype.isQuadraticBezierCurve2=!0;var yR=function(e){LP(r,e);var t=vR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xh,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xh,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new xh,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new xh;return PP(this,r),(e=t.call(this)).v0=n,e.v1=i,e.v2=a,e.v3=s,e}return BP(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xh,r=this.v0,n=this.v1,i=this.v2,a=this.v3;return t.set(mR.cubicBezier(e,r.x,n.x,i.x,a.x),mR.cubicBezier(e,r.y,n.y,i.y,a.y)),t}}]),r}(dR);function xR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}yR.prototype.isCubicBezierCurve2=!0;var bR=function(e){LP(r,e);var t=xR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new bc,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bc;return PP(this,r),(e=t.call(this)).v1=n,e.v2=i,e}return BP(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bc;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}}]),r}(dR);function AR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}bR.prototype.isLineCurve3=!0;var SR=function(e){LP(r,e);var t=AR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new bc,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bc,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new bc;return PP(this,r),(e=t.call(this)).v0=n,e.v1=i,e.v2=a,e}return BP(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bc,r=this.v0,n=this.v1,i=this.v2;return t.set(mR.quadraticBezier(e,r.x,n.x,i.x),mR.quadraticBezier(e,r.y,n.y,i.y),mR.quadraticBezier(e,r.z,n.z,i.z)),t}}]),r}(dR);SR.prototype.isQuadraticBezierCurve3=!0;var ER=new bc,wR=new bc,CR=new Sc,TR=function(){function e(){PP(this,e),this.curves=[]}return BP(e,[{key:"setFromPoints",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.bevelRadius||0,n=t.close||!1,i=e.length;if(i<2)console.warn("CurvePath3.setFromPoints: points length less than 2.");else{n&&!e[0].equals(e[i-1])&&(e.push((new bc).copy(e[0])),i++);for(var a=(new bc).copy(e[0]),s=1;s<i;s++){var o=e[s],l=s===i-1;if(r>0&&!(l&&!n)){var u=l?e[1]:e[s+1],c=ER.subVectors(o,a),h=wR.subVectors(u,o),d=c.getLength(),p=h.getLength(),f=Math.min(.999999*(1===s?d/2:d),r),m=Math.min(p/2*.999999,r);c.normalize(),h.normalize();var g=new bR;g.v1.copy(a),g.v2.copy(o).sub(c.multiplyScalar(f)),this.curves.push(g);var _=new SR;_.v0.copy(g.v2),_.v1.copy(o),_.v2.copy(o).add(h.multiplyScalar(m)),this.curves.push(_),a.copy(_.v2)}else{var v=new bR;v.v1.copy(a),v.v2.copy(o),this.curves.push(v),a.copy(o)}}n&&this.curves[0].v1.copy(a)}}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,t=[],r=0,n=this.curves;r<n.length;r++)for(var i=n[r],a=i.isLineCurve2||i.isLineCurve3?1:e,s=i.getPoints(a),o=0,l=r===n.length-1?s.length:s.length-1;o<l;o++){var u=s[o];t.push(u)}return t}},{key:"computeFrames",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.up,r=void 0!==e.divisions?e.divisions:12,n=void 0===e.frenet||e.frenet,i=void 0===e.fixLine||e.fixLine,a=void 0!==e.close&&e.close,s=[],o=[],l=[],u=[],c=[],h=[],d=[],p=[],f=0,m=0,g=this.curves;m<g.length;m++){var _=g[m],v=_.isLineCurve2||_.isLineCurve3,y=v?1:r,x=_.getPoints(y),b=m===g.length-1;if(i&&v&&!b){var A=g[m+1];A.isLineCurve2||A.isLineCurve3||(f=1)}for(var S=0,E=b?x.length:x.length-1;S<E;S++){var w=x[S];s.push(w),p.push(f),1===f?f++:2===f&&(f=0)}}if(o[0]=new bc,l[0]=new bc,u[0]=new bc,o[0].subVectors(s[1],s[0]).normalize(),t)l[0].copy(t);else{var C=Number.MAX_VALUE,T=Math.abs(o[0].x),D=Math.abs(o[0].y),M=Math.abs(o[0].z);T<C&&(C=T,l[0].set(1,0,0)),D<C&&(C=D,l[0].set(0,1,0)),M<C&&l[0].set(0,0,1)}u[0].crossVectors(o[0],l[0]).normalize(),l[0].crossVectors(u[0],o[0]).normalize(),c[0]=0,h[0]=1,d[0]=!1;for(var P=new bc,F=new bc,R=1;R<s.length-1;R++){var N=new bc,B=new bc,I=new bc;P.subVectors(s[R],s[R-1]),F.subVectors(s[R+1],s[R]);var O=P.getLength();P.normalize(),F.normalize();var k=p[R];if(1===k?N.copy(F):2===k?N.copy(P):N.addVectors(P,F).normalize(),n){B.copy(l[R-1]);var L=I.crossVectors(o[R-1],N);if(L.getLength()>Number.EPSILON){L.normalize();var U=Math.acos(Math.min(Math.max(o[R-1].dot(N),-1),1));B.applyMatrix4(CR.makeRotationAxis(L,U))}I.crossVectors(N,B).normalize()}else B.copy(l[R-1]),1===N.dot(B)?I.crossVectors(F,B).normalize():I.crossVectors(N,B).normalize(),B.crossVectors(I,N).normalize();o[R]=N,l[R]=B,u[R]=I;var z=P.dot(F);c[R]=c[R-1]+O,h[R]=Math.min(1/Math.sqrt((1+z)/2),1.415)||1,d[R]=Math.abs(z-1)>.05}var j=s.length-1,V=new bc,G=new bc,W=new bc;V.subVectors(s[j],s[j-1]);var H=V.getLength();a?V.copy(o[0]):V.normalize(),G.copy(l[j-1]);var q=W.crossVectors(o[j-1],V);if(q.getLength()>Number.EPSILON){q.normalize();var X=Math.acos(Math.min(Math.max(o[j-1].dot(V),-1),1));G.applyMatrix4(CR.makeRotationAxis(q,X))}return W.crossVectors(V,G).normalize(),o[j]=V,l[j]=G,u[j]=W,c[j]=c[j-1]+H,h[j]=1,d[j]=!1,a&&(o[0].copy(V),l[0].copy(G),u[0].copy(W)),{points:s,tangents:o,normals:l,binormals:u,lengths:c,widthScales:h,sharps:d,tangentTypes:p}}}]),e}(),DR=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=void 0!==r.width?r.width:.1,i=void 0!==r.side?r.side:"both",a=[],s=[],o=[],l=[],u=[],c=e.points.length,h=c-1,d=n/2,p="both"!==i?n/2:n,f=e.lengths[h],m=new bc,g=new bc,_=0,v=0;v<c;v++){var y=e.lengths[v]/p,x=e.lengths[v]/f;"left"!==i?g.copy(e.binormals[v]).multiplyScalar(d*e.widthScales[v]):g.set(0,0,0),"right"!==i?m.copy(e.binormals[v]).multiplyScalar(-d*e.widthScales[v]):m.set(0,0,0);var b=e.normals[v];g.add(e.points[v]),m.add(e.points[v]),a.push(m.x,m.y,m.z,g.x,g.y,g.z),s.push(b.x,b.y,b.z,b.x,b.y,b.z),o.push(y,0,y,1),l.push(x,0,x,1),_+=2,v>0&&u.push(_-2,_-4,_-3,_-2,_-3,_-1)}return{positions:a,normals:s,uvs:o,uvs2:l,indices:u}};function MR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var PR=new DP,FR=function(e){LP(r,e);var t=MR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),(e=t.call(this,n.external.uScene))._time=0,e._polygonPoints=n.external.polygonPoints,e._width=null==n.external.width?10:n.external.width,e.flow_speed=null==n.external.flowSpeed?1:n.external.flowSpeed,e.setFractionMap(n.external.fractionMapUrl),e.buildNodeMesh(n),e}return BP(r,[{key:"construcVertexData",value:function(e){var t=new TR,r=[];if(e[0]instanceof Array)for(var n=0;n<e.length;n++)r.push(new bc(e[n][0],e[n][1],e[n][2]));else r=e;t.setFromPoints(r,{bevelRadius:this.width});var i=t.computeFrames({up:new bc(0,1,0),divisions:Math.max(2.5*this.width,5)}),a=DR(i,[],{width:this.width,side:"both",arrow:!1});return{index:a.indices,position:a.positions,normal:a.normals,uv:a.uvs}}},{key:"constructGeo",value:function(e){this._riverGeometry?this._riverGeometry.dispose():this._riverGeometry=new _p,e.index&&this._riverGeometry.setIndex(new up(new cp(e.position.length/3>65536?new Uint32Array(e.index):new Uint16Array(e.index),1)));var t=new cp(new Float32Array(e.position),3);t.usage=Jc.DYNAMIC_DRAW,this._riverGeometry.addAttribute("a_Position",new up(t,3));var r=new cp(new Float32Array(e.uv),2);r.usage=Jc.DYNAMIC_DRAW,this._riverGeometry.addAttribute("a_Uv",new up(r,2)),this._riverGeometry.computeBoundingBox(),this._riverGeometry.computeBoundingSphere()}},{key:"buildNodeMesh",value:function(e){if(null==e.external.vertexData){this._vertexPoints=e.external.vertexPoints;var t=this.construcVertexData(e.external.vertexPoints);this.constructGeo(t)}else this.constructGeo(e.external.vertexData);var r={name:"river_flow",defines:{},uniforms:{fractionTexture:this._fractionMap,time:0,flow_speed:this.flow_speed,strength:1},vertexShader:"\n\t\t\t\t#include <common_vert>\n\t\t\t\t#include <logdepthbuf_pars_vert>\n\t\t\t\t".concat(tg.gpu_picker_pars_vert,"\n\t\t\t\tattribute vec2 a_Uv;\n\t\t\t\tuniform float time;\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = a_Uv;\n\t\t\t\t\tvec4 mvPosition = u_View * u_Model *  vec4(a_Position, 1.);\n\t\t\t\t\tgl_Position =  u_Projection * mvPosition;\n\t\t\t\t\t").concat(tg.gpu_picker_id_vert,"\n\t\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t\t}\n\t\t\t"),fragmentShader:"\n\t\t\t\t#include <logdepthbuf_pars_frag>\n\t\t\t\t".concat(tg.gpu_picker_pars_frag,"\n\t\t\t\tuniform vec3 u_Color;\n\t\t\t\tuniform float u_Opacity;\n\t\t\t\t// uniform float mixFactor;\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform float time;\n                uniform float flow_speed;\n\t\t\t\tuniform sampler2D fractionTexture;\n\t\t\t\tuniform sampler2D  m_water_base;\n\n\t\t\t\tuniform float strength;\n\n\t\t\t\tfloat hash( float n ) {\n\t\t\t\t\treturn fract(sin(n)*43758.5453123);\n\t\t\t\t}\n\n\t\t\t\tfloat noise( in vec2 x ) {\n\t\t\t\t\tvec2 p = floor(x);\n\t\t\t\t\tvec2 f = fract(x);\n\t\t\t\t\tf = f*f*(3.0-2.0*f);\n\t\t\t\t\tfloat n = p.x + p.y*57.0;\n\t\t\t\t\treturn mix(mix( hash(n+  0.0), hash(n+  1.0),f.x), mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n\t\t\t\t}\n\n\t\t\t\tfloat fbm(in vec2 p ) {\n\t\t\t\t\treturn 0.5*noise(p) + 0.25*noise(2.0*p)+0.125*noise(4.0*p)+0.0625*noise(8.0*p)\n\t\t\t\t\t\t+0.03125*noise(16.0*p)+0.015625*noise(32.0*p);\n\t\t\t\t}\n\n\t\t\t\tvoid main(void)\n\t\t\t\t{\n\t\t\t\t\tvec2 scrolledUV = vUv;\n\t\t\t\t\tfloat iTime1= sin(time);\n\t\t\t\t\t//scrolledUV.x =  smoothstep(0.1,1.0,vUv.x*fract((time)) ); \n\t\t\t\t\tscrolledUV.y =  smoothstep(0.1,1.0,vUv.y*(fract(time) )); \n\t\t\t\t\tvec4 color = texture2D(fractionTexture,scrolledUV);\n\n\n\t\t\t\t\tvec2 p= vUv;\n\t\t\t\t\tp += fbm(4.0*p - flow_speed* vec2( time,0));\n\t\t\t\t\tp = p * 4.0;\n\t\t\t\t\t//float f1 = fbm(p);\n\t\t\t\t\t//float f2=fbm(p + 100.0);\n\t\t\t\t\t//float f3=fbm(p + 200.0);\n\n                    gl_FragColor = texture2D(fractionTexture,p/10.);\n\t\t\t\t\tgl_FragColor.rgb = gl_FragColor.rgb*u_Color;\n\t\t\t\t\t#ifdef USE_COLOR_MARK_BUFFER\n\t\t\t\t\t\tgl_FragColor.rgb = gl_FragColor.rgb * strength;\n\t\t\t\t\t#endif\n\t\t\t\t\tgl_FragColor.a = u_Opacity;\n\n\t\t\t\t\t#include <logdepthbuf_frag>\n\t\t\t\t\t").concat(tg.gpu_picker_id_frag,"\n\t\t\t\t}\n\n\t\t\t")},n=new bp(r);n.side=Lc.DOUBLE,n.type="WaterMaterial";var i=new ap(this._riverGeometry,n);n.depthTest=!1,this._node.add(i),this._mesh=i}},{key:"width",get:function(){return this._width},set:function(e){this._width=e;var t=this.construcVertexData(this._vertexPoints);this.constructGeo(t),this._mesh.geometry=this._riverGeometry}},{key:"setFractionMap",value:function(e,t){var r=this;PR.load(e,(function(e){e.wrapS=e.wrapT=Gc.REPEAT,e.anisotropy=16,r._fractionMap=e,r._mesh&&(r._mesh.material.uniforms.fractionTexture=e),t&&t.call(r)}))}},{key:"changeFlowSpeed",value:function(e){this._mesh.material.uniforms.flow_speed=e}},{key:"update",value:function(e){this._time+=e,this._mesh.material.uniforms.time=this._time}},{key:"dispose",value:function(){this._mesh.material.dispose(),this._mesh.geometry.dispose(),OP(IP(r.prototype),"dispose",this).call(this)}}]),r}(QE);function RR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var NR=new DP,BR=new bp({defines:{},vertexShader:"    #include <common_vert>\n    precision mediump float;\n    attribute vec2 a_Uv;\n    varying vec2 v_uv;\n    \n    void main() {\n        v_uv = a_Uv;\n        vec4 position =vec4( a_Position.xyz, 1);\n        gl_Position = u_ProjectionView * u_Model * position;\n    }\n    \n    ",fragmentShader:"    #include <common_frag>\n    precision mediump float;\n    \n    uniform sampler2D u_screen;\n    uniform float u_opacity;\n    varying vec2 v_uv;\n    \n    void main() {\n        vec4 color = texture2D(u_screen,  vec2(v_uv.x,1.-v_uv.y));\n        // a hack to guarantee opacity fade out even with a value close to 1.0\n        gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n        // if(gl_FragColor.a ==0.) gl_FragColor.a =0.1;\n    }\n    ",uniforms:{u_screen:null,u_opacity:0}}),IR=new bp({defines:{},vertexShader:"    #include <common_vert>\n    precision mediump float;\n    \n    attribute float a_index;\n    \n    uniform sampler2D u_particles;\n    uniform float u_particles_res;\n\tuniform float pointSize;\n    \n    varying vec2 v_particle_pos;\n    \n    void main() {\n        vec4 color = texture2D(u_particles, vec2(\n            fract(a_index / u_particles_res),\n            floor(a_index / u_particles_res) / u_particles_res));\n    \n        // decode current particle position from the pixel's RGBA value\n        v_particle_pos = vec2(\n            color.r / 255.0 + color.b,\n            color.g / 255.0 + color.a);\n    \n        gl_PointSize = pointSize;\n        gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n    }\n    \n    ",fragmentShader:"    #include <common_frag>\n    precision mediump float;\n    \n    uniform sampler2D u_wind;\n    uniform vec2 u_wind_min;\n    uniform vec2 u_wind_max;\n    uniform sampler2D u_color_ramp;\n    uniform sampler2D u_circle;\n    \n    varying vec2 v_particle_pos;\n    \n    void main() {\n        vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n        float speed_t = length(velocity) / length(u_wind_max);\n    \n        // color ramp is encoded in a 16x16 texture\n        vec2 ramp_pos = vec2(\n            fract(16.0 * speed_t),\n            floor(16.0 * speed_t) / 16.0);\n    \n        gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n    \n        float  alpha = texture2D(u_circle, vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y)).a;\n        gl_FragColor.a *= alpha;\n    }\n    \n    ",uniforms:{u_wind:null,u_particles:null,u_color_ramp:null,u_circle:null,pointSize:5,u_particles_res:0,u_wind_min:[0,0],u_wind_max:[0,0]}}),OR=new bp({defines:{},vertexShader:"    #include <common_vert>\n    precision mediump float;\n    attribute vec2 a_Uv;\n    varying vec2 v_uv;\n    \n    void main() {\n        v_uv = a_Uv;\n        vec4 position =vec4( a_Position.xyz, 1);\n        gl_Position = u_ProjectionView * u_Model * position;\n    }\n    ",fragmentShader:"    #include <common_frag>\n    precision highp float;\n    \n    uniform sampler2D u_particles;\n    uniform sampler2D u_wind;\n    uniform vec2 u_wind_res;\n    uniform vec2 u_wind_min;\n    uniform vec2 u_wind_max;\n    uniform float u_rand_seed;\n    uniform float u_speed_factor;\n    uniform float u_drop_rate;\n    uniform float u_drop_rate_bump;\n    \n    varying vec2 v_uv;\n    \n    // pseudo-random generator\n    const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n    float rand2(const vec2 co) {\n        float t = dot(rand_constants.xy, co);\n        return fract(sin(t) * (rand_constants.z + t));\n    }\n    \n    // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n    vec2 lookup_wind(const vec2 uv) {\n        // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n        vec2 px = 1.0 / u_wind_res;\n        vec2 vc = (floor(uv * u_wind_res)) * px;\n        vec2 f = fract(uv * u_wind_res);\n        vec2 tl = texture2D(u_wind, vc).rg;\n        vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n        vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n        vec2 br = texture2D(u_wind, vc + px).rg;\n        return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n    }\n    \n    void main() {\n        vec4 color = texture2D(u_particles, v_uv);\n        vec2 pos = vec2(\n            color.r / 255.0 + color.b,\n            color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n    \n        vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n        float speed_t = length(velocity) / length(u_wind_max);\n    \n        // take EPSG:4236 distortion into account for calculating where the particle moved\n        float distortion = cos(radians(pos.y * 180.0 - 90.0));\n        vec2 offset = vec2(velocity.x / distortion, velocity.y) * 0.0001 * u_speed_factor;\n    \n        // update particle position, wrapping around the date line\n        pos = fract(1.0 + pos + offset);\n    \n        // a random seed to use for the particle drop\n        vec2 seed = (pos + v_uv) * u_rand_seed;\n    \n        // drop rate is a chance a particle will restart at random position, to avoid degeneration\n        float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n        float drop = step(1.0 - drop_rate, rand2(seed));\n    \n        vec2 random_pos = vec2(\n            rand2(seed + 1.3),\n            rand2(seed + 2.1));\n        pos = mix(pos, random_pos, drop);\n    \n        // encode the new particle position back into RGBA\n        gl_FragColor = vec4(\n            fract(pos * 255.0),\n            floor(pos * 255.0) / 255.0);\n    }\n    \n    ",uniforms:{u_wind:null,u_particles:null,u_rand_seed:Math.random(),u_wind_res:[0,0],u_wind_min:[0,0],u_wind_max:[0,0],u_speed_factor:0,u_drop_rate:0,u_drop_rate_bump:0}});function kR(e){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;var n=r.createLinearGradient(0,0,256,0);for(var i in e)n.addColorStop(+i,e[i]);return r.fillStyle=n,r.fillRect(0,0,256,1),new Uint8Array(r.getImageData(0,0,256,1).data)}var LR=function(e){LP(r,e);var t=RR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),(e=t.call(this,n.external.uScene))._fadeOpacity=.996,e._speedFactor=void 0===n.external.speedFactor?1:n.external.speedFactor,e._dropRate=.01,e._dropRateBump=.01,e._rttResolution=4096,e._pointSize=n.external.pointSize,e._opacity=1,e.blendscene=new Nd,e.blendcamera=new Bd,e.blendcamera.setOrtho(-1,1,-1,1,.01,1e3),e.blendcamera.position.set(0,10,0),e.blendcamera.lookAt(new bc(0,0,0),new bc(0,0,-1)),e.blendscene.add(e.blendcamera);var i=new vp(2,2);e.mesh=new ap(i,new T_),e.blendscene.add(e.mesh);var a=new T_;a.diffuse.setRGB(0,0,0),a.transparent=!0,a.opacity=.1,a.blending=Bc.CUSTOM,a.blendSrc=Oc.SRC_ALPHA,a.blendDst=Oc.ONE_MINUS_SRC_ALPHA;var s=new ap(new vp(2,2),a);e.blendscene.add(s),e.rttmesh=null,e.rttscene=new Nd,e.rttcamera=new Bd,e.rttcamera.position.set(0,10,0),e.rttcamera.lookAt(new bc(0,0,0),new bc(0,0,-1)),e.rttscene.add(e.rttcamera),e.setcircleMap(n.external.circleMapUrl),e.particscene=new Nd,e.parcticcamera=new Bd,e.parcticcamera.position.set(0,20,0),e.parcticcamera.lookAt(new bc(0,0,0),new bc(0,0,-1)),e.parcticcamera.setOrtho(-1,1,-1,1,.01,100),e.particscene.add(e.parcticcamera),e.renderer=n.external.renderer,e.POINTS=null,e._grad=n.external.gradient;var o=e._createCanvas();return o.width=256,o.height=1,e._gradCtx=o.getContext("2d"),e._gradTexture=null,e._originalGrad=e._grad,e.colorRampTexture=e._gradient(e._grad),e.resize(),e._createNode(n),e.numParticles=void 0===n.external.numParticles||null===n.external.numParticles?1e4:n.external.numParticles,e}return BP(r,[{key:"numParticles",get:function(){return this._numParticles},set:function(e){var t=this.particleStateResolution=Math.ceil(Math.sqrt(e));this._numParticles=t*t;for(var r=new Uint8Array(4*this._numParticles),n=0;n<r.length;n++)r[n]=Math.floor(256*Math.random());this.particleStateRT0=new Em(t,t),this.particleStateRT0.texture.image={data:r,width:t,height:t},this.particleStateRT0.texture.minFilter=Vc.NEAREST,this.particleStateRT0.texture.magFilter=Vc.NEAREST,this.particleStateRT0.texture.type=jc.UNSIGNED_BYTE,this.particleStateRT0.texture.format=zc.RGBA,this.particleStateRT0.texture.internalformat=null,this.particleStateRT0.texture.generateMipmaps=!1,this.particleStateRT1=new Em(t,t),this.particleStateRT1.texture.image={data:r,width:t,height:t},this.particleStateRT1.texture.minFilter=Vc.NEAREST,this.particleStateRT1.texture.magFilter=Vc.NEAREST,this.particleStateRT1.texture.type=jc.UNSIGNED_BYTE,this.particleStateRT1.texture.format=zc.RGBA,this.particleStateRT1.texture.internalformat=null,this.particleStateRT1.texture.generateMipmaps=!1;for(var i=new Float32Array(this._numParticles),a=0;a<this._numParticles;a++)i[a]=a;this.particleIndexBuffer=new cp(i,1)}},{key:"fadeOpacity",get:function(){return this._fadeOpacity},set:function(e){this._fadeOpacity=e}},{key:"speedFactor",get:function(){return this._speedFactor},set:function(e){this._speedFactor=e}},{key:"dropRate",get:function(){return this._dropRate},set:function(e){this._dropRate=e}},{key:"dropRateBump",get:function(){return this._dropRateBump},set:function(e){this._dropRateBump=e}},{key:"rttResolution",get:function(){return this._rttResolution},set:function(e){this._rttResolution=e,this.resize()}},{key:"pointSize",get:function(){return this._pointSize},set:function(e){this._pointSize=e}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity=e}},{key:"gradient",get:function(){return this._grad},set:function(e){this._originalGrad=this._grad,this.colorRampTexture=this._gradient(e),this._grad=e}},{key:"_createNode",value:function(e){var t;if(e.external.geometry)t=e.external.geometry;else{var r=e.external.vertexData;(t=new _p).addAttribute("a_Position",new up(new cp(new Float32Array(r.positions),3))),t.addAttribute("a_Normal",new up(new cp(new Float32Array(r.normals),3))),t.addAttribute("a_Uv",new up(new cp(new Float32Array(r.uv),2))),t.setIndex(new up(new cp(r.positions.length/3>65536?new Uint32Array(r.indices):new Uint16Array(r.indices),1)))}var n=new T_;this._mesh2||(this._mesh2=new ap(t,n),this._node.add(this._mesh2),this.$markChildrenMatrixAutoUpdate(!1))}},{key:"setcircleMap",value:function(e){var t;if(e)t=NR.load(e);else{var r=new Image;r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sHDRYtFjgycv0AAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAABlNJREFUWMPll8uPHUcVxn9fdfd9zcy1PePYjj32YJkQDA5BipBAAqQIsQD+B1hlj8QCsOwBO0aILRJr/gZ2sIoILBAOcgSBxGAzNs68PO/7mn5U1WHRPQqRYo8HkRUlXfW93eqq36nz1XfOhf/nUV6G9ONcYL8PhYEBxwRu8MGzRxchfOZjAAjA+Ay4NsQWuBa4AJMKRtOgEfQGUJ6FcOF/BDA+CToF7W4dbZZDuQnpRXAJmCAD4gSsgGJQf5dA/82CG6dgdh7CPmgM4RLEk5BMAYIwAHYgeQjxC/U7ioAH5RDGwCboBUiOLJxPQvY50Kcg/A3sMugT4F4AdxlsHtwMOAfKIPszxFdAHaANZOAEtCBZPWIK7p6HcBluXvlhKgm+TWpmSIICz0O4+Z1feJYHxJ4RQ7PVl+rIGYDtgSU1YLAjpuDq1atpkiRpjLEDpGbWbq4kSeLNrDCz3DmXL37pludNKN+Bzp8g/BK0CbYMrINtAXtHALh+/XoqqRNCmJI0B8xIascY2wCSCmAMDM1sz8zGSZLk19593edvw9SvM2y3Ij4A7oO9X0Mkz7p4CKEDzAFnJC1IOg/MA6cknQSeA/pAJskBQVL47cmvxq//8c3Id19E7YKkVUFVo1rxDBpYXFxMQwgd59ycpHPAgpk9b2YnJXVr3RMlRTMbAbNAv9kdYoxeBT5kL6NouP4SzBWoD9p+BoAQQgocM7MzZrYg6ZKkeWAG6ACJpGBmE0nTZtYHus1975wrrr32A38rcT6ka9BeRVMFtYoOScHi4mJqZj1Jp4EFSZeAi8A5SReSJFlI0/RskiRzwJSZAbjmY2ZWNWD7b/ye+OqXN6KqVRjuY+u1Vxy2A2kz8WyT59OSTkg6n6bp+SzLprvdbpJlmZVlmY9Go+Pe+3sxxmBmBTAEHjvntiXlFvZQrIglyIPFZ/OBjnNu2sxONDAzaZqearVa/VarlfR6Paanpwkh9CTN7+3tjWOMI0nTTZp6Ztb23qfOP/JxPIFBLUJVhwDEGFMza5tZD2ibWSYpy7Ks2+v1XLfbZWZmhn6/j5kpz/POeDyeCyG8H2PMGo10JaWtVgu3u0ZcD7AG7IKNDwFoXM41gkrMLEoiTVM3NTWlfr9Pv9+n3W5TliVZlsk5125Sl9SGSyIplYR/6NEysAK2W9eRQwGccxEIDYwBeYyxcs5Zp9NRq9Wqa0RZUhSFxRgrMwvNySglBcCbGXoPbBPcNsRBrZCnAqRpSlVVhXNuImkMFMCkLMutwWAwnWVZq6oqnHPs7OwwGAyKsiy3gZzabvLmJHhJxKU693Fc23AcHS5C75zLJY3MbChpYmYT7/2DwWCQFUXxXKfTaccYyfM8L4piJca43Kh/BOxJ2m5OhNdj8AVoAtkQysEzAEgam9kmsC7p+EFey7L03vuNyWQyDbgQwgDYALaAXTN73PzelZRfe+uWt6LuC2xQi7C/VBvGE8fNmze9cy53zm1JWgX+ZWbrZrYjaS3GeC+E8K73/q/APWDtALaWGisxxr2qqnK3AbYBPICpO5AtfWA0Tx2SfFPl1swsacRZmdlsc8ycJBqh7QPbZrYCPDCztRjj6MbvfuZjAd13Ptrpnrz/l8C/ccP/9NUf5cCWmRFjLCTtA7OSOgdzmJkHBjHGbUkrzrmNEMJelmW+dQfc/hMCfGr7dQX8aUjm4ScLdVU0s46kY5JmgN5/BOGBiZkNzWwvSZKRc85//zc3PI+gt3xEgPASmIPqLHAOkgvAS/Dj21dTSR3nXAq0Y4xIwjkXQgi+EW5+bXjLH3Q/+TKc+OcRAEZfg/aF+mG1DW6uroHuZXCfbhNnr/D6z7+VSiKEcABQNy/fuOHjHYjvAatg66D3oXP/ydXuw5F/BfznBa/0CL2M5O4I+4vHCrASrAoQB1z93opPkxcxSzDbxKo/kExuowegEhQAgyRCMn56uf3wOAf6bIf4xSto6nns1G3i0jIaAttgux6mVnDuLYLtgFooPsZVf4fhkLDRdL8F2ATCBFw8AkBwQMvhOtOEdBYd79RuMYS4Buk0uGxMDHexzirC1f9QRkNsOaAVsJ3a7Tio+ztHAHC7EJf2sftv42b/AXfX0RbECOkWWAo+gM7t42ZyDGFlxHbqTtet1r0/ozp6RpB+E/jVRwP8G3R7eXmZvRtYAAAAAElFTkSuQmCC",t=Bp.fromImage(r)}t.wrapS=t.wrapT=Gc.CLAMP_TO_EDGE,t.anisotropy=16,this._circleT=t}},{key:"drawScreen",value:function(){var e=!1;this.drawTexture(this.renderTarget2.texture,this.fadeOpacity,e,this.renderTarget),this.drawParticles(),e=!0,this.drawTexture(this.renderTarget2.texture,this.opacity,e,null)}},{key:"drawTexture",value:function(e,t,r,n){BR.uniforms.u_screen=e,BR.uniforms.u_opacity=3*t,this.mesh.material=BR,this.mesh.material.needsUpdate=!0,n?(BR.blending=Bc.NORMAL,this.rttscene.updateMatrix(),this.rttscene.updateRenderStates(this.rttcamera),this.rttscene.updateRenderQueue(this.rttcamera),this.renderer.renderPass.setRenderTarget(n),this.renderer.renderPass.setClearColor(0,0,0,0),this.renderer.renderPass.clear(!0,!0,!0),this.renderer.renderScene(this.rttscene,this.rttcamera)):(BR.blending=Bc.CUSTOM,BR.blendSrc=Oc.SRC_ALPHA,BR.blendDst=Oc.ONE_MINUS_SRC_ALPHA,this.blendscene.updateMatrix(),this.blendscene.updateRenderStates(this.blendcamera),this.blendscene.updateRenderQueue(this.blendcamera),this.renderer.renderPass.setRenderTarget(this.renderTarget3),this.renderer.renderScene(this.blendscene,this.blendcamera))}},{key:"drawParticles",value:function(){if(IR.uniforms.u_wind=this.windTexture,IR.uniforms.u_particles=this.particleStateRT1.texture,IR.uniforms.u_color_ramp=this.colorRampTexture,IR.uniforms.u_circle=this._circleT,IR.uniforms.pointSize=this.pointSize,IR.uniforms.u_particles_res=this.particleStateResolution,IR.uniforms.u_wind_min=[this.windData.uMin,this.windData.vMin],IR.uniforms.u_wind_max=[this.windData.uMax,this.windData.vMax],IR.drawMode=Kc.POINTS,IR.depthWrite=!1,IR.depthTest=!1,this.POINTS)this.POINTS.material=IR;else{var e=new _p,t=new up(this.particleIndexBuffer);e.addAttribute("a_index",t),e.addAttribute("a_Position",new up(new cp(new Float32Array(3*this._numParticles),3))),e.computeBoundingBox(),e.computeBoundingSphere(),this.POINTS=new ap(e,IR),this.POINTS.frustumCulled=!1,this.particscene.add(this.POINTS)}this.particscene.updateMatrix(),this.particscene.updateRenderStates(this.parcticcamera),this.particscene.updateRenderQueue(this.parcticcamera),this.renderer.renderPass.setRenderTarget(this.renderTarget),this.renderer.renderPass.setClearColor(0,0,0,0),this.renderer.renderPass.clear(!0,!0,!0),this.renderer.renderScene(this.particscene,this.parcticcamera);var r=this.renderTarget;this.renderTarget=this.renderTarget2,this.renderTarget2=r}},{key:"updateParticles",value:function(){if(OR.uniforms.u_wind=this.windTexture,OR.uniforms.u_particles=this.particleStateRT1.texture,OR.uniforms.u_wind_res=[this.windData.width,this.windData.height],OR.uniforms.u_wind_min=[this.windData.uMin,this.windData.vMin],OR.uniforms.u_wind_max=[this.windData.uMax,this.windData.vMax],OR.uniforms.u_speed_factor=.25*this.speedFactor,OR.uniforms.u_drop_rate=this.dropRate,OR.uniforms.u_drop_rate_bump=this.dropRateBump,this.rttmesh)this.rttmesh.frustumCulled=!1,this.rttmesh.material=OR,this.rttmesh.material.needsUpdate=!0;else{var e=new vp(2,2);this.rttmesh=new ap(e,OR),this.rttmesh.frustumCulled=!1,this.rttcamera.setOrtho(-1,1,-1,1,.01,100),this.rttscene.add(this.rttmesh)}this.rttscene.updateMatrix(),this.rttscene.updateRenderStates(this.rttcamera),this.rttscene.updateRenderQueue(this.rttcamera),this.renderer.renderPass.setRenderTarget(this.particleStateRT0),this.renderer.renderPass.setClearColor(0,0,0,0),this.renderer.renderPass.clear(!0,!0,!0),this.renderer.renderScene(this.rttscene,this.rttcamera);var t=this.particleStateRT1;this.particleStateRT1=this.particleStateRT0,this.particleStateRT0=t}},{key:"draw",value:function(){this.drawScreen(),this.updateParticles()}},{key:"setWind",value:function(e){this.windData=e,e.data?(this.windTexture=new Bp,this.windTexture.image={data:e.data,width:e.width,height:e.height},this.windTexture.type=jc.UNSIGNED_BYTE,this.windTexture.format=zc.RGBA,this.windTexture.internalformat=null,this.windTexture.generateMipmaps=!1):e.imgUrl&&(this.windTexture=Bp.fromSrc(e.imgUrl),this.windTexture.wrapS=this.windTexture.wrapT=Gc.REPEAT,this.windTexture.generateMipmaps=!1,this.windTexture.flipY=!1),this.windTexture.magFilter=Vc.LINEAR,this.windTexture.minFilter=Vc.LINEAR,this.windTexture.anisotropy=16,this.windTexture.version++}},{key:"setColorRamp",value:function(e){this.colorRampTexture=new Bp,this.colorRampTexture.image={data:kR(e),width:16,height:16},this.colorRampTexture.magFilter=Vc.LINEAR,this.colorRampTexture.minFilter=Vc.LINEAR,this.colorRampTexture.generateMipmaps=!1,this.colorRampTexture.version++}},{key:"resize",value:function(){this.renderTarget=new Em(this.rttResolution,this.rttResolution),this.renderTarget.texture.magFilter=Vc.LINEAR,this.renderTarget.texture.minFilter=Vc.LINEAR,this.renderTarget.texture.generateMipmaps=!1,this.renderTarget.texture.version++,this.renderTarget2=new Em(this.rttResolution,this.rttResolution),this.renderTarget2.texture.magFilter=Vc.LINEAR,this.renderTarget2.texture.minFilter=Vc.LINEAR,this.renderTarget2.texture.generateMipmaps=!1,this.renderTarget2.texture.version++,this.renderTarget3=new Em(this.rttResolution,this.rttResolution),this.renderTarget3.texture.magFilter=Vc.LINEAR,this.renderTarget3.texture.minFilter=Vc.LINEAR,this.renderTarget3.texture.generateMipmaps=!1,this.renderTarget3.texture.version++}},{key:"_getGradientCode",value:function(e){var t="grad:(";for(var r in e)t+=r+":"+e[r]+",";return t+=")"}},{key:"_gradient",value:function(e){if(this._getGradientCode(this._originalGrad)===this._getGradientCode(e)&&null!=this._gradTexture)return this._gradTexture;var t=this._gradCtx.createLinearGradient(0,0,256,0);for(var r in e)t.addColorStop(+r,e[r]);this._gradCtx.fillStyle=t,this._gradCtx.fillRect(0,0,256,1);var n=new Bp;return n.image=this._gradCtx.canvas,n.version++,this._gradTexture=n,n}},{key:"_createCanvas",value:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}]),r}(QE);function UR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var zR=function(e){LP(r,e);var t=UR(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),(e=t.call(this,n.external.uScene))._normalMapUrl=n.external.normalMap,e._maskUrl=n.external.maskMap,e._bgUrl=n.external.backgroundMap,e._flowmapUrl=n.external.flowMap,e._refractUrl=n.external.refractionMap,e._noiseUrl=n.external.noiseMap,e._rampMapUrl=n.external.rampMap,e._time=0,e._render=n.external.render,e.resolution=void 0===n.external.resolution?[1024,1024]:n.external.resolution,e._maskCheck=void 0!==n.external.maskCheck&&n.external.maskCheck,e._mesh=null,e.initTexture(),e.buildNodeMesh(n),e.buffer_texture_setup(),e}return BP(r,[{key:"buildNodeMesh",value:function(e){var t=e.external.cameraPosition||[50,50,50];this._riverGeometry=new _p,e.external.vertexData.index&&this._riverGeometry.setIndex(new up(new cp(e.external.vertexData.position.length/3>65536?new Uint32Array(e.external.vertexData.index):new Uint16Array(e.external.vertexData.index),1)));var r=new cp(new Float32Array(e.external.vertexData.position),3);r.usage=Jc.DYNAMIC_DRAW,this._riverGeometry.addAttribute("a_Position",new up(r,3));var n=new cp(new Float32Array(e.external.vertexData.uv),2);n.usage=Jc.DYNAMIC_DRAW,this._riverGeometry.addAttribute("a_Uv",new up(n,2)),this._riverGeometry.computeBoundingBox(),this._riverGeometry.computeBoundingSphere();var i="\n\t\t\tprecision highp  float;\n\t\t\t#include <common_vert>\n\t\t\t#include <logdepthbuf_pars_vert>\n\n\t\t\tattribute vec2 a_Uv;\n\t\t\tvarying mat4 vmodelMatrix; \n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec3 vPosition;\n\t\t\tuniform float time;\n\t\t\tvarying vec3 vToEye;\n\t\t\tvarying vec3 vToLight;\n\t\t\tvarying vec3 vViewPosition;\n\t\t\tuniform vec3 camPosition;\n\t\t\tuniform vec3 LightPosition;\n\n\n\t\t\tuniform sampler2D texture_flow;\n\t\t\tuniform sampler2D texture_refraction;\n\t\t\tuniform vec2 uv_scale;\n\t\t\tuniform vec2 uv_offset;\n\t\t\tuniform float distance_fade_min;\n\t\t\tuniform float distance_fade_max;\n\n\n\t\t\t// normalMap\n\t\t\tuniform sampler2D texture_normal;\n\t\t\tuniform float normal_scale;\n\t\t\tuniform float flow_normal_influence;\n\n\t\t\t// Displacemap\n\t\t\tuniform sampler2D texture_displace;\n\t\t\tuniform float flow_displace_influence;\n\t\t\tuniform float displace_cycle_speed;\n\t\t\tuniform float displace_speed;\n\t\t\tuniform float displace_scale;\n\t\t\tuniform float displace_offset;\n\n\t\t\t// Flow uniforms\n\t\t\tuniform float blend_cycle;\n\t\t\tuniform float cycle_speed;\n\t\t\tuniform float flow_speed;\n\t\t\tuniform float flow_direction;\n\n\t\t\t//Noise uniforms\n\t\t\tuniform sampler2D texture_flow_noise;\n\t\t\tuniform vec2 flow_noise_size;\n\t\t\tuniform float flow_noise_influence;\n\n\t\t\tvarying vec2 vVel;\n\t\t\tvarying vec2 base_uv;\n\t\t\tvarying vec2 layer1;\n\t\t\tvarying vec2 layer2;\n\t\t\tvarying float  blend_factor;\n\t\t\tvarying float normal_influence;\n\n\t\t\t".concat(tg.gpu_picker_pars_vert,"\n\n\t\t\tvoid main() {\n\n\t\t\t\t").concat(tg.gpu_picker_id_vert,"\n\n\t\t\t\tvUv=a_Uv;\n\t\t\t\tbase_uv = a_Uv * uv_scale.xy + uv_offset.xy;\n\t\t\t\n\t\t\t\t// uv flow  calculation\n\t\t\t\tfloat half_cycle = blend_cycle * 0.5;\n\t\t\t\tfloat offset = texture2D(texture_flow_noise, base_uv * flow_noise_size).x * flow_noise_influence;\n\t\t\t\tfloat phase1 = mod(offset + time * cycle_speed, blend_cycle);\n\t\t\t\tfloat phase2 = mod(offset + time * cycle_speed + half_cycle, blend_cycle);\n\t\t\t\n\t\t\t\tvec2 flow  = texture2D(texture_flow, vUv).rg *2.-1.;\n\t\t\t\tvVel = flow;\n\t\t\t\tfloat flow_strength = dot(abs(flow), vec2(1.0, 1.0)) * 1.;\n\t\t\t\tnormal_influence = mix(1.0, flow_strength, flow_normal_influence);\n\t\t\t\tfloat displace_influence = mix(1.0, flow_strength, flow_displace_influence);\n\n\t\t\t\tblend_factor =abs(half_cycle - phase1)/half_cycle;\n\t\t\t\n\t\t\t\tphase1 -= half_cycle;\n\t\t\t\tphase2 -= half_cycle;\n\t\t\t\n\t\t\t\t// Multiply with scale to make flow speed independent from the uv scaling\n\t\t\t\tvec2 displace_flow = flow * displace_speed * uv_scale;\n\t\t\t\tflow *= flow_direction *flow_speed *0.25;\n\t\t\t\n\t\t\t\tlayer1 = flow * phase1 + base_uv;\n\t\t\t\tlayer2 = flow * phase2 + base_uv;\n\t\t\t\n\t\t\t\t// Use own phases for displacement for better control\n\t\t\t\tfloat disp_phase1 = mod(offset + time * displace_cycle_speed, blend_cycle);\n\t\t\t\tfloat disp_phase2 = mod(offset + time * displace_cycle_speed + half_cycle, blend_cycle);\n\t\t\t\tfloat disp_blend_factor = abs(half_cycle - disp_phase1)/half_cycle;\n\t\t\t\tfloat voffset = mix(texture2D(texture_displace, displace_flow * disp_phase1 + base_uv), texture2D(texture_displace, displace_flow * disp_phase2 + base_uv), disp_blend_factor).x * displace_scale * displace_influence + displace_offset;\n\t\t\t\n\t\t\t\tvPosition = a_Position.xyz;\n\t\t\t\tvec4 worldPosition = u_Model * vec4( a_Position, 1.0 );\n\t\t\t\tvToEye = normalize(camPosition-worldPosition.xyz );\n\t\t\t\tvec4 mvPosition = u_View * u_Model * vec4(a_Position, 1.0);\n\t\t\t\tvmodelMatrix = u_Model;\n\t\t\t\tgl_Position = u_Projection * mvPosition;\n\t\t\t\tfloat  mask = texture2D(texture_displace,vUv).x;\n\t\t\t\tgl_Position.y += voffset*0.05;\n\n\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t\n\t\t\t}\n\t\t"),a="\n\t\t\tprecision highp  float;\n\t\t\t#include <common_frag>\n\t\t\t#include <logdepthbuf_pars_frag>\n\t\t\t#include <dithering_pars_frag>\n\t\t\t\n\t\t\t#ifdef GL_OES_standard_derivatives\n\t\t\t\t#extension GL_OES_standard_derivatives : enable\n\t\t\t#endif\n\t\t\t#include <packing>\n\n\t\t\tuniform samplerCube envMap;\n\t\t\tuniform sampler2D tRefractionMap;\n\t\t\tuniform sampler2D texture_image;\n\t\t\tuniform sampler2D depthTexture;\n\t\t\tuniform sampler2D texture_flow;\n\t\t\tuniform sampler2D texture_refraction;\n\t\t\tuniform sampler2D texture_normal;\n\t\t\tuniform sampler2D texture_displace;\n\t\t\tuniform sampler2D texture_flow_noise;\n\t\t\tuniform sampler2D rttTexture;\n\t\t\tuniform sampler2D rampTexture;\n\n\t\t\tuniform float time;\n\t\t\tuniform vec2 refractionMapSize;\n\t\t\tuniform float specular_intensity;\n\t\t\tuniform vec2 uv_scale;\n\t\t\tuniform vec2 uv_offset;\n\t\t\tuniform float distance_fade_min;\n\t\t\tuniform float distance_fade_max;\n\t\t\tuniform vec3 lightColor;\n\t\t\t\n\t\t\t// normalMap\n\t\t\tuniform float normal_scale;\n\t\t\tuniform float flow_normal_influence;\n\t\t\t\n\t\t\t// Displacemap\n\t\t\tuniform float displace_scale;\n\t\t\tuniform vec3 basecolor;\n\t\t\tuniform bool arrowCheck;\n\t\t\tuniform bool maskCheck;\n\t\t\t\n\t\t\t// Flow uniforms\n\t\t\tuniform float blend_cycle;\n\t\t\tuniform float cycle_speed;\n\t\t\tuniform float flow_speed;\n\t\t\tuniform vec2 flow_noise_size;\n\t\t\tuniform float flow_noise_influence;\n\t\t\tuniform float flow_direction;\n\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec2 vVel;\n\t\t\tvarying vec3 vPosition;\n\t\t\tvarying vec3 vToEye;\n\t\t\tvarying vec3 vToLight;\n\t\t\tvarying vec2 base_uv;\n\t\t\tvarying vec2 layer1;\n\t\t\tvarying vec2 layer2;\n\t\t\tvarying float blend_factor;\n\t\t\tvarying float normal_influence;\n\t\t\tvarying vec3 vViewPosition;\n\t\t\tvarying mat4 vmodelMatrix; \n\t\t\t\n\t\t\t".concat(tg.gpu_picker_pars_frag,"\n\n\t\t\tvoid main() {\n\t\t\t\t#include <logdepthbuf_frag>\n\n\t\t\t\t// normalMap\n\t\t\t\tvec3 normalMap = mix(texture2D(texture_normal, layer1), texture2D(texture_normal, layer2), blend_factor).rgb;\n\t\t\t\n\t\t\t\t//  calculate normal vector  TBN * normalMap;// \n\t\t\t\tvec3 ref_normal = normalize( vec3( normalMap.r * 2.0 - 1.0,  1.*normalMap.b,  normalMap.g * 2.0 - 1.0 ) );\n\t\t\t\n\t\t\t\t// calculate the fresnel term to blend reflection and refraction maps\n\t\t\t\tvec3 vToEyeWord =  normalize( ( vec4( vToEye, 0.0 )).xyz );\n\t\t\t\tfloat theta = max( dot( normalize(vToEyeWord), normalize(ref_normal)), 0.0 ); \n\t\t\t\tfloat reflectance = pow(theta,2.);\n\t\t\t\n\t\t\t\t// view space\n\t\t\t\tvec3 reflectVec = reflect(normalize(vToEye), normalize((vec4(ref_normal,0.)*vmodelMatrix ).xyz));\n\t\t\t\tvec4 reflectColor = textureCube(envMap, vec3(reflectVec.x, reflectVec.yz ));\n\t\t\t\tvec4 refractColor = texture2D(texture_refraction, vUv * refractionMapSize );\n\t\t\t\t\n\t\t\t\t// view space\n\t\t\t\tfloat foobar = max(dot(reflectVec, normalize( ( vec4( vToEye, 0.0 )  ).xyz )),0.);\n\t\t\t\tvec3 specularColor = lightColor *  pow(foobar, specular_intensity);\n\n\t\t\t\t// multiply water color with the mix of both textures\n\t\t\t\tfloat mask = texture2D(texture_displace,vUv).x;\n\t\t\t\tvec4 reflect_refract_color = mix( reflectColor, refractColor, reflectance );\n\t\t\t\n\t\t\t\t// float ALPHA = 1.0;\n\t\t\t\t// ALPHA *= clamp(smoothstep(distance_fade_min,distance_fade_max,-vPosition.z), 0.0, 1.0);\n\t\t\t\t// float depth = 1.- readDepth( depthTexture, vUv );\n\t\t\t\n\t\t\t\tvec2 flow  = texture2D(texture_flow, vUv).rg *2.-1.;\n\t\t\t\tflow *= flow_direction;\n\t\t\t\n\t\t\t\tfloat dyeValue = texture2D(rttTexture,vUv).r;\n\t\t\t\tvec4 finalColor2 =mix(reflect_refract_color, vec4(basecolor,1.),0.2) + vec4(specularColor,0.);\n\t\t\t\t\n\t\t\t\t//use mask\n\t\t\t\tif(maskCheck)\n\t\t\t\t{ \n\t\t\t\t\tgl_FragColor= mask<0.5 ? (dyeValue>0.000? mix(texture2D(rampTexture,vec2(dyeValue,0.5)),finalColor2,0.6):finalColor2):texture2D(texture_image,vUv)*0.85;\n\t\t\t\t}\n\t\t\t\telse\t//no mask \n\t\t\t\t{\n\t\t\t\t\t// gl_FragColor= dyeValue>0.000? mix(texture2D(rampTexture,vec2(dyeValue,0.5)),finalColor2,0.6):finalColor2;\n\t\t\t\t\tgl_FragColor=  mix(texture2D(rampTexture,vec2(dyeValue,0.5)),finalColor2,0.6);\n\t\t\t\t}\n\t\t\t\t").concat(tg.gpu_picker_id_frag,"\n\t\t\t}\n\t\t"),s={time:0,refractionMapSize:[1,1],tReflectionMap:null,tRefractionMap:null,camPosition:[t[0],t[1],t[2]],LightPosition:[1,1,1],basecolor:[.1,.8,1],lightColor:[1,1,1],texture_image:null,texture_flow:null,specular_intensity:20,depthTexture:null,texture_refraction:null,uv_scale:[16,16],uv_offset:[0,0],distance_fade_min:0,distance_fade_max:1,texture_normal:null,normal_scale:.2,flow_normal_influence:.5,blend_cycle:4,cycle_speed:2,flow_speed:.4,flow_direction:1,texture_flow_noise:null,flow_noise_size:[1,1],flow_noise_influence:.25,texture_displace:null,displace_scale:1.5,displace_speed:.01,arrowCheck:!1,maskCheck:this._maskCheck,rttTexture:null,rampTexture:null},o=new bp({uniforms:s,vertexShader:i,fragmentShader:a});o.type="WaterMaterial";var l=new ap(this._riverGeometry,o);o.depthTest=!1,this._node.add(l),this._mesh=l}},{key:"buffer_texture_setup",value:function(){this.RTTcamera=new Bd,this.RTTcamera.position.set(0,1,0),this.RTTcamera.updateMatrix(),this.RTTcamera.lookAt(new bc(0,0,0),new bc(0,0,-1)),this.RTTcamera.setOrtho(-1,1,-1,1,.01,1e3),this.bufferScene=new Nd,this.bufferScene.add(this.RTTcamera),this.RenderTargetA=new Em(this.resolution[0],this.resolution[1]),this.RenderTargetB=new Em(this.resolution[0],this.resolution[1]),this.RenderTargetA.texture.minFilter=Vc.LINEAR,this.RenderTargetA.texture.magFilter=Vc.LINEAR,this.RenderTargetB.texture.minFilter=Vc.LINEAR,this.RenderTargetB.texture.magFilter=Vc.LINEAR;var e=new bp({uniforms:{bufferTexture:null,velTexture:null,resolution:[this.resolution[0],this.resolution[1]],flow_direction:1,flow_speed:.4,maskTexture:null,dyeSource:[0,0,0]},vertexShader:"\n\t\t\tattribute vec3 a_Position;\n\t\t\tattribute vec2 a_Uv;\t\t\t\n\t\t\tuniform mat4 u_ProjectionView;\n\t\t\tuniform mat4 u_Model;\n\t\t\tvarying vec2 v_Uv;\n\n\t\t\tvoid main() {\n\t\t\t\tv_Uv = a_Uv;\n\t\t\t\tgl_Position = u_ProjectionView * u_Model * vec4(a_Position, 1.0);\n\t\t\t}\n\t\t",fragmentShader:"\n\t\t\tvarying vec2 v_Uv;\n\t\t\tuniform vec2 resolution;//The resolution of river size\n\t\t\tuniform sampler2D bufferTexture;//Our input texture\n\t\t\tuniform sampler2D velTexture;// vel texture\n\t\t\tuniform sampler2D maskTexture;\n\t\t\tuniform vec3 dyeSource;//The x,y are the posiiton uv. The z is the density \n\t\t\tuniform float flow_direction;\n\t\t\tuniform float flow_speed;\n\t\t\tconst float dt =0.02;\n\t\t\tvoid main() {\n\t\t\t\tvec2 uv = v_Uv;\n\t\t\t\tvec2 vel = texture2D(velTexture,uv).rg*2.-vec2(1.);\n\t\t\t\tvel *= -flow_direction*0.1* flow_speed;// the dye flow dir is opposite to the river. why??\n\t\t\t\tgl_FragColor = texture2D( bufferTexture, uv-vel*dt );\n\n\t\t\t\t//Get the distance of the current uv from the dye source\n\t\t\t\tfloat dist = distance(dyeSource.xy,v_Uv);\n\t\t\t\tgl_FragColor.r += 1.*dyeSource.z * max(0.02-dist,0.0);\n\n\t\t\t\t//dye diffuse\n\t\t\t\tfloat xPixel = 1.0/resolution.x;//The size of a single uv\n\t\t\t\tfloat yPixel = 1.0/resolution.y;\n\n\t\t\t\tvec4 rightColor = texture2D(bufferTexture, vec2(uv.x+xPixel,uv.y)-vel*dt);\n\t\t\t\tvec4 leftColor = texture2D(bufferTexture, vec2(uv.x-xPixel,uv.y)-vel*dt);\n\t\t\t\tvec4 upColor = texture2D(bufferTexture, vec2(uv.x,uv.y+yPixel)-vel*dt);\n\t\t\t\tvec4 downColor = texture2D(bufferTexture, vec2(uv.x,uv.y-yPixel)-vel*dt);\n\n\t\t\t\tfloat factor = 8.0 * dt * (leftColor.r + rightColor.r + downColor.r  + upColor.r - 4.0 * gl_FragColor.r);\n\t\t\t\t//Account for low precision of texels\n\t\t\t\tfloat minimum = 0.003;\n\t\t\t\tif(factor >= -minimum && factor < 0.0) factor = -minimum;\n\n\t\t\t\tgl_FragColor.r += factor;\n\n\t\t\t\t//add mask filter\n\t\t\t\tfloat mask = (texture2D(maskTexture, uv).r);\n\t\t\t\tgl_FragColor.r = mask >0.5 ? 0. : gl_FragColor.r;\n\t\t\t\tgl_FragColor.a=1.;\n\t\t}"}),t=new vp(2,2,1,1);this._bufferMesh=new ap(t,e),this.bufferScene.add(this._bufferMesh)}},{key:"setBufferUniform",value:function(){this._bufferMesh.material.uniforms.velTexture=this._mesh.material.uniforms.texture_flow,this._bufferMesh.material.uniforms.maskTexture=this._mesh.material.uniforms.texture_displace,this._bufferMesh.material.uniforms.flow_speed=this._mesh.material.uniforms.flow_speed}},{key:"updateBuffertexture",value:function(){if(this.bufferScene){this.bufferScene.updateMatrix(),this.bufferScene.updateRenderStates(this.RTTcamera),this.bufferScene.updateRenderQueue(this.RTTcamera),this._render.renderPass.setRenderTarget(this.RenderTargetB),this._render.renderPass.setClearColor(0,0,0,0),this._render.renderPass.clear(!0,!0,!0),this._render.renderScene(this.bufferScene,this.RTTcamera);var e=this.RenderTargetA;this.RenderTargetA=this.RenderTargetB,this.RenderTargetB=e,this._mesh.material.uniforms.rttTexture=this.RenderTargetA.texture,this._mesh.material.needsUpdate=!0,this._bufferMesh&&(this._bufferMesh.material.uniforms.bufferTexture=this.RenderTargetA.texture,this._bufferMesh.material.needsUpdate=!0)}this.setBufferUniform()}},{key:"initTexture",value:function(){this._maskUrl&&this.setMaskMap(this._maskUrl),this._bgUrl&&this.setBackgroundMap(this._bgUrl),this._normalMapUrl&&this.setNormalMap(this._normalMapUrl),this._flowmapUrl&&this.setFlowMap(this._flowmapUrl),this._noiseUrl&&this.setNoiseMap(this._noiseUrl),this._refractUrl&&this.setRefractMap(this._refractUrl),this._rampMapUrl&&this.setRampMap(this._rampMapUrl)}},{key:"setRampMap",value:function(e){var t=this;(new yh).load(e,(function(e){t._mesh.material.uniforms.rampTexture=new Bp,t._mesh.material.uniforms.rampTexture.image=e,t._mesh.material.uniforms.rampTexture.wrapS=t._mesh.material.uniforms.rampTexture.wrapT=Gc.CLAMP_TO_EDGE,t._mesh.material.uniforms.rampTexture.version++}))}},{key:"setNormalMap",value:function(e){var t=this;(new yh).load(e,(function(e){t._mesh.material.uniforms.texture_normal=new Bp,t._mesh.material.uniforms.texture_normal.image=e,t._mesh.material.uniforms.texture_normal.wrapS=t._mesh.material.uniforms.texture_normal.wrapT=Gc.REPEAT,t._mesh.material.uniforms.texture_normal.version++}))}},{key:"setMaskMap",value:function(e){var t=this;(new yh).load(e,(function(e){t._mesh.material.uniforms.texture_displace=new Bp,t._mesh.material.uniforms.texture_displace.image=e,t._mesh.material.uniforms.texture_displace.wrapS=t._mesh.material.uniforms.texture_displace.wrapT=Gc.CLAMP_TO_EDGE,t._mesh.material.uniforms.texture_displace.version++}))}},{key:"setBackgroundMap",value:function(e){var t=this;(new yh).load(e,(function(e){t._mesh.material.uniforms.texture_image=new Bp,t._mesh.material.uniforms.texture_image.image=e,t._mesh.material.uniforms.texture_image.wrapS=t._mesh.material.uniforms.texture_image.wrapT=Gc.REPEAT,t._mesh.material.uniforms.texture_image.version++}))}},{key:"setFlowMap",value:function(e){var t=this;(new yh).load(e,(function(e){t._mesh.material.uniforms.texture_flow=new Bp,t._mesh.material.uniforms.texture_flow.image=e,t._mesh.material.uniforms.texture_flow.wrapS=t._mesh.material.uniforms.texture_flow.wrapT=Gc.CLAMP_TO_EDGE,t._mesh.material.uniforms.texture_flow.version++}))}},{key:"setNoiseMap",value:function(e){var t=this;(new yh).load(e,(function(e){t._mesh.material.uniforms.texture_flow_noise=new Bp,t._mesh.material.uniforms.texture_flow_noise.image=e,t._mesh.material.uniforms.texture_flow_noise.wrapS=t._mesh.material.uniforms.texture_flow_noise.wrapT=Gc.REPEAT,t._mesh.material.uniforms.texture_flow_noise.version++}))}},{key:"setRefractMap",value:function(e){var t=this;(new yh).load(e,(function(e){t._mesh.material.uniforms.texture_refraction=new Bp,t._mesh.material.uniforms.texture_refraction.image=e,t._mesh.material.uniforms.texture_refraction.wrapS=t._mesh.material.uniforms.texture_refraction.wrapT=Gc.REPEAT,t._mesh.material.uniforms.texture_refraction.version++}))}},{key:"update",value:function(e){this._time+=e,this._mesh.material.uniforms.time=this._time}},{key:"setCameraPosition",value:function(e){this._mesh.material.uniforms.camPosition=e}},{key:"basecolor",get:function(){return this._mesh.material.uniforms.basecolor},set:function(e){this._mesh.material.uniforms.basecolor=e}},{key:"setDyeSource",value:function(e){this._bufferMesh.material.uniforms.dyeSource=e}},{key:"changeFlowDir",value:function(){this._mesh.material.uniforms.flow_direction*=-1,this._bufferMesh.material.uniforms.flow_direction=this._mesh.material.uniforms.flow_direction}},{key:"changeFlowSpeed",value:function(e){this._bufferMesh.material.uniforms.flow_speed=this._mesh.material.uniforms.flow_speed=e}},{key:"swapRendertype",value:function(){this._mesh.material.uniforms.arrowCheck=!this._mesh.material.uniforms.arrowCheck}},{key:"refractionMapSize",get:function(){return this._mesh.material.uniforms.refractionMapSize},set:function(e){return this._mesh.material.uniforms.refractionMapSize=e}},{key:"dispose",value:function(){this.RenderTargetA.dispose(),this.RenderTargetB.dispose(),this._mesh.material.uniforms.texture_refraction.dispose(),this._mesh.material.uniforms.texture_flow_noise.dispose(),this._mesh.material.uniforms.texture_flow.dispose(),this._mesh.material.uniforms.texture_image.dispose(),this._mesh.material.uniforms.texture_normal.dispose(),this._mesh.material.uniforms.rampTexture.dispose(),this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._bufferMesh.material.dispose(),this._bufferMesh.geometry.dispose(),OP(IP(r.prototype),"dispose",this).call(this)}}]),r}(QE);function jR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var VR={uniforms:{opacity:1,map:null,time:0,alpha:0,repeatFactor:[1,1],maskMap:null,glowFactor:1,speed:1,flowColor:[1,1,1]},vertexShader:"\n\t    attribute vec2 a_Uv;\n\t\tattribute vec3 a_Position;\n\n\t\tuniform mat4 u_ProjectionView;\n\t\tuniform mat4 u_Model;\n\t\tuniform vec2 repeatFactor;\n\t\t\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 mapUv;\n\n\t\tvoid main() {\n\t\tgl_Position = u_ProjectionView * u_Model * vec4(a_Position,1.);\n\n\t\tvUv=a_Uv;\n\t\tmapUv=a_Uv*repeatFactor;\n\t\t}\n    ",fragmentShader:"\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 mapUv;  \n\t\tuniform sampler2D map; \n\t\tuniform sampler2D maskMap; \n\t\tuniform float time; \n\t\tuniform float alpha;\n\t\tuniform vec3 u_Color;\n\t\tuniform vec3 flowColor; \n\t\tuniform float glowFactor; \n\t\tuniform float speed;  \n\t\tvoid main() {\t \n\t\t\tfloat t=mod(time/5.*speed,1.);       \n\t\t\tvec2 uv=abs((vUv-vec2(0.5))*2.0); \n\t\t\tfloat dis = length(uv); \n\t\t\tfloat r = t-dis;  \n\t\t\tvec4 col=texture2D( map, mapUv ); \n\t\t\tvec3 finalCol; \n\t\t\tvec4 mask = texture2D(maskMap, vec2(0.5,r)); \n\t\t\tfinalCol = mix(u_Color,flowColor,clamp(0.,1.,mask.a*glowFactor)); \n\t\t\tgl_FragColor= vec4(finalCol.rgb,col.a*(1.-dis)*(alpha+mask.a*glowFactor));\n\t\t}\n    "},GR=function(e){LP(r,e);var t=jR(r);function r(){var e;return PP(this,r),(e=t.call(this,{type:"EffectGround",defines:{},uniforms:VR.uniforms,vertexShader:VR.vertexShader,fragmentShader:VR.fragmentShader})).transparent=!0,e.depthTest=!0,e.depthWrite=!1,e.roughness=1,e}return BP(r)}(bp);function WR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var HR={defines:{USE_GBUFFER:!1,G_USE_ROUGHNESSMAP:!1},uniforms:{color:[1,1,1],roughness:.5,roughnessMap:null,opacity:1},vertexShader:"\n\t\t#include <common_vert>\n\t\t#include <morphtarget_pars_vert>\n\t\t#include <skinning_pars_vert>\n\t\t#include <normal_pars_vert>\n\t\t#include <uv_pars_vert>\n\t\t#include <modelPos_pars_vert>\n\t\t#include <logdepthbuf_pars_vert>\n\t\tvoid main() {\n\t\t\t#include <uv_vert>\n\t\t\t#include <begin_vert>\n\t\t\t#include <morphtarget_vert>\n\t\t\t#include <morphnormal_vert>\n\t\t\t#include <skinning_vert>\n\t\t\t#include <skinnormal_vert>\n\t\t\t#include <normal_vert>\n\t\t\t#include <pvm_vert>\n\t\t\t#include <logdepthbuf_vert>\n\t\t\t#include <modelPos_vert>\n\t\t}\n    ",fragmentShader:"\n\t\t#include <common_frag>\n\t\t#include <diffuseMap_pars_frag>\n\n\t\t#include <modelPos_pars_frag>\n\n\t\t#include <uv_pars_frag>\n\n\t\t#include <packing>\n\t\t#include <normal_pars_frag>\n\n\t\tuniform float roughness;\n\n\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\tuniform sampler2D roughnessMap;\n\t\t#endif\n\n\t\t#include <logdepthbuf_pars_frag>\n\n\t\t#include <clippingPlanes_pars_frag>\n\n\t\tvoid main() {\t\n\t\t\t#ifdef USE_GBUFFER\n\t\t\t\t#include <clippingPlanes_frag>\n\n\t\t\t\t#if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n\t\t\t\t\tvec4 texelColor = texture2D(diffuseMap, v_Uv);\n\t\t\t\t\tfloat alpha = texelColor.a * u_Opacity;\n\t\t\t\t\tif(alpha < ALPHATEST) discard;\n\t\t\t\t#endif\n\t\n\t\t\t\t#include <logdepthbuf_frag>\n\t\n\t\t\t\tvec3 normal = normalize(v_Normal);\n\t\n\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\t\t#endif \n\t\n\t\t\t\tfloat roughnessFactor = 0.1;\n\t\t\t\t#ifdef USE_ROUGHNESSMAP\n\t\t\t\t\troughnessFactor *= texture2D(roughnessMap, v_Uv).g;\n\t\t\t\t#endif\n\t\n\t\t\t\tvec4 packedNormalGlossiness;\n\t\t\t\tpackedNormalGlossiness.xyz = normal * 0.5 + 0.5;\n\t\t\t\tpackedNormalGlossiness.w = clamp(1. - roughnessFactor, 0., 1.);\n\t\t\t\t\n\t\t\t\tgl_FragColor = packedNormalGlossiness;\n\t\t\t#else\n\n\t\t\t\tgl_FragColor= vec4(1.,1.,1.,0.);\n\n\t\t\t#endif\n\n\t\t}\n    "},qR=function(e){LP(r,e);var t=WR(r);function r(){var e;return PP(this,r),(e=t.call(this,{type:"ReflectionGround",defines:HR.defines,uniforms:HR.uniforms,vertexShader:HR.vertexShader,fragmentShader:HR.fragmentShader})).transparent=!0,e.depthTest=!0,e.depthWrite=!0,e.color=[1,1,1],e.roughness=.1,e}return BP(r,[{key:"color",get:function(){return this.uniforms.color},set:function(e){this.uniforms&&(this.uniforms.color=e)}},{key:"opacity",get:function(){return this.uniforms.opacity},set:function(e){this.uniforms&&(this.uniforms.opacity=e)}}]),r}(bp);function XR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var QR=new DP,KR=function(e){LP(r,e);var t=XR(r);function r(){var e,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),(e=t.call(this,i.external.uScene))._app=THING.App.current,e._groundReflect=i.external.param.groundReflect||!1,e._groundClearance=void 0===i.external.param.groundClearance?.1:i.external.param.groundClearance,e._sizeFactor=void 0===i.external.param.sizeFactor?2:i.external.param.sizeFactor,e._groundReflect?n=new qR:(n=new GR,e._initEffectParameter(i.external.param),n.diffuse.fromArray(e._colorValue),n.opacity=e._opacity,n.diffuseMap=e._map);var a=new ap(new vp(1,1),n);e._node.add(a);var s=UP(e),o=i.external.param.groundReflect?null:a.addBeforeRenderFunction((function(e,t){t.uniforms.map=t.diffuseMap,t.uniforms.maskMap=s._maskMap,t.uniforms.color=t.diffuse.toArray(),t.uniforms.flowColor=s._flowColorValue,t.uniforms.alpha=t.opacity,t.uniforms.repeatFactor=[s._repeatFactorX,s._repeatFactorY],t.uniforms.glowFactor=s._glowFactor,t.uniforms.speed=s._speed,t.uniforms.time=s._time}),"effectGroundObject-uniform-binding");return e.$markChildrenMatrixAutoUpdate(!1),e._binding=o,e._mesh=a,e}return BP(r,[{key:"_initEffectParameter",value:function(e){this._url=e.url||"",this._maskUrl=e.maskUrl||"",this._map=this._url?QR.load(this._url):null,this._map.wrapS=this._map.wrapT=Gc.REPEAT,this._maskMap=this._maskUrl?QR.load(this._maskUrl):null,this._maskMap.wrapS=this._maskMap.wrapT=Gc.REPEAT,this._opacity=void 0===e.opacity?0:e.opacity,this._glowFactor=void 0===e.glowFactor?1:e.glowFactor,this._colorValue=e.color?e.color:[1,1,1],this._time=0,this._speed=void 0===e.animationSpeed?1:e.animationSpeed,this._flowColorValue=e.flowColor?e.flowColor:[1,1,1],this._animationType=e.animationType||"flow",this._repeatFactor=void 0===e.repeatFactor?1:e.repeatFactor,this._repeatFactorX=void 0===e.repeatFactorX?this._repeatFactor:e.repeatFactorX,this._repeatFactorY=void 0===e.repeatFactorY?this._repeatFactor:e.repeatFactorY}},{key:"getType",value:function(){return"EffectGroundObject"}},{key:"groundReflect",get:function(){return this._groundReflect},set:function(e){this._groundReflect=e,this._groundReflect?this._mesh.material.roughness=.1:this._mesh.material.roughness=1}},{key:"sizeFactor",get:function(){return this._sizeFactor},set:function(e){this._sizeFactor=e}},{key:"imageUrl",get:function(){return this._url},set:function(e){this._url=e;var t=QR.load(this._url);t.wrapS=t.wrapT=Gc.REPEAT,this._map=t,this._mesh.material.diffuseMap=t}},{key:"maskUrl",get:function(){return this._maskUrl},set:function(e){this._maskUrl=e;var t=QR.load(this._maskUrl);t.wrapS=t.wrapT=Gc.REPEAT,this._maskMap=t,this._mesh.material.uniforms.maskMap=t}},{key:"opacityValue",get:function(){return this._mesh.material.opacity},set:function(e){this._opacity=e,this._mesh.material.opacity=e}},{key:"glowFactorValue",get:function(){return this._glowFactor},set:function(e){this._glowFactor=e,this._mesh.material.uniforms.glowFactor=this._glowFactor}},{key:"repeatFactorValue",get:function(){return this._repeatFactor},set:function(e){this._repeatFactor=e,this._repeatFactorX=e,this._repeatFactorY=e,this._mesh.material.uniforms.repeatFactor=[this._repeatFactor,this._repeatFactor]}},{key:"repeatFactorValueX",get:function(){return this._repeatFactorX},set:function(e){this._repeatFactorX=e,this._mesh.material.uniforms.repeatFactor=[e,this._repeatFactorY]}},{key:"repeatFactorValueY",get:function(){return this._repeatFactorY},set:function(e){this._repeatFactorY=e,this._mesh.material.uniforms.repeatFactor=[this._repeatFactorX,e]}},{key:"groundColorValue",get:function(){return this._colorValue},set:function(e){this._mesh&&(this._colorValue=e,this._mesh.material.diffuse.fromArray(this._colorValue))}},{key:"flowColorValue",get:function(){return this._flowColorValue},set:function(e){this._mesh&&(this._flowColorValue=e,this._mesh.material.uniforms.flowColor=this._flowColorValue)}},{key:"animationSpeed",get:function(){return this._speed},set:function(e){this._speed=e,this._mesh.material.uniforms.speed=this._speed}},{key:"groundClearance",get:function(){return this._groundClearance},set:function(e){this._groundClearance=e}},{key:"update",value:function(e){this._time+=e}},{key:"dispose",value:function(){this._binding&&this._mesh.removeBeforeRenderFunction(this._binding),this._binding=null,this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,OP(IP(r.prototype),"dispose",this).call(this),this._app=null}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this._app=e._app,this._url=e._url,this._maskUrl=e._maskUrl,this._opacity=e._opacity,this._repeatFactor=e._repeatFactor,this._repeatFactorX=e._repeatFactorX,this._repeatFactorY=e._repeatFactorY,this._glowFactor=e._glowFactor,this._colorValue=e._colorValue,this._time=e._time,this._sizeFactor=e._sizeFactor,this._speed=e._speed,this._flowColorValue=e._flowColorValue,this._groundReflect=e._groundReflect,this._groundClearance=e._groundClearance,this._animationType=e._animationType,this._repeatFactor=e._repeatFactor,this}}]),r}(QE);function YR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var ZR={uniforms:{map:null,center:null,color:null,opacity:1,keepSize:!1,screenHeightPercentage:.1},vertexShader:"\n        #define PI 3.141592653589793\n        uniform vec2 center;\n        uniform bool keepSize; \n        uniform float screenHeightPercentage;\n\n        attribute vec2 a_Uv;\n        varying vec2 v_Uv;\n\n        attribute vec3 a_InstancePosition;\n        attribute float a_InstanceRotation;\n        attribute vec2 a_InstanceScale;\n\n        attribute vec2 a_InstanceUvOffset;\n        attribute vec2 a_InstanceUvRepeat;\n\n        attribute float a_InstanceVisible;\n        attribute vec3 a_InstanceColor;\n        varying float v_Visible;\n        varying vec3 v_SpritesColor;\n\n        mat4 compose(vec3 position, vec4 quaternion, vec3 scale) {\n            float x = quaternion.x, y = quaternion.y, z = quaternion.z, w = quaternion.w;\n            float x2 = x + x,  y2 = y + y,  z2 = z + z;\n            float xx = x * x2, xy = x * y2, xz = x * z2;\n            float yy = y * y2, yz = y * z2, zz = z * z2;\n            float wx = w * x2, wy = w * y2, wz = w * z2;\n\n            float sx = scale.x, sy = scale.y, sz = scale.z;\n\n            return mat4(( 1. - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.,\n                ( xy - wz ) * sy, ( 1. - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.,\n                ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1. - ( xx + yy ) ) * sz, 0.,\n                position.x, position.y, position.z, 1.);\n        }\n\n        mat3 setUvTransform(vec2 offset,vec2 repeat,float rotation,vec2 center){\n        float c = cos( rotation );\n        float s = sin( rotation );\n        float tx = offset.x, ty = offset.y, sx = repeat.x, sy = repeat.y, cx = center.x, cy = center.y;\n        return mat3(\n            sx * c, - sy * s, 0.,\n            sx * s, sy * c, 1.,\n            - sx * ( c * cx + s * cy ) + cx + tx, - sy * ( - s * cx + c * cy ) + cy + ty, 1.\n        );\n        }\n\n        #include <common_vert>\n        void main() {\n\n            v_Visible = a_InstanceVisible;\n            v_SpritesColor = a_InstanceColor;\n\n            v_Uv = ( setUvTransform(a_InstanceUvOffset,a_InstanceUvRepeat,0.,vec2(0.)) * vec3(a_Uv.xy, 1.) ).xy;\n            mat4 spritesMatrix = compose(a_InstancePosition, vec4(0.), vec3(a_InstanceScale,1.));\n            float rotation = a_InstanceRotation/180.*PI;\n\n            vec4 mvPosition = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n            mvPosition = u_View * u_Model * spritesMatrix * mvPosition;\n\n            vec2 scale;\n            scale.x = length( vec3( spritesMatrix[ 0 ].x, spritesMatrix[ 0 ].y, spritesMatrix[ 0 ].z ) );\n            scale.y = length( vec3( spritesMatrix[ 1 ].x, spritesMatrix[ 1 ].y, spritesMatrix[ 1 ].z ) );\n\n            if(keepSize){\n            bool isPerspective = isPerspectiveMatrix( u_Projection );\n            if ( isPerspective ) {\n                scale *= - mvPosition.z * 2. / u_Projection[1][1] * screenHeightPercentage;\n            }\n            }\n\n            vec2 alignedPosition = ( a_Position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = u_Projection * mvPosition;\n\n        }\n    ",fragmentShader:"\n        uniform vec3 color;\n        uniform float opacity;\n\n        varying vec2 v_Uv;\n        uniform sampler2D map;\n        varying float v_Visible;\n        varying vec3 v_SpritesColor;\n\n        void main() {\n\n            vec3 outgoingLight = vec3( 0.0 );\n            vec4 diffuseColor = vec4( color, opacity );\n\n            vec4 texelColor = texture2D( map, v_Uv );\n\n            texelColor = mapTexelToLinear( texelColor );\n            diffuseColor *= texelColor;\n\n            outgoingLight = diffuseColor.rgb*v_SpritesColor;\n            gl_FragColor = vec4( outgoingLight, v_Visible*diffuseColor.a );\n\n            gl_FragColor = linearToOutputTexel( gl_FragColor );\n\n        }\n    "},JR=function(e){LP(r,e);var t=YR(r);function r(){var e;return PP(this,r),(e=t.call(this,{name:"SpritesMaterial",defines:{},uniforms:ZR.uniforms,vertexShader:ZR.vertexShader,fragmentShader:ZR.fragmentShader})).transparent=!0,e.color=[1,1,1],e}return BP(r,[{key:"color",get:function(){return this.uniforms.color},set:function(e){this.uniforms&&(this.uniforms.color=e)}},{key:"opacity",get:function(){return this.uniforms.opacity},set:function(e){this.uniforms&&(this.uniforms.opacity=e)}},{key:"diffuseMap",get:function(){return this.uniforms.map},set:function(e){this.uniforms.map=e}},{key:"center",get:function(){return this.uniforms.center},set:function(e){this.uniforms.center=e}},{key:"keepSize",get:function(){if(this.uniforms)return this.uniforms.keepSize},set:function(e){this.uniforms&&(this.uniforms.keepSize=e)}},{key:"screenHeightPercentage",get:function(){if(this.uniforms)return this.uniforms.screenHeightPercentage},set:function(e){this.uniforms&&(0===e&&console.warn("screenHeightPercentage can not be zero! It will make Sprites invisible "),this.uniforms.screenHeightPercentage=e)}}]),r}(bp);function $R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var eN=function(e){LP(r,e);var t=$R(r);function r(e){var n;return PP(this,r),(n=t.call(this)).type="SpritesGeometry",n.instanceCount=(null==e?void 0:e.instanceCount)||1,n.maxCount=(null==e?void 0:e.maxCount)||100,n.instancePosition=new up(new cp(new Float32Array(3*n.maxCount),3)),n.addAttribute("a_InstancePosition",n.instancePosition),n.instancePosition.divisor=1,n.instanceRotation=new up(new cp(new Float32Array(n.maxCount),1)),n.addAttribute("a_InstanceRotation",n.instanceRotation),n.instanceRotation.divisor=1,n.instanceScale=new up(new cp(new Float32Array(2*n.maxCount),2)),n.setScales([1,1]),n.addAttribute("a_InstanceScale",n.instanceScale),n.instanceScale.divisor=1,n.instanceUvOffset=new up(new cp(new Float32Array(2*n.maxCount),2)),n.addAttribute("a_InstanceUvOffset",n.instanceUvOffset),n.instanceUvOffset.divisor=1,n.instanceUvRepeat=new up(new cp(new Float32Array(2*n.maxCount),2)),n.setUvRepeats([1,1]),n.addAttribute("a_InstanceUvRepeat",n.instanceUvRepeat),n.instanceUvRepeat.divisor=1,n.instanceColor=new up(new cp(new Float32Array(3*n.maxCount),3)),n.setColors([1,1,1]),n.addAttribute("a_InstanceColor",n.instanceColor),n.instanceColor.divisor=1,n.instanceVisible=new up(new cp(new Float32Array(n.maxCount),1)),n.setVisibles(!0),n.addAttribute("a_InstanceVisible",n.instanceVisible),n.instanceVisible.divisor=1,n._initParameters(),n}return BP(r,[{key:"_initParameters",value:function(){var e,t,r=[],n=[],i=[],a=[];for(t=0;t<2;t++){var s=1*t-.5;for(e=0;e<2;e++){var o=1*e-.5;n.push(o,-s,0),i.push(0,0,1),a.push(e/1),a.push(1-t/1)}}for(t=0;t<1;t++)for(e=0;e<1;e++){var l=e+2*t,u=e+2*(t+1),c=e+1+2*(t+1),h=e+1+2*t;r.push(l,u,h),r.push(u,c,h)}this.setIndex(new up(new cp(new Uint16Array(r),1))),this.addAttribute("a_Position",new up(new cp(new Float32Array(n),3))),this.addAttribute("a_Normal",new up(new cp(new Float32Array(i),3))),this.addAttribute("a_Uv",new up(new cp(new Float32Array(a),2)))}},{key:"setPoints",value:function(e){for(var t=0;t<e.length;t++){var r=3*t,n=e[t];this.instancePosition.buffer.array[r]=n[0],this.instancePosition.buffer.array[r+1]=n[1],this.instancePosition.buffer.array[r+2]=n[2]}this.instancePosition.needsUpdate=!0}},{key:"setPointAt",value:function(e,t){var r=3*e;this.instancePosition.buffer.array[r]=t[0],this.instancePosition.buffer.array[r+1]=t[1],this.instancePosition.buffer.array[r+2]=t[2],this.instancePosition.needsUpdate=!0}},{key:"setRotations",value:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.instanceRotation.buffer.array[t]=e[t];else this.instanceRotation.buffer.array.set(new Array(this.maxCount).fill(e));this.instanceRotation.needsUpdate=!0}},{key:"setRotationAt",value:function(e,t){this.instanceRotation.buffer.array[e]=t,this.instanceRotation.needsUpdate=!0}},{key:"setScales",value:function(e){if(Array.isArray(e[0]))for(var t=0;t<e.length;t++){var r=2*t,n=e[t];this.instanceScale.buffer.array[r]=n[0],this.instanceScale.buffer.array[r+1]=n[1]}else for(var i=0;i<this.maxCount;i++){r=2*i;this.instanceScale.buffer.array[r]=e[0],this.instanceScale.buffer.array[r+1]=e[1]}this.instanceScale.needsUpdate=!0}},{key:"setScaleAt",value:function(e,t){var r=2*e;this.instanceScale.buffer.array[r]=t[0],this.instanceScale.buffer.array[r+1]=t[1],this.instanceScale.needsUpdate=!0}},{key:"setUvOffsets",value:function(e){if(Array.isArray(e[0]))for(var t=0;t<e.length;t++){var r=2*t,n=e[t];this.instanceUvOffset.buffer.array[r]=n[0],this.instanceUvOffset.buffer.array[r+1]=n[1]}else for(var i=0;i<this.maxCount;i++){r=2*i;this.instanceUvOffset.buffer.array[r]=e[0],this.instanceUvOffset.buffer.array[r+1]=e[1]}this.instanceUvOffset.needsUpdate=!0}},{key:"setUvOffsetAt",value:function(e,t){var r=2*e;this.instanceUvOffset.buffer.array[r]=t[0],this.instanceUvOffset.buffer.array[r+1]=t[1],this.instanceUvOffset.needsUpdate=!0}},{key:"setUvRepeats",value:function(e){if(Array.isArray(e[0]))for(var t=0;t<e.length;t++){var r=2*t,n=e[t];this.instanceUvRepeat.buffer.array[r]=n[0],this.instanceUvRepeat.buffer.array[r+1]=n[1]}else for(var i=0;i<this.maxCount;i++){r=2*i;this.instanceUvRepeat.buffer.array[r]=e[0],this.instanceUvRepeat.buffer.array[r+1]=e[1]}this.instanceUvRepeat.needsUpdate=!0}},{key:"setUvRepeatAt",value:function(e,t){var r=2*e;this.instanceUvRepeat.buffer.array[r]=t[0],this.instanceUvRepeat.buffer.array[r+1]=t[1],this.instanceUvRepeat.needsUpdate=!0}},{key:"setColors",value:function(e){if(Array.isArray(e[0]))for(var t=0;t<e.length;t++){var r=3*t,n=e[t];this.instanceColor.buffer.array[r]=n[0],this.instanceColor.buffer.array[r+1]=n[1],this.instanceColor.buffer.array[r+2]=n[2]}else for(var i=0;i<this.maxCount;i++){r=3*i;this.instanceColor.buffer.array[r]=e[0],this.instanceColor.buffer.array[r+1]=e[1],this.instanceColor.buffer.array[r+2]=e[2]}this.instanceColor.needsUpdate=!0}},{key:"setColorAt",value:function(e,t){var r=3*e;this.instanceColor.buffer.array[r]=t[0],this.instanceColor.buffer.array[r+1]=t[1],this.instanceColor.buffer.array[r+2]=t[2],this.instanceColor.needsUpdate=!0}},{key:"setVisibles",value:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.instanceVisible.buffer.array[t]=e[t];else{var r=e?1:0;this.instanceVisible.buffer.array.set(new Array(this.maxCount).fill(r))}this.instanceVisible.needsUpdate=!0}},{key:"setVisibleAt",value:function(e,t){this.instanceVisible.buffer.array[e]=t?1:0,this.instanceVisible.needsUpdate=!0}}]),r}(_p);function tN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var rN=function(e){LP(r,e);var t=tN(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),e=t.call(this,n.external.uScene);var i=new JR,a=new eN(n.external.param);e._initParameter(n.external.param);var s=new ap(a,i);e._node.add(s);var o=UP(e),l=s.addBeforeRenderFunction((function(e,t){t.uniforms.center=o._center,t.uniforms.keepSize=o._keepSize,t.uniforms.screenHeightPercentage=o._screenHeightPercentage}),"spritesObject-uniform-binding");return e.$markChildrenMatrixAutoUpdate(!1),e._binding=l,e._mesh=s,e}return BP(r,[{key:"_initParameter",value:function(e){this._center=void 0===e.center?[.5,.5]:e.center,this._keepSize=void 0!==e.keepSize&&e.keepSize,this._screenHeightPercentage=void 0===e.screenHeightPercentage?.1:e.screenHeightPercentage,this._instanceCount=e.instanceCount||1,this._maxCount=e.maxCount||100}},{key:"getType",value:function(){return"Sprites"}},{key:"center",get:function(){return this._center},set:function(e){this._center=e,this._mesh.material.center=this._center}},{key:"keepSize",get:function(){return this._keepSize},set:function(e){this._keepSize=e,this._mesh.material.keepSize=this._keepSize}},{key:"screenHeightPercentage",get:function(){return this._screenHeightPercentage},set:function(e){this._screenHeightPercentage=e,this._mesh.material.screenHeightPercentage=this._screenHeightPercentage}},{key:"setPoints",value:function(e){this._mesh.geometry.setPoints(e)}},{key:"setPointAt",value:function(e,t){this._mesh.geometry.setPointAt(e,t)}},{key:"setRotations",value:function(e){this._mesh.geometry.setRotations(e)}},{key:"setRotationAt",value:function(e,t){this._mesh.geometry.setRotationAt(e,t)}},{key:"setScales",value:function(e){this._mesh.geometry.setScales(e)}},{key:"setScaleAt",value:function(e,t){this._mesh.geometry.setScaleAt(e,t)}},{key:"setUvOffsets",value:function(e){this._mesh.geometry.setUvOffsets(e)}},{key:"setUvOffsetAt",value:function(e,t){this._mesh.geometry.setUvOffsetAt(e,t)}},{key:"setUvRepeats",value:function(e){this._mesh.geometry.setUvRepeats(e)}},{key:"setUvRepeatAt",value:function(e,t){this._mesh.geometry.setUvRepeatAt(e,t)}},{key:"setColors",value:function(e){this._mesh.geometry.setColors(e)}},{key:"setColorAt",value:function(e,t){this._mesh.geometry.setColorAt(e,t)}},{key:"setVisibles",value:function(e){this._mesh.geometry.setVisibles(e)}},{key:"setVisibleAt",value:function(e,t){this._mesh.geometry.setVisibleAt(e,t)}},{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e,this._mesh.material.uniforms.map&&this._mesh.material.uniforms.map.version++,this._mesh.geometry.instanceCount=this._instanceCount}},{key:"maxCount",get:function(){return this._maxCount},set:function(e){this._maxCount=e;var t=this._mesh.geometry,r=new eN({instanceCount:this._instanceCount,maxCount:this._maxCount});this._mesh.geometry=r;for(var n=0;n<t.instanceCount;n++){var i=3*n;r.setPointAt(n,[t.instancePosition.buffer.array[i],t.instancePosition.buffer.array[i+1],t.instancePosition.buffer.array[i+2]]),r.setColorAt(n,[t.instanceColor.buffer.array[i],t.instanceColor.buffer.array[i+1],t.instanceColor.buffer.array[i+2]]),i=2*n,r.setScaleAt(n,[t.instanceScale.buffer.array[i],t.instanceScale.buffer.array[i+1]]),r.setUvOffsetAt(n,[t.instanceUvOffset.buffer.array[i],t.instanceUvOffset.buffer.array[i+1]]),r.setUvRepeatAt(n,[t.instanceUvRepeat.buffer.array[i],t.instanceUvRepeat.buffer.array[i+1]]),r.setVisibleAt(n,t.instanceVisible.buffer.array[n]),r.setRotationAt(n,t.instanceRotation.buffer.array[n])}t.dispose()}},{key:"dispose",value:function(){OP(IP(r.prototype),"dispose",this).call(this),this._binding&&this._mesh.removeBeforeRenderFunction(this._binding),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,this._binding=null}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this._map=e._map,this._center=e._center,this._color=e._color,this._opacity=e._opacity,this._keepSize=e._keepSize,this._screenHeightPercentage=e._screenHeightPercentage,this}}]),r}(QE),nN={name:"decal",defines:{SPHERE_SPACE:!1,FISHEYE:!1,BARREL_CORRECTION:!1,OCCLUSION:!0,OCCLUSION_PACKING:!0},uniforms:{decalPMatrix:new Array(16),decalVMatrix:new Array(16),barrelF:[0,0],barrelS:1,occlusionTexture:null,occlusionBias:-4e-4},vertexShader:"\n        attribute vec3 a_Position;\n\n        uniform mat4 decalPMatrix;\n        uniform mat4 decalVMatrix;\n\n        uniform mat4 u_Model;\n        uniform mat4 u_ProjectionView;\n\n        varying vec4 vDecalProjectPosition;\n\n        #ifdef SPHERE_SPACE\n            varying vec3 vDecalVPosition;\n            varying vec2 vSphereChecker;\n        #endif\n\n        #include <logdepthbuf_pars_vert>\n\n        void main() {\n            vec4 worldPosition = u_Model * vec4(a_Position, 1.0);\n            gl_Position = u_ProjectionView * worldPosition;\n\n            vec4 decalVPosition = decalVMatrix * worldPosition;\n            vDecalProjectPosition = decalPMatrix * decalVPosition;\n\n            #ifdef SPHERE_SPACE\n                vDecalVPosition = decalVPosition.xyz;\n                vSphereChecker.x = decalPMatrix[3][2] / (decalPMatrix[2][2] - 1.0);\n                vSphereChecker.y = decalPMatrix[3][2] / (decalPMatrix[2][2] + 1.0);\n            #endif\n\n            #include <logdepthbuf_vert>\n        }\n    ",fragmentShader:"\n        uniform vec3 u_Color;\n        uniform float u_Opacity;\n\n        #ifdef USE_DIFFUSE_MAP\n            uniform sampler2D diffuseMap;\n        #endif\n\n        varying vec4 vDecalProjectPosition;\n\n        #ifdef SPHERE_SPACE\n            varying vec3 vDecalVPosition;\n            varying vec2 vSphereChecker;\n        #endif\n\n        #ifdef BARREL_CORRECTION\n            uniform vec2 barrelF;\n            uniform float barrelS;\n\n            // github.com/jywarren/fisheyegl\n            vec2 barrelCorrection(vec2 uv) {\n                vec2 h = uv.xy - vec2(0.5, 0.5);\n                vec2 fh = h - h.yx * h.yx * h.xy * barrelF;\n                return fh * barrelS + 0.5;\n            }\n        #endif\n\n        #ifdef FISHEYE\n            #if (FISHEYE == 1)\n                void fishEyeUV(float u, float v, out vec2 uv) {\n                    float theta = PI / 2.0 * u - PI / 4.0;\n                    float radius = 0.5 + v;\n\n                    uv.x = sin(theta) * radius * 0.5 + 0.5;\n                    uv.y = cos(theta) * radius * 0.5 + 0.5;\n                }\n            #elif (FISHEYE == 2)\n                void fishEyeUV(float u, float v, out vec2 uv) {\n                    float theta = PI / 2.0 * u + PI * 3.0 / 4.0;\n                    float radius = 0.5 + v;\n\n                    uv.x = sin(theta) * radius * 0.5 + 0.5;\n                    uv.y = cos(theta) * radius * 0.5 + 0.5;\n                }\n            #elif (FISHEYE == 3)\n                void fishEyeUV(float u, float v, out vec2 uv) {\n                    float theta = PI / 2.0 * u - PI * 3.0 / 4.0;\n                    float radius = 0.5 + v;\n\n                    uv.x = sin(theta) * radius * 0.5 + 0.5;\n                    uv.y = cos(theta) * radius * 0.5 + 0.5;\n                }\n            #elif (FISHEYE == 4)\n                void fishEyeUV(float u, float v, out vec2 uv) {\n                    float theta = PI / 2.0 * u + PI * 1.0 / 4.0;\n                    float radius = 0.5 + v;\n\n                    uv.x = sin(theta) * radius * 0.5 + 0.5;\n                    uv.y = cos(theta) * radius * 0.5 + 0.5;\n                }\n            #elif (FISHEYE == 5)\n                void fishEyeUV(float u, float v, out vec2 uv) {\n                    float rx = u - 0.5;\n                    float ry = v - 0.5;\n\n                    float l = 1.0;\n                    float rate = abs(rx / ry);\n                    float theta = 0.0;\n                    if (rate > 1.0) {\n                        l = sqrt(0.5 * 0.5 + (0.5 / rate) * (0.5 / rate));\n                        theta = sign(rx) * PI * (1.0 / 2.0 - sign(ry) / 4.0 * (1.0 / rate));\n                    } else {\n                        l = sqrt(0.5 * 0.5 + 0.5 * rate * 0.5 * rate);\n                        theta = PI / 2. * (1. - sign(ry)) + sign(ry * rx) * PI / 4.0 * rate;\n                    }\n\n                    float d = sqrt(rx * rx + ry * ry);\n                    float s = d / l;\n\n                    float radius = 0.5 * s;\n\n                    uv.x = sin(theta) * radius * 0.5 + 0.5;\n                    uv.y = cos(theta) * radius * 0.5 + 0.5;\n                }\n            #endif\n        #else\n            float edgeAntialiasing(vec2 uv) {\n                float r = 0.005;\n                float a = abs(uv.x - 0.5) - (0.5 - r);\n                float b = abs(uv.y - 0.5) - (0.5 - r);\n                // it must be small if you donnot want to see the hackly texture\n                float sum = 0.0;\n                float count = 0.0000000000001;\n                sum += a * a * a * (sign(a) + 1.0);\n                count += 1.0 * a * a* (sign(a) + 1.0) ;\n                sum += b * b * b * (sign(b) + 1.0);\n                count += 1.0 * b * b * (sign(b) + 1.0);\n                return sum / count <= 1.0 ? (r - sum / count) / r : 1.0;\n            }\n        #endif\n\n        #ifdef OCCLUSION\n            #ifdef OCCLUSION_PACKING\n                #include <packing>\n            #endif\n            uniform sampler2D occlusionTexture;\n            uniform float occlusionBias;\n        #endif\n\n        #include <logdepthbuf_pars_frag>\n\n        void main() {\n            vec3 uvz = (vDecalProjectPosition.xyz / vDecalProjectPosition.w) * 0.5 + 0.5;\n\n            float u = uvz.x;\n            float v = uvz.y;\n            float z = uvz.z;\n\n            #ifdef SPHERE_SPACE\n                if (vDecalVPosition.z > 0.) discard;\n                float decalVPositionLen = length(vDecalVPosition);\n                if (decalVPositionLen > vSphereChecker.y || decalVPositionLen < vSphereChecker.x) discard;\n            #else\n                if (z > 1. || z < 0.) discard;\n            #endif\n\n            if (max(u, v) > 1. || min(u, v) < 0.) discard;\n\n            #ifdef OCCLUSION\n                #ifdef OCCLUSION_PACKING\n                    float sampleDepth = unpackRGBAToDepth(texture2D(occlusionTexture, vec2(u, v)));\n                #else\n                    float sampleDepth = 1.0 - texture2D(occlusionTexture, vec2(u, v)).r;\n                #endif\n                if ((z + occlusionBias) > sampleDepth) discard;\n            #endif\n\n            #include <logdepthbuf_frag>\n\n            gl_FragColor = vec4(u_Color, 1.0);\n\n            #ifdef USE_DIFFUSE_MAP\n                vec2 uv = vec2(0.5, 0.5);\n\n                #ifdef FISHEYE\n                    #if (FISHEYE < 5)\n                        if (v > 0.5) discard;\n                    #endif\n                    fishEyeUV(u, v, uv);\n                #else\n                    uv.x = u;\n                    uv.y = v;\n                    gl_FragColor.a = edgeAntialiasing(uv);\n                #endif\n\n                #ifdef BARREL_CORRECTION\n                    uv = barrelCorrection(uv);\n                    if (max(uv.x, uv.y) > 1. || min(uv.x, uv.y) < 0.) discard;\n                #endif\n\n                gl_FragColor.rgb *= texture2D(diffuseMap, uv).rgb;\n            #endif\n\n            gl_FragColor.a *= u_Opacity;\n        }\n    "};function iN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var aN=new Array(24),sN=0,oN=[],lN=function(e){LP(r,e);var t=iN(r);function r(){var e;PP(this,r);var n=new _p,i=new xp;return n.addAttribute("a_Position",new up(new cp(new Float32Array(aN),3))),n.computeBoundingSphere(),n.computeBoundingBox(),e=t.call(this,n,i),oN.length>0?e.mask=oN.shift():e.mask=(1<<sN++|0)>>>0,e.$camera=new Bd,e.$camera.projectionViewMatrix=new Sc,e.$camera.setPerspective(30/180*Math.PI,16/9,1,100),e.$depthRenderTarget=new Em(512,512),e.$depthRenderTarget.texture.minFilter=Vc.NEAREST,e.$depthRenderTarget.texture.magFilter=Vc.NEAREST,e.$material=new bp(nN),e.$material.diffuseMap=null,e.$material.opacity=1,e.$material.transparent=!0,e.$material.uniforms.decalPMatrix=e.$camera.projectionMatrix.elements,e.$material.uniforms.decalVMatrix=e.$camera.viewMatrix.elements,e.$material.uniforms.occlusionTexture=e.$depthRenderTarget.texture,e.renderLayer=6,e}return BP(r,[{key:"lookAt",value:function(e,t){uN.lookAtRH(this.position,e,t),this.quaternion.setFromRotationMatrix(uN)}},{key:"updateMatrix",value:function(e){OP(IP(r.prototype),"updateMatrix",this).call(this,e),this.$camera.worldMatrix.copy(this.worldMatrix),this.$camera.viewMatrix.getInverse(this.worldMatrix),this.$camera.projectionViewMatrix.multiplyMatrices(this.$camera.projectionMatrix,this.$camera.viewMatrix),this.$camera.frustum.setFromMatrix(this.$camera.projectionViewMatrix)}},{key:"dispose",value:function(){this.$depthRenderTarget.dispose(),this.$material.dispose(),this.material.dispose(),this.geometry.dispose(),oN.push(this.mask)}}]),r}(ap),uN=new Sc;function cN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var hN=function(e){LP(r,e);var t=cN(r);function r(e){var n;PP(this,r);var i=new _p,a=new fm;a.envMap=void 0,a.vertexColors=Yc.RGB,a.drawMode=Kc.LINES;for(var s=new Array(24),o=[],l=[],u=0;u<8;u++)o.push(1,1,1);return l.push(0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7),i.addAttribute("a_Position",new up(new cp(new Float32Array(s),3))),i.addAttribute("a_Color",new up(new cp(new Float32Array(o),3))),i.setIndex(new up(new cp(new Uint16Array(l),1))),i.computeBoundingSphere(),i.computeBoundingBox(),(n=t.call(this,i,a))._geometry=i,n._material=a,n.updateFrustum(e),n}return BP(r,[{key:"updateFrustum",value:function(e){for(var t=e.$camera,r=this.geometry.attributes.a_Position.buffer.array,n=0;n<8;n++)dN.fromArray(pN,3*n).applyMatrix4(t.projectionMatrixInverse).toArray(r,3*n);this.geometry.attributes.a_Position.buffer.version++}},{key:"dispose",value:function(){this._geometry.dispose(),this._material.dispose()}}]),r}(ap),dN=new bc,pN=[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,-1,1,-1,-1,1];function fN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var mN=0,gN=function(e){LP(r,e);var t=fN(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),(e=t.call(this,n.external.uScene))._node=new lN,e._appCamera=n.external.param.camera,e._receiveObjects=null,e._projectionType="Perspective",e._near=1,e._far=100,e._aspect=16/9,e._fov=30/180*Math.PI,e._orthoSize=20,e._sphereSpace=!1,e._map=null,e._occlusion=!0,e._barrelCorrection=!1,e._fisheye=!1,e._helper=new hN(e._node),e._helper.material.diffuse.setHex(16768256),0===mN&&e._appCamera.node.addRenderFunction(_N),mN++,e}return BP(r,[{key:"_clearCurrentObject",value:function(e){var t=this;e.$isContainer?e._children.forEach((function(e){e.isRenderableNode&&t._clearCurrentObject(e)})):e.$getRenderableList().forEach((function(e){e._decalMask&=~t._node.mask}))}},{key:"clearCurrentObject",value:function(){var e=this;this._receiveObjects&&this._receiveObjects.length>0&&this._receiveObjects.forEach((function(t){e._clearCurrentObject(t)})),this._receiveObjects=null}},{key:"_setReceiveNodes",value:function(e){var t=this;e.$isContainer?e._children.forEach((function(e){e.isRenderableNode&&t._setReceiveNodes(e)})):e.$getRenderableList&&e.$getRenderableList().forEach((function(e){void 0===e._decalMask?e._decalMask=t._node.mask:e._decalMask|=t._node.mask}))}},{key:"setReceiveNodes",value:function(e){var t=this;!e||e.length<=0||(this._receiveObjects=e,e.forEach((function(e){t._setReceiveNodes(e)})))}},{key:"getReceiveNodes",value:function(){return this._receiveObjects}},{key:"_updateProjection",value:function(e){"Perspective"==e?this._node.$camera.setPerspective(this._fov,this._aspect,this._near,this._far):this._node.$camera.setOrtho(-this._orthoSize*this._aspect/2,this._orthoSize*this._aspect/2,-this._orthoSize/2,this._orthoSize/2,this._near,this._far),this._helper.updateFrustum(this._node)}},{key:"setProjectionType",value:function(e){"Perspective"===e||"Orthographic"===e?(this._updateProjection(e),this._projectionType=e):console.warn("Decal: unknown projection type!")}},{key:"getProjectionType",value:function(){return this._projectionType}},{key:"setNear",value:function(e){this._near=e,this._updateProjection(this._projectionType)}},{key:"getNear",value:function(){return this._near}},{key:"setFar",value:function(e){this._far=e,this._updateProjection(this._projectionType)}},{key:"getFar",value:function(){return this._far}},{key:"setFov",value:function(e){this._fov=e/180*Math.PI,"Perspective"==this._projectionType&&this._updateProjection(this._projectionType)}},{key:"getFov",value:function(){return this._fov/Math.PI*180}},{key:"setAspect",value:function(e){this._aspect=e,"Perspective"==this._projectionType&&this._updateProjection(this._projectionType)}},{key:"getAspect",value:function(){return this._aspect}},{key:"setOrthoSize",value:function(e){this._orthoSize=e,"Orthographic"==this._projectionType&&this._updateProjection(this._projectionType)}},{key:"getOrthoSize",value:function(){return this._orthoSize}},{key:"setOcclusionQuality",value:function(e){var t=this._node.$depthRenderTarget;t.width!=e&&t.height!=e&&t.resize(e,e)}},{key:"getOcclusionQuality",value:function(){return this._node.$depthRenderTarget.width}},{key:"setMap",value:function(e){e?(this._node.$material.diffuseMap=e._texture,this._map=e):(this._node.$material.diffuseMap=null,this._map=null),this._node.$material.needsUpdate=!0}},{key:"getMap",value:function(){return this._map}},{key:"setSphereSpace",value:function(e){this._sphereSpace!==e&&(this._sphereSpace=e,this._node.$material.defines.SPHERE_SPACE=!!e,this._node.$material.needsUpdate=!0)}},{key:"getSphereSpace",value:function(){return this._sphereSpace}},{key:"setOpacity",value:function(e){this._node.$material.opacity=e}},{key:"getOpacity",value:function(){return this._node.$material.opacity}},{key:"setColor",value:function(e){this._node.$material.diffuse.fromArray(e)}},{key:"getColor",value:function(e){return this._node.$material.diffuse.toArray(e)}},{key:"setOcclusion",value:function(e){this._occlusion!==e&&(this._occlusion=e,this._node.$material.defines.OCCLUSION=!!e,this._node.$material.needsUpdate=!0)}},{key:"getOcclusion",value:function(){return this._occlusion}},{key:"setOcclusionBias",value:function(e){this._node.$material.uniforms.occlusionBias=e}},{key:"getOcclusionBias",value:function(){return this._node.$material.uniforms.occlusionBias}},{key:"setFisheye",value:function(e){this._fisheye!==e&&(this._fisheye=e,this._node.$material.defines.FISHEYE=e,this._node.$material.needsUpdate=!0)}},{key:"getFisheye",value:function(){return this._fisheye}},{key:"setBarrelCorrection",value:function(e){this._barrelCorrection!==e&&(this._barrelCorrection=e,this._node.$material.defines.BARREL_CORRECTION=!!e,this._node.$material.needsUpdate=!0)}},{key:"getBarrelCorrection",value:function(){return this._barrelCorrection}},{key:"setBarrelFx",value:function(e){this._node.$material.uniforms.barrelF[0]=e}},{key:"getBarrelFx",value:function(){return this._node.$material.uniforms.barrelF[0]}},{key:"setBarrelFy",value:function(e){this._node.$material.uniforms.barrelF[1]=e}},{key:"getBarrelFy",value:function(){return this._node.$material.uniforms.barrelF[1]}},{key:"setBarrelS",value:function(e){this._node.$material.uniforms.barrelS=e}},{key:"getBarrelS",value:function(){return this._node.$material.uniforms.barrelS}},{key:"addHelper",value:function(){this._node.add(this._helper)}},{key:"removeHelper",value:function(){this._node.remove(this._helper)}},{key:"dispose",value:function(){var e=this;this._receiveObjects&&this._receiveObjects.length>0&&this._receiveObjects.forEach((function(t){t.$getRenderableList().forEach((function(t){t._decalMask&=~e._node.mask}))})),this._receiveObjects=null,this._map=null;var t=this._appCamera.node.customRenderLayerManager,n="decal_"+this._node.id;t.has(n)&&t.remove(n),0===--mN&&this._appCamera.node.removeRenderFunction(_N),this._node.dispose(),this._helper.dispose(),OP(IP(r.prototype),"dispose",this).call(this)}},{key:"setRenderLayer",value:function(){console.warn("Can not reset decal's renderLayer!")}}]),r}(QE),_N=function(){var e=new Sp;e.packToRGBA=!0;var t={mask:0},r={getMaterial:function(t){return e.side=t.material.side,e},ifRender:function(e){return 0!=(e.object._decalMask&t.mask)}},n=[];return function(e,i,a){var s=e.$node.getRenderQueue(a.$node).layerMap.get(6),o=a.customRenderLayerManager;s&&s.opaqueCount>0?(s.opaque.forEach((function(a,s){var l=a.object,u="decal_"+l.id;if(!o.has(u)){var c={decalId:l.id,id:0,mask:15,options:{getMaterial:function(e){return l.$material.side=e.material.side,l.$material},ifRender:function(e){return 0!=(e.object._decalMask&l.mask)}}};o.add(u,c),n.push(l.id)}if(l.$material.defines.OCCLUSION){i.renderPass.setRenderTarget(l.$depthRenderTarget),i.renderPass.clear(!0,!0,!0);var h=e.$node.updateRenderStates(l.$camera,!1),d=e.$node.updateRenderQueue(l.$camera,!1,!1);t.mask=l.mask;var p=d.getLayer(0);p.opaqueCount>0&&i.renderRenderableList(p.opaque,h,r),p.transparentCount>0&&i.renderRenderableList(p.transparent,h,r)}})),n.forEach((function(e){if(-1===s.opaque.findIndex((function(t){return e==t.object.id}))){var t="decal_"+e;o.has(t)&&o.remove(t)}}))):n.length>0&&n.forEach((function(e){var t="decal_"+e;o.has(t)&&o.remove(t)}))}}(),vN=function(e,t,r){this.variables=[],this.currentTextureIndex=0;var n=new Nd,i=new Bd;i.position.set(0,1,0),i.updateMatrix(),i.lookAt(new bc(0,0,0),new bc(0,0,-1)),i.setOrtho(-1,1,-1,1,.1,2),n.add(i);var a={passThruTexture:null},s=u("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",a);a=s.uniforms;var o=new ap(new vp(2,2),s);function l(r){r.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function u(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=new bp({uniforms:t=t||{},vertexShader:"uniform mat4 u_Model;\nuniform mat4 u_ProjectionView;\nattribute vec3 a_Position;\nvoid main()\t{\n\n\tgl_Position = u_ProjectionView * u_Model * vec4( a_Position, 1.0 );\n\n}\n",fragmentShader:e});return r&&l(n),n}o.frustumCulled=!1,n.add(o),n.updateMatrix(),n.updateRenderStates(i),n.updateRenderQueue(i,!1,!1),this.addVariable=function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i={name:e,initialValueTexture:r,material:this.createShaderMaterial(t,null,n),dependencies:null,renderTargets:[]};return this.variables.push(i),i},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){var n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(r.renderPass.capabilities.version<1&&!r.renderPass.capabilities.getExtension("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===r.renderPass.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var i=0;i<this.variables.length;i++){var a=this.variables[i];a.renderTargets[0]=this.createRenderTarget(e,t),a.renderTargets[1]=this.createRenderTarget(e,t),this.renderTexture(a.initialValueTexture,a.renderTargets[0]),this.renderTexture(a.initialValueTexture,a.renderTargets[1]);var s=a.material,o=s.uniforms;if(null!==a.dependencies)for(var l=0;l<a.dependencies.length;l++){var u=a.dependencies[l];if(u.name!==a.name){for(var c=!1,h=0;h<this.variables.length;h++)if(u.name===this.variables[h].name){c=!0;break}if(!c)return"Variable dependency not found. Variable="+a.name+", dependency="+u.name}n&&(o[u.name]=null,s.fragmentShader="\nuniform sampler2D "+u.name+";\n"+s.fragmentShader)}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0,r=0,n=this.variables.length;r<n;r++){var i=this.variables[r];if(null!==i.dependencies)for(var a=i.material.uniforms,s=0,o=i.dependencies.length;s<o;s++){var l=i.dependencies[s];a[l.name]=l.renderTargets[e].texture}this.doRenderTarget(i.material,i.renderTargets[t])}this.currentTextureIndex=t},this.destroy=function(){o.geometry.dispose(),o.material.dispose(),n.remove(o)},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=l,this.createShaderMaterial=u,this.createRenderTarget=function(r,n){var i=new Em(r=r||e,n=n||t);return i.texture.magFilter=Vc.NEAREST,i.texture.minFilter=Vc.NEAREST,i.texture.type=/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?jc.HALF_FLOAT:jc.FLOAT,i.texture.generateMipmaps=!1,i.texture.flipY=!1,i},this.createTexture=function(r){if(r){var n={data:new Float32Array(r*r*4),width:r,height:r},i=new Bp;return i.image=n,i.type=jc.FLOAT,i.format=zc.RGBA,i.minFilter=Vc.NEAREST,i.magFilter=Vc.NEAREST,i.generateMipmaps=!1,i.flipY=!1,i.version++,i}var a={data:new Float32Array(e*t*4),width:e,height:t},s=new Bp;return s.image=a,s.type=jc.FLOAT,s.format=zc.RGBA,s.minFilter=Vc.NEAREST,s.magFilter=Vc.NEAREST,s.generateMipmaps=!1,s.flipY=!1,s.version++,s},this.renderTexture=function(e,t){a.passThruTexture=e,this.doRenderTarget(s,t),a.passThruTexture=null},this.doRenderTarget=function(e,t){o.material=e,n.updateRenderQueue(i,!1,!1),r.renderPass.renderTarget.setRenderTarget(t),r.renderPass.setClearColor(0,0,0,0),r.renderPass.clear(!0,!0,!0),r.renderScene(n,i),r.renderPass.updateRenderTargetMipmap(t),o.material=s}};function yN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var xN=function(e){LP(r,e);var t=yN(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),e=t.call(this,n.uScene);var i="\n        attribute vec2 a_Reference;\n\n        uniform float size;\n        uniform sampler2D positions;\n\t\tuniform bool isDrag;\n\t\tuniform vec3 dragPos;\n\t\tuniform vec2 dragReference;\n        #include <common_vert>\n\t\t#include <logdepthbuf_pars_vert>\n\n\t\t".concat(tg.gpu_picker_pars_vert,"\n\n        void main() {\n\t\t\t").concat(tg.gpu_picker_id_vert,"\n\n\t\t\tvec4 mvPosition;\n\t\t\tif(dragReference.xy==a_Reference&&isDrag){\n\t\t\t\tmvPosition = u_View * u_Model * vec4( dragPos, 1.0 );\n\t\t\t}else{\n\t\t\t\tvec4 tmpPos = texture2D( positions, a_Reference );\n\t\t\t\tmvPosition = u_View * u_Model * vec4( tmpPos.xyz, 1.0 );\n\t\t\t}\n\n            gl_PointSize = size;\n\t\t\tbool isPerspective = isPerspectiveMatrix( u_Projection );\n\t\t\tif ( isPerspective ) gl_PointSize *= ( 300. / - mvPosition.z );\n\n            gl_Position = u_Projection *  mvPosition;\n\n\t\t\t#include <logdepthbuf_vert>\n        }\n        "),a="\n        uniform vec3 color;\n  \n\t\t#include <logdepthbuf_pars_frag>\n\t\t#include <dithering_pars_frag>\n\t\t".concat(tg.gpu_picker_pars_frag,"\n        void main() {\n\t\t\t#include <logdepthbuf_frag>\n\n\t\t\tvec2 uv = gl_PointCoord - vec2(0.5);\n            float alpha = 1.-length(uv)*2.;\n            if(alpha<0.1){\n                discard;\n            }\n\n\t\t\tgl_FragColor = vec4( color.rgb,0.8 );\n\n\t\t\t").concat(tg.gpu_picker_id_frag,"\n        } \n        "),s={color:[n.param.nodeColor.r,n.param.nodeColor.g,n.param.nodeColor.b],positions:null,size:300,keepSize:!1,dragPos:[0,0,0],isDrag:!1,dragReference:[-1,-1]},o=new bp({uniforms:s,vertexShader:i,fragmentShader:a,transparent:!0});o.drawMode=Kc.POINTS,e._geometry=new _p,e._initParameter(n.param);var l=new ap(e._geometry,o);e._node.add(l);var u=UP(e);e._mesh=l;var c=l.addBeforeRenderFunction((function(e){u._mesh.material.uniforms.size=u._size}),"D3Point-uniforms-binding");return e.$markChildrenMatrixAutoUpdate(!1),e._binding=c,e}return BP(r,[{key:"_initParameter",value:function(e){this._size=void 0===e.size?300:e.size,this._nodesCount=e.nodesCount,this._nodesWidth=e.nodesWidth,this._references=e.references;for(var t=[],r=[],n=0;n<this._nodesCount;n++){t.push(0,0,0),r.push(n+1e4)}this._geometry.addAttribute("a_Position",new up(new cp(new Float32Array(t),3))),this._geometry.addAttribute("a_Reference",new up(new cp(new Float32Array(this._references),2))),this._geometry.addAttribute("ids",new up(new cp(new Float32Array(r.slice(0)),1)))}},{key:"getType",value:function(){return"D3Point"}},{key:"size",get:function(){return this._size},set:function(e){this._size=e,this._mesh.material.size=this._size}},{key:"dispose",value:function(){OP(IP(r.prototype),"dispose",this).call(this),this._mesh.removeBeforeRenderFunction(this._binding),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,this._binding=null}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this._color=e._color,this._opacity=e._opacity,this._size=e._size,this}}]),r}(QE);function bN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var AN=function(e){LP(r,e);var t=bN(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),e=t.call(this,n.uScene);var i={color:n.param.lineColor.toArray(),opacity:n.param.lineOpacity,positions:null,dragPos:[0,0,0],isDrag:!1,dragReference:[-1,-1]},a=new bp({uniforms:i,vertexShader:"\n        attribute vec2 a_Reference;\n    \n        uniform sampler2D positions;\n\t\tuniform bool isDrag;\n\t\tuniform vec3 dragPos;\n\t\tuniform vec2 dragReference;\n        #include <common_vert>\n\t\t#include <logdepthbuf_pars_vert>\n        void main() {\n\t\t\tvec4 mvPosition;\n\t\t\tif(dragReference.xy == a_Reference&&isDrag){\n\t\t\t\tmvPosition = u_View * u_Model * vec4( dragPos, 1.0 );\n\t\t\t}else{\n\t\t\t\tvec4 tmpPos = texture2D( positions, a_Reference );\n\t\t\t\tmvPosition = u_View * u_Model * vec4( tmpPos.xyz, 1.0 );\n\t\t\t}\n\n            gl_Position = u_Projection * mvPosition;\n\t\t\t#include <logdepthbuf_vert>\n        }\n        ",fragmentShader:"\n        uniform vec3 color;\n\t\tuniform float opacity;\n\t\t#include <logdepthbuf_pars_frag>\n        void main() {\n\t\t\t#include <logdepthbuf_frag>\n            gl_FragColor = vec4( color, opacity );\n        }  \n        ",transparent:!0});a.drawMode=Kc.LINES,e._geometry=new _p,e._initParameter(n.param);var s=new ap(e._geometry,a);return e._node.add(s),e.$markChildrenMatrixAutoUpdate(!1),e._mesh=s,e}return BP(r,[{key:"_initParameter",value:function(e){for(var t=e.links,r=e.nodesReferences,n=[],i=[],a=0;a<t.length;a++){var s=t[a];n.push(0,0,0),i.push(r[2*s.source],r[2*s.source+1]),n.push(0,0,0),i.push(r[2*s.target],r[2*s.target+1])}this._geometry.addAttribute("a_Position",new up(new cp(new Float32Array(n),3))),this._geometry.addAttribute("a_Reference",new up(new cp(new Float32Array(i),2)))}},{key:"getType",value:function(){return"D3Line"}},{key:"dispose",value:function(){OP(IP(r.prototype),"dispose",this).call(this),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this._color=e._color,this._opacity=e._opacity,this}}]),r}(QE);function SN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var EN=function(e){LP(r,e);var t=SN(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),(e=t.call(this,n.external.uScene))._initParameter(n.external),e.$markChildrenMatrixAutoUpdate(!1),e._delta=0,e}return BP(r,[{key:"_initParameter",value:function(e){this._size=void 0===e.param.size?300:e.param.size,this._keepSize=void 0!==e.param.keepSize&&e.param.keepSize,this._nodesCount=e.param.nodesCount,this._nodesWidth=e.param.nodesWidth,this._edgesWidth=e.param.edgesWidth,this._temperature=this._nodesCount/.01,this._nodesAndEdges=e.param.nodesAndEdges,this._render=e.param.render,this._nodeColor=void 0===e.param.nodeColor?new Eh(39372):new Eh(e.param.nodeColor.replace("#","0x")),this._nodeOpacity=void 0===e.param.nodeOpacity?1:e.param.nodeOpacity,this._lineColor=void 0===e.param.lineColor?new Eh(4269841):new Eh(e.param.lineColor.replace("#","0x")),this._lineOpacity=void 0===e.param.lineOpacity?.4:e.param.lineOpacity,this._camera=e.param.camera;for(var t=[],r=0;r<this._nodesCount;r++){var n=r%this._nodesWidth/this._nodesWidth,i=~~(r/this._nodesWidth)/this._nodesWidth;t.push(n,i)}this._initComputeRenderer(this._nodesAndEdges),this._points=new xN({uScene:e.uScene,param:{references:t,size:this._size,nodeColor:this._nodeColor,nodeOpacity:this._nodeOpacity,nodesCount:this._nodesCount,nodesWidth:this._nodesWidth}}),this._nodesUniforms=this._points._mesh.material.uniforms,this.add(this._points),this._line=new AN({uScene:e.uScene,param:{links:e.param.data.links,nodesReferences:t,lineColor:this._lineColor,lineOpacity:this._lineOpacity}}),this._linesUniforms=this._line._mesh.material.uniforms,this.add(this._line)}},{key:"_initComputeRenderer",value:function(e){this._gpuCompute=new vN(this._nodesWidth,this._nodesWidth,this._render);var t=this._gpuCompute.createTexture();this._fillPositionTexture(t,e);var r=this._gpuCompute.createTexture();this._fillVelocityTexture(r,e);var n=this._gpuCompute.createTexture(this._nodesWidth);this._fillEdgeIndicesTexture(n,e);var i=this._gpuCompute.createTexture(this._edgesWidth);this._fillEdgeDataTexture(i,e);var a=this._gpuCompute.createTexture(this._edgesWidth);this._fillZeroedPositionTexture(a,e),this._velocityVariable=this._gpuCompute.addVariable("velocities","\n        uniform float distanceFactor;\n        uniform float k;\n        uniform float temperature;\n        uniform sampler2D edgeIndices;\n        uniform sampler2D edgeData;\n        uniform vec2 screenSize;\n        \n        const float nodesTexWidth = NODESWIDTH;\n        const float edgesTexWidth = EDGESWIDTH;\n        \n        vec4 getNeighbor(float textureIndex){\n            return texture2D(positions, vec2(((mod(textureIndex,nodesTexWidth)) / nodesTexWidth) , (floor(textureIndex / nodesTexWidth)) / nodesTexWidth));\n        }\n        \n        vec3 addRepulsion(vec3 self, vec3 neighbor){\n            vec3 diff = self - neighbor;\n            float x = length( diff );\n            float f = ( k * k ) / x;\n            return normalize(diff) * f ;\n        }\n        \n        vec3 addAttraction(vec3 self, vec3 neighbor){\n            vec3 diff = self - neighbor;\n            float x = length( diff );\n            float f = ( x * x ) / 100.;\n\t\t\tif(x<0.001){\n\t\t\t\treturn vec3(0.);\n\t\t\t}else{\n\t\t\t\treturn normalize(diff) * f;\n\t\t\t}\n\t\t\t\n        }\n        \n        void main()\t{\n            vec2 nodeRef = vec2(nodesTexWidth, nodesTexWidth);\n            vec2 uv = gl_FragCoord.xy / nodeRef.xy;\n            vec4 selfPosition = texture2D( positions, uv );\n            vec3 selfVelocity = texture2D( velocities, uv ).xyz;\n            vec3 velocity = selfVelocity;\n        \n            vec4 nodePosition;\n            vec4 compareNodePosition;\n            float strength;\n        \n            float speedLimit = 250.0;\n        \n            if( selfPosition.w > 0.0 ){\n                for(float y = 0.0; y < nodesTexWidth; y++){\n                    for(float x = 0.0; x < nodesTexWidth; x++){\n                        vec2 ref = vec2(x + 0.5, y + 0.5 ) / nodeRef;\n                        compareNodePosition = texture2D(positions,ref);\n    \n                        if (distance(compareNodePosition.xyz, selfPosition.xyz) > 0.001) {\n                            if (compareNodePosition.w != -1.0) {\n                                velocity += addRepulsion(selfPosition.xyz, compareNodePosition.xyz);\n                            }\n                        }\n                    }\n                }\n    \n                vec4 selfEdgeIndices = texture2D( edgeIndices, uv);\n    \n                float idx = selfEdgeIndices.x;\n                float idy = selfEdgeIndices.y;\n                float idz = selfEdgeIndices.z;\n                float idw = selfEdgeIndices.w;\n    \n                float start = idx * 4.0 + idy;\n                float end = idz * 4.0 + idw;\n    \n                if(! ( idx == idz && idy == idw ) ){\n                    float edgeIndex = 0.0;\n                    vec2 edgeRef = vec2(edgesTexWidth, edgesTexWidth);\n    \n                    for(float y = 0.0; y < edgesTexWidth; y++){\n                        for(float x = 0.0; x < edgesTexWidth; x++){\n    \n                            vec2 ref = vec2( x + 0.5 , y + 0.5 ) / edgeRef;\n                            vec4 pixel = texture2D(edgeData, ref);\n    \n                            if (edgeIndex >= start && edgeIndex < end){\n                                if(pixel.x<0.){\n                                    nodePosition = getNeighbor(-(pixel.x+0.1));\n                                    strength = 1./min(selfPosition.w, nodePosition.w);\n                                    velocity += addAttraction(selfPosition.xyz, nodePosition.xyz)*strength;\n                                }else{\n                                    nodePosition = getNeighbor(pixel.x);\n                                    strength = 1./min(selfPosition.w, nodePosition.w);\n                                    velocity -= addAttraction(selfPosition.xyz, nodePosition.xyz)*strength;\n                                }\n                            }\n                            edgeIndex++;\n    \n                            if (edgeIndex >= start && edgeIndex < end){\n                                if(pixel.y<0.){\n                                    nodePosition = getNeighbor(-(pixel.y+0.1));\n                                    strength = 1./min(selfPosition.w, nodePosition.w);\n                                    velocity += addAttraction(selfPosition.xyz, nodePosition.xyz)*strength;\n                                }else{\n                                    nodePosition = getNeighbor(pixel.x);\n                                    strength = 1./min(selfPosition.w, nodePosition.w);\n                                    velocity -= addAttraction(selfPosition.xyz, nodePosition.xyz)*strength;\n                                }\n                            }\n                            edgeIndex++;\n    \n                            if (edgeIndex >= start && edgeIndex < end){\n                                if(pixel.z<0.){\n                                    nodePosition = getNeighbor(-(pixel.z+0.1));\n                                    strength = 1./min(selfPosition.w, nodePosition.w);\n                                    velocity += addAttraction(selfPosition.xyz, nodePosition.xyz)*strength;\n                                }else{\n                                    nodePosition = getNeighbor(pixel.z);\n                                    strength = 1./min(selfPosition.w, nodePosition.w);\n                                    velocity -= addAttraction(selfPosition.xyz, nodePosition.xyz)*strength;\n                                }\n                            }\n                            edgeIndex++;\n    \n                            if (edgeIndex >= start && edgeIndex < end){\n                                if(pixel.w<0.){\n                                    nodePosition = getNeighbor(-(pixel.w+0.1));\n                                    strength = 1./min(selfPosition.w, nodePosition.w);\n                                    velocity += addAttraction(selfPosition.xyz, nodePosition.xyz)*strength;\n                                }else{\n                                    nodePosition = getNeighbor(pixel.w);\n                                    strength = 1./min(selfPosition.w, nodePosition.w);\n                                    velocity -= addAttraction(selfPosition.xyz, nodePosition.xyz)*strength;\n                                }\n                            }\n                            edgeIndex++;\n                        }\n                    }\n                }\n            }\n\n\t\t\tif( length(velocity)<0.001 ){\n\t\t\t\tgl_FragColor = vec4(velocity, 1.0);\n\t\t\t}else{\n\t\t\t\tvelocity = normalize(velocity) * temperature;\n\t\t\t\n\t\t\t\tif ( length( velocity ) > speedLimit ) {\n\t\t\t\t\tvelocity = normalize( velocity ) * speedLimit;\n\t\t\t\t}\n\t\t\t\n\t\t\t\tvelocity *= distanceFactor;\n\t\t\t\n\t\t\t\tgl_FragColor = vec4(velocity, 1.0);\n\t\t\t}\n        \n        }\n        ",r,!1),this._positionVariable=this._gpuCompute.addVariable("positions","\n        uniform float delta;\n        \n        const float nodesTexWidth = NODESWIDTH;\n        \n        void main()\t{\n        \n            vec2 nodeRef = vec2(nodesTexWidth, nodesTexWidth);\n            vec2 uv = gl_FragCoord.xy / nodeRef.xy;\n        \n            vec4 selfPosition = texture2D( positions, uv );\n            vec3 selfVelocity = texture2D( velocities, uv ).xyz;\n        \n            gl_FragColor = vec4( selfPosition.xyz + selfVelocity * delta * 50.0, selfPosition.w );\n        }\n        ",t,!1),this._gpuCompute.setVariableDependencies(this._velocityVariable,[this._positionVariable,this._velocityVariable]),this._gpuCompute.setVariableDependencies(this._positionVariable,[this._positionVariable,this._velocityVariable]),this._positionUniforms=this._positionVariable.material.uniforms,this._velocityUniforms=this._velocityVariable.material.uniforms,this._positionUniforms.delta=0,this._positionVariable.material.defines.NODESWIDTH=this._nodesWidth.toFixed(2),this._velocityUniforms.distanceFactor=.25,this._velocityUniforms.k=100,this._velocityUniforms.temperature=0,this._velocityUniforms.edgeIndices=n,this._velocityUniforms.edgeData=i,this._velocityVariable.material.defines.NODESWIDTH=this._nodesWidth.toFixed(2),this._velocityVariable.material.defines.EDGESWIDTH=this._edgesWidth.toFixed(2),this._velocityVariable.wrapS=Gc.REPEAT,this._velocityVariable.wrapT=Gc.REPEAT,this._positionVariable.wrapS=Gc.REPEAT,this._positionVariable.wrapT=Gc.REPEAT;var s=this._gpuCompute.init();null!==s&&console.error(s)}},{key:"_fillPositionTexture",value:function(e,t){for(var r=e.image.data,n=0,i=r.length;n<i;n+=4)if(n<4*t.length){var a=1e3*Math.random()-500,s=1e3*Math.random()-500,o=1e3*Math.random()-500;r[n+0]=a,r[n+1]=s,r[n+2]=o,r[n+3]=1}else r[n+0]=-1,r[n+1]=-1,r[n+2]=-1,r[n+3]=-1}},{key:"_fillVelocityTexture",value:function(e,t){for(var r=e.image.data,n=0,i=r.length;n<i;n+=4)n<4*t.length?(r[n+0]=0,r[n+1]=0,r[n+2]=0,r[n+3]=0):(r[n+0]=-1,r[n+1]=-1,r[n+2]=-1,r[n+3]=-1)}},{key:"_fillZeroedPositionTexture",value:function(e,t){for(var r=e.image.data,n=0;n<r.length;n+=4)n<4*t.length?(r[n]=0,r[n+1]=0,r[n+2]=0,r[n+3]=0):(r[n]=-1,r[n+1]=-1,r[n+2]=-1,r[n+3]=-1)}},{key:"_fillEdgeIndicesTexture",value:function(e,t){for(var r=e.image.data,n=0,i=0,a=0;a<t.length;a++){for(var s=n,o=i,l=0;l<t[a].length;l++)4===++i&&(n++,i=0);r[4*a]=s,r[4*a+1]=o,r[4*a+2]=n,r[4*a+3]=i}for(var u=4*t.length;u<r.length;u++)r[u]=-1}},{key:"_fillEdgeDataTexture",value:function(e,t){for(var r=e.image.data,n=0,i=0;i<t.length;i++)for(var a=0;a<t[i].length;a++)r[n]=t[i][a],n++;for(var s=n;s<r.length;s++)r[s]=-1}},{key:"_getObjectPos",value:function(e){var t=new Float32Array(4);return this._render.renderPass.renderTarget.readRenderTargetPixels(this._positionRenderTarget,e%this._nodesWidth,Math.floor(e/this._nodesWidth),1,1,t),[t[0],t[1],t[2]]}},{key:"getType",value:function(){return"D3Node"}},{key:"size",get:function(){return this._points.size},set:function(e){this._size=e,this._points.size=this._size}},{key:"keepSize",get:function(){return this._keepSize},set:function(e){this._keepSize=e}},{key:"nodeColor",get:function(){return this._points.color},set:function(e){this._points.color=e}},{key:"nodeOpacity",get:function(){return this._points.opacity},set:function(e){this._points.opacity=e}},{key:"lineColor",get:function(){return this._line.color},set:function(e){this._line.color=e}},{key:"lineOpacity",get:function(){return this._line.opacity},set:function(e){this._line.opacity=e}},{key:"updateBuffertexture",value:function(){this._delta=this._delta/3,this._delta>1&&(this._delta=1),this._positionUniforms.delta=this._delta,this._temperature>.001&&(this._temperature*=.95,this._velocityUniforms.temperature=this._temperature,this._gpuCompute.compute(),this._positionRenderTarget=this._gpuCompute.getCurrentRenderTarget(this._positionVariable),this._nodesUniforms.positions=this._positionRenderTarget.texture,this._linesUniforms.positions=this._positionRenderTarget.texture),this._delta=0}},{key:"update",value:function(e){this._delta+=e}},{key:"getPosition",value:function(e,t){this._points.getPosition(e,t)}},{key:"dispose",value:function(){OP(IP(r.prototype),"dispose",this).call(this),this._gpuCompute.destroy()}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this}},{key:"setObjectPos",value:function(e){this._points._mesh.material.uniforms.isDrag=!0,this._points._mesh.material.uniforms.dragPos=e,this._line._mesh.material.uniforms.isDrag=!0,this._line._mesh.material.uniforms.dragPos=e}},{key:"getWorldPos",value:function(e,t,r){var n=this._camera.transform.getForward(),i=-THING.MathUtils.dotVector(n,this._getObjectPos(r));return this._camera.intersectPlane(e,t,n,i)}},{key:"mouseDownHandle",value:function(e,t){var r=[e,t];this._points._mesh.material.uniforms.dragReference=r,this._line._mesh.material.uniforms.dragReference=r}},{key:"mouseUpHandle",value:function(){this._points._mesh.material.uniforms.dragReference=[-1,-1],this._points._mesh.material.uniforms.isDrag=!1,this._line._mesh.material.uniforms.dragReference=[-1,-1],this._line._mesh.material.uniforms.isDrag=!1,this._temperature=30*this._nodesCount}}]),r}(QE);function wN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var CN=new DP,TN="\n\t\tconst vec3 oneOverRadii=vec3(1.5678896205707118e-7);\n\t\tconst vec3 oneOverRadiiSquared=vec3(2.4582778622933707e-14);\n\t\tconst float centerToleranceSquared=0.1;\n\t\t#define SIGN(x) ((x) < 0. ? -1. : 1.)\n\t\tfloat getAngleBetweenVectors(vec3 a,vec3 b){\n\t\t\treturn  degrees(acos(dot(a, b)));\n\t\t}\n\t\tvec3 webMercatorToCartographic(vec3 cartesian){\n\t\t\tfloat longitude = degrees(cartesian.x*oneOverRadii.x);\n\t\t\tfloat latitude =  -degrees(cartesian.z*oneOverRadii.z);\n\t\t\tfloat height = cartesian.y;\n\t\t\treturn vec3(longitude-u_minPos.x,latitude-u_minPos.y,height-u_minPos.z)/(u_maxPos-u_minPos);\n\t\t}\n\t\tvec3 cartesianToCartographic(vec3 cartesian){\n\t\t\treturn vec3(cartesian.x-u_minPos.x,cartesian.y-u_minPos.y,cartesian.z-u_minPos.z)/(u_maxPos-u_minPos);\n\t\t}\n",DN=new bp({defines:{},vertexShader:"\n\t\t#include <common_vert>\n\t\tprecision highp float;\n\t\tattribute vec2 a_Uv;\n\t\tattribute vec3 a_Lonlat;\n\n\t\tuniform vec3 dimensions;\n\t\tuniform vec3 u_minPos;\n\t\tuniform vec3 u_maxPos;\n\t\tvarying vec3 v_lonlat;\n\t\tvarying vec3 v_pos;\n\t\tvarying vec3 worldSpaceCoords;\n\t\t#include <logdepthbuf_pars_vert>\n\n\t\tvoid main() {\n\t\t\t//Set the world space coordinates of the back faces vertices as output.\n\n\t\t\tworldSpaceCoords =(a_Position-u_minPos)/(u_maxPos-u_minPos); //move it from [-0.5;0.5] to [0,1]\n\t\t\tv_pos = a_Position;\n\t\t\tv_lonlat = a_Lonlat;\n\t\t\tgl_Position = u_ProjectionView * u_Model * vec4(a_Position.xyz, 1.0);\n\t\t\t#include <logdepthbuf_vert>\n\t\t}\n\t",fragmentShader:"\n\t\t#include <common_frag>\n\t\tprecision highp float;\n\t\tvarying vec3 worldSpaceCoords;\n\t\tvarying vec3 v_lonlat;\n\t\tuniform bool uniformBox;\n\t\tuniform vec3 u_minPos;\n\t\tuniform vec3 u_maxPos;\n\t\t\n\t\t".concat(TN,"\n\t\t\n\t\t#include <logdepthbuf_pars_frag>\n\t\tvoid main() {\n\t\t\t#include <logdepthbuf_frag>\n\t\t\t//The fragment's world space coordinates as fragment output.\n\t\t\tif( uniformBox)\n\t\t\t{ \n\t\t\t\tgl_FragColor = vec4( worldSpaceCoords.x , worldSpaceCoords.y, worldSpaceCoords.z, 1. ); \n\t\t\t} \n\t\t\telse\n\t\t\t{ \n\t\t\t\tgl_FragColor = vec4(cartesianToCartographic(v_lonlat), 1. );\n\t\t\t}\n\t\t}\n\t"),uniforms:{dimensions:[1,1,1],uniformBox:!1,u_minPos:[0,0,1e3],u_maxPos:[150,44.6,65e4]}}),MN=new bp({defines:{},uniforms:{rtTexture:null,cubeTex:null,colorRampTexture:null,numSamples:887,alphaCorrection:1,dimensions:[1,1,1],zsliceNum:256,zslicex:16,zslicey:16,uniformBox:!1,u_minPos:[0,0,1e3],u_maxPos:[150,44.6,65e4],planeComponents:[0,1,0,0]},vertexShader:"\n\t\t#include <common_vert>\n\t\tprecision highp float;\n\t\tattribute vec2 a_Uv;\n\t\tattribute vec3 a_Lonlat;\n\n\t\tuniform vec3 u_minPos;\n\t\tuniform vec3 u_maxPos;\n\t\tvarying vec3 v_lonlat;\n\t\tvarying vec3 v_pos;\n\t\tvarying vec2 v_Uv;\n\t\tvarying vec3 worldSpaceCoords;\n\t\tvarying vec4 projectedCoords;\n\t\t\n\t\tuniform vec3 dimensions;\n\t\t#include <logdepthbuf_pars_vert>\n\n\t\tvoid main() {\n\t\t\tv_pos = a_Position;\n\t\t\tv_Uv = a_Uv;\n\t\t\tv_lonlat = a_Lonlat;\n\t\t\tworldSpaceCoords = (a_Position-u_minPos)/(u_maxPos-u_minPos); //move it from [-0.5;0.5] to [0,1]\n\n\t\t\tprojectedCoords =  u_ProjectionView * u_Model * vec4( a_Position, 1.0 );\n\t\t\tgl_Position = u_ProjectionView * u_Model * vec4( a_Position, 1.0 );\n\t\t\t#include <logdepthbuf_vert>\n\t\t}\n\t",fragmentShader:"\n\t\t#include <common_frag>\n\t\tprecision highp float;\n\t\tvarying vec3 worldSpaceCoords;\n\t\tvarying vec4 projectedCoords;\n\t\tvarying vec3 v_pos;\n\t\tvarying vec2 v_Uv;\n\t\tvarying vec3 v_lonlat;\n\t\tuniform sampler2D rtTexture, cubeTex, colorRampTexture;\n\t\tuniform int numSamples;\n\t\tuniform float alphaCorrection;\n\t\tuniform float zsliceNum;\n\t\tuniform float zslicex;\n\t\tuniform float zslicey;\n\t\tuniform vec3 u_minPos;\n\t\tuniform vec3 u_maxPos;\n\t\tuniform vec3 u_minPos1;\n\t\tuniform vec3 u_maxPos1;\n\t\tuniform bool uniformBox;\n\t\tuniform vec4 planeComponents;\n\t\t#include <logdepthbuf_pars_frag>\n\n\n\t\t//Acts like a texture3D using Z slices and trilinear filtering.\n\t\tvec4 sampleAs3DTexture( vec3 texCoord )\n\t\t{\n\t\t\tvec4 colorSlice1, colorSlice2;\n\t\t\tvec2 texCoordSlice1, texCoordSlice2;\n\n\t\t\t//The z coordinate determines which Z slice we have to look for.\n\t\t\t//Z slice number goes from 0 to zsliceNum-1..\n\t\t\tfloat zdepth = (zsliceNum-1.);\n\t\t\tfloat zSliceNumber1 = floor(texCoord.z  * zdepth);\n\n\t\t\t//As we use trilinear we go the next Z slice.\n\t\t\tfloat zSliceNumber2 = min( zSliceNumber1 + 1.0, zdepth); \n\n\t\t\t//The Z slices are stored in a matrix of 16x16 of Z slices.\n\t\t\t//The original UV coordinates have to be rescaled by the tile numbers in each row and column.\n\t\t\t// texCoord.xy /= 16.0;\n\t\t\ttexCoord.x /= zslicex;\n\t\t\ttexCoord.y /= zslicey;\n\n\t\t\ttexCoordSlice1 = texCoordSlice2 = texCoord.xy;\n\n\t\t\t//Add an offset to the original UV coordinates depending on the row and column number.\n\t\t\ttexCoordSlice1.x += (mod(zSliceNumber1, zslicex ) / zslicex);\n\t\t\ttexCoordSlice1.y += floor((zdepth - zSliceNumber1) / zslicey) / zslicey;\n\n\t\t\ttexCoordSlice2.x += (mod(zSliceNumber2, zslicex ) / zslicex);\n\t\t\ttexCoordSlice2.y += floor((zdepth - zSliceNumber2) / zslicey) / zslicey;\n\n\t\t\t//Get the opacity value from the 2D texture.\n\t\t\t//Bilinear filtering is done at each texture2D by default.\n\t\t\tcolorSlice1 = texture2D( cubeTex, texCoordSlice1 );\n\t\t\tcolorSlice2 = texture2D( cubeTex, texCoordSlice2 );\n\n\t\t\t//Based on the opacity obtained earlier, get the RGB color in the transfer function texture.\n\t\t\tcolorSlice1.rgb = texture2D( colorRampTexture, vec2( colorSlice1.a, 0.5) ).rgb;\n\t\t\tcolorSlice2.rgb = texture2D( colorRampTexture, vec2( colorSlice2.a, 0.5) ).rgb;\n\n\t\t\t//How distant is zSlice1 to ZSlice2. Used to interpolate between one Z slice and the other.\n\t\t\tfloat zDifference = mod(texCoord.z * zdepth, 1.0);\n\n\t\t\t//Finally interpolate between the two intermediate colors of each Z slice.\n\t\t\treturn mix(colorSlice1, colorSlice2, zDifference) ;\n\t\t}\n\n\t\t".concat(TN,"\n\t\t\t\t\n\t\tvoid main() {\n\t\t\t#include <logdepthbuf_frag>\n\t\t\t//Transform the coordinates it from [-1;1] to [0;1]\n\t\t\tvec2 texc = vec2(((projectedCoords.x / projectedCoords.w) + 1.0 ) / 2.0,\n\t\t\t\t\t\t\t((projectedCoords.y / projectedCoords.w) + 1.0 ) / 2.0 );\n\n\t\t\t//The back position is the world space position stored in the texture.\n\t\t\tvec3 backPos = texture2D(rtTexture, texc).xyz;\n\n\t\t\t//The front position is the world space position of the second render pass.\n\t\t\tvec3 coord = cartesianToCartographic(v_lonlat);\n\t\t\tvec3 frontPos = uniformBox? worldSpaceCoords:coord;// \n\n\t\t\t//The direction from the front position to back position.\n\t\t\tvec3 dir = backPos - frontPos;\n\n\t\t\tfloat rayLength = length(dir);\n\n\t\t\t//Calculate how long to increment in each step.\n\t\t\tfloat stepSize = 1.0 / float(numSamples);\n\n\t\t\t//The increment in each direction for each step.\n\t\t\tvec3 deltaDirection = normalize(dir) * stepSize;\n\t\t\tfloat deltaDirectionLength = length(deltaDirection);\n\n\t\t\t//Start the ray casting from the front position.\n\t\t\tvec3 currentPosition = frontPos;\n\n\t\t\t//The color accumulator.\n\t\t\tvec4 accumulatedColor = vec4(0.0);\n\n\t\t\t//The alpha value accumulated so far.\n\t\t\tfloat accumulatedAlpha = 0.0;\n\n\t\t\t//How long has the ray travelled so far.\n\t\t\tfloat accumulatedLength = 0.0;\n\t\t\tfloat travel = length(dir);\n\n\t\t\t//If we have twice as many samples, we only need ~1/2 the alpha per sample.\n\t\t\t//Scaling by 256/10 just happens to give a good value for the alphaCorrection slider.\n\t\t\tfloat alphaScaleFactor = zsliceNum * 0.5 * stepSize;\n\n\t\t\tvec4 colorSample;\n\t\t\tfloat alphaSample;\n\t\t\tvec3 planeNormal = normalize(planeComponents.xyz);\n\n\t\t\t//Perform the ray marching iterations\n\t\t\tfor(int i = 0; i < numSamples; i++)\n\t\t\t{\n\t\t\t\tif (travel <= 0.0) break;\n\n\t\t\t\t//Get the voxel intensity value from the 3D texture.\n\t\t\t\tcolorSample = sampleAs3DTexture( currentPosition );\n\n\t\t\t\t//Allow the alpha correction customization.\n\t\t\t\talphaSample = colorSample.a * alphaCorrection;\n\n\t\t\t\t//Applying this effect to both the color and alpha accumulation results in more realistic transparency.\n\t\t\t\talphaSample *= (1.0 - accumulatedAlpha);\n\n\t\t\t\t//Scaling alpha by the number of steps makes the final color invariant to the step size.\n\t\t\t\talphaSample *= alphaScaleFactor;\n\n\t\t\t\t// add clipping plane: planeNormal  planeconstant =planeComponents.w;\n\t\t\t\tif((planeNormal.x*currentPosition.x+planeNormal.y*currentPosition.y+planeNormal.z*currentPosition.z-planeComponents.w)>0.){\n\t\t\t\t\t//Perform the composition.\n\t\t\t\t\taccumulatedColor += colorSample * alphaSample; \n\n\t\t\t\t\t//Store the alpha accumulated so far.\n\t\t\t\t\taccumulatedAlpha += alphaSample;\n\t\t\t\t}\n\n\n\t\t\t\t//Advance the ray.\n\t\t\t\tcurrentPosition += deltaDirection;\n\t\t\t\taccumulatedLength += deltaDirectionLength;\n\t\t\t\ttravel -= deltaDirectionLength;\n\n\t\t\t\t//If the length traversed is more than the ray length, or if the alpha accumulated reaches 1.0 then exit.\n\t\t\t\tif( accumulatedAlpha >= 1.0 )\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tgl_FragColor.rgb = accumulatedColor.rgb; \n\t\t\tgl_FragColor.a = accumulatedAlpha * u_Opacity;\n\t\t}\n\t")}),PN=function(e){LP(r,e);var t=wN(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),(e=t.call(this,n.external.uScene))._mesh=null;var i=n.external.param;e._steps=THING.Utils.parseValue(i.steps,512),e._alphaCorrection=THING.Utils.parseValue(i.alphaCorrection,.5),e.dimensions=[i.extent.maxX-i.extent.minX,i.extent.maxY-i.extent.minY,i.extent.maxZ-i.extent.minZ],e._vertexData=i.vertexData,e._minPos=i.minPos,e._maxPos=i.maxPos,e._extent=i.extent,e._uniformBox=THING.Utils.parseValue(i.uniformBox,!0),e._zsliceNum=THING.Utils.parseValue(i.zsliceNum,256),i.clippingPlane&&e._updataChipPlane(i.clippingPlane),e._grad=THING.Utils.parseValue(i.gradient,{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"});var a=e._createCanvas();if(a.width=256,a.height=1,e._gradCtx=a.getContext("2d"),e._originalGrad=e._grad,e._gradTexture=e._gradient(e._grad),MN.uniforms.colorRampTexture=e._gradTexture,MN.uniforms.zsliceNum=e._zsliceNum,MN.uniforms.zslicex=Math.sqrt(e._zsliceNum),MN.uniforms.zslicey=Math.sqrt(e._zsliceNum),MN.uniforms.numSamples=Math.ceil(1.7320508075688772*e.steps),MN.uniforms.alphaCorrection=e._alphaCorrection,e._clippingPlane&&(MN.uniforms.planeComponents=[e._clippingPlane.normal[0],e._clippingPlane.normal[1],e._clippingPlane.normal[2],e.normalConstant]),i.cubeTexData){var s=i.cubeTexData,o=new Bp;o.flipY=!1,o.image={data:s.data,width:s.width,height:s.height},o.magFilter=Vc.LINEAR,o.minFilter=Vc.LINEAR,o.type=jc.UNSIGNED_BYTE,o.format=zc.RGBA,o.wrapS=o.wrapT=Gc.CLAMP_TO_EDGE,o.internalformat=null,o.generateMipmaps=!1,o.version++,e._cubeTex=o}else if(i.cubeTexUrl){var l=CN.load(i.cubeTexUrl);l.generateMipmaps=!1,l.minFilter=Vc.LINEAR,l.magFilter=Vc.LINEAR,e._cubeTex=l}e.rttscene=new Nd,e.rttcamera=new Bd;var u=i.camera;return e.rttcamera.position.set(u.position[0],u.position[1],u.position[2]),e.rttcamera.lookAt(new bc(u.target[0],u.target[1],u.target[2]),new bc(u.up[0],u.up[1],u.up[2])),e.rttcamera.setPerspective(u.fov*Math.PI/180,u.aspect,u.near,u.far),e.rttscene.add(e.rttcamera),e._boxGeometry=e._createGeo(),DN.uniforms.u_minPos=e._minPos,DN.uniforms.u_maxPos=e._maxPos,DN.uniforms.uniformBox=e._uniformBox,DN.side=Lc.BACK,DN.uniforms.dimensions=[e.dimensions[0],e.dimensions[1],e.dimensions[2]],e._rttbox=new ap(e._boxGeometry,DN),e.rttscene.add(e._rttbox),e.renderer=i.renderer,e.backRenderTarget=e.renderer.backRenderTarget,e.createRenderTarget(),e.drawRttTexture(),e._createNode(),e}return BP(r,[{key:"gradient",get:function(){return this._grad},set:function(e){this._originalGrad=this._grad,this._mesh.material.uniforms.colorRampTexture=null,"object"===FP(e)&&null!==e&&Object.keys(e).length>0&&(this._gradTexture=this._gradient(e),this._mesh.material.uniforms.colorRampTexture=this._gradTexture),this._grad=e,this.drawRttTexture()}},{key:"steps",get:function(){return this._steps},set:function(e){this._steps=e,this._mesh.material.uniforms.numSamples=Math.ceil(1.7320508075688772*this._steps)}},{key:"alphaCorrection",get:function(){return this._alphaCorrection},set:function(e){this._alphaCorrection=e,this._mesh.material.uniforms.alphaCorrection=this._alphaCorrection}},{key:"cubeTex",get:function(){return this._cubeTex},set:function(e){if("string"==typeof e){var t=CN.load(e);t.generateMipmaps=!1,t.minFilter=Vc.LINEAR,t.magFilter=Vc.LINEAR,this._cubeTex=t,this._mesh.material.uniforms.cubeTex=this._cubeTex}else e instanceof Object&&(this._cubeTex.image={data:e.data,width:e.width,height:e.height},this._cubeTex.version++,this._mesh.material.uniforms.cubeTex=this._cubeTex)}},{key:"_createGeo",value:function(){var e;if(this._vertexData){var t=this._vertexData;e=new _p,t.index&&e.setIndex(new up(new cp(t.position.length/3>65536?new Uint32Array(t.index):new Uint16Array(t.index),1))),e.groups=this._vertexData.group,e.addAttribute("a_Position",new up(new cp(new Float32Array(t.position),3))),e.addAttribute("a_Uv",new up(new cp(new Float32Array(t.uv),2))),e.addAttribute("a_Lonlat",new up(new cp(new Float32Array(t.lonlat),3)))}else{e=new cm(this.dimensions[0],this.dimensions[1],this.dimensions[2]);for(var r=(this._extent.maxX+this._extent.minX)/2,n=(this._extent.maxY+this._extent.minY)/2,i=(this._extent.maxZ+this._extent.minZ)/2,a=0;a<e.attributes.a_Position.buffer.count;a++)e.attributes.a_Position.buffer.array[3*a]+=r,e.attributes.a_Position.buffer.array[3*a+1]+=n,e.attributes.a_Position.buffer.array[3*a+2]+=i}return e.computeBoundingBox(),e.computeBoundingSphere(),e}},{key:"_createNode",value:function(){this._minPos&&this._maxPos&&(MN.uniforms.u_minPos=this._minPos,MN.uniforms.u_maxPos=this._maxPos),MN.uniforms.uniformBox=this._uniformBox,this._mesh?this._mesh.material.uniforms.rtTexture=this.renderTarget.texture:(MN.uniforms.rtTexture=this.renderTarget.texture,MN.uniforms.cubeTex=this._cubeTex,MN.side=Lc.FRONT,MN.uniforms.dimensions=[this.dimensions[0],this.dimensions[1],this.dimensions[2]],MN.transparent=!0,MN.depthWrite=!1,this._mesh=new ap(this._boxGeometry,MN),this.$markChildrenMatrixAutoUpdate(!1),this._node.add(this._mesh))}},{key:"drawRttTexture",value:function(){this.rttscene.updateMatrix(),this.rttscene.updateRenderStates(this.rttcamera),this.rttscene.updateRenderQueue(this.rttcamera),this.renderer.renderPass.setRenderTarget(this.renderTarget),this.renderer.renderPass.setClearColor(0,0,0,0),this.renderer.renderPass.clear(!0,!0,!0),this.renderer.renderScene(this.rttscene,this.rttcamera)}},{key:"createRenderTarget",value:function(){this.renderTarget=new Em(1024,1024),this.renderTarget.texture.magFilter=Vc.NEAREST,this.renderTarget.texture.minFilter=Vc.NEAREST,this.renderTarget.texture.wrapS=Gc.CLAMP_TO_EDGE,this.renderTarget.texture.wrapT=Gc.CLAMP_TO_EDGE,this.renderTarget.texture.format=zc.RGBA,this.renderTarget.texture.generateMipmaps=!1}},{key:"dispose",value:function(){this.renderTarget.dispose(),this._gradTexture.dispose(),this._rttbox.material.dispose(),this._rttbox.geometry.dispose(),this._grad=null,this._originalGrad=null,this._gradCtx=null,this._mesh&&(this._mesh.material.dispose(),this._mesh.geometry.dispose()),OP(IP(r.prototype),"dispose",this).call(this)}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this}},{key:"_getGradientCode",value:function(e){var t="grad:(";for(var r in e)t+=r+":"+e[r]+",";return t+=")"}},{key:"_gradient",value:function(e){if(this._getGradientCode(this._originalGrad)===this._getGradientCode(e)&&null!=this._gradTexture)return this._gradTexture;var t=this._gradCtx.createLinearGradient(0,0,256,0);for(var r in e)t.addColorStop(+r,e[r]);this._gradCtx.fillStyle=t,this._gradCtx.fillRect(0,0,256,1);var n=new Bp;return n.image=this._gradCtx.canvas,n.version++,this._gradTexture=n,n}},{key:"_createCanvas",value:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}},{key:"_updataChipPlane",value:function(e){var t=new bc(e.normal[0],e.normal[1],e.normal[2]).normalize(),r=e.constant;if(this.normalConstant=r,this._vertexData){var n=6378e3*Math.acos(Math.cos(this._maxPos[1])*Math.cos(this._maxPos[1])*Math.cos(this._maxPos[0]-this._minPos[0])+Math.sin(this._maxPos[1])*Math.sin(this._maxPos[1])),i=6378e3*Math.acos(Math.cos(this._maxPos[1]-this._minPos[1])),a=this._maxPos[2]-this._minPos[2],s=new bc(t.x/n,t.y/i,t.z/a).getLength();this.normalConstant=r*s}this._clippingPlane={normal:[t.x,t.y,t.z],constant:r},this._mesh&&(this._mesh.material.uniforms.planeComponents=[this._clippingPlane.normal[0],this._clippingPlane.normal[1],this._clippingPlane.normal[2],this.normalConstant],this._mesh.material.needsUpdate=!0)}}]),r}(QE);function FN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var RN={uniforms:{stretchFactor:0,stretchDirection:[0,0,1]},vertexShader:"\n        #include <common_vert>\n\n        attribute vec2 a_Uv;\n        varying vec2 v_Uv;\n        \n        void main() {\n            v_Uv = a_Uv;\n            vec4 worldPosition = u_Model * vec4(a_Position, 1.0);\n            worldPosition.xyz += u_CameraPosition;\n            gl_Position = u_ProjectionView * worldPosition;\n            gl_Position.z = gl_Position.w;\n        }\n    ",fragmentShader:"\n        uniform float stretchFactor;\n\t\tuniform vec3 stretchDirection;\n\n        uniform sampler2D diffuseMap;\n        uniform float u_Opacity;\n\t\tuniform vec3 u_Color;\n\t\tuniform mat4 u_Model;\n\n\t\tvarying vec2 v_Uv;\n\n\t\t// spherical coordinates:\n\t\t// phi: lateral angle, start from -x axis, [0-2PI]\n\t\t// theta: lateral angle, start from +y axis, [0-PI]\n\n\t\t// uv -> spherical -> vector3\n\t\tvoid uvToVector3(in vec2 uv, out vec3 vector) {\n\t\t\tfloat phi = uv.x * 2. * PI;\n\t\t\tfloat theta = -uv.y * PI;\n\n\t\t\tvector.x = -cos(phi) * sin(theta);\n\t\t\tvector.y = cos(theta);\n\t\t\tvector.z = -sin(phi) * sin(theta);\n\n\t\t\tvector = normalize(vector);\n\t\t}\n\n\t\t// vector3 -> spherical -> uv\n\t\tvoid vector3ToUV(in vec3 vector, out vec2 uv) {\n\t\t\tfloat theta = acos(vector.y);\n\t\t\tfloat phi = atan(vector.z, vector.x);\n\t\t\tuv.x = phi / 2.0 / PI;\n\t\t\tuv.y = theta / PI;\n\t\t}\n\n\t\tvec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {\n\t\t\treturn normalize((vec4(dir, 0.0) * matrix).xyz);\n\t\t}\n\n\t\tvoid applyStretch(inout vec2 uv) {\n\t\t\tvec3 direction = vec3(0.0, 0.0, 0.0);\n\n\t\t\tuvToVector3(uv, direction);\n\n\t\t\tvec3 targetDirection = inverseTransformDirection(stretchDirection, u_Model);\n\t\t\tvec3 delta = direction - targetDirection;\n\t\t\tdirection += delta * stretchFactor;\n\t\t\tdirection = normalize(direction);\n\n\t\t\tvector3ToUV(direction, uv);\n\t\t}\n\n        void main() {\n\t\t\tvec4 col = vec4(u_Color, u_Opacity);\n\n            vec2 uv = v_Uv;\n            uv.x = 1. - uv.x;\n\n\t\t\tapplyStretch(uv);\n\n            col.xyz *= texture2D(diffuseMap, fract(uv)).xyz;\n\n            gl_FragColor = col;\n        }\n    "},NN=function(e){LP(r,e);var t=FN(r);function r(){var e;return PP(this,r),(e=t.call(this,{type:"PanoMaterial",defines:{},uniforms:RN.uniforms,vertexShader:RN.vertexShader,fragmentShader:RN.fragmentShader})).transparent=!0,e.depthTest=!1,e.depthWrite=!1,e.side=Lc.BACK,e}return BP(r)}(bp);function BN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var IN=function(e){LP(r,e);var t=BN(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),e=t.call(this,n.external.uScene);var i=new dm(n.external.param.radius||10,60,40),a=new NN,s=new ap(i,a);return s.renderOrder=-999,s.frustumCulled=!1,e._node.add(s),e.$markChildrenMatrixAutoUpdate(!1),e._mesh=s,e}return BP(r,[{key:"getType",value:function(){return"PanoObject"}},{key:"dispose",value:function(){this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,OP(IP(r.prototype),"dispose",this).call(this)}},{key:"stretchFactor",get:function(){return this._mesh.material.uniforms.stretchFactor},set:function(e){this._mesh.material.uniforms.stretchFactor=e}},{key:"stretchDirection",get:function(){return this._mesh.material.uniforms.stretchDirection},set:function(e){this._mesh.material.uniforms.stretchDirection=e}}]),r}(QE);function ON(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var kN=function(e){LP(r,e);var t=ON(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),(e=t.call(this,n.external.uScene))._disposeArray=void 0===n.external.disposeArray||n.external.disposeArray,e._wireframe=n.external.wireframe,e._texWidth=n.external.textureLength,e._texHeigth=1,e._dataTexture=e.createTexture(e._texWidth,e._texHeigth,n.external.simulateData),e._grad=n.external.gradient;var i=e._createCanvas();i.width=256,i.height=1,e._gradCtx=i.getContext("2d"),e._gradTexture=null,e._originalGrad=e._grad,e.colorRampTexture=e._gradient(e._grad);var a,s=new bp({defines:{},vertexShader:"\t\t\t\t#include <common_vert>\n\t\t\t\tprecision mediump float;\n\t\t\t\tattribute vec2 a_Uv;\n\t\t\t\tattribute float a_index;\n\t\t\t\tattribute vec2 a_velcity;\n\t\t\t\tvarying vec2 v_UV;\n\t\t\t\tvarying vec4 v_H;\n\t\t\t\tuniform sampler2D u_textureMap;\n\t\t\t\tuniform sampler2D u_ramp;\n\t\t\t\tuniform float ratio;\n\t\t\t\t#include <logdepthbuf_pars_vert>\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat index = a_index-0.5;\n\t\t\t\t\t// u_textureMap H[0-1.875] U[-2.279   4.115] V[-3.485 3.485\t] L [0-3.0];\n\t\t\t\t\tfloat H = texture2D(u_textureMap,vec2(index/9211.,0.5)).w;\n\t\t\t\t\tfloat Surface = texture2D(u_textureMap,vec2(index/9211.,0.5)).w;\n\t\t\t\t\tv_H = texture2D(u_ramp,vec2(H/1.875,0.5));\n\n\t\t\t\t\tv_UV = vec2(index/9211.,0.5);\n\t\t\t\t\tvec4 position =vec4(a_Position.x, 4.* (H) ,a_Position.z, 1);//\n\t\t\t\t\tgl_Position = u_ProjectionView * u_Model * position;\n\n\t\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t\t}\n\t\t\t\t\n\t\t\t",fragmentShader:"\t\t\t\t#include <common_frag>\n\t\t\t\tprecision mediump float;\n\t\t\t\tuniform sampler2D u_noise;\n\t\t\t\tuniform sampler2D u_ramp;\n\t\t\t\tvarying vec2 v_UV;\n\t\t\t\tvarying vec4 v_H;\n\t\t\t\tuniform sampler2D u_textureMap;\n\t\t\t\t\n\t\t\t\t#include <logdepthbuf_pars_frag>\n\t\t\t\tvoid main() {\n\t\t\t\t\t#include <logdepthbuf_frag>\n\t\t\t\t\tvec4 uv_color=vec4(v_UV,0,1.);\n\t\t\t\t\tif(uv_color.a < 1.0) uv_color.a=1.0;\n\t\t\t\t\tgl_FragColor =  v_H;// texture2D(u_ramp,vec2(v_H/1.875,0.5));// color;\n\t\t\t\t}\n\t\t\t",uniforms:{u_textureMap:e._dataTexture,u_ramp:e.colorRampTexture}});(a=e.genGeo(n.external.vertexData)).computeBoundingBox(),a.computeBoundingSphere(),e._geometry=a;var o=null;if(e.wireframe){s.drawMode=Kc.LINES;var l=new _p;l.attributes=a.attributes,l.morphAttributes=a.morphAttributes,l.index=Gb.getWireframeAttribute(a),l.boundingBox=a.boundingBox,l.boundingSphere=a.boundingSphere,o=new ap(l,s)}else o=new ap(a,s);return o.material.side=Lc.DOUBLE,o.material.needsUpdate=!0,e._node.add(o),e._mesh=o,e}return BP(r,[{key:"wireframe",get:function(){return this._wireframe},set:function(e){if(e){this._mesh.material.drawMode=Kc.LINES;var t=new _p;t.attributes=this._geometry.attributes,t.morphAttributes=this._geometry.morphAttributes,t.index=Gb.getWireframeAttribute(this._geometry),t.boundingBox=this._geometry.boundingBox,t.boundingSphere=this._geometry.boundingSphere,this._mesh.geometry=t}else this._mesh.geometry=this._geometry,this._mesh.material.drawMode=Kc.TRIANGLES}},{key:"getType",value:function(){return"Water"}},{key:"genGeo",value:function(e){var t=new _p,r=new cp(new Float32Array(e.position),3);r.usage=Jc.DYNAMIC_DRAW,t.addAttribute("a_Position",new up(r,3));var n=new cp(new Float32Array(e.dataIndex),1);n.usage=Jc.DYNAMIC_DRAW,t.addAttribute("a_index",new up(n,1));var i=new cp(new Float64Array(e.uv),2);return i.usage=Jc.DYNAMIC_DRAW,t.addAttribute("a_Uv",new up(i,2)),e.index&&t.setIndex(new up(new cp(new Uint16Array(e.index),1))),t.computeBoundingBox(),t.computeBoundingSphere(),Gb.computeNormals(t),t}},{key:"gradient",get:function(){return this._grad},set:function(e){this._originalGrad=this._grad,this.colorRampTexture=this._gradient(e),this._grad=e}},{key:"createTexture",value:function(e,t,r){var n=new Bp;return n.image={data:r,width:e,height:t},n.magFilter=Vc.NEAREST,n.minFilter=Vc.NEAREST,n.format=zc.RGBA,n.generateMipmaps=!1,n.type=jc.FLOAT,n.internalformat=zc.RGBA32F,n.version++,n}},{key:"update",value:function(e){this._noiseTime+=e*this._noiseTimeScale*.108}},{key:"dispose",value:function(){OP(IP(r.prototype),"dispose",this).call(this),this._mesh.removeBeforeRenderFunction(this._binding),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,this._binding=null}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e,!1),this._flowOffset=e._flowOffset.slice(),this._flowWeight=e._flowWeight,this._reflectDistortion=e._reflectDistortion,this._reflectWeight=e._reflectWeight,this._noiseTime=e._noiseTime,this._noiseTimeScale=e._noiseTimeScale,this._size=e._size,this}},{key:"_getGradientCode",value:function(e){var t="grad:(";for(var r in e)t+=r+":"+e[r]+",";return t+=")"}},{key:"_gradient",value:function(e){if(this._getGradientCode(this._originalGrad)===this._getGradientCode(e)&&null!=this._gradTexture)return this._gradTexture;var t=this._gradCtx.createLinearGradient(0,0,256,0);for(var r in e)t.addColorStop(+r,e[r]);this._gradCtx.fillStyle=t,this._gradCtx.fillRect(0,0,256,1);var n=new Bp;return n.image=this._gradCtx.canvas,n.version++,this._gradTexture=n,n}},{key:"_createCanvas",value:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}]),r}(QE);function LN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var UN=function(e){LP(r,e);var t=LN(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),(e=t.call(this,n.external.uScene))._disposeArray=void 0===n.external.disposeArray||n.external.disposeArray,e.wireframe=n.external.wireframe,e.renderType=n.external.renderType,e._maxHeight=n.external.maxHeight,e._minHeight=n.external.minHeight,e._maxElevation=n.external.maxElevation,e._minElevation=n.external.minElevation,e._maxVel=n.external.maxVel,e._minVel=n.external.minVel,e._arrow_density=void 0===n.external.arrow_density?200:n.external.arrow_density,e._arrow_length=void 0===n.external.arrow_length?.05:n.external.arrow_length,e._arrow_thinness=void 0===n.external.arrow_thinness?2e3:n.external.arrow_thinness,e._arrow_head=void 0===n.external.arrow_head?8:n.external.arrow_head,e._arrow_openness=void 0===n.external.arrow_openness?.2:n.external.arrow_openness,e._areaSize=void 0===n.external.areaSize?[1,1]:n.external.areaSize,e._grad=n.external.gradient;var i=e._createCanvas();i.width=256,i.height=1,e._gradCtx=i.getContext("2d"),e._gradTexture=null,e._originalGrad=e._grad,e.colorRampTexture=e._gradient(e._grad);var a,s=new bp({defines:{},vertexShader:"\t\t\t\t#include <common_vert>\n\t\t\t\tprecision mediump float;\n\t\t\t\tattribute vec2 a_Uv;\n\t\t\t\tvarying vec2 v_UV;\n\t\t\t\tvarying float v_H;\n\t\t\t\tuniform float u_maxVel;\n\t\t\t\tuniform float u_minVel;\n\t\t\t\tuniform float u_maxElevation;\n\t\t\t\tuniform float u_minElevation;\n\n\t\t\t\t#include <logdepthbuf_pars_vert>\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tv_H = (-a_Position.y-u_minElevation)/(u_maxElevation -u_minElevation);\n\t\t\t\t\tvec4 position = vec4(a_Position.x, -a_Position.y ,a_Position.z, 1);\n\t\t\t\t\tgl_Position = u_ProjectionView * u_Model * position;\n\n\t\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t\t}\n\t\t\t\t\n\t\t\t",fragmentShader:"\t\t\t\t#include <common_frag>\n\t\t\t\tprecision mediump float;\n\t\t\t\tvarying vec2 v_UV;\n\t\t\t\tvarying float v_H;\n\n\t\t\t\t#include <logdepthbuf_pars_frag>\n\t\t\t\tvoid main() {\n\t\t\t\t\t#include <logdepthbuf_frag>\n\t\t\t\t\tgl_FragColor= vec4(v_H,v_H,v_H,1.);\n\t\t\t\t\t\n\n\t\t\t\t}\n\t\t\t",uniforms:{u_textureMap:e._dataTexture,u_ramp:e.colorRampTexture,u_renderType:e.renderType,u_maxHeight:e._maxHeight,u_minHeight:e._minHeight,u_maxElevation:e._maxElevation,u_minElevation:e._minElevation,u_maxVel:e._maxVel,u_minVel:e._minVel}}),o=new bp({defines:{ARROW_FLOW:!0,LIC_FLOW:!0},vertexShader:"\t\t\t\t#include <common_vert>\n\t\t\t\tprecision mediump float;\n\t\t\t\tattribute vec2 a_Uv;\n\t\t\t\tattribute vec4 a_simuData;\n\t\t\t\tattribute vec2 a_velcity;\n\t\t\t\tvarying vec2 v_uv;\n\t\t\t\tvarying float v_H;\n\t\t\t\tvarying float v_terrain;\n\t\t\t\tvarying float v_surface;\n\t\t\t\tvarying vec3 v_Vel;\n\t\t\t\tuniform sampler2D u_textureMap;\n\t\t\t\tuniform sampler2D u_ramp;\n\t\t\t\tuniform int renderType;\n\t\t\t\tuniform float u_maxHeight;\n\t\t\t\tuniform float u_minHeight;\n\t\t\t\tuniform float u_maxElevation;\n\t\t\t\tuniform float u_minElevation;\n\t\t\t\tuniform float u_maxVel;\n\t\t\t\tuniform float u_minVel;\n\t\t\t\tuniform int u_renderType;\n\n\t\t\t\t#include <logdepthbuf_pars_vert>\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tv_terrain = -a_Position.y;\n\t\t\t\t\tv_surface = a_simuData.x;\n\t\t\t\t\tfloat H =  v_surface - v_terrain;//rotatex=180\n\t\t\t\t\tv_Vel = a_simuData.yzw;\n\t\t\t\t\t// float uVel = a_simuData.y;\n\t\t\t\t\t// float vVel = a_simuData.z;\n\t\t\t\t\tv_H = H;\n\t\t\t\t\tv_uv = a_Uv;\n\t\t\t\t\tvec4 position;\n\t\t\t\t\tif(u_renderType ==0){\n\n\t\t\t\t\t\tposition =vec4(a_Position.x, u_maxHeight ,a_Position.z, 1);\n\t\t\t\t\t}else{\n\n\t\t\t\t\t\tposition =vec4(a_Position.x, v_surface ,a_Position.z, 1);\n\t\t\t\t\t}\n\t\t\t\t\tgl_Position = u_ProjectionView * u_Model * position;\n\n\t\t\t\t\t#include <logdepthbuf_vert>\n\t\t\t\t}\n\t\t\t\t\n\t\t\t",fragmentShader:"\t\t\t\t#include <common_frag>\n\t\t\t\tprecision mediump float;\n\t\t\t\tuniform sampler2D u_noise;\n\t\t\t\t\n\t\t\t\tuniform sampler2D u_ramp;\n\t\t\t\tvarying vec2 v_uv;\n\t\t\t\tvarying float v_H;\n\t\t\t\tvarying float v_terrain;\n\t\t\t\tvarying float v_surface;\n\t\t\t\tvarying vec3 v_Vel;\n\t\t\t\tuniform sampler2D u_textureMap;\n\t\t\t\tuniform float u_maxHeight;\n\t\t\t\tuniform float u_minHeight;\n\t\t\t\tuniform float u_maxElevation;\n\t\t\t\tuniform float u_minElevation;\n\t\t\t\tuniform float u_maxVel;\n\t\t\t\tuniform float u_minVel;\n\t\t\t\tuniform int u_renderType;\n\t\t\t\tuniform float u_time;\n\t\t\t\tuniform vec2 areaSize;\n\n\t\t\t\tuniform float LIC_thinness;\n\t\t\t\tuniform float LIC_speed;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t#ifdef ARROW_FLOW\n\t\t\t\t\tuniform float arrow_density;\n\t\t\t\t\tuniform float arrow_length;\n\t\t\t\t\tuniform float arrow_thinness;\n\t\t\t\t\tuniform float arrow_head;\n\t\t\t\t\tuniform float arrow_openness;\n\t\t\t\t\t//----arrow flow field2--------------------\n\t\t\t\t\t// #define arrow_density  200. //网格密度，=1/网格大小\n\t\t\t\t\t// #define arrow_length   .05\n\t\t\t\t\t// #define arrow_thinness 2000.\n\t\t\t\t\t// #define arrow_head .8\n\t\t\t\t\t// #define arrow_openness .2\n\t\t\t\t\n\t\t\t\t\t//-------------------------------------------------------------\n\n\t\t\t\t\tfloat segm(in vec2 p, in vec2 a, in vec2 b){ \n\t\t\t\t\t\tvec2 ap = p - a;\n\t\t\t\t\t\tvec2 ab = b - a;\n\t\t\t\t\t\tfloat projection_factor = clamp(dot(ap,ab) / dot(ab,ab), 0., 1.);\n\t\t\t\t\t\tvec2 ap_proj_ab = ab * projection_factor;\n\t\t\t\t\t\treturn length(ap - ap_proj_ab) * arrow_thinness;\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat draw_arrows(in vec2 p,in vec2 vel){\n\t\t\t\t\t\tvec2 ip = floor(p * arrow_density) / arrow_density + .5 / arrow_density;   \n\t\t\t\t\t\tvec2 field_image = vel;//field(ip);\n\t\t\t\t\t\tfloat norm = length(field_image) * (arrow_length / arrow_density);\n\n\t\t\t\t\t\tvec2 b = normalize(field_image) * norm;\n\t\t\t\t\t\tvec2 prp = vec2(-b.y, b.x);\n\n\t\t\t\t\t\tfloat rz = segm(p, ip, ip+b);\n\t\t\t\t\t\trz = min(rz, segm(p, ip + b, ip + b * arrow_head + prp * arrow_openness));\n\t\t\t\t\t\trz = min(rz, segm(p, ip + b, ip + b * arrow_head - prp * arrow_openness));\n\t\t\t\t\t\treturn rz;\n\t\t\t\t\t}\n\t\t\t\t#endif \n\n\t\t\t\t#ifdef LIC_FLOW\n\t\t\t\tfloat hash(vec3 p)  // replace this by something better\n\t\t\t\t{\n\t\t\t\t\tp  = fract( p*0.3183099+.1 );\n\t\t\t\t\tp *= 17.0;\n\t\t\t\t\treturn fract( p.x*p.y*p.z*(p.x+p.y+p.z) );\n\t\t\t\t}\n\n\t\t\t\tfloat noise(vec2 xx)\n\t\t\t\t{\n\t\t\t\t\tvec3 x = vec3(xx, u_time*20.0);\n\t\t\t\t\tvec3 p = floor(x);\n\t\t\t\t\tvec3 f = fract(x);\n\t\t\t\t\tf = f*f*(3.0-2.0*f);\n\t\t\t\t\t\n\t\t\t\t\treturn mix(mix(mix( hash(p+vec3(0,0,0)), \n\t\t\t\t\t\t\t\t\t\thash(p+vec3(1,0,0)),f.x),\n\t\t\t\t\t\t\t\tmix( hash(p+vec3(0,1,0)), \n\t\t\t\t\t\t\t\t\t\thash(p+vec3(1,1,0)),f.x),f.y),\n\t\t\t\t\t\t\tmix(mix( hash(p+vec3(0,0,1)), \n\t\t\t\t\t\t\t\t\t\thash(p+vec3(1,0,1)),f.x),\n\t\t\t\t\t\t\t\tmix( hash(p+vec3(0,1,1)), \n\t\t\t\t\t\t\t\t\t\thash(p+vec3(1,1,1)),f.x),f.y),f.z);\n\t\t\t\t}\n\t\t\t\t#endif \n\n\t\t\t\t#include <logdepthbuf_pars_frag>\n\t\t\t\tvoid main() {\n\t\t\t\t\t#include <logdepthbuf_frag>\n\n\t\t\t\t\tvec2 vecl = v_Vel.xy;\n\t\t\t\t\tvec2 sampUV;\n\t\t\t\t\tvec4 samperColor;\n\t\t\t\t\tif(u_renderType ==0){\n\t\t\t\t\t\tsampUV = vec2((v_H-u_minHeight)/(u_maxHeight -u_minHeight),0.5);\n\t\t\t\t\t\tgl_FragColor = texture2D(u_ramp, sampUV);\n\t\t\t\t\t}\n\t\t\t\t\telse if( u_renderType ==1 )\n\t\t\t\t\t{\n\t\t\t\t\t\tsampUV = vec2((v_surface-u_minElevation)/(u_maxElevation -u_minElevation),0.5);\n\t\t\t\t\t\tgl_FragColor = texture2D(u_ramp, sampUV);\n\t\t\t\t\t}\n\t\t\t\t\telse if(u_renderType == 2){\n\t\t\t\t\t\tsampUV = vec2((v_Vel.z-u_minVel)/(u_maxVel -u_minVel),0.5);\n\t\t\t\t\t\tsamperColor = texture2D(u_ramp, sampUV);\n\t\t\t\t\t\t//----------LIC-----------------\n\t\t\t\t\t\tvec3 sum = vec3(0.0);\n\t\t\t\t\t\tvec2 p = v_uv.xy * areaSize;\n\t\t\t\t\t\tvec2 p1 =p;\n\t\t\t\t\t\tvec2 p2 =p;\n\t\t\t\t\t\tconst float k = 10.0;\n\t\t\t\t\t\tfor (float i=0.0; i<k; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvec2 vel = normalize(vecl);\n\t\t\t\t\t\t\tp1 += vel * LIC_speed ;\n\t\t\t\t\t\t\t// vel = vecl;\n\t\t\t\t\t\t\tp2 -= vel* LIC_speed ;\n\t\t\t\t\t\t\tsum += noise( p1 *LIC_thinness )+noise( p2 *LIC_thinness);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsum /= (2.*k+1.);\n\t\t\t\t\t\tif(v_Vel.z < 0.001){\n\t\t\t\t\t\t\t// gl_FragColor =vec4(sum,0.2);\n\t\t\t\t\t\t\tgl_FragColor = samperColor;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t// gl_FragColor=  vec4(sum,1);//texture2D(u_noise,v_uv*20.);//\n\t\t\t\t\t\t\t// gl_FragColor.rgb =  sum - (vec3(1.)-samperColor.rgb)* (vec3(1.)-sum)/samperColor.rgb;\n\t\t\t\t\t\t\tgl_FragColor.rgb =  sum +samperColor.rgb-vec3(1.);\n\t\t\t\t\t\t\tgl_FragColor.a = samperColor.a;\n\t\t\t\t\t\t}\n\t\t\t\t\t}else if(u_renderType ==3){\n\t\t\t\t\t\tsampUV = vec2((v_Vel.z-u_minVel)/(u_maxVel -u_minVel),0.5);\n\t\t\t\t\t\tsamperColor = texture2D(u_ramp, sampUV);\n\t\t\t\t\t\t\n\t\t\t\t\t\t//--------------arrow2----------------   \n\t\t\t\t\t\tfloat arrow = draw_arrows(v_uv,vecl);\n\t\t\t\t\t\tif( v_Vel.z< 0.8){\n\t\t\t\t\t\t\t// gl_FragColor =vec4(1.);\n\t\t\t\t\t\t\tgl_FragColor = samperColor;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tgl_FragColor.rgb = min(samperColor.rgb , vec3(pow(arrow,3.)));\n\t\t\t\t\t\t\tgl_FragColor.a = 1.0;\n\t\t\t\t\t\t\t// gl_FragColor = vec4(vec3(arrow),1);//rgb;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tgl_FragColor= vec4(1.);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(v_terrain > v_surface) {discard;}\n\t\t\t\t}\n\t\t\t",uniforms:{u_ramp:e.colorRampTexture,u_renderType:e.renderType,u_maxHeight:e._maxHeight,u_minHeight:e._minHeight,u_maxElevation:e._maxElevation,u_minElevation:e._minElevation,u_maxVel:e._maxVel,u_minVel:e._minVel,u_time:0,arrow_density:e._arrow_density,arrow_length:e._arrow_length,arrow_thinness:e._arrow_thinness,arrow_head:e._arrow_head,arrow_openness:e._arrow_openness,areaSize:e._areaSize,LIC_speed:.4,LIC_thinness:3}});(a=e.genGeo(n.external.vertexData)).computeBoundingBox(),a.computeBoundingSphere(),a.clone(),s.side=Lc.DOUBLE;var l=new ap(a,s),u=null;if(e.wireframe){o.drawMode=Kc.LINES;var c=new _p;c.attributes=a.attributes,c.morphAttributes=a.morphAttributes,c.index=Gb.getWireframeAttribute(a),c.boundingBox=a.boundingBox,c.boundingSphere=a.boundingSphere,u=new ap(c,o)}else u=new ap(a,o);return u.material.side=Lc.DOUBLE,u.material.needsUpdate=!0,e._node.add(u),e._node.add(l),e._mesh=u,e._noiseTimeScale=1,e}return BP(r,[{key:"getType",value:function(){return"Water"}},{key:"genGeo",value:function(e){var t=new _p,r=new cp(new Float32Array(e.position),3);r.usage=Jc.DYNAMIC_DRAW,t.addAttribute("a_Position",new up(r,3));var n=new cp(new Float32Array(e.simulateData),4);if(n.usage=Jc.DYNAMIC_DRAW,t.addAttribute("a_simuData",new up(n,4)),e.uv){var i=new cp(new Float32Array(e.uv),2);i.usage=Jc.DYNAMIC_DRAW,t.addAttribute("a_Uv",new up(i,2))}return e.index&&t.setIndex(new up(new cp(e.position.length/3>65536?new Uint32Array(e.index):new Uint16Array(e.index),1))),t.computeBoundingBox(),t.computeBoundingSphere(),Gb.computeNormals(t),t}},{key:"gradient",get:function(){return this._grad},set:function(e){this._originalGrad=this._grad,this.colorRampTexture=this._gradient(e),this._grad=e}},{key:"createTexture",value:function(e,t,r){var n=new Bp;return n.image={data:r,width:e,height:t},n.magFilter=Vc.NEAREST,n.minFilter=Vc.NEAREST,n.format=zc.RGBA,n.generateMipmaps=!1,n.type=jc.FLOAT,n.internalformat=zc.RGBA32F,n.version++,n}},{key:"update",value:function(e){this._noiseTime+=e*this._noiseTimeScale*.108,this._mesh.material.uniforms.u_time=this._noiseTime}},{key:"dispose",value:function(){OP(IP(r.prototype),"dispose",this).call(this),this._mesh.removeBeforeRenderFunction(this._binding),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null,this._binding=null}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e,!1),this._flowOffset=e._flowOffset.slice(),this._flowWeight=e._flowWeight,this._reflectDistortion=e._reflectDistortion,this._reflectWeight=e._reflectWeight,this._noiseTime=e._noiseTime,this._noiseTimeScale=e._noiseTimeScale,this._size=e._size,this}},{key:"_getGradientCode",value:function(e){var t="grad:(";for(var r in e)t+=r+":"+e[r]+",";return t+=")"}},{key:"_gradient",value:function(e){if(this._getGradientCode(this._originalGrad)===this._getGradientCode(e)&&null!=this._gradTexture)return this._gradTexture;var t=this._gradCtx.createLinearGradient(0,0,256,0);for(var r in e)t.addColorStop(+r,e[r]);this._gradCtx.fillStyle=t,this._gradCtx.fillRect(0,0,256,1);var n=new Bp;return n.image=this._gradCtx.canvas,n.version++,this._gradTexture=n,n}},{key:"_createCanvas",value:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}]),r}(QE);function zN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var jN=new bp({defines:{USE_RELATIVE:!1,USE_UVMAP:!1},vertexShader:"\t\t#include <common_vert>\n\t\tprecision mediump float;\n\t\tvarying vec4 v_position;\n\t\tuniform vec3 center;\n\t\t#ifdef USE_RELATIVE\n\t\t\tuniform mat4 relativeModelMatrix;\n\t\t#endif\n\t\t\n\t\t#include <logdepthbuf_pars_vert>\n\t\tvoid main() {\n\t\t\t// v_Uv = a_Uv;\n\t\t\tvec4 position =u_Model *vec4( a_Position.xyz, 1);\n\t\t\tgl_Position = u_ProjectionView *  position;\n\t\t\t\n\t\t\t#ifdef USE_RELATIVE\n\t\t\t\tv_position = relativeModelMatrix * position;\n\t\t\t#else\n\t\t\t\tv_position = position;\n\t\t\t#endif\n\t\t\t\n\t\t\t#include <logdepthbuf_vert>\n\t\t}\n\n    ",fragmentShader:"\t\t// #include <common_frag>\n\t\tprecision mediump float;\n\t\tuniform vec3 color;\n\n\t\tuniform vec3 maxPos;\n\t\tuniform vec3 minPos;\n\n\t\tvarying vec4 v_position;\n\n\t\t#ifdef USE_UVMAP\n\t\t\tuniform sampler2D uvMap;\n\t\t#endif\n\n\t\tuniform vec3 direction;\n\n\t\t#include <logdepthbuf_pars_frag>\n\n\n\t\tbool isMax(vec3 a, vec3 b){\n\t\t\n\t\t\tfloat ax = a.x;\n\t\t\tfloat ay = a.y;\n\t\t\tfloat az = a.z;\n\n\t\t\tfloat bx = b.x;\n\t\t\tfloat by = b.y;\n\t\t\tfloat bz = b.z;\n\n\t\t\treturn ax > bx && ay > by && az > bz;\n\t\t}\n\n\n\t\tbool isMin(vec3 a, vec3 b){\n\t\t\n\t\t\tfloat ax = a.x;\n\t\t\tfloat ay = a.y;\n\t\t\tfloat az = a.z;\n\n\t\t\tfloat bx = b.x;\n\t\t\tfloat by = b.y;\n\t\t\tfloat bz = b.z;\n\n\t\t\treturn ax < bx && ay < by && az < bz;\n\t\t}\n\n\t\tvoid main() {\n\t\t\t#include <logdepthbuf_frag>\n\t\t\t//        vec3 dir = normalize(direction);\n\t\t\t//\n\t\t\t//        float subb = length((maxPos - minPos)*dir);\n\t\t\t//        float gap = length((v_position.xyz - minPos)*dir);\n\t\t\tfloat subb = length(maxPos.z - minPos.z);\n\t\t\tfloat gap = length(v_position.z - minPos.z);\n\n\t\t\tvec2 texCoord = vec2((gap / subb), 0.5);\n\t\t\tgl_FragColor =vec4(0.,1.,0.,1.);// mix(vec4(0,0,0,0),vec4(color, 1.0),float(isMin(v_position.xyz,maxPos) && isMax(v_position.xyz,minPos)));\n\n\t\t\t#ifdef USE_UVMAP\n\t\t\t\tgl_FragColor.a *= texture2D( uvMap, texCoord ).r;\n\t\t\t#endif\n\t\t}\n\t\n\t",uniforms:{maxPos:[1,1,1],minPos:[0,0,0],color:[0,1,1],uvMap:!1,direction:[0,1,1],relativeModelMatrix:null}}),VN=function(e){LP(r,e);var t=zN(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return PP(this,r),(e=t.call(this,n.external.uScene))._maxPos=THING.Utils.parseValue(n.external.param.maxPos,new bc),e._minPos=THING.Utils.parseValue(n.external.param.minPos,new bc),e._color=THING.Utils.parseValue(n.external.param.color,new bc(1,1,1)),e._isUseUvMap=THING.Utils.parseValue(n.external.param.isUseUvMap,!1),e._relativeModelMatrix=THING.Utils.parseValue(n.external.param.relativeModelMatrix,new Float32Array(16)),jN.defines.USE_UVMAP=n.external.param.isUseUvMap,jN.type="scanning",e._createNode(n),e}return BP(r,[{key:"maxPos",get:function(){return this._maxPos},set:function(e){this._maxPos=e,jN.uniforms.maxPos=this._maxPos,jN.needsUpdate=!0}},{key:"minPos",get:function(){return this._minPos},set:function(e){this._minPos=e,jN.uniforms.minPos=this._minPos,jN.needsUpdate=!0}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,jN.uniforms.color=this._color,jN.needsUpdate=!0}},{key:"_createNode",value:function(e){var t;if(void 0!==e.external.param.geometry){var r=e.external.param.geometry[0],n=new _p;r.index&&(n.index=new up(new cp(r.index,1)));var i=new cp(new Float32Array(r.position),3);i.usage=Jc.DYNAMIC_DRAW,n.addAttribute("a_Position",new up(i,3));var a=new cp(new Float32Array(r.uv),2);a.usage=Jc.DYNAMIC_DRAW,n.addAttribute("a_Uv",new up(a,2));var s=new cp(new Float32Array(r.uv),2);s.usage=Jc.DYNAMIC_DRAW,n.addAttribute("a_Uv2",new up(s,2));var o=new cp(new Float32Array(r.normal),3);o.usage=Jc.DYNAMIC_DRAW,n.addAttribute("a_Normal",new up(o,3)),t=n}else if(e.external.param.vertexData){var l=e.external.param.vertexData;t=new _p,l.index&&t.setIndex(new up(new cp(new Float16Array(l.index),1))),t.addAttribute("a_Position",new up(new cp(new Float32Array(l.position),3))),t.addAttribute("a_Uv",new up(new cp(new Float32Array(l.uv),2)))}else t=new vp(this._width,this._height,512,512);t.computeBoundingBox(),t.computeBoundingSphere(),this._mesh||(this._mesh=new ap(t,jN),this._node.add(this._mesh),this.$markChildrenMatrixAutoUpdate(!1))}},{key:"dispose",value:function(){this._mesh&&(this._mesh.material.dispose(),this._mesh.geometry.dispose()),OP(IP(r.prototype),"dispose",this).call(this)}},{key:"copy",value:function(e){return OP(IP(r.prototype),"copy",this).call(this,e),this}}]),r}(QE);function GN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}var WN=function(e){LP(r,e);var t=GN(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};PP(this,r),(e=t.call(this,n.external.uScene)).font=n.external.param.font,e.text=n.external.param.text,e.fontSize=n.external.param.fontSize||50,e.depth=n.external.param.depth,e._material=null,e._meshes=[];var i=e._generateShapes(e.text,e.fontSize);return e._createNode(i),e}return BP(r,[{key:"_generateShapes",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=[],n=this._createPaths(e,t,this.font),i=0,a=n.length;i<a;i++)this._getShapes(n[i],r);return r}},{key:"_createNode",value:function(e){var t=new fm;t.roughness=.6,t.metalness=.4,this._material=t;for(var r=0;r<e.length;r++){var n=void 0;if(this.depth&&this.depth>0){var i=mT.getGeometryData({contour:e[r].contour,holes:e[r].holes,depth:this.depth});(n=new _p).addAttribute("a_Position",new up(new cp(new Float32Array(i.positions),3))),n.addAttribute("a_Uv",new up(new cp(new Float32Array(i.uvs),2))),n.setIndex(new up(new cp(i.positions.length/3>65536?new Uint32Array(i.indices):new Uint16Array(i.indices),1))),Gb.computeNormals(n),n.computeBoundingBox(),n.computeBoundingSphere()}else n=new DT({contour:e[r].contour,holes:e[r].holes});var a=new ap(n,this._material);this._node.add(a),this._meshes.push(a)}}},{key:"_createPaths",value:function(e,t,r){for(var n=Array.from(e),i=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,s=[],o=0,l=0,u=0;u<n.length;u++){var c=n[u];if("\n"===c)o=0,l-=a;else{var h=this._createPath(c,i,o,l,r);o+=h.offsetX,s.push(h.path)}}return s}},{key:"_createPath",value:function(e,t,r,n,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var s,o,l,u,c,h,d,p,f=-1,m=[];if(a.o)for(var g=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),_=[0,0],v=0,y=g.length;v<y;){switch(g[v++]){case"m":m[++f]=new TR,s=g[v++]*t+r,o=g[v++]*t+n,_[0]=s,_[1]=o;break;case"l":s=g[v++]*t+r,o=g[v++]*t+n;var x=new fR(new xh(_[0],_[1]),new xh(s,o));m[f].curves.push(x),_[0]=s,_[1]=o;break;case"q":l=g[v++]*t+r,u=g[v++]*t+n,c=g[v++]*t+r,h=g[v++]*t+n;var b=new _R(new xh(_[0],_[1]),new xh(c,h),new xh(l,u));m[f].curves.push(b),_[0]=l,_[1]=u;break;case"b":l=g[v++]*t+r,u=g[v++]*t+n,c=g[v++]*t+r,h=g[v++]*t+n,d=g[v++]*t+r,p=g[v++]*t+n;var A=new yR(new xh(_[0],_[1]),new xh(c,h),new xh(d,p),new xh(l,u));m[f].curves.push(A),_[0]=l,_[1]=u}}return{offsetX:a.ha*t,path:m}}console.error('Font: character "'+e+'" does not exists in font family '+i.familyName+".")}},{key:"_getShapes",value:function(e){var t,r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===e.length)return[];if(1===e.length)return n=(t=e[0]).getPoints(),r={contour:this._vectorsToArray(n),holes:[]},i.push(r),i;var a,s,o=!this._isClockWise(e[0].getPoints()),l=[],u=[],c=0;l[c]=void 0,u[c]=[];for(var h=0,d=e.length;h<d;h++){a=(t=e[h]).getPoints(),this._isClockWise(a)?(!o&&l[c]&&c++,l[c]={contour:this._vectorsToArray(a),holes:[]},o&&c++,u[c]=[]):u[c].push({l:t,p:a[0]})}for(var p=0,f=l.length;p<f;p++){r=l[p],i.push(r);for(var m=0,g=(s=u[p]).length;m<g;m++)r.holes.push(this._vectorsToArray(s[m].l.getPoints()))}return i}},{key:"_vectorsToArray",value:function(e){for(var t=[],r=0;r<e.length;r++)t.push([e[r].x,e[r].y]);return t}},{key:"_isClockWise",value:function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r<0}},{key:"dispose",value:function(){this._meshes.length&&(this._meshes.forEach((function(e){e.geometry.dispose(),e.material.dispose()})),this._meshes=[]),OP(IP(r.prototype),"dispose",this).call(this)}}]),r}(QE);function HN(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qN(e){return function(e){if(Array.isArray(e))return HN(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return HN(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?HN(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function XN(e,t){return Array.apply(void 0,qN(new Array(t))).map(Number.prototype.valueOf,e[0])}function QN(e,t,r){var n,i,a=!1;for(n=0,i=e.length-1;n<e.length;i=n++)e[n][1]>r!=e[i][1]>r&&t<(e[i][0]-e[n][0])*(r-e[n][1])/(e[i][1]-e[n][1])+e[n][0]&&(a=!a);return a}function KN(e,t){var r,n=XN([0],t*t);for(r=0;r<t;r++)n[r*t+r]=e;return n}function YN(e,t,r,n){var i,a,s=Array(r*n);for(i=0;i<r;i++)for(a=0;a<n;a++)s[i*n+a]=e[i*n+a]+t[i*n+a];return s}function ZN(e,t,r,n,i){var a,s,o,l=Array(r*i);for(a=0;a<r;a++)for(s=0;s<i;s++)for(l[a*i+s]=0,o=0;o<n;o++)l[a*i+s]+=e[a*n+o]*t[o*i+s];return l}function JN(e,t){var r,n,i,a=Array(t);for(r=0;r<t;r++)a[r]=e[r*t+r];for(r=0;r<t;r++){for(n=0;n<r;n++)a[r]-=e[r*t+n]*e[r*t+n];if(a[r]<=0)return!1;for(a[r]=Math.sqrt(a[r]),n=r+1;n<t;n++){for(i=0;i<r;i++)e[n*t+r]-=e[n*t+i]*e[r*t+i];e[n*t+r]/=a[r]}}for(r=0;r<t;r++)e[r*t+r]=a[r];return!0}function $N(e,t){var r,n,i,a;for(r=0;r<t;r++)for(e[r*t+r]=1/e[r*t+r],n=r+1;n<t;n++){for(a=0,i=r;i<n;i++)a-=e[n*t+i]*e[i*t+r];e[n*t+r]=a/e[n*t+n]}for(r=0;r<t;r++)for(n=r+1;n<t;n++)e[r*t+n]=0;for(r=0;r<t;r++){for(e[r*t+r]*=e[r*t+r],i=r+1;i<t;i++)e[r*t+r]+=e[i*t+r]*e[i*t+r];for(n=r+1;n<t;n++)for(i=n;i<t;i++)e[r*t+n]+=e[i*t+r]*e[i*t+n]}for(r=0;r<t;r++)for(n=0;n<r;n++)e[r*t+n]=e[n*t+r]}function eB(e,t){var r,n,i,a,s,o,l,u,c,h,d,p=t,f=Array(t*t),m=Array(t),g=Array(t),_=Array(t);for(r=0;r<t;r++)for(a=0;a<t;a++)f[r*t+a]=r==a?1:0;for(a=0;a<t;a++)_[a]=0;for(r=0;r<t;r++){for(u=0,a=0;a<t;a++)if(1!=_[a])for(s=0;s<t;s++)0==_[s]&&Math.abs(e[a*t+s])>=u&&(u=Math.abs(e[a*t+s]),i=a,n=s);if(++_[n],i!=n){for(o=0;o<t;o++)d=e[i*t+o],e[i*t+o]=e[n*t+o],e[n*t+o]=d;for(o=0;o<p;o++)d=f[i*t+o],f[i*t+o]=f[n*t+o],f[n*t+o]=d}if(g[r]=i,m[r]=n,0==e[n*t+n])return!1;for(h=1/e[n*t+n],e[n*t+n]=1,o=0;o<t;o++)e[n*t+o]*=h;for(o=0;o<p;o++)f[n*t+o]*=h;for(l=0;l<t;l++)if(l!=n){for(c=e[l*t+n],e[l*t+n]=0,o=0;o<t;o++)e[l*t+o]-=e[n*t+o]*c;for(o=0;o<p;o++)f[l*t+o]-=f[n*t+o]*c}}for(o=t-1;o>=0;o--)if(g[o]!=m[o])for(s=0;s<t;s++)d=e[s*t+g[o]],e[s*t+g[o]]=e[s*t+m[o]],e[s*t+m[o]]=d;return!0}function tB(e,t,r,n,i){return t+(n-t)/r*(1-Math.exp(-1/i*Math.pow(e/r,2)))}function rB(e,t,r,n,i){return t+(n-t)/r*(1-Math.exp(-1/i*(e/r)))}function nB(e,t,r,n,i){return e>r?t+(n-t)/r:t+(n-t)/r*(e/r*1.5-.5*Math.pow(e/r,3))}var iB=function(){var e={};return e.train=function(e,t,r,n,i,a){var s,o,l,u,c={t:e,x:t,y:r,nugget:0,range:0,sill:0,A:1/3,n:0};switch(n){case"gaussian":c.model=tB;break;case"exponential":c.model=rB;break;case"spherical":c.model=nB}var h=e.length,d=Array((h*h-h)/2);for(s=0,l=0;s<h;s++)for(o=0;o<s;o++,l++)d[l]=Array(2),d[l][0]=Math.pow(Math.pow(t[s]-t[o],2)+Math.pow(r[s]-r[o],2),.5),d[l][1]=Math.abs(e[s]-e[o]);d.sort((function(e,t){return e[0]-t[0]})),c.range=d[(h*h-h)/2-1][0];var p=(h*h-h)/2>30?30:(h*h-h)/2,f=c.range/p,m=XN([0],p),g=XN([0],p);if(p<30)for(u=0;u<p;u++)m[u]=d[u][0],g[u]=d[u][1];else{for(s=0,o=0,l=0,u=0;s<p&&o<(h*h-h)/2;s++,l=0){for(;d[o][0]<=(s+1)*f&&(m[u]+=d[o][0],g[u]+=d[o][1],l++,!(++o>=(h*h-h)/2)););l>0&&(m[u]/=l,g[u]/=l,u++)}if(u<2)return c}h=u,c.range=10;var _=XN([1],2*h),v=Array(h),y=c.A;for(s=0;s<h;s++){switch(n){case"gaussian":_[2*s+1]=1-Math.exp(-1/y*Math.pow(m[s]/c.range,2));break;case"exponential":_[2*s+1]=1-Math.exp(-1/y*m[s]/c.range);break;case"spherical":_[2*s+1]=m[s]/c.range*1.5-.5*Math.pow(m[s]/c.range,3)}v[s]=g[s]}var x=function(e,t,r){var n,i,a=Array(r*t);for(n=0;n<t;n++)for(i=0;i<r;i++)a[i*t+n]=e[n*r+i];return a}(_,h,2),b=ZN(x,_,2,h,2),A=(b=YN(b,KN(1/a,2),2,2)).slice(0);JN(b,2)?$N(b,2):(eB(A,2),b=A);var S=ZN(ZN(b,x,2,2,h),v,2,h,1);c.nugget=S[0],c.sill=S[1]*c.range+c.nugget,c.n=t.length,h=t.length;var E=Array(h*h);for(s=0;s<h;s++){for(o=0;o<s;o++)E[s*h+o]=c.model(Math.pow(Math.pow(t[s]-t[o],2)+Math.pow(r[s]-r[o],2),.5),c.nugget,c.range,c.sill,c.A),E[o*h+s]=E[s*h+o];E[s*h+s]=c.model(0,c.nugget,c.range,c.sill,c.A)}var w=YN(E,KN(i,h),h,h),C=w.slice(0);JN(w,h)?$N(w,h):(eB(C,h),w=C);E=w.slice(0);var T=ZN(w,e,h,h,1);return c.K=E,c.M=T,c},e.predict=function(e,t,r){var n,i=Array(r.n);for(n=0;n<r.n;n++)i[n]=r.model(Math.pow(Math.pow(e-r.x[n],2)+Math.pow(t-r.y[n],2),.5),r.nugget,r.range,r.sill,r.A);return ZN(i,r.M,1,r.n,1)[0]},e.variance=function(e,t,r){var n,i=Array(r.n);for(n=0;n<r.n;n++)i[n]=r.model(Math.pow(Math.pow(e-r.x[n],2)+Math.pow(t-r.y[n],2),.5),r.nugget,r.range,r.sill,r.A);return r.model(0,r.nugget,r.range,r.sill,r.A)+ZN(ZN(i,r.K,1,r.n,r.n),i,1,r.n,1)[0]},e.grid=function(t,r,n){var i,a,s,o=t.length;if(0!=o){var l,u,c=[t[0][0][0],t[0][0][0]],h=[t[0][0][1],t[0][0][1]];for(i=0;i<o;i++)for(a=0;a<t[i].length;a++)t[i][a][0]<c[0]&&(c[0]=t[i][a][0]),t[i][a][0]>c[1]&&(c[1]=t[i][a][0]),t[i][a][1]<h[0]&&(h[0]=t[i][a][1]),t[i][a][1]>h[1]&&(h[1]=t[i][a][1]);var d=Array(2),p=Array(2),f=Array(2),m=Array(2),g=Math.ceil((c[1]-c[0])/n),_=Math.ceil((h[1]-h[0])/n),v=Array(g+1);for(i=0;i<=g;i++)v[i]=Array(_+1);for(i=0;i<o;i++){for(f[0]=t[i][0][0],f[1]=f[0],m[0]=t[i][0][1],m[1]=m[0],a=1;a<t[i].length;a++)t[i][a][0]<f[0]&&(f[0]=t[i][a][0]),t[i][a][0]>f[1]&&(f[1]=t[i][a][0]),t[i][a][1]<m[0]&&(m[0]=t[i][a][1]),t[i][a][1]>m[1]&&(m[1]=t[i][a][1]);for(d[0]=Math.floor((f[0]-(f[0]-c[0])%n-c[0])/n),d[1]=Math.ceil((f[1]-(f[1]-c[1])%n-c[0])/n),p[0]=Math.floor((m[0]-(m[0]-h[0])%n-h[0])/n),p[1]=Math.ceil((m[1]-(m[1]-h[1])%n-h[0])/n),a=d[0];a<=d[1];a++)for(s=p[0];s<=p[1];s++)l=c[0]+a*n,u=h[0]+s*n,QN(t[i],l,u)&&(v[a][s]=e.predict(l,u,r))}return v.xlim=c,v.ylim=h,v.zlim=[Math.min.apply(Math,qN(r.t)),Math.max.apply(Math,qN(r.t))],v.width=n,v}},e.contour=function(e,t,r){},e.plot=function(e,t,r,n,i){console.time("plot");var a=e.getContext("2d");a.clearRect(0,0,e.width,e.height);var s,o,l,u,c,h=[r[1]-r[0],n[1]-n[0],t.zlim[1]-t.zlim[0]],d=t.length,p=t[0].length,f=Math.ceil(t.width*e.width/(r[1]-r[0])),m=Math.ceil(t.width*e.height/(n[1]-n[0]));for(s=0;s<d;s++)for(o=0;o<p;o++)null!=t[s][o]&&(l=e.width*(s*t.width+t.xlim[0]-r[0])/h[0],u=e.height*(1-(o*t.width+t.ylim[0]-n[0])/h[1]),(c=(t[s][o]-t.zlim[0])/h[2])<0&&(c=0),c>1&&(c=1),a.fillStyle=i[Math.floor((i.length-1)*c)],a.fillRect(Math.round(l-f/2),Math.round(u-m/2),f,m))},e}();function aB(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=IP(e);if(t){var i=IP(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zP(this,r)}}Nh.prototype.intersectLine=function(e,t){void 0===t&&(console.warn("t3d.Plane: .intersectLine() target is now required"),t=new bc);var r=t.subVectors(e.end,e.start),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var i=-(e.start.dot(this.normal)+this.constant)/n;return i<0||i>1?null:t.copy(r).multiplyScalar(i).add(e.start)},cp.prototype.setXYZ=function(e,t,r,n){return e*=this.stride,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},bc.prototype.fromBufferAttribute=function(e,t){return this.x=e.array[t*this.stride],this.y=e.array[t*this.stride+1],this.z=e.array[t*this.stride+2],this};var sB=new Map,oB=function(){function e(){PP(this,e)}return BP(e,[{key:"InitUV2",value:function(e){for(var t=[],r=0,n=e.length,i=0;i<n;i+=3){var a=e[(i+3)%n]-e[i],s=e[(i+3)%n+1]-e[i+1],o=e[(i+3)%n+2]-e[i+2],l=Math.sqrt(a*a+s*s+o*o);t.push(r),r+=l}return t.push(r),t}},{key:"normalizeArray",value:function(e,t){for(var r=e.length,n=0;n<r;n++)e[n]/=t;return 1!=e[r-1]&&e.push(1),e}}]),e}(),lB=new Nh(new bc(0,0,1),500);new _p;var uB=function(e){LP(r,e);var t=aB(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(PP(this,r),(e=t.call(this,n.external.uScene))._poGroup=new Wm,n.external.param.clippingPlane){var i=new bc(n.external.param.clippingPlane.normal[0],n.external.param.clippingPlane.normal[1],n.external.param.clippingPlane.normal[2]).normalize(),a=n.external.param.clippingPlane.constant;e._clippingPlane={normal:i,constant:a},e._matrix=n.external.param.matrix4?(new Sc).fromArray(n.external.param.matrix4):new Sc,e._clipPlane=new Nh(i.clone(),a)}return e._volumeBlockGeo=[],e._clipMesh=[],e._init(n.external.param),e.$markChildrenMatrixAutoUpdate(!1),e}return BP(r,[{key:"_init",value:function(e){var t=new _p,r=new up(new cp(new Float32Array(3e5),3),!1);t.addAttribute("a_Position",r),this.outlineLines=new ap(t,new gm),this.outlineLines.frustumCulled=!1,this.outlineLines.renderOrder=3,this._addcylinderGeometry(e),this._clipfaceGeometrys=[],this._geologicallayers=new Array(e.geologicallayers.length),this._interpolatedData=new Array(e.geologicallayers.length);for(var n=0;n<e.geologicallayers.length;n++)this._geologicallayers[n]=e.geologicallayers[n];for(var i=e.output,a=new Int32Array,s=new Int32Array,o=new Float32Array(1.5*i.pointlist.length),l=0;l<i.pointlist.length/2;l++)o[3*l]=i.pointlist[2*l],o[3*l+2]=i.pointlist[2*l+1];a=i.trianglelist,s=i.segmentlist;for(var u=0;u<e.geologicallayers.length;u++)this._interpolatedData[u]=this._interpolateHorizontalData(this._geologicallayers[u],o);for(var c=s.length/2,h=new Int32Array(s.length),d=new Int32Array(c),p=new Int32Array(c),f=0;f<c;f++)d[f]=s[2*f],p[f]=s[2*f+1];h[0]=s[0],h[1]=s[1];for(var m=1;m<=c;m++){var g=d.indexOf(h[2*m-1]);h[2*m]=d[g],h[2*m+1]=p[g]}this._blockGroup=new Wm;for(var _=0;_<e.geologicallayers.length-1;_++){var v=16777215;e.color&&(v=e.color[_]),this._volumeBlockGeo[_]=this._createVolumeBlock(this._interpolatedData[_],this._interpolatedData[_+1],a,h,v)}e.clippingPlane&&this._updataChipPlane(e.clippingPlane),this._node.add(this._blockGroup),this._node.add(this._poGroup)}},{key:"_addcylinderGeometry",value:function(e){for(var t=new Wm,r=e.dataSource,n=0;n<r.length;n++){var i=new E_;e.color&&i.diffuse.setHex(e.color[n]);for(var a=0;a<r[0].length;a++){var s=new hm(1,1,r[n][a][3],20),o=new ap(s,i);o.position.set(r[n][a][0],r[n][a][2]-r[n][a][3]/2,r[n][a][1]),t.add(o)}}this._node.add(t)}},{key:"_updataChipPlane",value:function(e){if(e){this._poGroup.visible=!0;var t=this.outlineLines.geometry.attributes.a_Position.buffer;t.array.fill(0);var r=new bc(e.normal[0],e.normal[1],e.normal[2]).normalize();this._clippingPlane={normal:r,constant:e.constant},lB.normal=r,lB.constant=e.constant,this._clipPlane.normal=r.clone(),this._clipPlane.constant=e.constant,this._clipPlane.applyMatrix4(this._matrix);for(var n=0;n<this._blockGroup.children.length;n++)this._blockGroup.children[n].material.clippingPlanes=[this._clipPlane];for(var i=0;i<this._geologicallayers.length-1;i++){var a=this._lineTriangleIntersect(this._volumeBlockGeo[i],lB,t);if(a>0){var s=this._orderLinesegments(t,a);if(this._clipfaceGeometrys[i]&&this._clipfaceGeometrys[i].dispose(),this._clipfaceGeometrys[i]=new _p,this._triangulation(s,this._clipfaceGeometrys[i]),this._poGroup.children[i])this._poGroup.children[i].visible=!0,this._clipfaceGeometrys[i].removeAttribute("a_Normal"),Gb.computeNormals(this._clipfaceGeometrys[i]),this._clipfaceGeometrys[i].version++,this._poGroup.children[i].geometry=this._clipfaceGeometrys[i],this._poGroup.children[i].material.needsUpdate=!0;else{var o=new ap(this._clipfaceGeometrys[i],new E_);o.material.side=Lc.FRONT,o.renderOrder=.1,this._poGroup.add(o),this._poGroup.groupType="poGroup"}}else this._poGroup.children[i]&&this._poGroup.children[i].geometry&&(this._poGroup.children[i].visible=!1)}}else{this._poGroup.visible=!1;for(var l=0;l<this._blockGroup.children.length;l++)this._blockGroup.children[l].material.clippingPlanes=null}}},{key:"_interpolateHorizontalData",value:function(e,t){for(var r=[],n=[],i=[],a=0;a<e.length;a++)r.push(e[a][0]),n.push(e[a][1]),i.push(e[a][2]);for(var s=iB.train(i,r,n,"spherical",0,100),o=0;o<t.length/3;o++){var l=t[3*o],u=t[3*o+2],c=iB.predict(l,u,s);t[3*o+1]=c}return t.slice(0)}},{key:"_createVolumeBlock",value:function(e,t,r,n,i){for(var a=new _p,s=n.length/2,o=s+1,l=new Uint32Array(2*r.length+6*o),u=e.length/3,c=new Float32Array(2*e.length+6*o),h=0;h<e.length;h++)c[h]=e[h],c[h+e.length]=t[h];for(var d=2*e.length,p=d,f=[],m=0;m<s;m++){var g=n[2*m];c[d++]=e[3*g],c[d++]=e[3*g+1],c[d++]=e[3*g+2],f[3*m]=e[3*g],f[3*m+1]=e[3*g+1],f[3*m+2]=e[3*g+2]}d=2*e.length+3*s,c[d++]=c[p],c[d++]=c[p+1],c[d++]=c[p+2];var _=d;d=2*e.length+3*o;for(var v=0;v<s;v++){var y=n[2*v];c[d++]=t[3*y],c[d++]=t[3*y+1],c[d++]=t[3*y+2]}d=2*e.length+6*s+3,c[d++]=c[_],c[d++]=c[_+1],c[d++]=c[_+2];for(var x=1/0,b=1/0,A=0;A<e.length/3;A++)x>e[3*A]&&(x=e[3*A]),b>e[3*A+2]&&(b=e[3*A+2]);for(var S=2*e.length/3,E=new Float32Array(2*c.length/3),w=0;w<u;w++)E[2*w]=c[3*w]-x,E[2*w+1]=c[3*w+2]-b,E[2*w+S]=c[3*w]-x,E[2*w+1+S]=c[3*w+2]-b;for(var C=(new oB).InitUV2(f),T=2*u*2,D=0;D<s;D++){var M=n[2*D];E[2*D+T]=C[D],E[2*D+1+T]=e[3*M+1]-t[3*M+1]}E[2*s+T]=C[s],E[2*s+1+T]=e[3*n[0]+1]-t[3*n[0]+1],T=2*u*2+2*o;for(var P=0;P<s;P++)E[2*P+T]=C[P],E[2*P+1+T]=0;E[2*s+T]=C[s],E[2*s+1+T]=0;for(var F=0;F<r.length;F++)l[F]=r[F],l[F+r.length]=F%3==1?r[F+1]+u:F%3==2?r[F-1]+u:r[F]+u;for(var R=2*r.length,N=0;N<o;N++){var B=N+2*u,I=(N+1)%o+2*u,O=B+o,k=I+o;l[R++]=B,l[R++]=O,l[R++]=I,l[R++]=I,l[R++]=O,l[R++]=k}a.addAttribute("a_Position",new up(new cp(c,3))),a.addAttribute("a_Uv",new up(new cp(E,2))),a.setIndex(new up(new cp(l,1))),a.computeBoundingSphere(),a.computeBoundingBox(),Gb.computeNormals(a);var L=new E_;this._clipPlane&&(L.clippingPlanes=[this._clipPlane]),L.side=Lc.DOUBLE,L.envMapIntensity=0;var U=new ap(a,L);return U.castShadow=!0,U.renderOrder=3,this._blockGroup.add(U),this._blockGroup.groupType="blockGroup",a}},{key:"_lineTriangleIntersect",value:function(e,t,r){for(var n=0,i=new bc,a=new _p,s=e.attributes.a_Position.buffer.array,o=0;o<e.index.buffer.count;o+=3){var l=s[3*e.index.buffer.array[o]],u=s[3*e.index.buffer.array[o]+1],c=s[3*e.index.buffer.array[o]+2],h=s[3*e.index.buffer.array[o+1]],d=s[3*e.index.buffer.array[o+1]+1],p=s[3*e.index.buffer.array[o+1]+2],f=s[3*e.index.buffer.array[o+2]],m=s[3*e.index.buffer.array[o+2]+1],g=s[3*e.index.buffer.array[o+2]+2],_=0;if(a.start=new bc(l,u,c),a.end=new bc(h,d,p),t.intersectLine(a,i)&&(r.setXYZ(n,i.x,i.y,i.z),n++,_++),a.start=new bc(h,d,p),a.end=new bc(f,m,g),t.intersectLine(a,i)&&(r.setXYZ(n,i.x,i.y,i.z),_++,n++),a.start=new bc(f,m,g),a.end=new bc(l,u,c),t.intersectLine(a,i)&&(r.setXYZ(n,i.x,i.y,i.z),_++,n++),3===_){var v=new bc,y=new bc,x=new bc;v.fromBufferAttribute(r,n-3),y.fromBufferAttribute(r,n-2),x.fromBufferAttribute(r,n-1),x.equals(v)||x.equals(y)?(_--,n--):v.equals(y)&&(r.setXYZ(n-2,x),_--,n--)}2!==_&&(n-=_)}return n}},{key:"_orderLinesegments",value:function(e,t){for(var r=[],n=0;n<t;n++)r[n]=[e.array[3*n],e.array[3*n+1],e.array[3*n+2]];for(var i=r.length/2,a=[],s=0;s<i;s++)r[2*s],r[2*s+1];a[0]=r[0],a[1]=r[1];for(var o=r[1];!this._checkSamePoint(o,r[0]);)for(var l=1;l<i&&2!==r.length;l++){if(this._checkSamePoint(r[2*l],o)){o=r[2*l+1],a.push(r[2*l]),a.push(o),r.splice(2*l,2);break}if(this._checkSamePoint(r[2*l+1],o)){o=r[2*l],a.push(r[2*l+1]),a.push(o),r.splice(2*l,2);break}}for(var u=[],c=0;c<a.length/2;c++)u[c]=a[2*c];return u}},{key:"_triangulation",value:function(e,t){for(var r=[],n=1/0,i=1/0,a=-1/0,s=-1/0,o=0;o<e.length;o++)r[2*o]=e[o][0],r[2*o+1]=e[o][1],e[o][0]>a&&(a=e[o][0]),e[o][0]<n&&(n=e[o][0]),e[o][1]>s&&(s=e[o][1]),e[o][1]<i&&(i=e[o][1]);for(var l=jP(r),u=new Float32Array(e.flat()),c=new Float32Array(2*u.length/3),h=0;h<u.length/3;h++)c[2*h]=u[3*h]-n,c[2*h+1]=u[3*h+1]-i;var d=new Uint32Array(l);t.addAttribute("a_Position",new up(new cp(u,3))),t.addAttribute("a_Uv",new up(new cp(c,2))),t.setIndex(new up(new cp(d,1))),t.computeBoundingBox(),t.computeBoundingSphere(),Gb.computeNormals(t)}},{key:"_checkSamePoint",value:function(e,t){return e&&t||console.log(e[0]),!!(e[0]===t[0]&e[1]===t[1]&e[2]===t[2])}},{key:"setdiffuseMap",value:function(e){for(var t=this,r=new yh,n=function(n){r.load(e[n],(function(e){var r=t._node.children.find((function(e){return"poGroup"===e.groupType}));if(r&&r.isGroup){var i=r.children[n],a=sB.get("_podiffuseMap_"+n);a||((a=new Bp).image=e,a.wrapS=a.wrapT=Gc.REPEAT,sB.set("_podiffuseMap_"+n,a)),i.material.diffuseMap=a,i.material.diffuseMapTransform.setUvTransform(0,0,.2,.2,0,.5,.5),i.material.diffuseMap.version++,i.material.needsUpdate=!0}var s=t._node.children.find((function(e){return"blockGroup"===e.groupType}));if(s.isGroup){var o=s.children[n],l=sB.get("_blockdiffuseMap_"+n);l||((l=new Bp).image=e,l.wrapS=l.wrapT=Gc.REPEAT,sB.set("_blockdiffuseMap_"+n,l)),o.material.diffuseMap=l,o.material.diffuseMapTransform.setUvTransform(0,0,.2,.2,0,.5,.5),o.material.diffuseMap.version++,o.material.needsUpdate=!0}}))},i=0;i<e.length;i++)n(i)}},{key:"setdiffuse",value:function(e){var t=this._node.children.find((function(e){return"poGroup"===e.groupType}));if(t&&t.isGroup)for(var r=0;r<t.children.length;r++){var n=t.children[r];n.material.diffuse.setHex(e[r]),n.material.needsUpdate=!0,n.material.version++}var i=this._node.children.find((function(e){return"blockGroup"===e.groupType}));if(i.isGroup)for(var a=0;a<i.children.length;a++){var s=i.children[a];s.material.diffuse.setHex(e[a]),s.material.needsUpdate=!0,s.material.version++}}},{key:"dispose",value:function(){this.outlineLines.material.dispose(),this.outlineLines.geometry.dispose();var e=this._node.children.find((function(e){return"poGroup"===e.groupType}));if(e.isGroup)for(var t=0;t<e.children.length;t++){var r=e.children[t];r.material.dispose(),r.geometry.dispose()}var n=this._node.children.find((function(e){return"blockGroup"===e.groupType}));if(n.isGroup)for(var i=0;i<n.children.length;i++){var a=n.children[i];a.material.dispose(),a.geometry.dispose()}for(var s=0;s<this._clipMesh.length;s++)this._clipMesh[s].material.dispose(),this._clipMesh[s].geometry.dispose()}}]),r}(QE),cB=function(){function e(){PP(this,e)}return BP(e,[{key:"createObject",value:function(e,t){switch(e){case"HeatmapLayerNode":return new TF(t);case"IDWLayerNode":return new PF(t);case"ScanningLayerNode":return new VN(t);case"FloodSimulationLayerNode":return new kN(t);case"FloodSimulationLayerNode2":return new UN(t);case"VolumerenderNode":return new PN(t);case"WaterLayerNode":return new jF(t);case"LineRiverLayerNode":return new FR(t);case"UWindLayerNode":return new LR(t);case"RiverSurfaceLayerNode":return new zR(t);case"EffectGroundObjectNode":return new KR(t);case"FixLightNode":return new BF(t);case"CanvasNode":return new LF(t);case"DiffusionCylinderNode":return new hR(t);case"ExtrudeBuildingNode":return new XF(t);case"ExtrudeBuildingTopNode":return new $F(t);case"ExtrudeBuildingNodePBRMaterial":return new GF(t);case"ExtrudeBuildingTopNodePBRMaterial":return new KF(t);case"BoundaryNode":return new aR(t);case"BoundaryNodePBRMaterial":return new tR(t);case"ExtendPointsNode":return new uR(t);case"SpritesLayerNode":return new rN(t);case"DecalNode":return new gN(t);case"D3Node":return new EN(t);case"PanoObjectNode":return new IN(t);case"ShapeTextNode":return new WN(t);case"GeologicalmodelNode":return new uB(t);default:return null}}}]),e}(),hB=Object.freeze({__proto__:null,Factory:cB});try{void 0!==TP&&we.addFactory(new TP),void 0!==cB&&we.addFactory(new cB),window.THING=window.THING||{},window.THING.T3D=MP,window.THING.T3D_EXTEND=hB}catch(e){}function dB(e,t,r,n,i,a,s){try{var o=e[a](s),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,i)}function pB(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){dB(a,n,i,s,o,"next",e)}function o(e){dB(a,n,i,s,o,"throw",e)}s(void 0)}))}}function fB(e){return fB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fB(e)}function mB(e){var t=function(e,t){if("object"!==fB(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==fB(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===fB(t)?t:String(t)}function gB(e,t,r){return(t=mB(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _B(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var vB=0;function yB(e){return"__private_"+vB+++"_"+e}var xB=yB("wasmLoader");let bB=class{constructor(){Object.defineProperty(this,xB,{writable:!0,value:null})}loadWasmModule(e,t){void 0===t&&(t={});var r=_B(this,xB)[xB];if(r){var n=r.loadingPromise;return n.resolved?Promise.resolve({module:r.module,wasmOptions:r.options}):n}var i=we.createObject("WasmLoader");return i?(_B(this,xB)[xB]=i,new Promise(pB((function*(r,n){r({module:yield i.init({wasmRootPath:e,workerOptions:t}),wasmOptions:i.options})})))):Promise.reject("Create wasm loader failed")}login(e,t,r,n){return _B(this,xB)[xB].resourceDownloader.login(e,t,r,n)}get httpRequestHeaders(){return _B(this,xB)[xB].resourceDownloader.httpRequestHeaders}set httpRequestHeaders(e){_B(this,xB)[xB].resourceDownloader.httpRequestHeaders=e}get onGetResourceTypeFromUrl(){return _B(this,xB)[xB].resourceDownloader.onGetResourceTypeFromUrl}set onGetResourceTypeFromUrl(e){_B(this,xB)[xB].resourceDownloader.onGetResourceTypeFromUrl=e}};var AB={BoundingBoxInheritType:"_BoundingBoxInheritType_"},SB={AppQuit:"AppQuit",Update:"Update",FocusIn:"FocusIn",FocusOut:"FocusOut",Resize:"Resize",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave",MouseMove:"MouseMove",MouseUp:"MouseUp",MouseDown:"MouseDown",Wheel:"Wheel",Click:"Click",DBLClick:"DBLClick",KeyDown:"KeyDown",KeyUp:"KeyUp",KeyPress:"KeyPress",DropFiles:"DropFiles",EnterState:"EnterState",LeaveState:"LeaveState",RegisterLevelAction:"RegisterLevelAction",BeforeLeaveLevel:"BeforeLeaveLevel",AfterLeaveLevel:"AfterLeaveLevel",BeforeEnterLevel:"BeforeEnterLevel",AfterEnterLevel:"AfterEnterLevel",CompleteEnterLevel:"CompleteEnterLevel",ColliderEnter:"ColliderEnter",ColliderLeave:"ColliderLeave",Create:"Create",Load:"Load",Progress:"Progress",Error:"Error",BeforeDestroy:"BeforeDestroy",AfterDestroy:"AfterDestroy",BeforeAddChild:"BeforeAddChild",AfterAddChild:"AfterAddChild",BeforeRemoveChild:"BeforeRemoveChild",AfterRemoveChild:"AfterRemoveChild",StartFlying:"StartFlying",Flying:"Flying",StopFlying:"StopFlying",CompleteFlying:"CompleteFlying",ActiveChange:"ActiveChange",VisibleChange:"VisibleChange",StopAnimation:"StopAnimation",PlayAnimation:"PlayAnimation",ChangeAttributes:"ChangeAttributes",EnableViewport:"EnableViewport",CameraChangePreStart:"CameraChangePreStart",CameraChangeStart:"CameraChangeStart",CameraChange:"CameraChange",CameraChangePreEnd:"CameraChangePreEnd",CameraChangeEnd:"CameraChangeEnd",BeforeCameraCapture:"BeforeCameraCapture",AfterCameraCapture:"AfterCameraCapture"},EB={Linear:{None:mc.Easing.Linear.None},Quadratic:{In:mc.Easing.Quadratic.In,Out:mc.Easing.Quadratic.Out,InOut:mc.Easing.Quadratic.InOut},Cubic:{In:mc.Easing.Cubic.In,Out:mc.Easing.Cubic.Out,InOut:mc.Easing.Cubic.InOut},Quartic:{In:mc.Easing.Quartic.In,Out:mc.Easing.Quartic.Out,InOut:mc.Easing.Quartic.InOut},Quintic:{In:mc.Easing.Quintic.In,Out:mc.Easing.Quintic.Out,InOut:mc.Easing.Quintic.InOut},Sinusoidal:{In:mc.Easing.Sinusoidal.In,Out:mc.Easing.Sinusoidal.Out,InOut:mc.Easing.Sinusoidal.InOut},Exponential:{In:mc.Easing.Exponential.In,Out:mc.Easing.Exponential.Out,InOut:mc.Easing.Exponential.InOut},Circular:{In:mc.Easing.Circular.In,Out:mc.Easing.Circular.Out,InOut:mc.Easing.Circular.InOut},Elastic:{In:mc.Easing.Elastic.In,Out:mc.Easing.Elastic.Out,InOut:mc.Easing.Elastic.InOut},Back:{In:mc.Easing.Back.In,Out:mc.Easing.Back.Out,InOut:mc.Easing.Back.InOut},Bounce:{In:mc.Easing.Bounce.In,Out:mc.Easing.Bounce.Out,InOut:mc.Easing.Bounce.InOut}},wB={Repeat:"Repeat",PingPong:"PingPong"},CB={None:"None",Left:"Left",Middle:"Middle",Right:"Right"},TB={Self:"Self",Local:"Local",World:"World"},DB={Escape:"Escape",Digit1:"Digit1",Digit2:"Digit2",Digit3:"Digit3",Digit4:"Digit4",Digit5:"Digit5",Digit6:"Digit6",Digit7:"Digit7",Digit8:"Digit8",Digit9:"Digit9",Digit0:"Digit0",Minus:"Minus",Equal:"Equal",Backspace:"Backspace",Tab:"Tab",KeyQ:"KeyQ",KeyW:"KeyW",KeyE:"KeyE",KeyR:"KeyR",KeyT:"KeyT",KeyY:"KeyY",KeyU:"KeyU",KeyI:"KeyI",KeyO:"KeyO",KeyP:"KeyP",BracketLeft:"BracketLeft",BracketRight:"BracketRight",Enter:"Enter",ControlLeft:"ControlLeft",KeyA:"KeyA",KeyS:"KeyS",KeyD:"KeyD",KeyF:"KeyF",KeyG:"KeyG",KeyH:"KeyH",KeyJ:"KeyJ",KeyK:"KeyK",KeyL:"KeyL",Semicolon:"Semicolon",Quote:"Quote",Backquote:"Backquote",ShiftLeft:"ShiftLeft",Backslash:"Backslash",KeyZ:"KeyZ",KeyX:"KeyX",KeyC:"KeyC",KeyV:"KeyV",KeyB:"KeyB",KeyN:"KeyN",KeyM:"KeyM",Comma:"Comma",Period:"Period",Slash:"Slash",ShiftRight:"ShiftRight",NumpadMultiply:"NumpadMultiply",AltLeft:"AltLeft",Space:"Space",CapsLock:"CapsLock",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",Pause:"Pause",ScrollLock:"ScrollLock",Numpad7:"Numpad7",Numpad8:"Numpad8",Numpad9:"Numpad9",NumpadSubtract:"NumpadSubtract",Numpad4:"Numpad4",Numpad5:"Numpad5",Numpad6:"Numpad6",NumpadAdd:"NumpadAdd",Numpad1:"Numpad1",Numpad2:"Numpad2",Numpad3:"Numpad3",Numpad0:"Numpad0",NumpadDecimal:"NumpadDecimal",F11:"F11",F12:"F12",F13:"F13",F14:"F14",F15:"F15",F16:"F16",F17:"F17",F18:"F18",F19:"F19",F20:"F20",F21:"F21",F22:"F22",F23:"F23",F24:"F24",NumpadComma:"NumpadComma",NumpadEnter:"NumpadEnter",ControlRight:"ControlRight",BrowserHome:"BrowserHome",NumpadDivide:"NumpadDivide",PrintScreen:"PrintScreen",AltRight:"AltRight",NumLock:"NumLock",Home:"Home",ArrowUp:"ArrowUp",PageUp:"PageUp",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",End:"End",ArrowDown:"ArrowDown",PageDown:"PageDown",Insert:"Insert",Delete:"Delete"},MB={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,Key0:48,Key1:49,Key2:50,Key3:51,Key4:52,Key5:53,Key6:54,Key7:55,Key8:56,Key9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Select:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,Multiply:106,Add:107,Subtract:109,Decimal:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Numlock:144,Scrolllock:145,Semicolon:186,EqualSign:187,Comma:188,Dash:189,Period:190,ForwardSlash:191,GraveAccent:192,OpenBracket:219,BackSlash:220,CloseBraket:221,SingleQuote:222},PB={XYZ:"XYZ",YZX:"YZX",ZXY:"ZXY",XZY:"XZY",YXZ:"YXZ",ZYX:"ZYX"},FB={X:"X",Y:"Y",Z:"Z"},RB={Orthographic:"Orthographic",Perspective:"Perspective"},NB={Top:"Top",Bottom:"Bottom",Left:"Left",Right:"Right",Front:"Front",Back:"Back"},BB=NB,IB={Center:"Center",Left:"Left",Top:"Top",TopLeft:"TopLeft",TopRight:"TopRight",Right:"Right",Bottom:"Bottom",BottomLeft:"BottomLeft",BottomRight:"BottomRight"},OB={Front:"Front",Back:"Back",Double:"Double"},kB={Sprite:"Sprite",Plane:"Plane"},LB={Auto:"Auto",Location:"Location"},UB=LB,zB={Raycaster:"Raycaster",GPU:"GPU"},jB={Mesh:"Mesh",BoundingBox:"BoundingBox"},VB={Linear:"Linear",Exp2:"Exp2"},GB={Ready:"Ready",Playing:"Playing",Paused:"Paused",Stopped:"Stopped",Finished:"Finished"},WB=GB,HB={Normal:"Normal",Reverse:"Reverse"},qB={Normal:"Normal",Break:"Break",Jump:"Jump",Stop:"Stop"},XB=qB,QB={All:"All",Root:"Root",Bodies:"Bodies"},KB={No:"NoBlending",Normal:"NormalBlending",Additive:"AdditiveBlending",Subtractive:"SubtractiveBlending",Multiply:"MultiplyBlending"},YB={Tile:"Tile",Stretch:"Stretch"},ZB=YB,JB={Map:"Map",EnvMap:"EnvMap",AlphaMap:"AlphaMap",EmissiveMap:"EmissiveMap",NormalMap:"NormalMap",ColorMapping:"ColorMapping",AOMap:"AOMap"},$B={RGB:"RGB",RGBA:"RGBA",BC7_M6_OPAQUE_ONLY:"BC7_M6_OPAQUE_ONLY"},eI={ETC1:"ETC1",ETC2:"ETC2",BC1:"BC1",BC3:"BC3",BC4:"BC4",BC5:"BC5",BC7_M6_OPAQUE_ONLY:"BC7_M6_OPAQUE_ONLY",BC7_M5:"BC7_M5",PVRTC1_4_RGB:"PVRTC1_4_RGB",PVRTC1_4_RGBA:"PVRTC1_4_RGBA",ASTC_4x4:"ASTC_4x4",ATC_RGB:"ATC_RGB",ATC_RGBA_INTERPOLATED_ALPHA:"ATC_RGBA_INTERPOLATED_ALPHA",RGBA32:"RGBA32",RGB565:"RGB565",BGR565:"BGR565",RGBA4444:"RGBA4444"},tI={Repeat:"Repeat",ClampToEdge:"ClampToEdge",MirroredRepeat:"MirroredRepeat"},rI={UV:"UV",CubeReflection:"CubeReflection",CubeRefraction:"CubeRefraction",EquirectangularReflection:"EquirectangularReflection",EquirectangularRefraction:"EquirectangularRefraction"},nI={NearestFilter:"NearestFilter",NearestMipmapNearestFilter:"NearestMipmapNearestFilter",NearestMipmapLinearFilter:"NearestMipmapLinearFilter",LinearFilter:"LinearFilter",LinearMipmapNearestFilter:"LinearMipmapNearestFilter",LinearMipmapLinearFilter:"LinearMipmapLinearFilter"},iI={Low:512,Medium:1024,High:2048,Ultra:4096},aI={Dynamic:"Dynamic",Static:"Static"},sI={EnterLevel:"EnterLevel"},oI={Box:"Box",Sphere:"Sphere"},lI={AutoDetect:"AutoDetect",NonEncrypted:"NonEncrypted",Encrypted:"Encrypted"},uI={Object:"Object",Layout:"Layout"},cI={ImageTexture:"EmptyImageTexture",Texture:"EmptyTexture"},hI={Normal:"Normal",Bold:"Bold",Bolder:"Bolder",Lighter:"Lighter"},dI={Out:"Out",In:"In",InOut:"InOut",None:"None"},pI={Pass:"Pass",Fail:"Fail",Ignore:"Ignore"},fI={CreateObject:"CreateObject",CameraFlyTo:"CameraFlyTo",ObjectSetColor:"ObjectSetColor"};function mI(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var gI=Le.toText("186,156,39,7,98,52,39,68,210,253"),_I=Le.toText("149,184,0"),vI=Le.toText("161,149,59,53,86,43,41,89"),yI=Le.toText("165,156,32,39,104,41,47,68,220"),xI=Le.toText("141,162,117,53,123,48,43,68,148,244,112,169,42,34,25,124,158,169,189,118,177,195"),bI=Le.toText("141,162,117,42,115,32,43,23,192,248,101,190,51,43,17,107,137,172,227,83,152,249,227,69,12,158,226"),AI=Le.toText("141,162,117,99,123,96,59,104,195,217,121,241,36,126,25,100,143,135,150,105");function SI(){return NI}var EI,wI,CI,TI,DI,MI=null,PI={};function FI(){}DI={dispose:function(){},setOptions:function(e){},getOptions:function(){},api:function(e,t){},error:function(e,t){},sum:function(e,t){},setApiCollector:function(e){},getApiCollector:function(){}};var RI=new bB,NI=null;let BI=class e extends we{static get _system(){return RI}static get _scriptLoader(){return EI=EI||e.createObject("ScriptLoader")}static get _fileManager(){return wI=wI||e.createObject("FileManager")}static get _devDebugger(){return CI=CI||e.createObject("DevDebugger")}static get _renderDebugger(){return TI=TI||e.createObject("RenderDebugger")}static get logger(){return DI}static set logger(e){}static update(e){super.update(e),wI&&wI.update(e)}static getCurrentApp(){return MI}static setCurrentApp(t){if(MI=t,NI)if(0===NI[vI]||!1===NI[vI])e.setTimeout((()=>{t.trigger(bI)}));else{var r=NI[yI];r&&e.setTimeout((()=>{t.trigger(xI,{opacity:r.opacity,text:r.text,data:r.data})}))}}static onCompleteApp(e){NI&&e.trigger(AI,NI),e.load(e.options)}static lerpTo(e,t,r,n){return void 0===r&&(r=1e3),void 0===n&&(n=0),MI.tweenManager.lerpTo(e,t,r,n)}static getMD5CodeFromFile(e,t,r){this.loadBinaryFile(e,(e=>{var r=this.arrayBufferToBlob(e.data);this.getMD5CodeFromBuffer(r).then((function(e){t&&t(e)}))}),r)}static resolveURL(t){return e._scriptLoader.resolveURL(t)}static createObjectURL(t){return e._scriptLoader.createObjectURL(t)}static loadCode(t,r){void 0===r&&(r={}),e._scriptLoader.loadCode(t,r)}static loadCodeAsync(t,r){return void 0===r&&(r={}),new Promise(((n,i)=>{e.loadCode(t,{es6Mode:r.es6Mode,sourceURL:r.sourceURL,onLoad:()=>{n()},onError:e=>{i(e)}})}))}static loadFile(t,r){e._scriptLoader.load(t,r)}static loadFileAsync(t,r){return e._scriptLoader.loadAsync(t,r)}static isCompressedTexture(e){var t=e._getExtension();return"dds"==t||"pvr"==t}static loadImageFile(t,r,n,i,a){e.isCompressedTexture(t)?e.getCurrentApp().resourceManager.loadCompressedTextureData(t,r,n,i):e._fileManager.loadImageFile(t,r,n,i,a)}static loadImageFileAsync(t){return new Promise(((r,n)=>{e.loadImageFile(t,(e=>{r(e)}),(()=>{}),(e=>{n(e)}))}))}static loadImageFileFromBase64(t){return e._fileManager.loadImageFileFromBase64(t)}static loadBitmapImageFromBase64Async(t){return e._fileManager.loadBitmapImageFromBase64Async(t)}static loadBitmapImageFromUrlAsync(t,r){return e._fileManager.loadBitmapImageFromUrlAsync(t,r)}static loadImageFileFromData(t,r,n,i,a,s){e._fileManager.loadImageFileFromData(t,r,n,i,a,s)}static loadVideoFile(t,r,n,i,a){return e._fileManager.loadVideoFile(t,r,n,i,a)}static isVideoResource(t){return e._fileManager.isVideoResource(t)}static loadBinaryFile(t,r,n,i,a){return e._fileManager.loadBinaryFile(t,r,n,i,a)}static loadBinaryFileAsync(t,r){return new Promise(((n,i)=>{e.loadBinaryFile(t,(e=>{var t=e.data;n(t)}),null,(e=>{i(e)}),r)}))}static saveAsFile(t,r){return e._fileManager.saveAsFile(t,r)}static saveAsImage(t,r,n){return e._fileManager.saveAsImage(t,r,n)}static loadTextFile(t,r,n,i,a){return e._fileManager.loadTextFile(t,r,n,i,a)}static loadTextFileAsync(t,r){return new Promise(((n,i)=>{e.loadTextFile(t,(e=>{var t=e.data;n(t)}),null,(e=>{i(e)}),r)}))}static loadJSONFile(t,r,n,i,a){return e._fileManager.loadJSONFile(t,r,n,i,a)}static loadJSONFileAsync(t,r){if(e.isArray(t)){var n=t.map((t=>e.loadJSONFileAsync(t,r).then((e=>({url:t,data:e})))));return Promise.all(n).then((e=>{var t={};return e.forEach((e=>{t[e.url]=e.data})),t}))}return new Promise(((n,i)=>{e.loadJSONFile(t,(e=>{var t=e.data;n(t)}),null,(e=>{i(e)}),r)}))}static encodeImageFromURL(t,r,n,i,a){e._fileManager.encodeImageFromURL(t,r,n,i,a)}static encodeImageFromData(t,r,n,i,a){e._fileManager.encodeImageFromData(t,r,n,i,a)}static encodeImageFromRGBA(t,r,n,i,a,s,o){e._fileManager.encodeImageFromRGBA(t,r,n,i,a,s,o)}static parseMouseButtonType(e){switch(e){case 0:return CB.Left;case 1:return CB.Middle;case 2:return CB.Right;default:return CB.None}}static parseEventWithOptions(t,r){if(e.isString(r[0]))t.tag=r[0],e.isObject(r[1])?(t.useCapture=e.parseValue(r[1].useCapture,t.useCapture),t.enumerable=e.parseValue(r[1].enumerable,t.enumerable),t.pausable=e.parseValue(r[1].pausable,t.pausable)):e.isNumber(r[1])&&(t.priority=r[1],e.isObject(r[2])&&(t.useCapture=e.parseValue(r[2].useCapture,t.useCapture),t.enumerable=e.parseValue(r[2].enumerable,t.enumerable),t.pausable=e.parseValue(r[2].pausable,t.pausable)));else if(e.isNumber(r[0]))t.priority=r[0],e.isObject(r[1])&&(t.useCapture=e.parseValue(r[1].useCapture,t.useCapture),t.enumerable=e.parseValue(r[1].enumerable,t.enumerable),t.pausable=e.parseValue(r[1].pausable,t.pausable));else if(e.isObject(r[0]))t.useCapture=e.parseValue(r[0].useCapture,t.useCapture),t.enumerable=e.parseValue(r[0].enumerable,t.enumerable),t.pausable=e.parseValue(r[0].pausable,t.pausable),e.isString(r[1])?(t.tag=e.parseValue(r[1],""),t.priority=e.parseValue(r[2],0)):t.priority=e.parseValue(r[1],0);else if(3==r.length){t.tag=e.parseValue(r[0],""),t.priority=e.parseValue(r[1],0);var n=r[2];n&&(t.useCapture=e.parseValue(n.useCapture,t.useCapture),t.enumerable=e.parseValue(n.enumerable,t.enumerable),t.pausable=e.parseValue(n.pausable,t.pausable))}}static parseEvent(){var t={type:arguments[0].toLowerCase(),condition:null,callback:FI,tag:null,priority:0,once:!1,useCapture:!1,enumerable:!0,pausable:!0};return e.isFunction(arguments[1])?(t.callback=arguments[1],e.parseEventWithOptions(t,Array.prototype.slice.call(arguments,2))):e.isString(arguments[1])?(e.isFunction(arguments[2])||e.error("Parse event failed, due to callback is not function with condition"),t.condition=arguments[1],t.callback=arguments[2],e.parseEventWithOptions(t,Array.prototype.slice.call(arguments,3))):e.isNull(arguments[1])&&(e.isFunction(arguments[2])||e.error("Parse event failed, due to callback is not function with condition"),t.callback=arguments[2],e.parseEventWithOptions(t,Array.prototype.slice.call(arguments,3))),t.callback||e.error("Parse event failed, deu to callback function is not existing"),t}static parseFlyParam(t){return t.isBaseObject||e.isArray(t)?{target:t}:t}static parseLoopType(e){if(e)switch(e.toLowerCase()){case"repeat":return wB.Repeat;case"pingpong":return wB.PingPong}return""}static parseLerpType(t){if(e.isString(t))switch(t.toLowerCase()){case"quadratic.in":return EB.Quadratic.In;case"quadratic.out":return EB.Quadratic.Out;case"quadratic.inout":return EB.Quadratic.InOut;case"cubic.in":return EB.Cubic.In;case"cubic.out":return EB.Cubic.Out;case"cubic.inout":return EB.Cubic.InOut;case"quartic.in":return EB.Quartic.In;case"quartic.out":return EB.Quartic.Out;case"quartic.inout":return EB.Quartic.InOut;case"quintic.in":return EB.Quintic.In;case"quintic.out":return EB.Quintic.Out;case"quintic.inout":return EB.Quintic.InOut;case"sinusoidal.in":return EB.Sinusoidal.In;case"sinusoidal.out":return EB.Sinusoidal.Out;case"sinusoidal.inout":return EB.Sinusoidal.InOut;case"exponential.in":return EB.Exponential.In;case"exponential.out":return EB.Exponential.Out;case"exponential.inout":return EB.Exponential.InOut;case"circular.in":return EB.Circular.In;case"circular.out":return EB.Circular.Out;case"circular.inout":return EB.Circular.InOut;case"elastic.in":return EB.Elastic.In;case"elastic.out":return EB.Elastic.Out;case"elastic.inout":return EB.Elastic.InOut;case"back.in":return EB.Back.In;case"back.out":return EB.Back.Out;case"back.inout":return EB.Back.InOut;case"bounce.in":return EB.Bounce.In;case"bounce.out":return EB.Bounce.Out;case"bounce.inout":return EB.Bounce.InOut}else if(e.isFunction(t))return t;return EB.Linear.None}static parseCubeTextureUrlsByPath(e){if(!e)return null;e.endsWith("/")||(e+="/");var t=".jpg";return[e+"posx"+t,e+"negx"+t,e+"posy"+t,e+"negy"+t,e+"posz"+t,e+"negz"+t]}static markAsDebugNode(e){e.setAttribute("Pickable",!1),e.getUserData()[AB.BoundingBoxInheritType]=qB.Stop}static addFactory(e,t){void 0===t&&(t=0),super.addFactory(e,t)}static createObject(e,t){return super.createObject(e,t)}static createThreadWorkerFromClass(t){var r=t.toString();return e.createThreadWorkerFromCode(r)}static createThreadWorkerFromCode(t){var r=e.isFunction(t)?t.toString():t,n=r.substring(r.indexOf("{")+1,r.lastIndexOf("}")),i=e.createObjectURL(n);return e.createObject("ThreadWorker",{url:i})}static waitForAttach(t){return e._devDebugger.waitForAttach(t)}static beginRenderAnalyze(t){return e._renderDebugger.beginAnalyze(t||e.getCurrentApp().root.node)}static endRenderAnalyze(){return e._renderDebugger.endAnalyze()}static getRenderAnalyzeResult(t,r){void 0===r&&(r={});var n=e.getCurrentApp().objectManager;return e._renderDebugger.getAnalyzeResult(t,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mI(Object(r),!0).forEach((function(t){gB(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mI(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({onGetObjectByNode:function(e){return n.getBaseObjectFromNode(e)},onCloneObjet:function(t){return e.cloneObject(t)},onCheckIsArray:function(t){return e.isArray(t)}},r))}static isValidTexture(e){if(e){if(e.isImageTexture)return!0;if(e.isCubeTexture)return!0;if(e.isRenderTexture)return!0;if(e.isVideoTexture)return!0;if(e.isEmptyTexture)return!0}return!1}static syncOptions(t,r,n,i){void 0===i&&(i=PI),r.forEach((r=>{var a=e.parseValue(n[r],i[r]);e.isNull(a)||(t[r]=a)}))}static registerClassType(t,r){e.warn("Please call 'THING.Utils.registerClass()' instead"),t&&(t.className=r)}static login(t){void 0===t&&(t={});var r=t.url,n=t.wasmRootPath,i=e.parseValue(t.method,_I),a=e.parseValue(t.requestHeaders,""),s=e.parseValue(t.postFields,""),o=e.parseValue(t.maxWorkerNumber,-1);return new Promise(pB((function*(t,l){var{module:u,wasmOptions:c}=yield RI.loadWasmModule(n,{maxNumber:o}),h=u.Helper.getPlatformInfo();if(h){var d=e.getMacros();d.WASM=function(e,t){return{VERSION:e.version,SDKVERSION:e.sdkVersion,COMPILETIME:e.compileTime,features:t.features,exports:t.exports}}(h,c),"undefined"!=typeof THING&&(THING.WASM=THING.WASM||{},e.mergeObject(THING.WASM,d.WASM,!0))}r&&((NI=yield RI.login(i,r,a,s))[gI]=!1),t()})))}static error(){we.error.apply(console,arguments)}static uniqueObjects(e){for(var t=e.slice(),r=t.length-1;r>=0;r--)for(var n=t[r],i=r-1;i>=0;i--){var a=t[i];if(n==a){t._removeAt(r);break}if(n.isChildOf(a)){t._removeAt(r);break}a.isChildOf(n)&&(t._removeAt(i),r-=1)}return t}static importScript(t){return e._scriptLoader.importScript(t)}static isModelSceneUrl(t){var r=t._getExtension();return e.isModelSceneExtension(r)}static isModelSceneExtension(e){return"gltf"==e||"glb"==e}};BI.xAxis=[1,0,0],BI.yAxis=[0,1,0],BI.zAxis=[0,0,1],Object.defineProperties(Array.prototype,{waitForComplete:{writable:!0,enumerable:!1,configurable:!0,value:function(){try{return Promise.all(this.map((e=>e&&e.waitForComplete?e.waitForComplete():null)))}catch(e){BI.error(e)}}}});var II=Symbol("private");let OI=class{constructor(){this[II]={};var e=this[II];e.worker=null,e.onStop=null}postMessage(e){var t=this[II];t.worker.postMessage.apply(t.worker,arguments)}start(e){void 0===e&&(e={});var t=this[II];this.stop();var r=e.url;if(!r){var n=e.script;if(n)r=BI.createObjectURL(n);else{var i=e.func;if(i){var a=i.toString(),s=a.substring(a.indexOf("{")+1,a.lastIndexOf("}"));r=BI.createObjectURL(s)}}}if(!r)return BI.error("Create thread worker component failed, due to url or script is missing"),!1;t.worker=BI.createObject("ThreadWorker",{url:r});var o=e.onMessage;return t.worker.start(o),t.onStop=e.onStop,!0}stop(){var e=this[II];e.worker&&(e.onStop&&(e.onStop(),e.onStop=null),e.worker.dispose(),e.worker=null)}};class kI{constructor(){this._name="",this._active=!1}onEnter(){}onLeave(){}enter(){this._active||(this._active=!0,this.onEnter())}leave(){this._active&&(this._active=!1,this.onLeave())}get name(){return this._name}set name(e){this._name=e}get active(){return this._active}}function LI(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){if(this instanceof e){var r=[null];return r.push.apply(r,arguments),new(Function.bind.apply(t,r))}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var UI={},zI={get exports(){return UI},set exports(e){UI=e}};class jI{constructor(e=[],t=VI){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,n=t[e];for(;e>0;){const i=e-1>>1,a=t[i];if(r(n,a)>=0)break;t[e]=a,e=i}t[e]=n}_down(e){const{data:t,compare:r}=this,n=this.length>>1,i=t[e];for(;e<n;){let n=1+(e<<1),a=t[n];const s=n+1;if(s<this.length&&r(t[s],a)<0&&(n=s,a=t[s]),r(a,i)>=0)break;t[e]=a,e=n}t[e]=i}}function VI(e,t){return e<t?-1:e>t?1:0}var GI=LI(Object.freeze({__proto__:null,default:jI}));function WI(e,t,r){var n,i,a,s;t=t||1;for(var o=0;o<e[0].length;o++){var l=e[0][o];(!o||l[0]<n)&&(n=l[0]),(!o||l[1]<i)&&(i=l[1]),(!o||l[0]>a)&&(a=l[0]),(!o||l[1]>s)&&(s=l[1])}var u=a-n,c=s-i,h=Math.min(u,c),d=h/2;if(0===h){var p=[n,i];return p.distance=0,p}for(var f=new GI(void 0,HI),m=n;m<a;m+=h)for(var g=i;g<s;g+=h)f.push(new qI(m+d,g+d,d,e));var _=function(e){for(var t=0,r=0,n=0,i=e[0],a=0,s=i.length,o=s-1;a<s;o=a++){var l=i[a],u=i[o],c=l[0]*u[1]-u[0]*l[1];r+=(l[0]+u[0])*c,n+=(l[1]+u[1])*c,t+=3*c}return 0===t?new qI(i[0][0],i[0][1],0,e):new qI(r/t,n/t,0,e)}(e),v=new qI(n+u/2,i+c/2,0,e);v.d>_.d&&(_=v);for(var y=f.length;f.length;){var x=f.pop();x.d>_.d&&(_=x,r&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,y)),x.max-_.d<=t||(d=x.h/2,f.push(new qI(x.x-d,x.y-d,d,e)),f.push(new qI(x.x+d,x.y-d,d,e)),f.push(new qI(x.x-d,x.y+d,d,e)),f.push(new qI(x.x+d,x.y+d,d,e)),y+=4)}r&&(console.log("num probes: "+y),console.log("best distance: "+_.d));var b=[_.x,_.y];return b.distance=_.d,b}function HI(e,t){return t.max-e.max}function qI(e,t,r,n){this.x=e,this.y=t,this.h=r,this.d=function(e,t,r){for(var n=!1,i=1/0,a=0;a<r.length;a++)for(var s=r[a],o=0,l=s.length,u=l-1;o<l;u=o++){var c=s[o],h=s[u];c[1]>t!=h[1]>t&&e<(h[0]-c[0])*(t-c[1])/(h[1]-c[1])+c[0]&&(n=!n),i=Math.min(i,XI(e,t,c,h))}return 0===i?0:(n?1:-1)*Math.sqrt(i)}(e,t,n),this.max=this.d+this.h*Math.SQRT2}function XI(e,t,r,n){var i=r[0],a=r[1],s=n[0]-i,o=n[1]-a;if(0!==s||0!==o){var l=((e-i)*s+(t-a)*o)/(s*s+o*o);l>1?(i=n[0],a=n[1]):l>0&&(i+=s*l,a+=o*l)}return(s=e-i)*s+(o=t-a)*o}GI.default&&(GI=GI.default),zI.exports=WI,UI.default=WI;class QI extends zu{static fixScaleFactor(e){return 0===e[0]&&(e[0]=Number.EPSILON),0===e[1]&&(e[1]=Number.EPSILON),0===e[2]&&(e[2]=Number.EPSILON),e}static getOutlinePoints(e){var t,r,n,i,a,s,o,l,u=(e,t,r)=>0<=(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0]);for(e.sort(((e,t)=>e[0]+e[1]/1e4-(t[0]+t[1]/1e4))),t=e.length-1,i=[],(n=[]).push((r=e)[0],r[1]),o=0;o<2;o++){for(a=2;a<=t;a++){for(s=0===o?r[a]:r[t-a],l=n.length;l>1&&!u(n[l-2],n[l-1],s);)n.pop(),l=n.length;n.push(s)}i.push(...n),n.length=0,n.push(r[t],r[t-1])}return QI.toUniquePoints(i.slice(1))}static getLabelPosition(e,t,r){void 0===t&&(t=null),void 0===r&&(r=0);var n=[];n.push(QI.toPlanePoints(e)),t&&t.forEach((e=>{n.push(QI.toPlanePoints(e))}));var i=new UI(n);return[i[0],r,i[1]]}}var KI=["=","<",">","!"],YI=["|","&","||","&&"];function ZI(){this.object=null}Object.assign(ZI.prototype,{init:function(e){return this.object=e,this},dispose:function(){this.object=null}});var JI=new ZI;function $I(e){return"uuid"===e||"id"===e||"name"===e}function eO(e){if(e._startsWith("tags")){var t=e[4];if("("==t)return"tags";if(":"==t){var r=e.substring(5);if(r._startsWith("not("))return"tags_not";if(r._startsWith("and("))return"tags_and";if(r._startsWith("or("))return"tags_or"}}return!1}function tO(e,t){for(var r=0,n=t.length;r<n;r++){var i=t[r];if(e.startsWith(i))return!0}return!1}function rO(e,t,r,n){void 0===n&&(n=!1);for(var i=e+"('",a="",s=0;s<t.length;s++){var o=t[s];if("="==o||"<"==o||">"==o||"!"==o)break;a+=o}i+=a._trimBoth('" \t'),i+="'",i+=n?",":")";var l=t.substring(s);if(l){var u=function(e){for(var t="",r=0;r<e.length;r++){var n=e[r];if("="!=n&&"<"!=n&&">"!=n&&"!"!=n)break;t+=n}return"="==t&&(t="=="),t._trimBoth(" \t")}(l);if(u)if(l=l._trimLeft(u)._trimBoth(" \t"),ae.isNumberString(l)||ae.isBooleanString(l)){r(a)&&(l='"'+(l=l._trimBoth('"'))+'"');var c=!0;l.length&&(c=!1),ae.isNumberString(l)&&(l=l._replaceAll("^(0+)","")),l||c||(l="0")}else"/"==l[0]&&"/"==l[l.length-1]?(l=l.substr(1,l.length-2),i=i._removeAt(i.length-1),u=",",'"'!=l[0]&&"'"!=l[0]&&(l="'"+l+"'"),l+=")"):'"'!=l[0]&&"'"!=l[0]&&(l="'"+l+"'");n||(i+=u),i+=l}return n&&(i+=")"),i}function nO(e,t,r,n){var i="";i+=e+"(",n&&(i+='"');var a=function(e,t){var r="";if(ae.isArray(t))for(var n=0,i=e.length;n<i&&!tO(e.substring(n),t);n++)r+=e[n];else for(var a=0,s=e.length;a<s;a++){var o=e[a];if(-1!==t.indexOf(o))break;r+=o}return r}(t,r);return i+=a._trimBoth("'\"")._trimBoth(" "),n&&(i+='"'),{expression:i+=")",value:a}}function iO(e,t){for(var r="",n=0;n<e.length;n++){var i=e[n];if(" "!=i&&"\t"!=i)if("|"==i)"|"==e[n+1]&&n++,r+="||";else if("&"==i)"&"==e[n+1]&&n++,r+="&&";else if("!"==i||"("==i||")"==i)r+=i;else if("+"==i||"-"==i||"*"==i||"/"==i)r+=i;else if(t||"["==i){var a="",s=!1,o=void 0;if(t){var l=t+("userData"===t?"/":"=");n+=(o=nO("",l+e.substring(n),YI.concat([")"]))).value.length-l.length-1}else n+=(o=nO("",e.substring(n+1),"]")).value.length+1;o.value._endsWith("*")?(a="_regExp",s=!0):a=o.value._contains(KI)?"_attribute":"_hasAttribute",r+=rO(a,o.value,$I,s)}else if("#"==i){var u=nO("_id",e.substring(n+1)," \t|&",!0);r+=u.expression,n+=u.value.length}else if("."==i){var c=nO("_type","is"+e.substring(n+1)," \t|&",!0);r+=c.expression,n+=c.value.length-2}else if("/"==i){var h=nO("_regExp",e.substring(n+1),"/",!0);n+=h.value.length+1;var d=e.substring(n).indexOf("(");if(-1!==d){n+=d+1;var p=e.substring(n).indexOf(")");if(-1!==p){var f=e.substr(n,p);r+="_regExp('"+h.value+"', '"+f+"')",n+=p+1}}}else{var m=void 0,g=eO(e);g?(n+=g.length+1,m=nO(g,e.substring(n),[")"],!0),"tags_and"==g?m.expression=m.expression._replaceAll(",","&&"):"tags_not"!=g&&"tags_or"!=g||(m.expression=m.expression._replaceAll(",","||"))):m=nO("_name",e.substring(n),YI,!0),r+=m.expression,n+=m.value.length}}return r}JI._name=function(e){return JI.object.name==e},JI._id=function(e){return JI.object.id==e},JI._type=function(e){return!0===JI.object[e]},JI._regExp=function(e,t){var r;if(t._startsWith("[")){var n=t.substr(1,t.length-2)._trimBoth(" \t");r=JI.object.getAttribute(n)}else r=JI.object.getAttribute(e);if(ae.isString(r)){var i=aO.regExps,a=i.get(e);return a||(a=new RegExp("^"+t._trimRight("*")),i.set(e,a)),a.test(r)}return!1},JI._attribute=function(e,t){var r=JI.object.getAttribute(e);return r&&t?JI._regExp(e,t):r},JI._hasAttribute=function(e){return JI.object.hasAttribute(e)},JI.tags=function(e){var t=aO.buildExpression(e,null,"tags");if(!t)return!1;var r=JI.object.tags;return!!t.evaluate(r,(e=>r.has(e)))},JI.tags_not=function(e){return!JI.tags(e)},JI.tags_and=function(e){return JI.tags(e)},JI.tags_or=function(e){return JI.tags(e)};class aO{static buildExpression(e,t,r){if(ae.isRegExp(e))return e;var n=aO.expressions;"tags"===r&&(n=aO.tagsExpressions,r=null);var i=r?r+":"+e:e,a=n.get(i);if(void 0===a){var s=t?t(e,r):e;try{a=new Ft(s),n.set(e,a)}catch(t){return n.set(e,null),ae.error(t),null}}return a}constructor(e,t){return this._expression=aO.buildExpression(e,iO,t),this}evaluate(e){var t=this._expression;if(!t)return null;if(ae.isRegExp(t))return t.test(e.name);JI.init(e);var r=t.evaluate(JI);return JI.dispose(),r}static update(e){aO.expressions.update(e),aO.regExps.update(e)}}aO.expressions=new kt({liveTime:1e4,cleanupTime:5e3}),aO.tagsExpressions=new kt({liveTime:1e4,cleanupTime:5e3}),aO.regExps=new kt({liveTime:1e4,cleanupTime:5e3});var sO=Symbol("private");class oO{constructor(e){void 0===e&&(e={}),this[sO]={};var t=this[sO];t.queryResolves=new Map,t.queryOrderID=1,t.commands=[],t.worker=null,t.worker=new Worker(e.workerUrl),t.worker.onmessage=e=>{var r=e.data;if("queryResult"===r.type){var n=r.queryOrderID,i=r.orderIDs,a=t.queryResolves.get(n);a&&(t.queryResolves.delete(n),a({orderIDs:i}))}}}_flushCommands(){var e=this[sO],t=e.commands;t.length&&(e.worker.postMessage({type:"commands",commands:t}),t.length=0)}addObject(e){var t=this[sO],r=e.parent;t.commands.push({type:"addObject",object:{types:e.__types,orderId:e.orderId,parentObjectOrderID:r?r.orderId:null,id:e.id,uuid:e.uuid,name:e.name,queryable:e.queryable}})}removeObject(e){this[sO].commands.push({type:"removeObject",orderId:e.orderId})}updateObjectAttribute(e,t,r){this[sO].commands.push({type:t,orderId:e.orderId,value:r})}queryAsync(e,t,r){var n=this[sO];return new Promise(((i,a)=>{this._flushCommands();var s={type:"query",queryOrderID:n.queryOrderID++,rootOrderID:e.orderId,recursive:t,condition:r};n.queryResolves.set(s.queryOrderID,i),n.worker.postMessage(s)}))}selectAsync(e,t){var r=this[sO];return new Promise(((n,i)=>{this._flushCommands();var a={type:"select",queryOrderID:r.queryOrderID++,objectOrderIDs:e.map((e=>e.orderId)),condition:t};r.queryResolves.set(a.queryOrderID,n),r.worker.postMessage(a)}))}}var lO=Symbol("private"),uO="__Style_AnimationTagName__",cO=1,hO=2,dO=4,pO=8,fO=16,mO=32,gO=64,_O=128,vO=256,yO=512,xO=1024,bO=2048,AO=4096,SO=8192,EO=16384,wO=32768,CO=65536,TO=1<<17,DO=1<<18,MO=1<<19,PO=1<<20,FO=1<<21,RO=1<<22,NO=1<<23,BO=1<<24,IO=cO|hO|dO|pO|fO|mO|gO|_O|vO|yO|EO|wO|CO|TO,OO=IO|xO|bO|AO|SO|DO|MO|PO|FO,kO={blendingType:null,sideType:null,opacity:null,metalness:null,roughness:null,color:null,emissive:null,outlineColor:null,transparent:null,clippingPlanes:null,wireframe:null,depthTest:null,depthWrite:null,envMapping:null},LO=Object.keys(kO),UO={enable:!1,color:[1,1,1],opacity:1,glow:!1},zO=Object.keys(UO),jO={glow:null,innerGlow:null,lineBloom:null,tailing:null,radial:null,ghosting:null},VO=Object.keys(jO),GO={map:null,envMap:null,alphaMap:null,emissiveMap:null,normalMap:null,colorMapping:null,aoMap:null},WO=Object.keys(GO);var HO={offset:[0,0],repeat:[1,1],center:[0,0],rotation:0},qO=["attributes","uniforms","macros"];function XO(e,t){if(e&&t&&BI.isArray(e)&&BI.isArray(t)){if(e.length!=t.length)return!1;switch(e.length){case 1:return e[0]==t[0];case 2:return e[0]==t[0]&&e[1]==t[1];case 3:return e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2];case 4:return e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]&&e[3]==t[3];default:for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!1}}else if(e!==t)return!1;return!0}function QO(e){return e}function KO(e){switch(e){case"Map":return"map";case"EnvMap":return"envMap";case"AlphaMap":return"alphaMap";case"EmissiveMap":return"emissiveMap";case"NormalMap":return"normalMap";case"ColorMapping":return"colorMapping";case"AOMap":return"aoMap";default:return e}}function YO(e){switch(e){case"map":return"Map";case"envMap":return"EnvMap";case"alphaMap":return"AlphaMap";case"emissiveMap":return"EmissiveMap";case"normalMap":return"NormalMap";case"colorMapping":return"ColorMapping";case"aoMap":return"AOMap";default:return e}}function ZO(e,t){return!t||!t.isBaseObject}function JO(e,t){return t=t||{},Object.assign(t,e)}function $O(e,t){for(var r in t=t||{},e){var n=e[r];null!=n&&BI.isArray(n)?t[r]=n.slice(0):t[r]=n}return t}class ek{constructor(e){this[lO]={};var t=this[lO];t.modifier=e,t.curImageSlotType=JB.Map,t.edgeData=null,t.effectData=null,t.imagesData=null,t.uvData=null,t.data=new gr({data:kO,keys:LO,onNeedProxy:ZO,onCloneObject:$O,onEquals:XO}),t.state=new Wt,t.values={attributes:null,uniforms:null,macros:null}}_getValues(e){var t=this[lO],r={data:t.data[e]};return t.edgeData&&(r.edge=t.edgeData[e]),t.effectData&&(r.effect=t.effectData[e]),t.imagesData&&(r.images=t.imagesData[e]),t.uvData&&(r.uvData=t.uvData[e]),r}_updateDiffSlots(e,t){var r=this[lO],n=r.state,i=n.values&OO;n.enable(e,t),0===i&&n.values?(r.modifier.onBegin(),r.state.has(RO)&&(r.modifier.resource.begin(),r.state.enable(RO,!1))):i&&0==(n.values&OO)&&r.modifier.onEnd()}_createColorOpCallback(e){if(!e)return null;var t=function(t){var r=e(t,this);return BI.parseColor(r,t)};return e.isConstantValue&&(t.isConstantValue=!0),t}_createOpCallback(e){if(!e)return null;var t=function(t){return e(t,this)};return e.isConstantValue&&(t.isConstantValue=!0),t}_createColorCallbackWrapper(e){var t=this[lO];return this._createColorOpCallback((r=>t.data.getValueByDefault(e)))}_createOpCallbackWrapper(e,t){var r=this[lO];return t?this._createOpCallback((n=>t(n,r.data.getValueByDefault(e)))):this._createOpCallback((t=>r.data.getValueByDefault(e)))}_updateAttributeValue(e,t,r,n,i){var a=this[lO];if(BI.isNull(r)){if(!a.data.setValue(t,null,XO))return}else if(n&&(r=n(r)),!a.data.setValue(t,r,XO,null,QO))return;var s=a.data.isBaseValue(t,XO);this._updateDiffSlots(e,!s),i(t,r=a.data.getValue(t))}_updateAttributeOpFunc(e,t,r,n,i,a){var s=this[lO];if(BI.isNull(r)){if(!s.data.setValue(t,null,XO))return;s.data.hasValue(t)&&(r=a(t))}else if(BI.isFunction(r)){if(r=i(r),!s.data.setValue(t,r,XO))return;if(s.state.has(BO)&&s.data.hasValue(t,!0))return}else{if(n&&!(r=n(r)))return;if(!s.data.setValue(t,r,XO,null,QO))return;if(s.state.has(BO)&&s.data.hasValue(t,!0))return;r=a(t)}var o=s.data.isBaseValue(t,XO);this._updateDiffSlots(e,!o),s.modifier.onChangeOpFunc(t,r)}_updateColor(e,t,r){this._updateAttributeValue(e,t,r,(e=>BI.parseColor(e,null)),((e,t)=>{this[lO].modifier.onChangeColor(e,t)}))}_updateValue(e,t,r){this._updateAttributeValue(e,t,r,null,((e,t)=>{this[lO].modifier.onChangeValue(e,t)}))}_updateColorOpFunc(e,t,r){this._updateAttributeOpFunc(e,t,r,(e=>BI.parseColor(e,null)),(e=>this._createColorOpCallback(e)),(e=>this._createColorCallbackWrapper(e)))}_updateValueOpFunc(e,t,r,n){this._updateAttributeOpFunc(e,t,r,null,(e=>this._createOpCallback(e)),(e=>this._createOpCallbackWrapper(e,n)))}_updateValues(e,t,r,n){n.setValue(t,r,XO,((t,r)=>{var i=XO(n.getValue(t),r);this._updateDiffSlots(e,!i)}))}_changeValue(e,t,r){var n=this[lO],i=r.key,a=BI.parseValue(r.value,null),s=n.data.isBaseValue(i,XO);this._updateDiffSlots(e,!s),n.modifier[t](i,a)}_createAttributes(){var e=this[lO];return e.values.attributes||(e.values.attributes=new gr({onChange:e=>{this._changeValue(MO,"onChangeAttribute",e)}})),e.values.attributes}_createUniforms(){var e=this[lO];return e.values.uniforms||(e.values.uniforms=new gr({onNeedProxy:function(e,t){return!t||!t.isImageTexture},onChange:e=>{this._changeValue(PO,"onChangeUniformValue",e)}})),e.values.uniforms}_createMacros(){var e=this[lO];return e.values.macros||(e.values.macros=new gr({onChange:e=>{this._changeValue(FO,"onChangeMacroValue",e)}})),e.values.macros}_updateImage(e,t,r){var n=this[lO],i=n.modifier;if(i){if(r){if(n.imagesData.getValues()[e])return}else if(n.imagesData.data[e]!=t)return;this._updateDiffSlots(AO,!0);var a=YO(e);if(t)i.onChangeImage(a,t.getTextureResource());else{var s=n.imagesData.defaultValues[e];s?i.onChangeImage(a,s.getTextureResource()):i.onChangeImage(a,null)}}}_createImagesData(){var e=this[lO];return e.imagesData||(e.imagesData=new gr({data:GO,keys:WO,onCloneObject:e=>({map:e.map,envMap:e.envMap,alphaMap:e.alphaMap,emissiveMap:e.emissiveMap,normalMap:e.normalMap,colorMapping:e.colorMapping,aoMap:e.aoMap}),onFilterProperty:()=>!1,onChange:e=>{},onNeedProxy:ZO,onCloneObject:JO,onEquals:XO})),e.imagesData}_updateImageUVMatrix(e,t){var r=this[lO],n=t.offset,i=t.repeat,a=t.center,s=QI.degToRad(t.rotation),o=Math.cos(s),l=Math.sin(s),u=[i[0]*o,-i[1]*l,0,i[0]*l,i[1]*o,0,-i[0]*(o*a[0]+l*a[1])+a[0]+n[0],-i[1]*(-l*a[0]+o*a[1])+a[1]+n[1],1];this._updateDiffSlots(SO,!0),r.modifier.onChangeUVMatrix(e,u)}_createUVMatrixData(){var e=this[lO];return e.uvData||(e.uvData=new gr({data:{map:HO,envMap:HO,alphaMap:HO,emissiveMap:HO,normalMap:HO,colorMapping:HO,aoMap:HO},keys:WO,onCloneObject:e=>({map:{offset:[0,0],repeat:[1,1],center:[0,0],rotation:0},envMap:{offset:[0,0],repeat:[1,1],center:[0,0],rotation:0},alphaMap:{offset:[0,0],repeat:[1,1],center:[0,0],rotation:0},emissiveMap:{offset:[0,0],repeat:[1,1],center:[0,0],rotation:0},normalMap:{offset:[0,0],repeat:[1,1],center:[0,0],rotation:0},colorMapping:{offset:[0,0],repeat:[1,1],center:[0,0],rotation:0},aoMap:{offset:[0,0],repeat:[1,1],center:[0,0],rotation:0}}),onChange:t=>{var r=e.curImageSlotType,n=t.data[KO(r)];n&&this._updateImageUVMatrix(r,n)},onEquals:XO})),e.uvData}_getImageUVMatrixByType(e){var t=this[lO];e=KO(e),this._createUVMatrixData();var r=t.uvData.getValueByDefault(e);return r||(t.uvData.setValue(e,{offset:[0,0],repeat:[1,1],center:[0,0],rotation:0},XO),r=t.uvData.getValueByDefault(e)),r}_createEdgeData(){var e=this[lO];return e.edgeData||(e.edgeData=new gr({data:UO,keys:zO,onCloneObject:e=>({enable:e.enable,color:e.color.slice(0),opacity:e.opacity,glow:e.glow}),onConvertValue:(e,t)=>{if("color"==e)return BI.parseColor(t,null)},onChange:t=>{this._updateDiffSlots(xO,!0),e.modifier.onChangeEdge(t.data)},onEquals:XO})),e.edgeData}_createEffectData(){var e=this[lO];return e.effectData||(e.effectData=new gr({data:jO,keys:VO,onCloneObject:e=>({glow:e.glow,innerGlow:e.innerGlow,lineBloom:e.lineBloom,tailing:e.tailing,radial:e.radial,ghosting:e.ghosting}),onChange:t=>{this._updateDiffSlots(bO,!0),e.modifier.onChangeEffect(t.data)},onCloneObject:JO,onEquals:XO})),e.effectData}dispose(){var e=this[lO];if(e.edgeData&&(e.edgeData.dispose(),e.edgeData=null),e.effectData&&(e.effectData.dispose(),e.effectData=null),e.imagesData&&(e.imagesData.dispose(),e.imagesData=null),e.uvData&&(e.uvData.dispose(),e.uvData=null),e.modifier){var t=e.modifier.object;t.off(SB.PlayAnimation,uO),t.off(SB.StopAnimation,uO),e.modifier.dispose(),e.modifier=null}qO.forEach((t=>{e.values[t]&&(e.values[t].dispose(),e.values[t]=null)}))}updateBaseValues(e){var t=this[lO],r=t.state.values&OO;r&&(r&IO&&t.data.updateBaseValues(e.data),e.edge&&(this._createEdgeData(),t.edgeData.updateBaseValues(e.edge)),e.effect&&(this._createEffectData(),t.effectData.updateBaseValues(e.effect)),e.images&&(this._createImagesData(),t.imagesData.updateBaseValues(e.images)),e.uv&&(this._createUVMatrixData(),t.uvData.updateBaseValues(e.uv)),qO.forEach((e=>{t.values[e]&&t.values[e].makeCurrentAsBaseValue()})),t.state.clear(OO))}initResource(e){this[lO].modifier.initResource(e)}updateResource(e){this[lO].modifier.updateResource(e)}getOringialValues(){return this._getValues("data")}getValuesWithDefaults(){var e=this[lO],t={data:e.data.getValuesWithDefaults(XO)};return e.edgeData&&(t.edge=e.edgeData.getValuesWithDefaults(XO)),e.effectData&&(t.effect=e.effectData.getValuesWithDefaults(XO)),e.imagesData&&(t.images=e.imagesData.getValuesWithDefaults(XO)),e.uvData&&(t.uvData=e.uvData.getValuesWithDefaults(XO)),t}getData(e){return"edge"==e?this._createEdgeData().data:"effect"==e?this._createEffectData().data:"images"==e?this._createImagesData().data:"uv"==e?this._createUVMatrixData().data:"attributes"==e?this._createAttributes().data:"macros"==e?this._createMacros().data:"uniforms"==e?this._createUniforms().data:null}copyFromValues(e){var t=e.data;for(var r in t)this[r]=t[r];var n=e.edge;n&&(this.edge=n);var i=e.effect;i&&(this.effect=i);var a=e.images;if(a)for(var s in a){var o=a[s];o&&this.setImage(s,o)}var l=e.uvData;if(l){var u=this.imageSlotType;for(var c in l){this.imageSlotType=c;var h=l[c];this.uv.offset=h.offset,this.uv.repeat=h.repeat,this.uv.center=h.center,this.uv.rotation=h.rotation}this.imageSlotType=u}}copy(e){if(!e)return this;if(e.isStyle)this.copyFromValues(e.getOringialValues());else if(BI.isObject(e))for(var t in e)this[t]=e[t];return this}getImage(e){var t=this[lO];return t.imagesData?t.imagesData.data[KO(e)]:null}setImage(e,t){if(!t||(t==cI.ImageTexture&&(t=BI.getCurrentApp().global.cache.images.empty_image_texture,console.warn("THING.Empty.ImageTexture will not be supported soon. Use THING.Empty.Texture instead.")),t==cI.Texture&&(t=BI.getCurrentApp().global.cache.images.empty_image_texture),BI.isValidTexture(t))){e=KO(e);var r=this._createImagesData(),n=r.isChangingDefaultValues(),i=n?r.defaultValues[e]:r.data[e];i!=t&&(i&&i.release(),r.updateValue(e,t),t?(this._updateImage(e,t,n),t.addRef()):this._updateImage(e,null))}else BI.error("Set style image failed, due to image is unknown",t)}getUV(e){var t=this._getImageUVMatrixByType(e);return t||null}setUV(e,t,r){var n=this._getImageUVMatrixByType(e);n&&(n[t]=r)}beginDefaultValues(){var e=this[lO];e.state.enable(BO,!0),this._createEdgeData(),this._createEffectData(),this._createImagesData(),this._createUVMatrixData(),e.edgeData.beginDefaultValues(),e.effectData.beginDefaultValues(),e.imagesData.beginDefaultValues(),e.uvData.beginDefaultValues(),e.data.beginDefaultValues(),qO.forEach((t=>{e.values[t]&&e.values[t].beginDefaultValues()}))}endDefaultValues(){var e=this[lO];e.edgeData.endDefaultValues(),e.effectData.endDefaultValues(),e.imagesData.endDefaultValues(),e.uvData.endDefaultValues(),e.data.endDefaultValues(),qO.forEach((t=>{e.values[t]&&e.values[t].endDefaultValues()})),e.state.enable(BO,!1)}getDiffValues(){var e=this[lO],t=e.data.getDiffValues();return e.edgeData&&(t.edge=e.edgeData.getDiffValues()),e.effectData&&(t.effect=e.effectData.getDiffValues()),e.imagesData&&(t.images=e.imagesData.getDiffValues()),e.uvData&&(t.uvData=e.uvData.getDiffValues()),t}bindAnimationEvents(e){var t=this[lO];if(!t.state.has(NO)){t.state.enable(NO,!0);var r=e.animationNames;r&&r.length&&(e.on(SB.PlayAnimation,(e=>{this._updateDiffSlots(DO,!0)}),uO),e.on(SB.StopAnimation,(e=>{this._updateDiffSlots(DO,!1)}),uO))}}begin(){this.resource?this.resource.begin():this[lO].state.enable(RO,!0)}end(){this.resource?this.resource.end():this[lO].state.enable(RO,!1)}setAttribute(e,t){var r=this._createAttributes(),n=r.getValue(e);null===n&&this.resource&&(n=this.resource.getAttribute(e),BI.isValid(n)&&r.updateBaseValue(e,n)),this._updateValues(MO,e,t,r)}getAttribute(e){return this._createAttributes().getValue(e)}setUniform(e,t){var r=this._createUniforms();this._updateValues(PO,e,t,r)}getUniform(e){return this._createUniforms().getValue(e)}setMacro(e,t){var r=this._createMacros();this._updateValues(FO,e,t,r)}getMacro(e){return this._createMacros().getValue(e)}toJSON(){var e={};function t(e,t,r){t.forEach((t=>{var n=e[t];BI.isNull(n)||BI.isFunction(n)||r(t,n)}))}return t(this,LO,((t,r)=>{e[t]=r})),t(this.edge,zO,((t,r)=>{e.edge=e.edge||{},e.edge[t]=r})),t(this.effect,VO,((t,r)=>{e.effect=e.effect||{},e.effect[t]=r})),e}get originalResource(){return this[lO].modifier.originalResource}get resource(){return this[lO].modifier.resource}get modifier(){return this[lO].modifier}set modifier(e){this[lO].modifier=e}get values(){return this._getValues("values")}get data(){return this._getValues("data")}get isInstancedDrawing(){return this[lO].modifier.object.bodyNode.getStyle().isEnabled("InstancedDrawing")}get blendingType(){return this.values.data.blendingType}set blendingType(e){this._updateValue(cO,"blendingType",e)}get sideType(){return this.values.data.sideType}set sideType(e){this._updateValue(hO,"sideType",e)}get transparent(){return this.values.data.transparent}set transparent(e){this._updateValue(vO,"transparent",e)}get wireframe(){return this.values.data.wireframe}set wireframe(e){this._updateValue(EO,"wireframe",e)}get depthTest(){return this.values.data.depthTest}set depthTest(e){this._updateValue(wO,"depthTest",e)}get depthWrite(){return this.values.data.depthWrite}set depthWrite(e){this._updateValue(CO,"depthWrite",e)}get envMapping(){return this.values.data.envMapping}set envMapping(e){this._updateValue(TO,"envMapping",e)}get imageSlotType(){return this[lO].curImageSlotType}set imageSlotType(e){this[lO].curImageSlotType=YO(e)}get image(){var e=this[lO];return this.getImage(e.curImageSlotType)}set image(e){var t=this[lO];this.setImage(t.curImageSlotType,e)}get map(){return this.getImage(JB.Map)}set map(e){this.setImage(JB.Map,e)}get envMap(){return this.getImage(JB.EnvMap)}set envMap(e){this.setImage(JB.EnvMap,e)}get alphaMap(){return this.getImage(JB.AlphaMap)}set alphaMap(e){this.setImage(JB.AlphaMap,e)}get emissiveMap(){return this.getImage(JB.EmissiveMap)}set emissiveMap(e){this.setImage(JB.EmissiveMap,e)}get normalMap(){return this.getImage(JB.NormalMap)}set normalMap(e){this.setImage(JB.NormalMap,e)}get colorMapping(){return this.getImage(JB.ColorMapping)}set colorMapping(e){this.setImage(JB.ColorMapping,e)}get aoMap(){return this.getImage(JB.AOMap)}set aoMap(e){this.setImage(JB.AOMap,e)}get uv(){var e=this[lO];return this.getUV(e.curImageSlotType)}set uv(e){var t=this[lO],r=this._getImageUVMatrixByType(t.curImageSlotType);if(r)for(var n in e)r[n]=e[n]}get opacity(){return this.values.data.opacity}set opacity(e){this._updateValueOpFunc(dO,"opacity",e,((e,t)=>e*t))}get color(){return this[lO].data.values.color}set color(e){this._updateColorOpFunc(mO,"color",e)}get metalness(){return this.values.data.metalness}set metalness(e){this._updateValueOpFunc(pO,"metalness",e)}get roughness(){return this.values.data.roughness}set roughness(e){this._updateValueOpFunc(fO,"roughness",e)}get emissive(){return this[lO].data.values.emissive}set emissive(e){this._updateColorOpFunc(gO,"emissive",e)}get outlineColor(){return this[lO].data.values.outlineColor}set outlineColor(e){this._updateColor(_O,"outlineColor",e)}get clippingPlanes(){return this.values.data.clippingPlanes}set clippingPlanes(e){this._updateValue(yO,"clippingPlanes",e)}get edge(){var e=this[lO];return this._createEdgeData(),e.edgeData.values}set edge(e){if(e){var t=this[lO];this._createEdgeData(),t.edgeData.mergeValues(e)}}get effect(){var e=this[lO];return this._createEffectData(),e.effectData.values}set effect(e){if(e){var t=this[lO];this._createEffectData(),t.effectData.mergeValues(e)}}get attributes(){return this._createAttributes().values}set attributes(e){for(var t in e)this.setAttribute(t,e)}get uniforms(){return this._createUniforms().values}set uniforms(e){for(var t in e)this.setUniform(t,e)}get macros(){return this._createMacros().values}set macros(e){for(var t in e)this.setMacro(t,e)}get isStyle(){return!0}}ek.cDefaultValues=kO,ek.cEdgeDefaultValues=UO,ek.cEffectDefaultValues=jO,ek.cImagesDefaultValues=GO,ek.cUVMatrixDefaultValues=HO;var tk=["sideType","opacity","color","emissive","roughness","metalness","specularFactor","colorMappingIntensity","outlineColor","lights","transparent","wireframe","verticalEmissive","clippingPlanes","imageSlotType","image","map","envMap","normalMap","colorMapping"],rk={images:ek.cImagesDefaultValues,edge:ek.cEdgeDefaultValues,effect:ek.cEffectDefaultValues,attributes:{},uniforms:{},macros:{}};class nk{constructor(){for(var e in this._objects=[],this._buildAttributes(),rk){var t=rk[e];this._buildAccessor(e,t)}}_traverseStyle(e,t){this._objects.forEach((r=>{var n=r.style;n&&(n[e]=t)}))}_buildAttribute(e){Object.defineProperty(this,e,{set:t=>{this._traverseStyle(e,t)}})}_buildAttributes(){tk.forEach((e=>{this._buildAttribute(e)}))}_buildAccessor(e,t){var r=new gr({propName:e,data:t,onChange:e=>{var t=e.key,r=e.propName,n=e.value;this._objects.forEach((e=>{var i=e.style;i&&(r?i[r][t]=n:i[t]=n)}))}});this[e]=r.values}init(e){return this._objects=e,this}}function ik(e,t,r){e.forEach((e=>{e.inherit[t]=r}))}class ak{constructor(){}init(e){return this._objects=e,this}set visible(e){ik(this._objects,"visible",e)}set pickable(e){ik(this._objects,"pickable",e)}set style(e){ik(this._objects,"style",e)}}var sk=new nk,ok=new ak,lk=new Map;function uk(e,t){var r=t?t+":"+e:e,n=lk.get(r);return n||(n=new aO(e,t),lk.set(r,n)),n}function ck(e,t,r){t.forEach((t=>{e.evaluate(t)&&r.push(t)}))}class hk{constructor(e){this._app=BI.getCurrentApp(),this._objects=function(e){return BI.isArray(e)?e:BI.isObject(e)?BI.parseValue(e.objects,[]):[]}(e);var t=new Proxy(this,{get:(e,t)=>{var r=this._objects[t];return r&&r.isBaseObject?r:e[t]}});return Object.defineProperty(t,"customFormatters",{enumerable:!1,configurable:!1,get:()=>["object",{object:this._objects}]}),t}static update(e){aO.update(e)}_queryInWorker(e,t,r){return new Promise(((n,i)=>{var a;"*"==e?(a=t?t.query(e,{recursive:r}):this.onCreateInstance({objects:this.objects}),n(a)):(t?hk.asyncSelector.queryAsync(t,r,e):hk.asyncSelector.selectAsync(this.objects,e)).then((e=>{var t=this._app.objectManager.objects,r=e.orderIDs.map((e=>t.get(e))),i=this.onCreateInstance({objects:r});n(i)}))}))}init(e){return this.clear(),this._objects=e.slice(0),this}applyObjects(e,t){this._objects.forEach((r=>{r[e].apply(r,t)}))}onCreateInstance(){return new hk(arguments[0])}select(e,t){var r=[];(t=t||this.objects).length&&(BI.isString(e)?"*"==e?r=t.slice(0):ck(uk(e),t,r):BI.isRegExp(e)?function(e,t,r){t.forEach((t=>{e.test(t.name)&&r.push(t)}))}(e,t,r):BI.isFunction(e)&&function(e,t,r){t.forEach((t=>{e(t)&&r.push(t)}))}(e,t,r));return r}_selectByCondition(e,t,r){var n=[];(t=t||this.objects).length&&(BI.isString(e)&&ck(uk(e,r),t,n));return n}_outputLogger(e,t){var r={condition:t};BI.logger.api("Selector_"+e,{msg:JSON.stringify(r)})}test(e,t){return BI.isString(e)?"*"==e||uk(e).evaluate(t):BI.isRegExp(e)?e.test(t.name):!!BI.isFunction(e)&&e(t)}query(e,t,r){var n=t||this._objects,i=this.select(e,n).filter((e=>e.queryable));return(r=r||this.onCreateInstance()).init(i)}_queryByCondition(e,t,r,n){var i=t||this._objects,a=this._selectByCondition(e,i,n).filter((e=>e.queryable));return(r=r||this.onCreateInstance()).init(a)}queryByRegExp(e,t,r){return this.query(e,t,r)}queryByReg(e,t,r){return this.queryByRegExp(e,t,r)}queryByTags(e,t,r){return this._queryByCondition("tags("+e+")",t,r,"tags")}queryByName(e,t,r){return this._queryByCondition(e,t,r,"name")}queryByUUID(e,t,r){return this._queryByCondition(e,t,r,"uuid")}queryById(e,t,r){return this._queryByCondition(e,t,r,"id")}queryByType(e,t,r){return this._queryByCondition(e,t,r,"type")}queryByUserData(e,t,r){return this._queryByCondition(e,t,r,"userData")}queryByData(e,t,r){return this.queryByUserData(e,t,r)}queryAsync(e,t,r){return hk.asyncSelector?this._queryInWorker(e,t,r):new Promise(((n,i)=>{n(t?t.query(e,{recursive:r}):this.query(e))}))}find(e,t){var r=t||this._objects;return r.length?BI.isString(e)?"*"==e?r[0]:function(e,t){for(var r=0,n=t.length;r<n;r++){var i=t[r];if(e.evaluate(i))return i}return null}(uk(e),r):BI.isRegExp(e)?function(e,t){for(var r=0,n=t.length;r<n;r++){var i=t[r];if(e.test(i.name))return i}return null}(e,r):BI.isFunction(e)?function(e,t){for(var r=0,n=t.length;r<n;r++){var i=t[r];if(e(i))return i}return null}(e,r):null:null}push(e){return e&&(e.isSelector?this._objects=this._objects.concat(e.objects):BI.isArray(e)?this._objects=this._objects.concat(e):this._objects.push(e)),this._objects.length}add(e){var t=[];e.isSelector?t=e.objects:BI.isArray(e)?t=e:e.isBaseObject&&(t=[e]);for(var r=this._objects.slice(0),n=0;n<t.length;n++){-1===r.indexOf(t[n])&&r.push(t[n])}return this.onCreateInstance({objects:r})}remove(e){var t=function(e,t){return e?BI.isString(e)?hk.select(e,t):BI.isArray(e)?e:e.isSelector?e.objects:[e]:null}(e,this._objects);if(!t)return this.onCreateInstance({objects:this.objects});for(var r=this._objects.slice(0),n=0;n<t.length;n++){var i=r.indexOf(t[n]);-1!==i&&r._removeAt(i)}return this.onCreateInstance({objects:r})}not(e){return this.remove(e)}clear(){this._objects.length=0}forEach(e){for(var t=this._objects,r=0,n=t.length;r<n;r++)e(t[r],r,t)}forEachAsync(e){this._objects.forEachAsync(e)}forEachSync(e){this.forEachAsync(e)}traverse(e){for(var t=0,r=this._objects.length;t<r;t++)this._objects[t].traverse(e)}traverseBranch(e){for(var t=0,r=this._objects.length;t<r;t++){if(!this._objects[t].traverseBranch(e))return}}unique(){this._objects=BI.uniqueObjects(this._objects)}map(e){if(!e)return null;var t=this._objects.map(((t,r)=>e(t,r,this._objects))).filter((e=>!!e));return this.onCreateInstance({objects:t})}reduce(e,t){return void 0===t&&(t=0),e?this._objects.reduce(((t,r,n)=>e(t,r,n,this._objects)),t):0}slice(e,t){return this.onCreateInstance({objects:this._objects.slice(e,t)})}filter(e){if(!e)return null;var t=this._objects.filter(((t,r)=>e(t,r,this._objects)));return this.onCreateInstance({objects:t})}sort(e){return this._objects.sort(e),this}toArray(){return this._objects}includes(e){return this._objects.includes(e)}indexOf(e){return this._objects.indexOf(e)}splice(e,t){return this.onCreateInstance({objects:this._objects.splice(e,t)})}insert(e,t){return this._objects.splice(e,0,t),this}removeAt(e){return this._objects.splice(e,1),this}swap(e,t){return this._objects._swap(e,t),this}concat(e){if(e){var t=this._objects.concat(e.isSelector?e.objects:e);return this.onCreateInstance({objects:Array.from(new Set(t))})}return this.onCreateInstance({objects:this._objects.slice()})}reverse(){return this._objects.reverse(),this}has(e){return-1!==this._objects.indexOf(e)}equals(e){if(this.length!=e.length)return!1;for(var t=0;t<this.length;t++)if(this[t]!=e[t])return!1;return!0}get length(){return this._objects.length}set length(e){this._objects.length=e}get objects(){return this._objects}getLoadedObjects(){return this._objects.filter((e=>e.loaded))}getUnloadedObjects(){return this._objects.filter((e=>!e.loaded))}getVisibleObjects(){return this._objects.filter((e=>e.visible))}getInvisibleObjects(){return this._objects.filter((e=>!e.visible))}makeInstancedDrawing(e,t){this._objects.forEach((r=>{r.isObject3D&&r.makeInstancedDrawing(e,t)}))}getInstancedDrawingObjects(){return this._objects.filter((e=>e.isInstancedDrawing))}setVisible(e,t){void 0===t&&(t=!1),this._objects.forEach((r=>{r.setVisible(e,t)}))}set visible(e){this._objects.forEach((t=>{t.visible=e}))}set pickable(e){this._objects.forEach((t=>{t.pickable=e}))}waitForComplete(){return this._objects.waitForComplete()}waitForEachAsync(e){return this._objects.waitForEachAsync(e)}waitForEachSync(e){return this.waitForEachAsync(e)}destroy(){this._objects.slice(0).forEach((e=>{e.destroy()}))}loadResource(e){this._objects.forEach((t=>{t.loadResource(!1,e)}))}unloadResource(){this._objects.forEach((e=>{e.unloadResource()}))}on(){this.applyObjects("on",arguments)}once(){this.applyObjects("once",arguments)}off(){this.applyObjects("off",arguments)}pauseEvent(){this.applyObjects("pauseEvent",arguments)}resumeEvent(){this.applyObjects("resumeEvent",arguments)}trigger(e,t){this._objects.forEach((r=>{r.trigger(e,Object.assign({},t))}))}stopMoving(){this.applyObjects("stopMoving",arguments)}moveTo(){this.applyObjects("moveTo",arguments)}movePath(){this.applyObjects("movePath",arguments)}stopRotating(){this.applyObjects("stopRotating",arguments)}rotateTo(){this.applyObjects("rotateTo",arguments)}stopScaling(){this.applyObjects("stopScaling",arguments)}scaleTo(){this.applyObjects("scaleTo",arguments)}stopFading(){this.applyObjects("stopFading",arguments)}fadeIn(){this.applyObjects("fadeIn",arguments)}fadeOut(){this.applyObjects("fadeOut",arguments)}stopAnimation(){this.applyObjects("stopAnimation",arguments)}stopAllAnimations(){this.applyObjects("stopAllAnimations",arguments)}playAnimation(){this.applyObjects("playAnimation",arguments)}addComponent(){this.applyObjects("addComponent",arguments)}removeComponent(){this.applyObjects("removeComponent",arguments)}get style(){return sk.init(this._objects)}get inherit(){return ok.init(this._objects)}getBoundingBox(){var e=new Gu;return this._objects.forEach((t=>{var r=t.boundingBox;e.expandByPoint(r.min),e.expandByPoint(r.max)})),e}get isSelector(){return!0}}hk.asyncSelector=null;var dk=new hk;hk.init=function(e){void 0===e&&(e={});var t=e.workerUrl;t&&(hk.asyncSelector=new oO({workerUrl:t}))},hk.buildExpression=function(e,t){return new aO(e,t)},hk.testByExpression=function(e,t){return e.evaluate(t)},hk.testByRegExpName=function(e,t){return e.test(t.name)},hk.testByFunction=function(e,t){return e(t)},hk.test=function(e,t){return dk.test(e,t)},hk.select=function(e,t){return dk.select(e,t)},hk.query=function(e,t){return dk.query(e,t)},hk.queryAsync=function(e,t,r){return dk.queryAsync(e,t,r)},hk.updateObjectAttribute=function(e,t,r){hk.asyncSelector&&hk.asyncSelector.updateObjectAttribute(e,t,r)},hk.addObject=function(e){hk.asyncSelector&&hk.asyncSelector.addObject(e)},hk.removeObject=function(e){hk.asyncSelector&&hk.asyncSelector.removeObject(e)},hk.updateObjectAttribute=function(e,t,r){hk.asyncSelector&&hk.asyncSelector.updateObjectAttribute(e,t,r)};var pk=Symbol("private");class fk{constructor(){this[pk]={};var e=this[pk];e.objects=[],e.actions=new Map,e.app=BI.getCurrentApp()}processAction(e,t,r,n,i){var a=this[pk];return i=BI.parseValue(i,0),new Promise(((s,o)=>{function l(){var i=[];if(r)for(var l=t?a.objects:a.app.objectManager.objects,u=0,c=l.length;u<c;u++){var h=l[u];if(h.test(r)){var d=e.onRun({object:h,options:n});i.push(d)}}else{var p=e.onRun({options:n});i.push(p)}Promise.all(i).then(s,o)}i?BI.setTimeout(l,i):l()}))}dispose(){var e=this[pk];e.app=null,e.objects.length=0,e.actions.clear()}_execute(e){var t=this;return pB((function*(){var r=t[pk];for(var n of e){var{type:i,candidateMode:a,target:s,params:o,delay:l,waitForComplete:u}=n,c=r.actions.get(i);c&&(u?yield t.processAction(c,a,s,o,l):t.processAction(c,a,s,o,l))}}))()}register(e,t){this[pk].actions.set(e,t)}registerAction(e,t){this.register(e,t)}unregister(e){this[pk].actions.delete(e)}unregisterAction(e){this.unregister(e)}addListener(e){if(e){var t=this[pk];e.isSelector?e.forEach((e=>{t.objects.push(e)})):t.objects.push(e)}}removeListener(e){if(e){var t=this[pk];if(e.isSelector)e.forEach((e=>{var r=t.objects.indexOf(e);-1!==r&&t.objects.splice(r,1)}));else{var r=t.objects.indexOf(e);-1!==r&&t.objects.splice(r,1)}}}run(e){e&&this._execute(e.slice(0))}push(e){this.run(e)}getActionByName(e){return this[pk].actions.get(e)}}var mk="__DynamicSelector__createEventTagName",gk="__DynamicSelector__destroyEventTagName";class _k extends hk{constructor(e,t,r){void 0===r&&(r={}),super(r),this._parent=e,this._condition=t,this._callbacks={onAdd:null,onRemove:null},this._registerEvents(),this.messages=[]}run(e,t){void 0===t&&(t={}),this._processActionByMessage(e,this.objects),(t.autoMerge||!0)&&(this.messages=this.messages.filter((t=>t.type!=e.type))),this.messages.push(e)}_check(e){return e.test(this._condition)}_registerEvents(){this._parent.on(SB.Create,"*",(e=>{var t=e.object;this._check(t)&&this._onCreateObject(t)}),mk),this._parent.on(SB.BeforeDestroy,"*",(e=>{var t=e.object;this._check(t)&&this._onDestroyObject(t)}),gk)}_unregisterEvents(){this._parent.off(SB.Create,mk),this._parent.off(SB.BeforeDestroy,gk)}_onCreateObject(e){var t=this._objects;if(-1===t.indexOf(e)){t.push(e);var r=this._callbacks.onAdd;r&&r(e),this.messages.forEach((t=>{this._processActionByMessage(t,[e])}))}}_processActionByMessage(e,t){var{type:r,params:n}=e,i=BI.getCurrentApp().actionManager.getActionByName(r);i&&fk.processAction(i,t,null,n)}_onDestroyObject(e){var t=this._objects,r=t.indexOf(e);if(-1!==r){t.splice(r,1);var n=this._callbacks.onRemove;n&&n(e)}}onCreateInstance(){return new _k(this._parent,this._condition,arguments[0])}clear(){this._unregisterEvents(),super.clear()}get callbacks(){return this._callbacks}get isDynamicSelector(){return!0}}class vk{constructor(){this._object=null,this._active=!0}onAdd(e){this.triggerBeforeAddCallback(e),this._object=e,this.triggerAfterAddCallback()}triggerBeforeAddCallback(){this.onBeforeAdd&&this.onBeforeAdd()}triggerAfterAddCallback(){this.onAfterAdd&&this.onAfterAdd()}onRemove(){this.triggerBeforeRemoveCallback();var e=this._object;this._object=null,this.triggerAfterRemoveCallback(e)}triggerBeforeRemoveCallback(){this.onBeforeRemove&&this.onBeforeRemove()}triggerAfterRemoveCallback(){this.onAfterRemove&&this.onAfterRemove()}get active(){return this._active}set active(e){this._active!=e&&(this._active=e,this.onActiveChange&&this.onActiveChange(e))}get object(){return this._object}get app(){var e=this._object;return e?e.isApp?e:e.app:null}}var yk=1,xk=2,bk=4,Ak=8;class Sk extends vk{constructor(e){void 0===e&&(e={}),super(),this._flags=new Wt,this._flags.enable(xk,BI.parseValue(e.enable,!0)),this._isWaitingForUpdate=!1,this._startingPromise=null}_isEditorByObject(e){return!(!e||!e.options.isEditor)}_isEditor(e){if(e&&e.isEditor)return!0;if(this._isEditorByObject(this.object))return!0;var t=this.getPrefabRootObject();if(t&&t.options.isEditor)return!0;return BI.parseValue(this.app.options.isEditor,!1)}_initLateUpdate(){this.object&&this.onLateUpdate&&this.app.objectManager.addLateUpdateObject(this)}_processStart(e){if(!this._flags.has(bk))if(this.onStartAsync){var t=this.onStartAsync(e);t?t.then((()=>{this._isWaitingForUpdate=!1,this._initLateUpdate(),this._startingPromise&&this._startingPromise.resolve(),this._flags.enable(Ak,!0)})):(this._isWaitingForUpdate=!1,this._initLateUpdate())}else this.onStart(e),this._initLateUpdate()}onProcessStartEvent(e){this._isEditor(e)||this._flags.has(yk)||(this._flags.enable(yk,!0),this.onStartAsync?this._isWaitingForUpdate=!0:this._startingPromise&&this._startingPromise.resolve(),this.object.waitForComplete().then((()=>{BI.setTimeout((()=>{this._processStart(e)}))})))}onProcessAddEvent(e){this._isEditor(e)?this.onUpdate=null:this._flags.has(xk)?(e=e||{},this.onAwake(e),this.onProcessStartEvent(e)):this.active=!1}onProcessActiveChangeEvent(e){this._isEditor()||(e?(this.onEnable(),this.onProcessStartEvent()):this.onDisable())}onAdd(e,t){super.onAdd(e);var r=this.getPrefabRootObject();r&&(t=BI.mergeObject(Object.assign({},r.options),t)),this.onProcessAddEvent(t)}triggerBeforeAddCallback(e){this._isEditorByObject(e)||super.triggerBeforeAddCallback()}triggerAfterAddCallback(){this._isEditor()||super.triggerAfterAddCallback()}onRemove(){this._flags.enable(bk,!0),this.onDestroy(),super.onRemove()}triggerBeforeRemoveCallback(){this._isEditor()||super.triggerBeforeRemoveCallback()}triggerAfterRemoveCallback(e){this._isEditorByObject(e)||super.triggerAfterRemoveCallback()}onAwake(e){}onStart(e){}onDestroy(){}onEnable(){}onDisable(){}onActiveChange(e){this.onProcessActiveChangeEvent(e)}getPrefabRootObject(){var e=this.object;return e.isPrefabObject?e:e.getParentByType("PrefabObject")}resolveUrlFromRoot(e){var t=this.getPrefabRootObject();return t?t.resource.url._appendPath(e):e}get isWaitingForUpdate(){return this._isWaitingForUpdate}get camera(){return this.app.camera}get root(){return this.app.root}set enable(e){this.active=e}get enable(){return this.active}get startingPromise(){if(!this._startingPromise)if(this._flags.has(Ak))this._startingPromise=Promise.resolve();else if(this.onStartAsync)this._startingPromise=new Rt;else{if(this._flags.has(yk))return Promise.resolve();this._startingPromise=new Rt}return this._startingPromise}get isComponent(){return!0}}Sk.isInstancedComponent=!0;var Ek=Symbol("private"),wk={};class Ck{constructor(){this[Ek]={};var e=this[Ek];e.components=new Map,e.componentsAccessorInfo={},e.tickableComponents=null,e.renderableComponents=null,e.resizableComponents=null,e.refreshableComponents=null,e.loadableComponents=null,e.unloadableComponents=null,e.visibleComponents=null,e.parentChangeComponents=null}_linkProperties(e,t){var r=e.exportProperties;r&&r.forEach((e=>{Object.defineProperty(this,e,{enumerable:!1,configurable:!0,set(r){this[t][e]=r},get(){return this[t][e]}})}))}_linkFunctions(e,t){var r=e.exportFunctions;r&&r.forEach((e=>{this[e]=function(){var r=this[t];return r[e].apply(r,arguments)}}))}_linkComponent(e,t,r){void 0===r&&(r=wk),BI.parseValue(r.autoRegister,!0)&&(this._linkProperties(e,t),this._linkFunctions(e,t))}_unlinkComponent(e){var t=e.exportProperties;t&&t.forEach((e=>{delete this[e]}));var r=e.exportFunctions;r&&r.forEach((e=>{delete this[e]}))}_setComponent(e,t,r){if(!e)return null;var n=this[Ek];if(n.components.set(t,e),this.onAddComponent(e,r),e.onUpdate&&(n.tickableComponents=n.tickableComponents||[],n.tickableComponents.push(e)),e.onRender&&(n.renderableComponents=n.renderableComponents||[],n.renderableComponents.push(e)),e.onResize){n.resizableComponents=n.resizableComponents||[],n.resizableComponents.push(e);var i=this.object;i&&(i.isApp?e.onResize(i.size[0],i.size[1]):e.onResize(i.app.size[0],i.app.size[1]))}return e.onRefresh&&(n.refreshableComponents=n.refreshableComponents||[],n.refreshableComponents.push(e)),e.onLoadResource&&(n.loadableComponents=n.loadableComponents||[],n.loadableComponents.push(e)),e.onUnloadResource&&(n.unloadableComponents=n.unloadableComponents||[],n.unloadableComponents.push(e)),e.onVisibleChange&&(n.visibleComponents=n.visibleComponents||[],n.visibleComponents.push(e)),e.onParentChange&&(n.parentChangeComponents=n.parentChangeComponents||[],n.parentChangeComponents.push(e)),e}_getComponentFromAccessor(e,t,r){var n=this[Ek],i=n.components.get(t);i||(i=r?new e(r):new e,this._setComponent(i,t,r)),delete this[t],this[t]=i;var a=n.componentsAccessorInfo[t];return a.hasInstance=!0,a.classType=e,i}_createAccessor(e,t,r){return{enumerable:!1,configurable:!0,get:()=>this._getComponentFromAccessor(e,t,r)}}_linkAccessor(e,t,r){var n=this[Ek],i=this._createAccessor(e,t,r),a={classType:e,accessor:i};r&&!r.isTemporary&&(a.args=Object.assign({},r),a.isResident=BI.parseValue(r.isResident,!1)),n.componentsAccessorInfo[t]=a,Object.defineProperty(this,t,i)}_unlinkAccessor(e){var t=this[Ek];delete this[e],delete t.componentsAccessorInfo[e]}_removeComponent(e,t){void 0===t&&(t=!0);var r=this[Ek],n=r.components.get(e);return!!n&&(this.onRemoveComponent(n),r.components.delete(e),BI.removeFromArray(r.tickableComponents,n),BI.removeFromArray(r.renderableComponents,n),BI.removeFromArray(r.resizableComponents,n),BI.removeFromArray(r.refreshableComponents,n),BI.removeFromArray(r.loadableComponents,n),BI.removeFromArray(r.unloadableComponents,n),BI.removeFromArray(r.visibleComponents,n),BI.removeFromArray(r.parentChangeComponents,n),t&&this._unlinkAccessor(e),!0)}_registerComponent(e,t,r){return this.hasComponent(t)&&this.removeComponent(t),this._linkAccessor(e,t,r),this._linkComponent(e,t,r),!(e.isInstancedComponent&&!this._getComponentFromAccessor(e,t,r))}_unregisterComponent(e,t){this._removeComponent(t)?e.hasInstance&&this._unlinkComponent(e.classType):this._unlinkAccessor(t)}onAddComponent(e,t){e.onAdd(this,t)}onRemoveComponent(e){e.onRemove()}hasRegisteredComponent(e){return!!this[Ek].componentsAccessorInfo[e]}getAccessorInfo(){return this[Ek].componentsAccessorInfo}clearAccessorInfo(){this[Ek].componentsAccessorInfo={}}addComponent(e,t,r){return!!e&&(BI.isObject(e)?(t&&this._removeComponent(t,!1),t=t||zu.generateUUID(),this._setComponent(e,t,r),this._linkAccessor(e.constructor,t,r),this._linkComponent(e.constructor,t,r)):(t=t||zu.generateUUID(),this._registerComponent(e,t,r)),!0)}removeComponent(e){var t=this[Ek].componentsAccessorInfo[e];this._removeComponent(e),t&&this._linkAccessor(t.classType,e,t.args),this._unregisterComponent(t,e)}removeAllComponents(e){void 0===e&&(e=!1);var t=this[Ek],r=[...t.components.keys()];r.sort(((e,n)=>{var i=t.componentsAccessorInfo[e],a=t.componentsAccessorInfo[n];return i.isResident&&!a.isResident?1:a.isResident&&!i.isResident?-1:r.indexOf(e)-r.indexOf(n)})),r.forEach((r=>{var n=t.componentsAccessorInfo[r];!e&&n.isResident||this.removeComponent(r)}))}traverseComponentByType(e,t){var r=this[Ek].componentsAccessorInfo;for(var n in r){var i=this[n];i&&(i instanceof e&&t(this[n],n))}}getComponentByName(e){var t=this[Ek],r=t.components.get(e);if(r)return r;var n=t.componentsAccessorInfo[e];return n?n.accessor.get():null}getComponentByType(e){var t=this[Ek].componentsAccessorInfo;for(var r in t){var n=this[r];if(n&&n instanceof e)return n}return null}getComponentsByType(e){var t=[];return this.traverseComponentByType(e,(e=>{t.push(e)})),t}getAllComponents(){var e=[],t=this[Ek].componentsAccessorInfo;for(var r in t){var n=this.getComponentByName(r);n&&e.push(n)}return e}hasComponent(e){return this[Ek].components.has(e)}hasComponentInstance(e){var t=this[Ek].componentsAccessorInfo[e];return!!t&&t.hasInstance}isResidentComponent(e){var t=this[Ek].componentsAccessorInfo[e];return!!t&&!!t.isResident}onImportComponents(e,t){void 0===t&&(t={});var r=t.onGetObjectClassType,n=t.onGetComponentExternalData,i=t.onError;e.forEach((e=>{var a=e.name,s=r(e);if(s){this.addComponent(s,a,t.args);var o=e.external;if(o){if(n&&!(o=n(this,a,o)))return;var l=this[a];l.onImport&&l.onImport(o)}}else i&&i("Load components failed, due to '"+e.type+"' is unkonwn")}))}onExportComponents(e){void 0===e&&(e={});var t=e.onGetComponentType,r=[];return this.components.forEach(((e,n)=>{if(e.onExport){var i,a=e.onExport();if(a)i=t?t(e.constructor.name):e.constructor.name,r.push({name:n,type:i,external:a})}})),r}onImportExternalComponents(e){return Promise.resolve()}onExportExternalComponents(){}get tickableComponents(){return this[Ek].tickableComponents}get renderableComponents(){return this[Ek].renderableComponents}get resizableComponents(){return this[Ek].resizableComponents}get refreshableComponents(){return this[Ek].refreshableComponents}get loadableComponents(){return this[Ek].loadableComponents}get unloadableComponents(){return this[Ek].unloadableComponents}get visibleComponents(){return this[Ek].visibleComponents}get parentChangeComponents(){return this[Ek].parentChangeComponents}get components(){return this[Ek].components}get isComponentGroup(){return!0}}var Tk=Symbol("private");class Dk{constructor(){this[Tk]={};var e=this[Tk];e.app=BI.getCurrentApp(),e.color=[1,1,1],e.points=[],e.colors=[];var t=BI.createObject("LineSegments");t.setAttribute("Pickable",!1),t.getUserData().isDebugNode=!0,e.lines=t,e.app.objectManager.addLateUpdateObject(this)}onDispose(){}onLateUpdate(e){}dispose(){this.onDispose();var e=this[Tk];e.lines.dispose(),e.lines=null,e.app.objectManager.removeLateUpdateObject(this)}begin(){var e=this[Tk];e.points.length=0,e.colors.length=0}end(){}buildHelper(e){}_insertLine(e,t){var r=this[Tk];r.points.push(e),r.colors.push(r.color),r.points.push(t),r.colors.push(r.color)}setVisible(e){this.visible=e}getVisible(){return this.visible}get lines(){return this[Tk].lines}get visible(){return this[Tk].lines.getVisible()}set visible(e){this[Tk].lines.setVisible(e)}get color(){return this[Tk].color}set color(e){this[Tk].color=BI.parseColor(e)}get private(){return this[Tk]}}class Mk extends Dk{onGetTopPoints(e){return{lt:e[0],rt:e[1],rb:e[2],lb:e[3]}}onGetBottomPoints(e){return{lt:e[4],rt:e[5],rb:e[6],lb:e[7]}}buildBox(e){var t=this.onGetTopPoints(e),r=this.onGetBottomPoints(e);this._insertLine(t.lt,t.rt),this._insertLine(t.rt,t.rb),this._insertLine(t.rb,t.lb),this._insertLine(t.lb,t.lt),this._insertLine(r.lt,r.rt),this._insertLine(r.rt,r.rb),this._insertLine(r.rb,r.lb),this._insertLine(r.lb,r.lt),this._insertLine(t.lt,r.lt),this._insertLine(t.rt,r.rt),this._insertLine(t.rb,r.rb),this._insertLine(t.lb,r.lb)}end(){var e=this.private,t=e.lines;t.setSize(e.points.length);var r=QI.getCenterFromPoints(e.points);t.setPosition(r);var n=e.points.map((e=>QI.subVector(e,r)));t.setPoints(n),t.setColors(e.colors)}}var Pk=Symbol("private");class Fk extends Mk{constructor(e){void 0===e&&(e={}),super(e),this[Pk]={};var t=this[Pk];t.object=e.object,t.mode=BI.parseValue(e.mode,QB.All)}_traverseInBodiesMode(e){var t;switch(e.bounding.inheritType){case qB.Normal:t=this.onGetObjectBox(e,!1),this.buildBox(t.getPoints());break;case qB.Break:return t=this.onGetObjectBox(e,!1),void this.buildBox(t.getPoints());case qB.Stop:return}for(var r=e.children,n=0;n<r.length;n++){var i=r[n];this._traverseInBodiesMode(i)}}onLateUpdate(e){var t,r=this[Pk],n=r.object;switch(r.mode){case QB.All:t=this.onGetObjectBox(n,!0),this.begin(),this.buildBox(t.getPoints()),this.end();break;case QB.Root:t=this.onGetObjectBox(n,!1),this.begin(),this.buildBox(t.getPoints()),this.end();break;case QB.Bodies:this.begin(),this._traverseInBodiesMode(n),this.end()}super.onLateUpdate(e)}onGetObjectBox(e,t){return e.getAABB(t)}get object(){return this[Pk].object}get mode(){return this[Pk].mode}set mode(e){this[Pk].mode=e}}class Rk extends Fk{constructor(e){super(e)}onGetObjectBox(e,t){return e.getOBB(t)}}var Nk=Symbol("private");class Bk extends vk{constructor(){super(),this[Nk]={};var e=this[Nk];e.helpers={axes:null,boundingBox:null,orientedBox:null},e.axesLength=0,e.boundingBox=null,e.orientedBox=null}_enableLineHelper(e,t,r,n){var i=this[Nk];if(t){if(i.helpers[e])return;var a=this.object;a.waitForComplete().then((()=>{var t=BI.createObject("LineSegments");t.setAttribute("Pickable",!1),t.getUserData().isDebugNode=!0,a.body.createRootNode(),a.node.add(t);var s=r(),o=n();t.setSize(3*s.length),t.setPoints(s),t.setColors(o),i.helpers[e]=t}))}else{if(!i.helpers[e])return;i.helpers[e].dispose(),i.helpers[e]=null}}_enableBoxHelper(e,t,r,n){var i=this[Nk];if(r)i.helpers[t]||(i.helpers[t]=new e({object:this.object}),this.app.scene.rootObjects.debug.node.add(i.helpers[t].lines)),n(i.helpers[t]);else{if(!i.helpers[t])return;i.helpers[t].dispose(),i.helpers[t]=null}}_refreshBoxHelper(e,t,r,n,i){this._enableBoxHelper(e,t,r,(e=>{e.mode=n,e.color=i}))}_createBoxHelper(e,t){var r=this,n=!1,i=QB.All,a=[1,1,1],s={};return Object.defineProperties(s,{visible:{get:function(){return n},set:function(s){n=s,r._refreshBoxHelper(e,t,n,i,a)}},mode:{get:function(){return i},set:function(s){i=s,r._refreshBoxHelper(e,t,n,i,a)}},color:{get:function(){return a},set:function(s){a=BI.parseColor(s,[1,1,1]),r._refreshBoxHelper(e,t,n,i,a)}}}),s}_show(e){var t=this[Nk].helpers;for(var r in t)t[r]&&t[r].setVisible(e)}onRemove(){var e=this[Nk].helpers;for(var t in e)e[t]&&(e[t].dispose(),e[t]=null);super.onRemove()}onVisibleChange(e){this._show(e)}get boundingBox(){var e=this[Nk];return e.boundingBox||(e.boundingBox=this._createBoxHelper(Fk,"boundingBox")),e.boundingBox}get orientedBox(){var e=this[Nk];return e.orientedBox||(e.orientedBox=this._createBoxHelper(Rk,"orientedBox")),e.orientedBox}get axes(){return!!this[Nk].helpers.axes}set axes(e){var t=this[Nk];this._enableLineHelper("axes",e,(()=>{var e=t.axesLength;return e||(e=this.object.boundingBox.halfSize.reduce(((e,t)=>e+t),0)),e=Math.max(e,10),t.axesLength=e,[[0,0,0],[e,0,0],[0,0,0],[0,e,0],[0,0,0],[0,0,e]]}),(()=>[[1,0,0],[1,.6,0],[0,1,0],[.6,1,0],[0,0,1],[0,.6,1]]))}get axesLength(){return this[Nk].axesLength}set axesLength(e){var t=this[Nk];t.axesLength=e;var r=t.helpers.axes;r&&r.setPoints([[0,0,0],[e,0,0],[0,0,0],[0,e,0],[0,0,0],[0,0,e]])}get lights(){return this.object.query(".Light").map((e=>{var t={type:e.type,id:e.id,name:e.name,uuid:e.uuid};return["color","intensity","angles","components"].forEach((r=>{BI.bindObjectProperty(t,e,r)})),e.isBaseShadowLight&&["castShadow","shadowQuality","shadowBias","shadowRadius","shadowRange"].forEach((r=>{BI.bindObjectProperty(t,e,r)})),e.isSpotLight?["distance","angle","penumbra","decay"].forEach((r=>{BI.bindObjectProperty(t,e,r)})):e.isHemisphereLight&&["groundColor"].forEach((r=>{BI.bindObjectProperty(t,e,r)})),t})).toArray()}}Bk.mustCopyWithInstance=!0;var Ik=Symbol("private"),Ok={center:QI.createVec3(),halfSize:QI.createVec3(),rotation:QI.createQuat()},kk={center:QI.createVec3(),halfSize:QI.createVec3(),rotation:QI.createQuat()},Lk=new Gu,Uk=new Yu,zk=[0,0,0];function jk(e){var t=e.getUserData();if(t[AB.BoundingBoxInheritType]==qB.Stop)return!1;var r=e.getParent(),n=r?r.getUserData():null;return(!n||n[AB.BoundingBoxInheritType]!=qB.Break||"continue"==t[AB.BoundingBoxInheritType])&&(!t.isDebugNode&&!1!==t.active)}class Vk extends vk{constructor(){super(),this[Ik]={};var e=this[Ik];e.inheritType=qB.Normal,e.localBoundingBoxResult=null,e.lightSphereModeType=aI.Dynamic,e.lightCenterInSelfSpace=null,e.lightSphere=null}_getNode(e){var t=this.object;return e?t.node:t.bodyNode}_getLightSphere(){var e=this[Ik];return e.lightSphere=e.lightSphere||{center:[0,0,0],radius:0,shadowRadius:0}}getAABB(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===r&&(r=!1);var n=this._getNode(e);if(n.getAABB){var i=n.getAABB(Ok,jk,t,r);return QI.exactEqualsVector3(i.halfSize,zk)?new Gu(this.object.position,[Number.EPSILON,Number.EPSILON,Number.EPSILON]):new Gu(i.center,QI.fixScaleFactor(i.halfSize))}return Lk}getOBB(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===r&&(r=!1);var n=this._getNode(e);if(n.getOBB){var i=n.getOBB(kk,jk,t,r);return QI.exactEqualsVector3(i.halfSize,zk)?new Yu(this.object.position,[Number.EPSILON,Number.EPSILON,Number.EPSILON],i.rotation):new Yu(i.center,QI.fixScaleFactor(i.halfSize),i.rotation)}return Uk}getInitialLocalBoundingBox(){return this[Ik].localBoundingBoxResult}setInitialLocalBoundingBox(e){var t=this[Ik],r=this.object.bodyNode;e?(t.localBoundingBoxResult={center:e.center,halfSize:e.halfSize},r.isRenderableNode&&r.setLocalBoundingBox(t.localBoundingBoxResult)):t.localBoundingBoxResult&&(t.localBoundingBoxResult=null,r.isRenderableNode&&r.clearLocalBoundingBox())}getLightSphere(e){void 0===e&&(e=!0);var t=this[Ik],r=this._getLightSphere();switch(t.lightSphereModeType){case aI.Dynamic:var n=this.getAABB(!0,e);r.center=n.center,r.radius=n.radius;break;case aI.Static:r.center=this.object.selfToWorld(t.lightCenterInSelfSpace)}return r}get lightSphereModeType(){return this[Ik].lightSphereModeType}set lightSphereModeType(e){var t=this[Ik];if(e===aI.Static){var r=this._getLightSphere(),n=this.getAABB(!0);t.lightCenterInSelfSpace=this.object.worldToSelf(n.center),r.radius=n.radius}t.lightSphereModeType=e}get boundingBox(){return this.getAABB()}get orientedBox(){return this.getOBB()}get initialLocalBoundingBox(){return this.getInitialLocalBoundingBox()}set initialLocalBoundingBox(e){this.setInitialLocalBoundingBox(e)}get inheritType(){return this[Ik].inheritType}set inheritType(e){var t=this[Ik],r=this.object;e==qB.Normal?(r.node.getUserData()[AB.BoundingBoxInheritType]=qB.Normal,r.bodyNode.getUserData()[AB.BoundingBoxInheritType]=qB.Normal):e==qB.Break?(r.node.getUserData()[AB.BoundingBoxInheritType]=qB.Break,r.bodyNode.getUserData()[AB.BoundingBoxInheritType]="continue"):e==qB.Jump?(r.node.getUserData()[AB.BoundingBoxInheritType]=qB.Normal,r.bodyNode.getUserData()[AB.BoundingBoxInheritType]=qB.Stop):e==qB.Stop&&(r.node.getUserData()[AB.BoundingBoxInheritType]=qB.Stop,r.bodyNode.getUserData()[AB.BoundingBoxInheritType]=qB.Stop),t.inheritType=e}get inheritActionType(){return BI.warn("Please use '.inheritType' attribute, '.inheritActionType' has been deprecated"),this.inheritType}set inheritActionType(e){BI.warn("Please use '.inheritType' attribute, '.inheritActionType' has been deprecated"),this.inheritType=e}get pickedSize(){var e=this.object.node.getPickBoundingBox();return e?QI.scaleVector(e.halfSize,2):null}set pickedSize(e){if(e){var t=this.getAABB().center;this.object.node.setPickBoundingBox({center:t,halfSize:QI.scaleVector(e,.5)})}else this.object.node.clearPickBoundingBox()}}Vk.mustCopyWithInstance=!0;var Gk=Symbol("private"),Wk=[];class Hk extends vk{constructor(){super(),this[Gk]={};var e=this[Gk];e.commandExecutor=null,e.animations=new Map,e.animationPlayer=null}_initEvents(){var e=this[Gk],t=e.animationPlayer;t&&(t.addEventListener("finished",(t=>{var r=t.name,n=e.animations.get(r);n&&(n.state=WB.Finished,n.onComplete&&n.onComplete(t))})),t.addEventListener("loop",(e=>{})))}_collectAnimiations(){var e=this[Gk],t=e.animationPlayer;t&&(Wk.length=0,t.getNames(Wk),Wk.forEach((r=>{var n=t.getAttribute(r,"Duration");e.animations.set(r,{name:r,state:WB.Ready,duration:n,directionType:HB.Normal,speed:1})})))}_playAnimation(e){this._init();var t=this[Gk],r=e.name,n=e.loopType,i=e.times,a=e.reverse,s=BI.parseValue(e.speed,1),o=e.frames||null,l=BI.parseValue(e.onComplete,e.complete),u=t.animations.get(r);if(u){this.stopAnimation(r),u.state=WB.Playing,u.speed=s,u.onComplete=l,a&&(s*=-1);var c=t.animationPlayer;c.setAttribute(r,"TimeScale",s),i||(i=n==wB.Repeat||n==wB.PingPong?1/0:1),n||(n=wB.Repeat);var h={loopType:n,loopTimes:i},d=0,p=1;if(o){if(BI.isArray(o))d=o[0],p=o.length>1?o[1]:1;else{if(!BI.isNumber(o))return void BI.error("The animation frames '"+o+"' is invalid when play '"+r+"' animation");d=o}h.framesRange=[d,p]}c.play(r,h);var f=this.object;f.body.style.bindAnimationEvents(f),f.trigger(SB.PlayAnimation,{name:r})}}_pauseAnimation(e,t){var r=this[Gk],n=r.animations.get(e);if(n){var i=r.animationPlayer;t?(n.state=WB.Paused,i.pause(e)):(n.state=WB.Playing,i.resume(e))}}_stopAnimation(e){var t=this[Gk],r=t.animations.get(e);if(r){var n=r.state;n!=WB.Ready&&n!=WB.Stopped&&(r.state=WB.Stopped,r.onComplete=null,t.animationPlayer.stop(e),this.object.trigger(SB.StopAnimation,{name:e}))}}_checkAnimationState(e,t){var r=this[Gk];if(!r.animationPlayer)return!1;if(e){if(r.animationPlayer.getState(e)==t)return!0}else for(var[n,i]of r.animations)if(i.state==t)return!0;return!1}_addDelayedCommand(e,t){var r=this[Gk];r.commandExecutor=r.commandExecutor||new Sr,r.commandExecutor.addCommand(e,t)}_init(){var e=this[Gk];e.animationPlayer||(e.animationPlayer=this.object.bodyNode.getAttribute("AnimationPlayer"),this._initEvents(),this._collectAnimiations())}onRemove(){var e=this[Gk];e.animationPlayer&&(e.animationPlayer.dispose(),e.animationPlayer=null),super.onRemove()}onUnloadResource(){var e=this[Gk];this.stopAllAnimations(),e.animationPlayer&&(e.animationPlayer.dispose(),e.animationPlayer=null),e.animations.clear()}hasInited(){return!!this[Gk].animationPlayer}hasAnimation(e){return-1!==this.animationNames.indexOf(e)}pauseAnimation(e){this.object.loaded?BI.isArray(e)?e.forEach((e=>{this._pauseAnimation(e,!0)})):BI.isString(e)&&this._pauseAnimation(e,!0):this._addDelayedCommand("pauseAnimation",arguments)}pauseAllAnimations(){this[Gk].animations.forEach((e=>{e.state!=WB.Paused&&this._pauseAnimation(e.name,!0)}))}resumeAnimation(e){this.object.loaded?BI.isArray(e)?e.forEach((e=>{this._pauseAnimation(e,!1)})):BI.isString(e)&&this._pauseAnimation(e,!1):this._addDelayedCommand("resumeAnimation",arguments)}resumeAllAnimations(){this[Gk].animations.forEach((e=>{e.state==WB.Paused&&this._pauseAnimation(e.name,!1)}))}stopAnimation(e){this.object.loaded?BI.isArray(e)?e.forEach((e=>{this._stopAnimation(e)})):BI.isString(e)&&this._stopAnimation(e):this._addDelayedCommand("stopAnimation",arguments)}stopAllAnimations(){this[Gk].animations.forEach((e=>{this._stopAnimation(e.name)}))}playAnimation(e){void 0===e&&(e={}),this.object.loaded?(this.stopAllAnimations(),BI.isString(e)&&(e={name:e}),this._playAnimation(e)):this._addDelayedCommand("playAnimation",arguments)}playAnimationAsync(e){return void 0===e&&(e={}),new Promise(((t,r)=>{var n=BI.parseValue(e.onComplete,e.complete);e.onComplete=function(e){n&&n(e),t()},this.playAnimation(e)}))}blendAnimation(e){void 0===e&&(e={}),this.object.loaded?(BI.isString(e)&&(e={name:e}),this._playAnimation(e)):this._addDelayedCommand("blendAnimation",arguments)}blendAnimationAsync(e){return void 0===e&&(e={}),new Promise(((t,r)=>{var n=BI.parseValue(e.onComplete,e.complete);e.onComplete=function(e){n&&n(e),t()},this.blendAnimation(e)}))}isAnimationPlaying(e){return this._checkAnimationState(e,WB.Playing)}isAllAnimationsReady(){var e=this[Gk];if(e.animationPlayer)for(var[t,r]of e.animations)if(r.state!=WB.Ready&&r.state!=WB.Stopped)return!1;return!0}getAnimation(e){return this._init(),this[Gk].animations.get(e)}getAnimationState(e){this._init();var t=this[Gk].animations.get(e);return t?t.state:WB.Stopped}getPlayingAnimations(){this._init();var e=this[Gk],t=[];return e.animations.forEach((e=>{e.state==WB.Playing&&t.push(e)})),t}getAnimationDirectionType(e){this._init();var t=this[Gk].animations.get(e);return t?t.directionType:HB.Normal}setAnimationDirectionType(e,t){if(this.object.loaded){this._init();var r=this[Gk],n=r.animations.get(e);if(!n)return!1;n.directionType=t;var i=n.speed;t==HB.Reverse&&(i*=-1),r.animationPlayer.setAttribute(e,"TimeScale",i)}else this._addDelayedCommand("setAnimationDirectionType",arguments);return!0}getAnimationSpeed(e){this._init();var t=this[Gk].animations.get(e);return t?t.speed:0}setAnimationSpeed(e,t){if(this.object.loaded){this._init();var r=this[Gk],n=r.animations.get(e);if(!n)return!1;n.speed=t,r.animationPlayer.setAttribute(e,"TimeScale",t)}else this._addDelayedCommand("setAnimationDirectionType",arguments);return!0}runDelayedCommands(){var e=this[Gk];e.commandExecutor&&(e.commandExecutor.runCommands(this),e.commandExecutor=null)}get animationPlayer(){return this._init(),this[Gk].animationPlayer}get animations(){return this._init(),[...this[Gk].animations.values()]}get animationNames(){return this._init(),[...this[Gk].animations.keys()]}}Hk.cDummyAnimationInterface={animations:[],animationNames:[],playAnimation:function(){return!1},playAnimationAsync:function(){return Promise.resolve()},blendAnimation:function(){return!1},blendAnimationAsync:function(){return Promise.resolve()},pauseAnimation:function(){return!1},pauseAllAnimations:function(){return!1},resumeAnimation:function(){return!1},resumeAllAnimations:function(){return!1},stopAnimation:function(){return!1},stopAllAnimations:function(){return!1},isAnimationPlaying:function(){return!1},getAnimation:function(){return null},getAnimationState:function(){return"Stopped"},getPlayingAnimations:function(){return[]},getAnimationDirectionType:function(){return"Normal"},setAnimationDirectionType:function(){return!1},getAnimationSpeed:function(){return 1},setAnimationSpeed:function(){return!1}},Hk.exportProperties=["animations","animationNames"],Hk.exportFunctions=["playAnimation","playAnimationAsync","blendAnimation","blendAnimationAsync","hasAnimation","isAnimationPlaying","pauseAnimation","pauseAllAnimations","resumeAnimation","resumeAllAnimations","stopAnimation","stopAllAnimations","getAnimation","getAnimationState","getPlayingAnimations","getAnimationDirectionType","setAnimationDirectionType","getAnimationSpeed","setAnimationSpeed"];var qk=Symbol("private"),Xk="__cLookAtTargetEventTag__",Qk="__cKeepSizeEventTag__",Kk={},Yk=QI.createVec3(),Zk=QI.createVec3(),Jk=QI.createMat4(),$k=QI.createQuat(),eL=QI.createMat4(),tL=[1,0,0],rL=[0,1,0],nL=[0,0,1];function iL(e,t){return Math.atan2(-t,-e)+Math.PI/2}class aL extends vk{constructor(){super(),this[qk]={};var e=this[qk];e.lookAtTargetInfo=null,e.keepSizeInfo=null,e.keepSizeDistance=null,e.onChange=null}_lookAtPosition(e,t){var r=this[qk].lookAtTargetInfo;this.object.node.lookAt(e,t),this.onLookAt(e,t);var n=r.update;n&&n()}_lookAtTarget(){var e=this[qk].lookAtTargetInfo,t=e.target,r=this.object,n=r.node,i=e.lockAxis;if(i){var a;if(a=e.lookOnPlane?QI.getPositionOnPlane(r.position,t.position,t.forward):t.position,a=r.worldToLocal(a),n.getPosition(Zk),i==FB.X){var s=iL(a[1]-Zk[1],a[2]-Zk[2]);QI.getQuatFromAxisRadian(tL,-s,$k),n.setQuaternion($k)}else if(i==FB.Y){var o=iL(a[0]-Zk[0],a[2]-Zk[2]);QI.getQuatFromAxisRadian(rL,-o,$k),n.setQuaternion($k)}else if(i==FB.Z){var l=iL(a[0]-Zk[0],a[1]-Zk[1]);QI.getQuatFromAxisRadian(nL,-l,$k),n.setQuaternion($k)}}else{var u=t.position;this._lookAtPosition(u,e.up)}var c=e.update;c&&c()}_updateKeepSize(){var e=this[qk],t=this.object,r=e.keepSizeInfo,n=t.position;QI.vec3.transformMat4(Zk,n,r.camera.inversedMatrixWorld);var i=Math.abs(Zk[2]);if(i){var a=r.scaleFactor;t.localScale=[i/a[0],i/a[1],i/a[2]]}}_getDistanceToCameraInKeepSizeMode(e){var t=this[qk].keepSizeDistance;return t||QI.getDistance(this.object.position,e.position)}onRemove(){var e=this[qk];e.lookAtTargetInfo=null,e.keepSizeInfo=null,e.onChange=null,super.onRemove()}onNotifyChange(){var e=this[qk];e.onChange&&e.onChange()}onLookAt(e,t){}localToSelf(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=[]);var n=this.localToWorld(e,t,r);return this.worldToSelf(n,t,r)}selfToLocal(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=[]);var n=this.selfToWorld(e,t,r);return this.worldToLocal(n,t,r)}worldToSelf(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=[]),this.object.node.worldToSelf(r,e,t)}selfToWorld(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=[]),this.object.node.selfToWorld(r,e,t)}localToWorld(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=[]);var n=this.object.parent;return n?n.selfToWorld(e,t,r):e}worldToLocal(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=[]);var n=this.object.parent;return n?n.worldToSelf(e,t,r):e}getLocalPosition(e){return void 0===e&&(e=[0,0,0]),this.object.node.getPosition(e)}setLocalPosition(e){this.object.node.setPosition(e),this.onNotifyChange()}getLocalAngles(){var e=[];return this.object.node.getEuler(e),[e[0],e[1],e[2]]}setLocalAngles(e){this.object.node.setEuler(e),this.onNotifyChange()}getLocalQuaternion(e){return void 0===e&&(e=[0,0,0,1]),this.object.node.getQuaternion(e)}setLocalQuaternion(e){this.object.node.setQuaternion(e),this.onNotifyChange()}getLocalScale(e){return void 0===e&&(e=[0,0,0]),this.object.node.getScale(e)}setLocalScale(e){this.object.node.setScale(e),this.onNotifyChange()}getMatrix(){return this.object.node.getMatrix(Jk)}setMatrix(e){this.object.node.setMatrix(e),this.onNotifyChange()}getWorldPosition(e){return void 0===e&&(e=[0,0,0]),this.object.node.getWorldPosition(e)}setWorldPosition(e){this.object.node.setWorldPosition(e),this.onNotifyChange()}getWorldAngles(){var e=[];return this.object.node.getWorldEuler(e),[e[0],e[1],e[2]]}setWorldAngles(e){this.object.node.setWorldEuler(e),this.onNotifyChange()}getWorldQuaternion(e){return void 0===e&&(e=[0,0,0,1]),this.object.node.getWorldQuaternion(e)}setWorldQuaternion(e){this.object.node.setWorldQuaternion(e),this.onNotifyChange()}getWorldScale(e){return void 0===e&&(e=[0,0,0]),this.object.node.getWorldScale(e)}setWorldScale(e){this.object.node.setWorldScale(e),this.onNotifyChange()}getMatrixWorld(e,t){return void 0===e&&(e=[]),void 0===t&&(t=!1),this.object.node.getMatrixWorld(e,t)}setMatrixWorld(e,t){void 0===t&&(t=!0),this.object.node.setMatrixWorld(e,t),this.onNotifyChange()}updateWorldMatrix(e,t){this.object.node.updateWorldMatrix(e,t)}updateMatrixWorld(){this.object.node.updateMatrixWorld()}translateOnAxis(e,t){QI.vec3.transformQuat(Yk,e,this.getLocalQuaternion()),QI.vec3.scale(Yk,Yk,t);var r=this.getLocalPosition();this.setLocalPosition(QI.addVector(r,Yk))}translateX(e){this.translateOnAxis(BI.xAxis,e)}translateY(e){this.translateOnAxis(BI.yAxis,e)}translateZ(e){this.translateOnAxis(BI.zAxis,e)}translate(e){this.translateX(e[0]),this.translateY(e[1]),this.translateZ(e[2])}rotateOnAxis(e,t){QI.quat.setAxisAngle($k,e,QI.degToRad(t));var r=this.getLocalQuaternion();QI.quat.multiply(r,r,$k),this.setLocalQuaternion(r)}rotateX(e){this.rotateOnAxis(BI.xAxis,e)}rotateY(e){this.rotateOnAxis(BI.yAxis,e)}rotateZ(e){this.rotateOnAxis(BI.zAxis,e)}getUpDirection(){return this.object.node.getMatrixWorld(Jk),QI.normalizeVector([Jk[4],Jk[5],Jk[6]])}getForward(e){return void 0===e&&(e=[0,0,0]),this.object.node.getForward(e)}getCross(){var e=this.getUpDirection(),t=this.getForward(),r=[0,0,0];return QI.vec3.cross(r,e,t),QI.vec3.normalize(r,r),r}getDirectionToTarget(e){if(!e)return null;var t=[0,0,0];return QI.vec3.sub(t,e,this.object.position),QI.vec3.normalize(t,t),t}getSelfQuaternionFromTarget(e){var t=this.worldToSelf(e);if(QI.exactEqualsVector3([0,0,0],t))return[0,0,0,1];var r=QI.lookAt(t,[0,0,0],[0,1,0]);return QI.mat4.multiply(Jk,this.matrix,r),QI.getQuatFromMat4(Jk)}getSelfAnglesFromTarget(e){return QI.getAnglesFromQuat(this.getSelfQuaternionFromTarget(e))}getWorldQuaternionFromTarget(e){if(!e||!BI.isArray(e))return[0,0,0,1];var t=this.object,r=t.position;return QI.equalsVector3(e,r)?t.quaternion:QI.getQuatFromTarget(r,e,[0,1,0])}getWorldAnglesFromTarget(e){return QI.getAnglesFromQuat(this.getWorldQuaternionFromTarget(e))}getWorldPositionFromSelfAngles(e,t){var r=QI.getQuatFromAngles(e);return QI.vec3.transformQuat(Yk,[0,0,1],r),QI.vec3.scale(Yk,Yk,t),QI.vec3.add(Yk,this.position,Yk)}getLocalMatrix(e,t){if(void 0===t&&(t=!1),!e||!e.isObject3D)return eL;var r=QI.mat4.invert([],e.getMatrixWorld([],t)),n=this.getMatrixWorld([],t);return QI.mat4.multiply([],r,n)}lookAt(e,t){void 0===t&&(t=Kk);var r=this[qk];if(e){if(!e.isBaseObject&&!BI.isArray(e))return void BI.error("Look at target failed, due to target is not a BaseObject or position");var n={lookOnPlane:!1};e.isCamera&&(n.lookOnPlane=!0);var i=BI.parseValue(t.up,[0,1,0]),a=t.lockAxis,s=BI.parseValue(t.always,!1),o=BI.parseValue(t.lookOnPlane,n.lookOnPlane),l=t.update;r.lookAtTargetInfo={up:i.slice(0),target:e,lockAxis:a,always:s,lookOnPlane:o,update:l,owner:this,object:this.object},e.isBaseObject?(this._lookAtTarget(),s&&this.object.on("update",(()=>{this._lookAtTarget()}),Xk)):(this._lookAtPosition(e,i),s&&this.object.on("update",(()=>{this._lookAtPosition(e,i)}),Xk))}else r.lookAtTargetInfo=null,this.object.off("update",Xk)}keepSize(e,t){var r=this[qk],n=this.object;if(e){if(!r.keepSizeInfo){var i=this._getDistanceToCameraInKeepSizeMode(t),a=n.localScale;r.keepSizeInfo={camera:t,initialLocalScale:a,scaleFactor:[i/a[0],i/a[1],i/a[2]],refresh:()=>{var e=this._getDistanceToCameraInKeepSizeMode(t);r.keepSizeInfo.scaleFactor=[e/a[0],e/a[1],e/a[2]],this._updateKeepSize()}},n.on("update",(()=>{this._updateKeepSize()}),Qk,-1e7),this._updateKeepSize()}}else r.keepSizeInfo&&(n.localScale=r.keepSizeInfo.initialLocalScale,r.keepSizeInfo=null,n.off("update",Qk))}getPivot(){if(this.object.hasComponent("bounding")){var e=this.object.getOBB(!1),t=e.center,r=QI.fixScaleFactor(e.size),n=this.worldToSelf(t),i=QI.divideVector(n,r);return QI.subVector([.5,.5,.5],i)}return[.5,.5,.5]}setPivot(e,t){var r=this.object,n=r.getOBB(!1),i=QI.scaleVector(n.halfSize,2),a=QI.subVector(e,t),s=QI.scaleVector(a,i),o=r.selfToWorld(QI.negVector(s),!0);this.setPivotWorldPosition(o)}setPivotWorldPosition(e){var t=this.object.body;t.createRootNode(),function(e,t){var r=e.getChildren().filter((e=>!e.getUserData("isDebugNode"))),n=[0,0,0],i=r.map((e=>e.getWorldPosition(n).slice(0)));e.setWorldPosition(t);for(var a=0;a<r.length;a++)r[a].setWorldPosition(i[a])}(t.createPivotNode(),e),this.onNotifyChange()}clearPivot(){this.object.body.clearPivotNode()}bindSubNode(e,t){if(!e)return!1;this.unbindSubNode();var r=e.body.getNodeByName(t);if(!r)return!1;var n=r.node;return!!n&&(QI.mat4.invert(Jk,r.matrixWorld),QI.mat4.multiply(Jk,Jk,this.object.body.matrixWorld),!!this.object.bodyNode.bindSubNode(n,Jk))}unbindSubNode(){this.object.bodyNode.unbindSubNode()}get lookAtTargetInfo(){return this[qk].lookAtTargetInfo}get keepSizeInfo(){return this[qk].keepSizeInfo}get localPosition(){return this.getLocalPosition()}set localPosition(e){this.setLocalPosition(e)}get localAngles(){return this.getLocalAngles()}set localAngles(e){this.setLocalAngles(e)}get localQuaternion(){return this.getLocalQuaternion()}set localQuaternion(e){this.setLocalQuaternion(e)}get localScale(){return this.getLocalScale()}set localScale(e){this.setLocalScale(e)}get position(){return this.getWorldPosition()}set position(e){this.setWorldPosition(e)}get angles(){return this.getWorldAngles()}set angles(e){this.setWorldAngles(e)}get quaternion(){return this.getWorldQuaternion()}set quaternion(e){this.setWorldQuaternion(e)}get scale(){return this.getWorldScale()}set scale(e){this.setWorldScale(e)}get matrix(){return this.getMatrix()}set matrix(e){this.setMatrix(e)}get matrixWorld(){return this.getMatrixWorld()}set matrixWorld(e){this.setMatrixWorld(e)}get inversedMatrix(){return QI.mat4.invert(Jk,this.matrix)}get inversedMatrixWorld(){return QI.mat4.invert(Jk,this.matrixWorld)}get up(){return this.getUpDirection()}get forward(){return this.getForward()}get cross(){return this.getCross()}get keepSizeDistance(){return this[qk].keepSizeDistance}set keepSizeDistance(e){var t=this[qk];t.keepSizeDistance=e;var r=t.keepSizeInfo;r&&r.refresh()}get onChange(){return this[qk].onChange}set onChange(e){this[qk].onChange=e}}aL.mustCopyWithInstance=!0;var sL=Symbol("private"),oL=1,lL=2,uL=1,cL=2,hL=3,dL=["opacity","color","metalness","roughness","emissive"],pL={};class fL extends vk{constructor(){super(),this[sL]={};var e=this[sL];e.renderOrder=0,e.renderLayer=0,e.flags=new Wt,e.flags.set(oL|lL),e.instancedDrawingMode=uL,e.instanceGroupName="",e.instancingNodeInfo=null,e.instancingNode=null,e.callbacks=null}_setRenderAttribute(e,t,r,n){this[sL][e]=r;var i=this.object,a=i.bodyNode;if(a[t]&&a[t](r),n&&i.hasChildren())for(var s=i.children,o=0,l=s.length;o<l;o++){s[o][t](r,!0)}}_canMakeInstancedDrawing(){var e=this[sL],t=this.object;if(e.callbacks){var r=e.callbacks.beforeMakeInstancedDrawing;if(r&&!1===r(t))return!1}if(e.instancingNodeInfo)return!1;if(!t.instanceGroupName&&!t.resource.url)return!1;var n=t.body.style;if(!n)return!1;for(var i=0;i<dL.length;i++){var a=n[dL[i]];if(BI.isFunction(a)&&!a.isConstantValue)return!1}return!(t.hasComponent("animation")&&t.animation.hasInited()&&!t.animation.isAllAnimationsReady())}_makeInstancedDrawing(e,t,r){var n=this.object,i="InstancedRendering"==r,a=t.createStyleFromObject(n,{instancedDrawing:i});if(a){var s=this[sL];e.initResource(a),e.updateBaseValues(n.body.style.values),s.instancedDrawingMode=hL}}_tryMakeInstancedDrawing(e,t){var r=this[sL];if(!this._canMakeInstancedDrawing())return r.instancedDrawingMode=uL,!1;var n=this.object,i=n.app.resourceManager.getStyleGroupPool();return function(e,t){var r=e.bodyNode.getStyle();return!r.isEnabled("InstancedDrawing")&&!t.hasStyle(r)}(n,i)&&(r.copyPromise?r.copyPromise.then((()=>{this._makeInstancedDrawing(e,i,t)})):this._makeInstancedDrawing(e,i,t)),r.instancedDrawingMode=hL,!0}getRenderOrder(){return this[sL].renderOrder}setRenderOrder(e,t){this._setRenderAttribute("renderOrder","setRenderOrder",e,t)}getCastShadow(){return this[sL].flags.has(oL)}setCastShadow(e,t){var r=this[sL];this._setRenderAttribute("castShadow","setCastShadow",e,t),r.flags.enable(oL,e)}getReceiveShadow(){return this[sL].flags.has(lL)}setReceiveShadow(e,t){var r=this[sL];this._setRenderAttribute("receiveShadow","setReceiveShadow",e,t),r.flags.enable(lL,e)}syncAttributes(){var e=this.object.bodyNode;if(e.isRenderableNode){var t=this[sL];e.getCastShadow()!=this.castShadow&&e.setCastShadow(this.castShadow),e.getReceiveShadow()!=this.receiveShadow&&e.setReceiveShadow(this.receiveShadow),e.getRenderOrder()!=t.renderOrder&&e.setRenderOrder(t.renderOrder),e.getRenderLayer()!=t.renderLayer&&e.setRenderLayer(t.renderLayer)}}getGeometryInfo(){return this.object.node.getGeometryInfo()}get callbacks(){var e=this[sL];return e.callbacks=e.callbacks||{beforeMakeInstancedDrawing:null},e.callbacks}get renderOrder(){return this.getRenderOrder()}set renderOrder(e){this.setRenderOrder(e,!0)}get castShadow(){return this.getCastShadow()}set castShadow(e){this.setCastShadow(e,!0)}get receiveShadow(){return this.getReceiveShadow()}set receiveShadow(e){this.setReceiveShadow(e,!0)}get alwaysOnTop(){return 2==this[sL].renderLayer}set alwaysOnTop(e){var t=this[sL],r=this.object.bodyNode;r.isRenderableNode&&(t.renderLayer=e?2:0,r.setRenderLayer(t.renderLayer))}makeInstancedDrawing(e,t){void 0===e&&(e=!0),void 0===t&&(t=pL);var r=this[sL];if(r.instancedDrawingMode==cL)return!1;var n=this.object,i=n.body.style;if(!i)return!1;if(i.isInstancedDrawing==e)return r.instancedDrawingMode=e?hL:uL,!0;if(e){var a=BI.parseValue(t.renderMode,"InstancedRendering");if(n.loaded){if(!this._tryMakeInstancedDrawing(i,a))return!1}else n.waitForComplete().then((()=>{this._tryMakeInstancedDrawing(i,a)}),(()=>{r.instancedDrawingMode=uL})),r.instancedDrawingMode=cL}else{var s=n.bodyNode;r.instancedDrawingMode=uL;var o=BI.createObject("Style");o.copy(s.getStyle()),o.enable("InstancedDrawing",!1);var l=Object.assign({},i.values);i.initResource(o),i.updateBaseValues(l)}return!0}get isInstancedDrawing(){return this[sL].instancedDrawingMode!=uL}get instanceGroupName(){return this[sL].instanceGroupName}set instanceGroupName(e){this[sL].instanceGroupName=e}enableInstancing(e){var t=this[sL];return t.instancingNodeInfo||this.object.waitForComplete().then((()=>{if(this.isInstancedDrawing)return!1;var r=this.object.bodyNode.getAttribute("Instancing");return!!r&&(t.instancingNode=r,t.instancingNodeInfo={maxNumber:0,number:0,matrices:[],pickedIds:[]},!(e&&!this.setInstancing(e))&&void 0)})),!0}disableInstancing(){var e=this[sL];e.instancingNodeInfo&&(this.object.bodyNode.setAttribute("Instancing",null),e.instancingNodeInfo=null,e.instancingNode=null)}setInstancing(e){var t=this[sL],r=t.instancingNodeInfo;if(!r)return!1;var n=BI.parseValue(e.maxNumber,r.maxNumber),i=BI.parseValue(e.number,r.number),a=BI.parseArray(e.matrices,r.matrices),s=BI.parseArray(e.pickedIds,r.pickedIds);if(i>n)return!1;if(a.length!=n)return!1;if(s.length!=n)return!1;r.maxNumber=n,r.number=i,r.matrices=a,r.pickedIds=s;var o=t.instancingNode;return o.begin(),o.setMaxCount(r.maxNumber),o.setCount(r.number),o.setMatrices(function(e){for(var t=[],r=0,n=e.length;r<n;r++)for(var i=e[r],a=0,s=i.length;a<s;a++)t.push(i[a]);return t}(r.matrices)),o.setPickedIds(r.pickedIds),o.end(),!0}getInstancing(){return this[sL].instancingNodeInfo}}fL.mustCopyWithInstance=!0;var mL=Symbol("private");function gL(e,t){return e}class _L extends vk{constructor(){super(),this[mL]={};var e=this[mL];e.config={ignoreVisible:!1,ignoreEvent:!1},e.viewpoint=null}leave(e){var t=this;return new E(((r,n,i)=>{i((()=>{})),t.onLeaveAsync?t.onLeaveAsync.call(t,e,gL(r,t.onLeaveAsync),n):t.onLeave?(t.onLeave.call(t,e),r()):r()}))}enter(e){var t=this;return new E(((r,n,i)=>{i((()=>{})),t.onEnterAsync?t.onEnterAsync.call(t,e,gL(r,t.onEnterAsync),n):t.onEnter?(t.onEnter.call(t,e),r()):r()}))}finish(e){this.onFinish&&this.onFinish(e)}getActionByName(e){var t=this.actionQueue;return t?t.getByName(e):null}getActionByType(e){var t=this.actionQueue;return t?t.getByType(e):null}enableAction(e,t){var r=this.actionQueue;r&&r.enable(e,t)}isActionEnabled(e){var t=this.actionQueue;return!!t&&t.isEnabled(e)}get isCurrentLevel(){var e=this.object.app;return this.object==e.levelManager.current}get actionQueue(){return this.object.actionGroup.get(sI.EnterLevel)}get actions(){var e=this.actionQueue;return e?e.actions:[]}get config(){return this[mL].config}set config(e){this[mL].config=e}get viewpoint(){return this[mL].viewpoint}set viewpoint(e){this[mL].viewpoint=e}}_L.mustCopyWithInstance=!0;var vL=Symbol("private"),yL=1,xL=2;function bL(e,t){return e.priority!==t.priority?t.priority-e.priority:e.index-t.index}function AL(e,t){for(var r=0;r<e.length;r++){if(e[r].name==t)return r}return-1}class SL{constructor(e){void 0===e&&(e={}),this[vL]={};var t=this[vL];t.name=BI.parseValue(e.name,""),t.actions=[],t.actionRuntimeData={}}_getActionByName(e){var t=this[vL].actions,r=AL(t,e);return-1===r?null:t[r]}_getActionByType(e){for(var t=this[vL].actions,r=0;r<t.length;r++){var n=t[r];if(n.processor instanceof e)return n}return null}_addAction(e,t,r){var n=this[vL].actions,i=new Wt;i.enable(yL,!0);var a={flags:i,processor:e,name:BI.parseValue(t,""),priority:BI.parseValue(r,0),index:n.length};n.push(a),n.sort(bL)}clear(){this.stop();var e=this[vL];e.actions.forEach((e=>{e.flags.enable(xL,!0);var t=e.processor.onStop;t&&t.call(e.processor)})),e.actions.length=0,e.actionRuntimeData={}}add(e,t,r){void 0===t&&(t=""),void 0===r&&(r=0),e&&(BI.isString(t)?BI.isNumber(r)?BI.isArray(e)?e.forEach((e=>{this._addAction(e)})):this._addAction(e,t,r):BI.error("Add action failed, due to the priority('"+r+"') is not number type"):BI.error("Add action failed, due to the name('"+t+"') is not string type"))}set(e,t){var r=this[vL],n=t.priority,i=t.processor,a=this._getActionByName(e);if(a){var s=a.priority;a.priority=BI.parseValue(n,a.priority),a.processor=BI.parseValue(i,a.processor),s!=a.priority&&r.actions.sort(bL)}else this._addAction(i,e,n)}getByName(e){var t=this._getActionByName(e);return t?t.processor:null}getByType(e){var t=this._getActionByType(e);return t?t.processor:null}removeByName(e){var t=this[vL].actions,r=AL(t,e);-1!==r&&t._removeAt(r)}removeByType(e){var t=this[vL].actions,r=function(e,t){for(var r=0;r<e.length;r++)if(e[r].processor instanceof t!=0)return r;return-1}(t,e);-1!==r&&t._removeAt(r)}traverseByName(e,t){for(var r=this[vL].actions,n=0;n<r.length;n++){var i=r[n];i.name==e&&t(i.processor)}}traverseByType(e,t){for(var r=this[vL].actions,n=0;n<r.length;n++){var i=r[n];i.processor instanceof e&&t(i.processor)}}replace(e,t){for(var r=this[vL].actions,n=0;n<r.length;n++){var i=r[n];if(i.processor==e){var a=i.processor.onStop;return a&&a.call(i.processor),i.processor=t,!0}}return!1}getPriority(e){for(var t=this[vL].actions,r=0;r<t.length;r++){var n=t[r];if(n.processor==e)return n.priority}return 0}setPriority(e,t){for(var r=this[vL].actions,n=0;n<r.length;n++){var i=r[n];if(i.processor==e)return i.priority=t,r.sort(bL),!0}return!1}enable(e,t){var r=this._getActionByName(e);if(r&&r.flags.enable(yL,t)){var n=r.processor;n.onEnable&&n.onEnable(t)}}isEnabled(e){var t=this._getActionByName(e);return!!t&&t.flags.has(yL)}stop(){var e=this[vL];e.actions.forEach((t=>{var r=t.flags;if(r.has(xL)){var n=t.processor;if(n){if(n.getRuntimeData){var i=n.getRuntimeData();e.actionRuntimeData[t.name]=i}n.resetRuntimeData();var a=n.onStop;a&&a.call(n),r.enable(xL,!1)}}}))}run(e){void 0===e&&(e={});var t=this[vL];return this.stop(),new Promise(((r,n)=>{var i=t.actions;if(i.length){var a=!1;i.forEachAsync(((s,o)=>{if(!a){s.flags.enable(xL,!0),BI.isFunction(s.processor)&&(s.processor=s.processor());var l=s.processor;if(l){if(l.setRuntimeData){var u=t.actionRuntimeData[s.name];u&&l.setRuntimeData(u)}if(s.flags.has(yL)){var c=l.onRun(e);if(c)return c.then((()=>{(l.isAbort||o==i.length-1)&&(a=!0,r())})).catch((e=>{n(e)}));(l.isAbort||o==i.length-1)&&(a=!0,r())}}}}))}else r()}))}get name(){return this[vL].name}set name(e){this[vL].name=e}get actions(){return this[vL].actions}}var EL=Symbol("private");class wL extends vk{constructor(){super(),this[EL]={},this[EL].groups=new Map}onRemove(){var e=this[EL];e.groups.forEach((e=>{e.clear()})),e.groups.clear(),super.onRemove()}add(e){var t=this[EL],r=t.groups.get(e);return r||(r=new SL({name:e}),t.groups.set(e,r),r)}remove(e){var t=this[EL],r=t.groups;r&&(r.clear(),t.groups.delete(e))}get(e){var t=this[EL].groups.get(e);return t||null}stop(e){var t=this[EL].groups.get(e);if(t)return t.stop()}run(e,t){var r=this[EL].groups.get(e);return r?r.run(t):null}get groups(){return this[EL].groups}}wL.mustCopyWithInstance=!0;var CL=Symbol("private"),TL="__moveTo__",DL="__movePath__",ML="__scaleTo__",PL="__rotateTo__",FL="__fading__",RL=["__positionFlying__","__targetFlying__"],NL=1,BL=[];function IL(e,t,r,n){if(BI.isArray(r))return r.slice(0);var i={};return e.forEach((e=>{var a=r[e];BI.isNull(a)?a=t.getAttribute(e):t.hasAttribute(e)&&n&&n(e,a),i[e]=a})),i}function OL(e,t){return{start:()=>{},stop:()=>{e("stop")},update:()=>{},complete:()=>{e("complete")},onStart:()=>{},onStop:()=>{e("onStop")},onUpdate:()=>{},onComplete:()=>{e("onComplete")}}}function kL(e,t,r,n,i){r&&r({object:e,value:t}),n&&n[i]&&n[i]()}function LL(e,t,r,n,i,a,s,o){var l;for(var u in n.length?(BL.length=0,l=BL):l={},n){var c=void 0;c="quaternion"==u||"localQuaternion"==u?QI.slerp(r[u+"_start"],r[u],a):n[u],s&&s(u,c),l[u]=c,o&&o(u,c)}i&&i({object:e,from:t,to:r,progress:a,value:l})}function UL(e){return"__UVTransform_"+e.toLowerCase()+"__"}function zL(e){return void 0===e&&(e={}),{loopType:BI.parseLoopType(e.loopType),lerpType:BI.parseLerpType(e.lerpType),time:e.time,duration:e.duration,times:e.times,loop:e.loop}}class jL extends vk{constructor(){super(),this[CL]={};var e=this[CL];e.flags=new Wt,e.tweens=[]}_buildLerpParam(e,t){var{lerpType:r,loop:n,loopType:i,times:a,duration:s,time:o,delayTime:l}=t,u=BI.parseValue(t.onRepeat,t.repeat),c=BI.parseValue(t.onStart,t.start),h=BI.parseValue(t.onStop,t.stop),d=BI.parseValue(t.onUpdate,t.update),p=BI.parseValue(t.onComplete,t.complete),f=!1;return{lerpType:r,loop:n,loopType:i,times:a,duration:s,time:o,delayTime:l,onRepeat:()=>{f=!0},onStart:()=>{c&&c({object:this.object}),e&&e.onStart&&e.onStart()},onStop:()=>{h&&h({object:this.object}),e&&e.onStop&&e.onStop()},onUpdate:t=>{f&&(f=!1,u&&u({object:this.object}),e&&e.onRepeat&&e.onRepeat()),d&&d(t,t.progress),e&&e.onUpdate&&e.onUpdate()},onComplete:()=>{p&&p({object:this.object}),e&&e.onComplete&&e.onComplete()}}}_stopTweenByName(e){var t=this[CL].tweens,r=t.findIndex((t=>t.name==e));return-1!==r&&(t[r].tween.stop(),!0)}_removeTweenByName(e){var t=this[CL].tweens,r=t.findIndex((t=>t.name==e));return-1!==r&&(t._removeAt(r),!0)}_getTweenByName(e){var t=this[CL].tweens,r=t.findIndex((t=>t.name==e));return-1===r?null:t[r].tween}_lerpPoints(e,t,r,n){var i=BI.parseLoopType(t.loopType),a=BI.parseValue(t.onRepeat,t.repeat),s=BI.parseValue(t.onStart,t.start),o=BI.parseValue(t.onStop,t.stop),l=BI.parseValue(t.onNext,t.next),u=BI.parseValue(t.onUpdate,t.update),c=BI.parseValue(t.onComplete,t.complete),h=e.slice(0);t.closure&&h.push(e[0]);var d=this.object,p=!1,f=-1,m=Object.assign({},t);m.onRepeat=()=>{f=-1,i==wB.PingPong?p=!p:d.position=h[0],a&&a({object:d,from:h[0],to:h[1]})},m.onStart=()=>{d.position=h[0],s&&s({object:d,from:h[0],to:h[1]})},m.onStop=()=>{o&&o({object:d})},m.onUpdate=e=>{var t=e.value.progress,{point:r,index:n,from:i,to:a}=QI.lerpPoints(h,_,t);if(p){var s=i;i=a,a=s}f!=n&&(a&&l&&l({object:d,from:i,to:a}),f=n),u&&u({object:d,point:r,from:i,to:a,progress:t})},m.onComplete=()=>{c&&c({object:d,progress:1})};var g=this._buildLerpParam(n,m),_=QI.getPointsSteps(h);_.length?(g.from={progress:0},g.to={progress:1},this.to(g,r)):g.onComplete&&g.onComplete()}_lookAt(e,t,r,n){n=n||e.up,e.quaternion=QI.getQuatFromTarget(t,r,n)}onImport(e){var t=e.uv;if(t)for(var r in t){var n=t[r].value,i=zL(t[r].options);this.uvTransformTo(r,n,i)}}onRemove(){this.stopAll(),super.onRemove()}stopAll(){var e=this[CL];e.tweens.slice(0).forEach((e=>{e.tween.stop()})),e.tweens.length=0}pauseAll(){this[CL].tweens.forEach((e=>{e.tween.pause()}))}resumeAll(){this[CL].tweens.forEach((e=>{e.tween.resume()}))}pause(e){if(e)if(BI.isArray(e))e.forEach((e=>{this.pause(e)}));else{var t=this._getTweenByName(e);t&&t.pause()}}resume(e){if(e)if(BI.isArray(e))e.forEach((e=>{this.resume(e)}));else{var t=this._getTweenByName(e);t&&t.resume()}}stop(e){e&&(BI.isArray(e)?e.forEach((e=>{this._stopTweenByName(e)})):this._stopTweenByName(e))}to(e,t,r){void 0===e&&(e={});var n=function(e,t,r){var n;if(BI.isNumber(e)&&BI.isNumber(t)){if(n={from:{current:e},to:{current:t}},BI.isString(r))t=r;else if(t="",BI.isObject(r)){for(var i in r)n[i]=r[i];r={}}}else n=Object.assign({},e);return n.name=t,n.trigger=r,n}(e,t,r),i=this.object,a=BI.parseValue(n.syncMode,!0),s=n.from||{},o=n.to||{},l=BI.parseLerpType(n.lerpType)||EB.Linear.None,u=BI.parseLoopType(n.loopType),c=BI.parseValue(n.times,-1),h=BI.parseNumber(n.duration,BI.parseNumber(n.time,1e3)),d=BI.parseValue(n.delayTime,0),p=BI.parseValue(n.onRepeat,n.repeat),f=BI.parseValue(n.onStart,n.start),m=BI.parseValue(n.onStop,n.stop),g=BI.parseValue(n.onResume,n.resume),_=BI.parseValue(n.onPause,n.pause),v=BI.parseValue(n.onUpdate,n.update),y=BI.parseValue(n.onComplete,n.complete),x=n.loop;BI.isValid(x)&&(c=x,u=wB.Repeat);var b=BI.getUnionKeys(s,o),A=IL(b,i,s,((e,t)=>{a&&i.setAttribute(e,t)})),S=IL(b,i,o);A.quaternion?S.quaternion_start=A.quaternion.slice(0):A.localQuaternion&&(S.localQuaternion_start=A.localQuaternion.slice(0));var E=Object.assign({},A);n.name&&this.stop(n.name);var w=n.onBeforeUpdateAttribute,C=a?(e,t)=>{i.setAttribute(e,t)}:n.onAfterUpdateAttribute,T=this[CL];if(h||d){var D=this.app.tweenManager.lerpTo(A,S,h,d).times(c).easing(l).looping(u).onRepeat((e=>{kL(i,e.value,p,n.trigger,"onRepeat")})).onStart((e=>{kL(i,e.value,f,n.trigger,"onStart")})).onParseValue(((e,t,r)=>{"color"===r&&(e[r]=BI.parseColor(e[r]),t[r]=BI.parseColor(t[r]))})).onStop((e=>{kL(i,e.value,m,n.trigger,"onStop"),this._removeTweenByName(n.name)})).onResume((e=>{kL(i,e.value,g,n.trigger,"onResume")})).onPause((e=>{kL(i,e.value,_,n.trigger,"onPause")})).onUpdate(((e,t)=>{LL(i,E,S,e.value,v,t,w,C)})).onComplete((e=>{kL(i,e.value,y,n.trigger,"onComplete"),this._removeTweenByName(n.name)})).start();T.tweens.push({name:n.name,tween:D})}else kL(i,A,f,n.trigger,"onStart"),LL(i,E,S,S,v,1,w,C),kL(i,A,y,n.trigger,"onComplete")}toAsync(e,t){return void 0===e&&(e={}),new Promise(((r,n)=>{this.to(e,t,OL(r))}))}lerpPoints(e,t,r,n){void 0===t&&(t={}),void 0===r&&(r=""),void 0===n&&(n=null),r&&this.stop(r),this._lerpPoints(e,t,r,n)}lerpPointsAsync(e,t,r){return void 0===t&&(t={}),void 0===r&&(r=""),new Promise(((n,i)=>{this.lerpPoints(e,t,r,OL(n))}))}stopMoving(){this.stop(TL),this.stop(DL)}pauseMoving(){this.pause(TL),this.pause(DL)}resumeMoving(){this.resume(TL),this.resume(DL)}moveForward(e,t){void 0===t&&(t={});var r=this.object,n=QI.getPositionOnDirection(r.position,r.forward,e);this.moveTo(n,t)}moveTo(e,t,r){void 0===t&&(t={}),void 0===r&&(r=null),this.stopMoving(),BI.isArray(e)||(e=(t=e).to);var n=this._object,i=this._buildLerpParam(r,t),a=BI.parseValue(t.spaceType,TB.World);if(i.to=a==TB.World?{position:e}:{localPosition:e},BI.parseValue(t.orientToPath,!0)){var s=n.position,o=i.to,l=t.up;if(QI.equalsVector3(n.position,e)||this._lookAt(n,n.position,e,l),i.loopType==wB.PingPong){var u=i.onRepeat;i.onRepeat=e=>{var t=s;s=o.position||o,o=t,this._lookAt(n,s,o,l),u&&u(e)}}}this.to(i,TL)}moveToAsync(e,t){return void 0===t&&(t={}),new Promise(((r,n)=>{this.moveTo(e,t,OL(r))}))}movePath(e,t,r){void 0===t&&(t={}),void 0===r&&(r=null),this.stopMoving(),BI.isObject(e)&&(e=(t=e).path);var n=BI.parseValue(t.orientToPath,!0),i=BI.parseValue(t.spaceType,TB.World),a=t.up,s=this._object,o=BI.parseValue(t.onUpdate,t.update);t.onUpdate=e=>{var t=e.point;i==TB.World?s.position=t:s.localPosition=t,o&&o(e)};var l=BI.parseValue(t.onNext,t.next);t.onNext=e=>{var{from:t,to:r}=e;n&&this._lookAt(s,t,r,a),l&&l(e)},this._lerpPoints(e,t,DL,r)}movePathAsync(e,t){return void 0===t&&(t={}),new Promise(((r,n)=>{this.movePath(e,t,OL(r))}))}stopScaling(){this.stop(ML)}pauseScaling(){this.pause(ML)}resumeScaling(){this.resume(ML)}scaleTo(e,t,r){void 0===t&&(t={}),this.stopScaling(),BI.isArray(e)||(e=(t=e).to);var n=this._buildLerpParam(r,t),i=BI.parseValue(t.spaceType,TB.World);n.to=i==TB.World?{scale:e}:{localScale:e},this.to(n,ML)}scaleToAsync(e,t){return void 0===t&&(t={}),new Promise(((r,n)=>{this.scaleTo(e,t,OL(r))}))}stopRotating(){this.stop(PL)}pauseRotating(){this.pause(PL)}resumeRotating(){this.resume(PL)}rotateTo(e,t,r){void 0===t&&(t={}),this.stopRotating(),BI.isArray(e)||(e=(t=e).to);var n=this._buildLerpParam(r,t);BI.parseValue(t.spaceType,TB.Local)==TB.World?3==e.length?n.to={angles:e}:n.to={quaternion:QI.getQuatFromAngles(e)}:3==e.length?n.to={localAngles:e}:n.to={localQuaternion:QI.getQuatFromAngles(e)},this.to(n,PL)}rotateToAsync(e,t){return void 0===t&&(t={}),new Promise(((r,n)=>{this.rotateTo(e,t,OL(r))}))}stopFading(){this.stop(FL)}pauseFading(){this.pause(FL)}resumeFading(){this.resume(FL)}fadeIn(e,t){if(void 0===e&&(e={}),this.stopFading(),this.object.style){var r=this._buildLerpParam(t,e);r.from={style:{opacity:0}},r.to={style:{opacity:1}},this.to(r,FL)}}fadeOut(e,t){if(void 0===e&&(e={}),this.stopFading(),this.object.style){var r=this._buildLerpParam(t,e);r.from={style:{opacity:1}},r.to={style:{opacity:0}},this.to(r,FL)}}fadeInAsync(e){return void 0===e&&(e={}),new Promise(((t,r)=>{this.fadeIn(e,OL(t))}))}fadeOutAsync(e){return void 0===e&&(e={}),new Promise(((t,r)=>{this.fadeOut(e,OL(t))}))}getFlyInfo(e){void 0===e&&(e={});var t=e.position,r=e.target,n=e.up,i=this.object,a={position:{from:i.position,to:t||i.position}},s=i.target;if(s&&(a.target={from:s,to:null}),n&&(a.up={from:i.up,to:n}),r.isBaseObject){var o=r.getAABB();if(!t){var l=0;BI.isNull(e.horzAngle)&&BI.isNull(e.vertAngle)&&(l=45);var u=BI.parseValue(e.radiusFactor,2.5),c=BI.parseValue(e.distance,o.radius*u),h=BI.parseValue(e.horzAngle,l),d=BI.parseValue(e.vertAngle,l);90==d&&(d-=.1);var p=QI.getOffsetFromAngles(h,d,c);a.position.to=QI.addVector(o.center,p)}a.target&&(a.target.to=o.center)}else a.target&&(a.target.to=r);return a}stopFlying(){this.stop(RL)}pauseFlying(){this.pause(RL)}resumeFlying(){this.resume(RL)}flyTo(e,t){void 0===e&&(e={});var r=this[CL],n=(e=BI.parseFlyParam(e)).duration,i=e.time,a=BI.parseValue(e.delayTime,0),s=e.lerpType||EB.Linear.None,o=BI.parseValue(e.positionLerpType,s),l=BI.parseValue(e.targetLerpType,s),u=BI.parseValue(e.upLerpType,s),c=BI.parseValue(e.onStart,e.start),h=BI.parseValue(e.onStop,e.stop),d=BI.parseValue(e.onResume,e.resume),p=BI.parseValue(e.onPause,e.pause),f=BI.parseValue(e.onUpdate,e.update),m=BI.parseValue(e.onComplete,e.complete),g=this;this.stop(RL);var _=this.getFlyInfo(e);this.to({syncMode:!1,from:_.position.from,to:_.position.to,duration:n,time:i,delayTime:a,lerpType:o,onStart:function(){r.flags.enable(NL,!0),g.object.trigger(SB.StartFlying),c&&c({object:g.object}),t&&t.onStart&&t.onStart()},onStop:function(){r.flags.enable(NL,!1),g.object.trigger(SB.StopFlying),h&&h({object:g.object}),t&&t.onStop&&t.onStop()},onResume:function(){r.flags.enable(NL,!0),d&&d({object:g.object})},onPause:function(){r.flags.enable(NL,!1),p&&p({object:g.object})},onUpdate:function(e){g.object.position=e.value,g.object.trigger(SB.Flying),f&&f({progress:e.progress,object:g.object}),t&&t.onUpdate&&t.onUpdate()},onComplete:function(){r.flags.enable(NL,!1),g.object.trigger(SB.CompleteFlying),m&&m({object:g.object}),t&&t.onComplete&&t.onComplete()}},RL[0]),_.target&&(_.up?this.to({syncMode:!1,from:{up:_.up.from,target:_.target.from},to:{up:_.up.to,target:_.target.to},duration:n,time:i,delayTime:a,lerpType:u,onUpdate:function(e){var t=e.value.up;g.object.lookAt(e.value.target,{up:t})}},RL[1]):this.to({syncMode:!1,from:_.target.from,to:_.target.to,duration:n,time:i,delayTime:a,lerpType:l,onUpdate:function(e){g.object.lookAt(e.value)}},RL[1]))}flyToAsync(e){return void 0===e&&(e={}),new Promise(((t,r)=>{this.flyTo(e,OL(t))}))}fit(e){void 0===e&&(e={}),this.stopFlying(),(e=BI.parseFlyParam(e)).target=e.target||this.app.root;var t=this.getFlyInfo(e);this.object.position=t.position.to,t.target&&this.object.lookAt(t.target.to)}get isFlying(){return this[CL].flags.has(NL)}stopUVTransform(e){e&&this.stop(UL(e))}pauseUVTransform(e){e&&this.pause(UL(e))}resumeUVTransform(e){e&&this.resume(UL(e))}uvTransformTo(e,t,r,n){if(e){void 0===r&&(r=t),this.stopUVTransform();var i=this.object,a=i.style,s=r.from||a.getUV(e),o=r.to||t,l=this._buildLerpParam(n,r);l.from=function(e,t){var r={};return BI.isValid(t.rotation)&&(r.rotation=e.rotation),t.offset&&(r.offset=e.offset.slice(0)),t.repeat&&(r.repeat=e.repeat.slice(0)),t.center&&(r.center=e.center.slice(0)),r}(s,o),l.to=o,l.syncMode=!1,l.onAfterUpdateAttribute=(t,r)=>{i.invisible||a.setUV(e,t,r)},this.to(l,UL(e))}}uvTransformToAsync(e,t,r){if(e)return new Promise(((n,i)=>{this.uvTransformTo(e,t,r,OL(n))}))}}jL.mustCopyWithInstance=!0;var VL=Symbol("private");class GL extends vk{constructor(){super(),this[VL]={};var e=this[VL];e.pendingPromise=null,e.resources=[]}onRemove(){var e=this[VL];e.resources.forEach((e=>{e.dispose()})),e.resources.length=0,super.onRemove()}load(e){void 0===e&&(e={});var t=this[VL],r=e.url,n=e.data||[],i=t.resources,a=this.app.resourceManager;return t.pendingPromise=new Promise(((e,t)=>{if(r)BI.isString(r)&&(r=[r]),r.forEachAsync(pB((function*(e){var t=yield a.loadBlueprintAsync(e);i.push(...t)}))).then((()=>{e()}));else if(n){a.getBlueprintBodyData(n).forEach((e=>{var t=BI.createObject("Blueprint",{app:this.app});i.push(t),t.load({data:e})})),e()}})),this}run(){var e=this[VL],t=this.object;e.pendingPromise.then((()=>{e.resources.forEach((e=>{e.getRunner().start({object:t})}))}))}stop(){var e=this[VL];e.pendingPromise.then((()=>{e.resources.forEach((e=>{e.getRunner().stop()}))}))}setVar(e,t){var r=this[VL];r.pendingPromise.then((()=>{r.resources.forEach((r=>{r.setVar(e,t)}))}))}setVars(e){var t=this[VL];t.pendingPromise.then((()=>{t.resources.forEach((t=>{t.setVars(e)}))}))}addEventListener(e,t){var r=this[VL];r.pendingPromise.then((()=>{r.resources.forEach((r=>{r.addEventListener(e,t)}))}))}removeEventListener(e,t){var r=this[VL];r.pendingPromise.then((()=>{r.resources.forEach((r=>{r.removeEventListener(e,t)}))}))}triggerEvent(e,t){var r=this[VL];r.pendingPromise.then((()=>{r.resources.forEach((r=>{r.triggerEvent(e,t)}))}))}}GL.mustCopyWithInstance=!0;var WL=1,HL=2,qL="__cDynamicLoadComponentTagName__";class XL extends vk{constructor(){super(),this._flags=new Wt,this._aliveTime=6e4,this._pendingUnloadObjects=new Map}_loadResource(e){var t=this._pendingUnloadObjects;if(e.active&&e.visible)e.loading||e.loadResource(!1),t.delete(e);else if(e.loaded){t.get(e)||t.set(e,{aliveTime:this._aliveTime})}}onAdd(e){super.onAdd(e),this.enable=!0}onRemove(){this.enable=!1,this.autoRelease=!1,this._pendingUnloadObjects.clear(),super.onRemove()}get enable(){return this._flags.has(WL)}set enable(e){if(this._flags.enable(WL,e))if(e){var t=this._pendingUnloadObjects;this.object.on(SB.AfterDestroy,".Object3D",(e=>{var r=e.object;t.delete(r)}),qL),this.object.on(SB.VisibleChange,".Object3D",(e=>{this._loadResource(e.object)}),qL)}else this.object.off(SB.AfterDestroy,qL),this.object.off(SB.VisibleChange,qL)}get aliveTime(){return this._aliveTime}set aliveTime(e){this._aliveTime=e}get autoRelease(){return this._flags.has(HL)}set autoRelease(e){this._flags.enable(HL,e)&&(e?this.object.app.on(SB.Update,(e=>{var t=1e3*e.deltaTime,r=this._pendingUnloadObjects;r.forEach(((e,n)=>{e.aliveTime>=t?e.aliveTime-=t:(n.unloadResource(!1),r.delete(n))}))}),qL):this.object.app.off(SB.Update,qL))}}XL.mustCopyWithInstance=!0;var QL=Symbol("private"),KL=1,YL=2,ZL=4,JL=8,$L=16,eU=32,tU=64,rU=128,nU=256,iU=512,aU=1024,sU=2048,oU="__cZoomToMouseCursorOnWheel__",lU="__cZoomEventTag__",uU="__cZoomToMouseCursorOnWheelEventTag__",cU="__cAutoAdjustTargetPositionEventTag__",hU="__cAppClickEventTag__",dU="__cAppDBLClickEventTag__",pU="OrbitControls-start",fU=1e4,mU=QI.createVec3(),gU=QI.createVec3(),_U=QI.createVec3(),vU=QI.createVec3(),yU=QI.createVec3();class xU extends vk{constructor(){super(),this[QL]={};var e=this[QL];e.controller=null,e.flags=new Wt,e.stateGroup=new br({onChange:e=>{this.getController().active(e.state)}}),e.changeTickcount=0,e.crossPlanes=null,e.intervalTimers={},e.adjustCallbacks={panSpeed:null},e.distanceLimited=null,e.boundary=null,e.zoomToMouseCursorOnWheelSpeed=.05}_unprojectScreenToWorld(e,t,r){void 0===r&&(r=-1);var n=this.app,i=n.view.getPixelRatio();e*=i,t*=i;var a=n.size,s=e/a[0]*2-1,o=-t/a[1]*2+1;return this.object.node.unproject(gU,QI.vec3.set(gU,s,o,r)),gU}_clearPickerState(){this.app.picker.stateGroup.enable(!0,pU,-1e4)}_registerEvents(){var e=this.app;e.on("click",(t=>{e.picker.stateGroup.enable(!0,pU,-1e4)}),hU),e.on("dblclick",(t=>{e.picker.stateGroup.enable(!0,pU,-1e4)}),dU)}_unregisterEvents(){var e=this.app;e.off("click",hU),e.off("dblclick",dU)}_createCrossPlanes(){var e=this[QL],t=this.app.global.cache.models.plane,r=1e9,n=[r,r,r],i=t.clone();i.setVisible(!1),i.setScale(n),i.setQuaternion(QI.getQuatFromAngles([-90,0,0]));var a=t.clone();a.setVisible(!1),a.setScale(n);var s=BI.createObject("Node");s.setVisible(!1),s.add(i),s.add(a),s.horzPlane=i,s.vertPlane=a,e.crossPlanes=s,e.intervalTimers.crossPlanes=new Io({interval:.25,onInterval:()=>{var e=this.object;if(this.isChanging){var t=e.getWorldPosition(gU),r=e.control.getTarget(_U);a.lookAt(t),s.setPosition(r),s.updateMatrixWorld()}}})}_dispatchChangingEvent(){var e=this[QL];e.changeTickcount=0,e.flags.enable(sU,!0)}_createController(){var e=BI.createObject("OrbitControls",{camera:this.object.node,appDelegate:this.app.delegate});return e.active(!1),e}_isNeedLookAtTarget(){return!this.enableZoomToMouseCursorOnWheel&&!this[QL].controller.isActivated()}_getSourcePositionByDistance(e){var t=this.getTarget(),r=this.object.position,n=QI.getDirection(r,t),i=QI.scaleVector(n,e);return QI.addVector(r,i)}_getTargetPositionByDistance(e){var t=this.getTarget(),r=this.object.position,n=QI.getDirection(r,t),i=QI.scaleVector(n,e);return QI.addVector(t,i)}_updateTargetByMoveForwardAction(e){if(!(this.distance>e)){var t=this._getTargetPositionByDistance(2*e);this.setTarget(t)}}_pickFromCrossPlanes(e,t){var r=this[QL].crossPlanes;if(!r)return null;var n=this.object.picker,i=this.object.distance,a=[],s=r.vertPlane,o=n.intersectPlane(e,t,s.getForward(yU),i);o&&a.push(o);var l=r.horzPlane,u=n.intersectPlane(e,t,l.getForward(yU),i);return u&&a.push(u),a}_pickInWorld(e,t){var r=this.object.pick(e,t);return r?r.position:(r=this.pickFromCrossPlanes(e,t))||null}_pick(e,t){var r=this._pickInWorld(e,t);if(r)return r;gU[0]=e,gU[1]=t,gU[2]=.5;var n=this.object,i=n.position,a=QI.normalizeVector(QI.subVector(i,n.screenToWorld(gU)));return QI.addVector(i,QI.scaleVector(a,-50))}_getCenterPickedPosition(){var e=this.app.size,t=e[0]/2,r=e[1]/2;return this._pick(t,r)}_updateZoomToMouseCursorOnWheel(e){var t=this[QL],r=this._pick(e.x,e.y),n=this._getCenterPickedPosition(),i=this.object,a=i.distanceTo(r)*t.zoomToMouseCursorOnWheelSpeed;a*=this.zoomSpeed;var s=QI.normalizeVector(QI.subVector(r,i.position)),o=QI.scaleVector(s,a),l=i.node;l.getPosition(gU),gU=e.delta<0?QI.addVector(gU,o):QI.subVector(gU,o),l.setPosition(gU),this.setTarget(n)}_enableAdjustTargetPosition(e){var t=this[QL],r=this.app;e?r.on("mousedown",(e=>{if(2==e.button){var n=this.object,i=r.size,a=n.pick(i[0]/2,i[1]/2);if(a){var s=a.position;if(s){var o=n.control.getTarget(_U),l=n.getWorldPosition(gU),u=n.getForward(vU),c=n.distance,h=QI.getDistance(s,l),d=QI.getDistance(s,o);c>=h&&(d*=-1);var p=QI.addVector(o,QI.scaleVector(u,d)),f=t.distanceLimited;if(f){var m=QI.getDistance(l,p);if(m<=f[0])return;if(m>=f[1])return}t.boundary&&!QI.intersectsPoint(p,t.boundary.min,t.boundary.max)||this.setTarget(p)}}}}),cU):r.off("mousedown",cU)}_enableZoomToMouseCursorOnWheel(e){var t=this[QL].stateGroup,r=this.app;e?(this.getController().enable("Zoom",!1),r.global.waitForComplete().then((()=>{r.on("wheel",(e=>{!1!==t.getValue("default")&&this.enableZoom&&(t.enable(!1,oU,1e5),this._updateZoomToMouseCursorOnWheel(e))}),uU),r.on("mousedown",(e=>{t.enable(!0,oU,0)}),uU)}))):(this.getController().enable("Zoom",this.enableZoom),t.enable(!0,oU,0),r.off("wheel",uU),r.off("mousedown",uU))}_getDistanceToTargetInPickingMode(){var e=this.object,t=e.control.getTarget(_U),r=e.worldToScreen(t,gU),n=this._pickInWorld(r[0],r[1]);if(!n)return null;var i=e.getWorldPosition(mU);return QI.getDistance(n,i)}_processAdjustPanSpeed(){var e=this[QL];if(e.adjustCallbacks.onPanSpeed){var t=e.adjustCallbacks.onPanSpeed();t&&(this.panSpeed=t)}else{var r=this.object.distance;if(!r)return;this.panSpeed=QI.clamp(1,.5,r/30)}}_processControllerEndEvent(){var e=this[QL];this._clearPickerState(),e.flags.enable(sU,!1)}_change(e){var t=this.object;t.getWorldPosition(gU),t.control.getTarget(_U),this.app.trigger(e,{position:gU,target:_U})}onUpdate(e){var t=this[QL];this.object,-1!=t.changeTickcount&&(t.changeTickcount>=.01?(t.changeTickcount=-1,t.flags.enable(sU,!1)):t.changeTickcount+=e);var r=t.controller;for(var n in r&&r.isActivated()&&this.getController().update(e),t.intervalTimers){t.intervalTimers[n].update(e)}}onAdd(e){super.onAdd(e),this._createCrossPlanes(),this.enableDamping=!0,this.enableRotate=!0,this.enablePan=!0,this.enableZoom=!0,this.enableAutoMoveTargetForward=!0,this.enableAdjustTargetPosition=!0,this.enableAdjustNear=!0,this.enableAdjustPanSpeed=!0,this.enablePickWhenChanging=!1,this._registerEvents()}onRemove(){var e=this[QL];this._unregisterEvents(),this.enableDamping=!1,this.enableRotate=!1,this.enablePan=!1,this.enableZoom=!1,this.enableAutoMoveTargetForward=!1,this.enableAdjustTargetPosition=!1,this.enableAdjustNear=!1,this.enableAdjustPanSpeed=!1,this.enablePickWhenChanging=!0,e.crossPlanes&&(e.crossPlanes.dispose(),e.crossPlanes=null),e.controller&&(e.controller.dispose(),e.controller=null),super.onRemove()}onCopy(e){this.target=e.target,this.enableDamping=e.enableDamping,this.enableRotate=e.enableRotate,this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableAutoMoveTargetForward=e.enableAutoMoveTargetForward,this.enableAdjustTargetPosition=e.enableAdjustTargetPosition,this.enableAdjustNear=e.enableAdjustNear,this.enableAdjustPanSpeed=e.enableAdjustPanSpeed,this.enablePickWhenChanging=e.enablePickWhenChanging,this.dampingFactor=e.dampingFactor,this.zoomSpeed=e.zoomSpeed,this.rotateSpeed=e.rotateSpeed,this.panSpeed=e.panSpeed,this.keyPanSpeed=e.keyPanSpeed,this.zoomToMouseCursorOnWheelSpeed=e.zoomToMouseCursorOnWheelSpeed,this.distanceLimited=e.distanceLimited,this.vertAngleLimit=e.vertAngleLimit,this.horzAngleLimit=e.horzAngleLimit,this.boundary=e.boundary,this.target=e.target}getTarget(e){return void 0===e&&(e=[0,0,0]),this.getController().getTargetWorldPosition(e)}setTarget(e){this._isNeedLookAtTarget()&&this.object.node.lookAt(e),this.getController().setTargetWorldPosition(e)}getController(){var e=this[QL];if(!e.controller){var t=this._createController();this.setController(t)}return e.controller}setController(e){var t=this[QL];e?(e.setKeyPanSpeed(.5),e.setPanSpeed(.5),e.setRotateSpeed(.56),e.setDampingFactor(.078),e.addEventListener("preStart",(e=>{this._change(SB.CameraChangePreStart)})),e.addEventListener("start",(e=>{this.enablePickWhenChanging||this.app.picker.stateGroup.enable(!1,pU,fU),t.flags.enable(sU,!0),this._change(SB.CameraChangeStart)})),e.addEventListener("preEnd",(e=>{this._processControllerEndEvent(),this._change(SB.CameraChangePreEnd)})),e.addEventListener("end",(e=>{this._processControllerEndEvent(),this._change(SB.CameraChangeEnd)})),e.addEventListener("wheel",(e=>{null===t.distanceLimited&&this.enableAutoMoveTargetForward&&e.delta<0&&this._updateTargetByMoveForwardAction(5),this._dispatchChangingEvent(),this._change(SB.CameraChange)})),e.addEventListener("change",(e=>{this._dispatchChangingEvent(),this._change(SB.CameraChange)})),t.controller=e):t.controller&&(t.controller.dispose(),t.controller=null)}stopZoom(){this.object.lerp.stopTo(lU)}pan(e,t,r){void 0===r&&(r=500);var n=this.app.size,i=this.object,a=i.distance;a*=Math.tan(i.fov/2*Math.PI/180);var s=[0,0,0],o=QI.getVec3FromMatrixColumn(i.matrix,0);s=QI.addVector(s,QI.scaleVector(o,2*e*a/n[1]));var l=QI.getVec3FromMatrixColumn(i.matrix,1);s=QI.addVector(s,QI.scaleVector(l,2*t*a/n[1]));var u=QI.addVector(i.position,s),c=QI.addVector(i.target,s);r?i.lerp.to({from:{position:i.position,target:i.target},to:{position:u,target:c},duration:r},lU):(i.position=u,i.target=c)}zoom(e,t){if(void 0===t&&(t={}),e){var r=BI.parseValue(t.duration,BI.parseValue(t.time,500)),n=BI.parseValue(t.updateTarget,!0),i=this.object;switch(i.projectionType){case RB.Orthographic:var a=Math.abs(i.orthoDistance-e);if(r?i.lerp.to({to:{orthoDistance:a},duration:r},lU):i.orthoDistance=a,i.position=this._getSourcePositionByDistance(e),n){var s=QI.getDirection(i.position,i.target);i.target=QI.getPositionOnDirection(i.position,s,i.orthoDistance)}break;case RB.Perspective:var o=this._getSourcePositionByDistance(e);if(n){var l=this._getTargetPositionByDistance(e);r?i.lerp.to({from:{position:i.position,target:i.target},to:{position:o,target:l},duration:r},lU):(i.position=o,i.target=l)}else r?i.lerp.to({from:{position:i.position},to:{position:o},duration:r},lU):i.position=o}}}stop(){this[QL].controller.stop()}processAdjustNear(){var e=this.object;if(e){var t=e.distance;if(!(t<=10&&t>e.near)){var r=this._getDistanceToTargetInPickingMode();if(r){e.near=QI.max(.1,r/120)}}}}pickFromCrossPlanes(e,t){var r=this._pickFromCrossPlanes(e,t);if(!r.length)return null;var n=this.object;return r.sort(((e,t)=>n.distanceTo(e)-n.distanceTo(t))),r[0]}get isChanging(){return this[QL].flags.has(sU)}get stateGroup(){return this[QL].stateGroup}get enable(){return!1!==this[QL].stateGroup.getValue("default")}set enable(e){var t=this[QL];t.stateGroup.enable(e,"default",1e3),this._clearPickerState(),t.controller.update()}get enableAutoMoveTargetForward(){return this[QL].flags.has(eU)}set enableAutoMoveTargetForward(e){this[QL].flags.enable(eU,e)}get enableAdjustTargetPosition(){return this[QL].flags.has(tU)}set enableAdjustTargetPosition(e){this[QL].flags.enable(tU,e)&&this._enableAdjustTargetPosition(e)}get enableAdjustNear(){return this[QL].flags.has(rU)}set enableAdjustNear(e){var t=this[QL];if(t.flags.enable(rU,e))if(e){var r=this.object;t.intervalTimers.adjustNear=new Io({interval:.2,onInterval:()=>{if(r.isFlying||this.isChanging){var e=r.control.getTarget(_U);r.node.lookAt(e,r.up);var n=r.getWorldPosition(gU);t.crossPlanes.vertPlane.lookAt(n),this.processAdjustNear()}}})}else delete t.intervalTimers.adjustNear}get enableAdjustPanSpeed(){return this[QL].flags.has(nU)}set enableAdjustPanSpeed(e){var t=this[QL];if(t.flags.enable(nU,e))if(e){var r=this.object;t.intervalTimers.adjustPanSpeed=new Io({interval:.5,onInterval:()=>{(r.isFlying||this.isChanging)&&this._processAdjustPanSpeed()}})}else delete t.intervalTimers.adjustPanSpeed}get adjustCallbacks(){return this[QL].adjustCallbacks}set adjustCallbacks(e){this[QL].adjustCallbacks=e}get enableZoomToMouseCursorOnWheel(){return this[QL].flags.has(iU)}set enableZoomToMouseCursorOnWheel(e){this[QL].flags.enable(iU,e)&&this._enableZoomToMouseCursorOnWheel(e)}get enablePickWhenChanging(){return this[QL].flags.has(aU)}set enablePickWhenChanging(e){this[QL].flags.enable(aU,e),e&&this.object.app.picker.stateGroup.enable(!0,pU,-1e4)}get enableDamping(){return this[QL].flags.has(KL)}set enableDamping(e){this[QL].flags.enable(KL,e)&&this.getController().enable("Damping",e)}get enableRotate(){return this[QL].flags.has(YL)}set enableRotate(e){this[QL].flags.enable(YL,e)&&this.getController().enable("Rotate",e)}get enablePan(){return this[QL].flags.has(ZL)}set enablePan(e){this[QL].flags.enable(ZL,e)&&this.getController().enable("Pan",e)}get enableZoom(){return this[QL].flags.has(JL)}set enableZoom(e){this[QL].flags.enable(JL,e)&&this.getController().enable("Zoom",e)}get enableMapControl(){return this[QL].flags.has($L)}set enableMapControl(e){this[QL].flags.enable($L,e)&&this.getController().enable("MapControl",e)}get dampingFactor(){return this.getController().getDampingFactor()}set dampingFactor(e){this.getController().setDampingFactor(e)}get zoomSpeed(){return this.getController().getZoomSpeed()}set zoomSpeed(e){this.getController().setZoomSpeed(e)}get rotateSpeed(){return this.getController().getRotateSpeed()}set rotateSpeed(e){this.getController().setRotateSpeed(e)}get panSpeed(){return this.getController().getPanSpeed()}set panSpeed(e){this.getController().setPanSpeed(e)}get keyPanSpeed(){return this.getController().getKeyPanSpeed()}set keyPanSpeed(e){this.getController().setKeyPanSpeed(e)}get zoomToMouseCursorOnWheelSpeed(){return this[QL].zoomToMouseCursorOnWheelSpeed}set zoomToMouseCursorOnWheelSpeed(e){this[QL].zoomToMouseCursorOnWheelSpeed=e}get distanceLimited(){return this[QL].distanceLimited}set distanceLimited(e){var t=this[QL],r=t.controller;e?(t.distanceLimited=e.slice(0),r.setMinDistance(e[0]),r.setMaxDistance(e[1])):(t.distanceLimited=null,r.setMinDistance(1e-5),r.setMaxDistance(1/0))}get vertAngleLimit(){var e=this[QL].controller,t=QI.radToDeg(e.getMinPolarAngle()),r=QI.radToDeg(e.getMaxPolarAngle());return[Math.min(t,r),Math.max(t,r)]}set vertAngleLimit(e){var t=this[QL],r=e[0],n=e[1],i=t.controller;i.setMinPolarAngle(QI.degToRad(Math.min(r,n))),i.setMaxPolarAngle(QI.degToRad(Math.max(r,n)))}get horzAngleLimit(){var e=this[QL].controller,t=QI.radToDeg(e.getMinAzimuthAngle()),r=QI.radToDeg(e.getMaxAzimuthAngle());return[Math.min(t,r),Math.max(t,r)]}set horzAngleLimit(e){var t=this[QL],r=e[0],n=e[1],i=t.controller;i.setMinAzimuthAngle(QI.degToRad(Math.min(r,n))),i.setMaxAzimuthAngle(QI.degToRad(Math.max(r,n)))}get boundary(){var e=this.getController();if(!e)return null;var t={center:[0,0,0],halfSize:[0,0,0]};return e.getBoundary(t)?t:null}set boundary(e){var t=this[QL],r=this.getController();if(r)if(e){var n=e.halfSize;if(!n)return void BI.error("Set camera control boundary failed, due to halfSize is invalid");var i=e.center||this.getTarget();r.setBoundary({center:i,halfSize:n}),t.boundary={min:QI.subVector(i,n),max:QI.addVector(i,n)}}else t.boundary=null,r.setBoundary(null)}get upDirection(){var e=this.getController();if(!e)return null;return e.getUpDirection([])}set upDirection(e){var t=this.getController();t&&t.setUpDirection(e)}get target(){return this.getTarget()}set target(e){this.setTarget(e)}get distance(){return this.object.getWorldPosition(gU),this.getTarget(_U),QI.vec3.distance(gU,_U)}get screenSpacePanning(){return this.getController().getScreenSpacePanning()}set screenSpacePanning(e){this.getController().setScreenSpacePanning(e)}}xU.exportProperties=["enable","enableAutoMoveTargetForward","enableAdjustTargetPosition","enableAdjustNear","enableAdjustPanSpeed","enableZoomToMouseCursorOnWheel","enableDamping","enableRotate","enablePan","enableZoom","enableMapControl","dampingFactor","zoomSpeed","rotateSpeed","panSpeed","keyPanSpeed","zoomToMouseCursorOnWheelSpeed","distanceLimited","vertAngleLimit","horzAngleLimit","boundary","target","distance","screenSpacePanning"],xU.exportFunctions=["pan","zoom"];var bU=Symbol("private"),AU=1;class SU extends vr{constructor(e){void 0===e&&(e={}),super(),this[bU]={};var t=this[bU];t.uuid=zu.generateUUID(),t.flags=new Wt,t.pendingPromise=null,t.external=BI.parseValue(e.extras||e.external,null),t.context=null,t.complete=BI.parseValue(e.onComplete,e.complete)}onDispose(){var e=this[bU];e.context&&(e.context.dispose(),e.context=null),e.pendingPromise=null}onNotifyComplete(){var e=this[bU],t=e.pendingPromise;t&&(this.refCount?t.resolve(this):t.reject()),e.flags.set(AU,!0),e.complete&&(e.complete({image:this}),e.complete=null)}onNotifyError(e){var t=this[bU];t.pendingPromise=t.pendingPromise||new Rt,t.pendingPromise.reject(e)}dispose(){this.release()}unloadResource(){if(this.loaded){var e=this[bU];e.flags.enable(AU,!1),e.pendingPromise=null}}waitForComplete(){if(this.loaded)return Promise.resolve(this);var e=this[bU];return e.pendingPromise=e.pendingPromise||new Rt,e.pendingPromise}setContext(e){this[bU].context=e}toString(){return this[bU].uuid}get pendingPromise(){return this[bU].pendingPromise}set pendingPromise(e){this[bU].pendingPromise=e}get disposed(){return 0==this.refCount}get external(){return this[bU].external}get uuid(){return this[bU].uuid}get loaded(){return this[bU].flags.has(AU)}get context(){return this[bU].context}get isBaseResource(){return!0}}var EU=Symbol("private");class wU extends SU{constructor(e){void 0===e&&(e={}),super(e),this[EU]={};var t=this[EU],r=BI.getCurrentApp();t.colorFormat=BI.parseValue(e.colorFormat,$B.RGBA),t.anisotropy=BI.parseValue(e.anisotropy,r.renderCapabilities.maxAnisotropy),t.wrapTypeS=BI.parseValue(e.wrapTypeS||e.wrapType,tI.Repeat),t.wrapTypeT=BI.parseValue(e.wrapTypeT||e.wrapType,tI.Repeat),t.mappingType=BI.parseValue(e.mappingType,rI.UV),t.minFilterType=BI.parseValue(e.minFilterType,nI.LinearMipmapLinearFilter),t.magFilterType=BI.parseValue(e.magFilterType,nI.LinearFilter),t.flipY=BI.parseValue(e.flipY,!0),t.premultiplyAlpha=BI.parseValue(e.premultiplyAlpha,!1),t.generateMipmaps=BI.parseValue(e.generateMipmaps,!0),t.onUpdateSampler=e.onUpdateSampler}_updateSampler(){var e=this[EU],t=e.onUpdateSampler;t&&t(this,{minFilter:e.minFilterType,magFilter:e.magFilterType,wrapS:e.wrapTypeS,wrapT:e.wrapTypeT})}_updateTextureResource(){var e=this[EU],t=this.context;t&&(t.setWrapS(e.wrapTypeS),t.setWrapT(e.wrapTypeT),t.setMapping(e.mappingType),t.setColorFormat(e.colorFormat),t.setAnisotropy(e.anisotropy),t.setMinFilter(e.minFilterType),t.setMagFilter(e.magFilterType),t.enable("FlipY",e.flipY),t.enable("PremultiplyAlpha",e.premultiplyAlpha),t.enable("GenerateMipmaps",e.generateMipmaps))}onCreateTextureResource(){}getTextureResource(){return this.context||(this.setContext(this.onCreateTextureResource()),this._updateTextureResource()),this.context}copy(e){var t=this[EU];return t.colorFormat=e.colorFormat,t.anisotropy=e.anisotropy,t.wrapTypeS=e.wrapTypeS,t.wrapTypeT=e.wrapTypeT,t.mappingType=e.mappingType,t.minFilterType=e.minFilterType,t.magFilterType=e.magFilterType,t.flipY=e.flipY,t.premultiplyAlpha=e.premultiplyAlpha,t.generateMipmaps=e.generateMipmaps,this._updateSampler(),this}get textureResource(){return this.context}get onUpdateSampler(){return this[EU].onUpdateSampler}set onUpdateSampler(e){this[EU].onUpdateSampler=e}get colorFormat(){return this[EU].colorFormat}set colorFormat(e){this[EU].colorFormat=e,this._updateTextureResource()}get anisotropy(){return this[EU].anisotropy}set anisotropy(e){this[EU].anisotropy=e,this._updateTextureResource()}get wrapTypeS(){return this[EU].wrapTypeS}set wrapTypeS(e){this[EU].wrapTypeS=e,this._updateTextureResource(),this._updateSampler()}get wrapTypeT(){return this[EU].wrapTypeT}set wrapTypeT(e){this[EU].wrapTypeT=e,this._updateTextureResource(),this._updateSampler()}set wrapType(e){var t=this[EU];t.wrapTypeS=e,t.wrapTypeT=e,this._updateTextureResource(),this._updateSampler()}get mappingType(){return this[EU].mappingType}set mappingType(e){this[EU].mappingType=e,this._updateTextureResource()}get minFilterType(){return this[EU].minFilterType}set minFilterType(e){this[EU].minFilterType=e,this._updateTextureResource(),this._updateSampler()}get magFilterType(){return this[EU].magFilterType}set magFilterType(e){this[EU].magFilterType=e,this._updateTextureResource(),this._updateSampler()}get flipY(){return this[EU].flipY}set flipY(e){this[EU].flipY=e,this._updateTextureResource()}get premultiplyAlpha(){return this[EU].premultiplyAlpha}set premultiplyAlpha(e){this[EU].premultiplyAlpha=e,this._updateTextureResource()}get generateMipmaps(){return this[EU].generateMipmaps}set generateMipmaps(e){this[EU].generateMipmaps=e,this._updateTextureResource()}get isBaseTexture(){return!0}}class CU extends wU{constructor(e){void 0===e&&(e={}),super(e),this._onUpdateUrl=e.onUpdateUrl,this.onLoad(e)}_updateUrl(){var e=this._onUpdateUrl;e&&e(this,this._url)}_isCompressed(e){var t=this._image;if(t)return void 0!==t.format;var r=e=>"basis"==e._getExtension();if(e){if(BI.isArray(e)){for(var n=0;n<e.length;n++)if(!r(e[n]))return!1;return!0}return r(e)}return!1}onLoad(e){}_setUrl(e){e&&(this.unloadResource(),this._url=e,this._updateUrl(),this.pendingPromise&&(this.pendingPromise.reject(),this.pendingPromise=null),this.onLoad({url:e,onLoad:()=>{this.textureResource&&(BI.isArray(e)?this.textureResource.setImages(this._image):this.textureResource.setImage(this._image))}}))}_fixColorFomat(e){e.format&&(this.colorFormat=e.format)}_fixMinFilterType(e){if(e.format===$B.BC7_M6_OPAQUE_ONLY)this.minFilterType=nI.LinearMipmapLinearFilter;else{if(!this.generateMipmaps)return;var t=e.mipmaps;if(t&&1!==t.length)return;this.minFilterType=nI.LinearMipmapLinearFilter}}onTriggerErrorEvent(e){if(e){var t;if(e.target)t={desc:"Load '"+e.target.src+"' image texture failed"};else t=e;this.onNotifyError(t)}}onFixupFromImage(e){this._fixColorFomat(e),this._fixMinFilterType(e)}copy(e){return super.copy(e),this._setUrl(e.url),this}clone(){var e=new ImageTexture;return e.copy(this),e}toUniform(){return{key:this._url,value:this.getTextureResource()}}get onUpdateUrl(){return this._onUpdateUrl}set onUpdateUrl(e){e&&(this._onUpdateUrl=e)}get url(){return this._url}set url(e){this._setUrl(e)}}class TU extends CU{constructor(e){void 0===e&&(e={}),super(e)}onLoad(e){var t=BI.parseValue(e.onLoad,null);this._updateUrl(),this.flipY=BI.parseValue(e.flipY,!1),this.wrapType=BI.parseValue(e.wrapType,tI.ClampToEdge),this.mappingType=BI.parseValue(e.mappingType,rI.CubeReflection);var r=BI.parseValue(e.data,null);r?this._loadImages(r,t):this._parseUrl(e)}_parseUrl(e){var t=e.url,r=BI.parseValue(e.onLoad,null);if(BI.isObject(t))t.negx&&t.negy&&t.negz&&t.posx&&t.posy&&t.posz&&(e.url=[t.posx,t.negx,t.posy,t.negy,t.posz,t.negz]);else if(BI.isString(t)&&!BI.isImagePath(t)){var n=t+"/";"/"!==t.charAt(t.length-1)&&"\\"!==t.slice(t.length-1,t.length-2)||(n=t),e={url:[n+"posx.jpg",n+"negx.jpg",n+"posy.jpg",n+"negy.jpg",n+"posz.jpg",n+"negz.jpg"]}}if((BI.isArray(e)||BI.isString(e))&&(e={url:e}),this._url=e.url,BI.isArray(this._url)){var i=[];this._url.forEach((e=>{i.push(BI.loadImageFileAsync(e))})),Promise.all(i).then((e=>{this._loadImages(e,r)}),(e=>{this.onTriggerErrorEvent(e)}))}else BI.isString(this._url)&&this._loadImageFile()}_loadImages(e,t){this._image=e,this._image.length>0&&this._image.forEach((e=>{e.format&&(this.colorFormat=e.format)})),t&&t({images:this}),this.onNotifyComplete()}_loadImageFile(){BI.loadImageFile(this._url,(e=>{this._image=e,this.onFixupFromImage(e),onLoad&&onLoad({images:this}),this.onNotifyComplete()}),(e=>{}),(e=>{this.onTriggerErrorEvent(e)}),{flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,generateMipmaps:this.generateMipmaps,extensions:BI.getCurrentApp().view.getExtensions()})}onCreateTextureResource(){var e=this._image;if(e)return BI.createObject("CubeTextureResource",{data:e});var t=BI.isString(this._url)?"CompressedImage":"ArrayImage",r=BI.createObject("CubeTextureResource",{textureType:t});return this.waitForComplete().then((e=>{r.setImages(e.resource)})),r}getImageByIndex(){return this.textureResource.getImageByIndex(index)}get resource(){return this._image}set resource(e){this._image=e,this.textureResource&&this.textureResource.setImages(e)}get urls(){return this._url}set urls(e){this._setUrl(e)}get isCubeTexture(){return!0}}let DU=class extends CU{constructor(e){if(void 0===e&&(e={}),BI.isArray(e)||BI.isArray(e.url))return console.warn("Please create cube texture with THING.CubeTexture instead of THING.ImageTexture"),new TU(e);super(e)}onLoad(e){BI.isString(e)?e={url:e}:void 0!==e.width&&void 0!==e.height&&(e={resource:e});var t=e.url;if(e.type&&e.data)this._url=t,this._loadFromData(e);else if(t)this._loadFromURL(e);else{var r=e.wrapType;r?this.wrapType=r:(this.wrapTypeS=BI.parseValue(e.wrapTypeS,this.wrapTypeS),this.wrapTypeT=BI.parseValue(e.wrapTypeT,this.wrapTypeT)),this.mappingType=BI.parseValue(e.mappingType,this.mappingType),this.flipY=BI.parseValue(e.flipY,this.flipY);var n=e.data;if(n){var i=e.width,a=e.height;this._image={width:i,height:a,data:n}}else this._image=BI.parseValue(e.resource,null);this._image&&this.onNotifyComplete()}}_loadFromURL(e){var t=BI.parseValue(e.onLoad,null);this._url=e.url,this._updateUrl(),this.wrapType=BI.parseValue(e.wrapType,tI.Repeat),this.mappingType=BI.parseValue(e.mappingType,rI.UV),this.flipY=BI.parseValue(e.flipY,!0),BI.loadImageFile(this._url,(e=>{this._image=e,this.onFixupFromImage(e),t&&t({image:this}),this.onNotifyComplete()}),(e=>{}),(e=>{this.onTriggerErrorEvent(e)}),{flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,generateMipmaps:this.generateMipmaps,extensions:BI.getCurrentApp().view.getExtensions()})}_loadFromData(e){var{type:t,data:r}=e,n=BI.parseValue(e.onLoad,null);this.wrapType=BI.parseValue(e.wrapType,tI.Repeat),this.mappingType=BI.parseValue(e.mappingType,rI.UV),this.flipY=BI.parseValue(e.flipY,!0),BI.loadImageFileFromData(t,r,(e=>{this._image=e,this.onFixupFromImage(e),n&&n({image:this}),this.onNotifyComplete()}),(e=>{}),(e=>{BI.error(e)}),{extensions:BI.getCurrentApp().view.getExtensions()})}onDispose(){this._image=null,super.onDispose()}onCreateTextureResource(){this._isCompressed(this._url)&&(this.flipY=!1,this.generateMipmaps=!1);var e=this._image;if(e)return BI.createObject("ImageTextureResource",{data:e,external:this.external});var t=BI.createObject("ImageTextureResource",{textureType:"HTMLElement",external:this.external});return this.waitForComplete().then((e=>{t.setImage(e.resource)})).catch((e=>{this.onTriggerErrorEvent(e)})),t}get src(){var e=this._image;return e&&e.src?e.src:this._url}set dirty(e){var t=this.textureResource;t&&t.refresh()}get width(){var e=this._image;if(!e)return 0;if(e.width)return e.width;if(void 0!==e.complete)return e.width;if(BI.isArray(e))for(var t=0;t<e.length;t++)if(e[t].complete)return e[t].width;return 0}get height(){var e=this._image;if(!e)return 0;if(e.height)return e.height;if(void 0!==e.complete)return e.height;if(BI.isArray(e))for(var t=0;t<e.length;t++)if(e[t].complete)return e[t].height;return 0}get resource(){return this._image}set resource(e){this._image=e,this.textureResource&&this.textureResource.setImage(e),this.onNotifyComplete()}get flipY(){return!this._isCompressed(this._url)&&super.flipY}set flipY(e){e&&this._isCompressed(this._url)||(super.flipY=e)}get generateMipmaps(){return!this._isCompressed(this._url)&&super.generateMipmaps}set generateMipmaps(e){e&&this._isCompressed(this._url)||(super.generateMipmaps=e)}get isImageTexture(){return!0}};var MU=Symbol("private");class PU extends vk{constructor(){super(),this[MU]={};var e=this[MU];e.backgroundImage=null,e.background=null}onRemove(){var e=this[MU];e.background&&e.background.isImageTexture&&e.background.release(),e.background=null,super.onRemove()}onCopy(e){this.background=e.background}get background(){return this[MU].background}set background(e){var t=this[MU],r=this.object.node;t.background&&t.background.isImageTexture&&t.background.release(),e?e.isImageTexture||e.isCubeTexture?(t.background=e,t.background.addRef(),t.background.waitForComplete().then((e=>{t.background==e&&r.setBackground("Texture",e.getTextureResource())}))):BI.isString(e)?(t.backgroundImage&&(t.backgroundImage.release(),t.backgroundImage=null),BI.isColorString(e)?(t.background=BI.parseColor(e,[1,1,1]),r.setBackground("Color",t.background)):(t.backgroundImage=new DU(e),this.background=t.backgroundImage)):(BI.isNumber(e)||BI.isArray(e))&&(t.background=BI.parseColor(e,[1,1,1]),r.setBackground("Color",t.background)):(t.background=null,r.clearBackground())}}PU.exportProperties=["background"];var FU=Symbol("private");class RU extends vk{constructor(){super(),this[FU]={};var e=this[FU];e.needsRefresh=!1,e.temporalSuperSampling={enable:!1,size:30},e.bloom={enable:!1,strength:.14,radius:.4,threshold:.7},e.screenSpaceAmbientOcclusion={enable:!1,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},e.screenSpaceReflection={enable:!1,maxRayDistance:200,pixelStride:16,pixelStrideZCutoff:50,screenEdgeFadeStart:.9,eyeFadeStart:.4,eyeFadeEnd:.8,minGlossiness:.2},e.colorCorrection={enable:!0,exposure:0,brightness:0,contrast:1.1,saturation:1.1,gamma:1},e.dof={enable:!1,focalDepth:1,focalLength:24,fstop:.9,maxblur:1,threshold:.9,gain:1,bias:.5,dithering:1e-4},e.vignetting={enable:!1,color:[0,0,0],offset:1.5},e.blurEdge={enable:!1,offset:1},e.film={enable:!1,grayscale:!1,noiseIntensity:.35,scanlinesIntensity:0,scanlinesCount:2048},e.chromaticAberration={enable:!1,chromaFactor:.025},e.FXAA={enable:!1},e.MSAA={enable:!0},e.onChange=null,e.objectProxy=new ur({data:{enable:!0,bloom:e.bloom,screenSpaceAmbientOcclusion:e.screenSpaceAmbientOcclusion,screenSpaceReflection:e.screenSpaceReflection,colorCorrection:e.colorCorrection,dof:e.dof,vignetting:e.vignetting,blurEdge:e.blurEdge,film:e.film,chromaticAberration:e.chromaticAberration,FXAA:e.FXAA,MSAA:e.MSAA,temporalSuperSampling:e.temporalSuperSampling},onConvertValue:function(e,t){if("color"==e)return BI.parseColor(t,[1,1,1])},onChange:function(t){e.needsRefresh=!0,e.onChange&&e.onChange(t)}}),this._refresh(),Object.defineProperty(this,"customFormatters",{enumerable:!1,configurable:!1,get:function(){return["object",{object:e.objectProxy.dataProxy}]}})}_refresh(){var e=this.object;if(e){var t=this[FU];t.needsRefresh&&(t.needsRefresh=!1,e.node.setPostEffect({temporalSuperSampling:t.temporalSuperSampling,postEffect:{enable:t.objectProxy.dataProxy.enable,bloom:t.bloom,screenSpaceAmbientOcclusion:t.screenSpaceAmbientOcclusion,screenSpaceReflection:t.screenSpaceReflection,colorCorrection:t.colorCorrection,dof:t.dof,vignetting:t.vignetting,blurEdge:t.blurEdge,film:t.film,chromaticAberration:t.chromaticAberration,FXAA:t.FXAA,MSAA:t.MSAA}}))}}onAdd(e){super.onAdd(e),this.app.addBeforeRenderCallback(this._onBeforeRenderCallback=()=>{this._refresh()})}onRemove(){this[FU].objectProxy.dispose(),this.app.removeBeforeRenderCallback(this._onBeforeRenderCallback),super.onRemove()}onCopy(e){this.config=e.config}get enable(){return this[FU].objectProxy.dataProxy.enable}set enable(e){var t=this[FU];t.objectProxy.dataProxy.enable!=e&&(t.objectProxy.dataProxy.enable=e,this._refresh())}get temporalSuperSampling(){return this[FU].objectProxy.dataProxy.temporalSuperSampling}get bloom(){return this[FU].objectProxy.dataProxy.bloom}get screenSpaceAmbientOcclusion(){return this[FU].objectProxy.dataProxy.screenSpaceAmbientOcclusion}get screenSpaceReflection(){return this[FU].objectProxy.dataProxy.screenSpaceReflection}get colorCorrection(){return this[FU].objectProxy.dataProxy.colorCorrection}get dof(){return this[FU].objectProxy.dataProxy.dof}get vignetting(){return this[FU].objectProxy.dataProxy.vignetting}get blurEdge(){return this[FU].objectProxy.dataProxy.blurEdge}get film(){return this[FU].objectProxy.dataProxy.film}get chromaticAberration(){return this[FU].objectProxy.dataProxy.chromaticAberration}get FXAA(){return this[FU].objectProxy.dataProxy.FXAA}get MSAA(){return this[FU].objectProxy.dataProxy.MSAA}get config(){return this[FU].objectProxy.dataProxy}set config(e){void 0===e&&(e={});var t=this[FU].objectProxy.dataProxy;BI.isValid(e.enable)&&(t.enable=e.enable),BI.mergeObject(t.bloom,e.bloom,!0),BI.mergeObject(t.screenSpaceAmbientOcclusion,e.screenSpaceAmbientOcclusion,!0),BI.mergeObject(t.screenSpaceReflection,e.screenSpaceReflection,!0),BI.mergeObject(t.colorCorrection,e.colorCorrection,!0),BI.mergeObject(t.dof,e.dof,!0),BI.mergeObject(t.vignetting,e.vignetting,!0),BI.mergeObject(t.blurEdge,e.blurEdge,!0),BI.mergeObject(t.film,e.film,!0),BI.mergeObject(t.chromaticAberration,e.chromaticAberration,!0),BI.mergeObject(t.FXAA,e.FXAA,!0),BI.mergeObject(t.MSAA,e.MSAA,!0),BI.mergeObject(t.temporalSuperSampling,e.temporalSuperSampling,!0)}get onChange(){return this[FU].onChange}set onChange(e){this[FU].onChange=e}}var NU=Symbol("private"),BU=QI.createVec3(),IU=QI.createVec3();class OU extends vk{constructor(){super(),this[NU]={},this[NU].pickFuncName="pickFromGPU"}_getAdjustedPosition(e,t){var r=this.app.delegate.getAttribute("Style");if(r){var n=r.transform;if(n){var i=n.scale;i&&(e/=i[0],t/=i[1])}}return[e,t]}intersectObjectInRegion(e,t){var r=e[0],n=e[1],i=e[2],a=e[3];return this.object.node.intersectNodeInRegion([r,n,i,a],t.bodyNode)}pick(e,t,r){var n=this[NU],i=this.app,a=this.object.node,s=n.pickFuncName,o=this._getAdjustedPosition(e,t),l=r||i.scene.root,u=a[s](o,l);if(!u)return null;var c={object:i.objectManager.getBaseObjectFromNode(u.node),subNodeName:u.subNodeName,external:{}};return void 0!==u.pickedId&&(c.pickedId=u.pickedId),Object.defineProperties(c,{position:{get:()=>u.position},normal:{get:()=>u.normal}}),c}pickFromCrossPlanes(e,t){return{position:this.object.control.pickFromCrossPlanes(e,t),object:null,pickedId:null,external:null}}intersectPlane(e,t,r,n){void 0===r&&(r=[0,1,0]),void 0===n&&(n=0);var i,a,s=this.object;if("Orthographic"===s.projectionType)i=s.screenToWorld([e,t,(s.near+s.far)/(s.near-s.far)]),a=QI.transformDirection([0,0,-1],s.matrixWorld);else{var o=s.screenToWorld([e,t,0],BU);i=s.getWorldPosition(IU),a=QI.normalizeVector(QI.subVector(o,i))}return QI.intersectPlane(i,a,r,n)}get pickType(){switch(this[NU].pickFuncName){case"pickFromGPU":return zB.GPU;case"pick":return zB.Raycaster}return null}set pickType(e){var t=this[NU];switch(e){case zB.GPU:t.pickFuncName="pickFromGPU";break;case zB.Raycaster:t.pickFuncName="pick"}}}OU.exportProperties=["pickType"];class kU extends vk{constructor(){super()}onAdd(e){super.onAdd(e)}onRemove(){super.onRemove()}get events(){var e=this.object.eventManager.getAllEventListeners();return{activatedEvents:e.filter((e=>!e.paused)),pausedEvents:e.filter((e=>!!e.paused))}}get objects(){var e=this.object.objectManager,t=[];return e.objects.forEach((e=>{t.push(e)})),{objects:t,tickableObjects:e.tickableObjects,resizableObjects:e.resizableObjects,dirtyObjects:e.dirtyObjects}}get info(){return{events:this.events,objects:this.objects}}}var LU={wrapS:tI.Repeat,wrapT:tI.Repeat};class UU extends vk{constructor(){super(),this._imageTexture=null,this._info=null}load(e,t,r){var n=this.object,i=e.extras||e.external,a={};i&&i.modelOptions&&Object.assign(a,i.modelOptions),n.resource.nodeName&&(a.nodeName=n.resource.nodeName),a.texture&&(this._imageTexture=this.app.resourceManager.getTextureManager().load(a.texture,LU,{flipY:a.flipY}),a.image=this._imageTexture.getTextureResource());var s=this,o=a.onBeforeSetup;n.app.resourceManager.loadObjectResource(n,a,{onBeforeSetup:e=>{o&&o(e)},onSetup:e=>{var t=e.info;this._info=t},onLoad:()=>{s._imageTexture?s._imageTexture.waitForComplete().then(t,r):t()},onError:e=>{r(e)}})}onBeforeRemove(){this._unloadImageTexture()}onUnloadResource(){this._unloadImageTexture()}_unloadImageTexture(){this._imageTexture&&(this._imageTexture.release(),this._imageTexture=null)}get info(){return this._info}}var zU=Symbol("private"),jU=1,VU="__LevelManager_object_destroy_event";class GU{constructor(){this[zU]={};var e=this[zU];e.enable=!0,e.pendingPromises=[],e.changeOptions=null,e.prev=null,e.current=null,e.leavingObject=null,e.enteringObject=null,e.flags=new Wt,e.onFilterPath=null,e.app=BI.getCurrentApp(),e.levelControls={},e.app.on(SB.BeforeDestroy,"*",(t=>{e.current==t.object&&this.quit()}),VU)}_notifyEvent(e,t){var r=this[zU].app,n=t.current;n!=r.root&&(r.trigger(e,t),n!=r.root&&n.trigger(e,t))}_notifyComplete(e,t){var r=this[zU];r.changeOptions=null,r.pendingPromises.length=0,r.flags.enable(jU,!1);var n={prev:r.prev,current:r.current,path:t},i=BI.parseValue(e.onComplete,e.complete);i&&i(n),r.app.trigger(SB.CompleteEnterLevel,n),r.current.trigger(SB.CompleteEnterLevel,n)}_enterObjectLevel(e,t,r,n){var i=this[zU];return i.enteringObject=e,this._registerLevelActions(e),e.level.enter({path:r,origin:n,prev:i.prev,current:i.current,next:null,options:t}).then((()=>{e.level.finish({path:r,origin:n,prev:i.prev,current:i.current,next:null,options:t}),e==r[r.length-1]&&this._notifyComplete(t,r),i.enteringObject=null}))}_cancelCurrentAction(){var e=this[zU].current;e&&(e.destroyed||e.actionGroup.stop(sI.EnterLevel))}_changeObject(e,t,r,n){var i=this[zU];return new E(((a,s,o)=>{var l=null,u=null;o((()=>{l&&l.cancel(),u&&u.cancel()})),i.flags.enable(jU,!0),i.current&&!i.current.destroyed&&i.current!=i.leavingObject?(i.leavingObject=i.current,this._notifyEvent(SB.BeforeLeaveLevel,this._generateEventParam(r,n,e,t)),l=i.current.level.leave(this._generateEventParam(r,n,e,t)).then((()=>{this._notifyEvent(SB.AfterLeaveLevel,this._generateEventParam(r,n,e,t)),i.leavingObject=null}))):l=E.resolve(),l.then((()=>{i.prev=i.current,i.current=e,e.destroyed?a():(this._notifyEvent(SB.BeforeEnterLevel,this._generateEventParam(r,n,null,t)),u=this._enterObjectLevel(e,t,r,n).then((()=>{a(),this._notifyEvent(SB.AfterEnterLevel,this._generateEventParam(r,n,null,t))})))}))}))}_generateEventParam(e,t,r,n){var i=this[zU];return{path:e,origin:t,prev:i.prev,current:i.current,next:r,options:n}}_startToChange(e,t){var r=this[zU],n=r.onFilterPath;n&&(e=n(e)||e);var i=r.current;e.forEachAsync((n=>{var a=this._changeObject(n,t,e,i);return r.pendingPromises.push(a),a}))}_change(e,t){var r=this[zU].current;if(r!=e)if(r&&!r.destroyed){var n=r.getPathTo(e)||app.root.getPathTo(e);this._startToChange(n,t)}else{var i=e.parents.reverse();i.push(e),this._startToChange(i,t)}}_cancelPendingPromises(e){var t=this[zU];t.pendingPromises.forEach((e=>{e.cancel()}));var r=t.changeOptions;if(r){var n=BI.parseValue(r.onStop,r.stop);n&&n(),t.changeOptions=null}t.changeOptions=e,t.pendingPromises.length=0,this._cancelCurrentAction()}_createCancelablePromise(e,t){return new E(((r,n,i)=>{i((()=>{})),this._change(e,{onComplete:function(e){var n=BI.parseValue(t.onComplete,t.complete);n&&n(e),r("onComplete")},onStop:function(e){var n=BI.parseValue(t.onStop,t.stop);n&&n(e),r("onStop")}})}))}_registerLevelActions(e){if(!e.destroyed){var t=this,r=e.actionGroup.add(sI.EnterLevel);r.actions.length||(e.level.onLeaveAsync=function(r,n,i){e.actionGroup.stop(sI.EnterLevel);var a=t._getLevelControls(e),s={target:r.current,object:e,options:r};a.forEach((e=>{e.control.onLeave(s)})),n()},e.level.onEnterAsync=function(r,n,i){var a={target:r.current,object:e,options:r},s=[];s.push(e.actionGroup.run(sI.EnterLevel,a));var o=t._getLevelControls(e),l=new Promise(((e,r)=>{t._runLevelControls(o,a,e,r)}));s.push(l),Promise.all(s).then((()=>{n(a)}),i)},e.trigger(SB.RegisterLevelAction,{actionQueue:r}))}}_getLevelControls(e){for(var t=[],r=this[zU].levelControls,n=Object.keys(r),i=0;i<n.length;i++){var a=n[i];if(e.test(a)){var s=r[a];t.push(...s)}}return t}_runLevelControls(e,t,r,n){return pB((function*(){try{for(var i=0;i<e.length;i++){var a=e[i];a&&a.control&&(yield a.control.onEnter(t))}r()}catch(e){n(e)}}))()}dispose(){var e=this[zU];e.app.off(SB.AfterDestroy,"*",VU),this._cancelPendingPromises(null),e.flags.clear(),e.prev=null,e.current=null}change(e,t){if(void 0===t&&(t={}),e){var r=this[zU];if(r.enable)r.current!=e&&(this._cancelPendingPromises(t),this._change(e,t))}}changeAsync(e,t){void 0===t&&(t={});var r=this[zU];if(r.current==e)return Promise.resolve();this._cancelPendingPromises(t);var n=this._createCancelablePromise(e,t);return r.pendingPromises.push(n),n}back(e){void 0===e&&(e={});var t=this[zU].current;if(t){var r=t.parent;r&&!r.isRootObject&&(this._cancelPendingPromises(e),this._change(r,e))}}backAsync(e){void 0===e&&(e={});var t=this[zU],r=t.current;if(!r)return Promise.resolve();var n=r.parent;if(!n||n.isRootObject)return Promise.resolve();this._cancelPendingPromises(e);var i=this._createCancelablePromise(n,e);return t.pendingPromises.push(i),i}quit(){var e=this[zU];if(this._cancelPendingPromises(null),e.flags.clear(),e.current){var t={origin:null,prev:e.prev,current:e.current,next:null};return this._notifyEvent(SB.BeforeLeaveLevel,t),e.current.level.leave({path:[e.current],origin:null,prev:null,current:e.current,next:null}).then((()=>{this._notifyEvent(SB.AfterLeaveLevel,t),e.prev=null,e.current=null}))}return Promise.resolve()}register(e,t,r){void 0===r&&(r={});var n=this[zU],i=n.levelControls[e];i||(i=n.levelControls[e]=[]);for(var a=r.priority||0,s={control:t,tag:r.tag,priority:a},o=0;o<i.length;o++){if(i[o].priority<a)return void i.splice(o,0,s)}i.push(s)}unregister(e,t){if(e){var r=this[zU],n=r.levelControls[e];if(n)if(t)for(var i=n.length-1;i>=0;i--){n[i].tag===t&&n.splice(i,1)}else r.levelControls[e].length=0}}get enable(){return this[zU].enable}set enable(e){this[zU].enable=e}get onFilterPath(){return this[zU].onFilterPath}set onFilterPath(e){this[zU].onFilterPath=e}get prev(){return this[zU].prev}get current(){return this[zU].current}get isChanging(){return this[zU].flags.has(jU)}}class WU extends aL{constructor(){super()}onNotifyChange(){var e=this.object;e.created&&(e.projectionType==RB.Orthographic&&(e.orthoDistance=e.distance),super.onNotifyChange())}onLookAt(e,t){this.object.control.getController().setTargetWorldPosition(e)}}var HU="__flyingAction__";class qU extends jL{constructor(){super()}flyTo(e,t){void 0===e&&(e={});var r=this.object.control;if(r.enable&&r.stateGroup){var n=this.app.picker;e=BI.parseFlyParam(e);var i=BI.parseValue(e.onStart,e.start),a=BI.parseValue(e.onStop,e.stop),s=BI.parseValue(e.onResume,e.resume),o=BI.parseValue(e.onPause,e.pause),l=BI.parseValue(e.onComplete,e.complete);e.onStart=function(){r.stateGroup.enable(!1,HU,1e4),n.stateGroup.enable(!1,HU,1e4),i&&i()},e.onStop=function(){r.stateGroup.enable(!0,HU,0),n.stateGroup.enable(!0,HU,0),a&&a()},e.onResume=function(){r.stateGroup.enable(!1,HU,1e4),n.stateGroup.enable(!1,HU,1e4),s&&s()},e.onPause=function(){r.stateGroup.enable(!0,HU,0),n.stateGroup.enable(!0,HU,0),o&&o()},e.onComplete=function(){r.stateGroup.enable(!0,HU,0),n.stateGroup.enable(!0,HU,0),l&&l()};var u=this.object.control.getController();u.stopDamping&&u.stopDamping(),super.flyTo(e,t),e.onStart=i,e.onStop=a,e.onResume=s,e.onPause=o,e.onComplete=l}else super.flyTo(e,t)}}var XU=Symbol("private");class QU extends Bk{constructor(){super(),this[XU]={};var e=this[XU];e.points=[],e.colors=[],e.lineSegments=null}onAdd(e){super.onAdd(e);var t=this[XU];t.lineSegments=BI.createObject("LineSegments"),t.lineSegments.setAttribute("Pickable",!1),t.lineSegments.getUserData()[AB.BoundingBoxInheritType]=qB.Stop,t.lineSegments.setVisible(!1),this.object.body.createRootNode(),this.object.node.add(t.lineSegments)}onRemove(){super.onRemove(),this[XU].lineSegments.dispose()}addPoint(e,t){var r=this[XU];r.points.push(e),r.colors.push(t)}addLine(e,t,r){this.addPoint(e,r),this.addPoint(t,r)}begin(){}end(){var e=this.object;e.body.createRootNode(),e.node.add(this.lineSegments),this.lineSegments.setSize(3*this.points.length),this.lineSegments.setPoints(this.points),this.lineSegments.setColors(this.colors)}get visible(){return this[XU].lineSegments.getVisible()}set visible(e){this[XU].lineSegments.setVisible(e)}get points(){return this[XU].points}get colors(){return this[XU].colors}get lineSegments(){return this[XU].lineSegments}}var KU=Symbol("private"),YU=QI.createVec3(),ZU=QI.createVec3(),JU=QI.createMat4();class $U extends QU{constructor(){super(),this[KU]={};var e=this[KU];e.pointsMap={},e.targetNode=null}_addPoint(e,t){var r=this[KU];r.pointsMap[e]=r.pointsMap[e]||[],r.pointsMap[e].push(this.points.length),this.addPoint([0,0,0],t)}_addLine(e,t,r){this._addPoint(e,r),this._addPoint(t,r)}_setPoint(e,t,r,n,i){var a=this[KU].pointsMap[e];if(a){QI.vec3.set(YU,r,n,i),QI.vec3.transformMat4(YU,YU,t);for(var s=0,o=a.length;s<o;s++){var l=a[s],u=this.points[l];u[0]=YU[0],u[1]=YU[1],u[2]=YU[2]}}}_createTargetNode(){var e=this[KU];this.app.global.waitForComplete().then((()=>{e.targetNode=this.app.global.cache.models.box.clone(),e.targetNode.setScale([.25,.25,.25]),e.targetNode.setVisible(!0),BI.markAsDebugNode(e.targetNode),this.object.body.createRootNode(),this.object.node.add(e.targetNode);var t=e.targetNode.getStyle();t.setColorOp((()=>[1,0,0])),t.setOutlineColor([0,1,1])}))}_updateCameraView(){this.object.node.getProjectionMatrix(JU),QI.mat4.invert(JU,JU);this._setPoint("c",JU,0,0,-1),this._setPoint("t",JU,0,0,1),this._setPoint("n1",JU,-1,-1,-1),this._setPoint("n2",JU,1,-1,-1),this._setPoint("n3",JU,-1,1,-1),this._setPoint("n4",JU,1,1,-1),this._setPoint("f1",JU,-1,-1,1),this._setPoint("f2",JU,1,-1,1),this._setPoint("f3",JU,-1,1,1),this._setPoint("f4",JU,1,1,1),this._setPoint("u1",JU,.7,1.1,-1),this._setPoint("u2",JU,-.7,1.1,-1),this._setPoint("u3",JU,0,2,-1),this._setPoint("cf1",JU,-1,0,1),this._setPoint("cf2",JU,1,0,1),this._setPoint("cf3",JU,0,-1,1),this._setPoint("cf4",JU,0,1,1),this._setPoint("cn1",JU,-1,0,-1),this._setPoint("cn2",JU,1,0,-1),this._setPoint("cn3",JU,0,-1,-1),this._setPoint("cn4",JU,0,1,-1),this.lineSegments.setPoints(this.points)}_updateTargetNode(){var e=this[KU].targetNode;if(e){var t=this.object.control.getTarget(ZU);e.setWorldPosition(t)}}onUpdate(e){this._updateCameraView(),this._updateTargetNode()}onAdd(e){super.onAdd(e);var t=BI.parseColor(16755200),r=BI.parseColor(16711680),n=BI.parseColor(43775),i=BI.parseColor(16777215),a=BI.parseColor(3355443);this._addLine("n1","n2",t),this._addLine("n2","n4",t),this._addLine("n4","n3",t),this._addLine("n3","n1",t),this._addLine("f1","f2",t),this._addLine("f2","f4",t),this._addLine("f4","f3",t),this._addLine("f3","f1",t),this._addLine("n1","f1",t),this._addLine("n2","f2",t),this._addLine("n3","f3",t),this._addLine("n4","f4",t),this._addLine("p","n1",r),this._addLine("p","n2",r),this._addLine("p","n3",r),this._addLine("p","n4",r),this._addLine("u1","u2",n),this._addLine("u2","u3",n),this._addLine("u3","u1",n),this._addLine("c","t",i),this._addLine("p","c",a),this._addLine("cn1","cn2",a),this._addLine("cn3","cn4",a),this._addLine("cf1","cf2",a),this._addLine("cf3","cf4",a),this.lineSegments.setSize(3*this.points.length),this.lineSegments.setColors(this.colors),this.lineSegments.setVisible(!1),BI.markAsDebugNode(this.lineSegments)}onRemove(){this.showTarget(!1),super.onRemove()}showPicker(e){void 0===e&&(e=!0);var t=this.object.node;e?t.setDebuggerType("GPUPick"):t.setDebuggerType(null)}showTarget(e){void 0===e&&(e=!0);var t=this[KU];e?this._createTargetNode():t.targetNode&&(t.targetNode.dispose(),t.targetNode=null)}get visible(){return this.lineSegments.getVisible()}set visible(e){this.lineSegments.setVisible(e)}}var ez=Symbol("private"),tz=QI.createMat4(),rz=QI.createMat4();class nz extends Vk{constructor(){super(),this[ez]={};var e=this[ez];e.distanceFactor=2,e.frustum=new sc}get distanceFactor(){return this[ez].distanceFactor}set distanceFactor(e){this[ez].distanceFactor=e}get lightSphere(){var e=this[ez],t=this.object,r=t.node;r.getMatrixWorld(tz),r.getProjectionMatrix(rz);var n=t.distance*e.distanceFactor;e.frustum.setFromProjectionMatrix(rz,n);var i=e.frustum.getBoundingSphere(tz);return{center:i.center,radius:i.radius}}}var iz=Symbol("private"),az=["glow","innerGlow","tailing","radial","ghosting","lineBloom"];class sz extends vk{constructor(){super(),this[iz]={};var e=this[iz];e.needsRefresh=!1,e.glow={enable:!0,strength:1.5,threshold:.001,radius:.4},e.innerGlow={color:[1,0,0,1],enable:!0,strength:2,stride:10},e.tailing={enable:!0,direction:[0,1],center:[.5,.5]},e.radial={enable:!0,center:[.5,.5]},e.ghosting={enable:!0,center:[.5,.5]},e.lineBloom={enable:!0,blendRate:.7,blurSize:1,strength:1},e.onChange=null,e.enable=!1,e.objectProxy=new ur({data:{glow:e.glow,innerGlow:e.innerGlow,tailing:e.tailing,radial:e.radial,ghosting:e.ghosting,lineBloom:e.lineBloom},onChange:function(t){e.needsRefresh=!0,e.onChange&&e.onChange(t)}}),Object.defineProperty(this,"customFormatters",{enumerable:!1,configurable:!1,get:function(){return["object",{object:e.objectProxy.dataProxy}]}})}_refreshEffect(){var e=this[iz],t=this.object.node;t.setEffect("glow",e.glow),t.setEffect("innerGlow",e.innerGlow),t.setEffect("tailing",e.tailing),t.setEffect("radial",e.radial),t.setEffect("ghosting",e.ghosting),t.setEffect("lineBloom",e.lineBloom),e.enable||az.forEach((e=>{t.setEffect(e,{enable:!1})}))}_refresh(){var e=this[iz];e.needsRefresh&&(e.needsRefresh=!1,this._refreshEffect())}onAdd(e){super.onAdd(e),this.app.addBeforeRenderCallback(this._onBeforeRenderCallback=()=>{this._refresh()}),this._refreshEffect()}onRemove(){this[iz].objectProxy.dispose(),this.app.removeBeforeRenderCallback(this._onBeforeRenderCallback),super.onRemove()}get enable(){return this[iz].enable}set enable(e){var t=this[iz];t.enable!=e&&(t.enable=e,this._refreshEffect())}get glow(){return this[iz].objectProxy.dataProxy.glow}get innerGlow(){return this[iz].objectProxy.dataProxy.innerGlow}get tailing(){return this[iz].objectProxy.dataProxy.tailing}get radial(){return this[iz].objectProxy.dataProxy.radial}get ghosting(){return this[iz].objectProxy.dataProxy.ghosting}get lineBloom(){return this[iz].objectProxy.dataProxy.lineBloom}get config(){return this[iz].objectProxy.dataProxy}set config(e){void 0===e&&(e={});var t=this[iz].objectProxy.dataProxy;BI.mergeObject(t.glow,e.glow,!0),BI.mergeObject(t.innerGlow,e.innerGlow,!0),BI.mergeObject(t.tailing,e.tailing,!0),BI.mergeObject(t.radial,e.radial,!0),BI.mergeObject(t.ghosting,e.ghosting,!0),BI.mergeObject(t.lineBloom,e.lineBloom,!0)}get onChange(){return this[iz].onChange}set onChange(e){this[iz].onChange=e}}var oz=Symbol("private");class lz extends vk{constructor(){super(),this[oz]={};var e=this[oz];e.needsRefresh=!1,e.objectProxy=new ur({data:{enable:!1,type:VB.Linear,near:1,far:1e3,color:[1,1,1],density:25e-5},onChange:function(t){e.needsRefresh=!0}}),this._refresh(),Object.defineProperty(this,"customFormatters",{enumerable:!1,configurable:!1,get:function(){return["object",{object:e.objectProxy.dataProxy}]}})}_refresh(){var e=this.object;if(e){var t=this[oz];t.needsRefresh&&(t.needsRefresh=!1,e.node.setFog(t.objectProxy.data))}}onAdd(e){super.onAdd(e),this.app.addBeforeRenderCallback(this._onBeforeRenderCallback=()=>{this._refresh()})}onRemove(){this[oz].objectProxy.dispose(),this.app.removeBeforeRenderCallback(this._onBeforeRenderCallback),super.onRemove()}get enable(){return this[oz].objectProxy.dataProxy.enable}set enable(e){var t=this[oz].objectProxy.dataProxy;t.enable!=e&&(t.enable=e,this._refresh())}get type(){return this[oz].objectProxy.dataProxy.type}set type(e){var t=this[oz].objectProxy.dataProxy;t.type!=e&&(t.type=e,this._refresh())}get near(){return this[oz].objectProxy.dataProxy.near}set near(e){var t=this[oz].objectProxy.dataProxy;t.near!=e&&(t.near=e,this._refresh())}get far(){return this[oz].objectProxy.dataProxy.far}set far(e){var t=this[oz].objectProxy.dataProxy;t.far!=e&&(t.far=e,this._refresh())}get density(){return this[oz].objectProxy.dataProxy.density}set density(e){var t=this[oz].objectProxy.dataProxy;t.density!=e&&(t.density=e,this._refresh())}get color(){return this[oz].objectProxy.dataProxy.color}set color(e){e&&(this[oz].objectProxy.dataProxy.color=BI.parseColor(e),this._refresh())}get config(){return this[oz].objectProxy.dataProxy}set config(e){var t=this[oz].objectProxy.dataProxy;t.enable=BI.parseValue(e.enable,t.enable)}}var uz="__cEnableViewportTag__";class cz extends vk{constructor(){super()}get enable(){return this.object.hasEvent(SB.EnableViewport,uz)}set enable(e){e?this.object.on(SB.EnableViewport,(e=>{var t=this.object.control.stateGroup;e.value?t.enable(!0,"changeCamera"):t.enable(!1,"changeCamera",1e5)}),uz):this.object.off(SB.EnableViewport,uz)}}class hz extends wU{constructor(e){void 0===e&&(e={}),super(e)}get colorFormat(){return super.colorFormat}set colorFormat(e){BI.error("Set colorFormat failed, due to can not change it at runtime")}get anisotropy(){return super.anisotropy}set anisotropy(e){BI.error("Set anisotropy failed, due to can not change it at runtime")}get wrapType(){return super.wrapType}set wrapType(e){BI.error("Set wrapType failed, due to can not change it at runtime")}get mappingType(){return super.mappingType}set mappingType(e){BI.error("Set mappingType failed, due to can not change it at runtime")}get minFilterType(){return super.minFilterType}set minFilterType(e){BI.error("Set minFilterType failed, due to can not change it at runtime")}get magFilterType(){return super.magFilterType}set magFilterType(e){BI.error("Set magFilterType failed, due to can not change it at runtime")}get flipY(){return super.flipY}set flipY(e){BI.error("Set flipY failed, due to can not change it at runtime")}get premultiplyAlpha(){return super.premultiplyAlpha}set premultiplyAlpha(e){BI.error("Set premultiplyAlpha failed, due to can not change it at runtime")}get generateMipmaps(){return super.generateMipmaps}set generateMipmaps(e){BI.error("Set generateMipmaps failed, due to can not change it at runtime")}get isBaseStaticTexture(){return!0}}var dz=Symbol("private");class pz extends hz{constructor(e){void 0===e&&(e={}),super(e),this[dz]={},this[dz].size=BI.parseArray(e.size,[1,1]),this.onNotifyComplete()}onDispose(){this[dz].resource=null,super.onDispose()}onCreateTextureResource(){var e=this[dz],t=BI.createObject("RenderTextureResource");return t.setSize(e.size),t}copy(e){return super.copy(e),this[dz].size=e.size,this}clone(){var e=new pz;return e.copy(this),e}download(e){var t=this[dz].size,r=t[0],n=t[1],i=BI.saveAsImage(r,n,this.pixelBuffer);BI.saveAsFile(e+".png",i,"png")}get size(){return this[dz].size.slice(0)}set size(e){var t=this[dz];t.size=e.slice(0),this.getTextureResource().setSize(t.size)}get pixelBuffer(){return this.getTextureResource().getPixelBuffer()}get isRenderTexture(){return!0}}var fz=Symbol("private"),mz=1,gz=2,_z=4,vz=8,yz=1,xz=new hk,bz=[],Az={};function Sz(e,t){t.queryable&&e.push(t)}class Ez extends Ck{constructor(e){void 0===e&&(e={}),super(),this[fz]={};var t=this[fz],r=BI.getCurrentApp();t.app=r,t.userData=null,t.type="",t.tempData=null,t.orderId=yz++,t.parent=null,t.children=null,t.proxyObject=null,this._name=BI.parseValue(e.name,""),this._id=BI.parseValue(e.id,""),this._uuid=e.uuid||QI.generateUUID(),this._flags=new Wt,this._flags.enable(_z,BI.parseValue(e.queryable,!0)),this._flags.enable(vz,BI.parseValue(e.destroyable,!0)),this.onSetupType(e),this.onBeforeSetup(e),this.onSetupParent(e),this.onSetupAsyncSelector(e),this.onSetupUserData(e),this.onAfterSetup(e),r.objectManager.addObject(this)}_removeFromParent(){var e=this[fz];if(e.parent){var t=e.parent.children,r=t.indexOf(this);-1!==r&&t.removeAt(r),e.parent=null}}_addEventListener(e,t,r,n,i,a,s){void 0===s&&(s=!1);var o=BI.parseEvent(e,t,r,n,i,a);return this.onParseEvent(o)?this.app.eventManager.addEventListener(o.type.toLowerCase(),this,o.condition,o.callback,o.tag,{once:s,priority:o.priority,useCapture:o.useCapture,enumerable:o.enumerable,pausable:o.pausable}):null}_getEventListener(e,t,r){return this.app.eventManager.getEventListener(e.toLowerCase(),this,t,r)}_removeEventListener(e,t,r){this.app.eventManager.removeEventListener(e.toLowerCase(),this,t,r)}_getUserData(){var e=this[fz],t=e.userData;return t||(hk.asyncSelector?e.userData=new ur({onChange:e=>{hk.updateObjectAttribute(this,"userData",e.data)}}):e.userData={},e.userData)}_getTempData(e){var t=this[fz];return t.tempData||(t.tempData={tickableCounter:0,resizableCounter:0},e&&e(t.tempData)),t.tempData}_getParentObject(e){var t=e.parent;return null===t?null:t||this.app.root}_isExpression(e){return!(!e._startsWith('"')&&!e._startsWith("'"))||(!!e._startsWith("#")||(!!e._startsWith(".")||(!(!e._startsWith("[")||!e._endsWith("]"))||(-1!==e.indexOf("||")||-1!==e.indexOf("|")||(-1!==e.indexOf("&&")||-1!==e.indexOf("&")||!(!e._startsWith("tags")||":"!==e[4]&&"("!==e[4]))))))}onAddTickableObject(){var e=this._getTempData();0===e.tickableCounter&&this.app.objectManager.addTickableObject(this),e.tickableCounter++}onAddResizableObject(){var e=this._getTempData();0===e.resizableCounter&&this.app.objectManager.addResizableObject(this),e.resizableCounter++}onRemoveTickableObject(){var e=this._getTempData();e.tickableCounter--,0===e.tickableCounter&&this.app.objectManager.removeTickableObject(this)}onRemoveResizableObject(){var e=this._getTempData();e.resizableCounter--,0===e.resizableCounter&&this.app.objectManager.removeResizableObject(this)}onBeforeSetup(e){}onAfterSetup(e){}onSetupType(e){var t=this[fz],r=this.__proto__,n=BI.getClassNameFromProto(r);if(t.type=n,r.__inherits=r.__inherits||{},!r.__inherits[n]){r.__inherits[n]=!0;var i={};Object.defineProperty(r,"__types",{enumerable:!1,configurable:!1,get:()=>i}),this.app.global.getClassNamesFromObject(this).forEach((e=>{i[e]=!0;var t="is"+e;this[t]||Object.defineProperty(r,t,{enumerable:!1,configurable:!1,get:()=>i[e]})}))}}onSetupParent(e){var t=this._getParentObject(e);t&&t.add(this,{attachMode:!1})}onSetupAsyncSelector(e){hk.addObject(this)}onSetupUserData(e){var t=e.userData;if(t){var r=this._getUserData();r.isObjectProxy?r.copy(t):Object.assign(r,t)}}onUpdate(e){var t=this.tickableComponents;if(t)for(var r=0,n=t.length;r<n;r++){var i=t[r];!1!==i.active&&i.onUpdate(e)}}onResize(e,t){var r=this.resizableComponents;if(r)for(var n=0,i=r.length;n<i;n++){r[n].onResize(e,t)}}onRefresh(){var e=this.refreshableComponents;if(e)for(var t=0,r=e.length;t<r;t++){e[t].onRefresh()}this._flags.enable(gz,!1)}onBeforeDestroy(){var e=this._flags;return!!e.has(vz)&&!e.has(mz)}onDestroy(){var e=this[fz];this.trigger(SB.BeforeDestroy);var t=e.parent;if(t){t.onBeforeRemoveChild(this);var r=t.children.indexOf(this);-1!==r&&t.children.splice(r,1),t.onAfterRemoveChild(this)}e.children&&(e.children.slice(0).forEach((e=>{e.destroy()})),e.children.clear());e.app.objectManager.removeObject(this),hk.removeObject(this),this.removeAllComponents(!0),this.clearAccessorInfo();var n=e.userData;n&&(n.isObjectProxy&&n.dispose(),e.userData=null),this.trigger(SB.AfterDestroy),e.parent=null,e.app.eventManager.removeAllEventListeners(this),this._flags.enable(mz,!0)}onAfterDestroy(){var e=this[fz];this._removeFromParent(),e.app.eventManager.resumeAllEvents(this),e.app=null}onParseEvent(e){return!0}onBeforeAddChild(e){this.components.forEach((t=>{t.onBeforeAddChild&&t.onBeforeAddChild(e)})),this.trigger(SB.BeforeAddChild,{child:e})}onAfterAddChild(e){this.components.forEach((t=>{t.onAfterAddChild&&t.onAfterAddChild(e)})),this.trigger(SB.AfterAddChild,{child:e})}onBeforeRemoveChild(e){this.components.forEach((t=>{t.onBeforeRemoveChild&&t.onBeforeRemoveChild(e)})),this.trigger(SB.BeforeRemoveChild,{child:e})}onAfterRemoveChild(e){this.components.forEach((t=>{t.onAfterRemoveChild&&t.onAfterRemoveChild(e)})),this.trigger(SB.AfterRemoveChild,{child:e})}onAddComponent(e,t){super.onAddComponent(e,t),(e.onUpdate||e.onRender)&&this.onAddTickableObject(),e.onResize&&this.onAddResizableObject()}onRemoveComponent(e){super.onRemoveComponent(e),(e.onUpdate||e.onRender)&&this.onRemoveTickableObject(),e.onResize&&this.onRemoveResizableObject()}hasAttribute(e,t){return void 0===t&&(t="/"),BI.hasAttribute(this,e,t)}getAttribute(e,t){return void 0===t&&(t="/"),BI.getAttribute(this,e,t)}setAttribute(e,t,r){void 0===r&&(r="/"),BI.setAttribute(this,e,t,r)}setAttributes(e,t,r){for(var n in void 0===e&&(e={}),void 0===t&&(t=!0),void 0===r&&(r="/"),e)(t||BI.isUndefined(this.getAttribute(n)))&&this.setAttribute(n,e[n],r);this.trigger(SB.ChangeAttributes,{attributes:e})}get app(){return this[fz].app}get type(){return this[fz].type}get orderId(){return this[fz].orderId}get name(){return this._name}set name(e){this._name=e,hk.updateObjectAttribute(this,"name",e)}get id(){return this._id}set id(e){this._id=e,hk.updateObjectAttribute(this,"id",e)}get uuid(){return this._uuid}set uuid(e){this._uuid=e,hk.updateObjectAttribute(this,"uuid",e)}get userData(){var e=this._getUserData();return e.isObjectProxy?e.dataProxy:e}set userData(e){var t=this._getUserData();t.isObjectProxy?t.copy(e):BI.copyObject(t,e)}getQueryable(){return this._flags.has(_z)}setQueryable(e,t){if(this._flags.enable(_z,e),hk.updateObjectAttribute(this,"queryable",e),t){var r=this[fz];if(r.children)for(var n=r.children,i=0,a=n.length;i<a;i++)n[i].setQueryable(e,!0)}}setDirty(){var e=this._flags;e.has(gz)||(e.enable(gz,!0),this.app.objectManager.addDirtyObject(this))}destroy(){return!1!==this.onBeforeDestroy()&&(this.onDestroy(),this.onAfterDestroy(),!0)}get flags(){return this._flags}get destroyed(){return this._flags.has(mz)}get queryable(){return this._flags.has(_z)}set queryable(e){this.setQueryable(e,!0)}hasEvent(e,t){bz.length=0;for(var r=this.app.eventManager.getEventListeners(e.toLowerCase(),this,bz),n=0;n<r.length;n++){var i=r[n];if(!i.removed&&t===i.tag)return!0}return!1}getEvents(e){var t,r=this.app.eventManager;t=e?r.getEventListeners(e.toLowerCase(),this):r.getAllEventListeners(this);var n=[];return t.forEach((e=>{e.removed||e.enumerable&&n.push(e)})),n}getEvent(e,t,r){e=e.toLowerCase();for(var n=this.getEvents(),i=0;i<n.length;i++){var a=n[i];if(a.type==e&&(a.condition==t&&a.tag==r))return a}return null}on(e,t,r,n,i,a){this._addEventListener(e,t,r,n,i,a,!1)}once(e,t,r,n,i,a){this._addEventListener(e,t,r,n,i,a,!0)}off(e,t,r){BI.isString(t)&&BI.isNull(r)?this._removeEventListener(e,null,t):this._removeEventListener(e,t,r)}pauseEvent(e,t,r){this.app.eventManager.pauseEvent(this,e,t,r)}resumeEvent(e,t,r){this.app.eventManager.resumeEvent(this,e,t,r)}trigger(e,t,r){return this.destroyed?null:this.app.eventManager.dispatchEvent(e.toLowerCase(),this,t,r)}getProxyObject(){return this[fz].proxyObject}setProxyObject(e){this[fz].proxyObject=e}get events(){return this.getEvents()}onSetParent(e){var t=this[fz];e!=t.parent&&(e&&e.addChild(this),this._removeFromParent(),t.parent=e)}getParent(){return this[fz].parent}getParentByType(e){for(var t="is"+e,r=this.parent;r;r=r.parent)if(r[t])return r;return null}getParents(e){void 0===e&&(e=Az);var t=this[fz],r=e.root,n=e.includeSelf,i=new hk;n&&i.push(this);for(var a=t.parent;a&&a!=r;)i.push(a),a=a.parent;return i}getBrothers(){var e=this[fz].parent;return e?e.children.filter((e=>e!==this)):new hk}getPathTo(e){if(!e)return null;if(this.isChildOf(e)){var t=this.getParents({root:e});return t.push(e),t}if(e.isChildOf(this)){var r=e.getParents({root:this}).reverse();return r.push(e),r}var n=e.parents.reverse(),i=this.parents.reverse();if(n.length&&i.length&&n[0]==i[0]){for(var a;n.length&&i.length&&n[0]==i[0];)a=i[0],n.splice(0,1),i.splice(0,1);if(a)return i.reverse().concat([a]).concat(n).concat(e)}return null}isChildOf(e){if(!e)return!1;for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1}isBrotherOf(e){return!!e&&this.parent==e.parent}addChild(e){var t=this[fz];t.children=t.children||new hk,t.children.push(e)}add(e){return!!e&&(this.onBeforeAddChild(e),e.onSetParent(this),this.onAfterAddChild(e),!0)}remove(e){return!!e&&(this.onBeforeRemoveChild(e),e.onSetParent(null),this.onAfterRemoveChild(e),!0)}traverse(e){e(this);var t=this[fz].children;if(t)for(var r=0,n=t.length;r<n;r++)t[r].traverse(e)}traverseBranch(e){var t=BI.parseBoolean(e(this),!0);if(!t)return!1;var r=this[fz].children;if(r)for(var n=0,i=r.length;n<i;n++)if(!(t=r[n].traverseBranch(e)))return!1;return!0}traverseParents(e){console.warn("Plase use Selector.tarverse instead of tarverseParents");for(var t=this.parent;t;t=t.parent)e(t)}traverseChildren(e){console.warn("Plase use Selector.tarverse instead of traverseChildren");var t=this[fz];if(t.children)for(var r=t.children,n=0,i=r.length;n<i;n++)r[n].traverse(e)}findChildren(e){var t=this[fz].children;if(t)for(var r=0,n=t.length;r<n;r++){var i=t[r];if(!0===e(i))return i;var a=i.findChildren(e);if(a)return a}return null}hasChildren(){return!!this[fz].children}addRelationship(e){this.relationship.addRelationship(e)}removeRelationship(e){this.relationship.removeRelationship(e)}get parent(){return this[fz].parent}set parent(e){e?e.add(this):this.parent&&this.parent.remove(this)}get relationships(){return this.relationship.relationships||[]}get parents(){return this.getParents()}get brothers(){return this.getBrothers()}get children(){return this[fz].children||xz}test(e){return hk.test(e,this)}query(e,t){void 0===t&&(t={});var r=t.dynamic?new _k(this,e):new hk,n=BI.parseValue(t.recursive,!0);t.includeSelf&&this.test(e)&&r.push(this);var i=this[fz];if(n)if(BI.isString(e))if("*"==e)this.children.traverse((e=>{Sz(r,e)}));else if(this._isExpression(e)){var a=hk.buildExpression(e);a&&this.children.traverse((e=>{hk.testByExpression(a,e)&&Sz(r,e)}))}else this.children.traverse((t=>{t.name==e&&Sz(r,t)}));else BI.isRegExp(e)?i.children&&this.children.traverse((t=>{hk.testByRegExpName(e,t)&&Sz(r,t)})):BI.isFunction(e)&&i.children&&this.children.traverse((t=>{hk.testByFunction(e,t)&&Sz(r,t)}));else r=i.children?i.children.query(e):new hk;return r}queryByName(e,t){return void 0===t&&(t={}),this._queryByCondition(e,t,"name")}queryByRegExp(e,t){return void 0===t&&(t={}),this.query(e,t)}queryByReg(e,t){return void 0===t&&(t={}),this.queryByRegExp(e,t)}queryByTags(e,t){return void 0===t&&(t={}),this._queryByCondition("tags("+e+")",t,"tags")}queryByUUID(e,t){return void 0===t&&(t={}),this._queryByCondition(e,t,"uuid")}queryById(e,t){return void 0===t&&(t={}),this._queryByCondition(e,t,"id")}queryByType(e,t){return void 0===t&&(t={}),this._queryByCondition(e,t,"type")}queryByUserData(e,t){return void 0===t&&(t={}),this._queryByCondition(e,t,"userData")}queryByData(e,t){return void 0===t&&(t={}),this.queryByUserData(e,t)}_queryByCondition(e,t,r){void 0===t&&(t={});var n=t.dynamic?new _k(this,e):new hk,i=BI.parseValue(t.recursive,!0);t.includeSelf&&this.test(e)&&n.push(this);var a=this[fz];if(i){if(BI.isString(e)){var s=hk.buildExpression(e,r);s&&this.children.traverse((e=>{hk.testByExpression(s,e)&&Sz(n,e)}))}}else n=a.children?a.children.query(e):new hk;return n}queryAsync(e,t){void 0===t&&(t={});var r=BI.parseValue(t.recursive,!0),n=t.includeSelf;return hk.queryAsync(e,this,r).then((t=>(n&&this.test(e)&&t.push(this),t)))}find(e,t){void 0===t&&(t={});var r=BI.parseValue(t.recursive,!0);if(t.includeSelf&&this.test(e))return this;var n=this[fz];if(r){if(BI.isString(e)){if("*"==e)return this.children[0];var i=hk.buildExpression(e);if(i)return this.findChildren((e=>hk.testByExpression(i,e)))}else if(BI.isRegExp(e)){if(n.children)return this.findChildren((t=>hk.testByRegExpName(e,t)))}else if(BI.isFunction(e)&&n.children)return this.findChildren((t=>hk.testByFunction(e,t)))}else if(n.children)return n.children.find(e);return null}get isBaseObject(){return!0}}var wz=QI.createVec3(),Cz=QI.createVec3(),Tz=QI.createQuat(),Dz=QI.createQuat(),Mz=QI.createVec3(),Pz=QI.createMat4(),Fz=QI.createMat4(),Rz=QI.createMat4();class Nz{constructor(e){void 0===e&&(e={});var t=e.node,r=e.renderableNode;this._name=t.name,this._position=[],this._quaternion=[],this._scale=[],QI.decomposeFromMat4(t.matrix,this._position,this._quaternion,this._scale),this._renderableNode=r,this._node=t}_updateMatrix(){var e=this._node,t=QI.composeToMat4(this._position,this._quaternion,this._scale,Pz);this._renderableNode.setSubNodeMatrix(e,t)}localToSelf(e,t){void 0===t&&(t=!1);var r=this.localToWorld(e,t);return this.worldToSelf(r,t)}selfToLocal(e,t){void 0===t&&(t=!1);var r=this.selfToWorld(e,t);return this.worldToLocal(r,t)}worldToSelf(e,t){return void 0===t&&(t=!1),QI.worldToSelf(this.matrixWorld,e,t)}selfToWorld(e,t){return void 0===t&&(t=!1),QI.selfToWorld(this.matrixWorld,e,t)}localToWorld(e,t){void 0===t&&(t=!1);var r=this._node.root;return r?r.selfToWorld(wz,e,t):e}worldToLocal(e,t){void 0===t&&(t=!1);var r=this._node.root;return r?r.worldToSelf(wz,e,t):e}get name(){return this._name}get node(){return this._node}get isRenderable(){return!!this._node.isRenderable}rotateX(e){var t=QI.getQuatFromAngles([e,0,0]);QI.quat.multiply(t,this._quaternion,t),this.localQuaternion=t}rotateY(e){var t=QI.getQuatFromAngles([0,e,0]);QI.quat.multiply(t,this._quaternion,t),this.localQuaternion=t}rotateZ(e){var t=QI.getQuatFromAngles([0,0,e]);QI.quat.multiply(t,this._quaternion,t),this.localQuaternion=t}get up(){var e=this.matrixWorld;return QI.normalizeVector([e[4],e[5],e[6]])}get forward(){var e=this.matrixWorld;return QI.normalizeVector([e[8],e[9],e[10]])}get cross(){var e=this.up,t=this.forward,r=[0,0,0];return QI.vec3.cross(r,e,t),QI.vec3.normalize(r,r),r}get localPosition(){return this._position}set localPosition(e){this._position=e.slice(0),this._updateMatrix()}get localQuaternion(){return this._quaternion}set localQuaternion(e){this._quaternion=e.slice(0),this._updateMatrix()}get localAngles(){return QI.getAnglesFromQuat(this.localQuaternion,Mz)}set localAngles(e){this.localQuaternion=QI.getQuatFromAngles(e,Dz)}get localScale(){return this._scale}set localScale(e){this._scale=e.slice(0),this._updateMatrix()}get position(){return QI.decomposeFromMat4(this.matrixWorld,wz,Tz,Cz),wz}set position(e){QI.decomposeFromMat4(this.matrixWorld,wz,Tz,Cz);var t=QI.composeToMat4(e,Tz,Cz,Rz);this.matrixWorld=t}get quaternion(){return QI.decomposeFromMat4(this.matrixWorld,wz,Tz,Cz),Tz}set quaternion(e){QI.decomposeFromMat4(this.matrixWorld,wz,Tz,Cz);var t=QI.composeToMat4(wz,e,Cz,Rz);this.matrixWorld=t}get angles(){return QI.getAnglesFromQuat(this.quaternion,Mz)}set angles(e){this.quaternion=QI.getQuatFromAngles(e,Dz)}get scale(){return QI.decomposeFromMat4(this.matrixWorld,wz,Tz,Cz),Cz}set scale(e){QI.decomposeFromMat4(this.matrixWorld,wz,Tz,Cz);var t=QI.composeToMat4(wz,Tz,e,Rz);this.matrixWorld=t}get matrix(){return this._node.matrix}set matrix(e){var t=this._node;this._renderableNode.setSubNodeMatrix(t,e),QI.decomposeFromMat4(e,this._position,this._quaternion,this._scale)}get matrixWorld(){var e=this._node,t=e.root;return t.updateMatrixWorld(),t.getMatrixWorld(Pz),QI.mat4.multiply(Pz,Pz,e.matrix).slice(0)}set matrixWorld(e){var t=this._node,r=t.root;r.updateMatrixWorld(),r.getMatrixWorld(Pz),QI.mat4.invert(Fz,Pz),QI.mat4.multiply(Fz,Fz,e),this._renderableNode.setSubNodeMatrix(t,Fz),QI.decomposeFromMat4(Fz,this._position,this._quaternion,this._scale)}get isSubNodeObject(){return Utils.warn("Please use .isNodeObject"),!0}get isNodeObject(){return!0}}class Bz{constructor(e){this._object=e,this._resource=null,this._needDisposeResource=!1,this._originalResource=null,this._clippingPlanes=null,Bz.dummyStyle=Bz.dummyStyle||BI.createObject("Style")}_releaseStyle(){if(this._resource){if(this._needDisposeResource)this._needDisposeResource=!1,this._object.app.resourceManager.getStyleGroupPool().releaseStyle(this._resource);this._resource=null}}onBegin(){var e=this._object.bodyNode,t=e.getStyle();this._resource||(this._needDisposeResource=!0,this._resource=BI.createObject("Style")),t!=this._resource&&(this._originalResource=t,this._resource.copy(t),this._resource.enable("InstancedDrawing",!1),e.setStyle(this._resource))}onEnd(){this._originalResource&&this._object.bodyNode.setStyle(this._originalResource)}onChangeColor(e,t){var r=this._resource;if("outlineColor"===e)r.setOutlineColor(t)}onChangeValue(e,t){var r=this._resource;switch(e){case"blendingType":r.setBlendingType(t);break;case"sideType":r.setSideType(t);break;case"transparent":r.setTransparent(t);break;case"wireframe":r.enable("Wireframe",t);break;case"depthTest":r.enable("DepthTest",t);break;case"depthWrite":r.enable("DepthWrite",t);break;case"envMapping":r.enable("EnvMap",t);break;case"clippingPlanes":this._clippingPlanes=t,this._clippingPlanes.addStyleResource(r)}}onChangeOpFunc(e,t){var r=this._resource;switch(e){case"opacity":r.setOpacityOp(t);break;case"color":r.setColorOp(t);break;case"emissive":r.setEmissiveOp(t);break;case"roughness":r.setRoughnessOp(t);break;case"metalness":r.setMetalnessOp(t)}}onChangeImage(e,t){this._resource.setImage(e,t),BI.isFunction(this._object.onChangeImage)&&this._object.onChangeImage()}onChangeUVMatrix(e,t){this._resource.setUVMatrix(e,t)}onChangeEdge(e){this._resource.setEdge(e)}onChangeEffect(e){var t=this._resource;t.setEffect("glow",e.glow),t.setEffect("innerGlow",e.innerGlow),t.setEffect("lineBloom",e.lineBloom),t.setEffect("tailing",e.tailing),t.setEffect("radial",e.radial),t.setEffect("ghosting",e.ghosting)}onChangeAttribute(e,t){this._resource.setAttribute(e,t)}onChangeUniformValue(e,t){if(t&&BI.isFunction(t.toUniform))if(BI.isFunction(t.waitForComplete))t.waitForComplete().then((()=>{if(this._resource){var r=t.toUniform().value;this._resource.setUniform(e,r)}}));else{var r=t.toUniform().value;this._resource.setUniform(e,r)}else this._resource.setUniform(e,t)}onChangeMacroValue(e,t){this._resource.defineMacro(e,t)}dispose(){if(this._clippingPlanes&&(this._clippingPlanes.removeStyleResource(this._resource),this._clippingPlanes=null),this._originalResource){var e=this._object.bodyNode,t=this._object.app.resourceManager.getStyleGroupPool();t.hasStyle(this._originalResource)?(e.setStyle(Bz.dummyStyle),t.releaseStyle(this._originalResource)):e.setStyle(this._originalResource),this._originalResource=null}this._releaseStyle()}initResource(e){this.dispose(),this._originalResource=e,this._object.bodyNode.setStyle(e)}updateResource(e){this._resource!=e&&(this._releaseStyle(),this._resource=e),this._object.bodyNode.setStyle(e)}get object(){return this._object}get originalResource(){return this._originalResource}get resource(){return this._resource}get isStyleModifier(){return!0}}Bz.dummyStyle=void 0;var Iz=Symbol("private"),Oz=QI.createVec3(),kz=QI.createVec3(),Lz=QI.createVec3(),Uz=QI.createQuat(),zz=QI.createMat4(),jz=QI.createMat4(),Vz={};class Gz{constructor(){this[Iz]={};var e=this[Iz];e.node=null,e.object=null,e.pivotNode=null,e.rootNode=null,e.renderableNode=null,e.style=null}_createParentNode(e,t){var r=BI.createObject("Node");r.setName(e),t.getParent()&&t.getParent().add(r),r.setMatrixWorld(t.getMatrixWorld(zz)),t.setMatrix(jz),r.add(t);var n=r.getUserData(),i=t.getUserData();for(var a in i)n[a]=i[a];return r}_updateNode(){var e=this[Iz];e.node=e.rootNode||e.pivotNode||e.renderableNode}_updateNodeOptions(e){void 0===e&&(e=Vz);var t=this[Iz].renderableNode,r=e.localScale;r&&(1==r[0]&&1==r[1]&&1==r[2]||(this.createRootNode(),QI.vec3.multiply(Oz,t.getScale(Oz),r),t.setScale(Oz)));var n=e.localPosition;n&&(0==n[0]&&0==n[1]&&0==n[2]||(this.createRootNode(),QI.vec3.add(Oz,t.getPosition(Oz),n),t.setPosition(Oz)));var i=e.localAngles;i&&(0==i[0]&&0==i[1]&&0==i[2]||(this.createRootNode(),QI.quat.multiply(Uz,t.getQuaternion(Uz),QI.getQuatFromAngles(i)),t.setQuaternion(Uz)))}_getNodeByName(e,t,r,n){var i=[];this[Iz].renderableNode.getSubNodes(i,t);for(var a=0;a<i.length;a++){var s=i[a];if((!r||r(s))&&s.name==e)return n?n(s):s}return null}dispose(){var e=this[Iz],t=this.getRenderableNode();t&&t.unbindSubNode(),e.style&&(e.style.dispose(),e.style=null),e.rootNode?e.rootNode.dispose():e.pivotNode?e.pivotNode.dispose():e.renderableNode&&e.renderableNode.dispose(),e.rootNode=null,e.pivotNode=null,e.renderableNode=null,e.node=null,e.object=null}init(e,t){void 0===t&&(t=Vz);var r=this[Iz];r.object=e;var n=t.node,i=t.rootNode,a=t.renderableNode;if(i||a)r.rootNode=i,r.renderableNode=a||i;else{var s=e.app.resourceManager.getNodePool();r.renderableNode=s?s.alloc():BI.createObject("Node"),n&&r.renderableNode.add(n)}this._updateNode();var o=t.body;o&&this._updateNodeOptions(o),r.node.getUserData().baseObject_orderID=r.object.orderId}translateOnAxis(e,t){QI.vec3.transformQuat(Oz,e,this.localQuaternion),QI.vec3.scale(Oz,Oz,t);var r=this.localPosition;this.localPosition=QI.addVector(r,Oz)}translateX(e){this.translateOnAxis(BI.xAxis,e)}translateY(e){this.translateOnAxis(BI.yAxis,e)}translateZ(e){this.translateOnAxis(BI.zAxis,e)}get visible(){return this[Iz].renderableNode.getVisible()}set visible(e){this[Iz].renderableNode.setVisible(e)}get localPosition(){return this[Iz].renderableNode.getPosition([0,0,0])}set localPosition(e){var t=this[Iz];this.createRootNode(),t.renderableNode.setPosition(e)}get localQuaternion(){return this[Iz].renderableNode.getQuaternion([0,0,0,1])}set localQuaternion(e){var t=this[Iz];this.createRootNode(),t.renderableNode.setQuaternion(e)}get localAngles(){var e=this[Iz];return QI.getAnglesFromQuat(e.renderableNode.getQuaternion([0,0,0,1]))}set localAngles(e){var t=this[Iz];this.createRootNode(),t.renderableNode.setQuaternion(QI.getQuatFromAngles(e))}get localScale(){return this[Iz].renderableNode.getScale([1,1,1])}set localScale(e){var t=this[Iz];this.createRootNode(),t.renderableNode.setScale(e)}get position(){return this[Iz].renderableNode.getWorldPosition([0,0,0])}set position(e){var t=this[Iz];this.createRootNode(),t.renderableNode.setWorldPosition(e)}get angles(){var e=this[Iz];return QI.getAnglesFromQuat(e.renderableNode.getWorldQuaternion([0,0,0,1]))}set angles(e){var t=this[Iz];this.createRootNode(),t.renderableNode.setWorldQuaternion(QI.getQuatFromAngles(e))}get scale(){return this[Iz].renderableNode.getWorldScale([1,1,1])}set scale(e){var t=this[Iz];this.createRootNode(),t.renderableNode.setWorldScale(e)}get matrix(){return this[Iz].renderableNode.getMatrix()}set matrix(e){var t=this[Iz];this.createRootNode(),t.renderableNode.setMatrix(e)}get matrixWorld(){return this[Iz].renderableNode.getMatrixWorld()}set matrixWorld(e){var t=this[Iz];this.createRootNode(),t.renderableNode.setMatrixWorld(e)}getLocalBoundingBox(){var e={center:[0,0,0],halfSize:[0,0,0]},t=this.getRenderableNode();return t.isRenderableNode?t.getLocalBoundingBox(e):t.getWorldPosition(e.center),e}createRootNode(){var e=this[Iz];if(!e.rootNode){var t=e.renderableNode;t.isRenderableNode?e.rootNode=this._createParentNode("root",t):e.rootNode=t,this._updateNode()}}clearPivotNode(){var e=this[Iz],t=e.pivotNode;if(t){var r=t.getParent();if(r)t.getChildren().slice(0).forEach((e=>{e.setPosition([0,0,0]),r.attach(e)})),r.remove(t);t.dispose(),e.pivotNode=null,this._updateNode()}}createPivotNode(){var e=this[Iz];if(!e.pivotNode){var t=e.renderableNode;e.pivotNode=this._createParentNode("pivot",t),this._updateNode()}return e.pivotNode}getPivotNode(){return this[Iz].pivotNode}getRootNode(){return this[Iz].rootNode}getRenderableNode(){return this[Iz].renderableNode}getNode(){return this[Iz].node}setNode(e){var t=this[Iz],r=t.renderableNode;r.getPosition(Oz),r.getScale(kz),r.getEuler(Lz);var n={parentNode:r.getParent(),name:r.getName(),userData:r.getUserData()};r.isRenderableNode&&(r.hasStyle()&&(n.style=r.getStyle()),n.visible=r.getVisible(),n.renderOrder=r.getRenderOrder(),n.castShadow=r.getCastShadow(),n.receiveShadow=r.getReceiveShadow(),n.layerMask=r.getLayerMask());var i=t.object.app.resourceManager.getNodePool();i?i.free(r):r.dispose(),r=e,t.renderableNode=e,r.setPosition(Oz),r.setScale(kz),r.setEuler(Lz),n.parentNode&&n.parentNode.add(r),r.setName(n.name),r.setUserData(n.userData),r.isRenderableNode&&(n.style&&t.object.body.style.updateResource(n.style),r.setVisible(n.visible),r.getRenderOrder()!=n.renderOrder&&r.setRenderOrder(n.renderOrder),r.getCastShadow()!=n.castShadow&&r.setCastShadow(n.castShadow),r.getReceiveShadow()!=n.receiveShadow&&r.setReceiveShadow(n.receiveShadow),r.getLayerMask()!=n.layerMask&&r.setLayerMask(n.layerMask)),this._updateNode()}updateNode(e){this[Iz].renderableNode=e,this._updateNode()}unloadResource(e){var t=this[Iz],r=t.renderableNode;if(r){var n,i=r.getUserData(),a=r.getParent(),s=r.getVisible(),o=r.getType(),l=r.getName(),u=r.getMatrix(zz);r.isRenderableNode&&(n=r.getStyle()),r.dispose(),(r=e(o)).setName(l),a.add(r),r.setMatrix(u),r.setUserData(i),r.setVisible(s),n&&r.setStyle(n),t.renderableNode=r,this._updateNode()}}getGeometryInfo(){return this.getRenderableNode().getGeometryInfo()}traverseNodes(e){var t=this[Iz],r=[];t.renderableNode.getSubNodes(r,t.node),r.forEach((r=>{var n=new Nz({renderableNode:t.renderableNode,node:r});e(n)}))}get nodes(){var e=this[Iz],t=[];e.renderableNode.getSubNodes(t,e.node);var r=t.sort((function(e,t){return t.depth-e.depth})).map((t=>new Nz({renderableNode:e.renderableNode,node:t})));return r}get renderableNodes(){var e=this[Iz],t=[];e.renderableNode.getSubNodes(t,e.node);var r=t.filter((e=>e.isRenderable)).sort((function(e,t){return t.depth-e.depth})).map((t=>new Nz({renderableNode:e.renderableNode,node:t})));return r}get nodeNames(){var e=[];this[Iz].renderableNode.getSubNodes(e,null);var t=e.sort((function(e,t){return t.depth-e.depth})).map((e=>e.name));return t}getNodeByName(e){var t=this[Iz];return this._getNodeByName(e,t.node,null,(e=>new Nz({renderableNode:t.renderableNode,node:e})))}promoteNode(e,t){var r=this._getNodeByName(e,null);return r?t.attachSubNode(r,{keepLocalTransform:!0}):null}hasStyle(){return!!this[Iz].style}getStyle(){var e=this[Iz];if(!e.style){if(!this.getRenderableNode().isRenderableNode)return null;e.style=new ek(new Bz(e.object))}return e.style}setStyle(e){if(e){var t=this.getStyle();t!=e&&t.copy(e)}}get style(){return this.getStyle()}set style(e){this.setStyle(e)}}var Wz=Symbol("private");class Hz extends Mk{constructor(e){void 0===e&&(e={}),super(e),this[Wz]={},this[Wz].object=e.object}onLateUpdate(e){var t=this[Wz].object.collider.areaInfo.transform,r=t.min,n=t.max,i=[[r[0],r[1],r[2]],[n[0],r[1],r[2]],[n[0],r[1],n[2]],[r[0],r[1],n[2]],[r[0],n[1],r[2]],[n[0],n[1],r[2]],[n[0],n[1],n[2]],[r[0],n[1],n[2]]];this.begin(),this.buildBox(i),this.end(),super.onLateUpdate(e)}get object(){return this[Wz].object}}class qz extends Dk{buildSphere(e){for(var{xData:t,yData:r,zData:n}=e,i=0;i<t.length-1;i++)this._insertLine(t[i],t[i+1]);for(var a=0;a<r.length-1;a++)this._insertLine(r[a],r[a+1]);for(var s=0;s<n.length-1;s++)this._insertLine(n[s],n[s+1])}end(e){var t=this.private,r=t.lines;r.setSize(t.points.length);var n=QI.getCenterFromPoints(e);r.setPosition(n),r.setPoints(t.points),r.setColors(t.colors)}}var Xz=Symbol("private");class Qz extends qz{constructor(e){void 0===e&&(e={}),super(e),this[Xz]={};var t=this[Xz];t.object=e.object,t.segements=e.segements||32}onLateUpdate(e){var t=this[Xz].object.collider.areaInfo.transform,r=t.min,n=t.max,i=QI.getDistance(r,n)/2,a=this.sphereData(i);this.begin(),this.buildSphere(a),this.end([r,n]),super.onLateUpdate(e)}sphereData(e){for(var t=this[Xz],r=[],n=[],i=[],a=0;a<=t.segements;a++){var s=a/t.segements*360,o=QI.getQuatFromAxisAngle([0,0,1],s);r.push(QI.vec3ApplyQuat([e,0,0],o));var l=QI.getQuatFromAxisAngle([1,0,0],s);n.push(QI.vec3ApplyQuat([0,e,0],l));var u=QI.getQuatFromAxisAngle([0,1,0],s);i.push(QI.vec3ApplyQuat([0,0,e],u))}return{xData:r,yData:n,zData:i}}get object(){return this[Xz].object}get segements(){return this[Xz].segements}set segements(e){this[Xz].segements=e}}var Kz=Symbol("private"),Yz=zu.createVec3(),Zz=zu.createVec3(),Jz=zu.createVec3(),$z=zu.createVec3(),ej=zu.createVec3(),tj=zu.createVec3(),rj=zu.createVec3(),nj=zu.createVec3(),ij=zu.vec3;class aj extends vk{constructor(){super(),this[Kz]={};var e=this[Kz];e.enable=!0,e.visible=!1,e.helper=null,e.eventDispatcher=new Ut,this._radius=.5,this._halfSize=null,this._offset=[0,0,0],this._mode=oI.Box;var t=[-this._radius,-this._radius,-this._radius],r=[this._radius,this._radius,this._radius];this._matrixWorld=null,this._areaInfo={base:{min:t,max:r},local:[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],t[1],r[2]],[t[0],t[1],r[2]],[t[0],r[1],t[2]],[r[0],r[1],t[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]],transform:{min:t.slice(0),max:r.slice(0)}}}_createHelper(){var e=this[Kz];switch(this._mode){case oI.Box:e.helper=new Hz({object:this.object}),this.app.scene.rootObjects.debug.node.add(e.helper.lines);break;case oI.Sphere:e.helper=new Qz({object:this.object}),this.app.scene.rootObjects.debug.node.add(e.helper.lines)}}_disposeHelper(){var e=this[Kz];e.helper&&(e.helper.dispose(),e.helper=null)}_refreshHelper(){this._disposeHelper(),this._createHelper()}_refreshAreaInfo(){var e=this._areaInfo,t=[],r=[];zu.vec3.add(t,e.base.min,this._offset),zu.vec3.add(r,e.base.max,this._offset),e.local=[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],t[1],r[2]],[t[0],t[1],r[2]],[t[0],r[1],t[2]],[r[0],r[1],t[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}onBeforeRemove(){this.enable=!1,this.visible=!1}onColliderEnter(e){this[Kz].eventDispatcher.dispatchEvent({type:SB.ColliderEnter.toLowerCase(),object:e.object})}onColliderLeave(e){this[Kz].eventDispatcher.dispatchEvent({type:SB.ColliderLeave.toLowerCase(),object:e.object})}addEventListener(e,t){this[Kz].eventDispatcher.addEventListener(e.toLowerCase(),t)}removeEventListener(e,t){this[Kz].eventDispatcher.removeEventListener(e.toLowerCase(),t)}test(e){switch(this._mode){case oI.Box:var t=this._areaInfo.transform,r=e._areaInfo.transform;return zu.intersectsBox(t.min,t.max,r.min,r.max);case oI.Sphere:var n=this._matrixWorld,i=e._matrixWorld,a=n[12]-i[12],s=n[13]-i[13],o=n[14]-i[14],l=.5*Math.sqrt(a*a+s*s+o*o);if(l<this._radius||l<e._radius)return!0}return!1}setMatrixWorld(e){this._matrixWorld=e;var t=this._areaInfo,r=t.transform.min,n=t.transform.max;r[0]=r[1]=r[2]=1/0,n[0]=n[1]=n[2]=-1/0;var i=this._areaInfo.local;ij.transformMat4(Yz,i[0],this._matrixWorld),ij.min(r,r,Yz),ij.max(n,n,Yz),ij.transformMat4(Zz,i[1],this._matrixWorld),ij.min(r,r,Zz),ij.max(n,n,Zz),ij.transformMat4(Jz,i[2],this._matrixWorld),ij.min(r,r,Jz),ij.max(n,n,Jz),ij.transformMat4($z,i[3],this._matrixWorld),ij.min(r,r,$z),ij.max(n,n,$z),ij.transformMat4(ej,i[4],this._matrixWorld),ij.min(r,r,ej),ij.max(n,n,ej),ij.transformMat4(tj,i[5],this._matrixWorld),ij.min(r,r,tj),ij.max(n,n,tj),ij.transformMat4(rj,i[6],this._matrixWorld),ij.min(r,r,rj),ij.max(n,n,rj),ij.transformMat4(nj,i[7],this._matrixWorld),ij.min(r,r,nj),ij.max(n,n,nj)}get enable(){return this[Kz].enable}set enable(e){this[Kz].enable=e,e?this.object.app.colliderManager.add(this):this.object.app.colliderManager.remove(this)}get mode(){return this._mode}set mode(e){var t=this[Kz];this._mode!=e&&(this._mode=e,t.visible&&this._refreshHelper())}get radius(){return this._radius}set radius(e){this._radius=e}get offset(){return this._offset}set offset(e){this._offset=e?e.slice(0):[0,0,0],this._refreshAreaInfo()}get halfSize(){return this._halfSize}set halfSize(e){this._halfSize=e.slice(0);var t=this._areaInfo.base;t.min[0]=-e[0],t.min[1]=-e[1],t.min[2]=-e[2],t.max[0]=e[0],t.max[1]=e[1],t.max[2]=e[2],this._refreshAreaInfo()}get visible(){return this[Kz].visible}set visible(e){var t=this[Kz];t.visible!=e&&(t.visible=e,e?this._createHelper():this._disposeHelper())}get areaInfo(){return this._areaInfo}}aj.mustCopyWithInstance=!0;var sj=Symbol("private");class oj extends vk{constructor(){super(),this[sj]={},this[sj].relationships=null}addRelationship(e){var t=this[sj];t.relationships=t.relationships||[],t.relationships.includes(e)||t.relationships.push(e)}removeRelationship(e){var t=this[sj];if(e){var r=t.relationships||[],n=r.indexOf(e);-1!==n&&r.splice(n,1)}}query(e){void 0===e&&(e={});var t=this[sj],r=[];if(t.relationships){var n=e.queryDirection;t.relationships.forEach((t=>{if(t.test(e)){var i=t.queryObjects(this.object,n);r.push(...i.objects)}}))}return new hk([...new Set(r)])}queryByType(e,t){return this.query({type:e,queryDirection:t})}queryByName(e,t){return this.query({name:e,queryDirection:t})}onRemove(){var e=this[sj];e.relationships&&(e.relationships.slice(0).forEach((e=>{this.app.relationshipManager.notifyRelationshipRemoveObject(e,this.object)})),e.relationships=null);super.onRemove()}get relationships(){return this[sj].relationships||[]}}oj.mustCopyWithInstance=!0;var lj=Symbol("private"),uj=256,cj=512,hj=1024,dj=2048,pj={isResident:!0};function fj(e){return e.hasInherit()?e.inherit.style:qB.Normal}class mj extends Ez{constructor(e){void 0===e&&(e={}),super(e),this[lj]={};var t=this[lj];t.tags=null,t.external=null,t.inherit=null,t.style=void 0,t.styleObjectAttributes=[],t.renderLayout=null,t.copyPromise=null,t.loadPromise=null,t.resource={url:""},t.options=Object.assign({},e),t.onError=BI.parseValue(e.onError,e.error),t.onComplete=BI.parseValue(e.onComplete,e.complete),t.onSyncComplete=BI.parseValue(e.onSyncComplete,e.syncComplete),t.syncCompleteCallbacks=[],this._flags.enable(uj|cj|hj,!0),this._resourceState=this._resourceState||mj.ResourceState.Ready,this.onSetupAttributes(e),this.onSetupTransform(e),this.onSetupState(e),this.onSetupStyle(e),this.onSetupResource(e),this.onSetupComplete(e),this.onCreate(e)}_createResourcePromise(){return this.loaded?this.unloadResource(!1):this.loading?this.waitForComplete():Promise.resolve()}_updateResource(e){return this.setResource(e),this.reloadResource(!1,{url:e.url})}_unloadResource(e){var t=this.initialLocalBoundingBox||this._body.getLocalBoundingBox(),r=this.unloadableComponents;r&&r.forEach((e=>{e.onUnloadResource()})),this.onUnloadResource(),this._body.unloadResource((e=>this.onCreateBodyNode(e))),e&&this.hasChildren()&&this.children.forEach((t=>{t.unloadResource(e)})),this.initialLocalBoundingBox=t}_onLoadResource(e,t,r){if(this.loaded)t();else if(this.destroyed)r({object:this,desc:"The object had been destroyed"});else{var n=this.loadableComponents;n&&n.forEach((e=>{e.onLoadResource()})),this.onLoadResource(e,(()=>{this.onSetupState(e),t()}),r)}}_loadSelfResource(e,t,r){this.loading?this.waitForComplete().then((()=>{t()})).catch((e=>{r(e)})):this._onLoadResource(e,t,r)}_setChildrenAttributeState(e,t,r,n){for(var i=this.children,a=0;a<i.length;a++){var s=i[a];if(s.hasInherit())switch(s.inherit[e]){case qB.Normal:s["set"+t](r,n);break;case qB.Break:s["set"+t](r,!1);break;case qB.Jump:s.children.traverse((e=>{e["set"+t](r,n)}))}else s["set"+t](r,n)}}_setAttributeState(e,t,r,n){void 0===n&&(n=!1),this.bodyNode.setAttribute(t,r),n&&this.hasChildren()&&this._setChildrenAttributeState(e,t,r,n)}_syncAttributes(){var e=this._flags,t=e.has(cj);t||this._setAttributeState("pickable","Pickable",t,!1),e.has(dj)&&this.transform.keepSize(!0,this.app.camera),this.hasComponent("render")&&this.render.syncAttributes()}_getTempData(){return super._getTempData((e=>{var t=[.5,.5,.5];this.hasComponent("transform")&&(t=this.transform.getPivot()),e.pivot=t.slice(0),e.basePivot=t}))}_isSameResource(e){var t=this[lj];BI.isString(e)&&(e={url:e});var r=t.resource,n=r.children;return(!n||!n.length)&&r.url==e.url}_beforeSetAttribute(e){return!BI.isFunction(e)||!1!==e(this)}_needCopyComponent(e,t,r){if(!t){if(!e)return!1;if(r.mustCopyWithInstance)return!1}return!0}_copyStyleValues(e){var t=this.body.style;for(var r in e){var n=e[r];switch(r){case"attributes":for(var i in n)t.setAttribute(i,n[i]);break;case"uniforms":for(var a in n)t.setUniform(a,n[a]);break;case"macros":for(var s in n)t.setMacro(s,n[s]);break;default:t[r]=n}}}_renderComponents(){var e=this.renderableComponents;if(e){var t=this[lj];if(!t.renderLayout){var r=this;t.renderLayout={getCenter:function(){return r.orientedBox.center},selfToWorld:function(){return r.selfToWorld.apply(r,arguments)},worldToScreen:function(){var e=r.app.camera;return e.worldToScreen.apply(e,arguments)}}}for(var n=0,i=e.length;n<i;n++){var a=e[n];!1!==a.active&&a.onRender(t.renderLayout)}}}_traverseInheritance(e){this.traverseInheritance((t=>{var r=t.body.style;r&&e(r)}),fj)}_createStyleAttributes(e,t){var r=this[lj],n=new gr({data:e,onChange:e=>{var r=e.key,n=e.propName,i=BI.parseValue(e.value,null);this._traverseInheritance((e=>{var a=e[t];n?a[n][r]=i:a[r]=i}))}});return r.styleObjectAttributes.push(n),n.values}_createStyle(){var e=this.body.style;if(!e)return null;var t,r,n,i,a,s,o={};o.begin=()=>{this._traverseInheritance((e=>{e.begin()}))},o.end=()=>{this._traverseInheritance((e=>{e.end()}))},o.beginDefaultValues=()=>{this._traverseInheritance((e=>{e.beginDefaultValues()}))},o.endDefaultValues=()=>{this._traverseInheritance((e=>{e.endDefaultValues()}))},o.setAttribute=(e,t)=>{this._traverseInheritance((r=>{r.setAttribute(e,t)}))},o.getAttribute=e=>this.body.style.getAttribute(e),o.setUniform=(e,t)=>{this._traverseInheritance((r=>{r.setUniform(e,t)}))},o.getUniform=e=>this.body.style.getUniform(e),o.setMacro=(e,t)=>{this._traverseInheritance((r=>{r.setMacro(e,t)}))},o.getMacro=e=>this.body.style.getMacro(e),o.getUV=e=>this.body.style.getUV(e),o.getDiffValues=()=>this.body.style.getDiffValues(),o.setUV=(e,t,r)=>{this._traverseInheritance((n=>{n.setUV(e,t,r)}))},o.copy=e=>{e.isObjectStyle&&(e=e.object.body.style),this._traverseInheritance((t=>{t.copy(e)}))},Object.defineProperties(o,{isInstancedDrawing:{get:()=>this.body.style.isInstancedDrawing},object:{get:()=>this},isObjectStyle:{get:()=>!0},edge:{get:()=>t=t||this._createStyleAttributes(e.getData("edge"),"edge"),set:e=>{this._traverseInheritance((t=>{t.edge=e}))}},effect:{get:()=>r=r||this._createStyleAttributes(e.getData("effect"),"effect"),set:e=>{this._traverseInheritance((t=>{t.effect=e}))}},attributes:{get:()=>n=n||this._createStyleAttributes(e.getData("attributes"),"attributes"),set:e=>{this._traverseInheritance((t=>{t.attributes=e}))}},uniforms:{get:()=>i=i||this._createStyleAttributes(e.getData("uniforms"),"uniforms"),set:e=>{this._traverseInheritance((t=>{t.uniforms=e}))}},macros:{get:()=>a=a||this._createStyleAttributes(e.getData("macros"),"macros"),set:e=>{this._traverseInheritance((t=>{t.macros=e}))}},uv:{get:()=>s=s||this._createStyleAttributes(e.getData("uv").map,"uv"),set:e=>{this._traverseInheritance((t=>{t.uv=e}))}}});var l=Object.keys(ek.cDefaultValues);return l.push("imageSlotType"),l.push("image"),l.push("map"),l.push("envMap"),l.push("alphaMap"),l.push("emissiveMap"),l.push("normalMap"),l.push("colorMapping"),l.push("aoMap"),l.forEach((e=>{Object.defineProperty(o,e,{get:()=>{var t=this.body.style[e];return BI.isArray(t)?t.slice(0):t},set:t=>{this._traverseInheritance((r=>{r[e]=t}))}})})),o.toJSON=()=>this.body.style.toJSON(),o}_getStyleValues(e){return e&&(e.isObjectStyle||e.isStyle)?JSON.parse(JSON.stringify(e)):e}onSetupParent(e){this.onSetupComponent(e),this.onSetupBody(e),super.onSetupParent(e)}onSetupComponent(e){this.addComponent(Bk,"helper",pj),this.addComponent(jL,"lerp",pj),this.addComponent(Vk,"bounding",pj),this.addComponent(_L,"level",pj),this.addComponent(wL,"actionGroup",pj),this.addComponent(GL,"blueprint",pj),this.addComponent(aj,"collider",pj),this.addComponent(aL,"transform",pj),this.addComponent(fL,"render",pj),this.addComponent(oj,"relationship",pj)}onSetupBody(e){this._body=new Gz,this._body.init(this,e);var t=e.name||this.name;this.node.setName(t);var r=e.rootNode,n=e.renderableNode;(r||n)&&(BI.parseValue(e.assets,!0)&&(this._resourceState=mj.ResourceState.Loaded))}onSetupAttributes(e){var t=this[lj],r=this.onGetDefaultTags();t.tags=BI.mergeSet(e.tags,r);var n=e.extras||e.external;n&&(t.external=Object.assign({},n))}onGetDefaultTags(){return this.constructor.defaultTagArray}onSetupState(e){BI.parseValue(e.assets,!0)&&this._resourceState!=mj.ResourceState.Loaded&&(this._resourceState=mj.ResourceState.Loading),BI.parseValue(e.pickable,!0)||(this.pickable=!1),BI.parseValue(e.visible,!0)||(this.visible=!1),BI.parseValue(e.active,!0)||(this.active=!1),BI.isNumber(e.renderOrder)&&(this.renderOrder=e.renderOrder),BI.isBoolean(e.castShadow)&&(this.castShadow=e.castShadow),BI.isBoolean(e.receiveShadow)&&(this.receiveShadow=e.receiveShadow),BI.isBoolean(e.alwaysOnTop)&&(this.alwaysOnTop=e.alwaysOnTop),BI.isNumber(e.layerMask)&&(this.layerMask=e.layerMask)}onSetupPosition(e){e.localPosition?this.localPosition=e.localPosition:e.position&&(this.position=e.position)}onSetupAngles(e){e.localAngles?this.localAngles=e.localAngles:e.localQuaternion?this.localQuaternion=e.localQuaternion:e.angles&&(this.angles=e.angles)}onSetupScale(e){e.localScale?this.localScale=e.localScale:e.scale&&(this.scale=e.scale)}onSetupMatrix(e){e.matrix&&(this.matrix=e.matrix)}onSetupTransform(e){this.onSetupPosition(e),this.onSetupAngles(e),this.onSetupScale(e),this.onSetupMatrix(e),BI.isValid(e.keepSizeDistance)&&(this.keepSizeDistance=e.keepSizeDistance),e.keepSize&&(this.keepSize=e.keepSize)}onSetupStyle(e){var t=this._getStyleValues(e.style);if(t){var r=this.body.style;r.begin(),this._copyStyleValues(t);var n=t.default;n&&(r.beginDefaultValues(),this._copyStyleValues(n),r.endDefaultValues()),r.end()}}onSetupURL(e){var t=this[lj];t.resource.url=BI.parseValue(e.url,""),e.nodeName&&(t.resource.nodeName=e.nodeName)}onSetupResource(e){this.onSetupURL(e),this._onLoadResource(e,(()=>{BI.parseValue(e.assets,!0)&&this.onLoadComplete()}),(e=>{var t=this[lj];this._resourceState=mj.ResourceState.Error,t.loadPromise&&t.loadPromise.reject(e),t.onError&&t.onError(e)}))}onSetupComplete(e){var t=e.pivot;t&&(this.pivot=t),this._flags.enable(uj,!1)}onCreate(e){this.loaded?this.onNotifyComplete():BI.parseValue(e.assets,!0)||this.onNotifyComplete();BI.setBatchTimeout((()=>{this.destroyed||this.trigger(SB.Create)}))}onLoadComplete(){if(!this.destroyed)switch(this._resourceState){case mj.ResourceState.Loading:case mj.ResourceState.Loaded:var e=this[lj];this._resourceState=mj.ResourceState.Loaded,this._syncAttributes(),this.hasComponent("bounding")&&(this.initialLocalBoundingBox=null),e.loadPromise&&e.loadPromise.resolve({object:this}),BI.setBatchTimeout((()=>{BI.setTimeout((()=>{this.trigger(SB.Load)}))})),this.onNotifyComplete();break;case mj.ResourceState.Ready:this._unloadResource(!1)}}onSyncComplete(){var e=this[lj],t=e.onSyncComplete;t&&(t({object:this}),e.onSyncComplete=null)}onDelayComplete(){var e=this[lj],t=e.onComplete;t&&(BI.setTimeout((()=>{this.destroyed||t({object:this})})),e.onComplete=null)}onProcessSyncCompleteCallbacks(){var e=this[lj];e.syncCompleteCallbacks.length&&(e.syncCompleteCallbacks.forEach((e=>{e()})),e.syncCompleteCallbacks.length=0)}onNotifyComplete(){this.onSyncComplete(),this.onDelayComplete(),this.onProcessSyncCompleteCallbacks()}onLoadResource(e,t,r){t(),this._flags.has(uj)||this.onRefresh()}onUnloadResource(){}onAfterDestroy(){var e=this[lj];this._body&&(this._body.dispose(),this._body=null),e.style=void 0,e.styleObjectAttributes.forEach((e=>{e.dispose()})),e.styleObjectAttributes.length=0,e.renderLayout=null,e.onError=null,e.onComplete=null,e.onSyncComplete=null,e.options={},super.onAfterDestroy()}onAddToParentNode(e,t,r){!e.getParent()?t.add(e):BI.parseValue(r.attachMode,!0)?t.attach(e):t.add(e)}onCopy(e){}onCreateBodyNode(e){return BI.createObject(e)}onGetPivot(){var e=this._getTempData(),t=this.transform.getPivot();return e.pivot=t,t}onSetPivot(e){this.loaded?this.transform.setPivot(e,this._getTempData().basePivot):this.addSyncCompleteCallback((()=>{if(this._getTempData().pivot){var t=this.position;this.transform.setPivot(e,this._getTempData().basePivot),this.position=t}}))}onUpdate(e){super.onUpdate(e),this._renderComponents()}get name(){return this._name}set name(e){super.name=e,this.node.setName(e)}get tags(){var e=this[lj];return e.tags=e.tags||new Set,e.tags}set tags(e){if(BI.isArray(e)||BI.isSet(e)){var t=this.tags;t.clear(),e.forEach((e=>{t.add(e)}))}}get external(){return this[lj].external}set external(e){this[lj].external=e}get layerMask(){return this.bodyNode.getLayerMask()}set layerMask(e){var t=this.bodyNode,r=this.body.style;r&&r.isInstancedDrawing&&BI.warn("The layer mask can not work in instanced drawing mode"),t.setLayerMask(e)}getVisible(){return this.bodyNode.getVisible()}setVisible(e,t){if(void 0===t&&(t=!1),this._beforeSetAttribute(t)){var r=this.bodyNode;r.getVisible()!=e?(r.setVisible(e),this.trigger(SB.VisibleChange,{value:e})):this.loaded||this.trigger(SB.VisibleChange,{value:e});var n=this.visibleComponents;n&&n.forEach((t=>{t.onVisibleChange&&t.onVisibleChange(e)}))}t&&this.hasChildren()&&this._setChildrenAttributeState("visible","Visible",e,t)}getPickable(){return this._flags.has(cj)}setPickable(e,t){void 0===t&&(t=!1),this._flags.enable(cj,e),this._setAttributeState("pickable","Pickable",e,t)}getRenderable(){return console.warn("Please get visible with getVisible instead of getRenderable"),this.getVisible()}setRenderable(e,t){void 0===t&&(t=!1),console.warn("Please set visible with setVisible instead of setRenderable"),this.setVisible(e,t)}getActive(){return this._flags.has(hj)}setActive(e,t){void 0===t&&(t=!1),this._body.createRootNode(),this._flags.enable(hj,e)?(this._body.getRootNode().setVisible(e),this.node.getUserData().active=e,this.getAllComponents().forEach((t=>{t.active=e})),this.trigger(SB.ActiveChange,{value:e})):this.loaded||this.trigger(SB.ActiveChange,{value:e}),t&&this.children.forEach((t=>{t.setActive(e,!0)}))}hasInherit(){return!!this[lj].inherit}get inherit(){var e=this[lj];return e.inherit||(e.inherit=new ar({onConvertValue:(e,t)=>BI.isBoolean(t)?t?qB.Normal:qB.Stop:t,values:{visible:qB.Normal,pickable:qB.Normal,style:qB.Normal}})),e.inherit}get visible(){return this.getVisible()}set visible(e){this.setVisible(e,!0)}get invisible(){return!this._body.getRenderableNode().getSceneVisible()}get pickable(){return this.getPickable()}set pickable(e){this.setPickable(e,!0)}get renderable(){return this.getRenderable()}set renderable(e){this.setRenderable(e,!1)}get active(){return this.getActive()}set active(e){this.setActive(e,!1)}distanceTo(e){return e.isObject3D?QI.getDistance(this.position,e.position):QI.getDistance(this.position,e)}get keepSize(){return this._flags.has(dj)}set keepSize(e){this._flags.enable(dj,e),this.transform.keepSize(e,this.app.camera)}get pivot(){return this.getPivot()}set pivot(e){e=e||[.5,.5,.5],QI.equalsVector3(this.pivot,e)||this.setPivot(e)}traverseInheritance(e,t,r){if(r||e(this),this.hasChildren())for(var n=this.children,i=0,a=n.length;i<a;i++){var s=n[i];switch(t(s)){case qB.Normal:s.traverseInheritance(e,t);break;case qB.Break:e(s);break;case qB.Jump:s.traverseInheritance(e,t,!0);case qB.Stop:}}}onSetParent(e,t){e?t&&t(e.node):this.parent&&this.parent.node.remove(this.node),super.onSetParent(e);var r=this.parentChangeComponents;r&&r.forEach((t=>{t.onParentChange&&t.onParentChange(e)}))}add(e,t){return void 0===t&&(t={}),!!e&&(this.onBeforeAddChild(e),this._body.createRootNode(),e.onSetParent(this,(r=>{if(this.onAddToParentNode(e.node,r,t),t.attachMode)return!1;var n=t.localPosition,i=BI.parseValue(t.ignoreScale,!0),a=t.subNodeName;if(a){var s=this._body.getNodeByName(a);if(!s)return BI.error("Sub node '"+a+"' is not existing when add object",this),!1;if(n){var o=this.worldToSelf(s.position),l=QI.addVector(o,n);e.position=this.selfToWorld(l,i)}else e.position=s.position}else n&&(e.position=this.selfToWorld(n,i))})),this.onAfterAddChild(e),!0)}promoteNode(e,t){if(!e)return null;this.isInstancedDrawing&&this.makeInstancedDrawing(!1),this._body.createRootNode(),t=t||this,this.removeComponent("animation");var r=this._body.promoteNode(e,t.node);return new mj({name:e,renderableNode:r,parent:t})}getPivot(){var e=this._getTempData().pivot;return e||this.onGetPivot()}setPivot(e){e.length<3&&(e[0]=BI.parseValue(e[0],.5),e[1]=BI.parseValue(e[1],.5),e[2]=BI.parseValue(e[2],.5));var t=this._getTempData();this.onSetPivot(e),t.pivot=e}clearPivot(){this.transform.clearPivot(),delete this._getTempData().pivot}get attachedPoints(){return this.query(".AttachedPoint",{recursive:!1})}raycast(e,t){void 0===t&&(t=!0);var r=t?this.node:this.bodyNode;if(r.isRenderableNode){var n=[];return r.raycast(e,n),n.map((e=>({node:e.node,distance:e.distance,position:e.position})))}return{node:null,distance:0,position:null}}get pickMode(){return this.bodyNode.getAttribute("PickMode")}set pickMode(e){this.bodyNode.setAttribute("PickMode",e)}hasStyle(){return this.body.hasStyle()}getStyle(){var e=this[lj];return void 0===e.style&&(e.style=this._createStyle()),e.style?e.style:null}setStyle(e){this.traverse((t=>{t.body.setStyle(e)}))}get style(){return this.getStyle()}set style(e){this.setStyle(e)}onBeforeDestroy(){return!this.destroyed&&(this.isInstancedDrawing&&this.makeInstancedDrawing(!1),this.node.setAttribute("SkipMatrixUpdate",!0),super.onBeforeDestroy())}clone(e,t,r){void 0===r&&(r={});var n=null,i=BI.parseValue(r.attachMode,!0),a=void 0!==t?t:this.app.root;return(n=BI.applyNew(this.constructor,{assets:!1,parent:a})).options=Object.assign({},r),n.copy(this),i||a==this.parent||(n.localPosition=this.localPosition),e&&this.children.forEach((e=>{e.clone(!0,n,{attachMode:!1})})),n}cloneAsync(e,t,r){return new Promise(((n,i)=>{var a=this.clone(e,t,r);a?a.copyPromise.then((()=>{n(a)})):i()}))}waitForComplete(){if(this.loaded)return Promise.resolve({object:this});if(this._resourceState==mj.ResourceState.Error)return Promise.reject({object:this,desc:"Object load failed"});var e=this[lj];return e.loadPromise||(e.loadPromise=new Rt),e.loadPromise}setResource(e){var t=this[lj];BI.isString(e)&&(e={url:e}),t.resource=e}getResource(){return this[lj].resource}hasResource(){var e=this[lj].resource;if(e.url)return!0;var t=e.children;return!(!t||!t.length)}reloadResource(e,t){return void 0===e&&(e=!0),void 0===t&&(t={}),this.unloadResource(e).then((()=>{this.loadResource(e,t)}))}loadResource(e,t){return void 0===e&&(e=!0),void 0===t&&(t={}),new Promise(((r,n)=>{if(e){var i=[];this.hasChildren()&&this.children.forEach((r=>{var n=r.loadResource(e,t);n?i.push(n):BI.error("Load resource failed, due to promise is invalid",r)})),i.length?Promise.all(i).then((()=>{this._loadSelfResource(t,r,n)})):this._loadSelfResource(t,r,n)}else this._loadSelfResource(t,r,n)})).then((()=>{this.onLoadComplete()}),(()=>{}))}unloadResource(e){void 0===e&&(e=!0);var t=this[lj];return this.makeInstancedDrawing(!1),new Promise(((r,n)=>{this.loaded?(this._unloadResource(e),this._resourceState=mj.ResourceState.Ready,t.loadPromise=null,r()):this.loading?this.waitForComplete().then((()=>{this.unloadResource(),r()})):r()}))}setBodyNode(e){this.body.setNode(e)}getBodyNode(){return this.bodyNode}get options(){return this[lj].options}set options(e){var t=this[lj];t.options=e?Object.assign({},e):{}}get copyPromise(){return this[lj].copyPromise}get loaded(){return this._resourceState==mj.ResourceState.Loaded}set loaded(e){this._resourceState=e?mj.ResourceState.Loaded:mj.ResourceState.Ready}get loading(){return this._resourceState==mj.ResourceState.Loading}get body(){return this._body}get node(){return this._body.getNode()}get pivotNode(){return this._body.getPivotNode()}get bodyNode(){return this._body.getRenderableNode()}get resource(){return this[lj].resource}set resource(e){e&&(this._isSameResource(e)||this._updateResource(e))}copy(e){var t=this[lj];return this.onBeforeCopy(e),this.onCopyStyle(e),t.copyPromise=new Rt,this._createResourcePromise().then((()=>{if(e._resourceState===mj.ResourceState.Loaded){var r=e.node.clone();this.body.setNode(r),this.onCopyComponents(e),this.onCopy(e),e.isInstancedDrawing&&this.makeInstancedDrawing()}else this.onAfterCopy(e),t.copyPromise.resolve()})),this.waitForComplete()}onCopyComponents(e){var t=e.getAccessorInfo();for(var r in t){var{isResident:n,hasInstance:i,classType:a}=t[r];if(this._needCopyComponent(n,i,a)){var s=t[r].accessor.get(),o=this[r];if(o||(this.addComponent(a,r,t[r].args),o=this[r]),o.onCopy)o.onCopy(s);else if(o.onImport&&s&&s.onExport){var l=s.onExport();l&&o.onImport(BI.cloneObject(l,!1))}}}}onCopyResource(e){this._updateResource(e.resource).then((()=>{this.onCopyComponents(e)}))}onBeforeCopy(e){this.onCopyAttribute(e),this.onCopyTransform(e)}onAfterCopy(e){this.onCopyResource(e),this.onCopy(e),e.isInstancedDrawing&&this.makeInstancedDrawing()}copyCompnents(e){this.onCopyComponents(e)}onCopyStyle(e){var t=e.body.style;t&&this.body.style.copyFromValues(t.data)}onCopyAttribute(e){var t=this[lj];this.name=e.name,this.id=e.id,this.queryable=e.queryable,this.destroyable=e.destroyable,this.active=e.active,this.visible=e.visible,this.userData=e.userData,this.alwaysOnTop=e.alwaysOnTop,t.tags=new Set(e.tags),e.external&&(t.external=Object.assign({},e.external))}onCopyTransform(e){this.matrixWorld=e.matrixWorld,this.body.matrixWorld=e.body.matrixWorld}addSyncCompleteCallback(e){this[lj].syncCompleteCallbacks.push(e)}onCollectMesh(){return!this.isSubObject}onExportExternalData(e){return this.external?this.external:null}get isInstancedDrawing(){return this.render.isInstancedDrawing}get instanceGroupName(){return this.render.instanceGroupName}set instanceGroupName(e){this.render.instanceGroupName=e}get renderOrder(){return this.render.renderOrder}set renderOrder(e){this.render.renderOrder=e}get castShadow(){return this.render.castShadow}set castShadow(e){this.render.castShadow=e}get receiveShadow(){return this.render.receiveShadow}set receiveShadow(e){this.render.receiveShadow=e}get alwaysOnTop(){return this.render.alwaysOnTop}set alwaysOnTop(e){this.render.alwaysOnTop=e}getRenderOrder(){return this.render.getRenderOrder.apply(this.render,arguments)}setRenderOrder(){return this.render.setRenderOrder.apply(this.render,arguments)}getCastShadow(){return this.render.getCastShadow.apply(this.render,arguments)}setCastShadow(){return this.render.setCastShadow.apply(this.render,arguments)}getReceiveShadow(){return this.render.getReceiveShadow.apply(this.render,arguments)}setReceiveShadow(){return this.render.setReceiveShadow.apply(this.render,arguments)}makeInstancedDrawing(){return this.render.makeInstancedDrawing.apply(this.render,arguments)}enableInstancing(){return this.render.enableInstancing.apply(this.render,arguments)}disableInstancing(){return this.render.disableInstancing.apply(this.render,arguments)}setInstancing(){return this.render.setInstancing.apply(this.render,arguments)}getInstancing(){return this.render.getInstancing.apply(this.render,arguments)}getGeometryInfo(){return this.render.getGeometryInfo.apply(this.render,arguments)}get isCurrentLevel(){return this.level.isCurrentLevel}get boundingBox(){return this.bounding.boundingBox}get orientedBox(){return this.bounding.orientedBox}get initialLocalBoundingBox(){return this.bounding.initialLocalBoundingBox}set initialLocalBoundingBox(e){this.bounding.initialLocalBoundingBox=e}getAABB(){return this.bounding.getAABB.apply(this.bounding,arguments)}getOBB(){return this.bounding.getOBB.apply(this.bounding,arguments)}get isFlying(){return this.lerp.isFlying}lerpPoints(){return this.lerp.lerpPoints.apply(this.lerp,arguments)}lerpPointsAsync(){return this.lerp.lerpPointsAsync.apply(this.lerp,arguments)}stopMoving(){return this.lerp.stopMoving.apply(this.lerp,arguments)}pauseMoving(){return this.lerp.pauseMoving.apply(this.lerp,arguments)}resumeMoving(){return this.lerp.resumeMoving.apply(this.lerp,arguments)}moveTo(){return this.lerp.moveTo.apply(this.lerp,arguments)}moveToAsync(){return this.lerp.moveToAsync.apply(this.lerp,arguments)}movePath(){return this.lerp.movePath.apply(this.lerp,arguments)}movePathAsync(){return this.lerp.movePathAsync.apply(this.lerp,arguments)}stopScaling(){return this.lerp.stopScaling.apply(this.lerp,arguments)}pauseScaling(){return this.lerp.pauseScaling.apply(this.lerp,arguments)}resumeScaling(){return this.lerp.resumeScaling.apply(this.lerp,arguments)}scaleTo(){return this.lerp.scaleTo.apply(this.lerp,arguments)}scaleToAsync(){return this.lerp.scaleToAsync.apply(this.lerp,arguments)}stopRotating(){return this.lerp.stopRotating.apply(this.lerp,arguments)}pauseRotating(){return this.lerp.pauseRotating.apply(this.lerp,arguments)}resumeRotating(){return this.lerp.resumeRotating.apply(this.lerp,arguments)}rotateTo(){return this.lerp.rotateTo.apply(this.lerp,arguments)}rotateToAsync(){return this.lerp.rotateToAsync.apply(this.lerp,arguments)}stopFading(){return this.lerp.stopFading.apply(this.lerp,arguments)}pauseFading(){return this.lerp.pauseFading.apply(this.lerp,arguments)}resumeFading(){return this.lerp.resumeFading.apply(this.lerp,arguments)}fadeIn(){return this.lerp.fadeIn.apply(this.lerp,arguments)}fadeOut(){return this.lerp.fadeOut.apply(this.lerp,arguments)}fadeInAsync(){return this.lerp.fadeInAsync.apply(this.lerp,arguments)}fadeOutAsync(){return this.lerp.fadeOutAsync.apply(this.lerp,arguments)}stopFlying(){return this.lerp.stopFlying.apply(this.lerp,arguments)}pauseFlying(){return this.lerp.pauseFlying.apply(this.lerp,arguments)}resumeFlying(){return this.lerp.resumeFlying.apply(this.lerp,arguments)}flyTo(){return this.lerp.flyTo.apply(this.lerp,arguments)}flyToAsync(){return this.lerp.flyToAsync.apply(this.lerp,arguments)}fit(){return this.lerp.fit.apply(this.lerp,arguments)}stopUVTransform(){return this.lerp.stopUVTransform.apply(this.lerp,arguments)}pauseUVTransform(){return this.lerp.pauseUVTransform.apply(this.lerp,arguments)}resumeUVTransform(){return this.lerp.resumeUVTransform.apply(this.lerp,arguments)}uvTransformTo(){return this.lerp.uvTransformTo.apply(this.lerp,arguments)}uvTransformToAsync(){return this.lerp.uvTransformToAsync.apply(this.lerp,arguments)}get localPosition(){return this.transform.getLocalPosition()}set localPosition(e){this.transform.setLocalPosition(e)}get localAngles(){return this.transform.getLocalAngles()}set localAngles(e){this.transform.setLocalAngles(e)}get localRotation(){return this.transform.getLocalAngles()}set localRotation(e){this.transform.setLocalAngles(e)}get localQuaternion(){return this.transform.getLocalQuaternion()}set localQuaternion(e){this.transform.setLocalQuaternion(e)}get localScale(){return this.transform.getLocalScale()}set localScale(e){this.transform.setLocalScale(e)}get position(){return this.transform.getWorldPosition()}set position(e){this.transform.setWorldPosition(e)}get angles(){return this.transform.getWorldAngles()}set angles(e){this.transform.setWorldAngles(e)}get rotation(){return this.transform.getWorldAngles()}set rotation(e){this.transform.setWorldAngles(e)}get quaternion(){return this.transform.getWorldQuaternion()}set quaternion(e){this.transform.setWorldQuaternion(e)}get scale(){return this.transform.getWorldScale()}set scale(e){this.transform.setWorldScale(e)}get matrix(){return this.transform.getMatrix()}set matrix(e){this.transform.setMatrix(e)}get matrixWorld(){return this.transform.getMatrixWorld([],!0)}set matrixWorld(e){this.transform.setMatrixWorld(e)}get inversedMatrix(){return this.transform.inversedMatrix}get inversedMatrixWorld(){return this.transform.inversedMatrixWorld}get up(){return this.transform.up}get forward(){return this.transform.forward}get cross(){return this.transform.cross}get keepSizeDistance(){return this.transform.keepSizeDistance}set keepSizeDistance(e){this.transform.keepSizeDistance=e}getLocalPosition(){return this.transform.getLocalPosition.apply(this.transform,arguments)}getLocalQuaternion(){return this.transform.getLocalQuaternion.apply(this.transform,arguments)}getLocalScale(){return this.transform.getLocalScale.apply(this.transform,arguments)}getWorldPosition(){return this.transform.getWorldPosition.apply(this.transform,arguments)}getWorldQuaternion(){return this.transform.getWorldQuaternion.apply(this.transform,arguments)}getWorldScale(){return this.transform.getWorldScale.apply(this.transform,arguments)}getForward(){return this.transform.getForward.apply(this.transform,arguments)}rotateOnAxis(){return this.transform.rotateOnAxis.apply(this.transform,arguments)}rotateX(){return this.transform.rotateX.apply(this.transform,arguments)}rotateY(){return this.transform.rotateY.apply(this.transform,arguments)}rotateZ(){return this.transform.rotateZ.apply(this.transform,arguments)}translateOnAxis(){return this.transform.translateOnAxis.apply(this.transform,arguments)}translateX(){return this.transform.translateX.apply(this.transform,arguments)}translateY(){return this.transform.translateY.apply(this.transform,arguments)}translateZ(){return this.transform.translateZ.apply(this.transform,arguments)}translate(){return this.transform.translate.apply(this.transform,arguments)}lookAt(){return this.transform.lookAt.apply(this.transform,arguments)}localToSelf(){return this.transform.localToSelf.apply(this.transform,arguments)}selfToLocal(){return this.transform.selfToLocal.apply(this.transform,arguments)}worldToSelf(){return this.transform.worldToSelf.apply(this.transform,arguments)}selfToWorld(){return this.transform.selfToWorld.apply(this.transform,arguments)}localToWorld(){return this.transform.localToWorld.apply(this.transform,arguments)}worldToLocal(){return this.transform.worldToLocal.apply(this.transform,arguments)}getSelfQuaternionFromTarget(){return this.transform.getSelfQuaternionFromTarget.apply(this.transform,arguments)}getSelfAnglesFromTarget(){return this.transform.getSelfAnglesFromTarget.apply(this.transform,arguments)}getWorldQuaternionFromTarget(){return this.transform.getWorldQuaternionFromTarget.apply(this.transform,arguments)}getWorldAnglesFromTarget(){return this.transform.getWorldAnglesFromTarget.apply(this.transform,arguments)}getWorldPositionFromSelfAngles(){return this.transform.getWorldPositionFromSelfAngles.apply(this.transform,arguments)}getMatrixWorld(){return this.transform.getMatrixWorld.apply(this.transform,arguments)}setMatrixWorld(){return this.transform.setMatrixWorld.apply(this.transform,arguments)}getLocalMatrix(){return this.transform.getLocalMatrix.apply(this.transform,arguments)}updateWorldMatrix(){return this.transform.updateWorldMatrix.apply(this.transform,arguments)}updateMatrixWorld(){return this.transform.updateMatrixWorld.apply(this.transform,arguments)}bindSubNode(){return this.transform.bindSubNode.apply(this.transform,arguments)}unbindSubNode(){return this.transform.unbindSubNode.apply(this.transform,arguments)}get isBaseObject3D(){return console.warn("Plase use isObject3D instead of isBaseObject3D"),!0}}mj.defaultTagArray=["Object3D"],mj.ResourceState={Error:-1,Ready:1,Loaded:2,Loading:3};var gj=Le.toText("160,152,58,38,127,54,1,64,210,235,125,186,56"),_j=Le.toText("145,145,49,35,104,7,33,90,216,235,83,174,39,110,25,120"),vj=Symbol("private"),yj=1,xj=2,bj=4,Aj={isResident:!0};class Sj extends mj{constructor(e){void 0===e&&(e={}),super(e),this[vj]={};var t=this[vj];t.flags=new Wt,t.projectionType=RB.Perspective,t.projectionTween=null,t.viewModeInfo={type:null,target:null,position:null,lookAt:null},t.viewport=null,t.captureRenderTexture=null,t.renderTexture=null,t.renderableRefCount=0,t.fov=BI.parseValue(e.fov,50),t.near=BI.parseValue(e.near,.1),t.far=BI.parseValue(e.far,1e4),this.onRefresh(),this.effect.enable=!0,this.enableViewport=!1,this.controlEventDispatcher.enable=!0;var r=this.app.size;this.resize(r[0],r[1]),this.background=16777215,t.flags.enable(yj,!0)}_getLocationOfViewModeInPerspective(e,t){var r,n,i,a=t.boundingBox,s=.5*a.radius/Math.tan(this.fov/2);switch(e){case NB.Top:r=a.center,n=QI.addVector(r,[0,-s,0]),i=[0,0,-1];break;case NB.Bottom:r=a.center,n=QI.addVector(r,[0,s,0]),i=[0,0,1];break;case NB.Left:r=a.center,n=QI.addVector(r,[-s,0,0]),i=[0,1,0];break;case NB.Right:r=a.center,n=QI.addVector(r,[s,0,0]),i=[0,1,0];break;case NB.Front:r=a.center,n=QI.addVector(r,[0,0,-s]),i=[0,1,0];break;case NB.Back:r=a.center,n=QI.addVector(r,[0,0,s]),i=[0,1,0];break;default:return}return{lookAt:r,position:n,up:i}}_getLocationOfViewModeInOrthographic(e,t){var{lookAt:r,position:n,up:i}=this._getLocationOfViewModeInPerspective(e,t),a=QI.getDistance(n,r),s=2*Math.tan(this.fov/2*Math.PI/180)*a*.5,o=QI.getDirection(n,r);return{lookAt:r=QI.getPositionOnDirection(n,o,s),position:n,up:i,distance:s}}_getLocationOfViewMode(e,t){switch(this[vj].projectionType){case RB.Orthographic:return this._getLocationOfViewModeInOrthographic(e,t);case RB.Perspective:return this._getLocationOfViewModeInPerspective(e,t);default:return null}}_setViewMode(e,t,r){var n=this[vj].viewModeInfo;if(n.type=t,n.target=e,n.position=n.position||this.position,n.lookAt=n.lookAt||this.target,t){var{lookAt:i,position:a,up:s,distance:o}=this._getLocationOfViewMode(t,e);this.flyTo({target:i,position:a,up:s,duration:r}),void 0!==o&&(this.orthoDistance=o)}else{var l,u;n.position&&(u=n.position,n.position=null),n.lookAt&&(l=n.lookAt,n.lookAt=null),this.flyTo({target:l,position:u,up:[0,1,0],duration:r})}}_updateRenderableRefCount(e){var t=this[vj],r=this.app.scene;if(e)t.renderableRefCount++,r.addRenderCamera(this);else{if(t.renderableRefCount--,t.renderableRefCount)return;r.removeRenderCamera(this)}}_getSize(e,t){var r=[];return this.node.getSize(r),[BI.parseValue(e,r[0]),BI.parseValue(t,r[1])]}get created(){var e=this[vj];return!!e&&e.flags.has(yj)}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("Camera"),super.onBeforeSetup(e)}onSetupComponent(e){super.onSetupComponent(e),this.addComponent(WU,"transform",Aj),this.addComponent(qU,"lerp",Aj),this.addComponent($U,"helper",Aj),this.addComponent(nz,"bounding",Aj),this.addComponent(sz,"effect",Aj),this.addComponent(RU,"postEffect",Aj),this.addComponent(lz,"fog",Aj),this.addComponent(OU,"picker",Aj),this.addComponent(xU,"control",Aj),this.addComponent(cz,"controlEventDispatcher",Aj),this.addComponent(PU,"resourceController",Aj)}onRefresh(){var e=this[vj],t=this.node;t.setFov(e.fov),t.setNear(e.near),t.setFar(e.far),t.getUserData()[AB.BoundingBoxInheritType]=qB.Stop}onUpdate(e){super.onUpdate(e);var t=this.node;t.updateMatrixWorld(),t.update(e)}onBeforeDestroy(){if(Sj.keepAliveObject==this)return!1;this.app.scene.removeRenderCamera(this);var e=this[vj];return e.renderTexture&&(e.renderTexture.release(),e.renderTexture=null),super.onBeforeDestroy()}onAddTickableObject(){var e=this[vj];e.flags.has(bj)||(this.app.objectManager.insertTickableObject(0,this),e.flags.enable(bj,!0))}onCopy(e){super.onCopy(e);var t=[],r=[],n=e.node;n.getViewport(t),n.getSize(r),this.node.setViewport(t),this.node.setSize(r),this.orthoDistance=e.orthoDistance,this.fov=e.fov,this.near=e.near,this.far=e.far}worldToScreen(e,t){return void 0===t&&(t=[]),this.node.worldToScreen(e,t)}screenToWorld(e,t){return void 0===t&&(t=[]),this.node.screenToWorld(e,t)}onUnloadResource(){this.control.setController(null),super.onUnloadResource()}onCopyResource(e){this.onCopyComponents(e)}copy(e){return this.onBeforeCopy(e),this.onAfterCopy(e),this}get autoClearColorBuffer(){return this.node.getAttribute("ClearColorBuffer")}set autoClearColorBuffer(e){this.node.setAttribute("ClearColorBuffer",e)}get autoClearDepthBuffer(){return this.node.getAttribute("ClearDepthBuffer")}set autoClearDepthBuffer(e){this.node.setAttribute("ClearDepthBuffer",e)}get autoClearStencilBuffer(){return this.node.getAttribute("ClearStencilBuffer")}set autoClearStencilBuffer(e){this.node.setAttribute("ClearStencilBuffer",e)}captureToRenderTexture(e,t){var r=this[vj],n=this.node,i=this._getSize(e,t),a=[];n.getSize(a);var s=[];n.getViewport(s),r.captureRenderTexture?r.captureRenderTexture.size=i:r.captureRenderTexture=new pz({size:i});var o=r.captureRenderTexture.getTextureResource();this.app.trigger(SB.BeforeCameraCapture,{width:i[0],height:i[1]}),n.setViewport([0,0,i[0],i[1]]),n.setSize(i),n.render(o);var l=n.getAttribute(_j);return n.setAttribute(_j,!1),n[gj](o),n.setAttribute(_j,l),n.setSize(a),n.setViewport(s),this.app.trigger(SB.AfterCameraCapture),r.captureRenderTexture}captureToData(e,t){return this.captureToRenderTexture(e,t).pixelBuffer}captureToImage(e,t){var r=this._getSize(e,t),n=this.captureToData(r[0],r[1]);return BI.saveAsImage(r[0],r[1],n)}captureToFile(e,t,r){this.captureToRenderTexture(t,r).download(e)}resize(e,t){var r=this[vj],n=this.node,i=r.viewport;i?(n.setViewport(i),n.setSize([i[2],i[3]])):(n.setViewport([0,0,e,t]),n.setSize([e,t]))}get enableViewport(){return this[vj].flags.has(xj)}set enableViewport(e){this[vj].flags.enable(xj,e)&&this.trigger(SB.EnableViewport,{value:e})}get viewport(){return this[vj].viewport}set viewport(e){var t=this[vj];e?(t.viewport=e.slice(0),this.node.setViewport(t.viewport),this.node.setSize([e[2],e[3]])):(t.viewport=null,this.node.setViewport([0,0,0,0])),this._updateRenderableRefCount(e)}get renderTexture(){return this[vj].renderTexture}set renderTexture(e){var t=this[vj];t.renderTexture&&t.renderTexture.release(),!e||e.isRenderTexture?(t.renderTexture=e,t.renderTexture.addRef(),this._updateRenderableRefCount(e)):BI.error("Set camera render texture failed, due to value is not RenderTexture type")}get projectionMatrix(){return this.node.getProjectionMatrix([])}getProjectionType(){return this[vj].projectionType}setProjectionType(e,t){void 0===t&&(t=1e3);var r=this[vj];if(r.projectionType!=e){var n=this.app.tweenManager,i=this.node,a=i.getProjectionMatrixWeight();r.projectionTween&&r.projectionTween.stop(),r.projectionType!=e&&(e==RB.Perspective?t?r.projectionTween=n.lerpTo(a,1,t).easing(EB.Exponential.In).onUpdate((e=>{i.setProjectionMatrixWeight(e.value)})):i.setProjectionMatrixWeight(1):e==RB.Orthographic&&(t?r.projectionTween=n.lerpTo(a,0,t).easing(EB.Quartic.Out).onUpdate((e=>{this.orthoDistance=this.distance,i.setProjectionMatrixWeight(e.value)})):(this.orthoDistance=this.distance,i.setProjectionMatrixWeight(0))),r.projectionType=e)}}getViewMode(){return this[vj].viewModeInfo.type}setViewMode(e,t,r){void 0===r&&(r=1e3),BI.isString(e)&&(r=t||r,t=e,e=null);var n=e||this.app.levelManager.current||this.app.root;this._setViewMode(n,t,r)}getViewModeType(){return console.warn("Please use getViewMode(), getViewModeType() has been abandoned, but will be compatible with version 2.7"),this.getViewMode()}setViewModeType(e,t,r){void 0===r&&(r=1e3),console.warn("Please use setViewMode(), setViewModeType() has been abandoned, but will be compatible with version 2.7"),this.setViewMode(e,t,r)}get orthoRect(){return this.node.getOrthographicRect([])}get orthoDistance(){return this.node.getAttribute("OrthoDistance")}set orthoDistance(e){this.node.setAttribute("OrthoDistance",e)}get fov(){return this[vj].fov}set fov(e){this[vj].fov=e,this.node.setFov(e)}get near(){return this[vj].near}set near(e){this[vj].near=e,this.node.setNear(e)}get far(){return this[vj].far}set far(e){this[vj].far=e,this.node.setFar(e)}get aspect(){return this.node.getAspect()}get projectionType(){return this.getProjectionType()}set projectionType(e){this.setProjectionType(e,0)}get viewMode(){return this.getViewMode()}set viewMode(e){this.setViewMode(null,e,0)}get viewModeType(){return console.warn("Please use viewMode, viewModeType has been abandoned, but will be compatible with version 2.7"),this.viewMode}set viewModeType(e){console.warn("Please use viewMode, viewModeType has been abandoned, but will be compatible with version 2.7"),this.viewMode=e}intersectObjectInRegion(e,t){return this.picker.intersectObjectInRegion(e,t)}pick(e,t,r){return this.picker.pick(e,t,r)}pickFromCrossPlanes(e,t){return this.picker.pickFromCrossPlanes(e,t)}intersectPlane(e,t,r,n){return void 0===r&&(r=[0,1,0]),void 0===n&&(n=0),this.picker.intersectPlane(e,t,r,n)}get isCamera(){return!0}}Sj.keepAliveObject=null;var Ej=Symbol("private"),wj={minFilter:nI.LinearFilter,magFilter:nI.LinearFilter,wrapS:tI.Repeat,wrapT:tI.Repeat},Cj={};function Tj(e){return e?(e.minFilter?e.minFilter:wj.minFilter)+";"+(e.magFilter?e.magFilter:wj.magFilter)+";"+(e.wrapS?e.wrapS:wj.wrapS)+";"+(e.wrapT?e.wrapT:wj.wrapT):""}function Dj(e,t){return BI.isString(e)?e.length?e+";"+t:"":BI.isArray(e)?e.join(";")+t:""}class Mj{constructor(){this[Ej]={},this[Ej].texturesMap=new Map}_hookTexture(e){var t=this[Ej];e.onUpdateSampler=(e,r)=>{var n=Dj(e.url,e.flipY),i=t.texturesMap.get(n);if(i)for(var[a,s]of i)if(s==e){i.delete(a);var o=Tj(r);return void i.set(o,e)}},e.onUpdateUrl=e=>{for(var[r,n]of t.texturesMap)for(var[i,a]of n)if(a==e){n.delete(i);var s=Dj(e.url,e.flipY);if(s){var o=t.texturesMap.get(s);o?o.set(i,e):((o=new Map).set(i,e),t.texturesMap.set(s,o))}return}}}_updateTexture(e,t,r){var n=this[Ej],i=new Map;i.set(t,r),n.texturesMap.set(e,i)}_loadTexture(e,t,r){this._hookTexture(r),this._updateTexture(e,t,r)}_createTexture(e,t,r,n){var i=Tj(r);if(this.onCreateTexture){var a=this.onCreateTexture(e,r,n);return a&&this._loadTexture(t,i,a),a}return this.onCreateTextureAsync?this.onCreateTextureAsync(e,r,n).then((e=>(e&&this._loadTexture(t,i,e),e))):null}dispose(){var e,t=this[Ej];(e=t.texturesMap).forEach((e=>{e.forEach((e=>{e.release()}))})),e.clear()}load(e,t,r){void 0===t&&(t=wj),void 0===r&&(r=Cj);var n=this[Ej],i=Dj(e,BI.parseValue(r.flipY,!0));if(!i)return null;var a=n.texturesMap.get(i);if(!a)return this._createTexture(e,i,t,r);var s=function(e,t){var r=e.get(t);return r?r.disposed?(e.delete(t),null):r:null}(a,Tj(t));return s?s?(s.addRef(),s):void 0:this._createTexture(e,i,t,r)}loadAsync(e,t,r){void 0===t&&(t=wj),void 0===r&&(r=Cj);var n=this.load(e,t,r);return n?n.isBaseTexture?n.waitForComplete():n.then((e=>e.waitForComplete())):Promise.reject("Load '"+e+"' texture failed")}}var Pj={};function Fj(e){return BI.isString(e)?e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?$B.RGB:$B.RGBA:BI.isArray(e)?Fj(e[0]):$B.RGB}class Rj extends Mj{constructor(){super()}onCreateTexture(e,t,r){void 0===r&&(r=Pj);var n=Fj(e);return new DU({url:e,colorFormat:n,flipY:BI.parseValue(r.flipY,!0),wrapType:t.wrapS||t.wrapT,minFilterType:t.minFilter,magFilterType:t.magFilter})}}var Nj=Symbol("private");class Bj extends Mj{constructor(){super(),this[Nj]={};var e=this[Nj];e.storage=BI.createObject("LocalStorageDB"),e.storage.open("compressedTextureManager")}onCreateTextureAsync(e,t){var r=this[Nj];return new Promise(((n,i)=>{r.storage.read(e,(r=>{var i=r.data;i?(i.transferable=!0,new DU({url:e,data:i,type:"Basis",wrapType:t.wrapS||t.wrapT,minFilterType:t.minFilter,magFilterType:t.magFilter}).waitForComplete().then((e=>{n(e)}))):n(null)}))}))}saveFromImageFile(e){var t=this[Nj];BI.encodeImageFromURL("Basis",e,(r=>{var n=r.data;t.storage.write(e,n)}),(t=>{BI.error("Encode '"+e+"' image failed")}),{quality:128,mipmaps:!0,url:e})}saveFromPixelBufferInRGBA(e,t){}}var Ij=Symbol("private");class Oj{constructor(e){void 0===e&&(e={}),this[Ij]={};var t=this[Ij];t.enable=BI.parseValue(e.enable,!1),t.caches=new It}_createCache(e){return this[Ij].caches.set(e,{blueprints:[]})}_getCache(e){var t=this[Ij];return!!t.enable&&t.caches.get(e)}dispose(){this[Ij].caches.clear((e=>{e.blueprints.forEach((e=>{e.dispose()}))}))}getBodyData(e){var t=e.info.files,r=[];for(var n in t){var i=t[n].body;r.push(i)}return r}loadAsync(e){var t=this;return new Promise(pB((function*(r,n){var i=t._getCache(e);if(i)i.pendingPromise.then((()=>{var e=i.blueprints.map((e=>e.clone()));r(e)}));else{i=t._createCache(e);var a=yield BI.loadJSONFileAsync(e),s=t.getBodyData(a),o=[];s.forEach((e=>{var t=BI.createObject("Blueprint",{app:BI.getCurrentApp()});t.load({data:e}),o.push(t)})),i.blueprints=o,i.pendingPromise.resolve(),r(o)}})))}}var kj=Symbol("private"),Lj=1,Uj=["opacity","metalness","roughness","color","emissive"];function zj(e){var t="";for(var r in e){t+=r+":"+e[r]}return t}function jj(e){return e.offset+";"+e.repeat+";"+e.center+";"+e.rotation+";"}function Vj(e){var t=e.getValuesWithDefaults();Uj.forEach((e=>{var r=t.data[e];BI.isFunction(r)&&r.isConstantValue&&(t.data[e]=r())}));var r=function(e){var t=e.clippingPlanes;return t&&(t=t.uuid),e.blendingType+";"+t+";"+e.depthTest+";"+e.depthWrite+";"+e.envMapping+";"+e.outlineColor+";"+e.sideType+";"+e.transparent+";"+e.wireframe+";"+e.color+";"+e.emissive+";"+e.metalness+";"+e.opacity+";"+e.roughness}(t.data);if(t.edge&&(r+=function(e){return e.enable+";"+e.color+";"+e.opacity+";"+e.glow+";"}(t.edge)),t.effect&&(r+=function(e){return e.glow+";"+e.innerGlow+";"+e.lineBloom+";"+e.tailing+";"+e.radial+";"+e.ghosting+";"}(t.effect)),t.imagesData&&(r+=function(e){return e.map+";"+e.envMap+";"+e.alphaMap+";"+e.emissiveMap+";"+e.normalMap+";"+e.colorMapping+";"+e.aoMap+";"}(t.imagesData)),t.uvData)for(var n in t.uvData){r+=n+":"+jj(t.uvData[n])}if(t.images)for(var i in t.images){var a=t.images[i];a&&a.isBaseTexture&&(r+=i+":"+a.uuid)}return r+=zj(e.attributes),r+=zj(e.macros),r+=function(e){var t={};for(var r in e){var n=e[r];BI.isValid(n)&&BI.isFunction(n.toUniform)?t[r]=n.toUniform().key:t[r]=n}return zj(t)}(e.uniforms),r}class Gj{constructor(e){void 0===e&&(e={}),this[kj]={};var t=this[kj];t.groups=new Map,t.initialInstancedMaxCount=BI.parseValue(e.initialInstancedMaxCount,8),t.instancedGrowFactor=BI.parseValue(e.instancedGrowFactor,1.2),t.instancedMaxCount=BI.parseValue(e.instancedMaxCount,2048),t.threshold=16,t.flags=new Wt,t.flags.enable(Lj,BI.parseValue(e.autoTidyUp,!0))}_getInstancedGroupName(e){return e.instanceGroupName||e.resource.url}_getUniqueKeyFromObject(e){return this._getInstancedGroupName(e)+";"+Vj(e.body.style)}_findBestStyleGroup(e){for(var t=this[kj],r=0;r<e.length;r++){var n=e[r];if(n.refCount<t.instancedMaxCount)return n}return e[e.length-1]}_copyStyleResource(e,t){e.copy(t),["OpacityOp"].forEach((r=>{var n="get"+r,i="set"+r;if(e[n]()){var a=t[n]()(1);if(t[n]().isConstantValue){var s=e=>a;s.isConstantValue=!0,e[i](s)}else e[i]((e=>a*e))}})),["ColorOp","EmissiveOp","RoughnessOp","MetalnessOp"].forEach((r=>{var n="get"+r,i="set"+r;if(e[n]()){var a=t[n]()();e[i]((()=>a))}}))}_cloneStyleResource(e){var t=this[kj],r=BI.createObject("Style",{instancedMaxCount:t.initialInstancedMaxCount});return this._copyStyleResource(r,e),r.enable("InstancedDrawing",!1),r}_createStyleResource(e,t){var r,n=this[kj];return t.instancedDrawing?(r=BI.createObject("Style",{instancedMaxCount:n.initialInstancedMaxCount}),this._copyStyleResource(r,e.resource),r.setInstancedMaxCount(n.initialInstancedMaxCount),r.enable("InstancedDrawing",!1)):(r=BI.createObject("Style"),this._copyStyleResource(r,e.resource)),r}_createStyleGroupInfo(e,t,r){return{dirtyCount:0,refCount:1,subNodeNumber:e,resource:t,instancedDrawing:BI.parseValue(r.instancedDrawing,!0)}}_createStyleGroupInfoFromObject(e,t,r){var n=Math.max(1,e.bodyNode.getSubNodeNumber({filter:e=>!!e.isRenderable}));return this._createStyleGroupInfo(n,t,r)}_needEnableInstancedDrawing(e){var t=this[kj];return!(e.refCount*e.subNodeNumber<t.threshold)}_addGroup(e,t,r){var n=this[kj],i=[r];i._key_=t,e._group_=r,e._groups_=i,n.groups.set(t,i)}_getGroup(e,t,r){var n=this[kj],i=n.groups.get(e);if(i){var a=this._findBestStyleGroup(i);if(a.refCount==n.instancedMaxCount){var s=this._createStyleResource(a,r);a=this._createStyleGroupInfoFromObject(t,s,r),s._group_=a,s._groups_=i,i.push(a)}else if(a.refCount++,a.instancedDrawing){var o=a.resource;if(a.refCount>=o.getInstancedMaxCount()){var l=Math.max(1,Math.floor(a.refCount*n.instancedGrowFactor)),u=Math.min(a.refCount+l,n.instancedMaxCount);o.setInstancedMaxCount(u)}else this._needEnableInstancedDrawing(a)&&o.enable("InstancedDrawing",!0)}return a}var c=t.bodyNode.getStyle(),h=this._cloneStyleResource(c),d=this._createStyleGroupInfoFromObject(t,h,r);return this._addGroup(h,e,d),d}dispose(){var e=this[kj];e.groups.forEach((e=>{e.forEach((e=>{e.style.dispose()}))})),e.groups.clear()}hasStyle(e){return!!e._groups_&&!!e._group_}createStyleFromObject(e,t){var r=this._getUniqueKeyFromObject(e);return this._getGroup(r,e,t).resource}releaseStyle(e){var t=this[kj];if(this.hasStyle(e)){var r=e._groups_,n=e._group_;n.refCount--,0===n.refCount?(n.resource.dispose(),BI.removeFromArray(r,n),r.length||t.groups.delete(r._key_)):n.instancedDrawing&&(1!=n.refCount&&this._needEnableInstancedDrawing(n)?t.flags.has(Lj)&&(n.dirtyCount++,n.dirtyCount>t.instancedMaxCount&&(n.dirtyCount=0,n.resource.tidyUpInstanceBuffer())):n.resource.enable("InstancedDrawing",!1))}else e.dispose()}hasStyle(e){return!(!e._groups_&&!e._group_)}getGroupRefCount(e){var t=e._group_;return t?t.refCount:0}get threshold(){return this[kj].threshold}set threshold(e){this[kj].threshold=e}get groups(){return this[kj].groups}get resources(){var e=this[kj],t={instancedDrawing:{number:0,totalNumber:0,cacheHitPercentage:0}},r=t.instancedDrawing;return e.groups.forEach((e=>{e.forEach((e=>{r.number+=e.refCount,r.totalNumber+=e.resource.getInstancedMaxCount()}))})),r.cacheHitPercentage=r.number/r.totalNumber,t}}QI.createMat4();var Wj=Symbol("private"),Hj={load:function(){},loadAsync:function(){return Promise.reject()}},qj={},Xj={};function Qj(e){var t=e.children;if(t){var r=0;return t.forEach((e=>{r+=Qj(e)})),r}return 1}function Kj(e,t,r,n,i,a){var s=t.localPosition;s&&e.setPosition(s);var o=t.localQuaternion;o&&e.setQuaternion(o);var l=t.localScale;l&&e.setScale(l);var u=t.url;if(u)_private.resourceManager.loadModel(u,(t=>{e.add(t.node),n(t)}),(e=>{i(e)}),(e=>{a(e)}),r);else if(t.children){var c=BI.createObject("Node");e.add(c),t.children.forEach((e=>{Kj(c,e,r,n,i,a)}))}}class Yj{constructor(e){void 0===e&&(e={}),this[Wj]={};var t=this[Wj];t.textureManager=null,t.compressedTextureManager=null,t.parserManager=BI.createObject("ParserManager"),t.resourceManager=BI.createObject("ResourceManager"),t.styleGroupPool=new Gj({initialInstancedMaxCount:e.initialInstancedMaxCount,instancedGrowFactor:e.instancedGrowFactor,instancedMaxCount:e.instancedMaxCount,autoTidyUp:e.autoTidyUp}),this._initTextureManager(e.textureManager),this._initBlueprintManager(e.blueprintManager)}_loadObjectResource(e,t,r,n){this[Wj].resourceManager[e](t.resource.url,(function(e){if(!t.destroyed){var r=e.node,i=n.onBeforeSetup;i&&i(e),t.body.setNode(r);var a=n.onSetup;a&&a(e);var s=n.onLoad;s&&s({object:t})}}),(function(e){t.trigger(SB.Progress,e);var r=n.onProgress;r&&r({object:t,progress:e.progress})}),(function(e){BI.isString(e)&&(e={desc:e}),BI.error(e),t.trigger(SB.Error,e);var r=n.onError;r&&r({object:t,error:e})}),r)}_loadImageTextureAsync(e,t){return this[Wj].textureManager.loadAsync(e,t,{flipY:!1}).then((e=>e.getTextureResource())).catch((()=>null))}_isSupportImageFile(e){var t=e._getExtension();return"png"==(t=t.toLowerCase())||("jpeg"==t||"jpg"==t)||"tga"==t}_initTextureManager(e){var t=this;void 0===e&&(e={});var r,n=this[Wj];n.textureManager=new Rj,BI.parseValue(e.dynamicEncodeCompressedTexture,!1)&&(n.compressedTextureManager=new Bj),BI.parseValue(e.enableTextureCache,!0)&&n.resourceManager.setTextureOptions({onLoadTexture:(r=pB((function*(e,r){if(!e)return null;if(n.compressedTextureManager){var i=yield n.compressedTextureManager.load(e,r);return i?Promise.resolve(i.getTextureResource()):t._loadImageTextureAsync(e,r).then((r=>(t._isSupportImageFile(e)?n.compressedTextureManager.saveFromImageFile(e):n.compressedTextureManager.saveFromPixelBufferInRGBA(e,r),r)))}return t._loadImageTextureAsync(e,r)})),function(e,t){return r.apply(this,arguments)})})}_initBlueprintManager(e){this[Wj].blueprintManager=new Oj(e)}dispose(){var e=this[Wj];e.textureManager&&(e.textureManager.dispose(),e.textureManager=Hj),e.compressedTextureManager&&(e.compressedTextureManager.dispose(),e.compressedTextureManager=null),e.blueprintManager&&(e.blueprintManager.dispose(),e.blueprintManager=null),e.parserManager=null,e.resourceManager=null,e.styleGroupPool.dispose(),e.styleGroupPool=null,e.nodePool&&(e.nodePool.dispose(),e.nodePool=null)}parseParticle(e,t){return this[Wj].parserManager.parseParticle(e,t)}parseModel(e,t){return this[Wj].parserManager.parseModel(e,t)}loadObjectResource(e,t,r){void 0===t&&(t=Xj),void 0===r&&(r=qj);var n=e.resource;if(n.url){var i=n.url.split("/"),a=i[i.length-1];if(!(a&&a._getExtension()))return void BI.error("The Community Edition does not support load directory");this._loadObjectResource("loadModel",e,t,r)}else if(n.children){var s=0,o=Qj(n),l=BI.createObject("Node");Kj(l,n,t,(t=>{var n={progress:++s/o};e.trigger(SB.Progress,n);var i=r.onProgress;if(i&&i({object:e,progress:n.progress}),s==o){e.body.setNode(l);var a=r.onLoad;a&&a(t)}}),(e=>{}),(t=>{BI.error(t),e.trigger(SB.Error,t);var n=r.onError;n&&n({object:e,error:t})}))}else{var u=r.onLoad;u&&u()}}loadModel(e,t,r,n,i){this[Wj].resourceManager.loadModel(e,t,r,n,i)}loadModelAsync(e,t){var r=this;return new Promise(((n,i)=>{r.loadModel(e,(e=>{n(e)}),(()=>{}),(e=>{i(e)}),t)}))}loadParticle(e,t,r,n,i){this[Wj].resourceManager.loadParticle(e,t,r,n,i)}getBlueprintBodyData(e){return this[Wj].blueprintManager.getBodyData(e)}loadBlueprintAsync(e){return this[Wj].blueprintManager.loadAsync(e)}preloadTextures(e){return this[Wj].resourceManager.preloadTextures(e)}loadCompressedTextureData(e,t,r,n){return this[Wj].resourceManager.loadCompressedTextureData(e,t,r,n)}getStyleGroupPool(){return this[Wj].styleGroupPool}getNodePool(){return this[Wj].nodePool}getTextureManager(){return this[Wj].textureManager}}var Zj=Symbol("private"),Jj=1,$j=2,eV=1,tV=[],rV={},nV={};function iV(e,t){if(e.priority!=t.priority){if(4294967295==e.priority)return-1;if(4294967295==t.priority)return 1}return e.useCapture&&!t.useCapture?-1:!e.useCapture&&t.useCapture?1:e.priority==t.priority?e.__index-t.__index:t.priority-e.priority}function aV(e,t,r){return t?r?e.orderId+"|"+t+"|"+r:e.orderId+"|"+t:r?e.orderId+"|"+r:QI.generateUUID()}function sV(e,t){var r=e.get(t.object);r?r.push(t):e.set(t.object,[t])}function oV(e,t){e&&e.forEach((e=>{var r=e.indexOf(t);-1!==r&&e._removeAt(r)}))}function lV(e,t){var r=t.key,n=e.caches.get(r);n&&n.removed&&e.caches.delete(r),oV(e.listenerMap,t),oV(e.captureListeners,t),oV(e.conditionalListeners,t),e.sortedListeners.clear()}function uV(e,t){void 0===t&&(t={});var r=BI.onBeforeCallEventListener;r&&r(e,t);var n=e.callback(t,e.tag),i=BI.onAfterCallEventListener;return i&&i(e,t),e.once&&(e.removed=!0),n}function cV(e,t){tV.length=0;for(var r=tV,n=t.parent;n;n=n.parent){if(e.captureListeners){var i=e.captureListeners.get(n);i&&(r=r.concat(i))}if(e.conditionalListeners){var a=e.conditionalListeners.get(n);a&&(r=r.concat(a))}}if(e.conditionalListeners){var s=e.conditionalListeners.get(t);s&&(r=r.concat(s))}var o=e.listenerMap.get(t);return o&&(r=r.concat(o)),r.sort(iV),r}function hV(e,t){if(e.useCapture){for(var r=t;r;r=r.parent)if(hk.test(e.condition,r))return r}else if(hk.test(e.condition,t))return t;return null}function dV(e,t,r,n,i){return e.type==r&&((!n||e.condition==n)&&((!i||e.tag==i)&&!(e.object&&e.object!=t&&!e.object.isChildOf(t))))}class pV{constructor(){this[Zj]={};var e=this[Zj];e.hookers={},e.tickableListeners=[],e.pausedEvents=[],e.stateGroup=new br,e.stateGroup.enable(!0,"default",1e3)}_createListener(e,t,r,n,i,a){var s={__index:eV++,type:e,key:"",condition:null,object:t,callback:n,tag:i,priority:a.priority,once:a.once,useCapture:a.useCapture,enumerable:a.enumerable,pausable:a.pausable,flags:new Wt};return Object.defineProperties(s,{removed:{get:function(){return this.flags.has(Jj)},set:function(e){if(this.removed!=e&&(this.flags.enable(Jj,e),e)){var t=this.callback.onRemove;t&&t();var r=BI.onRemoveEventListener;r&&r(this),this.callback=null}}},paused:{get:function(){return this.flags.has($j)},set:function(e){this.pausable&&this.flags.enable($j,e)}},activated:{get:function(){return!this.removed&&!this.paused}}}),r&&BI.isString(r)&&(s.condition=r),s}_collectEvents(e){var t=[];return e.forEach((e=>{if(!e.removed&&e.enumerable){var r={type:e.type,callback:e.callback,tag:e.tag,priority:e.priority,once:e.once,paused:e.paused,enumerable:e.enumerable,pausable:e.pausable};e.condition&&(r.condition=e.condition),t.push(r)}})),t}_traverseAllListeners(e,t,r,n){var i=this[Zj].hookers,a=function(){var a=i[s];r&&r(a,s),a.listenerMap.forEach((r=>{for(var n=0;n<r.length;n++){var i=r[n];if(t&&!t(i))return;e(i,a)}})),n&&n(a,s)};for(var s in i)a()}_removeAllListeners(e,t){var r=e.listenerMap.get(t);if(r){var n=this[Zj];r.forEach((t=>{t.removed=!0,"update"==t.type&&BI.removeFromArray(n.tickableListeners,t),e.caches.delete(t.key)})),e.listenerMap.delete(t);var i=e.captureListeners;i&&i.delete(t);var a=e.conditionalListeners;a&&a.delete(t)}e.sortedListeners.clear()}_dispatchEvent(e,t,r,n){var i=function(e,t){var r=e.sortedListeners.get(t);return r||(r=cV(e,t),cV(e,t.app.root).forEach((e=>{-1===r.indexOf(e)&&r.push(e)})),r.sort(iV),e.sortedListeners.set(t,r)),r}(e,t);if(i.length){var a,s=n.tag,o=!1;void 0===r.object&&t&&(r.object=t,o=!0);for(var l=0;l<i.length;l++){var u=i[l],c=!1;if(u.removed)lV(e,u);else if(!(u.paused||s&&u.tag!=s)){if(u.condition){if(u.object&&!t.isChildOf(u.object))continue;var h=hV(u,t);if(!h)continue;void 0===r.target&&(c=!0,r.target=h)}else if(u.object!=t){if(!u.useCapture)continue;if(!t.isChildOf(u.object))continue;void 0===r.target&&(c=!0,r.target=u.object)}if(!u.pausable||!this.isPausedEvent(t,u)){var d=uV(u,r);a=a||d,c&&delete r.target}}}return o&&delete r.object,a}}_hasPausedEvent(e,t,r,n){for(var i=this[Zj].pausedEvents,a=0;a<i.length;a++){var s=i[a];if(s.object==e&&(s.type==t&&(!s.tag||s.tag==n)&&s.condition==r))return!0}return!1}_getPausedEvent(e,t,r,n){for(var i=this[Zj].pausedEvents,a=0;a<i.length;a++){var s=i[a];if(s.object==e&&(s.type==t&&(!s.tag||s.tag==n)&&s.condition==r))return s}return null}dispose(){var e=this[Zj];this._traverseAllListeners(((e,t)=>{this._removeAllListeners(t,e.object)})),e.hookers={},e.tickableListeners=[]}update(e){var t=this[Zj];rV.deltaTime=e;for(var r=t.tickableListeners,n=0;n<r.length;n++){var i=r[n];i.paused||(rV.object=i.object,uV(i,rV))}}addEventListener(e,t,r,n,i,a){void 0===a&&(a={});var s=this[Zj];s.hookers[e]=s.hookers[e]||{listenerMap:new Map,caches:new Map,conditionalListeners:null,captureListeners:null,sortedListeners:new Map};var o=s.hookers[e];i&&this.removeEventListener(e,t,r,i);var l=this._createListener(e,t,r,n,i,a);!function(e,t){t.key=aV(t.object,t.condition,t.tag),e.caches.set(t.key,t),sV(e.listenerMap,t),t.condition?(e.conditionalListeners=e.conditionalListeners||new Map,sV(e.conditionalListeners,t)):t.useCapture&&(e.captureListeners=e.captureListeners||new Map,sV(e.captureListeners,t)),e.sortedListeners.clear()}(o,l);var u=BI.onAddEventListener;return u&&u(l),"update"==e&&(s.tickableListeners.push(l),s.tickableListeners.sort(iV)),this.isPausedEvent(t,l)&&(l.paused=!0),l}removeEventListener(e,t,r,n){var i=this[Zj],a=i.hookers[e];if(a)if(r||n){var s=function(e,t,r,n){var i=aV(t,r,n);return e.caches.get(i)}(a,t,r,n);if(!s)return;s.removed=!0,"update"==e&&BI.removeFromArray(i.tickableListeners,s)}else a.listenerMap.forEach((r=>{for(var n=0;n<r.length;n++){var a=r[n];a.object==t&&(a.removed=!0,"update"==e&&BI.removeFromArray(i.tickableListeners,a))}}))}removeAllEventListeners(e){this._traverseAllListeners(((t,r)=>{t.object==e&&this._removeAllListeners(r,e)}),null,(t=>{t.sortedListeners.delete(e)}),null)}traverseListener(e){this._traverseAllListeners(e,(e=>e.enumerable))}traverseListenerByType(e,t){var r=this[Zj].hookers[e];r&&r.listenerMap.forEach((e=>{for(var n=0;n<e.length;n++){var i=e[n];t(i,r)}}))}getEventListener(e,t,r,n){var i=this[Zj].hookers[e];if(!i)return null;var a=i.listenerMap.get(t);if(!a)return null;for(var s=0;s<a.length;s++){var o=a[s];if(o.removed)lV(i,o),s--;else if(o.condition==r&&o.tag==n)return o}return null}getEventListeners(e,t,r){var n=r||[],i=this[Zj].hookers;for(var a in i)if(e==a){var s=i[a];if(s){var o=s.listenerMap.get(t);o&&n.push(...o)}}return n}getAllEventListeners(e){var t=this[Zj],r=[],n=t.hookers;if(e)for(var i in n){var a=n[i];if(a){var s=a.listenerMap.get(e);s&&(r=r.concat(this._collectEvents(s)))}}else for(var o in n){n[o].listenerMap.forEach((e=>{r=r.concat(this._collectEvents(e))}))}return r.sort(((e,t)=>e.type<t.type)),r}dispatchEvent(e,t,r,n){void 0===n&&(n=nV);var i=this[Zj].hookers[e];if(i){var a=t.getProxyObject(),s=a||t;if(!s.destroyed)return this._dispatchEvent(i,s,r||{},n)}}isPausedEvent(e,t){for(var r=this[Zj].pausedEvents,n=0;n<r.length;n++){var i=r[n];if(i.type==t.type&&((!i.tag||i.tag==t.tag)&&i.object.isChildOf(e)&&(!i.condition||e.test(i.condition))))return!0}return!1}pauseEvent(e,t,r,n){(t=t.toLowerCase(),this._hasPausedEvent(e,t,r,n))||(this[Zj].pausedEvents.push({object:e,type:t,condition:r,tag:n}),this.traverseListenerByType(t,(i=>{dV(i,e,t,r,n)&&(i.paused=!0)})))}resumeEvent(e,t,r,n){t=t.toLowerCase();for(var i=this[Zj].pausedEvents,a=0;a<i.length;a++){var s=i[a];s.object==e&&(s.type==t&&s.condition==r&&s.tag==n&&i.splice(a--,1))}this.traverseListenerByType(t,(i=>{dV(i,e,t,r,n)&&(i.paused=!1)}))}resumeAllEvents(e){for(var t=this[Zj].pausedEvents,r=0;r<t.length;r++){t[r].object==e&&t.splice(r--,1)}this._traverseAllListeners((t=>{t.object&&t.object!=e&&!t.object.isChildOf(e)||(t.paused=!1)}))}invokeListener(e,t){if(e.activated)return uV(e,t)}get stateGroup(){return this[Zj].stateGroup}get enable(){return this[Zj].stateGroup.isEnable()}set enable(e){this[Zj].stateGroup.enable(e,"default",1e3)}}var fV=Symbol("private");function mV(e,t){var r=e.onProcessPickObject||e.constructor.onProcessPickObject;r&&r(t,e)}function gV(e,t,r){var n={type:e,object:t,x:r.x,y:r.y,deltaX:r.deltaX,deltaY:r.deltaY,altKey:r.altKey,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey,pickedId:r.pickedId,subNodeName:r.subNodeName};return r.target&&(n.target=r.target),n}class _V extends pV{constructor(){super(),this[fV]={};var e=this[fV];e.hoverInfo={object:null,pickedId:null},e.app=BI.getCurrentApp(),e.app.delegate.addEventListener("*",(t=>{var r=this._processEventInfo(t),n=t.type;"mousemove"==n?(this._processMouseLeave(r,t),this._processMouseEnter(r,t)):("mouseleave"==n||"domenter"==n)&&this._processMouseLeave(r,t),r?this.dispatchEvent(n,r,t,{}):!function(e){return!!function(e){switch(e.type){case"keyup":case"keydown":case"keypress":return!0}return!1}(e)}(t)?(t.object=null,t.subNodeName="",this.dispatchEvent(n,e.app.root,t,{})):this.traverseListenerByType(n,(e=>{t.object=e.object,this.invokeListener(e,t)}))}))}_processPick(e){var t=this[fV].app.renderCamera.pick(e.x,e.y);if(!t)return null;var r=t.object;return r&&(r=function(e,t){var r=e;if(r.getProxyObject())do{mV(r,t),r=r.getProxyObject()}while(r.getProxyObject());return r}(r,e),mV(r,e)),e.subNodeName=t.subNodeName,e.external=t.external,void 0!==t.pickedId&&(e.pickedId=t.pickedId),Object.defineProperties(e,{pickedPosition:{get:()=>t.position},normal:{get:()=>t.normal}}),r}_needProcessPick(e){var t=this[fV].app.picker;return"mouseup"==e.type?t.stateGroup.isEnableByFilter((e=>"OrbitControls-start"!=e)):t.enable}_processEventInfo(e){if("domenter"==e.type)e.target=null;else if(function(e){switch(e.type){case"mousedown":case"mouseup":case"mousemove":case"pointerdown":case"pointerup":case"pointermove":case"click":case"dblclick":return!0}return!1}(e)&&(e.buttonType=BI.parseMouseButtonType(e.button),this._needProcessPick(e)))return this._processPick(e);return null}_processMouseLeave(e,t){var r=this[fV];if(r.app.picker.enable){var n=r.hoverInfo;if(n.object&&n.object!=e){var i=gV("mouseleave",n.object,t);BI.isValid(n.pickedId)&&(i.pickedId=n.pickedId),this.dispatchEvent(i.type,i.object,i,{}),n.object=null,n.pickedId=null}}}_processMouseEnter(e,t){var r=this[fV];if(r.app.picker.enable&&e){var n=r.hoverInfo;if(n.object!=e){var i=gV("mouseenter",e,t);this.dispatchEvent(i.type,i.object,i,{}),n.object=e,BI.isValid(t.pickedId)?n.pickedId=t.pickedId:n.pickedId=null}}}get curHoverObject(){var e=this[fV].hoverInfo;return e?e.object:null}}var vV=Symbol("private");class yV{constructor(){this[vV]={};var e=this[vV];e.objects=[],e.objectIdMaps=new Map,e.tickableObjects=[],e.resizableObjects=[],e.dirtyObjects=[],e.lateUpdateObjects=[]}_buildObjectGCKey(e){var{type:t,name:r,id:n,uuid:i}=e;return"type: '"+t+"', name: '"+r+"', id: '"+n+"', uuid: '"+i+"'"}dispose(){var e=this[vV];e.objects=[],e.objectIdMaps.clear(),e.tickableObjects=[],e.resizableObjects=[],e.dirtyObjects=[],e.lateUpdateObjects=[]}resize(e,t){for(var r=this[vV].resizableObjects,n=0,i=r.length;n<i;n++)r[n].onResize(e,t)}update(e){var t=this[vV],r=t.dirtyObjects;if(r.length){for(var n=0,i=r.length;n<i;n++)r[n].onRefresh();r.length=0}for(var a=t.tickableObjects,s=0,o=a.length;s<o;s++){var l=a[s];l.isWaitingForUpdate||l.onUpdate(e)}}lateUpdate(e){for(var t=this[vV].lateUpdateObjects,r=0,n=t.length;r<n;r++)t[r].onLateUpdate(e)}getBaseObjectFromOrderID(e){return this[vV].objectIdMaps.get(e)}getBaseObjectFromNode(e){for(var t=this[vV],r=e;r;){var n=r.getUserData().baseObject_orderID;if(n)return t.objectIdMaps.get(n);r=r.getParent()}return null}addObject(e){var t=this[vV];t.objectIdMaps.set(e.orderId,e),t.objects.push(e)}removeObject(e){var t=this[vV];t.objectIdMaps.delete(e.orderId),BI.removeFromArray(t.objects,e),BI.removeFromArray(t.tickableObjects,e),BI.removeFromArray(t.resizableObjects,e)}addDirtyObject(e){this[vV].dirtyObjects.push(e)}removeDirtyObject(e){var t=this[vV];BI.removeFromArray(t.dirtyObjects,e)}addTickableObject(e){this[vV].tickableObjects.push(e)}insertTickableObject(e,t){this[vV].tickableObjects._insert(e,t)}removeTickableObject(e){var t=this[vV];BI.removeFromArray(t.tickableObjects,e)}addResizableObject(e){this[vV].resizableObjects.push(e)}removeResizableObject(e){var t=this[vV];BI.removeFromArray(t.resizableObjects,e)}addLateUpdateObject(e){this[vV].lateUpdateObjects.push(e)}removeLateUpdateObject(e){var t=this[vV];BI.removeFromArray(t.lateUpdateObjects,e)}get gc(){return null}get objects(){return this[vV].objects}get tickableObjects(){return this[vV].tickableObjects}get lateUpdateObjects(){return this[vV].lateUpdateObjects}get resizableObjects(){return this[vV].resizableObjects}get dirtyObjects(){return this[vV].dirtyObjects}}var xV=Symbol("private"),bV=1;function AV(e){return BI.isNumber(e)||BI.isArray(e),{value:e}}function SV(e){var t=e._times_value;(void 0===t||t<0)&&e.repeat(1/0)}class EV{constructor(){this[xV]={};var e=this[xV];e.flags=new Wt,e.flags.enable(bV,!0),e.elapsedTimeMilliseconds=0,e.tickTimeMilliseconds=0}dispose(){mc.removeAll()}now(){var e=this[xV],t=BI.getCurrentTimeMilliseconds()-e.tickTimeMilliseconds;return e.elapsedTimeMilliseconds+t}update(e){var t=this[xV];t.flags.has(bV)&&(t.tickTimeMilliseconds=BI.getCurrentTimeMilliseconds(),t.elapsedTimeMilliseconds+=1e3*e,mc.update(t.elapsedTimeMilliseconds))}lerpTo(e,t,r,n){void 0===r&&(r=1e3),void 0===n&&(n=0);var i,a=AV(e),s=AV(t),o=this,l={_from:a,_to:s,start:function(){return i.start(o.now()),this},stop:function(){return BI.clearTimeout(i._startTimer),i.stop(),this},pause:function(){return this._onPause&&this._onPause({}),i.pause(),this},resume:function(){return this._onResume&&this._onResume({}),i.resume(),this},times:function(e){return i._times_value=e,e>0&&e--,i.repeat(e),this},easing:function(e){return i.easing(e),this},looping:function(e){switch(e){case wB.Repeat:SV(i),i.yoyo(!1);break;case wB.PingPong:SV(i),i.yoyo(!0);break;default:i.yoyo(!1)}return this},onRepeat:function(e){return this._onRepeat=e,this},onParseValue:function(e){return this._onParseValue=e,this},onStart:function(e){return this._onStart=e,this},onStop:function(e){return this._onStop=e,this},onResume:function(e){return this._onResume=e,this},onPause:function(e){return this._onPause=e,this},onUpdate:function(e){return this._onUpdate=e,this},onComplete:function(e){return this._onComplete=e,this}};return i=function(e,t,r,n,i){return new mc.Tween(e).to(t,r).delay(n).easing(i)}(a,s,r,n,mc.Easing.Linear.None),i.onRepeat((e=>{l._onRepeat&&l._onRepeat(e)})),i.onStart((e=>{l._onStart&&l._onStart(e)})),i.onParseValue(((e,t,r)=>{l._onParseValue&&l._onParseValue(e,t,r)})),i.onStop((e=>{l._onStop&&l._onStop(e)})),i.onUpdate(((e,t)=>{l._onUpdate&&l._onUpdate(e,t)})),i.onComplete((e=>{l._onComplete&&l._onComplete(e)})),i._startTimer=BI.setTimeout((()=>{i.start(o.now())}),0),l}get enable(){return this[xV].flags.has(bV)}set enable(e){this[xV].flags.enable(bV,e)}}class wV{constructor(){}onRun(e){}onStop(){}get app(){return BI.getCurrentApp()}}class CV extends wV{onRun(e){var t=this;return new Promise(((r,n)=>{var i=e.options;t.app.create(i).waitForComplete().then(r,n)}))}}class TV extends wV{onRun(e){var t=this;return new Promise(((r,n)=>{var i=e.options;i.object&&(i.target=i.object,delete i.object),i.complete=r,t.app.camera.flyTo(i)}))}}class DV extends wV{onRun(e){return new Promise(((t,r)=>{var n=e.options,i=e.object;i&&(i.style.color=n.color),t()}))}}var MV=Symbol("private");class PV{constructor(){this[MV]={};var e=this[MV];e.states=new Map,e.current=null,e.app=BI.getCurrentApp()}dispose(){var e=this[MV];e.states.clear(),e.current=null,e.app=null}update(e){this[MV]}register(e,t){return!!t&&(t.name=e,this[MV].states.set(e,t),!0)}change(e){var t=this[MV],r=this.get(e);if(!r.active&&t.current!=r){if(r.enter(),t.current){var n=t.current;n.active?t.current.leave():n=null,t.app.trigger(SB.LeaveState,{current:n,next:r})}t.app.trigger(SB.EnterState,{current:r,prev:t.current}),t.current=r}}set(e){var t=this[MV],r=this.get(e);return r.active||(r.enter(),t.app.trigger(SB.EnterState,{current:r,prev:null})),r}get(e){var t=this[MV].states.get(e);return t||null}leave(e){var t=this[MV],r=this.get(e);r.active&&(r.leave(),t.app.trigger(SB.LeaveState,{current:r,next:null}),t.current==r&&(t.current=null))}clear(){var e=this[MV];e.current&&(e.current.leave(),e.app.trigger(SB.LeaveState,{current:e.current,next:null}),e.current=null),e.states.forEach((t=>{t.active&&(t.leave(),e.app.trigger(SB.LeaveState,{current:t,next:null}))})),e.states.clear()}getActiveStates(){var e=this[MV],t=[];return e.states.forEach((e=>{e.active&&t.push(e)})),t}get current(){return this[MV].current}}var FV=Symbol("private");class RV{constructor(){this[FV]={};var e=this[FV];e.fixedDeltaTime=null,e.deltaTime=0,e.elapsedTime=0,e.currentFrameCount=0,e.enableFpsCounter=!0,e.fpsTimes=new Lt(120),e.maxFPS=null,e.fpsLimitedDelta=0,e.fpsLimitedPreviousDelta=0}_updateFPSCounter(){for(var e=this[FV].fpsTimes,t=BI.getCurrentTimeMilliseconds();e.size>0&&e.front<=t-1e3;)e.dequeue();e.enqueue(t)}_isInLimitedState(e){var t=this[FV],r=t.maxFPS;if(!r)return!1;t.fpsLimitedDelta+=e;var n=t.fpsLimitedDelta-t.fpsLimitedPreviousDelta,i=1/r,a=r&&n>=i;return a&&(t.fpsLimitedPreviousDelta=t.fpsLimitedDelta-n%i),!a}update(e){var t=this[FV];return t.fixedDeltaTime&&(e=t.fixedDeltaTime),this._isInLimitedState(e)?0:(t.deltaTime=e,t.elapsedTime+=e,t.currentFrameCount++,t.enableFpsCounter&&this._updateFPSCounter(),e)}get elapsedTime(){return this[FV].elapsedTime}get deltaTime(){return this[FV].deltaTime}get elapsedTimeMilliseconds(){return Math.floor(1e3*this.elapsedTime)}get deltaTimeMilliseconds(){return Math.floor(1e3*this.deltaTime)}get currentFrameCount(){return this[FV].currentFrameCount}get fixedDeltaTime(){return this[FV].fixedDeltaTime}set fixedDeltaTime(e){this[FV].fixedDeltaTime=e}get maxFPS(){return this[FV].maxFPS}set maxFPS(e){this[FV].maxFPS=e}get enableFpsCounter(){return this[FV].enableFpsCounter}set enableFpsCounter(e){this[FV].enableFpsCounter=e}get fpsCounter(){return this[FV].fpsTimes.size}}var NV=Symbol("private");class BV{constructor(){this[NV]={};var e=this[NV];e.fpsTimer=new RV,e.fpsTimer.maxFPS=15,e.colliders=[],e.matrixWorlds=[],e.connectedColliderMap=new WeakMap}dispose(){var e=this[NV];e.fpsTimer=null,e.colliders.length=0,e.connectedColliderMap=new WeakMap}update(e){var t=this[NV],r=t.colliders;if(r.length&&(e=t.fpsTimer.update(e))){for(var n=0;n<r.length;n++){var i=r[n],a=i.object.body.getRenderableNode();i.setMatrixWorld(a.getMatrixWorld(t.matrixWorlds[n],!1))}for(var s=0,o=r.length;s<o;s++)for(var l=r[s],u=t.connectedColliderMap.get(l),c=s+1;c<o;c++){var h=r[c];u.has(h)?l.test(h)||(l.onColliderLeave(h),h.onColliderLeave(l),u.delete(h)):l.test(h)&&(u.add(h),l.onColliderEnter(h),h.onColliderEnter(l))}}}add(e){var t=this[NV];t.colliders.push(e),t.matrixWorlds.push([]),t.connectedColliderMap.set(e,new WeakSet)}remove(e){var t=this[NV],r=t.colliders.indexOf(e);-1!==r&&(t.colliders.splice(r,1),t.matrixWorlds.splice(r,1)),t.connectedColliderMap.delete(e)}}var IV=Symbol("private");class OV{constructor(){this[IV]={},this[IV].relationships=[]}addRelationship(e){this[IV].relationships.push(e),this.notifyObjectAddRelationship(e.source,e),this.notifyObjectAddRelationship(e.target,e)}removeRelationship(e){var t=this[IV];BI.removeFromArray(t.relationships,e),this.notifyObjectRemoveRelationship(e.source,e),this.notifyObjectRemoveRelationship(e.target,e)}notifyObjectAddRelationship(e,t){e&&(BI.isArray(e)?e.forEach((e=>{e.addRelationship(t)})):e.addRelationship(t))}notifyObjectRemoveRelationship(e,t){e&&(BI.isArray(e)?e.forEach((e=>{e.removeRelationship(t)})):e.removeRelationship(t))}notifyRelationshipRemoveObject(e,t){e.releaseObject(t)}queryRelationships(e){void 0===e&&(e={});return this[IV].relationships.filter((t=>t.test(e)))}dispose(){var e=this[IV];e.relationships.forEach((e=>{e.destroy()})),e.relationships=[]}get relationships(){return this[IV].relationships}}var kV=Symbol("private");class LV extends vk{constructor(){super(),this[kV]={};var e=this[kV];e.frameRate=0,e.lastFrame=0,e.startTime=0,e.fpsTimer=new RV,e.onTick=null}_getDeltaTime(e){var t=this[kV],r=0;if(0===t.startTime)t.startTime=e,r=e;else{var n=Math.round((e-t.startTime)/t.frameRate);r=(n-t.lastFrame)*t.frameRate,t.lastFrame=n}return r}_updateLogger(e){var t=this.object,r=this[kV];if(r.loggerTime+=e,r.loggerTime>30){var n=t.objectManager,i={common:{tickableObjects:n.tickableObjects.length,lateUpdateObjects:n.lateUpdateObjects.length,objects:n.objects.length},render:{fps:this.fpsCounter}};BI.logger.api("frame",{msg:JSON.stringify(i)});var a=BI.logger.getApiCollector();if(a){var s=a.getApiCount();BI.logger.api("apiCount",{msg:JSON.stringify(s)}),a.clearApiCount()}r.loggerTime=0}}onAdd(e){super.onAdd(e)}onRemove(){var e=this[kV];e.fpsTimer=null,e.onTick=null,super.onRemove()}init(e){void 0===e&&(e={});var t=this[kV],r=BI.parseValue(e.frameRate,60);t.frameRate=1e3/r,t.lastFrame=0,t.startTime=0,t.onTick=e.onTick}update(e){var t=this[kV],r=this._getDeltaTime(e);(r=t.fpsTimer.update(r/1e3))&&t.onTick(r)}get elapsedTime(){return this[kV].fpsTimer.elapsedTime}get deltaTime(){return this[kV].fpsTimer.deltaTime}get currentFrameCount(){return this[kV].fpsTimer.currentFrameCount}get fixedDeltaTime(){return this[kV].fpsTimer.fixedDeltaTime}set fixedDeltaTime(e){this[kV].fpsTimer.fixedDeltaTime=e}get maxFPS(){return this[kV].fpsTimer.maxFPS}set maxFPS(e){this[kV].fpsTimer.maxFPS=e}get slowMotion(){return.001===this.fixedDeltaTime}set slowMotion(e){this.fixedDeltaTime=e?.001:null}get fpsCounter(){return this[kV].fpsTimer.fpsCounter}}LV.exportProperties=["elapsedTime","deltaTime","currentFrameCount","maxFPS","fpsCounter"];var UV=Symbol("private"),zV=["map"],jV={};function VV(e){for(var t=e.length,r=0,n=e.length;r<n;r++){var i=e[r];i.components&&t++,i.externalComponents&&t++,i.children&&(t+=VV(i.children))}return t}function GV(e){if(e)for(var t in e)e[t]._endsWith("/")||(e[t]+="/")}class WV{constructor(){this[UV]={};var e=this[UV];e.models=[],e.tags=[],e.images=[],e.info={number:0,totalNumber:0},e.version=new jo("1.0.0"),e.resources={},e.options={},e.modelRootPath="",e.textureRootPath="",e.objects=[],e.toolkit={getRootPath:function(){return e.options.rootPath||e.resources.rootPath},getTextureRootPath:function(){if(!e.textureRootPath){var t=this.getRootPath();e.textureRootPath=t.texture}return e.textureRootPath},getModelRootPath:function(){if(!e.modelRootPath){var t=this.getRootPath();e.modelRootPath=t.model}return e.modelRootPath},resolveURL:function(t){if(t._startsWith("http://")||t._startsWith("https://"))return t;var r=e.options.basePath;return r?r._appendURL(t):t},resolveTextureURL:function(e){return e._startsWith(".")?this.resolveURL(e):this.resolveURL(this.getTextureRootPath())._appendPath(e)},resolveModelURL:function(t,r){if(t._startsWith("http://")||t._startsWith("https://"))return t;if(t._startsWith("."))return this.resolveURL(t);var n=this.getModelRootPath()+t,i="",a=e.options.useLatestModel?0:r;return i=void 0!==a?n+"/"+a+"/gltf":n,this.resolveURL(i)}}}_getObjectClassType(e){var t=this[UV],r=BI.getRegisteredClasses()[e.type],n=t.options.onGetClassType;return n&&(r=n(e)||r),r}_getComponentClassType(e){var t=this[UV],r=BI.getRegisteredClasses()[e.type],n=t.options.onGetComponentClassType;return n&&(r=n(e)||r),r}_loadModels(e,t){for(var r=this[UV],n=0,i=e.length;n<i;n++){var a=e[n],s=BI.parseValue(a.version,0),o=a.url,l=a.size;if(o)if(l){var u=r.toolkit.resolveModelURL(o,s);QI.fixScaleFactor(l),r.models.push({url:u,size:l,initialLocalBoundingBox:{center:[0,l[1]/2,0],halfSize:QI.divideVector(l,2)}})}else t&&t("load model resource failed, due to size is invalid",a);else t&&t("load model resource failed, due to url is empty",a)}}_loadTags(e){this[UV].tags=e}_loadImages(e){for(var t=this[UV],r=BI.getCurrentApp().resourceManager.getTextureManager(),n=0,i=e.length;n<i;n++){var a=e[n],s=t.toolkit.resolveTextureURL(a.url),o=r.load(s,void 0,{flipY:!1});t.images.push(o)}}_buildBodyResource(e){var t=this[UV],r={},n=e.id;if(BI.isValid(n)){var i=t.models[n];i&&(r.url=i.url)}var a=e.position;a&&(r.localPosition=a);var s=e.quaternion;s&&(r.localAngles=QI.getAnglesFromQuat(s));var o=e.scale;o&&(r.localScale=QI.fixScaleFactor(o));var l=e.children;if(l){r.children=[];for(var u=0,c=l.length;u<c;u++){var h=l[u];r.children.push(this._buildBodyResource(h))}}return r}_buildStyle(e){var t=this[UV],r={};for(var n in e){var i=e[n];if(r[n]=i,zV.includes(n)){var a=t.images[i];if(!a)continue;r[n]=a}}return r}_loadComponents(e,t,r,n){var i=this[UV];e.onImportComponents(t,{args:n,onGetObjectClassType:e=>this._getComponentClassType(e),onGetComponentExternalData:i.options.onGetComponentExternalData,onError:r})}_loadTemporaryComponents(e,t,r,n,i,a,s){this._loadComponents(e,t,a,{isTemporary:!0,isEditor:r}),this._updateProgress(n,i,s)}_mapTags(e){var t=this[UV];return e.map((e=>t.tags[e]))}_onUpdateCreateOptions(e,t,r){e.onParseCreateOptions&&e.onParseCreateOptions(t,r);var n=r.onUpdateCreateOptions;n&&n(this[UV].options.owner,e,t)}_onCreateObject(e,t,r){var n=r.onCreateObject;n&&n(this[UV].options.owner,e,t)}_updateProgress(e,t,r){var n=this[UV],i=n.info;i.number++,t&&t({progress:i.number/i.totalNumber}),i.number==i.totalNumber&&(e&&e({objects:n.objects}),r(),n.objects.length=0)}_loadObjects(e,t,r,n,i,a,s,o){for(var l=this,u=this[UV],c=u.resources.uuids,h=BI.parseValue(u.options.assets,!0),d=BI.parseValue(u.options.hidden,!1),p=BI.parseValue(u.options.isEditor,!1),f=function(){var f=e[m],g=l._getObjectClassType(f);if(!g)return a&&a({err:"Create object failed in scene builder, due to 'THING["+f.type+"]' is not existing"}),"continue";var _,v=c?c[f.uuid]:null,y=f.id,x=f.name,b=f.visible,A=f.position,S=f.quaternion,E=f.scale,w=f.userData,C=f.tags,T=f.body,D=f.style,M=f.components,P=f.externalComponents;f.extras=f.extras||f.external,E&&QI.fixScaleFactor(E),C&&(C=l._mapTags(C));var F=g.parseExtrasData||g.parseExternalData;_=F?F({parentData:r,data:f,children:f.children||null,resources:u.resources,toolkit:u.toolkit,extras:u.options.extras||u.options.external||jV}):f.extras;var R,N={id:y,name:x,uuid:v,visible:b,localPosition:A,localQuaternion:S,localScale:E,userData:w,tags:C,parent:t,assets:h,extras:_,error:()=>{l._updateProgress(n,i,s)},syncComplete:()=>{l._updateProgress(n,i,s)}};T&&(R=l._parseBodyResource(T,a),N.url=R.url,N.nodeName=T.node),D&&(N.style=l._buildStyle(D)),l._onUpdateCreateOptions(g,N,u.options);var B=new g(N);if(d&&(B.visible=!1),u.objects.push(B),R&&!B.loaded)B.initialLocalBoundingBox=R.initialLocalBoundingBox;else if(T){var I=T.children;I&&I.length&&(B.setResource(l._buildBodyResource(T)),h&&B.loadResource(!1))}M&&(B.loaded?l._loadTemporaryComponents(B,M,p,n,i,a,s):B.waitForComplete().then((()=>{l._loadTemporaryComponents(B,M,p,n,i,a,s)}))),P?B.onImportExternalComponents(P).then((()=>{f.children&&l._loadObjects(f.children,B,N.extras,n,i,a,s,o),l._onCreateObject(B,N,u.options),l._updateProgress(n,i,s)})):(f.children&&l._loadObjects(f.children,B,N.extras,n,i,a,s,o),l._onCreateObject(B,N,u.options))},m=0,g=e.length;m<g;m++)f()}_parseResources(e,t){var r=this[UV];r.resources=e,GV(r.resources.rootPath),r.resources.uuid=r.resources.uuid||[],e.models&&this._loadModels(e.models,t),e.tags&&this._loadTags(e.tags),e.images&&this._loadImages(e.images)}_parseObjects(e,t,r,n,i,a,s,o){var l=this[UV],u=l.info;u.totalNumber+=VV(e),l.objects.length=0,u.totalNumber?this._loadObjects(e,t,r,n,i,a,s,o):(i&&i({progress:1}),n&&n({objects:l.objects}),s())}_copyOptions(e){var t=this[UV];t.options=Object.assign({},e),GV(t.options.rootPath),t.options.useLatestModel=BI.parseValue(t.options.useLatestModel,!0)}_parseBodyResource(e,t){var r=this[UV].models[e.id];return r||(t&&t("load model resource failed, due to body id('"+e.id+"') is invalid"),null)}_parseOwner(e,t,r,n,i,a,s){var o=this[UV],l=t.tags;l&&(e.tags=this._mapTags(l));var u=t.components;if(u){var c=BI.parseValue(o.options.isEditor,!1);this._loadComponents(e,u,i,{isTemporary:!0,isEditor:c})}var h=t.style;if(h){var d=e.body.style,p=this._buildStyle(h),f=e.options;for(var m in f&&f.style&&BI.mergeObject(p,f.style,!0),p)if(Object.hasOwnProperty.call(p,m)){var g=p[m];d[m]=g}}var _=t.body;if(_){var v=this._parseBodyResource(_,i);if(v)o.info.totalNumber++,BI.getCurrentApp().resourceManager.loadModelAsync(v.url).then((t=>{var i=t.node;e.setBodyNode(i);var s=_.position;s&&(e.body.localPosition=s);var o=_.quaternion;o&&(e.body.localQuaternion=o);var l=_.scale;l&&(e.body.localScale=l),this._updateProgress(r,n,a)})).catch((e=>{this.clear(),i&&i(e),s(e)}))}}clear(){var e=this[UV];e.models.length=0,e.tags.length=0,e.images.forEach((e=>{e.release()})),e.images.length=0;var t=e.info;t.number=0,t.totalNumber=0,e.modelRootPath="",e.textureRootPath="",e.resources={},e.options={}}parse(e,t,r,n,i){var a=this[UV];return new Promise(((s,o)=>{this.clear(),this._copyOptions(i);var l=e.resources,u=e.children||e.objects||[];this._parseResources(l,n);var c=a.options.owner;this._parseOwner(c,e,t,r,n,s,o),this._parseObjects(u,c,null,t,r,n,s,o)})).then((()=>{this.clear()})).catch((e=>{this.clear(),n&&n(e)}))}getVersion(){return this[UV].version}}var HV=Symbol("private");class qV{constructor(){this[HV]={};var e=this[HV];e.version=new jo("1.0.0"),e.objectParser=new WV}_onUpdateCreateOptions(e,t,r){var n=r.extras||r.external;if(n){var i=n.parent;if(!BI.isNull(i)){var a=e.find("[uuid="+i+"]",{includeSelf:!0});a&&(r.parent=a)}}}clear(){this[HV].objectParser.clear()}parse(e,t,r,n,i){var a=this[HV];i.onUpdateCreateOptions=i.onUpdateCreateOptions||this._onUpdateCreateOptions,a.objectParser.parse(e,t,r,n,i)}getVersion(){return this[HV].version}}var XV=Symbol("private"),QV=Le.toText("186,156,39,7,98,52,39,68,210,253");class KV{constructor(){this[XV]={};var e=this[XV];e.parsers={},e.parsers[uI.Object]=[new WV],e.parsers[uI.Layout]=[new qV]}_getParser(e,t){var r=SI();if(r&&r[QV])return{parse:function(e,t,r,n,i){t({id:QI.randomInt()})}};var n=this[XV].parsers[e];if(n)for(var i=(new jo).fromString(t.version||""),a=0;a<n.length;a++){var s=n[a];if(new jo(s.getVersion()).isCompatibleWith(i))return s}return null}load(e,t,r,n,i,a){BI.loadJSONFile(t,(s=>{e=e||t._getExtension(),this.parse(e,s.data,r,n,i,a)}),(e=>{}),(e=>{i&&i(e)}))}parse(e,t,r,n,i,a){void 0===a&&(a={});var s=this._getParser(e,t);if(!s)return i&&i("Parse scene failed, due to get parser failed"),null;BI.getCurrentApp().global.waitForComplete().then((()=>{s.parse(t,(e=>{r&&r({objects:e.objects})}),n,i,a)}))}registerParser(e,t){var r=this[XV];r.parsers[e]=r.parsers[e]||[],r.parsers[e].push(t)}}var YV=Symbol("private");class ZV extends QU{constructor(){super(),this[YV]={},this[YV].length=1e3}_getTargetPosition(){var e=this[YV],t=this.object;return zu.getPositionOnDirection(t.position,t.forward,-e.length)}onUpdate(e){var t=this._getTargetPosition();this.lineSegments.lookAt(t);var r=[0,0,0];this.lineSegments.worldToSelf(r,t),this.points[this.points.length-1]=r,this.lineSegments.setPoints(this.points),this.lineSegments.getStyle().setColorOp((()=>BI.parseColor(this.object.color)))}onAdd(e){super.onAdd(e),this.begin();this.addLine([-1,1,0],[1,1,0],[1,1,1]),this.addLine([1,1,0],[1,-1,0],[1,1,1]),this.addLine([1,-1,0],[-1,-1,0],[1,1,1]),this.addLine([-1,-1,0],[-1,1,0],[1,1,1]),this.addPoint([0,0,0],[1,1,1]),this.addPoint(e.worldToSelf(this._getTargetPosition()),[1,1,1]),this.end()}get length(){return this[YV].length}set length(e){this[YV].length=e}get size(){var e=[1,1,1];return this.lineSegments.getScale(e),e[0]}set size(e){this.lineSegments.setScale([e,e,1])}}class JV extends mj{constructor(e){void 0===e&&(e={}),super(e)}onCreate(e){super.onCreate(e),this.onAddTickableObject()}destroy(){return this.onRemoveTickableObject(),super.destroy()}get isBaseTickableObject3D(){return!0}}class $V extends JV{constructor(e){void 0===e&&(e={}),super(e)}onCopy(e){super.onCopy(e),this.color=e.color,this.intensity=e.intensity}onLoadResource(e,t,r){t()}onSetupComplete(e){super.onSetupComplete(e),BI.syncOptions(this,["color","intensity"],e,e.extras||e.external)}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"color",this),BI.setAttributeIfExist(e,"intensity",this),e}onAfterSetup(e){var t=this.bodyNode;t.setName(t.getType()),t.getUserData()[AB.BoundingBoxInheritType]=qB.Stop}get layerMask(){return BI.warn("Light object can not use layer mask now"),super.layerMask}set layerMask(e){BI.warn("Light object can not use layer mask now"),super.layerMask=e}get color(){var e=[0,0,0];return this.bodyNode.getColor(e),BI.colorToHexString(e)}set color(e){var t=BI.parseColor(e);this.bodyNode.setColor(t)}get intensity(){return this.bodyNode.getIntensity()}set intensity(e){this.bodyNode.setIntensity(e)}get isLight(){return!0}}var eG=Symbol("private");class tG extends aL{constructor(){super(),this[eG]={},this[eG].target=[0,0,0]}onLookAt(e,t){this[eG].target=e}get target(){return this[eG].target}set target(e){this.object.lookAt(e,{always:!1})}}var rG=Symbol("private");class nG extends vk{constructor(){super(),this[rG]={},this[rG].enable=!0}onSelfUpdate(e){return!0}onUpdate(e){this[rG].enable&&this.onSelfUpdate(e)}onRefresh(){}refresh(){this.onRefresh()}get enable(){return this[rG].enable}set enable(e){this[rG].enable=e}}var iG=Symbol("private");class aG extends nG{constructor(){super(),this[iG]={};var e=this[iG];e.lightSphere=null,e.lightSphereRadius=null,e.lightSphereShadowRadius=null,e.bindingObject=null,e.horzAngle=0,e.vertAngle=0,e.farFactor=2,e.autoUpdateLightSphere=!0,e.needRefresh=!1,e.refreshElapsedTime=0,e.refreshInterval=3e4}_refreshLightSphere(){var e=this[iG],t=e.bindingObject;t&&(e.lightSphere=t.bounding.getLightSphere(!1))}_refreshShadowRange(){var e=this.object;if(e.castShadow){var t=this[iG],r=t.lightSphere;if(!r)return;var n=this.onGetShadowRadius()||r.radius||1,i=e.shadowRange;i.width=2*n,i.height=2*n,i.far=n*t.farFactor}}_refresh(){var e=this[iG],t=e.lightSphere;if(t){var r=this.object,n=t.radius||1,i=t.center,a=QI.getOffsetFromAngles(e.horzAngle,e.vertAngle,n);QI.vec3.add(a,i,a),r.position=a,r.lookAt(i),this._refreshShadowRange()}}onGetRadius(){return this[iG].lightSphereRadius}onGetShadowRadius(){return this[iG].lightSphereShadowRadius}onUpdateLightSphere(e){var t=this[iG];t.lightSphere?t.autoUpdateLightSphere&&(t.refreshElapsedTime+=1e3*e,(t.needRefresh||t.refreshElapsedTime>=t.refreshInterval)&&(t.refreshElapsedTime=0,this._refreshLightSphere())):this._refreshLightSphere();var r=this.onGetRadius();r&&(t.lightSphere.radius=r)}onSelfUpdate(e){var t=this[iG];if(!t.bindingObject)return!1;this.onUpdateLightSphere(e);var r=t.lightSphere,n=this.object,i=r.center;return!(!t.needRefresh&&QI.exactEqualsVector3(n.target,i))&&(this._refresh(),t.needRefresh=!1,!0)}onRefresh(){this._refreshLightSphere(),this._refresh()}bind(e){this[iG].bindingObject=e,this.onRefresh()}get bindingObject(){return this[iG].bindingObject}get needRefresh(){return this[iG].needRefresh}set needRefresh(e){this[iG].needRefresh=e}get lightSphereRadius(){return this[iG].lightSphereRadius}set lightSphereRadius(e){var t=this[iG];t.lightSphereRadius=e,t.needRefresh=!0}get lightSphereShadowRadius(){return this[iG].lightSphereShadowRadius}set lightSphereShadowRadius(e){var t=this[iG];t.lightSphereShadowRadius=e,t.needRefresh=!0}get horzAngle(){return this[iG].horzAngle}set horzAngle(e){var t=this[iG];t.horzAngle=e,t.needRefresh=!0}get vertAngle(){return this[iG].vertAngle}set vertAngle(e){var t=this[iG];t.vertAngle=e,t.needRefresh=!0}get farFactor(){return this[iG].farFactor}set farFactor(e){this[iG].farFactor=e}get autoUpdateLightSphere(){return this[iG].autoUpdateLightSphere}set autoUpdateLightSphere(e){this[iG].autoUpdateLightSphere=e}get refreshInterval(){return this[iG].refreshInterval}set refreshInterval(e){this[iG].refreshInterval=e}}var sG=Symbol("private"),oG={isResident:!0};class lG extends $V{constructor(e){void 0===e&&(e={}),super(e),this[sG]={},this[sG].shadowRange=new ur({data:{width:64,height:64,near:.5,far:1e3},onChange:e=>{this.bodyNode.setShadowRange(e.data)}}),BI.isNull(e.shadowQuality)&&(this.shadowQuality=iI.High),BI.isNull(e.shadowBias)&&(this.shadowBias=-1e-4),BI.syncOptions(this,["enableShadow","shadowQuality","shadowBias","shadowRadius","shadowRange","target"],e,e.extras||e.external),this.onRefresh()}onDestroy(){var e=this[sG];e.shadowRange.dispose(),e.shadowRange=null,super.onDestroy()}onCopy(e){super.onCopy(e),this.enableShadow=e.enableShadow,this.shadowQuality=e.shadowQuality,this.shadowBias=e.shadowBias,this.shadowRadius=e.shadowRadius,this.shadowRange=e.shadowRange,this.target=e.target}onRefresh(){super.onRefresh(),this[sG].shadowRange.notifyChange()}onSetupComponent(e){super.onSetupComponent(e),this.addComponent(tG,"transform",oG),this.addComponent(aG,"adapter",oG)}onUpdate(e){super.onUpdate(e),this.bodyNode.updateShadow()}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"enableShadow",this),BI.setAttributeIfExist(e,"shadowQuality",this),BI.setAttributeIfExist(e,"shadowBias",this),BI.setAttributeIfExist(e,"shadowRadius",this),BI.setAttributeIfExist(e,"shadowRange",this),BI.setAttributeIfExist(e,"target",this),e}get enableShadow(){return this.castShadow}set enableShadow(e){this.castShadow=e}get castShadow(){return this.bodyNode.getCastShadow()}set castShadow(e){this.castShadow!=e&&(this.bodyNode.setCastShadow(e),this.adapter.needRefresh=!0)}get shadowQuality(){return this.bodyNode.getShadowQuality()}set shadowQuality(e){this.bodyNode.setShadowQuality(e)}get shadowBias(){return this.bodyNode.getShadowBias()}set shadowBias(e){this.bodyNode.setShadowBias(e)}get shadowRadius(){return this.bodyNode.getShadowRadius()}set shadowRadius(e){this.bodyNode.setShadowRadius(e)}get shadowRange(){return this[sG].shadowRange.dataProxy}set shadowRange(e){this[sG].shadowRange.merge(e)}get target(){return this.transform.target}set target(e){this.transform.target=e}get isBaseShadowLight(){return!0}}var uG={isResident:!0};class cG extends lG{constructor(e){void 0===e&&(e={}),super(e)}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("DirectionalLight"),super.onBeforeSetup(e)}onSetupComponent(e){super.onSetupComponent(e),this.addComponent(ZV,"helper",uG)}onBeforeDestroy(){return cG.keepAliveObject!=this&&super.onBeforeDestroy()}get isDirectionalLight(){return!0}}cG.keepAliveObject=null;class hG extends $V{constructor(e){void 0===e&&(e={}),super(e)}onCopy(e){super.onCopy(e),this.groundColor=e.groundColor}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("HemisphereLight"),super.onBeforeSetup(e)}onSetupComplete(e){super.onSetupComplete(e),BI.syncOptions(this,["groundColor"],e,e.extras||e.external)}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"groundColor",this),e}get groundColor(){var e=[0,0,0];return this.bodyNode.getGroundColor(e),BI.colorToHexString(e)}set groundColor(e){var t=BI.parseColor(e);this.bodyNode.setGroundColor(t)}get isHemisphereLight(){return!0}}var dG=Le.toText("186,156,39,7,98,52,39,68,210,253"),pG=QI.mat4.create(),fG={isTemporary:!1};function mG(e,t){BI.error(e),t&&t(e)}function gG(e){return!(!e||!e.type)}class _G{constructor(){}load(e,t,r,n,i){void 0===i&&(i={}),this.app=BI.getCurrentApp();var a=[];if(this._onGetComponentClassType=i.onGetComponentClassType,this._onGetComponentExternalData=i.onGetComponentExternalData,e){var s=BI.parseBoolean(i.isScene,!0),o=i.parent;if(s&&!o){var l=SI();if(l&&l[dG])return void(t&&t({objects:a}));this._loadScene(e,t,r,n,i,a)}else this._loadPartScene(e,t,r,n,i,a)}else t&&t({objects:a})}_loadScene(e,t,r,n,i,a){var s=this;return pB((function*(){var o=BI.parseBoolean(i.ignoreRenderSettings,!1);s.app.resourceManager.loadModel(e,pB((function*(r){var n=e._getPath(),l=null;try{l=yield s._loadExtensions(n,r.extensions,o)}catch(e){throw e}s._loadSceneNode(i,r,a,l.componentMap,e),s._refreshLights(l);var u={objects:a};t&&t(u),s.app.trigger(SB.Load,u)})),r,(e=>{mG(e,n)}),{onCheckSceneResource:()=>!0,onTraverseNode:gG})}))()}_loadPartScene(e,t,r,n,i,a){var s=this,o=BI.parseBoolean(i.isScene,!0),l=!0;this.app.resourceManager.loadModel(e,pB((function*(r){var n=null;try{var o=e._getPath();n=yield s._loadExtensions(o,r.extensions,!0)}catch(e){throw e}var u=i.parent;if(l){var c=SI();if(c&&c[dG])return void(t&&t({objects:a}));s._loadNode(u,r,a,n.componentMap)}else u.setBodyNode(r.node);t&&t({objects:a})})),r,(e=>{mG(e,n)}),{onCheckSceneResource:e=>!!(o||e.extras&&"prefab"===e.extras.type)||(l=!1,!1),onTraverseNode:gG})}_refreshLights(e){var t=e.shadowLights;t&&t.forEach((e=>{e.adapter.onRefresh()}))}_loadExtensions(e,t,r){var n=[],i=[],a={};if(t){var s=t.TJS_component;this._loadComponentFiles(e,s,n);var o=t.TJS_render_settings,l=typeof r;"boolean"===l?!0===r&&(o=null):"object"===l&&(o=function(e,t){var r={};for(var n in e)!0!==t[n]&&(r[n]=e[n]);return r}(o,r)),this._loadRenderSettings(e,o,n,i)}return Promise.all(n).then((e=>(e.forEach((e=>{for(var t in e){var r=e[t];a[t]=r}})),{componentMap:a,shadowLights:i})))}_loadNode(e,t,r,n,i){var a=t.sceneInfo,s=t.node;a.removeRoot||e.setBodyNode(s),this._parseNodeChildren(e,s,r,n,i)}_loadSceneNode(e,t,r,n,i){var a=e.root,s=t.sceneInfo,o=t.node;if(a){var l=e.rootOptions,u=BI.parseBoolean(l.loadAll,!0),c=this._checkRootNode(a,o);if(-1!=c){var h=o.getChildren().slice();u&&h.length>1&&BI.warn("Nodes not under the root node are detected!"),r.push(a);for(var d=0;d<h.length;d++){var p=h[d];d===c?(this._parseRootNode(a,l,p,n),this._parseNodeChildren(a,p,r,n,i)):u&&this._parseNode(a,p,r,n,i)}u&&!s.removeRoot&&a.bodyNode.add(o)}else this._parseNodeChildren(a,o,r,n,i),s.removeRoot||a.bodyNode.add(o)}else if(this._parseNodeChildren(this.app.root,o,r,n,i),!s.removeRoot){var f=new mj;f.setBodyNode(o),r.push(f)}}_parseNodeChildren(e,t,r,n,i){t.getChildren().slice().forEach((t=>{this._parseNode(e,t,r,n,i)}))}_parseNode(e,t,r,n,i){var a=this._parseExtras(t),s=this._loadObject(e,t,a,n,i);r.push(s),this._parseNodeChildren(s,t,r,n,i)}_parseRootNode(e,t,r,n){var i=this._parseExtras(r),a=i.createParams;for(var s in a){var o=a[s];!t[s]&&BI.isValid(o)&&(e[s]=o)}e.setBodyNode(r),this._addComponents(e,i.components,n)}_loadObject(e,t,r,n,i){var a=r.createParams;a.parent=e,a.url=i,a.nodeName=t.getName(),a.matrix=t.getMatrix(),a.renderableNode=t,t.setMatrix(pG);var s=new r.classType(a);return this._addComponents(s,r.components,n,this._error),s}_loadRenderSettings(e,t,r,n){var i,a,s=this.app;function o(t,n){var i;if("cube"===t){if(l(n[0])){n=n.slice();for(var a=0;a<n.length;a++)n[a]=e._appendPath(n[a])}i=new TU(n)}else"image"===t&&(l(n)&&(n=e._appendPath(n)),i=new DU(n));return i&&r.push(i.waitForComplete()),i}function l(e){return-1==e.indexOf("http")}t&&(!function(e){if(!e)return;var t=e.type,r=e.value;if("color"===t)s.background=r;else{var n=o(t,r);n&&(s.background=n)}}(t.background),function(e){if(!e)return;var t=o(e.type,e.value);t&&(s.envMap=t);var r=e.diffuseIntensity;void 0!==r&&(s.scene.envMapLightIntensity=r)}(t.environment),function(e){var t=n;for(var r in e){var i=void 0;"mainLight"===r?(i=s.scene[r],t.push(i)):"ambientLight"===r?i=s.scene[r]:"hemisphereLight"===r?i=new hG:(i=new cG,t.push(i));var a=i.adapter,o=e[r];for(var l in o)if("adapter"===l){if(!a)continue;var u=o.adapter;for(var c in u)a[l]=u[c]}else i[l]=o[l]}}(t.lights),(a=t.postEffects)&&(s.camera.postEffect.config=a),(i=t.effects)&&(s.camera.effect.config=i))}_loadComponentFiles(e,t,r){t&&t.files.forEach((t=>{var n=e._appendPath(t),i=BI.importScript(n);r.push(i)}))}_parseExtras(e){var t=e.getUserData().extras;if(!t)return null;var r=t.type,n=this._getTypeClass(r);if(!n)return null;var i=t.tags;return BI.isString(i)&&(i=i.split(",")),{type:r,classType:n,createParams:{uuid:t.uuid,id:t.id,name:t.name,userData:t.userData,tags:i},components:t.components}}_getTypeClass(e){if(!e)return null;var t=BI.getRegisteredClasses()[e];return t||(t=mj,BI.error("Class not found: ",e)),t}_addComponents(e,t,r,n){t&&e.onImportComponents(t,{args:fG,onGetObjectClassType:e=>r[e.type]||THING.Utils.getRegisteredClass(e.type),onGetComponentExternalData:this._onGetComponentExternalData,onError:n})}_checkRootNode(e,t){for(var r=t.getChildren(),n=e.type,i=0;i<r.length;i++){var a=r[i];if(this._parseExtras(a).type===n)return i}return-1}}var vG=Symbol("private");class yG extends vk{constructor(){super(),this[vG]={},this[vG].loaders={json:new KV,model:new _G}}loadImageTexture(e,t){return this.object.resourceManager.getTextureManager().load(e,t)}loadImageTextureAsync(e,t){return this.object.resourceManager.getTextureManager().loadAsync(e,t)}loadScene(e,t,r,n,i){var a=this[vG];BI.isModelSceneUrl(e)?a.loaders.model.load(e,t,r,n,i):BI.error("Not supported in the community version")}load(e){var t=e.url;if(t)return new Promise(((r,n)=>{var i=BI.parseValue(e.onComplete,e.complete);e.onProgress=BI.parseValue(e.onProgress,e.progress);var a=BI.parseValue(e.onError,e.error);e.onComplete=e=>{i&&i(e),r(e)},e.onError=e=>{a&&a(e),n(e)},BI.isModelSceneUrl(t)?(e.isScene=!0,this.onLoadModelScene(e)):this.onLoadBundle(e)}))}onLoadModelScene(e){this.loadScene(e.url,e.onComplete,e.onProgress,e.onError,e)}onLoadBundle(e){e.onError("Not supported in the community version")}loadSceneAsync(e,t){return new Promise(((r,n)=>{this.loadScene(e,(()=>{r()}),null,(e=>{n(e)}),t)}))}getLoader(e){return this[vG].loaders[e]}}yG.exportFunctions=["loadImageTexture","loadImageTextureAsync","loadScene","loadSceneAsync","load"];class xG extends vk{constructor(){super()}onAdd(e){super.onAdd(e)}onRemove(){super.onRemove()}get renderSettings(){var e=this._object,t={background:e.background,environment:{envMap:e.envMap,diffuseIntensity:e.scene.envMapLightIntensity},lights:{ambientLights:[],directionalLights:[],hemisphereLights:[]}};return e.root.children.query(".AmbientLight").forEach((r=>{var n={intensity:r.intensity,color:r.color};e.scene.ambientLight===r?n.isMainLight=!0:n.uuid=r.uuid,t.lights.ambientLights.push(n)})),e.root.children.query(".DirectionalLight").forEach((r=>{var n={enableShadow:r.enableShadow,intensity:r.intensity,color:r.color,shadowBias:r.shadowBias,shadowQuality:r.shadowQuality,adapter:{enable:r.adapter.enable,horzAngle:r.adapter.horzAngle,vertAngle:r.adapter.vertAngle}};e.scene.mainLight===r?n.isMainLight=!0:n.uuid=r.uuid,t.lights.directionalLights.push(n)})),e.root.children.query(".HemisphereLight").forEach((e=>{var r={intensity:e.intensity,color:e.color,groundColor:e.groundColor,uuid:e.uuid};t.lights.hemisphereLights.push(r)})),t.postEffects=BI.cloneObject(e.camera.postEffect.config,!1),t.cameraEffects=BI.cloneObject(e.camera.effect.config,!1),t}set renderSettings(e){var t=this._object;t.root.children.query(".BaseLight").forEach((e=>{e.destroy()})),e.background&&(t.background=e.background);var r=e.environment;r&&(r.envMap&&(t.envMap=r.envMap),t.scene.envMapLightIntensity=r.diffuseIntensity);var n=e.lights;n.ambientLights.forEach((e=>{var r;for(var n in r=e.isMainLight?t.scene.ambientLight:new MG,e)r[n]=e[n]})),n.directionalLights.forEach((e=>{var r;for(var n in r=e.isMainLight?t.scene.mainLight:new cG,e)if("adapter"==n){var i=e[n];for(var a in i)r[n][a]=i[a]}else r[n]=e[n]})),n.hemisphereLights.forEach((e=>{var t=new hG;for(var r in e)t[r]=e[r]})),t.camera.postEffect.config=e.postEffects,t.camera.effect.config=e.cameraEffects}}xG.exportProperties=["renderSettings"];var bG=Symbol("private");class AG{constructor(){this[bG]={},this[bG].stateGroup=new br,this.enable=!0}dispose(){this[bG].stateGroup=null}get stateGroup(){return this[bG].stateGroup}get enable(){return this[bG].stateGroup.isEnable()}set enable(e){this[bG].stateGroup.enable(e,"default",1e3)}}class SG extends wU{constructor(){super()}onCreateTextureResource(){return BI.createObject("EmptyTextureResource")}get isEmptyTexture(){return!0}}var EG="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wgARCAEAAQADAREAAhEBAxEB/8QAGwAAAwEBAQEBAAAAAAAAAAAABAUGAwIHAQD/xAAdAQADAQEBAQEBAQAAAAAAAAAEBQYDAgcBAAgJ/9oADAMBAAIQAxAAAACi/wBAUeXDSqWpo15u1EL1yiZJk/8ATJn9IvTVWxn760pF452QBPyYB0CmGeFjNp7RIfn0McO57zm1pSwI6ql23sW3KFmB4wZjUxL8/jfCnUVpYo044XVaXaDo2OmZLodYBpKFi8MRBNM7vIhtHu+Ww/CowelWSblZP/Om6khLhucCSydAFk4hriCfmtNCtqu7QfhjPP8Az1901wpKZXCgbimj0temwqEaxEfcRFK1EMkHKuDcrwWi/Lgioh3XpLwdcLukMyOKHkUJkm9XuqFQrIw2iKYsn83y/fPvAGv31ebMqZp5COlquwTtJ5thOsQx/iZCe0uErJsIuSnNf2VfdpZ6Uc+bkgpWS+dbcVnXz1NcR9bjo5N1TgEy+f1CaJKMguKhGofKqiNqvQUR0udisX7+t6ftKFYRPtoJMaZTp1+v50uJG8wqD1xO7QZNQrGHzrarnrSToIunWedgZxoxTahA9c5/WY5nmjpZTd8MIOomwtUCI0L9wrcLWmWXt9LgljXvnbYF24V+rw9PE+qSee+U8vIlR9aWkWM0LFkhaqO+FEuXJsOPValYgnGdTUJPJ2yjzvfa0kW35mP/AEAAX9ALjKdT3fyx8LVK5pnFoCV4hlFKm1nrMu1FJ7RHS/WTe3StCc0Uc5At0Ek3FbCaUnn1E1oVj8FhELdpTLqiWFaj4XnqCLy1Hz5GZ03G7ukZ9uv29J/aL2H7yUsYOwQemGdQkS7XTjTZeQ6TaFkfuvWJXhCwVoTdKxQ01yHL/Sy4gF0vql+1ozxx+aJURs7rnMriK88dgxHl3aqN6+IIl5YH/fQwv19rwFVgRXltJNd9X79dTCkKlpabLrhKaUJ10s/JbJfq1BPSMSCsuaINL++KE5VGjLc3iE1yMh+fZ8jOemmhz9e0E1QrydnSiBQNHpGbsvj0R0sN01QSbb8Fu5mGmbtawY5pDM1iEsoQn9QgS+f6cF+2B3FcBr5nYozfvRky1eIzTicnR3M2wDDrFEkLsd8/CaYoTx60XuYmm5fXzkEj0dURVUQIqItmsMxcCIfumY/YdUqlB/tR+0FE1T48xh453f30cDVTnqjG1qf3O+v7ahWbZ6JwCFxY0/r8Lo1hakmdQHegftFbcCHUn1QG36gXeo/Po02dQkfvpHfnompWvJLIaBXbuSBn1IvVRbtEsKBC1bVyauWkoHoZM2zPD30eBBl4zV7NCLtxt80yw91pw5VlMc+6ZCwg5gqZb8XTDI50uZD/AKnG+vcD4IrJOTjqwxkwCN12t/nrFu1xRHKyOcryMaXDRy1GgWi/7WJ20w6+i7oqNFDuBaYvGj80qFjkajF3bJzD2g6DviZmzE3fbnbivMEtQflkWR53QLoxYWrplmqshZhtTsRT5psGiOXWCccHQIEupKwwE7jUe3XrEjZUa2QQnyWX0bg31ATRztzIBbWq0jd4JxOs184wAJyH65p5djSGA3Hqk/5gXzDrtzcddgdZ9kOzKxfgklHjRqg8ycY8tRXDEFP++oQuldEC8RlhMMmyQ7aMcNvQp6oXGIsetSc2bMcFdu176l+PiqDbmsR7PPWmO+ea+gTE5v8AmA2zDn8sH7T980w/Vn398woFiN+r6SNKGXbpqJMsV74NBH026Jk2lU5G6Vl6c6YlBa6aMp8t61yEz4I0+quf0BTrG7QQbse7YZ+Z9cgec0pNim9D1zjGCvy+uWeiw9H6D+7873xQLulNuhoq1Ew89sRPKqkhthQKyjZI70wjbzpRvTuROtPnlef3198vFslcYiN1I5cqyg453qDroQDP+qysTaojMuxj8HPWM2uLVhG08u19n2/T7Rf4yZjURD8/LbKoT1Jggs47EUnMMsmlWuUxzrVoKVrnFSLB/wCmzfUi9JVaHfumdGBgfkuJ+TYXYEu0HsUYIBLV2ASTkGtIK+a00K2rLxB+FL8+89oO2o1JTLIMDcU0elr02NQkWyzppCUbTXMhyOsX6ShY3DIQPTO7y3bx7v42HzVGD0iySdLEPzpspISkcakct8vvz7wBr99XmzKmaeQjparsE7SebYTrEMf4mQntLhKybCL0hrL0mRYxFK1EMkHKuDcrwWgGXBFRDufSXg64XdIZkcUPIoTJN6vdUKpWQJrN0PpSI2WOwWL9/W9P2lCsIn20EmNMp06/X86XEjeYVB64ndoMmoVjLjrQkWru0yCUc+bkgpWS+dbcVnXz1NcR9bjo5N1TgEy+f1CaJKMguKhEofLKfx30L3CNe+dtgXbhX6vD08T6pJ575Ty8iVH1paRYzQsWSFqo74US5cmwz9WqVk80Vejyj+LplvnYGcaMU2oQPXOf1mOZ5o6WU3fDCDqJsLVAiNC/Zq3Cxplz7ez3RojpfrJvbpWhOaKOcgW6CSbithNKTz6ia0Kx+CwiFu0pl1RLCtB8bx3mgp0nkzdT57vtaSLb8zH/AKAAL+gFxlOp7v5Y+Fqlc0zi0BK8QyilTqz1mWbHZgoD1SE7SsUNdchy/wBLLiAXS+qX7WjPHH5olRGzuucyuIrz8GDEWXPz2RceRGdtxu7pGfbr9vSf2i9h+8lLGDsEHphnUJEu10402XEOlGhRH3R2AE1BNSMSSsuaINL++KE5VGjLc3iE1yMh+fZ8jOemmhz9c0E3Qrttq5BJffk9EvLE/wC+hhfr7XgKrAivLaSa76v366mFIVLS02XXCU0sTrpZ+Semol53FcBr5lYozfvRky1eIzTicnR3M2wDDrFEkLsd8/CaYoTx60XuYVkIkDV6Rm7L49EdLDdNUEm2/BbuZhpm7WsGOaQzNYhLKEJ/UIEvnzOtRPSAdVGeqQbWp/c76/tqFZtnonAIXFjT+vwujWFqSZ1Ad6B+0VtwYhcS16/cgkejqiKqiBFRFs1hmLgRD90zH7DqlUoP9qP2gomqfHmMOGNG29TWlIHoRE2zYB76PAgy8Zq9mhF242+aZYe604cqymOfdMhPgpgycu1L5ft1QLvUPn0abOoSP30jvz0TUrXklkNArt3JAz6kXqot2iWFAhatWOFm3E87Zr+6xQ2mHX0XdFRoodwLTF40fmlQscjUYu7ZOYe0GQd8zM2apCKt2GTF0uYj/qcb69wPgisk5OOrDGTAI3Xa3+esW7XFE8rI1wvIzpHIeQncaj269YkbKjWyCE+Sy+jcG+oCaOduZALa1WkbvBOJ1mvnGIJGYunIeudiYJaA/LIsjzugXRiwtXTLNVZCzDanYinzTYNEcusE44OgQJdS8WQwfSuiBeIywmGTZIdrGOG/oU9ULjEWPWpObNmOCu3a99S/H5XBNTaUN1LsKMwK59Un/MC+YddubjrsDrPsh2ZWNACSSeNGqDzJxjy1FcsQUpgMS0EfTboiTa1LkXpWZpzpkUDtpoyny3rTITjjfTpVz98/p1ThoKN5vQXGWlMd8809AmZ3f8eNsx5/LB/qfv8AVGHVh1+8zoFqB+s0SMqCXbqKJSqkm90sLNkT/TidfOE+1Q5E76++UcffYny4SyVRKM3Ynl2qMBjnRAOuhIM/7NG15/PmfWYHnNIRYp/RNeIs9V5dXrfRYai9C+6edb4z67pZbzz6rRsfPrEXyusJ/8QAJRAAAgICAwEAAwEAAwEAAAAAAgMBBAATBRIUERUhIiMkMTNC/9oACAEBAAEFAnwfWlTWckpyYM2rZFSLYlxq9DOJF7E8TDk2uPbQjjnHXh1341HJf3/LlxWWcHW05Y4+JOjyrqwK5pVg2tRUYaq/JSHFqcFl+mJInqrt0uZbKutN8oVc5FYq5WsqUoqrbXo0yBtji3g460mXI8eSSBnhaN4V23J7ELPGYW1Jy/qOlQKCh4ba66ErY+t3wQKJUvaKAgM25yA60oOSww0tUQGEm4MK22rj+Skwr8iTnDxTTc0YVX9MgU3ZWqu1RLpt+H6TWf5IwMBDlQTb7rdJg1iJPFFrVXsi4/EmY8JRXqVnrwO8ZL4SbpmMKqFkIgqjF/GDuFglXBtYqY0chyzyeO7TIzRILIWBnjFnjapAyhyDqdxrxfZsURN+sIiuus6w981rZ35toQ6WUxN1axWtOrOIzsL+5UsLhjUo2E+Uiu+cqi/sZ/HWww8hkrBdtqCXZFsJetyFTDM7CY2LX3OyGM19DZY0GgAdMo/zYELZrJ7vNKXPjLSEMxtEDZaWx0UgY5Fao6sZ1yiPXHLqFjqJHT9UxQASdBVTJMgtCAPJPXNZ4d7InGWClef0Of0wtkhFa3680Xaryn1hYXIgm62MJDbwbPEynyMjjEhLCQ2m/cyrYhK3QVOIj4IG75dWLYqmvmw7/kohaftNu+ZncIB/7gwTrtj5YTLQTLHDsq9ZKa6iXaqAJBSAG2mDTJ1kZxTAKwkluU4yVhi6Z46ufbvMFYpdhUuaMhe0hLJxlL0Lax9JhWmWBhZvxm0M/HS83VlkKkQ6NQzlxHWUh3rVL5Umvc32E+YaVgolapZiutbEOmJsuBiYuC3G2/s9uuOalxLsFRityi3C4PRiHko/y0VSDmxSbOQFsByOgalsDA7Lksaz1ACZkGLOY1yYDcOvYcM2zUquCikWIFPpUms6qWolyQQTJUIl+PgwMy4mynkZN33ciDMg/wCjdT9Bfj4x1SMGuNc6RQU2rcKzccuNHjY2tAZFbB4/68KzKZgfoxQdhSrWTepBLv70RbWxGgV2VrKaApUMSh8WGLcvkDhpPS7GAooiFqx9eLJupzDKzTEYMZwEjBOWand2qNRd8OiFgmcas1KrCpMMHj89qDqlq8yJJs2doN9bLEKnuKz7SkCnDmAM1qaSmDTn3xDn0VGASysyFTsJh46f3rNija2qcOLaa9yf2wVDAuAZ+MUosKPgx1Zig0yw1mUJJU6vI1qvKcgmYqLBOM+BJqC+PlElKrEOEqGShzoZMDaHaKMdalJPYok13lK3WAfKeS+QV0XZZrkCge2qPQSk0d4FhpztLZmsJwEfCl0dFpJqraDQcgNhZy2hiuVclNjkpdXEJuJPjtTIqOHEqJwCUoNOp62DNfAJdmTg5cxkSDNc4xA2AnjJVlSy3jsfDK0KQb4UvUJWBrAv7nzEtJmSPyZT3EcMSZjBlGcdY7xZKIztKWMT/mqv48jqI8cvUyasvXK+xCcbJYOLvfomxeSts1XusQzIUz5rJcn2AYJvZilLYX/HxVhs4DTCDpz3Wv6C1RaD55WiUPwlxkz0yTxid8LiUNB0CTJCuZ2NEizsCa0SbrLKJ1uWHk8WMcgp9HqXnWeS3WUthuEUGJEKzl8Jwmdg+GEEJrOuLbC3KG7m505TsSwlpZgj9MwNZsDYuFdM2FJdvo//ACYREEvthLYjFo3wriYgl8d0adZtGzNf8kKqQ1LAWBy7Yhw/mJWxRLtA0QiarImT/cDZgxizFeVWQLHsCBLk5qNii2hPid6B7AfHPhwPIgabSLIMzgQhcn9VillbAa5IGnMBjFykbECY/utNGz6cvXekhaVydYTPq6+Fk1SHdzUotTK3HTUulNmzpM7CsGN4/jGyyKUzinxXbNyo3D4oLtYRFrorRMHRi8AyyhcFnpZFLYRLOkG1VkD4+filQtpFKH+5dR6Lyl5qRYg6aTx/ekd9i+STUMbVZq7AOfUiypVm0g3Qm7FfomR5AEm6op6avGTqVQbUsa/3YaUTbHZJQcRxnO+B9HlX1gXzSrJuYiqw1V+RkOLU4LL9MSRPVXboedsq60XzhN3kVirlayiSioptahSkG2OLeDirdyfB/KVNZESnIgzatnki2JcavQziBexPEw1Nrj20I41p14dd+NRyP9/y5cVlnB1tM2KH9oOSww0tWQGEm4MK22rj+Skwr8iTnDxTTc0YVXmzIFN2VqrtUS6bfh+g1n+SMDEQ5UOR48kkDPE0bwrtOT2IWeMgtqTN/UdKgUFDw2110JWx9bvggUSpe0UBA5ty+OtJUxo5Dlnk8d2mRmiQWQsDPGLPG1SBlDkHU7jXi+zYoib9YRFddZ1h75rWzvzbQh0spwbq1hNvut0mDWIk8UWtVeyLj8SZjwlFepWevA7xkvhJumYwqoWQiCqMX8YO4WCVcG1rFr7nZDGa+hssaDQAOmUf5sCFs1k93mlLnxlpCGY2iBstLY6KQMcitUdWM65RFWy6s4jOwv7lSwuGNSjYT5SK75yqL+xn8dbDDyGSsF22oJdkWwl63IVMMzsJiU+sLC5FabrYwkNvBs8TKfIyOMSEsJDab9zKtiErdBU4iPggbvl1Ytiqa+bDv+RjX6o5dYsdRI6fqmKACToKqZJkFoQB5J65rPDvZE4ywUrz+hz+mFskIrW/Xmi7VsOMlYYumeOrn27zBWKXYVLmjIXtISycZS9C2sfSYVplgYWb8ZtDPx0vN1ZZCpEOhX2m3fMluEA/9wYJ12x8sJloJljh2VeslNdRLtVAEgpADbTBpk6yM4pgFZQS3Kq8otwtD0Yh5KP8tFUg5sUmzkBbAcjoGpbAwOy5LGs9QAmZBizmNcmA3Dr2HDNs1KrrVqGcuI6ykO9apfKk17m+wnzDSsFErVLMV1rYh0xNlwMTFwW4239nv1xzUuJdgqOUiEptW4Vm45caPGxtaAyK2Dx/14VmUzA/Rig7ClWsm9SCXf3oi2tiNAhZWsikWIFPpUms6qWolyQQTJUIl+PgwMy4mynkZN33ciDMg/6N1P0F+PjHVIwa41yZxqyUqsKkwwePz2oOqWrzIkmzZ2g31ssQqe4rPtKQKcOYAzWppKYNOffEOfRWYFQFKhiUPiwxbl8gcNJ6XYwFFEQtWPrxZN1OYZWaYjBjOAkYJyzU7u1RqLvh0QsFCSXOryMarynIJmKiwTjPgSagvj5RJSqxDhKhkoc6GTA2h2ijHWpST2KJNd5SsJZWZqnYTDx0/vWbFG1tU4cW017k/tgqGBcAz8YpRYUfBjqzFBplhrMlcq5KbHJS6uITcSfHamRUcOJUTgEpQadT1sGa+AS7MnBy5jIkGa5xiBsBPGyrKtlvG4+wDyTyXyCui7LNcgUD21R6CUmjvAsNOdpbM1hOAj4UujotJNVbQaDkBsLMm0MVX8eR1EeOXqZNWXrlfYhONksHF3v0TYvJW2ar3WIZkKZ81kuT7AMG3sxSlsfDK+KQb4UvUJWBrAv7nzEtJmSPyZT3EcMSZjBlGcdY7xZKIztKWMT/AJi3sCa0SbrLKJ1uWHk8WMcgp9HqXnWeS3WUthuEUGJEKzl8Jwmdg+GEEJqOvDbCz/4+Ke2cBphB057rX9BaotB88rRKH4S4yZ6ZJ4xO+FxKGg6BJkhWM7GjF8d0adZtGzNf8kKqQ1LAWBy7Yhw/mJWxRLtA0QiarImT/cDZgxizFeVWQLHMCBPlJqMeqLubnTlOxLCWlmCP0zA1mwNi4V0zYUl2+j+uphEQS+2EtiMWnfCuJiCvXekhaVydYTPq2+Fk1SHdzUotzK3HTUulNmzpM7C8GN8fjGyyKUzirEV2zcqNw+KC7Wii2hPid6B7AfHPhwPIgabSLIMzgQhcn9VillbAa5IGnMBjFykbECY/utNKzFrL7Q5JNRg2qzVWAc6pFlS7FpBuhNyK3RMjyAJN1RTk1OMnUqiypY1/uw0om2OySg4jjed8D4AWOirEwyjF4AllC6LfSyKWwiWdMNqrIHx8/FK1sMpS/wByqj0X0rzWixB00nju9Jn/xAA3EAABAwMEAQIFAwIFBQEBAAABAAIREiExAyJBUWETMiNCcYGRUmKhscEEJDPR8BRDcoKi8eH/2gAIAQEABj8CaSHbfunFobNXd0Q+gN/he0Bp/CNTmkfVbmfftfCZpVA2MwVWWAFouoDh6buOk5pr1GThCAW/UKXaRvY0rpp8LMqoVQiYqm/1QaC/VDMVXXxdNjfobhVepZS0S/rhVNDdN4/ctx+I09ZRpLc9wjUS+OFtszohVHTc7T8XTXuYfSdYki4VbdSW805Q9zquYTYx9bhVNa9/7olOb/3BeIiVao/3Tv8AhCHqy7TecjCPpwWqt7ZaReMr26p03+MKsOc0Qp9TdGUBGFLah97LeN/a/QsZVww/dFvHTiqjenEIFs0nxdSB94RZDXGfsva0NVVRg8le2Z8Khz//AFIhV5acOUOs5qI03mPOFGoag5ObLZjgqkVATERZbXAuag8vIn+FugOGHtVL3uB/oiaQ4dlcdwpBaHi8doTavuyLQ5zjPcQn6bopcIVP6T+oglQ/B6ypcXUqxnqEHCzx9ijUdn8rax4PeKlfSBODwSnN9Jwa4fde8kddK8U9FSyA3pWMkiaZytzKWuyIhGh8X/UviBhcLWQbJDHGW3RlrS7wpDA2e05hAa9uArbdRt9tjCc1jn1N3XypOmW63JAipfEDTBgnBKnSLvTd4TgWF0H5gsQiJDdQcHlRrAgHNPCltfh3KBLmERkKBjiqyjUo/wDMfKrunz2nCbeeFSZkHjhQ4BzTi90ZDDwOV76CAobFfc5Rgvc+MBqdXFucptdTXE5GFH+Gc6od/Mh/1AeBjb8qI3HqcqrbHJCMXPEoSGz2gSz7rdDXN/CnUYau2oHTkPadruUK/wDUbYOhFjjB8FHcXMeMKA/Uq6UAw5nzFbiHaRzAugW3GZ5UuZubYlS11X+H1OZVqIyJsU4V0PzGAhWxsL2hvBsssxCBMN+idD6m/VSAblGmqZ5siC/09Rhjwj/m3BuR6XCnUqGq3MqA4kfgoHUdTxZH2k/yve5t1LwHtd9lN2TziFs1BSf1L442uyelDdR2Ivwo3NI6OUYJqHnKu0tKdS7d5si1x3fwuQB8zeEDQIGOkQWtOnn6IWLYyqmPN+eFuA1GONwQqQfTp74THXcR8yN6e44XvnwVUBV/ZRek+UYdntA3LOfCdYunxdFx0+IdCHpe8CLuUlt0RscDcWwr6YOp5/3UuqHcKaamu7RprA/hAuNeme8qQwUnnkI3fIGDcBNms0nwVaoLifIXY5CfU3PPKjUiwg2VLXkUiKXOsVsEtP4QdenxwiQS5h8KGfGY7OmjSSwOzZXBe3ntbDtN+4UyIP8A8oOLHOaDEjhOAdsd3ZcE/wBVt2uH5ciIBUOing8BD4vpuHdvwi5u8dhU6zJnEL4cgN64Xz1CxspfS5rvyoa5xafCMX58o+o0H6BRpuI68L5oCn5uVnPnKsZj8owaXhCsEg4MWV3NaOpUubixi6lmoKegbr3j/dRuOkfMI3IbOSMKXVWygZHo+eFDS2CPwpiWOzBThUx7HcdrZO3s5RFgRe6khsr+6uHD7raJI4fcFGvRaxrv04VLLObxglNc0OLvCqM0v/Kl2mXNN6iqmu2ntD/kKkPcJC/1H0r3b4j6rdnzyiAbTN0RMFX/ADldKaZA7VwGt+lk+g7S7OVaNQH6qzvTdyPlKmgvBQqhtu0W1Az/AAgW/L0tjnV9Lfcd8ogOLo/K3WPlRY8rYJb/AEXaFTbELacXgqZc0tPaIpkFTTt+aMIQ4x0V+ppbYgqGVY54QPLel84I47VRxyTlQHvJaccogxHlXgf0W0wIwVcbHdIACvSd4RNAAm88J1D2HSPBUBzWvm0L4um3YY8qWE5yLp1QuL4QFDNRv1untnY7jpNs5pbzyvmkLolGsAwmm4hWMrd/+KmthbxKlvuDchVW1GPz4UOOx5/CiWlju+FuAPlpRFWpCH7UaXODoQqkajUYqj6KJcH9re2QFSbAfqUEMLQeMp0j/Lvv2GqWvbGRdQ4+ppPaqmsAc4ZhbtNxaOsqcc3TvSju3C+IxxYfutswrAz3CiZP8qTIeuCURH2XTmlS4CPC2QQtwEqpsvZ4KuAQfGFee0HES2J+iNM/bhfPCgSY4Qs7rCzu75KO4x2FLIDkQTH9lNrcqraALGCrF0dEqGhpY5ZL2tOEaZdpC98qvTNJjhCvBHPCHujB8JzWu1CwnBKxB+qhph3S3RPlGIlAwQQjDsFbmyvhxA4U0uB+iNTJBXzUORFRIP6lLm1Ai5bwqWF9LhaVIrqFj2vdqB4P5V9v3ythBcLx2nCljXC91Dx9woZZrc1BCaaJy26NIlkqaNvNlUAQPosVA8JznV7skohpc0DvhENa1sd8LfF8iZToMtdfKuIj+VAO4fq5Ummr+ihwDkIbTCMOKlzMjMIgSB0g8SHc+VvuHfZfM5ju+FtdU09rc20R9EQ0kW54VTTqh7LwDlGh1Ot7s+5AuDPUwbwSo56fko1AMcMWwt0HT7yF8OkAcIPeAWfytumDpn9qltTRyBhBwNbHco0naeMFEDU1AT3hfHbUJyp09Q+pkXyvY4ObYzwt0EjlfJdRZGmStzUC2WwrTPNsrdz5uhNX3VbQQVcyre3yonPlEPaHHtFoc7wEDcj+i3U9WyocAHiwdyVkgfRH03O9QIHVafMtiVskAfqsjsIjxlQ50MP2IWzUMDvK38iD2qa5Ybi69wH1sjuYb9ojVIZf3BZ0/Tm3JC2uDgf5W9t+8IsFJe3iVJeG/dODSJQlr72twtxgKbwcEXlENkx+VvkhEXdKmgFv0uv9xdTZRDmuGEdsPZ+VSfh6jRb9yMBoMZwqXag9QWLQcq73R0UcEKAXem7+F76dPwdq5cw4jlWbqOb3Ewqm57CO8uPUKJazUb+VGqyZ/bdS0NY+UfTdpuIuiGabzpu5LVBBa5n8rZIcO+VdtLxa+EWva11XiyBDTpqsVHdlGthBjkWWx0sNxdDgqXAuaUBLy13i6sdSl3eQvcCSOLFODNR4d0mvb6u0zHaNPqM1Bw5ibWaNVljwjve5s5AR+XU4ICHqs0yw2uh7GRwiBTTN6U8O9nIjCDmOcRmKlVZ2m4flEM9jjPuRpkPHhAvYT55U7gEYA7QOoyWTcINBfqtZiq6+Lpsb9DcIOOpZS0S7rhVNDdN4/ctx+I04jKNJbnuEajXHC22Z0QqixztPxdNe5h9J1iSLhVtfLeaTdcuq5hNjH1uFU1rn/uiU5v8A3BuiIlNJDhH3Ti0NkO+6IfQG/wAL2gNOekanNI+q3M+/a+EzSqBsZgqugAtF1AcPTdx0nNNeoycKwLR5Cl2kb2MK1mnwsyqgXQiczf6oFs0n8qQPvCLIa4z9l7W0qqoweSjtmfCoc/8A9SIVeWnDlDrOaiNN5jzhRqGoOTmy2Y4KpFQvERZbXS5qDy8if4W6A4Ye1baj/dO/4Qh6su03nIwj6cFqre2WkXjK9uodN/jCrDnNEKfU3RlARhS2ofey3jf2v0rGVcMP3Rbx04oON6cQveSOuleKeipZAb0rGSRNM5W5lLXZEQjQ+L/qXxAwuFrINkhjjLboy1pd4UhgbPacwgNe3AVtuo2+2xhOaxz6m7r5UnTLdbkgRUviBpgwTglTpF3puHSpe9w/siaQ4dlcdwpBaHi8doTavuyLQ5zjPcQn6bopcIVP6T+oglQ/B6ypcXUqxnqEHCzx9ijUdn8rax4PeKlfSBODwSnN9Jwa4fdOri3OU2upricjCj/DOdUO/mQ/6gPAxt+VEbj1OVVtjkhGLniUJDZ7QJZ91uhrm/hTqMNXbUDpyHtO13KFf+o2wdCLHGD4KO4uY8YUB+pV0nBzC6D8wWIREhuoODyo1gQDmnhS2vw7lAlzCIyFAxxVZRqUf+Y+VXdPntOE288KkzIPHChwDmnF7oyGHgcr30EBQ2K+5yjBe58YDVOpWNVuZUBxI/BQOo6niyPtJ/le9zbqXgPa77KbsnnELZqCk/qXxxtdk9KG6jsRfhRuaR0cowTUPOVdpaU6l27zZFrvd/CwQB8zeFAMOZ8xW4h2kcwLoFtxmeVLmbm2JUtdV/h9TmVaiMibFOFdD8xgIVsbC9obwbLLMQgTDfonQ+pv1UgG5RpqmebIgv8AT1GGPCP+bIbkelx//FJaKkRscDcWwr6YOp5/3UuqHcKaamu7RprA/hAuNeme8qQwUnnkI3fIGDcBNms0nwVaoLifIXY5CfU3PPKjUiwg2VLXkUiKXOsVNAgY6RBa06efohYtjKqY8354W4DUY43BCpB9OnvhMddxHzI3p7jhe+fBVQFX9lF6T5Rh2e0Dcs58J1i6fF0XHT4h0Iel72iLuVOsyZxC+HIDeuF89QsbKX0ua78qGucWnwjF+fKPqNB+gUabiOvC+aAp+blZz5yrGY/KMGl4QrBIODFldzWjqVLme3NN1sEtP4QdenxwiQS5h8KGfGY7OmjSSwOzZXBe3ntbDtN+4UyIP/yg4sc5oMSOE4B2x3dlwT/Vbdrh+XIiAVDop4PAQ+L6bh3b8Ilu8dhUskObxglNcA4u8KozS/8AKl2mXNN6iqmu2ntD/kKkPcJC/wBR9K92+I+q3Z88ogG0zdETBV/zldKaZA7VwGtPiylmoI6BuveP91G46R8wjchs5IwpdVbKBkej54UNLYI/CmJY7MFOFTHsdx2tk7ezlEWBF7qSGyv7q4cPutokjh9wUa9FrGu/ThTL2lp7RESCpp2/NGEIcY6K/U0tsQVDKsc8IHlvS+cEcdqo45JyoD3ktOOUQYjyrwP6LaYEYKuNjukABXpO8IkMAEzfhPoO0uzlWjUB+qs703cj5SpoLwUKobbtFtQM/wAIFvy9LY51fS33HfKIDi6Pyt1j5UWPK2CW/wBF2hU2xC2nF4KqtqMfnwocdjz+FEtLHd8LcAfLSiKtSEP2o0ucHQhVI1GoxVH0US4P7W9sgKk2A/UoIYWg8ZTpH+XffsNUte2Mi6hx9TSc1Ooew6R4KgOa182hfF027DHlSwnORdOqFxfCAoZqN+t09s7HcdJtnNLeeV80hdEo1gGE03EKxlbv/wAVNbC3iVLfcBlXEg+MK89oOIlsT9EaZ+3C+eFAkxwhZ3WFnd3yUdxjsKWQHIgmP7KbW5VW0AWMFWLo6JUNDSxyyXtacKprAHOGYW5jiB1lTjm6d6Ud24XxGOLD91tmFYGe4UTJ/lSZD1wSiI+y6c0qXAR4WyCFuAlVNl7D0URUSD+pS5lQIuW8KlhfS4WlSK6hY9r3ageD+Vfb98rYQXC8dpwpY1wvdQ8fcKGWa3NQQmmictujSJZKmjbzZVQQPosVA8J7nV7sko0y7SF75VemaTHCFeCOeEPdGD4TmtdqFhOCViD9VDTDuluifKMRKBgghGHYK3NlfDiBwppcD9EamSCvmoctzTEfhENJFueFU06oey8A5RodTre7PuQLgz1MG8EqOen5KNQDHDFsLdB0+8hfDpAHCD3gFn8rbpg6Z/apbU0cgYQcDWx3KNJ2njBRA1NQE94Xx21Ccohpe0DvhENY1sd8LfF8iZToMtdfKuIj+VAO4fq5Ummr+ihwDkIbTCMOKlzMjMIgSB0g8SHc+VvuHfZfO5ju+FtdU13aLQ53gIG5H9Fup6tlQ4APFg7krJA+iPpud6gQOq0+ZbErZIA/VZHYRHjKhzoYfsQtmoYHeVv5EHtU1yw3F17gPrZHcw37R9Uhl/cFOnqGvIvlexwc2xnhboJHK+S6iyNMlbmoFsthWmebZW7nzdCavuq2ggq5lW9vlROfKIe0OPaO2Hs/KpPw9Rot+5GA0GM4VLtQeoLFoOVd7o6KMQWqAXem7+F76dPwdq5cw4jlWbqOb3Ewqm57CO8uPUKJazUb+VGqyZ/bdS0NY+UfTdpuIus6fpzbkhbXBwP8re2/eEWCkvbxKkvDfunAEShLX3tbhbjAU3g4IvKIbJj8rfJCi7pU0At+l1/uLqbKIc1wRp9RmoBhzE2s0arLHhe97mzkBH5dTggIeqzTLDa6B2Mj5UQKKZ+VPa72ciEHMc4jMVKqztNw/KIZ7HGfcjTIePCDnsJ88qdwCMNHaB1GSzkIhmm86bsEtUEFrmfytkhw75V20vFriyLXta6rxZAhp01W2o7so+owgxyLLY6dM3F0OCtwLmlAS8td4urO1KXd5C9zSSOLFODdRwd0mvb6u0zHa//EACUQAQACAgEEAQUBAQAAAAAAAAEAESExQVFhcYGRobHB0fDh8f/aAAgBAQABPyGsc4WfhEKTbh8IrxdZuL3pjVe3aD1KzWjAtpL1LwgpBfL+3iJaFAWV1uWh2xbHhK6dpFrMWhQlJ/WpuiZtH3KxF0rsDAVBVrox2OtFMhNRhwMJgsWNJ0lC9ASIOraOfkmkQpplNVStUgb+gmWH0mOM2D8VyvkDXU2mTzq8R/e2a2MznUMvBx+pd9zFZ74j1gHWLl6X67E9MRxBIwrMVEQB3c4PolqeHp/JPTgAuADsV1fuPY6w6I1fSQ6UdRpOasltJ9JxzLFqriwY1HPf+hM4ZBY+ZW1acXfzL0XnnaXLAa7ZY/MsIALqpTdcTw9sxB9MU/nE2xpu+h37TaIBU14A4vT6ZptZdGfIR1TrrtfErzAvCUdDGx5rqRhTiuEuOeD06rzqUOCyual+Z9Qe8XBokJWMORGxRTjzzKq0XV2x2PPVe8JzN2NTeFfqIbN1nYe6mezLoqULdfEG70ZB+EFRY2dHaJD5sa8RRxGqvgXMGevA0seYIBvtKitkDfmS0nMwQyZItzYiXSWyuH9xFqDmX0Ih1DNYRwTX2af8RlL+mz/yYv2y1VMFaosPVnf10VfUMFwNJWsfacgBcoaN3HD0rmDl0prTmYuL2Z5ho3EyTfGrzF+IGq9B6d4T1/QO7zEzje4H2gGlmjeZoR0V0xrRfAVRfeWAdXSvhCoQqivLPEAdJycumMVEQsdR99Y3vLOGjBNemhX9I0VFG/8ASWiFW8Wu5lMMgOvswdbqxihPiFNH31gAtWYeTvMuBF2qv3v1KUTy2MRaDd90/UK7pOEXv8Qa2tdNAR1vsq5/xBBetrBJ43iCA0J3B56w0S18JLyocLa79omMcgS3rmMt2O7eHDOW/wBWve4rDqpXwuE4o1VpUjyuK/MXhyu+b9wVS3TpOyUZnwPJ2h3SSpp1mTt9B+Eos0Apx3JkMncPfaF0K2D2nHMRFu0TS12mfK1WuX3zPlS6XpiTQdTj3Eappv8AmDubkaU++szgsSLz2mHKseT/ACBtIqMMYu+JmVlwD3y1B4TF+DyM6Re4Oj03FX6NmzfGpgYpuqVd/Ex7c7LX18zDkbzpMCGrLUiw8Ztn5/cboqqAs7+koScX5uSfS5yBI1LzhX8wUbFSLz2Ye4CVuevqOBFuPw6RtUOvi/KolDtp+EsUmFjJRi4U3fmUuiLqufuULeJL/Fy9c7ezXiKTvYb96Zcll4KX1epO3Zl7D2QSYrpzbsx01QZ7T0QWL02t6E7SgO5ckdLOneG6DYIJwpj5msOMZ+OGP0DcxX0cTAQrFXNlQHhl8RRIt9h+OYy15Pf/ALD5WMmyPTpmadH2vDVT0GmPLAPqCvlYlMMsFfBCK69C3fbtHm6nTsgADdg36hQ6je9OnrvH4UuCg9GAOcDeDr7lpGRjL/xAaMor88fGbXi9pVargaT+8wC4Q1V3Kdy5bstZbzGS3ITJ45lmNZebUv2wWR4S4met36ZZcU65i0CL1f0JmDOKvFdzpK4BBq9FnEG3L1a/e3J8wVCzoWdU17lMlOUJoyA5q5z36TZ0l5S+jC1QRq6+ETYDbB8kuiBNjR+8peD4LO9d5TlLgr64ljBNwC164lYsDAcLLMatlWLYgWQ2iCPTd/SDZBgtn9SP2oXanmnpAWz4J77gYq3BscarUuTDovH/AHKDE6S6/U06OS+ZMNJsXd9HUZ5aULf2Jbe1B8Iwa6gF+dyhO84CfPCRSbOOIdpTBioMxxHW2WV/kRsZ2Bv7cQfrmtPXWV+8sR7jCgyeR6Vp8SzTm2+E8x21lNAHy6uHdNgoPdbglr2NX3lYoO67unE2OyZy/uMZ09SYo9xq2jiz7w6VisGj/uYe9Cm2IyUKgEbWnzWv8g0q46Kf8gBQ0dGB8dYnUjY2d5kUFKxhqUucH/I3zm6pD+pTOhpfQcTMkKb49fuP369cPUd4xIO9gM429m9X4OsX6W2UO9wDaqp1+kVuvNyqMwshhVfEFKNwwMcLsA18y4za1xmDbyK8/SIXrezEnyJSjKW62Bl5RtCDVWQ8QjDvEHan7RXU6BtAZXg0XtFHvSw/DmIeTAiFhZbv9qYuR18cSg1scloWETqCEm5MJxfchRi6pVEAp9x/WIRPuX1BpA28Hp4mLcLmMOviMEXjlfM5EmTkn7iQJaxSnjrGlxbw/LUVda6fq5htPjXcstvLXB+mGPq7coNfC3VTnkavMycSzLdkbZdoWfFsqIqBDLLa1OWVN54uHF/PEtrmo4e0djrjePZA7ltlgld4HhafO5szvWGF6m70vvmMi+9jlMCFq0qXJusy1JVU+8s4jsrHmCrrCVsfcl9ZCA7fCwfjxdZ+8Y3acHTjUetJtRfo9pcPekce7wxjHb/TxAz8LuuYFWXA4le8LyQ5A4L2jgsYejLNWzVfuLdLNcjxMGV1zj3id87Xdd5aSrRctweeYYXnWRDuS7A2w/Y4Ymrhon9/Mt5wR92dzHBvNL8OIZVV5Lz5LlZNHDf+xpQ58iYdfQiCCaXUr2dIbxS72fEUTTVOfDtDjWKk7fNx5appE9QGKGJAaFItl+ujOh0pW08S8GrCqfk8yjA/5ZXHdKm5donXkxb9iW9bkD5j00b3tLpIdWGMr5WsImjZSVE1oY/3SYwBZu6mrw5NpLujDNKWE1Y3whSCTPq474Ixo1fVOFqQKkXA6eJVMbSgd+8vQ5+1FC3VowyBAAmbekIV8YiGqVgAH81DSUa/AviHq8bWHmAMEwHJCnkemFRDQNpix1qdFlIi1Ix04hNIqsv+ZZzHd/qNkxEzAN3aFrMYo/rjEWMF1CVRxiOALbr+VDG1ad/xNlPo16ZlrI3SfxDTYyaIzkHCcfgQXGJd7qI+RZ7voitWm64+IOTXYm/8w0y8D9RBKNFZKbqBOqOgHycyuc8P6yBQatf2iFPkWmX+JQX9IX33UJp9WW326wfQ5NPUUnN/5S0Ab1apgyG25z4rgZmuLWPidzpdZ4xDa4ZdLfciS7HZ+SZGWrCmpiK9DG4toF4QMxmJPe/pLZzGxKZy6tuCotppyP6uKRqI4oJYLeHlU6vShWyEvuwzBd+DAOqvillYXRyQTWLsyQb8W21m9Ueb/tCepc/hqp1ROczNwnAG8t1qFOswU+TUp181hIxq9ggbeenNiDBwO9j3ydoJKuDKEkb8UE2n3uLUOTbszLg9sMWN6WjWXtKLSXp6PaLWCrIxWrsUieqGi3pB7LVaTDj5wfaAgHlbSoPRpcHm40wrccPwzuTQneFKesCQLYTDMibzWko+bbxhRSUQdNQShNsYYHI9FyqlFARpb49oFzGwjLRKHVNbjsI8KY/vEqe7lp16JwmOtj6S+31DgPRuLl7e0O3SGbGI/dJhvLClHuL7K3SoxjIGmLeSnNMvMwKQ8PmV3hQbwdO5Mj5TADzM+7dnwjIfLwreYJDf1qdPFXaLYcw8Z7Q4JFKal23w5vuGHAjj1I6Dwrw/7GCfyjB8Ha/RCsvjAQ6mx+jpnPwrFZ/MpxfIB5kwirNEfDHB7jVZTox0OhFY9WU0h5qARgIwZBr4iW19XN8g/uVGYqN3ostazxqu6NcFELEr7PhXCP3LhXEWD/sFlH7XC3ThBSiAG7d9O8vPLleP+wOQsb7zCcgYQ6SoegJUtU0c/JNCzTTKa6napA39ByYfSBFdsfqlQYDXUd5k3nV4iq7s7jPacqhH4OP1O9fLPPH5hhoh1i59iNbH+XDiCR8mYyIm9cxs/CKk3N18IjhdZsTpp1K9u0DyIzUWbSdJeEHIL5f08ROqUBZXWyWV25Y8JSytItZlFWEpP61M9U4t9ysw9VYGCKCrXRjE5opkILX8Qwjb6QpX9qbYl3fQ79pvEAqSwAOL0+mabWXRnyEpB112viV5gXhKOhjY811IwpxXCXMuD06rzqUOCyual2Z9Qe8XAQgUrGHEjsUU488yqtF1dsdrz1X2esAZLnB9Etzw9P5J6eAFwAdiur9x7XWHRLp00OlHUaTmrJbSfSccyxaq4sGNRz3/AKEzhqFj5lbVrxd/MvReedpcsRrtlj8ywgAuqnfGJ4e2Y4Vr7NP+Iyl/TZ/5MV7ZaqmCtUWHqzv66KvqGC4GkrWPtOQAuUNG7jh6VzBy6U1pzMXF7M8w0biZJvjV5i/EDVeg9O8J6/oHd5iZxvcD7Qna6jeZMd03hX6iGzdZ2Hupnsy6KlC3XxBu9GQfhBUWNnR2iQ+bGvEUcRqr4FzBnrwNLHmCAb7SorZA35ktJzMEMmSLc2Il0lsrh/cpag5l9CIdQzWEWg3fcP1DXacIvf4g1ta6aAjrfZVz/iCC9bWCTxvEEBoTuDz1holr4SXlQ4W137RMY5AlvXMZbsd28OGct/q173FYdVK+FwnFGqtKkeVxX5i8OV3zfuGqW6dP1MuAaK6Y1ovgKovvLAOrpXwhUIVRXlniAOk5OXTGKiIWOo++sb3lnDRgmvTQr+kaKijf+ktEKt4tdzKYZAdfZg63VjFCfEKaPvrABasw8neZcFLtVfvfqUonl2EHCFS/B5GdIPcHR6bir9GzZvjUwMU3VKu/iY9udlr6+ZhyN50mBDVlqRYeM2z8/uN0VVAWd/SUJOL83JPpc5Akal5wr+YKNipF57MPcBK3PX1HI1bj8OkRvTr4vyqdvozPgeTtB+klTTrMnb6D8JRZoBTjuTIZO4e+0LoVsHtOOYiLdomlrtM+VqtcvvmfKl0vTEmg6nHuI1TTf8wdzcjSn31mcFiRee0w5Vjyf5ApNiowxi74mSWnAPfLD4Jtqvo4mAhWKubKgPDL4iiRb7D8cxlrye//AGHysZNkenTM06PteGqnoNMeWAfUFfKxKYZYK+CEV16Fu+3aPN1OnZAAG7Bv1Ch1G96dPXePwpcFB6MA84W/Z7jAnbQ08SwSYWMlGLhTd+ZS6Iuq5+5Qt4kv8XL1zt7NeIpO9hv3plyWXgpfV6k7dmXsPZBJiunNuzHTVBntPRBYvTa3oTtKA7lyR0s6d4aoNggnCmPmdksM/HWU+U5Q2jIDmrnPfpNnSXlL6MLVBGrr4RNgNsHyS6IE2NH7yl4Pgs713lOUuCvriWME3ALXriViwMBwssxq2VYtiBZDaII9N39INkGC2f1I3ahdqeaekAbytR77lpERjL/xAaMor88fGbXi9pVargaT+8wC4Q1V3Kdy5bstZbzGS3ITJ45lmNZebUv2wWR4S4met36ZZcU65i0CL1f0JmDOKvFdzpKYFRq9FnEG1X6tfvbk+YQYs6FnVNe5cLK2+E8x+3lNAHy6uHdNgoPdbglr2NX3lYoO67unE2OyZy/uMZ09SYo9xq2jiz7w6VisGj/uYe9Cm2IyUKgEbWnzWv8AINKuOin/ACAFDR0YHx1idSNjZ3maQJWMDir8GxxqtS7MOi8f9ygxOkuv1NOjkvmTDSbF3fR1GeWlC39iW3tQfCMGuoBfncoTvOAnzwkUmzjiHaUwYqDMcR1tllf5EbGdgb+3EH65rT11le+ZYj3GFRk8j0rTEb1PZ1EnzJSjKW62Bl5RtCDVWQ8QjDvEHan7RXU6BtAZXg0XtFHvSw/DmIeTAiFhZbv9qYuR18cSg1scloWETqCEm5MJxfchRi6pVEKr7j+sRYUucH/I3zm6pD+pTOhpfQcTMkKb49fuP369cPUd4xIO9gM429m9X4OsX6W2UO9wDaqp1+kVuvNyqMwshhVfEFKNwwMcLsA18zMm1rjAG3kZ7/SW+YmzlTfOLhxfzxLa5qOHtHY643j2QO5bZYJXeB4WnzubM71hhepu9L75jIvvY5TAhatKlybrMtSVVPvLOI7Kx5gq6wlbH3JfWQgO3wsHYRXWfvDZ9y+oGkTbweniYtwuYw6+IwReOV8zkSZOSfuJAlrFKeOsaXFvD8tRV1rp+rmG0+Ndyy28tcH6YY+rtyg18LdVOeRq8zJxLMt2Rtl2hZ8WyojZEGWXUD7r9jhiaqrRP7+Zbzgj7s7mODeaX4cQyqryXnyXKyaOG/8AY0oc+RMOvoRBBNLqV7OkN4pd7PiKJpqnPh2hxrFSdvm48tU0ieoDFDEgtCkWy/XRnSqUraeIwuw4OnGo9a3ai/R7S4e9I493hjGO3+niBn4XdcwKsuBxK94XkhyBwXtHBYw9GWatmq/cW6Wa5HiYMrrnHvE752u67y0lWi5bg88wo4yyIdyMaFXHG5IFSLgdPEqmNpQO/eXoc/aihbq0YZAgATNvSEK+MRDVKwAD+ahpKNfgXxD1eNrDzAGCYDkhTyPTCohhDaYsZanRYqQtkY6cQ2zVhVPyeZRgf8srjulTcu0TryYt+xLetyB8x6aN72l0kOrDGV8rWETRspKia0Mf7pMYAs3dTV4cm0l3RhmlLCc43whSCTJq474IFznRTf8AmGmXgfqIJRorJTdQJ1R0A+TmVznh/WQKDVr+0Qp8i0y/xKC/pC++6hNPqy2+3WD6HJp6ik5v/KWgDerVMGQ23OfFcDE1xax8Tu9LrPGIDSCrL/mW8R3f6jZMRMwDd2hazGKP64xFjBdQlUcYjgC26/lQxtWnf8TZT6NemZayN0n8Q02MmiM5BwnH4EFxiXe6iOG0e76Iza0XXHxKdYrkyQb8W21m9Ueb/tCepc/hqp1ROczNwnAG8t1qFOswU+TUp181hIxq9ggbeenNiDBwO9j3ydoJKuDKEkb8UE2n3uLUOTbszPA9sAzG9LRrL2mHgvRfVkiS7HZ+SZGWrCmpiK9DG4toF4QMxmJPe/pLZzGxKZy6tuCotppyP6uKRqI4oJYW8PKp1elCtkJfdhmC78GCdVfFLLwujkgcjUXKqUUBGlvj2gX5wEZ6JQ6prcdhXhTH94mZUy0/gnC462PpL7fUOA9G42Xt7Q7dIdsYj90mHcsKUe4vsrdKjGcgaYs5Kc0y8zApDw+ZXcFBvB07kooJeno9otYKsjFauxSJ6oaLekDstVpMOfnB9oCAeVtKg9GlwebjTCtxw/DO5NCd4Up6wJQWwmGZE3mtJR823jCikog6ahiNEswyyWQUR8MbHuNs10YyTRqVj1ZTSHmoBGGrBkGviJ6vqZvkH9xY+Ko8vRZeRnjdHeYvgIWP4mzV5XCP3L5HEWD/ALBZR+1wJUtIKUQg3bvp3l8xcrx/2bpvJvvMx5aADzM27dnwiYfLwpW4FL/idLBXaLYcx0z2hoCKU1LptByfcB0IOPUuG8eFeH/YiV/KMGQ9r9EJyeMBDq9GX0dM56tYrP5m0HIB5k//xAAlEAEAAgICAgICAwEBAAAAAAABESEAMUFRYXGBkaGxweHw0fH/2gAIAQEAAT8QGASawQmRP1H5wzCnMIZ3CAjxP4xkEA1EcKahm9OGhIlPlBKYTIA2QOSn6rCowDbLC3Eh1k5gM9rUPD29VWDJBCm5BYb56O8fygAgHykd9RkrACaFtCGx08TyRgIBBSRkLC/Mdt4UxTEXHIPZvY/OLsgWjJ1tMGUsGkluIJjKjFHAeXj+80MSEHFW7h+cCJmnAWIuCEh13gMBU2hq5EjxvCNgtMQiBkhHsZOOcAKkwsvCFP7bxSAgrieH9VjaiBwCFsto6bHA2XWJF6avEVc5NIZnZCIkq984qLhigvNn7yLgKQlwYTXZXOTqoGJG2yIxemKhAEcTyARCc9ExkJQMEeRH+8YwyCMgiNwfq8mBALuBUfU8eMpqs1OoG78tNXnGOiSs7MxGQpdsOywrNPka9Yo0IIJdi4id8ZA6pRIHcliTZhZCGLTS+rv7xWgkVTUsHzvweyhCAAhUS1yMjJ6yVWMnKuxBteTzM4EfAooCrlX457wXDVYhzAEJ5UPWO7EZSfLF8POKZgBpHWmvKacLVAhwDJ1qcEvAGyqpOMHM9Bs7JID5nn1kbNsFAtsJojeSWAFInrZR3NxgoQDBxNd2GHPD3iuQmoUL1wnvTgDo7li0bST4+MkRIBJQ0ql5uc5RUAI2I8IaXo1w9CG1k3C1DNQzfW63hTomWJ4iT5nJbgkoR8z16e8jsjWYziDyK4Susj4wjoaraRTR6usYgrpDkaIMfnjE4kuIzJCRFWbrG85b6KIkEEK4mDnAvByNDsWg+eJ2YjYc8DbB4dPkxbyBM2cR3jHgEgiBeJYgwQ4JHYuq+Ywa4KH/ADC9VjkNRpauIb97uuohAEgpBJZOMVUYDYSRW0ewe8OCoK4BIggnJ/edqBKl0gdsQ7nNipagdyxFRrZhxIT71F7qWPGK/AWgHdGz9ZOJDLMjS2b8XOPIlO1FxKRD76yBQIk3DCBcOECCCTXs9Jm92EyDy6lesrOCQE3cK3p2XkxDigtnN8c6Ty4pAEOTZYOQ+BMuUCAqKGLXqkydhK5tJCCXQdVjOQBISHTPPuH4jK0JQwJGSIIa7Eh3jaWkQOEg8661UTiizECXAPA6e/OOwpUCfDuSfrHNPIZQGiRlylODpDPlwYQMlVpHWSHxWHwEYpzEPXZmaKlKyQs+XnrnQ9sFdVNidRlyIHDCWYYPFFeMgLFUzKQ6MTHeKQZwL7bi+tYqhCinMIZWmeyOyt7hmDAEysRD8VNGFgmjYZTUofM+LzxpJAvYSOn55wxDm2WhnVt/jGvXwLI5jmjxv3go1aLBrYojxz1msgGkOIaY9/xkKGCAlSNRr9VqqVNokHGyQbI4yNyEowRCAxxzDrziAwJgAzc9vt8YUXUBBJkHghsIqJwmPBFA15NgfjHOAUGngVMh7OVKB7oGnon6wVEqXdgi2BR4TqQxTHg4EjdAw7aeIwRCARbGe5B8+8mJgsSNkgvmPPOKRJM4yolyHccd4VRqAh0ndN65ObyKgBrRUtuyp+94qUAyxlzCh7NeMiQE6NKqSJsT9ZEABUVrls66nLgYtYSV5Rpl1m8kZlMZhe7MZwhxCy1BZHEm8EpYb8CeC9tsRSi0O0BYn1twJ8pKkJS7V3+MRciOJQwkKkJJcYiRfuElRBpUUh/wmuBupJKqpPLMeTIxAEIIgVzBs0nWSiDWfoQFdr/5kUkBukNFFiE5HjrIlCTdUVMFESGIi+MPy4IWfsc3jtGEWgigTA6eK1iBBlUStKm9H3ucIPEps7F1yk3P1iIKHUpRkF2yO8aOFzBIbhPkA8FGN46ZFWRmuOlW+nNRAZKgRCdgcFvzkpBXQV2M2kMAx1rFGaIh0SRpW1+SOcktQeYqHwhvJEFBsUgt07dfzGEIKjmki41rBSVkBCxIH7OnxjEBNiGmkwZ4k3xgkQTM3jYGKOrxbSWoLdSROufvARwidzhuAPOzGyPTSWhBuYKcVdOFQLADT23+cnULDEU6NvpEdZADSbEohNI08ZpBBWkEimO8H4NlxJhiHVzimokWUGwPCWSfeM0GZGwpQePP9YRugiQpWdIjMXycgVAiYoVpBKk4g+MAJAlwIwxCC5uH050WIOAohPn/AKwGgGyqfAtn5cmcAYVqQOLnj1i4kgmQjwNwnSYOQDW+mrYmjZkyiYpFtihNpx9YwhbKyLck+B41iVAG6jaoHkMb3k7mCGOKTGiQX35MqtC6wzKftl4xJgu4ui5xawAkJBsspISdRHuH8GynXwRc+9ZG5hMzMpmogJfJk6CJSRUotAPHGQ4SjChbtIlKe/WKEgLeTw0se9n7iWMsp4PCYSdSzkAANMQAygYRmKy5wQaGeVyOk9ZcRKTtW4de3JXYkiSntQbn1eTkBOyfZPIiF+KxgCgh8nO6X+YyYzNaIkE6dCcGAilVXHkVGEgVDRAwmhHpOcuQi1ECyGmKaefkWFFmlIKqAJfDRSaIwSUqSCKA8iR6jBUWAUhG0IbuHfOangURTvRKnX4wgAxCvklSQ9JXjBVgLzbaRiphP6RTAqWjSM6PhTnAAgMsSPcPxzWKWINBMkik3M3R8VIaamtAQodYb1AUgaQleDs74VECBbdFqaEH+GH4ClxbDbR0gfGTOCXkLZGBCKcRZErLIEAIHLk6comoicUA+PvfksrwDZTKIk+PeLIKVQRFQEmExZjEQu4i3fpvBsQKPaNhuG4ePsekEkkzNiI9OvjE0IG0qbgyiYSvHHCwIxYppifOsi0QI0l42+UTGpQwqZkk5N6/8vU8pETU8DhjveLwAQxyBWDwTJkxBhTMU3y3D88YK+GthmkSH2VkJkLyNYXYqrjGOkKRkU1z4s7xSnN0SBhiDF2lj8EhKEYJbm+GJhr6wyLALHZyOENxHOSqQucmpVpOifODUCKpY06eN8OUOCNUYWFJPA0YsUs2oKQyJ5Li6w5g2CL3DnzkRFemYY1X1jZIRKnuNz/DrIeTAqQeJUyf407MBkMpi9pj/KyVQSIqitHxJXOKPCkAu1WCT+DlVHB6LcwASz/mPEauRIeAOmVxnAkEg0xRtO8hVopaeSIXU35xyoejwRNgpDdF9kzPJSIQJtocEwnnJBiNu6QcNbn8ZI4CquuEikfB1g9IFCKpTRvi4yODRMbISOZOac2sAgT0LpnxkzKIFS9mmdHWcHwlwD3Ph3xztdJsCSHLSx3YDga5DWpsfrFtEgtndwkneysdxQhRDov4LkeUlhJlFahEi8TvPAw6CKBRL2U38VQiZpQtGwv8JislZHXXshdJ2BgUAwTtDqKh693ieQxAGmy++v6xfeJJ1bBpbJ6yJIgAaFAGyvrrIkTcLJZQKY4h/WA2thsFpRNTP37yN8BY/wCD5uaiMKuFMt+qhPDnLJIA+wkI8J84YGJQYN/AX13kYhS1E0Bdj2MvuQASAhgbL3X1g8ryNBtVojGE0sDDoAwJ4O7TIhAOAovfhSFruMczJE+Xl9Hh1w4PDaIHxeHr84LqQwES0TMz5s7zYBNAXZKaPM6xkJpcAYp1uubrbjDYFtroAmHWI2NG5FtDxcYOAEtHrGx97yRKANSbgo01Ccxhm+VgOE0nvWG0kW/OOuMJcubBMzEtoZlODI/KZmemtRWhvBUTRAvFgKHx6jASULBBiAJIKGJrJlwHYORFTEcecVoxSHyV+W8lVRINsTDSeI0VzhMJIcVOoVYmJP5jBIIE0iGa4E7N5rg0c0ZJeOPeEI0gZN72HXnLAhEaCXVb+S8iaOAWXnZff4x3uiyVp34xNrgZtqFkkeJHThpICmKWYckawY6BKESTMAxvjnABg2GUQ0a4qXKAEEq0okUUfiTLvMg2xYaHDGj5xAKzsM2atePOJWwVXRIXu8BA5LQakq+mpr3lVYEjIamWnZM42gAVEJ44HGJRFWFjOxvjeagI6FUkxIl1rEKEpJo6Rjc7N4QgKDEjwLjmE54wDVIEMRSidf4xXIYIDcsQPIdYx7LRUmg3JXfDhgpC0hil4IbdZ3iFxEyTZW464wh8oLBSg/RxQ0hAxjqSQTkwSDRk25iqvUEeMneINsM0ZkHhO/iUpkgWPEMCeTIG8ZCArjj5yJJP49J/usNqxQp7OP8AbxWo2gHHycjYbghd2iIY1L/0TpwyLXZoLGEgDjGIskE8KqPk+cgIAaMMcERCPXHnACtC0Sj1FCRzg/Akn5QTe39ZoqmR0sSBNp+MkmyGNXsEYgdHEtaCdSFCLhmh7yX1OaiXWivxlyCfTUE30+awU2k1MBGoaEddZC6WchLNkVkih1i2b9X5ydhYNYwnNLU5NCOCjHaEhqbbvIGikBNEonlsld5OqxgyWREdlMfWAEjI4OFB3FnM/Cnx0U8Mdiak/tEgNcD6GQMTLUaRnRYR458OJCoUY92ezp4jIlNKwYZ3sImyORwL8KwNsRM7m/7yokjL8QNweT4o3SglHVGv69TumQEpfJJ/OUQKzjD2Fd3z5y1kGajyeII3JWRkLJEo1My9bwxhU8/kefad5qJHEmjZwTt/WTxdckjk61dfGLNG3jcn1w9YJqBbKFJp359Zbi0gOu00OAz0cyiQhhOqwyUj1DsnUXMOEA4MRn23Hxk7wBK3bAeFYa9YCU8cy6ICKJEkTIlEUSrt9e6nDuwZ0Xh18uP4SIMdIUfH5w9VEmA2SeERE+sv+NjwuKhfke8rcas02y2Z2t7yJvrA21Drfr7xGKmdLtDf1/wxGWVhqVLHrvzxGIAq0SNNNR+n3gkB4htCjuh1b1jvQdIkSTwkI/4YTOZPbF7IVOjV8YzDhrXgnlKqA9Y4RzRwZtsi0ma+MNeQYPAnDyY6E0iKNRC3zlpYgrA1DNclPxeDIRUMvlw/pkKCiMAk4b251eOspEezkBnjLULdDHpn6fjGUmAL4RZHj1lxMBUvUjeMrWqhNT/5rNCbIFl03YUY7CgrBLyOG7xJBYKZaZa82YeWohMumzaeMR8hhxKD0NcOLaG0FaJqrsfOaWRgapFGDI39BOFoDUxuNQX3M9XjCGRARTwqt6xxyZmgTm6cb46M6u3QgjT7eOeFdwJXQJ30Hj+c3CSQQ1brs4Md5BKgs0wP3Gs6SCpFEiSTEQ+MnYGYiAz477PnIY7cZCWG9fHjHdCBIGedLhuf3jEhkIC9keabMVICJAdgZs98+8Z7wPJjosju/wDxdYDL7jKEdGCKghbI3KVMRcYYkjlyYmP85qkAjUnXBPDrDpqlVPTr49+DIsmmFuHq+7mMjECKD2gg9pHCOUigh8czOD0pILJ1PI9YO0FBZ3cT6HnWJruDBcxNqTjqREEznh7O+fhwvSMMxkkjqP04GicBYIeo9M4jY6m6WEtk4FQaCk7sdPTlgANM6S2gjs34wHAQGQ8KVsTvCJoQ2Ahp6LmBhvFQCCMgTAjZ7nzjWKUUTLDBVcPXqASMEQCkkUyM6bJ2ZIBCAj/O5JxYigCgbi5meHjjgpZ4YkkQEyRMv/dbwF0gjVE2YXEhIOQE6N8Ti2EBB6DPpn3gAJxgJOJFSo/ORkp4JSCJCuxPMYyKFtT1oiia8x4AAgYrD0u76jEoMITOqx5e437wFMVQNoWFiEguuMARHRaMijWtx+MRkAwBH0H/AA4CQGQJ1Jcj15x3IKESXWiTrFGxEnKAkwdZyOAIYT1v/GIJIQCIm11EQ8fvHbltw/n8OOlBQoL5vB/QASc3DJfOTiAQi0Qa3f8AuMbGhUUEyG5HZP8AGONwnk6VRDHH/joBVQRsLbcMI5e0QQrUMRtNsRgrZCZt8FlIn6Eg1D2um6iF8u4yQvJgB5EnxdXeAkKPtHJjkGfpw2EpnVimg7o/HLEnCpwRZsI65/USzVSNrQgtjcSfcVANigHOsPdM9471QyH6lL9zNfSJkI325nz+/GRlISkcog0k/eCMwIQYqdJGPeTIQTlZI3+i3WEYCtoaOiDUbw1AgVR7Hj4caBEBtHhmTmypw3MYGAZF4IOGcdcNjgpo8DqpjmcmoGyhoii53CcYQICG2oWSPEn4jDYcoIE2gY7lmPeWEuDR1YEasm8qFLMp8Pl7nChBSRBp3S/U+MT7GJWD0pN1dMeM4WxfwuWYYYbB4zcwnmyHdk9OOKCh1CZNxI7xQ4AAQmi7pk8kRk6ZDCWaQo/P1ktpV0AwVxPTmlgZU7T7Owicg4yGSMbErk2jtDO7eGXySMtKKHEQjkh3Ej3hkxGK4I+uiT8ZGUgYsMkkI5OWOpMtFmaRAgwFjJMa+xo9ApCTg97ysQAITTuldO/GXOJBHhhFPOuMU4CnmbFJknuPjI1SxLcogwsm4/M4kxIi3i77HeEcQBhi1DSyK4djdOJoFwQkOu8iIKmVDVyJHjeC0FaQhEDJCPYyfeCkS4eXiCn9t4xCAVxPD+qxpRAoBC2W0dNjk4lSUi9M48RVzhpAm+QiJKvfOEEQwoLzZ+8hRSkEuDDp2Vzk4rhiRtsiMXpiJMAjCPIBEJ9CYyN4sR+VHj/zFeVhEiizBH1eQGdC7gVH1PHjHkQwqNQN35aavFEBWsEJkT9R+cJDxzGGdwgI8T8RjBIBrBoU1DN6cPpIEPlBKYIaBsgmop+qwhmQPQC3Eh1kyAc97UPfb1VYTNECbmwG9PR3mlIAQT5SO+oyUjF0LJhDY6eJ5IygkBSRk2F+Y7bwghMxuOQezex+c2gFMZOtpgApg0ktxBMZFIxDg8vEfzkzjBqcVbuH5wBBQtE9bKO5uMGGAYOJruww54e8cyE1CheuE96cUSu5YtG0k+PjJESASUNKpebnOdFACNiPCGl6NcPQhtZNwtQzUM31ut4U6JlieIk+ZyW4JKEfM9envIbI1mM4g8iuErrI+MI6Gq2kU0errHIK6Q5GiDH54wQTXEZkhIirN1j+et9FESCCFcTBzgXg5Gh2LQfPE7Mf054GmheHT5MvNIZKy2ZiPnIYu2HZYVmnyNesU6EEEuxcRO+MgdUokDuSxJswuhDFppfV394qQyKpqWD534PZQhAAQqJa5GRk9ZKrGTlXYg2vJ5mcCPgUUBVyr8c94LhqsQ5gCE8qHrHaK2UnyxfDzimYgaR1prymnC0QIcAydanBbwBsqqTjBzPQbOySA+Z59ZGjbBQJWwmiN4j7gmUdLqV6ys4JATdwrenZeTMOKC2c3xzpPLikAQ5Nlg5D4Ey5QICooYteqTJ2Erm0kIJdB1WM5AEhIdM8+4fiMrQlDAkZIghrsSHeNpaRA4SDzrrVROKLMQJcA8Dp7847ClQJ8O5J+sc08hlAaJGXKU4OkM+XBhAyVWkdZIfFYfARinMQ9dkdoqUrJCz5eeudI+AU8VNidRiWkCZsojvH/mPAJBEC8SxBghwSOxdV8xg1wUP+YXqschqNLVxDfvd11EIAkFIJLJxiqjAbCSK2j2D3hwVBXAJEEE5P7ztQJUukDtiHc5sVLUDuWIqNbMOJCfeovdSx4xX4C0A7o2frJxIZZkaWzfi5x5E52ouJSIffWMFAiTcMIFwpRIILNez0mAQ4IoOvJsD8Y5iBQaeBUyHs5UoHugaeifrBUSpd2CLYFHhOpDFMeDgSN0DDtp4jBEIBFsZ7kHz7yYmCxI2SC+Y884pEkzjKiXIdxx3hVGoCHSd03rk5vIqAGtFS27Kn73ipQDLGXMKHs14yJATo0qpImxP1kQAFRWuWzrqcuBi1hJXlGmXWbyRmUxmF7sxGGHALLUFnSTeWyCcMJdMHiisgbFUzKQ6MTHeKQZwL7bi+tYqhCinMIZWmeyOyt7hmDAEysRD8VNGFgmjYZTUofM+LzxpJAvYSOn55wxDm2WhnVt/jGvXwLI5jmjxv3go1aLBrYojxz1msgGkOIaY9/wAZChggJUjUa/VaqlTaJBxskGyOMjchKMEQgMccw684gMDMAGbnt9vjCqqgIkmSdBDYRUTknVUmrIzTHSrfTmoAMlQIhOwOC35yUgroK7GbSGAY61ijNEQ6JI0ra/JHOSWoPMVD4Q3kiCg2KQW6duv5jCEFRzSRca1gpKyAhYkD9nT4xiAmxDTSYM8Sb4wSIJmbxsDFHV4tpLUFupInXP3gI4RO5w3AHnZjZHppLQg3MFOKunCoFgBp7b/OGhJwxFOjb6RHWSsKyYlEJIeDxgzLDfgTwXttjCUWh2gLE+tuBPlJUhKXau/xiLkRxKGEhUhJLjESL9wkqINKikP+E1wN1JJVVJ5ZjyZGIAhBECuYNmk6yUQaz9CArtf/ADIpIDdIaKLEJyPHWRKEm6oqYKIkMRF8YflwQs/Y5vHaMItBFAmB08VrECDKolaVN6Pvc4QeJTZ2LrlJufrEEQdSlGQXbI7zUSuYJCZhLkA8FGawAC6wjKftl4xJgu4ui5xawAkJBsspISdRHuH8GynXwRc+9ZG5hMzMpmogJfJk6CJSRUotAPHGQ4SjChbtIlKe/WKEgLeTw0se9n7iWMsp4PCYSdSzkAANMQAygYRmKy5wQaGeVyOk9ZcRKTtW4de3JXYkiSntQbn1eTkBOyfZPIiF+KxBCgh8nO6X+YyQzBiiJAXToTmxYVaCRTHfjBwDZcSYYh1c4pqJFlBsDwlkn3jNBmRsKUHjz/WEboIkKVnSIzF8nIFQImKFaQSpOIPjACQJcCMMQgubh9OdFiDgKIT5/wCsBoBsqnwLZ+XJnAGFakDi549YuJIJkI8DcJ0mDkA1vpq2Jo2ZMomKRbYoTacfWMIWysi3JPgeNYkQBuo2qB5DG945pIAx6TBpIL78i0C3kNyMCEU46yJWWQIAQOXJ05RNRE4oB8fe/JZXgGymURJ8e8WQUqgiKgJMJizGIhdxFu/TeDYgUe0bDcNw8fY9IJJJmbER6dfGJoQNpU3BlEwleOOFgRixTTE+dZFogRpLxt8omNShhUzJJyb1/wCXqeUiJqeBwx3vF4AIY5ArB4JkycgwpmKb5bh+eMAgiXAmkSH2VkzQUqq4fCowkCoaIGE0I9JzlyEWogWQ0xTTz8iwos0pBVQBL4aKTRGCSlSQRQHkSPUYKiwCkI2hDdw75zU8CiKd6JU6/GEAGIV8kqSHpK8YKsBebbSMVMJ/SKYFS0aRnR8Kc4AEBliR7h+OaxSxBoJkkUm5m6PipDTU1oCFDrCQVIKQNISvB2d8CKCBbdFqaEH+GH8FnFsNtHSB8YDhAHYLcwASz/mOGauRIeAOmVxnAkEg0xRtO8hVopaeSIXU35xyoejwRNgpDdF9kzPJSIQJtocEwnnJBiNu6QcNbn8ZI4CquuEikfB1g9IFCKpTRvi4yODRMbISOZOac2sAgT0LpnxkzKIFS9mmdHWcHwlwD3Ph3xztdJsCSHLSx0pA4GuQ1qbH6x3RALZ3cJJqdlZARK8jMhdiquMYaQpGRTXPizvFKc3RIGGIMXaWPwSEoRglub4YmGvrDIsAsdnI4Q3Ec5KpC5yalWk6J84NQIqljTp43w5Q4I1RhYUk8DRixSzagpDInkuLrDmDYIvcOfOREV6ZhjVfWNkhEqe43P8ADrIeTAqQeJUyf407MBkMpi9pj/KyVAkRVFaPiSucvJhAF2qwSa+nLOAAEgQwNl7r6wed5Gg2q0RjCaWBh0AYE8HdpkQgHAUXvwpC13GOZkifLy+jw64cHhtED4vD1+cF1IYCJaJmZ82d5sAmgLslNHmdYyE0uAMU63XN1txhsC210ATDrEbGjci2h4uMHACWj1jY+95IlAGpNwUaahOYwzfKwHCaT3rDaSLfnHXGBcXLgmZiW0MynBiUKELCdF/BcjiksJMorUIkXid54GHQRQKJeym/iqETNKFo2F/hMVkrI669kLpOwMCgGCdodRUPXu8TyGIA02X31/WL7xJOrYNLZPWRJEADQoA2V9dZEibhZLKBTHEP6wG1sNgtKJqZ+/eRvgLH/B83NRGFXCmW/VQnhzlkkAfYSEeE+cNBiUGDfwF9d5G4csBNAXY9gwEI6GUQ0fFS+MoiQSrSiRRR+JMu8yDbFhocMaPnEArOwzZq1484lbBVdEhe7wEDktBqSr6amveVVgSMhqZadkzjaABUQnjgcYlEVYWM7G+N5qAjoVSTEiXWsQoSkmjpGNzs3hCAoMSPAuOYTnjANUgQxFKJ1/jFchggNyxA8h1jHstFSaDcld8OXl6pJYpeCG3WRSUzM9NaiuG8NQNEC8WAofHqMBJQsEGIAkgoYmsmXAdg5EVMRx5xWjFIfJX5byVVEg2xMNJ4jRXOEwkhxU6hViYk/mMEggTSIZrgTs3muDRzRkl4494QjSBk3vYdecsCERoJdVv5LyJo4BZedl9/jHe6LJWnfjE2uBm2oWSR4kdOG0gKYpZhyRrA6qS2iSZgGN8czmvKJB4XJAm0/GWxQY1ewRiB0cS1oJ1IUIuGaHvJfU5qJdaK/GXIJ9NQTfT5rBTaTUwEahoR11kLpZyEs2RWSKHWLZv1fnJ2Fg1jCc0tTk0I4KMdoSGptu8gaKQE0SieWyV3k6rGDJZER2Ux9YASMjg4UHcWcz8KfHRTwx2JqT+1SA1wPoYQbnqNIzosI8c+HHAE5CJkmytx1xhz5ZWClB+jihpCBjHUkgnJgkGjJtzFVeoI8ZO8QbYZozIPCd/EpTJAseIYE8mQN4yEBXHHzkSSfx6T/dYbVihT2cf7eK1G0A4+TkbDcELu0RDGpf8AonThkWuzQWMJAHGMRZIJ4VUfJ85AQA0YY4IiEeuPOAFaFolHqKEjnA0AJPyglO39YZKp7A7J1FzDgACDEZ9tx8ZO8ASt2wHhWGvWAlPHMuiAiiRJEyJRFEq7fXupw7sGdF4dfLj+EiDHSFHx+cPVRJgNknhERPrL/jY8LioX5HvK3GrNNstmdre8ib6wNtQ636+8RipnS7Q39f8ADEZZWGpUseu/PEYgKrRI001H6feAQHiG0KO6HVvWOABKiBJPGYj/AIY3IgoY92ezp4jGBNKwYZ3sImyORwL8KwNsRM7m/wC8qJIy/EDcHk+KN0oJR1Rr+vU7pkBKXySfzlECs4w9hXd8+ctZBmo8niCNyVkZCyRKNTMvW8MYVPP5Hn2neaiRxJo2cE7f1k8XXJI5OtXXxizRt43J9cPWCTQLZQpNO/PrLcWkB12mhwWerGUSEMJ1WFEEYmVps2njFXIYcSg9DXDi2htBWiaq7HzmlkYGqRRgyN/QThaA1MbjUF9zPV4whkQEU8KresccmZoE5unG+OjOrt0II0+3jnhXcCV0Cd9B4/nNwkkENW67ODHeQSoLNMD9xrOkgqRRIkkxEPjJ2BmIgM+O+z5yGO3GQlhvXx4xxQgSBnnS4bn94qIZCAvZB3TZgs4k9sXsRU6NXxisMGteCeUqoD1jhHNHBm2yLSZr4w15Bg8CcPJjoTSIo1ELfOWliCsDUM1yU/F4MhFQy+XD+mQoKIwCThvbnV46ykR7OQGeMtQt0Memfp+MZSYAvhFkePWXEwFS9SN4ytaqE1P/AJrNCbIFl03YUYdEQVAl5HDd4tgkFMtMtebP4wXc5N0sJbJwKg0FJ3Y6enLAAaZ0ltBHZvxgOAgMh4UrYneETQhsBDT0XMDDeKoEEZAmBGz3PnGsUoomWGCq4evUAkYIgFJIpkZ02TsyQCEBH+dyTixFAFA3FzM8PHHBSzwxJIgJkiZf+63gLpBGqJswuJCQcgJ0b4nFsICD0GfTPvDQTjAScSKlR+cjPZwSkESFdieYx62yIC7B2PfPvGe8DyY6LI7v/wAXWAy+4yhHRgioIWyNylTEXGGJI5cmJj/OapAI1J1wTw6w6apVT06+PfgyLJphbh6vu5jIxAig9oIPaRwHlIoIfHMzg1KSCydTyPWDtBQWd3E+h51ia7gwXMTak46kRBM54ezvn4cP0jDMZJI6j9OAg3AWCGdR6ZzedJ5OlUQxxjIBVQRsLbcMI4JRWIVqGI2m2IznRCZt8FlIn6FgtD2um6iF8u4yZXIgA8iT4urvBCFH2jkxyDP04LCUzqxTQd0fjlSThU4Is2Edc/qL9qpG1oQWxuJPuLiGxQDnWHume8d6oZD9Sl+5mvpAyEb7cz5/fjIikJSOUQaSfvAGYEIMVOkjHvJ3QJyskb/RbrJEDbE9aIt/ceAAIGKw9Lu+oxKDCEzqseXuN+8FTFUDaFhYhILrjBMR0WjIo1rcfjEZIMAR9B/w4CSGQJ1Jcj15x3IKESXWiTrFWxEnKAkwdf45HAEMJ63/AIxBJCARE2uoiHj9478tuH8/hx0oKFBfN4f6ACTm4ZL5ycQCEWiDW7/3GObJa0EyG5HZP8ZZhSBs0hR+frANKqSKMDHE9OaRgqnaek7CJyOjIZIxsSuto7QwcwVuvkkYTGiURCOSHcSPeSCNHHBD10SfjLEEMEWZaEclyxVSYzs2SRAgwF2JjX2AJR9SEnB73iywAEJp3SunfjLDGgjwwih3rHYAbyNikyT3HxkVpYluUQYWtx+ZykJJG8XfY7yiUMbVqEQskuE4q5g0dEGo3gKBAqj2Oz4cRAEBtHhmTmypwVMKCAMinCDhn9ZPYbGBTR4HVTHM5u4ENDRFFzuE4wuCENtQskeJPxGG7zSQJtAx3LMe8E2GBR1QI1ZN5vrEynw+XczgZgpIg07pfqfGI0jErB6UhdXTHjEOgGfhcswww2Dxm7gpNId2T04y/KHW1biXnGOQMAhNF3TIdkRn/8QAJxEAAwACAQUAAgMBAQEBAAAAAQIDBBESAAUTISIjMRQVMiQzBkH/2gAIAQIBAQgAx2mpIXOyHQAiV8ev0sZwKbLZpidIufRX4onc2mp81e9mNDNMLuGPlLtu44820y4+Kxl1ftvz+MF09D+VQf6TOD/BjnApw67h2DGuTRrdgyI/cZSyclCjTpl4ZK0fvuRE8K4uK9vcpSnjuOefAWhtY4UqN+TI7dM0KrgdrcO017Vl0RzOtcyi0J67nlh5kHE7xhNLxPPLWUtz7P3ZLAkuDkKB02E/8cmWNYzn+an/AELwmcO7jSYj5S1Kv3GfCfDrDJVyQ+cjT0+Jk8F/Gaq6b6pUz/daPQ7CyKjn1hvybfTLrYpJ+S8GpGg++jDFY8zPt+LkLwON2tZnq/bpCRdX7tJB43h+Wm5zxJt/te3qXLRvHJ581yYniGYYsqDT/wBNGilOqUye2MRPJwBB/KMQo8xqd0mPq4NacOsnHpJfxnuGWG+k7jKjrRMnJjRgTtT/AIGOXU8MdBx+kznm5Vi4yR+Ooou1cStOnLpcqkr8xLOpkjRpCiex/aCUyKzomYv0cSkRqA7lUEeXHykafruXa8fIkWbGxawh1idxYS0Uej6Zcl8ma6GNNKY/Kke3DHsVF4+PJPgaUcmBF8zEx8iICok4VCHS76zcWpTjjQrlEFa4+Mak9V7bJHLdf1zTiXmGcehiJMjYWAJ30+DOo9HDZPUq494kk5KFDt3NlbnXAxE9GVf5UxpCea7zFx3rP/kuazTbDKJpx6kzOv09ElI9DJm6lRjMo2Bi3ykOpJk04/8ARhtIbCZVJyPPq+TCygmV0Le4474NuRdce42jZ38cHzR7lW3ucjKqFmnkl34jJrVSGCTZ1IXNi4T3guvHQxVVl9Ksz0pSI0yyDnbZWK0HLAph5cuLxRsY6jjsHG3viQKnx49Rjv8ATzS6dZ/axyPjlkMqcTPIleerCMKz/wCZaVkS1ZZb0OwC7roxamOfXhfK/wBN2htfDdrYNpqzS0iosixXmRhVp7pBTBtOCtTpF8kr7Ig9gQJYz62uZOqg8EyslblTg5rsOmzKa9xmbjbRxm/ReREtLWdI0PmiBT0qlN+s6sdezIHfjxM0qddPQZP+74DUcrPwBX0Y5pi/Jknh5SEdRxJybXRdJDqZkfbHOSQ+IZFDvhVnUnkK1DbpO7Ufj0Kfk4tm4CZCcimKgxOo46jH11jxWg2Xr4jxN3ai8UyYCh5Nh4zo3HpcFl9mOJr9BD/+S5T2Oq4wv/rK7TaLeSGMwT3a+OLLx6p28uhVW7QXX6x+3PP/AEe2Gh5SysSk67ukMaiaONIwY9NVd66jaZ9HyabRbCnVNpBvAvql8oklardKcaGog++jaDr8tZCN9ChMiolVihXr+xeb9TUZkvVMBRIMmiK6cwTnsHjw11LKCfv+aOp2BBDO/IaTLUgEPCCkmTUn+HgiZC1TjOGX6Io2V7O2zdT5iuRK6DpJrH/L003zSmx1Pnv0sdJ6N2ix5LleX11TFpx9Sz6VfTsvlnt1xoNL1bt6mWgkLTBCwaoIIBLk8sTIaCnyRyQ6kLkS+tlFprirVYjbRoHH0Em46sGQkTTMpIbqncn5+M1uTXn14jkqdLjZK0J6l/IanHqqCKbbDMaIQ6Y0kJ1RRP5DqF3ztWa+ll7UlZUyUG3sjZOwo7eXlyEu5ZMzwfhB123n2PtEkRvGx/0UqKTk44CMrAsrTm6Asj+Jyp2EPqrbXp3I9oj29q02189EPP2KVZh7nCq+6DInRSoS4rIkRp519IbA7lltZyD0m3Qgpa0P9Ll0LfFMoEaotCh2awxynyrGJJAStjynHDRgD1JLhyrWxUDFkhiPE+LrI7cTspHBZDsYmSooBXIWVDxlNnkvExyBs8nSb++lUIuguSynpm2NhJtyPK+SJvpMTIWqffkaZ3JBPK2r37VjeTS4nbBJ+QakoNrqGeHX2czHZtm15Tc7cLVSFu14N6ldbD207QO7SaYnyEZDkQZl57TqF2k56XPlU/dsSeQumg06Dk9rpP8AC9qAufGJF2IIRdh2U+iRecl9lXXXrznfvQ17lVZ/ubrX0ufi8fdMIH/IGnX4lTTEdeRatvpyxbincSpG6SzUkSHhccNhgDMgPG7n6r2wD9yicSu5+BbyJpDGVfU2tIfVFojprqZRmKFo4/siNrMvBEUXO6WhIa6yUmo5DAylooZ3oA/w92i/JixyF9UQy9zjZiPYUt+0UqOKwr42DPXx1BVnx3IJlEUZdmWL5PbvNp02lMth7dsSWShDZPaXw34O9jiHU8buBcfX8vKRtyWJonwsXQbqquhKSij0G3XHR/XUtK3AqZN6M/E4+6vjyP4JOYfFOENbXKw1PFuqWmCSnl+OaxrOifkSujqfJW2Cs0C9BBvQCbJ4zqW2tEsyAAStOvtqXEjz6r3c0O5t3QGfkKZk8yZQLmDDbxo+a+QnycYj9YeCF90/qkdCsLStFt1xzQ+lyoNrkkgNfkOK6NyiYGn01Meijk8AzH1LBDr8NlxyRvpcuZlpwyP/AOfcYmdOTYyyaRHUsdEXZdJIefTVLLynLjUa6tVYMDRskVfc88MfowqLEgYdGXZ6XhZeK5eH4Ds4uATL4GHm4VepwiP942I0vYuH4eoSs+PpZikk2c21LrpsaIaW0RaMAXYiOwy9wmsiCmWoOxkRa6/gTBzpEgz7vbEt+ZLOk+NBmuBsJ3B8dvyVKZeNyQ43gnsHuKoh2bSzRw6MsnHbhHG7iQdUplGinpDznqTdtyshORyO15Lrotkdzx6b6xc/KGmrDhmIVbts7YzENc0iTxk+NZepZHBuBtKV1PixxeHz0y0YbNMTzT2uNkUlQzfM7yrv4xXLx7SDu1gyhXxkT34sY69daUj33btE8yBWWZ/8/jV27P8A/PZEfqUp5N1M2nTMwSQ799yI/NcXFe/uUozx3HLOxxWHJY4UqH8mT2xC/BMDtbh3mO15dUcyrbNoKEnueWrTIOP3rCaAk6ZoQAzx3QEgZ93QDqVsen0kkgU6OYY+lXPor8QncjNT5q97MqFEwe4Y2Uu27hiybTLj4ZMusjtvz+MGiHQGZVf2maH+DHPHHh1RNfNUfacGrChPk68WNQ8jPt+NkLwON2tZnq/bpCRdX7tJR43x/wAlNynjTb047eC7NG8cnkHGTIhQxGNGg057PGqFOqVyO2OeHZ+7JYElwchQOnwmOOWnj2KT/O+rrwRsS7jS4jZK1KP3GXCfDrDJVyQ+cjT0+Jk8E/Eaq6b6pUz/AHWj0OwJELz6wm5MT1LPpk/t40T2B3QSmRWdEzF+jiUiNQHcqgjy4+UjT9dy7XjZEizY2LWEOsTuLCWilKPplyXyJroY00pj8qR7cMezKLw8eSfA0pZMCL5OAsH8q4hR5jU7pMaa4NacOsnHpJfxnuGWG2y9xlR1omTkxowJ2p/wMcup4Y6Dj9JnPNyrFxkj8dRVdq4jWdOXQyqSty6wsRd7lQ5cwVUnmu8xcd6z/wCS5rNNsMomnHqTM6/T0SUj0MmbqVGMyjYGLfKQ6kmTTj/0YbSGwmVScjz6vkwqoJldC3vMxMfIiFVEnCoQ6XfWbi1KccaFcogrXHxjUnqvbZI5br+uacS8wzj0MRJkbCwBO+nwZ1Ho4bJ6lXHvEk9ZCFTt6mqfdYo2MdRx2Djb3xIFT48eox3+nml06z+1jkfHLIZU4meRK89WEYVn/wAy0rIlqyy3odgF3XRi1Mc+vC+V/pu0uF+X7a4bTTxXwbcw64+Quw2d/HB80e5Vt7nIyqhZp5Jd+Iya1Uhgk2dSFzYuE94Lrx0MVVZfSrM9KUiNMsg522TivBy4K4eXLi8QtP8AKlN+s6sdezIHfjxM0qddPQZP+74DUcrPwBX0Y5pi/Jknh5SEdRxJybXRdJDqZkfbNnJIfGPlU0fHV2G+dVSsijVVJLzVcKtPdIKYNpwVqdIvklfZEHsCBLGfW1zJ1UHgmVkrcqcHNdh02ZTXuMzcbaOM36NIlZaWs6RofNldptJvLDGYJ7tfHFl49U7eXQqrdoLr9Y/bnn/o9sNDyllYlJ13dIY1E0caRgx6aq711G0z6Pk02i2HOibSB8CemtlEngK1B3SWQzvxApummzcBMhORTFQYnUcdRj66x4rQbL18R4m7tReKZMBQ8mw8Z0bj0uCy+zHE1+gh/wDyXNNg0xhf/eWrAEPCCkmTUn+HgiZC1TjOGX6Io2V7O2zdT5iuRK6DpJrH/L003zSmx1Pnv0sdJ6OQ0WPKeV5PXTYtOPzVbLXjTyCD76NoOvy1kI30KEyKiVWKFev7F5v1NRmS9UwFEgyaIrpzBOewePDXUsoJ+/5o6nYEEF35D4n3J+fjNrk159eI5KnS42StCepfyGpx6qgim2wzGiEOmNJCdUUT+Q6hd87VmvpZe1JWVMlBt7I2TsKO3l5chLuOTM8Wn3C9H07BKpt1xoNL1bt6mWgkLTBCwaoIIBLk8sTIaCnyRyQ6kLkS+tlFprirVYjbRoHH0Em46sGQ6mmZSQ3UXm6lQlxWRIjTzr6Q2B3LLazkHpNuhBS1of6XLoW+KZQI1RaFDs1hjlPlWMSSAlbHlOOGjAHqSXFCrVxUDck8UnXbeZCPtEkfeNj/AKKVFJyccBGVgWVpzdAWR/E5U7CH1Vtr07ke0R7e1aba+eiHn7FKsw9yhZfdb9rxjTQxO1LN9h6Sg2uoZ4dfZzMdm2bXlNztwtVIW7Xg3qV1sPbTtA7tJpifIRkORBmXntOoXaTnpc+VT91xJZC6aGLSJ8XWR24nZSOCyHYxMlRQCuQsqHjKbPJeJjkDZ5Ok399KoRdBcllPTNsbCTbkeV8kTfSYmQtU+xRpnckE8r5c1Szb6cMz6XuJUjdJZqSJDwuOGwwBmQHjdz9V7YB+5ROJXc/At5E0hjKvqbWkPqi0R010hRiUJjD9iFqsvFYNNxt7XSf4XtQFj4xIuxBCLsOyn0SLzkvsq669ec796GvcqrP9zda+lz8Xj7phA/oL9J8TppiOnm06bWmWw9u2JLJQhsntL4b8HexxDqeN3AuPr+XlI25LE0T4WLoN1VXQlJRR6Dbrjo/rqWlbgVMm9FPE421GjI/gRfP7pSEhrrJWSjkMDKWihnegD/D3aL8mLHIX1RDL3ONmI9hS37RSo4rCvjYM9fHUFWfHcgmURRl2ZYvk9u3dA0/IUzJ5kyoXMGG3BHzXyE+f4pH6w8EL7p/VI6FYWlaLbrjmh9LlQfXNIj1+Q4roxaJgafTUhRRyeALnqWAjrtMehx/mvCH7XKw1PF+qWmCSnl+OaxrOifkSujqfJW2CJIq9BBvQCb3xnVm2tEsyAAStOvtq3Ejz6r3c09piYB8XwMPNwq+pwiP/AFxsQz9pcOqeseV64+hMUkhbrNrS66bGiGl8IKEacsI7DT7hNZkFcxVPzk4rXTePPBzpkgy7vbEvqxzZZI2BloZ6oGV//PuMjOnJsZZNIjqWMiLslJJ99eRj9TkVqNdWqsGBocvy0+M9mb7Eqi3pcKrLs9b8w4rm4zY/0e2ztjMQ1zSJPGTY1120sjg3EUnKynhDzx+Qwow31TDNZ7XGvSVCr5neUduKvl49oh3NuQCtixQbEsUFetKR77t2hMuBEkyGnPg4zqAcgvcHx2/JXjl43JDj+BN9HuKoh3S8sz46aWRjNwjjdxIOqUyWqhIVuUvg9uyshOYy+2ZLJphldyhTrGz8v01YccxCrf/EACsRAAICAgEDAwQCAwEBAAAAAAABESECMRAiMkESUWEDIIGxkaEzUtHhcf/aAAgBAgEJPwDhOR3xlLY+kdMUZlZe/GUMVi5STZ9Sv/hido5wYul8KPkXUOMjLrWjHq4Q7Lx40VkimZQ0NLJCkxo1xlRsYx3xvjQ+o37DhLwIpjlCsWvswLw/1ND47RaH6UbO0RvjXGX/AIfUhH1J/Bh+eNiodoQ9mzKhzA6NC2jKcP0OJIlD2MvFmy/gUGz+PcUI2aN8Y+otGEfTGKeI/wCng2+Xo0x18mjTLYoaKQpxYuoUQOvB/lQo9zGUZQ34HIuMYfGjD1Ixt+BTiIUlIUpj9MFwY2imjGl5NGh8fwP8DMoyH6n4FBUeRepDgxkV+5XybEbHQ5Zp+R0UUi0ZQ1xTMr/Zpltmh1wx7P5Hfk2KH7HTkvJ4Ha5ysx6kaHT5vhjnhw0K+KFJs0IRa4Q9mNmFvfwOMi2MXGyskeTQ6+xmmMUNGUZIVoQqXClcLl8MUigU/syhjkWhbFX2eOWKRSUPQjpc3Ro0aKF+TZvh2hxkjL1GMZe4ulGWy0aHDNotPlnnnGx0Vki8kKGhx+BWWKjRscpm+HbO9GIoyMpRlDGaHYpfOjXGhjLRsoZs0bNe46NCLRcnnl9Rv3KyLXKhoexcaNcMYxm+H/IrHQk8WWOEWhWWzuO4dm+NG/ccmzfCo1w+HxY4g2UxikcyKcH/AEZP0/yMXqxZWRcj6hwxyUxWYjhi6eNHjnXFD+xmuEUOX+i8TEU4lcOUd5iIUZCKQpF1CiB0KmKRQZFmxUUijO0aGWjKcWdWD/rhdIijuQrO5DvhClFDlCcDjNFpmhyhwOSjKhdRocNFQYxkvK8ijFH04QhL0v5FOLKLxKLNncKyskdwukfLjIrJn1DE7RzgxdL4UfIuoyjIy60Y9SEIdi6X5TGaJkdnkymTTHTFGZWXGUMVi52M0PqLa8DhLwIpjlCv3PHKMC8P9SjRWSKZlGQ0skKTGjXGVGxjHwo+RmykO0IezZlQ5gdGhbRlOH6HEkSjQ+O0Wh+lGztEb41xl/4fUg+p/QxTxH/TwbfL0aY6+TRplsUNGh7GXizZfwKDZ/HuKEbNG+MfUWvYwj6YpxEKSkKUx+mC4MbRTRjS8mjQ+WLpYusUQOvB/lQo9zGUZQ34HIuMYfGjD1Ixt+B0UUi0ZQ1xTMr/AGaZbZodcM8in5GZdQ/U/AoKjyL1IcGMiv3K+TYjY6HLNMcDnhw0K+KFJs0IRa4TbHs35NihnTkvJ4Ha5ysx6kaHT5vjQxQ0ZRkhWhCpcKVwvsY7MbMLe/gcZFsYuNlZI8mh19jFJQ9COlzdGjRooX5Nm+HaHGSMvUKWKBT+zKGORaFsVfZ45YpKyReSFDQ4/ArLFRo2OUzfDtnejEUZCjL3F0oy2WjQ4ZtFp8s8842OuGbNGzXuOjQi0XJ55fUb9zKUZQxmh2KXzo1xoYy0bEMVjoSeLLHCLQrLZ3HcOzfGisi1yoaHsXGjXDGMcGxikcyKcH/Rk/T/ACMXqxZWRcj6hwxyUxWKRw+HJs3wqNcPh8WOINlCKHP6ReJiKcSuHKO4xEKMhDhCkVcaPHOuKH9jNFGU4s6sH/XC6RFHchWdw74QpQ4HKE4YuoUQOhUKRQZIs2KikUZ2jQyxL0v5FOL47SizZ3CtDjJM7hUMvhxkVniWmaHKHA5KMxdQqKZRjGS8+4oxRhC4/8QAJREAAgMAAgICAwEBAQEAAAAAAgMBBAUSEwARBhQVISIjMyQx/9oACAEDAQEIANN6aqYJXw26ddBEevdXftkpAVK1MBXL9aUCXVe3blz2Ck6X4pMS6n8mbrWigd24qa8iXwyoIVDEbGUKWS41Vil5H5bsQhcrg7zpj1MvlnthaGiNeOIqrTcse2V8zhZk1hVt/YJ6lk6kEPKd6xYcTfLNG1cnn5jYwQMJV8epTUPpT8kUC6htYEB1Sa6vxw01xuHarMRTl5I1GtrQos/aWloLO1eqHc6mXrMWX/XC6EEcC/MqstWJV5cCK9uCr6f8u9vi3LnkxdavYrpN67qXMpfbP4DTkUl7vK5Ig4z7y0z0zpXSsNiAbdiqnh5c1faZYVS1YtT+m1xqIkWXpOUy0fjtYBntfYOZdwOyRSv643ISC4FuRiJlPJafik2/8wzMinl8Vxa+S1VPJAfIbFnQGK8ZXx8K4Ql+2kWIBSdu1ZuR9JObU+vA12DSFbPZtrCXuymjYJbpiayF6liOF0VVI6huWlr9tGbzdMzLy44a3FQRbfYKU+UmQ6qVcMFiKVGURcupYcLQpB9vl8F11yybF9jh9+OtQ0+IKmalaZZYY9g/2xoDRmPKBWIRBAlRg7lDNBNZskdBFnYtzA0KCUeloznMrJmTvaxstGY0KwnoRMalWV6PFZt5XP1pWrDxlQ50XWXoGWZRhYlz7VMGV+wVthiSBGbQRSZ9uxkjXSRsi9FYzIo12GyJQo7PTxqV75WWXZgs3Klox58c+OKWiRO6qEmMzRXYuWZAIz01lnBaxjZCF+fVrQoleSifZQDSmuj93Xs9wt+Dht2GijzRy1h/gnRtuqjAI/H9zhrWcugCjAa67H1zlflm7MVY5NS61Y4lWsJquGxJaZaWp3eN9f8AQK/3Lb+QYKGw4mN+QvW2fG7NZVKVx8YsqKC5WrEPKBic0c2sKH69yvVWI+a2wqlEHFfRstb3ES1rKLLMWoJV4madvgJCrWe19iOGNWNJQbNJAiRFDa4+xmWALGGMe10kSRDWJ3/X4vhjb1ZJlf8AGZpFKdG37GfT0S1kuZ8Vzk3tGLI6bqVJUVkgk7NiHSv1YYcjcsrUfvzkm9owDYhMOEK19xSfR4TpRRFcQbWFKy1WhVCfeRk3Na0XuzjfUrQtZ5NiyXUEaBWbJOL5tsLSUipNNzfTrXx2hxGSsPELV8KgIoLpZS1wVZ5wPK4qFukor32A2GB32rJ/vZsyn+ZRdZDpnx1J1h/NtTFcfmWE5kelx22C73SoGD7PQikfusPx7SUsJrwFgCI7BaF4eMiBWor1ZArnOyfAM3OSmeZ1SS6fcfTV2D6uVaqVwbH3a4SXq0tTC5WMG8tLChWvoPk4FOXA5VWGN1LE0avGNWwLrUQWZxlJGfxbEGwyDf8AHfjFH8z2FZXEW4mNvrrLknW9IGMKPKrLVlnMRUFKnwnXq2bIz7x8BszJMv5ftvUCkEE+1lQdWESKFOKufuytljjWRbpBTHjYxqHa6CZdpWbr+CLXx9qyED1805OTbTyHuV/llYxymAZGZWqq9G9MSMNBmhDJIZeaa1cnSHZcOAmlRWpkBFt9bOIjCdbQtnz81rLUo7DzljCpmcaK9P0DMgYKZiUsipHIdPTmlPYVvSNxzDaeY+1a9zmYyaM8fAUKq8nYaK5VMxTme2Thl0FumIpabIj1DrTmzEHvbzgGKtfNJ1cZixnYTr5RfsrimNmYHQ2p5+12tCICTKvYZdsiMrtLU2FDlWQh3mq8GuIIfpxw6lRbkVyub63WY4RWR9VUGQXBrD7Y20doiCCEqleIWL7LRltnJrRL/Z52WDrwxFegtT5AbnNLIJVqLM8iOmmwz9MsgqpIjE3I7/cVQ7RIGaFr3HWpPcbOkTSlb/bDhPZJjc0uTOK7ukQ2fU4tyyayfN3Vb+Nnxxucr+LFK02pBTXqPsI/jCz01v0y8pIu9BFWvUq84+5DJ9eXnglEwxVxTGwEWOapgF3msrthRV5s2XyERkTneu3V1GIghmtVWkpWaeqw4gDJpAoPajrghXfYCwi4XMF0gJw8rPTWI/Z2eQw9tP8Aopk7lzgfHw7h2GGpNFbUIF7CH7JdhatzgMgr7rUh7LNzXm2HWsg1kfEdnU5skQcBuaKoaNkohQ1rLuuUjwbXjsJzIUubBntHbry3zOtQAyZ69w7diFeU+iufhsGsUuIKti1Y9+ZmInJrmwtpdmKZPfT4/ovL1GC5OXjY0stDJJoAhctG6EWFzJ/G6aBrdk6dwVlJRduRabyNaBtHAzeeqqr/ADdeO67gORX5jMDsQQVYGaVwBVPTop/0mXVTW5nMZAGJJrMjIrOqcg1cxKkcgyHIWMTEXBIimV369aPH6KvfrzZ0P1I+BZaa5V4ZEIFIZyDbahrmgKrMrGKxwuGHmUGc4YvTf9VX96+rLyFB1A9j/OkKaQT6+NMr1q8ubXvHfZ1LqY5tre2PlNKv0jrvkvURQBEMmbDro+54a13mPVOTUn9eUlIqAU+b19lk4BeMkKwcZvV2vLmVFQ9xQtjE8IjwtP0iFRoX2t/gaFiFxCTl6ziV+GyYjr8tXIRPPzSh9h/Dylly0evy1XCnT6V0KH0mDFmtmdbuwkQEclwDFV//AJpWIdPYdVae2TlJOtvM0bJMsu6TTmVaiusvjWdDeAr29IEFNcNXY4JmJG4bBkyXLrT/ANaL499KRWa5gzoIPjJQwZsHxGylVX2LKTzMufmlZlruCqdNrnSc/iuZRHmg3jHWEWp+x0m+r6jlKqAV602XL0zaXeOveYTP5zpfYscF59FlQPUNpFno5OrzYbcElWKzqsemRSKrX5kuvBJlrCBJRMm0EdcxOXbpVUcEIpE18xOXmIsMlhxbVRT681d1T2SYXbcNeMStQByKScsK/MAfznmQUwM4YaIB4zKHt+rXggHsuGbzBgzEwuTAFT4q6lKxhl75LL7H1k3tn0zgdSzFm9DgO8g7cxNrXu3rMiurmshPrzQ+OkRQM5uP9L0xOfXkH9x7LmOeUT8aqxT9H5aFos7nGmXN6xOo5SJWbFEEyJ26Fi4cIitjLrp5r+OzJFBtZp1KbZEfkOsTDlA1DlkyLatOGW+Q3K6pIhjTahQQI02Q44JWdSlvOPFxUoU5GNzbKyUoUGkYL6iryLBk5XR/yhvlp0tZPqinjPm3mtTPttHOKpQ9D8dx4mZGxYx/x0Q6cbnN7mGtWuffiBvz9CfU4Fq485k7OUSme/KuUVWJeSTVZsyZo1q52vcbW4Lj6wtts2rUQltCwhJOM77HjKPNN1XHkkeaG0wz6wCY5f65FP7uqNeLTF17MgnX+QjWL2zS0G3p7Z+LZbXR1o+wnPqwJWdMn2fU3Ig39K5qWm2OBCpxFMlWi68oUiBuyJpLKzpQIWJ2KHJUnPxam24YwMhQyw5s0r/5V0+ZI16oc1aVl2aBW2Viu6N6TPMxpzETBbGmdWrD5o/J2XWxxXehJ9M1gIymG2lCz/VaM5VWYZGk0bEQJ5y5B5EmFnbs+2VsyZsyYrq2/sE9amOpDD5/PWbLiZ5YpWrs9k4uIuIhSvjtL6h9KvkiwXWNzAgeMtXX+PMQgbhW6ZVqc2Zr6ZtrQE5+ylDgWVy/Um71Hdtw98IXpvTWRAr+IXCr155694b9okoCpWpCIS/V6ILovb9277AUaI5SYJ1X5O/WtFAbtxU1pEvhlJYVTGLGQKmS4lVpl8lF2xCFysW33yPqZskcywtDTitEwHxyqCi7bNoyN/CbJFK/rDdBIBAsycVJIjqX8Vm5PBeZk08qRXFr5LUU8kB8hfZ0FQiMr48CFQp2ysCQClbVi1b/APGrNqdEDXYFEVs9m2uBe7SqdqVu9TfCCZEuzah23yPlwIr24Kvp/wAv9vi5LbBMRWr2K6TfF9DmUftn8AqEKS93k+0QcZ19aZ6Z07x2GwKW3BqpgQu6vtUsKvasWvGoGqmRZe5dMuGkdjpggQo1v9wzQTXbJHQRa2LcwNCilHpaM5zKyJk72sbLRmNCsJ6ETGpWlejxWbZm5+tK1YfErHOi6y9AyzKMLEufbpgyv2CtsOrEtGdQRRn7dmtVXqWI4XQVUHpG5aWv20ZvN0zMvLbhrcVBFt9gpT5SZDqpVwwWIpUZRFy6lhwtCkH2+XxCuuWePvscPvx1qHHxFUzVrTLHssMDxrhCjMHpZS4npTo2XVYgEfj+5wVrOXQBRgNddj65yvyzdmKscmpdascSrWE1XDYktMtLU7vG+v8AoFf7lt/IMFDYcTG/IXrbPjdmsqlKo+MWVdRcrFiLPEYx5rpkz8vRWYZFGuw2RKFHZ6eNSvfKyy7MFm5UtGPPjnxxS0SJ3VQkxmaK7FyzIBGemss4LWMbIQvz6taFEryUT7KAaU10fu69nuFMw8Fu0Y1j0LU8Zjx6ZayXM+K5yb2jFkdN1KkqKyQSdmxDpX6sMORuWVqP35yTe0YBsQmHCFa+4pPo8J0ooiuINrClZarQqhPvIybmtaL3ZxvqVoWucixaOFBOYvMqgizrWq1cBGNbXVSiDivo2Wt7iJa1lFlmLUEq8TNO3wEhVrPa+xHDGrGkoNmkgRIihtcfYzLAFjDGPa6SJIhrE7/r8WxBt6vJlb8XmFJJlYMH2ehFI/dYfj2kpYTXgLAER2C0Lw8ZECtRXqyBXOdk+AZuclM8zqkl0+4+mrsH1cq1Urg2Pu1wkvVpamFysYV5aWFCtfQsScCnNgcqrDGlfOxZJs/NtYVFIAmk5vF1r47Q4jJWHiFq+FQEUF0spa4Ks84HlcVC3SUV77AbDA77Vk/3s2ZT/Moush0z46k6w/m2piuPzLCcyPSxhtg+51pTLBDWr26YUh4WMah2ugmXaVm6/gi18fashA9fNOTk208h7lf5ZWMcpgGRmVqqvRvTEjDQZoQySGXmmtXJ0h2XDgJpUVqZARafWziIwnV0Lh8vNOz9Krw81Xk+zHvL4ykjP4tiDYZBv+O/GKP5nsKyuItxMbfXWXJOt6QMYUeVWWrLOYioKVPhOvVs2Rn3j4DZmSZfy/beoFIIC9rKk+vIkcIcaTnzPl1YZGxnYLtAov2VxTGzMDobU8/a7WhEBJlXsMu2RGV2lqbChyrIQ7zVeDXEEP044dSotyK5XN9brMcIrI+qqDILg1h9sbaO0RBBAVWtxXr2JVX5znLiFycYsV6foGZAwUzEpZFSOQ6enNKewrekbjmG08x9q17nMxk0Z4+AoVV5Ow0VyqZinM9snDLoLdMRS02RHqH3GuZEFv7rlzFavi3LLAJpXdZv46R8cbnK/ixStNqQU16j7CP4ws9Nb9MvKSLvQRVr1KvOPuQyfXl54JRMMVcUxsBFjmqYBd5rK7YUVebNl8hEZE53rt1dRqIIfIsWGjLbGRW9v9nn5YOvCMV6C1PkBuc0sglWoszyI6abDP0yyCqkiMTcjv8AcVQ7RIGaFr3HWpPcbOkTSlb/AGw4T2SY3NLkziu9pSNjiWQxZl1js6nM5WDgNzRVDRslEKGtZd1ykeDa8dhOZClzYM9o7deW+Z1qAGTPXuHbsQryn0Vz8Ng1ilxBVsWrHvzMxE5Nc2FtBZipL30oGfU+IqrVMgSOp7iEMmktQe1HXBCu+wFhFwuYLpATh5WemsR+zs8hh7af9FMncucD4+HcOww1JorahAvYQ/ZLsLVt8BkFfcckPZZmY9jYdby8eq6tyXr5qVV+QZDkLGJiLgkRTK79etHj9FXv15s6H6kfAstNcq8MiECkM5BttQ1zQFVmVjFY4XDDzKDOcMXpvmqn+9bVl5AhlIImP1cowQEYY+NLLIiSaAV1y0boRYXMn8bpoGt2Tp3BWUlF25FpvI1oG0cDN56qqv8AN147ruA5FfmMwOxBBVgZpXAFU9Oin/SZdWYtp8xkRYknFOn/AOeFDfvtbPXFCxC4hJy9ZxK/DZMR1+WrkInn5pQ+w/h5Sy5aPX5arhTp9K6FD6TBizWzOt3YSICOS4Biq/8A80rEOmWHVWntk/KxOuWSlN6E018PPjbUVkyba947zOldTHNtb2x8ppV+kdd8l6iKAIhkzYddH3PDWu8x6pyak/rykpFQCnzevssnALxkhWDjN2u159hU0j3TC2MVKojzQdxjgEWp+x1G+r6jlKqAV602XL0zaXeOveYTP5zpfYscF59FlQPUNpFno5OrzYbcElWKzqsemRSKrX5kuvBJlrCBJRMmwE9cxOXap1U8EbEusthRpzqlRfWXxrOh3CF7ekCCmuGrscEzEjcNgyZLl1p/60Xx76Uis1zBnQQfGShgzYPiNlKqvsWUnmZc/NKzLXcFU6Vhz5OfxJMmB8vbX+nE6lmLN6HAd+uduYm1r3b1mRCrmshPrzQ+OkRQM5uP9L0xOfXkLHcey5jnlE/GqsU/R+WhaLO1xplzesTqOUiVmxRBMidqhYuMhEVMVddXNdej2OmPMvPU9ksOLaqKfNXdU5kmF23DXjErUAciknLCvzAH855kFMDOGGiAeMyh7fq14kBhlwzeYGMxMLkwBU+LvAlYwd75Kx9n6ydzMcgvbaGadSh6H47iwfv7L8iaIwycbsm7zDWq3PvRA6BfQ/ksCzcsM5HZySUyZirllViXEk1WbMmaNaudr2O1uC4+sLbbNq1EJdQspSVgivtePV58c/qYJrNCrUbIj8i1iYUoCofYUiyrSFlz3FyuqZIfNJyFhCxpthrI6s6jLeceL+pQpyMbm6VopSoNIxX1TWMWDJkul/lDfLLicyZGiEDMzG3mx1kRfFKR3DERkKOQvm3Svfk3TPmTFaoHNWnYdmgVtlM7mloTJ5WKWZWnlsabK1WHlS+UncbEQu+CD6ZrLMynttKFkdq0Zi6swyNEos/o8xBfZkk6b05HtR6W0Zn1iMxBx249T72oNeLRLRYkE7HyAa5ez09I7v8Ac/Fsxjx6UDYTn1RErmkbrPGbkQT+kJp2W2eEiDDOfdb7lgoVXgbZiaSy6MpAbE//xAArEQACAQMDAwUAAgMBAQAAAAAAAQIRITEiMkESUaEDEGGBsSNxM5HBQvH/2gAIAQMBCT8Ad2Son4FXq5Hd5OMId2eprY7IjnyRoOrY7F2WXJhDo2PA8EdPcVJT/wCEqtYFaWWXqQ6RVZeTz8D6nIX9Evoduwy0VyRt+Cp6SyzA6MwsjNUnj4I3WBVoMdh1ZaRjklWosD6n+DoWTHVmWWXJGsn4Lz4LMV35NMYmzhm4WlEbdyOt4RCkUSzx2Hjkwss5yPp9NC7UH/IyNKGWMwi5KsngmTqyyFWX4OtOSNIka0yOjeC3ZjrKQ6JErdxm1DqlyS0nGEOsiVIxH9mBUXJKyFWTwbnkWlcEKG5U+xUiSoi5DUx6mLo9OItEBXY6NkdEVkdGxVksGlLJZRJaWcc9yNIkrIslx7Ronli0xN74FV/hKsmc4LzfHtGiXPcd+w6kRWF/RebLL8I6Vnk9GjeHUiYWPgj1UM8kbRHo7jsvItCFpXk+jeOg6t5LRVD/AEbiduR1Zd8fAripF5FWZb4I/YrM2xFYV2PTHJavgeuRLSuBaCyHRLnuRJ7h2/TA/sVl5MjuZHRLJepufg/yyJ3ZfqFWfCH0x/8ATIVgsfI84Q6nA7CrJmR1n+D0i/ojWQ+lWqPQXm8C6YxLQODjBaKyznHybjavbJgXSRrPh9iVZC6prwLq9Rm5iN0sLsavUfgbdTkWolq4PssuS9S8idFyOxea8DpFeR6I+SXTH9Pox+kNP6RrTkxwZXtg3MfV6jHcV+4s8dh9MVyKq79x0wXaFcwLIqsljwOke5j2dh2ZG4qyOCVKCsKiQtYr8G6WTcyzQ6tirJ8DuXby+w6SZLqHX/haK8l3+Fx1Q6JmFgvJ4Qrvkejk2oyY9o6ng2rJsR/jjkVIloxI7i8jJwbnyPHHcvJl/UeC85c9i/qSwKsn4L9yVnwSusrsSzklpXkwcGCyQ7GELJwOsmPItKwSyWh+jHXuxWFVsu2Ky+SyQrrBdvCLyLzMs3DrmxZrk3cF5PkWlCsc+zoWiO/tlHI6zHp5JaDEfIqQRtGZMmR5JXF/Iy/qdv7LyZeXJdjpQvHli/jWEXk8HqXXFBaR0Q9bGOkVksOshURgeo2mwVICpE4OR3Ruasf6M/gqy/CNfUY+r1HwLq9TsSr6jJVk/dUSLzI0HV9jSkOo7sdjJu7CpQwjcOyHY3DsPSvbETCFpjgj/I+CP0R1G4dZPwLqmXkxN193SKyxV+RVoK75JU+C1ORWXJC46JGEc0Hq5LJclq8j/ouuSyQ6zlglV/lS/qS57D1yzYjR9xVZZ9h1mKvyK8hktCIUS5EWY+wqImqvA6y4Q6zZaCyaYrglV9i0TBudR/2f/TYhaSOleSAqyXgjWorISc+GWih1l+C6vUZeUi82cGGOspEdK4FR/hdj+hVJVoPBHT3FSU/+Eq9OBWeWLqqQ6bXYqtYNTefgfV1CH9GPa0e47sdK89i9SV3k4wh3Z6mt/BKiVCOSNGi7HYux0XI7IdGx9T/B0LJkqvsZLLkjWReSwWYrvyaVE28C1C0ojbuR1vCI25+BU9JZZgdDCyP7NUngjdYFWlRj0jrItIxySrUjg0ruKsu/YdackaRI1pkdG8FuzHWUh0SJWGbUOqXJLScYLyI0iiWeOw8cmFlnOR9PpoXag/5GRpQyxmEXJVk8Eyd+4tEBXY6NkdEVkdGxVksGlLJZRJaWcc9yNIkrIslx7RonlkdMSVIx/wCjxz3MCouSVkKsng3PItK4IUNyp9ipElRFyFZMepi6IR+yJhY+CPVQzyRtEejuOy8i0IWleT6N46Dq3ktFUP8ARuL+o+BaiVZM5wXm+PaNEue479h1IisL+i82WX4RpFHo07OpsLIdEue5EnuHb9MD+xWXkyO5kdEsl6m5n+Vk9PI7l3x8CuKkXkVZlvgj9iszbEVhXY9Mclq+B65EtK4HSBefAumMS0Dg4wWiss5x8m42r2yYFQjWfD7EqslcW4VZ8IfTH/0yFYLHyPOEOpwOwqyZkdZ/g9Iv6I1kS6S84+B9MV35Hoj5JdMf0+jH6Q0/pGtOTHBle2Dcx9XqMdxau5Hq9ReCPV6jNzEbpYXY1eo/A26nItRLVwfZZcl6l5EqLkdhVZhEqUFYVEhaxX4N0sm5lmh1bFWT4Hcu3l9h0kyXUxZ47D6YrkVV37jpgu0K5gWRVZLHgdI9zHtgwzJtRsjkVIloxI7i8jJwbnyPHHcvJl/UeC85c9i/qSwKsn4Psdf+ForyXf4XHVDomYWC8nhCu+R6OTajJj2Wp4FpWTT6aGOvdisKrZdsVl8lkhXWC7eEXkXmZZuHWtbFmsslZ8Dus/BLOSWleTBwYLJDsYQsnA6yY8i0oldipFYNozJkyPJK4v5GX9Tt/ZeTLy5LsdKF48sVPTTshaqWLzfItKFY59nQtEd/bKOR1mPTyS0C2+fbkd0bmrH+jP4KsvwjX1GPq9R8C6vU7Eq+oyVZP3VEjf8Ag6t4J3SXAtI6IetjHSKyWHWQqIwPUbTYWgWj7YiYQtMcEf5HwR+iOo3DrJ+BdUy8mJuvu6RWWRr8kbl32NKQ6jux2Mm4VKGEbh2Rg3GC0UOrQur1JYfYet5sRo+4qss+w6zFUW4ZLSiFEuRFmO9hU+C9CN3ySp8FkuRWXJC46RRhHNDdyKiXI6V57j/ouuSyXkdZvBD+hEdTwy0UOsiPV6jHWTFWT5FgdmOspkdKFR/hdn+hVJUcsDrIdZstFZF0xQ6y7Dovbc6jyPItKNqFWK8kKCrJeD//2Q==",wG=Symbol("private");let CG=class{constructor(e){void 0===e&&(e={}),this[wG]={};var t=this[wG];t.readyPromise=null,t.cache={classes:new Map,models:{},images:{},envMap:{},ready:!1},t.gc=null,this._setupMacros(e),this._setupFactory(e),this._setupCache()}_loadImages(){var e=this[wG].cache.images;return e.empty_image_texture=new SG,[{name:"water_normal_image",resource:EG}].map((t=>new Promise(((r,n)=>{var i=BI.loadImageFileFromBase64(t.resource),a=new DU({resource:i});e[t.name]=a,r()}))))}_loadEnvMap(){return new Promise(((e,t)=>{var r=this[wG],n=[{name:"negx",resource:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCACAAIADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDRsoYJZsXkjquMBwM4PbPtW3Ho80loWjdbiEHnYc/pWIq89K19G1WbTZMqquh6qR1/Gvr6kZWvE+fg1tIrnQJzgxKWJOMDt9ar3+j3VjIEuYWQkZB7H8a76x8S6XcOBd2pgP8AeByK0LrWfDzKrSMZCB0K5/D0rl+s1oytKLN/Y05K6keRtAfSk8k11niSbTLm7T+yodkYX5mxjJrKFuGHFdsJ80VJqxyyjZ2TuZHk8Unl1rm1xxiojbnPSrTuSZwjNSKMdatmA+lP+zHjihuwFIrmozHnoKvTQlMVYsrCWYEpGzfQdKHJJXBK7sZHkn0qNkOcV1MuhXMdu8rpsUDPPestbF2bhfxqY1FLZlODW5nxQ56jNTrCfpWmtk6jAUk+1Tx6Vcvy0bqPcdaHUS6goNmeqhhTlTaas31sISHjIMbdOeRTIcHr0oTuroGrOxJEiOuGGKk+wkjKHIqSGEN0NXoYmXGCahytsUlcx2tXVulWLeCYH/VOy+wrqrGMxOkvlo3++oI/WtqbUJltRDBapE7f8tIwOlc08VJOyV/maxop6tnFJaCVeOG9COaq3FlICflORXfW2hTTCGSeMSFuSfNO7/AVNfaAPsryBSrA8DIORWSx0FKxbwsmrnmbW7elW4rYlV47V0MmnKF3LyfSrdrpM7RBhA54zwpreeKjYyjRlc5ePR7i9uEjgjJJ79BXe6Xo62ESQtbgDuRzkgdc4pLKN9LRZ2s5XlfKoFIHHoR/9apmtL27kM9xkIB9zdjHtxXnV8S6ml7ROulSUNbXZV1vSbO+x5txIHHRRziqkXh2xSNQglz3JYc/pWtDHl+RtA446VcaNQnPb3rH204JRTNvZxk+ZoyrewtrXlEz9ecVJMVxggVVvtRhgV90i4B6/wBBXN3muM5bygQD0renQqVXcznVhDQ5c5PWpIlxTxGRT1QmvbueYTW4+bitCLceAOapRIy4IrStyxHK1jNlxNvR7+3Vlju4ztPBI7H1q5fyxTYWIqm3oQOtY9mgL/OhP0rdtraApnYxPuK86qowlzHVBykuUh09JWIMe/P1rfSxkuAnnyPJlehPSqdqPJOY1/DFbdpMWAyOfYVw15u90dNGmtmQWujQQyb2+b0FXpCyrhVAFSNIikAkZPQVDLdIikrhiO2cVyOUpu71OtKMFoOdElRVmj3AnoR0qC8MMMKpgBeyqaoT6pJLIIUjPPGF61De2CSxPtd1YcZbnNaRp2a53YzlUuny6lO71OCBiq4498msLV9ZluEEcBKr3I71P/ZEkrHys/Vqeuj+T89wy4H5V6dONGnre7OGcqk9NkcvJBLJ8zKze5FRizdjgKa6maa1U7VTefpV+3iRrASCAhz2xg/hXTLFuCvYxjQUnucetr5bgvGGHXFTi0WQ7o4Ao9N1WVk5O4pg09JFXo4HtVtyM1yldbGT/nkKs2lr822VHU+xAx+dSx3KqOHFWUu0C4Mqke5rOUplJxQ4W0kbDZuHHU8/yqVcIf3qsf8AdbGaijvET/lquPTilN1CckyoT9axcZPc0510LccqjG0NGvp1zVlb+QLsgAQngu3Ws1LyFTxKgqUXtvuy0qE+uaylSvui41bdTQjllZvmlcnue1WUKR/MXLH021lrqNsP+WifnTn1O3/heP8AOsnSk+haqruXjInnGTaT7VVvAsrAl5yuPu78AVANTg674gfTNNN/bk/62P8AOqVKSewnVVtyS4uJ0iWKJDGi8Ak5Y/jVNlmkGC7kfWpZL+E8CVSP96mfbYR0lX861jBxWiM5TTerIxYsrj5CT7VIsciPwr7vpSDUEHSVR+NNN8h/5ar+dU1Ue6FzQWxgUUUV6JxhRRRSAKKKKBhRRRQIKKKKBhRRRQIKKKKACiiigAooopgFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB//2Q=="},{name:"negy",resource:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCACAAIADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD0iiiivrT5oKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Z"},{name:"negz",resource:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCACAAIADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDiMUmKsMlRla+/PnBgFOoxS4qRiYpdtLSikAgFKBSgU4CgAAp6ikAqRRSAcgqZc9qYq1YjTNIQIpNWYVC8kZNOiiq3FGB2qWxEcMLyHgceprRiyibFbr1IpiKegFTxpioeoHGlKY0ddFPosyZwufpWbNZyRnDKRXQpp7Cs0ZhjpvlmrrREUwx4pjTKvl0ojNWdpFKB6rmkO5W2GlCmrOxT0yKcseD1FK4FdVJqZEqdQO4pyqM0rhcSNParEa4oRfarUMDv0FSybiRrzVuJafHZuBkjFWEgwahsoIwMcCrMaj61Pa2xbHy/nXQ21hpyWW65MvnewG2sp1FAuMHI5sBwxR87h1GM/wAqq3cKYJcMPQgVppDc2kvzDaw6hhg1a+1q8ey4tldP9k8j86lyad0rlJJrU4qeFN21Rk+mKrzWjR48yNkz0yK6K9BaQkRDZ23cnFVGTMYWSIEDoRxXQpsxaRh+Qp70ot1z1rWWBSDlD+VMNtGDzuzVcwEdroU91CZINjAdt4z+XWro8G6o0PmxwxuoGTiVcj9at2UcNo5EkIZjg5LA/kR0rcsdbaDEax5iPBQnIrkqVqi+A2hTi/iODFhMuQY2BHUEVKthLjlcV6jLpen6lbPeCAW7BcDawC59cVyKaZHcXrxLdKqqcbpPl/KnTxKnfpYU6Tj8zn44CrYIrXsfKQfN1pLm0SG4dI5RIo43AYBqWC3ONwViPY1q3zIyWjNKNkePKr0qW1ihlYeY21c84GSfpVIbVTBDg+5oB3Dkms+W+xpznSubCzh3RRmaUr0cggfl3rBmuGkPHAqIAHpmnrETShTUdW7inU5tjQlvxc7PtkckoHfdg1Dci1ZP9HEyE9mwQKvi0XPIpDaD0qFCMdgdRvcwGjJPUj6UxkbGA5P1roZLRGA2pg9+etR/YR6VqpIi5zwikJ47elW7OBXbE6M4PTDBf1IrXWx2nIpWs9zZbGfpUyd9BqVjHuLKHzlVD5Sn/npzj8QKry28kXCvG/OPlJroGsgcfKB9KfFahFIMcbZ/vLSTt5jcrmCZZ2jC5AUdAOKjEbD7oAPsK6D7Cuc4A+lP+xJVKUVsS22c75DseR+lTxwtwCFAHFb8dtGoIZQc/pQLZR0ocwMlbNPLJaXn2Qn9at2emRy43LMFPRsitFIwF25wPqalEcR6n9axlKXRmkXHqUbjSEhTdG8h56FP61HHae2TWsNu3bv49M0ZQfdwD9aSlO1nqD5W9CvRRRWhkFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAH/2Q=="},{name:"posx",resource:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCACAAIADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDj3i3DcoGKgZcHmrOGXoaa3P3hX3x84VSKTFTtHxkcioyKoCPFBp+KNtAEZpKeVpMUWGMpQKcFp6qT0oAYEpwSpVi9TTtgx1pARbRQKl2D1pQmeBSAhxS4qYJjtTglMRbaIjqMVG0ea6e80grnYx/GsuaxkiPzL+NZxqJiaaMdoiOgqNkz2rW8kscbRn3qvJDgnIIrRMLmeUo21cMXtQIc9KdwuUilNKVfa3I96j8n2oQXKgQ0oQ1ehtmkdUjUsxOAAOTXW6d4A1a7jD7IUDDgPJ/hWdSrCn8bsVGMp/CjhghpwjNejf8ACs9TWBmea1WT+FAxOfqccVdtPCNnHZrHewAXAHzOJcnP06Vi8ZS6O5oqM+qPLhGakVcdq9IuvC2kJbM0k7QYHDE5/TvXF3lnDHcMlpKZ4+zbdufwq6deNTYicHDczdpNOCVejs3Y42nNaFto00nbH1rRzSM7NnZXduVPOD+FZ8sULjBBVqrf2pdj+IH61Gb6beGAwfauKNOS3NXUiyG707umOfbrWTLbFG5HFdDLqlxMm2UBhjHIqi+1+x/GtoOS3M5cvQj0nTtOvJit5cm0QdDjJP8AhV698MwPNjSrqN4gM+ZM+M+wGKz/ACeeKuwXk8KIuEdU6BlzSmp3vFjjONrSRVj0HUAQrWkmDwHA4P41BPo06sFEL7j0G3rXSW+oavdkiJZJAecKOK0pdUuLCPyrmNklIyVZen0NZutUTtZXNFCDV7s5OLRpLMrcNMItuDkryD9K301q5iiURXO9gOSAaz7y4+23HmSxjHoOKnF0yoAoUAdBj7tE4uaXOhRmo35S7/bFztDXksoUjjaeaoX2sXMqslt5wQ8BmPNRSASHdId7fWmfIOi0RoxWtglVk+pmvFdXLfvXdh6E1citokAyoHrU24DgAigOM527j71q2zNNCoYozmOMsfXFWUF5OdsUDD68UhupXQR8kelSxWl7MVxHKVPTAPNZydty009iO4sowxML/L2Ddf5VEluyNnAJFdItmAeVzTmtI8YEQz65NRzvYmyvdGOk7xQFVSIhhgjyx0qCRXnjZUtolBIJKp0/HtW8tkgPKbuOlAtCpO0lR7GkrLYpyb0ZkDw9eiEyNEqjsCwyar/YWiYefE2CM4BxXQG3ZvvFj9TUkUATnYrN/tDNNTktyWo9DIW6a3h8u1iEZznIJJ/nUd5eXV6ytcrG7KMKSg4rbe3LtuIUH2GKaLQH7x4pJQTvbUHOT0voc0tqe4qSKyaRwqKSTXRizjzx+oqdUWNQqKo9TjrVSq9hRj3MJtAvFRH8oYY4ADDP86hl0m5U/NCfwwf5V0ZjQjOCD7CozD8xIJGfeojUn1KlGHQ5l7J05aMjtyKmtYFZ8PsQe/etxrUNySSaZ9jHpWjndWJWjKV5JAhUW1vGCOpGSDUya3qCqF37QBgbRirS2ceRkHHcUhs1/hHHvWPLB6NXNPayWq0LlFFFUZBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB/9k="},{name:"posy",resource:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCACAAIADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwC1qV5cyxPNKijfhSQuO3SsTqa2Ndv1uljihi8qNM985+tYjHnivtYLTY+cm9RswUOQpyPWoyMDmplUYyTxVaR85q0BHIRVdzUj1GapARMaYakYUwiqGMNNNSYq2lmxgMhU+3vS2AziKaatNESxAHSoJI2T7w4p3HYZmjNIaQ00IXNLTAacDTA7aZaqSLirsnNVpBWKIKUhPI7VWfNXJFqu4qkMrmmNUxFRsKYyI0wipduacsfBLdBTAS3j3uq+prevJYUsxEOXVccetYSsVbI4xU3LguSD61LVxp2GODEgY8nqaA/mxbXXcf4TULsSx3ElfTNXNKZSZM+mRmh6alxMq7h8naMcnmq9Wr2QzTs2MdsVWNUiWNoB5oxSnGPeqA7pqgkFTvUL1gQVZBVd1q1JURXJqkBVKUzZVwoAeKU7EXjlqYFVYsct0qOZh0FSzy5FUmOSaYxCadExXcB360qRFhnFTrEAAScUxjGjVY95GSRyKpmUrkLxV+Yr5eMHj171Q8pj0FCGRHmm7TU3l46imvTAhPy1ETzUj9ajNMDvnqBxzU55NIwArAgrGMmm7CTxUr5JoB2D3NMCrN8vGOapSsQas3DZJA61Tb71UgImy1PSA9TUowOtOEnI9KYy7psIeNyRnaMYrXbSE8hJAOvUelZukzCKYmQfunBU1urN9mUpOcow3DPas5OxcVcwrrTFwSOaoR2/lZ39K6OWeKRRt4b0rH1y4SONEUfP3pxk9gaMa7wGPpVBzzUsrlzk1Ca1JGNUZqRqYaYHoWzvUMmKtSHjFVJDzXOSRdW5pk7bcYpztiqsjEmqQiGTkmoSAKmOagfrVjGO1OhAJwe9MYHFLEDnAoGX7VSvBJC+tX7i4NzFhyAB6Cn2Ngz2xdkJzwPanLphDHLdfSobRcSvZEeW7Nzt6Vz+oTNNcsXOcHiuk1GIWVuDnGa5i4R3JkPFOHccmVnGKjNSseMVCxrUgYaaacaaaAPRJDVSXrU7NVeWsCCvIagNSyVCxFUAyQ8VB1anuaSMpn5yRTGXbG1WZwMEk9KsC0EMjFoshOvvVnT54kt8QqFduN3XFTQ2zszmSUMp6nNS2NEcWsKq+UI8KD61sQeXPF5yuRkcVhPZ2/mO8UoIH8NNtL1lkaPcAhzgehpWT2Ku0XdfCPalmxla4+5k+XHatLV9TDwmBckg/erAkct1rSCsglqNY5ph5NLTTVkiGkoooGd61QyVMx4qvKawMytKaquanl71WerQ0Naomp7Go2OaYx8c7RH5SRVs6tILcxA8EYNZzCmEUWGWBdugO04zUP2kgGom6VGaBgx3Ek0xhTs00mmMYajNPammqENopcUYoA7p6qyGr0qVTlGKxRmVJKrOKtuKrOKpDRCRTDUrVE1BQ00winGm5NMBjDNREGpzjsKYetMZFtJqSG2lnfZEjO56ADJrs/A3h211uO5+0NtaMBlIbB/Kun8PeGrKweRpAZbns+cbPwrnniIxbXVGqptq54/NDJGzB0ZSOoI6UxY2blVJ+gr2PWtJsmRxcDLP2HHFZVuunadYSQQxptzvLMMke4qo17rYThZnmLxlTyCKaRW/4iaK6u/MtY8DHzEd6xpoXiIDqVzzW6d0Q1Y//9k="},{name:"posz",resource:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCACAAIADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwC9NAccc1QniI6iugubV43KgZxWfNH6ivtVI+aasYciEVXda1Zo8ZqlIgz6VaYFBlqJlq3ImDUDCqQ7kBFRkVORmo2GKoZCab3p5pppgdd4S1iPSgxDbpJRsKjsK7karbw6Z5kcg89znryDXjMblDkVdn1GR41jQlEAxwetc86Ck7m0alkdPrGuB87ZNz+tYYuTKS9zMAp7Z61ivIexNRMxbqa1jTUVoQ53Ny81KAR+TaxAIOrnqxrNmmWQ7nAJqrgmnKlWo2E5NnvmvWyGTegBNc3d24U/OhGfXoatS3srNu/i7nPWq0t47DDDI968+nTlBJMuVSMmZV1ap/CSPY1lz2rDpzW9NJuHK1nyjriuhNmTsYckRB5FVpErYlB9BUMnlsuHjGfUcVaYjHZeOlJ5akfeH41elgXPytwarNEw6DNVcCBoBjJU/UdKjeH+5zVjLr6imE5p6jKhXHY0xlNXTnBFJg4xxTuFyjtzThHVwRjuAaURrnpincRVWP2qVYie1XYLYydASK1bTSmZgH4z271MqiQJNndvYSDquKp3Nq6E7l/EdK7mSS1ScNJFKUB5UHI/HPNMuJIijPaQQv2OBhgPpXkLGPsdTw67nnjxnOMVGLd5nCRIzueiqMmug1C+iWZv9DiI/wBpcEH8Ko2t6kLsykwk5yUPUeldSrNq9jH2VnuZN1pdzFIsbwsHYZCjkn8qy5rcqxBUgg4INdXdyiSSQ2silCvLFcH6Z/CqckHluyyKvmnnJPX+hq4VHbUUoK+hy7xGoHjIrobpZlO3HPXiqjxvIwUn5icVqpEWMUxM5wAWJ6CnXGm3NuAZ4JYgem9SK9M0TTbPTNOF3KsRvFU7ZN5PJ9O1Y13qDSTb873znNc6xXNJqK0Rt7Cyu2cMLc45FXtN0S41AO0O0InVmOAK1bi2FxO0jIIk4LEDr7iprKZ7VZ1s3Plvxh2H51rKq2vd3IUVfXY5q5sZLeRkdckdwOKhWLmuim+0vtAjG5vxzUYsZh8zwY9SCK0jU01IcexFYYAUKME8V2VnpgS1Vv4mGc4rA02aK1cGSMNjpuIGKv3niGV12Roo7ZGRXNVU5O0TaEoxV5HotwzPGY5kBb+8Rz+dZS27RTFiGdT2DYq/JdoTneh/Go/tKEcuv5158INLY0dS73My5VGceZbgoOx5P59arSWljLnFoQfZjzWvJLE39z8TUDLEf4lrZIj2jMN9Li+YQpKjfnUNzpt0yBA+6NBxkYxXQjYpyJP1od1I4IrRSkthNp7nHyWk0fDYYeh5piQjcMQZNdayr3Kn8KYFQMDsT8q09o7bEWS6nPtYajIoHyiPspIAH4VNBo+E/fGMOep61tOxP1qBo2Y8kVD5peRfNFeZky6ZCn37nj2FVZoLVUKeazD2Fbc1qJOSBnPYVH9hjA+5k+9VFd2Jz7I5wqinMfmZ7c1FKksp5LEe5zXTCxCsCAD+FAshnkcHsOK15kjO9zmo4GU5CDPvVqGxVpf9IkAXqSpzW+LREPyxA/73NDWwIwI0HuBUuTew1Zbl2iiipICiiigAooopgFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB/9k="}],i=n.map((e=>new Promise(((t,r)=>{var i=BI.loadImageFileFromBase64(e.resource);n[e.name]=i,t()}))));Promise.all(i).then((()=>{r.cache.envMap=new TU({data:[n.posx,n.negx,n.posy,n.negy,n.posz,n.negz],complete:function(t){e()}})}))}))}_loadModels(e){var t=this[wG].cache.models,r=e.parseModel("Box");r.setVisible(!1);var n=e.parseModel("Plane");n.setVisible(!1),t.box=r,t.plane=n}_setupMacros(e){var t=BI.getMacros();t.PRO=!1,t.VERSION="2.5.3",t.COMPILETIME="Mon, 05 Jun 2023 06:13:00 GMT",t.GITCOMMITHASH="c686bda1fba2e502a8b6d2c547953de86f9a9a6d",t.GITBRANCH="master",t.DEBUG=BI.parseValue(e.debugMode,!1),t.VERBOSE=BI.parseValue(e.verboseMode,"undefined"!=typeof _VERBOSE&&_VERBOSE)}_setupFactory(e){var t=e.factory||[];BI.isArray(t)||(t=[t]),t.forEach((e=>{BI.addFactory(e)}))}_setupCache(){var e=this[wG].cache;e.getResource=function(t){var r=e[t];return void 0===r&&(r=this.createObject(t),e[t]=r),r}}loadResource(e){var t=this[wG],r=t.cache;this._loadModels(e);var n=[];n.push(this._loadEnvMap()),n.push(...this._loadImages()),t.readyPromise=Promise.all(n).then((()=>{r.ready=!0,r.resolves&&(r.resolves.forEach((e=>{e()})),r.resolves=[])}))}getClassNamesFromObject(e){var t=this[wG],r=e.__proto__,n=BI.getClassNameFromProto(r),i=t.cache.classes,a=i.get(n);return a||(a=BI.getClassNamesFromProto(e.__proto__),i.set(n,a)),a}get cache(){return this[wG].cache}get gc(){return this[wG].gc}dispose(){var e=this[wG].cache;for(var t in e.classes.clear(),e.models)e.models[t].dispose();for(var r in e.models={},e.images)e.images[r].dispose();e.images={}}waitForComplete(){return this[wG].readyPromise}get httpRequestHeaders(){return BI._system.getHttpRequestHeaders()}set httpRequestHeaders(e){BI._system.setHttpRequestHeaders(e)}get onGetResourceTypeFromUrl(){return BI._system.onGetResourceTypeFromUrl}set onGetResourceTypeFromUrl(e){BI._system.onGetResourceTypeFromUrl=e}get macros(){return this[wG].macros}};var TG={isResident:!0};class DG extends mj{constructor(e){void 0===e&&(e={}),super(e)}onParseEvent(e){return-1!==["wheel","mouseenter","mouseleave","mousemove","mousedown","mouseup","keydown","keyup","keypress","click","dblclick"].indexOf(e.type)&&(e.useCapture=!0),!0}onSetupComponent(e){super.onSetupComponent(e),this.addComponent(XL,"dynamicLoad",TG)}onSetupResource(e){this.onSetupURL(e),this.onLoadComplete()}onLoadComplete(){this.destroyed||(this._resourceState=mj.ResourceState.Loaded)}get isRootObject(){return!0}}class MG extends $V{constructor(e){void 0===e&&(e={}),super(e)}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("AmbientLight"),super.onBeforeSetup(e)}onBeforeDestroy(){return MG.keepAliveObject!=this&&super.onBeforeDestroy()}get isAmbientLight(){return!0}}MG.keepAliveObject=null;var PG=Symbol("private"),FG=Le.toText("160,152,58,38,127,54,1,64,210,235,125,186,56"),RG=Le.toText("145,145,49,35,104,7,33,90,216,235,83,174,39,110,25,120");class NG{constructor(e){void 0===e&&(e={}),this[PG]={};var t=this[PG];t.app=BI.getCurrentApp(),t.rootObjects={},t.scene=null,t.ambientLight=null,t.mainLight=null,t.envMap=null,t.envMapLightIntensity=0,t.instancedOffset=null,t.renderOptions=null,t.curCameraIndex=-1,t.cameras=[],t.beforeRenderCallbacks=new Gt,t.afterRenderCallbacks=new Gt,this._initScene(e),this._initLight(e),this._initRenderOptions(),this._initEnvMap(e),this.staticMode=!0}_onBeforeRender(e,t){var r=this[PG];r.beforeRenderCallbacks.invoke(e,t),r.app.delegate.onBeforeRender(t),r.scene.beforeRender(e)}_onAfterRender(e,t){var r=this[PG];r.scene.afterRender(e),r.app.delegate.onAfterRender(t),r.afterRenderCallbacks.invoke(e,t)}_initScene(e){var t=this[PG];t.scene=e.scene,t.rootObjects.scene=new DG({name:"scene-root",loaded:!0});var r={attachedPoint:BI.createObject("Node"),debug:BI.createObject("Node"),bodyBridge:BI.createObject("Node")};for(var n in r){var i=new mj({rootNode:r[n],name:n+"-root",queryable:!1,loaded:!0,castShadow:!1,receiveShadow:!1});t.rootObjects[n]=i}var a=t.scene.getRoot();for(var s in t.rootObjects)a.add(t.rootObjects[s].node);var o=Le.toText("181,152,32,13,108,33,60,90,214,224,67,180,46,124"),l=t.scene[o]();l.setVisible(!0),t.overlayRootNode=BI.createObject("Node"),t.overlayRootNode.setName(Le.toText("157,139,49,48,118,37,55,100,216,246,101")),l.add(t.overlayRootNode),t.overlayLogoRootNode=BI.createObject("Node"),t.overlayLogoRootNode.setName(Le.toText("157,139,49,48,118,37,55,122,216,254,126,137,46,103,8")),l.add(t.overlayLogoRootNode),t.accessors={},t.accessors[Le.toText("189,139,49,48,118,37,55,100,216,246,101,149,46,108,25")]=t.overlayRootNode,t.accessors[Le.toText("189,139,49,48,118,37,55,122,216,254,126,137,46,103,8,68,148,163,172")]=t.overlayLogoRootNode}_initLight(e){if(BI.parseValue(e.initLights,!0)){var t=this[PG].rootObjects.scene,r=new MG({parent:t,name:"mainAmbientLight",intensity:.5,color:[1,1,1]}),n=new cG({parent:t,name:"mainDirectionalLight",intensity:.5,color:"#ffffff",target:[0,0,0]}),i=n.adapter;i.horzAngle=40,i.vertAngle=30,i.bind(t),this.ambientLight=r,this.mainLight=n}}_initRenderOptions(){var e=this[PG];e.renderOptions=new ur({data:{environment:{quaternion:null}},onChange:function(t){e.scene&&e.scene.setRenderOptions(t.data)}})}_initEnvMap(e){var t=BI.parseValue(e.envMap,null),r=this[PG].app;if(BI.isArray(t)){var n=new TU(t);this.envMap=n}else if(BI.isString(t))if(t.indexOf(".png")>-1||t.indexOf(".jpg")>-1){var i=new DU({url:t,mappingType:rI.EquirectangularReflection});this.envMap=i}else{var a=BI.parseCubeTextureUrlsByPath(t),s=new DU(a);this.envMap=s}else e.defaultSettings.envMap&&r.global.waitForComplete().then((()=>{this.envMap=r.global.cache.envMap}))}dispose(){var e=this[PG];for(var t in e.overlayRootObject&&(e.overlayRootObject.destroy(),e.overlayRootObject=null),e.overlayRootNode.dispose(),e.overlayLogoRootNode.dispose(),e.overlayRootNode=null,e.overlayLogoRootNode=null,e.accessors=null,Sj.keepAliveObject=null,MG.keepAliveObject=null,cG.keepAliveObject=null,e.rootObjects)e.rootObjects[t].destroy();e.rootObjects={},e.renderOptions.dispose(),e.renderOptions=null,e.scene.dispose(),e.scene=null,e.ambientLight=null,e.mainLight=null,e.envMap=null,e.curCameraIndex=-1,e.cameras=[],e.beforeRenderCallbacks.clear(),e.afterRenderCallbacks.clear()}resize(e,t){var r=this[PG];r.cameras.forEach((r=>{r.resize(e,t)})),r.overlayRootObject&&(r.overlayRootObject.width=e,r.overlayRootObject.height=t)}render(e){var t=this[PG],r=t.cameras,n=r[0];if(n){var i=n.node;this._onBeforeRender(e,i),i.render();for(var a=1,s=r.length;a<s;a++){var o=r[a];o.visible&&(o.renderTexture?o.node.render(o.renderTexture.getTextureResource()):o.enableViewport&&o.viewport&&o.node.render())}if(t.overlayRootNode&&t.overlayRootNode.getVisible()){var l=i.getAttribute(RG);i.setAttribute(RG,!1),i[FG](),i.setAttribute(RG,l)}this._onAfterRender(e,i)}}addRenderCamera(e){var t=this[PG],r=t.cameras;e.node.setAttribute(RG,!1);var n=r[t.curCameraIndex];BI.pushToArray(r,e),t.curCameraIndex=r.indexOf(n)}removeRenderCamera(e){var t=this[PG],r=t.cameras,n=r[t.curCameraIndex];BI.removeFromArray(r,e),t.curCameraIndex=r.indexOf(n)}addBeforeRenderCallback(e){this[PG].beforeRenderCallbacks.add(e)}removeBeforeRenderCallback(e){this[PG].beforeRenderCallbacks.remove(e)}addAfterRenderCallback(e){this[PG].afterRenderCallbacks.add(e)}removeAfterRenderCallback(e){this[PG].afterRenderCallbacks.remove(e)}getAttribute(e){var t=Le.toText("157,139,49,48,118,37,55,100,216,246,101,148,35,98,25,105,143"),r=Le.toText("147,158,55,39,105,55,33,68,196"),n=this[PG];switch(e){case t:if(!n.overlayRootObject){var i=n.app;n.overlayRootObject=new mj({name:Le.toText("189,139,49,48,118,37,55,100,216,246,101"),rootNode:n.overlayRootNode,parent:null,queryable:!1}),n.overlayRootObject.x=0,n.overlayRootObject.y=0,n.overlayRootObject.width=i.size[0],n.overlayRootObject.height=i.size[1]}return n.overlayRootObject;case r:return n.accessors;default:return null}}get root(){return this[PG].scene.getRoot()}get rootObjects(){return this[PG].rootObjects}get cameras(){return this[PG].cameras}get camera(){var e=this[PG];return e.cameras[e.curCameraIndex]}set camera(e){var t=this[PG],r=t.cameras.indexOf(e);-1===r&&(t.cameras.push(e),r=t.cameras.length-1),t.curCameraIndex=r,this.renderCamera=e,Sj.keepAliveObject=e}get renderCamera(){return this[PG].cameras[0]}set renderCamera(e){var t=this[PG],r=t.cameras,n=r[t.curCameraIndex],i=r[0];i&&i!=e&&(i.enableViewport=!1);var a=r.indexOf(e);-1===a?r._insert(0,e):0!==a&&r._swap(0,a),t.curCameraIndex=r.indexOf(n),e.enableViewport=!0}get instancedOffset(){return this[PG].instancedOffset}set instancedOffset(e){var t=this[PG];e?(t.instancedOffset=e.slice(0),this.root.setInstancedOffset(t.instancedOffset)):(t.instancedOffset=null,this.root.setInstancedOffset([0,0,0]))}get staticMode(){return this[PG].scene.isEnabled("TransformCache")}set staticMode(e){this[PG].scene.enable("TransformCache",e)}get envMap(){return this[PG].envMap}set envMap(e){var t=this[PG],r=t.scene;t.envMap&&t.envMap.release(),e?e.isImageTexture||e.isCubeTexture?(t.envMap=e,t.envMap.addRef(),t.envMap.waitForComplete().then((e=>{r.setEnvironment(e.getTextureResource())}))):BI.isString(e)?(t.envMap=new DU(e),t.envMap.mappingType=rI.EquirectangularReflection,t.envMap.waitForComplete().then((e=>{r.setEnvironment(e.getTextureResource())}))):(t.envMap=null,r.setEnvironment(null)):(t.envMap=null,r.setEnvironment(null))}get envMapLightIntensity(){return this[PG].envMapLightIntensity}set envMapLightIntensity(e){var t=this[PG];t.envMapLightIntensity=e,t.scene.setEnvironmentLightIntensity(e)}get ambientLight(){return this[PG].ambientLight}set ambientLight(e){this[PG].ambientLight=e,MG.keepAliveObject=e}get mainLight(){return this[PG].mainLight}set mainLight(e){this[PG].mainLight=e,cG.keepAliveObject=e}get renderOptions(){return this[PG].renderOptions.dataProxy}set renderOptions(e){var t=this[PG],r=t.scene,n=t.renderOptions.dataProxy;e?(BI.mergeObject(n,e,!0),r.setRenderOptions(n)):(n.environment.quaternion=null,r.setRenderOptions(n))}get renderState(){return this[PG].scene.getRenderState()}get isScene(){return!0}}var BG=Symbol("private"),IG=Le.toText("129,141,38,43,110,33"),OG=Le.toText("161,141,38,43,110,33,61"),kG=Le.toText("141,162,117,53,123,48,43,68,148,244,112,169,42,34,25,124,158,169,189,118,177,195"),LG=Le.toText("141,162,117,42,115,32,43,23,192,248,101,190,51,43,17,107,137,172,227,83,152,249,227,69,12,158,226");class UG{constructor(){this[BG]={};var e=this[BG];e.timer=new Io({interval:500,onInterval:()=>{this._check()}}),e.options={}}_createWatermarkStyle(e){var t=this[BG],r=BI.createObject("CanvasRenderer");r.resize(512,512);var n={size:24,type:"Verdana",color:[1,1,1],shadowColor:[0,0,0],shadowAngle:30,shadowDistance:2},i=r.getTextRows(e,n);if(!i)return r.dispose(),null;r.resize(i.size[0],i.size[1]),r.drawText(i,n);var a=r.getContext(),s=BI.createObject("Style");return s.setOpacityOp((()=>.1)),s.setImage("Map",BI.createObject("ImageTextureResource",{data:a})),t.options.imageWidth=a.width,t.options.imageHeight=a.height,r.dispose(),s}_removeWatermarkSprites(){var e=this[OG];BI.isArray(e)&&(e.forEach((e=>{e.dispose()})),e.length=0)}_createWatermarkSprites(e,t,r,n,i){var a=n[0],s=n[1],o=r[0],l=r[1],u=i[0],c=i[1];this[OG]=this[OG]||[];var h=this[OG];this._removeWatermarkSprites();for(var d=-s;d<s;d+=l)for(var p=-a;p<a;p+=o){var f=BI.createObject(IG);f.setScale([u,c,1]),f.setPosition([p,d,-1]),f.setStyle(t),f.setAttribute("Rotation",QI.degToRad(30)),h.push(f),e.add(f)}}_initOptions(e){var t=this[BG],r=e.rootNode,n=BI.parseValue(e.enable,!0),i=e.text||Le.toText("134,149,61,44,125,14,29,22,213,224,49,142,8,70,51"),a=e.width||480,s=e.height||320;if(i){var o=this._createWatermarkStyle(i);o&&(t.options.enable=n,t.options.rootNode=r,t.options.style=o,t.options.width=a,t.options.height=s)}}_initEvents(){var e=this,t=this[BG];if(t.options.enable){var r=BI.getCurrentApp();r.on(kG,pB((function*(r){var{scaleFacotr:n,opacity:i,width:a,height:s,data:o,text:l}=r;if(l){var u=e._createWatermarkStyle(l);if(!u)return;t.options.style=u;var c=BI.getCurrentApp().size,{rootNode:h,width:d,height:p,imageWidth:f,imageHeight:m}=t.options;e._createWatermarkSprites(h,u,[d,p],c,[f,m])}else if(o){var g=t.options.style.getImage("Map");if(!g)return;if(BI.isString(o)){var _=yield BI.loadBitmapImageFromBase64Async(o);if(!_)return;g.setImage(_),a=_.width,s=_.height}else a&&s&&(g.setImage({width:a,height:s,data:o}),g.enable("FlipY",!0));for(var v=[a*(n=BI.parseValue(n,1)),s*n,1];v[0]>256||v[1]>256;)v[0]*=.5,v[1]*=.5;t.options.rootNode.getChildren().forEach((e=>{e.setScale(v)}))}BI.isNumber(i)&&t.options.style.setOpacityOp((()=>i))})),{enumerable:!1}),r.on(LG,(e=>{this._removeWatermarkSprites()}),{enumerable:!1})}}_isVisible(){for(var e=this[BG].options.rootNode;e;){if(!e.getVisible())return!1;e=e.getParent()}return!0}_forceShow(){for(var e=this[BG].options.rootNode;e;)e._visible=!0,e._node.visible=!0,e=e.getParent()}_check(){var e=this[BG].options;if(e.enable&&!this._isVisible()){var t=e.rootNode;t.getChildren().slice(0).forEach((e=>{e.dispose()}));var r=e.style,n=e.width,i=e.height,a=e.imageWidth,s=e.imageHeight,o=app.size;this._createWatermarkSprites(t,r,[n,i],o,[a,s]),this._forceShow()}}init(e){var t=this[BG];this._initOptions({rootNode:e}),this._initEvents();var r=BI.getCurrentApp().size,{style:n,width:i,height:a,imageWidth:s,imageHeight:o}=t.options;this._createWatermarkSprites(e,n,[i,a],r,[s,o])}update(e){this[BG].timer.update(1e3*e)}}var zG,jG=Symbol("private");class VG{constructor(e){void 0===e&&(e={}),this.node=e.node||BI.createObject("ParticleEmitter"),this[jG]={};var t=this[jG];t.maxAge=this.node.getAttribute("MaxAge"),t.position=this.node.getAttribute("Position"),t.rotation=this.node.getAttribute("Rotation"),t.velocity=this.node.getAttribute("Velocity"),t.listColor=this.node.getAttribute("ListColor"),t.listOpacity=this.node.getAttribute("ListOpacity"),t.listSize=this.node.getAttribute("ListSize"),t.listAngle=this.node.getAttribute("ListAngle"),t.acceleration=this.node.getAttribute("Acceleration"),t.drag=this.node.getAttribute("Drag"),t.onChange=null;var r=this;t.objectProxy=new ur({data:{MaxAge:t.maxAge,Position:t.position,Rotation:t.rotation,Velocity:t.velocity,ListColor:t.listColor,ListOpacity:t.listOpacity,ListSize:t.listSize,ListAngle:t.listAngle,Acceleration:t.acceleration,Drag:t.drag},onChange:function(e){r.setAttribute(e.propName,e.data[e.propName]),t.onChange&&t.onChange(e)}})}getAttribute(e){return this.node.getAttribute(e)}setAttribute(e,t){this.node.setAttribute(e,t)}get particleCount(){return this.getAttribute("ParticleCount")}set particleCount(e){this.setAttribute("ParticleCount",e)}get distribution(){return this.getAttribute("Distribution")}set distribution(e){this.setAttribute("Distribution",e)}get duration(){return this.getAttribute("Duration")}set duration(e){this.setAttribute("Duration",e)}get isLookAtCamera(){return this.getAttribute("IsLookAtCamera")}set isLookAtCamera(e){this.setAttribute("IsLookAtCamera",e)}get isLookAtCameraY(){return this.getAttribute("IsLookAtCameraY")}set isLookAtCameraY(e){this.setAttribute("IsLookAtCameraY",e)}get maxAge(){return this[jG].objectProxy.dataProxy.MaxAge}set maxAge(e){for(var t in e)this.maxAge[t]=e[t]}get position(){return this[jG].objectProxy.dataProxy.Position}set position(e){for(var t in e)this.position[t]=e[t]}get rotation(){return this[jG].objectProxy.dataProxy.Rotation}set rotation(e){for(var t in e)this.rotation[t]=e[t]}get velocity(){return this[jG].objectProxy.dataProxy.Velocity}set velocity(e){for(var t in e)this.velocity[t]=e[t]}get color(){return this[jG].objectProxy.dataProxy.ListColor}set color(e){for(var t in e)this.color[t]=e[t]}get opacity(){return this[jG].objectProxy.dataProxy.ListOpacity}set opacity(e){for(var t in e)this.opacity[t]=e[t]}get size(){return this[jG].objectProxy.dataProxy.ListSize}set size(e){for(var t in e)this.size[t]=e[t]}get angle(){return this[jG].objectProxy.dataProxy.ListAngle}set angle(e){for(var t in e)this.angle[t]=e[t]}get acceleration(){return this[jG].objectProxy.dataProxy.Acceleration}set acceleration(e){for(var t in e)this.acceleration[t]=e[t]}get drag(){return this[jG].objectProxy.dataProxy.Drag}set drag(e){for(var t in e)this.drag[t]=e[t]}get onChange(){return this[jG].onChange}set onChange(e){this[jG].onChange=e}}class GG{constructor(e){void 0===e&&(e={}),this.node=e.node||BI.createObject("ParticleGroup")}getAttribute(e){return this.node.getAttribute(e)}setAttribute(e,t){this.node.setAttribute(e,t)}addEmitter(e){var t=e.node;if(this.node)return this.node.addEmitter(t),this._updateEmitters(),this.emitters[this.emitters.length-1]}removeEmitter(e){this.node&&0!=this.emitters.length&&(this.node.removeEmitter(e.node),this._updateEmitters())}_updateEmitters(){this._emitters=[];var e=this;this.getEmitters().forEach((t=>{var r=new VG({node:t});e._emitters.push(r)}))}getEmitters(){return this.node.getEmitters()}get emitters(){return this._emitters||this._updateEmitters(),this._emitters}get maxParticleCount(){return this.getAttribute("MaxParticleCount")}set maxParticleCount(e){return this.setAttribute("MaxParticleCount",e)}get useMesh(){return this.getAttribute("UseMesh")}set useMesh(e){this.setAttribute("UseMesh",e);for(var t=0;t<this.emitters.length;t++)this.emitters[t].node=this.node._emitters[t]}get meshUrl(){return this.getAttribute("MeshUrl")}set meshUrl(e){this.setAttribute("MeshUrl",e)}get texture(){return this.getAttribute("Texture")}set texture(e){this.setAttribute("Texture",e)}get blendingMode(){return this.getAttribute("BlendingMode")}set blendingMode(e){this.setAttribute("BlendingMode",e)}get isTransparent(){return this.getAttribute("IsTransparent")}set isTransparent(e){this.setAttribute("IsTransparent",e)}get alphaTest(){return this.getAttribute("AlphaTest")}set alphaTest(e){this.setAttribute("AlphaTest",e)}get depthWrite(){return this.getAttribute("DepthWrite")}set depthWrite(e){this.setAttribute("DepthWrite",e)}get depthTest(){return this.getAttribute("DepthTest")}set depthTest(e){this.setAttribute("DepthTest",e)}get url(){return this.getAttribute("Url")}set url(e){this.setAttribute("Url",e)}}class WG extends JV{constructor(e){void 0===e&&(e={}),super(e);var t=this.app.camera.bodyNode.$uAppView._renderer.renderPass.gl,r=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1];r<1024&&console.warn("The maximum settable gl_pointSize supported by the current browser is "+r+", when the calculated value exceeds this value, the display may be incorrect.")}onUpdate(e){this.loaded&&this.bodyNode.update(e,this.app.camera.node)}getStyle(){return zG=zG||new ek(new Bz(new mj({parent:null}))),console.warn("This interface cannot be used for particle!"),zG}addGroup(e){var t=e.node;if(this.node)return this.node.addGroup(t),this._updateGroups(),this.groups[this.groups.length-1]}removeGroup(e){this.node&&0!=this.groups.length&&(this.node.removeGroup(e.node),this._updateGroups())}_updateGroups(){this._groups=[];var e=this;this.getGroups().forEach((t=>{var r=new GG({node:t});e._groups.push(r)}))}getGroups(){return this.node.getGroups()}getParticleData(e){return this.node.getParticleData(e)}setRootPath(e){this.node.setRootPath(e)}getRootPath(){return this.node.getRootPath()}onLoadResource(e,t,r){if(BI.parseValue(e.assets,!0)){var n=this.app;if(e.screenSize=e.screenSize||n.size,e.maxVaryings=e.maxVaryings||n.renderCapabilities.maxVaryings,this.resource.url)n.resourceManager.loadParticle(this.resource.url,(e=>{this.body.setNode(e.node),t()}),(e=>{}),(e=>{r(e)}),e);else if(e.data){var i=n.resourceManager.parseParticle(e.data,e);i?(this.body.setNode(i),t()):r("Parse particle data failed")}else{var a=BI.createObject("ParticleSystem"),s=BI.createObject("ParticleGroup"),o=BI.createObject("ParticleEmitter");a.addGroup(s),s.addEmitter(o),this.body.setNode(a),t()}}else t()}get groups(){return this._groups||this._updateGroups(),this._groups}get isParticleSystem(){return!0}}class HG extends JV{constructor(e){void 0===e&&(e={}),super(e),this._initParam(e);var t=BI.createObject("EffectGroundObjectNode",{external:{uScene:this.node._uScene,param:e}});this._node=t,this.body.setNode(t),this.pickable=!1,this.bounding.inheritType=qB.Jump,this.updateGround(e.parent)}getType(){return"EffectGroundObject"}_initParam(e){e.color=e.color&&BI.parseColor(e.color),e.flowColor&&(e.flowColor=BI.parseColor(e.flowColor),e.flowColor.length=3)}onUpdate(e){this._node.groundReflect||this._node.update(e)}updateGround(e){if(e){var t=e.getOBB(!0,!1),r=t.halfSize[1]+.2-this._node.groundClearance,n=QI.scaleVector(e.up,r),i=QI.subVector(t.center,n);this.position=[i[0],i[1],i[2]];var a=QI.scaleVector([t.radius,1,t.radius],this._node.sizeFactor);this.scale=[a[0],a[1],a[2]],this.angles=e.angles,this.parent=e}else e||(this.position=[0,this._node.groundClearance,0],this.scale=[this._node.sizeFactor,1,this._node.sizeFactor])}set groundReflect(e){this._node.groundReflect=e,this.groundReflect&&this.updateGround(this.parent)}get groundReflect(){return this._node.groundReflect}set sizeFactor(e){this._node.sizeFactor=e,this.updateGround(this.parent)}get sizeFactor(){return this._node.sizeFactor}set imageUrl(e){this._url=this._node.imageUrl=e}get imageUrl(){return this._node.imageUrl}set maskUrl(e){this._node.maskUrl=e}get maskUrl(){return this._node.maskUrl}set opacityValue(e){this._node.opacityValue=e}get opacityValue(){return this._node.opacityValue}set glowFactorValue(e){this._node.glowFactorValue=e}get glowFactorValue(){return this._node.glowFactorValue}set repeatFactorValue(e){this._node.repeatFactorValue=e}get repeatFactorValue(){return this._node.repeatFactorValue}set repeatFactorValueX(e){this._node.repeatFactorValueX=e}get repeatFactorValueX(){return this._node.repeatFactorValueX}set repeatFactorValueY(e){this._node.repeatFactorValueY=e}get repeatFactorValueY(){return this._node.repeatFactorValueY}set groundColorValue(e){var t=BI.parseColor(e);this._node.groundColorValue=t}get groundColorValue(){return BI.toColorHexString(this._node.groundColorValue)}set flowColorValue(e){var t=BI.parseColor(e);t.length=3,this._node.flowColorValue=t}get flowColorValue(){return BI.toColorHexString(this._node.flowColorValue)}set animationSpeed(e){this._node.animationSpeed=e}get animationSpeed(){return this._node.animationSpeed}set groundClearance(e){this._node.groundClearance=e,this.updateGround(this.parent)}get groundClearance(){return this._node.groundClearance}dispose(){this._node.dispose()}copy(e){this._node.copy(e)}}var qG=128,XG=cI.ImageTexture;class QG{constructor(){this._app=BI.getCurrentApp(),this._themeMap=new Map,this._gradTexMap=new Map,this._scrollMap=new Map,this._scrollTexMap=new Map,this._envTexMap=new Map,this._particleItemsMap=new Map}register(e,t,r){this._themeMap.set(e,{baseUrl:r,json:t});var{styles:n}=t;n&&(this._gradTexMap.set(e,function(e){var t=new Map;for(var r in e)if(void 0!==e[r].useColorMap){var n=e[r].colorMapping;n&&(t.has(r)||t.set(r,KG(n)))}else{var i=e[r].colorMapping.gradient;i&&(t.has(r)||t.set(r,KG(i)))}return t}(n.class)),this._scrollMap.set(e,function(e){var t=new Map;for(var r in e){if(void 0!==e[r].useScrollTex){if(e[r].useScrollTex){var n=e[r].scrollSpeed,i=e[r].scrollOffset;t.set(r,{arr:[0,0],speed:n,offset:i})}}else if(e[r].scroll.enable){var a=e[r].scroll.speed,s=e[r].scroll.offset;t.set(r,{arr:[0,0],speed:a,offset:s})}}return t}(n.class)),this._scrollTexMap.set(e,function(e,t){var r=new Map;for(var n in e)if(void 0!==e[n].useScrollTex){var i=e[n].useScrollTex,a=e[n].scrollTex;i&&(r.has(a)||r.set(a,YG(a,t)))}else{var s=e[n].scroll.enable,o=e[n].scroll.texture;s&&(r.has(o)||r.set(o,YG(o,t)))}return r}(n.class,r)),this._envTexMap.set(e,function(e,t){if(!e)return;if(void 0!==e.path){var r,n=e.path;if("none"==e.name||!n)return;if(Array.isArray(n)){var i=n.slice(0);if(JG(i[0]))for(var a=0;a<i.length;a++)i[a]=t._appendPath(i[a]);r=new TU({url:i})}else{var s=n;JG(n)&&(s=t._appendPath(n)),(r=new DU(s)).mappingType="EquirectangularReflection"}return r}var o,{type:l,value:u}=e;switch(l){case"cube":var c=u.slice(0);if(JG(c[0]))for(var h=0;h<c.length;h++)c[h]=t._appendPath(c[h]);o=new TU({url:c});break;case"image":var d=u;JG(d)&&(d=t._appendPath(d)),(o=new DU(d)).mappingType="EquirectangularReflection"}return o}(n.environment,r))),function(e,t,r){var n=t.get(r);n&&n.forEach((t=>{0==t.speed?t.arr[1]=t.offset:e.on("update",(()=>{t.arr[1]-=t.speed}),r+"_scroll")}))}(this._app,this._scrollMap,e)}_clearMaps(e){var t=this._gradTexMap.get(e);t&&(t.forEach(((e,t)=>{e&&e.dispose()})),t.clear()),this._gradTexMap.delete(e);var r=this._scrollTexMap.get(e);r&&(r.forEach(((e,t)=>{e&&e.dispose()})),this._scrollTexMap.clear()),this._scrollTexMap.delete(e),this._envTexMap.get(e).dispose(),this._envTexMap.delete(e);var n=this._scrollMap.get(e);n&&n.clear(),this._scrollMap.delete(e)}unRegister(e){this._themeMap.delete(e),this._particleItemsMap.delete(e),function(e,t,r){var n=r.get(t);n&&n.forEach((r=>{0!==r.speed&&e.off("update",t+"_scroll")}))}(this._app,e,this._scrollMap),this._clearMaps(e)}getTheme(e){var t=this._themeMap.get(e);return t?t.json:null}loadParticles(e){if(this._themeMap.has(e)){var{baseUrl:t,json:r}=this._themeMap.get(e),n=r.particles;if(n){if(n.enable){var i=[],a={};return n.item.forEach((e=>{var r=t._appendPath(e.url)._appendPath("./index.json");e.url=t._appendPath(e.url),e.themePkg=t;var n=new Promise((t=>{BI.loadJSONFileAsync(r).then((r=>{r.version&&2!=!r.version[0]||(r=function(e){for(var t={version:"2.0.1",groups:[]},r=0;r<e.listGroups.length;r++){var n=eW(e.listGroups[r]);t.groups.push(n)}return t}(r)),a[e.url]=r,t()}))}));i.push(n)})),Promise.all(i).then((()=>{this._particleItemsMap.set(e,a)}))}}else console.warn(e+" theme doesn't have particles!")}}applyRenderSettings(e){if(this._themeMap.has(e)){var{baseUrl:t,json:r}=this._themeMap.get(e),n=r.renderSettings;if(n){var i=this._app;if(i.query("[userData/themeLight]").forEach((e=>{i.scene[e.userData.themeLight]=null,e.destroy()})),n.environmentMap&&void 0!==n.environmentMap.path){var a=n.environmentMap.envmap,s=n.environmentMap.path;if("None"!==a){var o;if(Array.isArray(s))if(JG(s[0])){var l=$G(s,t);o=new TU(l)}else o=new TU(s);else{if(JG(s)){var u=t._appendPath(s);o=new DU(u)}else o=new DU(s);o.mappingType=rI.EquirectangularReflection}o&&(o.isCubeTexture?(i.envMap=o,i.background=o):i.background=o)}}else{var c=n.background,h=n.environmentMap||n.environment;if(c)if(void 0!==c.type){var d,p=c.type,f=c.value;switch(p){case"cube":if(JG(f[0])){var m=$G(f,t);d=new TU(m)}else d=new TU(f);i.background=d;break;case"image":if(JG(f)){var g=t._appendPath(f);d=new DU(g)}else d=new DU(f);i.background=d;break;case"color":i.background=f}}else i.background=c;if(h)if(void 0!==h.type){var _,v=h&&h.type,y=h&&h.value,x=h&&h.diffuseIntensity;switch(v){case"cube":if(JG(y[0])){var b=$G(y,t);_=new TU(b)}else _=new TU(y);i.envMap=_;break;case"image":if(JG(y)){var A=t._appendPath(y);_=new DU(A)}else _=new DU(y);_.mappingType=rI.EquirectangularReflection,i.envMap=_}void 0!==x&&(i.scene.envMapLightIntensity=x)}else i.environment=h.envMap,i.scene.envMapLightIntensity=h.diffuseIntensity}if(n.envMapLight){var S=n.envMapLight.intensity;i.scene.envMapLightIntensity=S}var E=n.lights||n.light;if(E.directionalLights){E.ambientLights.forEach((e=>{var t;if(e.isMainLight)t=i.scene.ambientLight;else{var r=i.query("[uuid=="+e.uuid+"]");r.length?t=r[0]:(t=new MG).userData.themeLight="ambientLight"}for(var n in e)t[n]=e[n]})),E.directionalLights.forEach((e=>{var t;if(e.isMainLight)t=i.scene.mainLight;else{var r=i.query("[uuid=="+e.uuid+"]");r.length?t=r[0]:((t=new cG).adapter.bind(i.root),t.userData.themeLight="directionalLight")}for(var n in e)if("adapter"==n){var a=e[n];for(var s in a)t[n][s]=a[s]}else"helperVisible"==n?t.helper.visible=e[n]:t[n]=e[n];t.enableShadow&&t.adapter.refresh()})),E.hemisphereLights.forEach((e=>{var t,r=i.query("[uuid=="+directionalLightConfig.uuid+"]");for(var n in r.length?t=r[0]:(t=new hG).userData.themeLight="ambientLight",e)t[n]=e[n]}))}else{for(var w in E){var C=void 0;if("mainLight"==w)i.scene[w]&&!i.scene[w].destroyed||((C=new cG).userData.themeLight=w,i.scene[w]=C);else if("ambientLight"==w)i.scene[w]&&!i.scene[w].destroyed||((C=new MG).userData.themeLight=w,i.scene[w]=C);else if("hemisphereLight"==w)(C=new hG).userData.themeLight=w,i.scene[w]=C;else{if("mainLight"==w||"ambientLight"==w)continue;(C=new cG).adapter.bind(i.root),C.userData.themeLight=w,i.scene[w]=C}var T=E[w];for(var D in T)if("adapter"==D){var M=T[D];for(var P in M)i.scene[w][D][P]=E[w][D][P]}else"helperVisible"==D?i.scene[w].helper.visible=E[w][D]:i.scene[w][D]=E[w][D]}var F=n.adapter;if(F)for(var R in F){var N=F[R];for(var B in N)i.scene[R].adapter[B]=F[R][B]}}n.effect?i.camera.postEffect.config=n.effect:i.camera.postEffect.config=n.postEffects;var I=n.effects||n.cameraEffect||n.cameraEffects,O=i.camera.effect.config;for(var k in I)for(var L in I[k])if(BI.isObject(I[k][L])||BI.isArray(I[k][L]))for(var U in I[k][L])O[k][L][U]=I[k][L][U];else O[k][L]=I[k][L]}else console.warn(e+" theme doesn't have renderSettings!")}}_getTag(e,t){if(!e)return"";var r,n=t.userData,i=t.type;return r=n&&n._styleTag_&&e[n._styleTag_]?n._styleTag_:e[i]?i:BI.getClassNamesFromProto(this.object).find((t=>!!e[t])),r}_applyStyle(e,t,r,n){!function(e){e.body.style.begin(),e.body.style.beginDefaultValues()}(e),function(e,t,r,n,i){if(void 0!==t.useColorMap){if(t.useColorMap){var a=i.get(r).get(n);e.body.style.colorMapping=a}}else if(t.colorMapping&&t.colorMapping.enable){var s=i.get(r).get(n);e.body.style.colorMapping=s,e.body.style.setAttribute("ColorMappingIntensity",t.colorMapping.intensity)}}(e,t,r,n,this._gradTexMap),function(e,t){if(!0!==t.color.enable)return;e.body.style.color=t.color.value}(e,t),function(e,t){if(!t.removeDiffuseMap)return;e.body.style.map=XG}(e,t),function(e,t){if(!t.removeNormalMap)return;e.body.style.normalMap=XG}(e,t),function(e,t){e.body.style.transparent=t.transparent,t.opacity<1&&(e.body.style.transparent=!0);e.body.style.opacity=t.opacity}(e,t),function(e,t){e.body.style.wireframe=null===t.wireframe?null:!0===t.wireframe}(e,t),function(e,t,r,n){switch(t.useEnvMapType){case"global":e.body.style.envMap=null,e.body.style.envMapping=!0;break;case"styleFiction":e.body.style.envMapping=!0,e.body.style.envMap=n.get(r);break;case"none":e.body.style.envMap=null,e.body.style.envMapping=!1}}(e,t,r,this._envTexMap),function(e,t){if(!t.edge.enable)return;e.body.style.edge.enable=t.edge.enable,e.body.style.edge.color=t.edge.color,e.body.style.edge.glow=t.edge.glow,e.body.style.edge.opacity=t.edge.opacity}(e,t),function(e,t){e.body.style.effect.glow=t.effect.glow||null,e.body.style.effect.innerGlow=t.effect.innerGlow||null,e.body.style.effect.lineBloom=t.effect.lineBloom||null,e.body.style.effect.tailing=t.effect.tailing||null,e.body.style.effect.radial=t.effect.radial||null,e.body.style.effect.ghosting=t.effect.ghosting||null}(e,t),function(e,t){if(!t.reflection.enable)return;e.body.style.metalness=t.reflection.metalness,e.body.style.roughness=t.reflection.roughness}(e,t),function(e,t,r,n,i,a){if(void 0!==t.useScrollTex){if(!t.useScrollTex)return;var s=t.scrollTex,o=t.scrollColor,l=a.get(r).get(s);e.body.style.imageSlotType=JB.EmissiveMap,e.body.style.setAttribute("VerticalEmissive",!0),e.body.style.emissiveMap=l,e.body.style.emissive=(d=[],o.forEach((e=>{d.push(e/255)})),d),e.on("update",(()=>{if(i.has(r)){var t=i.get(r);t.has(n)&&(e.body.style.uv.offset=t.get(n).arr)}}),"updateScrollTexUv")}else{if(!t.scroll.enable)return;var{texture:u,color:c}=t.scroll,h=a.get(r).get(u);e.body.style.imageSlotType=JB.EmissiveMap,e.body.style.setAttribute("VerticalEmissive",!0),e.body.style.emissiveMap=h,e.body.style.emissive=c,e.on("update",(()=>{if(i.has(r)){var t=i.get(r);t.has(n)&&(e.body.style.uv.offset=t.get(n).arr)}}),"updateScrollTexUv")}var d}(e,t,r,n,this._scrollMap,this._scrollTexMap),function(e,t){if(null==t.specularFactor)return;var r=t.specularFactor;e.body.style.setAttribute("SpecularFactor",r)}(e,t),function(e,t){if(!t.fresnel||!t.fresnel.power)return;var r=t.fresnel.power,n=t.fresnel.inverse;e.body.style.setAttribute("FresnelPower",r),e.body.style.setAttribute("FresnelInverse",n)}(e,e),function(e){e.body.style.endDefaultValues(),e.body.style.end()}(e)}applyStyles(e,t){if(!t.userData._skipTheme_&&this._themeMap.has(e)){var{baseUrl:r,json:n}=this._themeMap.get(e),i=n.styles;if(i){t.children.forEach((t=>{this.applyStyles(e,t)}));var a=this._getTag(i.class,t);if(a){var s=i.class[a];0!=s.enable&&this._applyStyle(t,s,e,a)}}else console.warn(e+" theme doesn't have styles!")}}clearStyles(e){!function(e){var t=e.body.style;if(!t)return;e.off("update","updateScrollTexUv"),t.begin(),t.beginDefaultValues(),t.color=null,t.colorMapping=null,t.envMap=null,t.envMapping=null,t.emissiveMap=null,t.emissive=null,t.setAttribute("VerticalEmissive",!1),t.imageSlotType=THING.ImageSlotType.Map,t.uv.offset=[0,0],t.edge.enable=!1,t.edge.color=[1,1,1],t.edge.glow=!1,t.edge.opacity=1,t.map=null,t.normalMap=null,t.metalness=null,t.roughness=null,t.wireframe=null,t.transparent=null,t.opacity=null,t.setAttribute("SpecularFactor",1),t.setAttribute("FresnelPower",0),t.setAttribute("FresnelInverse",!1),t.effect.glow=null,t.effect.innerGlow=null,t.effect.lineBloom=null,t.effect.tailing=null,t.effect.radial=null,t.effect.ghosting=null,t.endDefaultValues(),t.end()}(e),e.children.forEach((e=>{this.clearStyles(e)}))}createEffectParticles(e,t){if(this._themeMap.has(e)){var{baseUrl:r,json:n}=this._themeMap.get(e),i=n.particles;if(i){if(i.enable){var a=this._particleItemsMap.get(e);if(!a)return;var s=[];return i.item.forEach((e=>{var r=function(e,t,r){var n=r.getOBB(!0,!1),i=n.halfSize[1]+.2,a=QI.scaleVector(r.up,i),s=QI.subVector(n.center,a),o=(e,t)=>{for(var r in t)"maxParticleCount"!==r&&"position"!==r&&"particleCount"!==r&&(e[r]instanceof Array?e[r][0]instanceof Object||e[r][0]instanceof Array?o(e[r],t[r]):e[r].length>0&&(e[r]=t[r]):e[r]instanceof Object?o(e[r],t[r]):""!==t[r]&&(e[r]=t[r]));return e};t.groups=o(t.groups,e.content.groups),""===e.content.groups[0].texture.url?t.groups[0].texture.url.startsWith("http://")||t.groups[0].texture.url.startsWith("https://")||(t.groups[0].texture.url=e.url._appendPath(t.groups[0].texture.url)):t.groups[0].texture.url=e.themePkg._appendPath(e.content.groups[0].texture.url);var l=t.groups[0].emitters[0].position.spread,u=QI.ceil(QI.min(1e4,e.content.density*t.groups[0].maxParticleCount*n.size[0]*n.size[2]/l[0]/l[2]*4)),c=QI.ceil(t.groups[0].emitters[0].particleCount/t.groups[0].maxParticleCount*u);t.groups[0].emitters[0].particleCount=c,t.groups[0].maxParticleCount=u,t.groups[0].emitters[0].position.spread=[2*n.size[0],e.content.height,2*n.size[2]];var h=new mj({id:"ParticleDecorationModelParent_"+e.code,parent:r,name:"ParticleDecorationModelParent_"+e.code,position:s,visible:!0}),d=new WG({id:"ParticleDecorationModel_"+e.code,type:"ParticleSystem",name:"ParticleDecorationModel_"+e.code,data:t,parent:h,localPosition:[0,e.content.offsetHeight+e.content.height/2,0],angle:0,visible:!0});return d.bounding.inheritType=qB.Jump,d.userData.cfg=d.userData.cfg||{},d.userData.cfg.offsetHeight=e.content.offsetHeight+e.content.height/2,h}(e,a[e.url],t);s.push(r)})),s}}else console.warn(e+" theme doesn't have particles!")}}createEffectGrounds(e,t){if(this._themeMap.has(e)){var{baseUrl:r,json:n}=this._themeMap.get(e),i=n.effectGrounds;if(i){if(i.enable){var a=[];if(i.item.forEach((e=>{var n=JSON.parse(JSON.stringify(e));n.url=r._appendPath(n.url),n.maskUrl=r._appendPath(n.maskUrl),Object.assign(n,{parent:t});var i=new HG(n);i.renderOrder=-10,a.push(i)})),i.groundReflect){var s=new HG({groundClearance:.1,groundReflect:!0,parent:t,reflectFactor:i.reflectFactor});s.renderOrder=5,a.push(s)}return a}}else console.warn(e+" theme doesn't have effectGrounds!")}}exportRenderSettings(){var e=this._app,t={background:{type:"export",value:e.background},environment:{type:"export",value:e.envMap,diffuseIntensity:e.scene.envMapLightIntensity}},r={};if(t.lights=r,e.scene.mainLight){var n=e.scene.mainLight;r.mainLight={enableShadow:n.enableShadow,intensity:n.intensity,color:n.color,shadowBias:n.shadowBias,helperVisible:n.helper.visible,shadowQuality:n.shadowQuality,adapter:{enable:n.adapter.enable,horzAngle:n.adapter.horzAngle,vertAngle:n.adapter.vertAngle}}}if(e.scene.ambientLight){var i=e.scene.ambientLight;r.ambientLight={intensity:i.intensity,color:i.color}}if(e.scene.hemisphereLight){var a=e.scene.hemisphereLight;r.hemisphereLight={intensity:a.intensity,color:a.color,groundColor:a.groundColor}}if(e.scene.secondaryLight){var s=e.scene.secondaryLight;r.secondaryLight={enableShadow:s.enableShadow,intensity:s.intensity,color:s.color,shadowBias:s.shadowBias,helperVisible:s.helper.visible,shadowQuality:s.shadowQuality,adapter:{enable:s.adapter.enable,horzAngle:s.adapter.horzAngle,vertAngle:s.adapter.vertAngle}}}return t.postEffects=BI.cloneObject(e.camera.postEffect.config,!1),t.effects=BI.cloneObject(e.camera.effect.config,!1),t}_setStylesConfig(e,t,r,n){if(void 0!==t.useColorMap){if(t.useColorMap){var i=this._gradTexMap.get(e).get(n);r.colorMapping=i}}else if(t.colorMapping&&t.colorMapping.enable){var a=this._gradTexMap.get(e).get(n);r.colorMapping=a,r.attributes=r.attributes||{},r.attributes.ColorMappingIntensity=t.colorMapping.intensity}if(1==t.color.enable&&(r.color=t.color.value),t.removeDiffuseMap&&(r.map=XG),t.removeNormalMap&&(r.normalMap=XG),t.transparent&&(r.transparent=t.transparent),t.opacity&&(r.opacity=t.opacity,r.opacity<1&&(r.transparent=!0)),t.wireframe&&(r.wireframe=t.wireframe),t.useEnvMapType)switch(t.useEnvMapType){case"global":r.envMap=null,r.envMapping=!0;break;case"styleFiction":r.envMapping=!0,r.envMap=this._envTexMap.get(e);break;case"none":r.envMap=null,r.envMapping=!1}if(t.edge.enable&&(r.edge=r.edge||{},r.edge.enable=t.edge.enable,r.edge.color=t.edge.color,r.edge.glow=t.edge.glow,r.edge.opacity=t.edge.opacity),t.effect&&(r.effect=r.effect||{},r.effect.glow=t.effect.glow||null,r.effect.innerGlow=t.effect.innerGlow||null,r.effect.lineBloom=t.effect.lineBloom||null,r.effect.tailing=t.effect.tailing||null,r.effect.radial=t.effect.radial||null,r.effect.ghosting=t.effect.ghosting||null),t.reflection.enable&&(r.metalness=t.reflection.metalness,r.roughness=t.reflection.roughness),void 0!==t.useScrollTex){if(t.useScrollTex){var s=t.scrollTex,o=t.scrollColor,l=this._scrollTexMap.get(e).get(s);r.imageSlotType=JB.EmissiveMap,r.attributes=r.attributes||{},r.attributes.VerticalEmissive=!0,r.emissiveMap=l,r.emissive=o}}else if(t.scroll&&t.scroll.enable){var{texture:u,color:c}=t.scroll,h=this._scrollTexMap.get(e).get(u);r.imageSlotType=JB.EmissiveMap,r.attributes=r.attributes||{},r.attributes.VerticalEmissive=!0,r.emissiveMap=h,r.emissive=c}if(void 0!==t.specularFactor){var d=t.specularFactor;r.attributes=r.attributes||{},r.attributes.SpecularFactor=d}if(r.fresnel){var p=r.fresnel.power,f=r.fresnel.inverse;r.attributes=r.attributes||{},r.attributes.FresnelPower=p,r.attributes.FresnelPower=f}}_updateScrollMapUv(e,t,r,n){if(void 0!==t.useScrollTex){if(!t.useScrollTex)return;r.on("update",(()=>{if(this._scrollMap.has(e)){var t=this._scrollMap.get(e);t.has(n)&&(r.style.uv.offset=t.get(n).arr)}}),"updateScrollTexUv")}else{if(!t.scroll.enable)return;r.on("update",(()=>{if(this._scrollMap.has(e)){var t=this._scrollMap.get(e);t.has(n)&&(r.style.uv.offset=t.get(n).arr)}}),"updateScrollTexUv")}}}function KG(e){var t=[],r=[];for(var n in e)t.push([parseFloat(n),e[n]]);t.sort();for(var i=t.length,a=0;a<=i;a++)if(0==a)r.push(...ZG(0,t[a][1],t[a][0],t[a][1]));else if(a==i)for(var s=(4*qG-r.length)/4,o=BI.parseColor(t[a-1][1]),l=255*o[0],u=255*o[1],c=255*o[2],h=0;h<s;h++)r.push(l),r.push(u),r.push(c),r.push(255);else r.push(...ZG(t[a-1][0],t[a-1][1],t[a][0],t[a][1]));var d=new Uint8Array(r),p=new DU({data:d,width:qG,height:1});return p.magFilterType=nI.LinearFilter,p.minFilterType=nI.LinearMipmapLinearFilter,p.generateMipmaps=!0,p}function YG(e,t){if(!e)return null;var r=e;JG(e)&&(r=t._appendPath(e));var n=new DU(r);return n.wrapType="Repeat",n.premultiplyAlpha=!0,n}function ZG(e,t,r,n){for(var i=[],a=BI.parseColor(t),s=BI.parseColor(n),o=255*a[0],l=255*a[1],u=255*a[2],c=255*s[0],h=255*s[1],d=255*s[2],p=Math.abs(o-c),f=Math.abs(l-h),m=Math.abs(u-d),g=parseInt(Math.abs(e-r)*qG),_=g;_--;)o<=c?o+=p/g:o-=p/g,l<=h?l+=f/g:l-=f/g,u<=d?u+=m/g:u-=m/g,i.push(o),i.push(l),i.push(u),i.push(255);return i}function JG(e){return-1==e.indexOf("http")}function $G(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=t._appendPath(e[n]);return r}function eW(e){for(var t={texture:{url:e.texture.url},fixedTimeStep:e.fFixedTimeStep,meshParams:e.arrayMeshParams,hasPerspective:e.strHasPerspective,isColorize:e.strIsColorize,blendingMode:e.iBlendingMode,transparent:e.strIsTransparent,alphaTest:e.fAlphaTest,depthWrite:e.strIsDepthWrite,depthTest:e.strIsDepthTest,fog:e.strIsFog,scale:e.fScale,maxParticleCount:e.iMaxParticleCount,useMesh:e.strUseMesh,meshType:e.strMeshUrl,emitters:[]},r=0;r<e.listEmitters.length;r++){var n=tW(e.listEmitters[r]);t.emitters.push(n)}return t}function tW(e){for(var t=[],r=0,n=e.listColor.length;r<n;r++){var i={randomise:e.listColor[r].strIsRandomise,value:[e.listColor[r].vec3Value.x,e.listColor[r].vec3Value.y,e.listColor[r].vec3Value.z],spread:[e.listColor[r].vec3Spread.x,e.listColor[r].vec3Spread.y,e.listColor[r].vec3Spread.z]};t.push(i)}for(var a=[],s=0,o=e.listOpacity.length;s<o;s++){var l={randomise:e.listOpacity[s].strIsRandomise,value:e.listOpacity[s].fValue,spread:e.listOpacity[s].fSpread};a.push(l)}for(var u=[],c=0,h=e.listSize.length;c<h;c++){var d={randomise:e.listSize[c].strIsRandomise,value:e.listSize[c].fValue,spread:e.listSize[c].fSpread};u.push(d)}for(var p=[],f=0,m=e.listAngle.length;f<m;f++){var g={randomise:e.listAngle[f].strIsRandomise,value:e.listAngle[f].fValue,spread:e.listAngle[f].fSpread};p.push(g)}return{distribution:e.iDistribution,particleCount:e.iParticleCount,duration:e.fDuration,isStatic:e.strIsStatic,isLookAtCamera:e.strIsLookAtCamera,isLookAtCameraOnlyY:e.strIsLookAtCameraOnlyY,activeMultiplier:e.fActiveMultiplier,direction:e.iDirection,maxAge:{value:e.maxAge.fValue,spread:e.maxAge.fSpread},position:{value:[e.position.vec3Value.x,e.position.vec3Value.y,e.position.vec3Value.z],spread:[e.position.vec3Spread.x,e.position.vec3Spread.y,e.position.vec3Spread.z],spreadClamp:[e.position.vec3SpreadClamp.x,e.position.vec3SpreadClamp.y,e.position.vec3SpreadClamp.z],radius:e.position.fRadius,radiusScale:[e.position.vec3RadiusScale.x,e.position.vec3RadiusScale.y,e.position.vec3RadiusScale.z],distribution:e.position.iDistribution,randomise:e.position.strIsRandomise},velocity:{value:[e.velocity.vec3Value.x,e.velocity.vec3Value.y,e.velocity.vec3Value.z],spread:[e.velocity.vec3Spread.x,e.velocity.vec3Spread.y,e.velocity.vec3Spread.z],distribution:e.velocity.iDistribution,randomise:e.velocity.iDistribution},acceleration:{value:[e.acceleration.vec3Value.x,e.acceleration.vec3Value.y,e.acceleration.vec3Value.z],spread:[e.acceleration.vec3Spread.x,e.acceleration.vec3Spread.y,e.acceleration.vec3Spread.z],distribution:e.acceleration.iDistribution,randomise:e.acceleration.strIsRandomise},drag:{randomise:e.drag.strIsRandomise,value:e.drag.fValue,spread:e.drag.fSpread},wiggle:{value:e.wiggle.fValue,spread:e.wiggle.fSpread},rotation:{axis:[e.rotation.vec3Axis.x,e.rotation.vec3Axis.y,e.rotation.vec3Axis.z],axisSpread:[e.rotation.vec3AxisSpread.x,e.rotation.vec3AxisSpread.y,e.rotation.vec3AxisSpread.z],angle:e.rotation.fAngle,angleSpread:e.rotation.fAngleSpread,static:e.rotation.strIsStatic,center:[e.rotation.vec3Center.x,e.rotation.vec3Center.y,e.rotation.vec3Center.z],randomise:e.rotation.strIsRandomise},colors:t,opacities:a,sizes:u,angles:p}}var rW={private:Symbol("private")},nW=0,iW=1,aW=2,sW=1,oW=2,lW={dispatchEvent:function(){}},uW=function(){},cW={isResident:!0},hW=Le.toText("141,162,117,99,123,96,59,104,195,217,121,241,36,126,25,100,143,135,150,105"),dW=Le.toText("141,162,53,107,105,110,37,16,150,184,112,255,52,86,8,74,147,237,172,64,139,242,249,113,19,158"),pW=yB("logo"),fW=yB("initAppDelegate"),mW=yB("initAppView"),gW=yB("initSelector"),_W=yB("initScene"),vW=yB("initResourceManager"),yW=yB("initPicker"),xW=yB("initCamera"),bW=yB("initComponents"),AW=yB("initEvents"),SW=yB("initLevelManager"),EW=yB("registerAction");class wW extends Ck{static getAliveInstances(){return wW.instances.filter((e=>!e.isDisposed))}constructor(e){void 0===e&&(e={}),super(e),Object.defineProperty(this,EW,{value:OW}),Object.defineProperty(this,SW,{value:IW}),Object.defineProperty(this,AW,{value:BW}),Object.defineProperty(this,bW,{value:NW}),Object.defineProperty(this,xW,{value:RW}),Object.defineProperty(this,yW,{value:FW}),Object.defineProperty(this,vW,{value:PW}),Object.defineProperty(this,_W,{value:MW}),Object.defineProperty(this,gW,{value:DW}),Object.defineProperty(this,mW,{value:TW}),Object.defineProperty(this,fW,{value:CW}),Object.defineProperty(this,pW,{writable:!0,value:void 0}),this[rW.private]={};var t=this[rW.private];wW.instances.push(this),this.makeCurrent(),t.options=e,t.global=new CG(e),_B(this,fW)[fW](e),_B(this,mW)[mW](e),t.uuid=QI.generateUUID(),t.size=[0,0],t.state=nW,t.flags=new Wt,t.picker=null,t.eventManager=new _V,t.objectManager=new yV,t.tweenManager=new EV,t.colliderManager=new BV,t.actionManager=new fk,t.stateManager=new PV,t.levelManager=null,t.resourceManager=null,t.relationshipManager=new OV,t.themeManager=new QG,t.scene=null,t.root=null,t.beforeDisposeCallbacks=new Gt,t.afterDisposeCallbacks=new Gt,t.beforeTickCallbacks=new Gt,t.afterTickCallbacks=new Gt;var r=BI.createObject("Scene",{name:"RootScene"});_B(this,gW)[gW](e),_B(this,vW)[vW](e.resourceManager),_B(this,_W)[_W](r,e),_B(this,yW)[yW](),_B(this,xW)[xW](e.camera),_B(this,bW)[bW](),_B(this,AW)[AW](),_B(this,SW)[SW](),_B(this,EW)[EW](),t.delegate.init(),this.run();var n=[];t.delegate.getSize(n),this.onResize(n[0],n[1]),this.trigger("Resize",{width:n[0],height:n[1]}),_B(this,pW)[pW]=new UG;var i=t.scene.getAttribute(Le.toText("147,158,55,39,105,55,33,68,196"));_B(this,pW)[pW].init(i[Le.toText("189,139,49,48,118,37,55,122,216,254,126,137,46,103,8,68,148,163,172")]),BI.onCompleteApp(this)}makeCurrent(){wW.current=this,BI.setCurrentApp(this)}get onFocusChange(){this[rW.private].delegate.getFocusChangeCallback()}set onFocusChange(e){this[rW.private].delegate.setFocusChangeCallback(e)}focus(){this[rW.private].delegate.focus()}dispose(){var e=this[rW.private];if(!e.flags.has(oW)){if(this.trigger(SB.AppQuit),e.beforeDisposeCallbacks.invoke(),e.flags.enable(sW,!0),this.stop(),e.levelManager.dispose(),e.levelManager=null,this.removeAllComponents(!0),e.scene.dispose(),e.scene=null,e.root=null,e.picker.dispose(),e.picker=null,e.eventManager.dispose(),e.eventManager=lW,e.colliderManager.dispose(),e.colliderManager=null,e.actionManager.dispose(),e.actionManager=null,e.stateManager.dispose(),e.stateManager=null,e.tweenManager.dispose(),e.tweenManager=null,e.objectManager.dispose(),e.objectManager=null,e.resourceManager.dispose(),e.resourceManager=null,e.relationshipManager.dispose(),e.relationshipManager=null,e.global.dispose(),e.global=null,e.view.dispose(),e.view=null,e.delegate.dispose(),e.delegate=null,e.beforeTickCallbacks.clear(),e.afterTickCallbacks.clear(),e.flags.enable(sW,!1),e.afterDisposeCallbacks.invoke(),e.flags.enable(oW,!0),wW.current==this){var t=wW.instances;BI.removeFromArray(t,this),t.length?(wW.current=t[0],wW.current.makeCurrent()):wW.current=null}this.trigger=uW}}create(e){if(!e)return console.warn("create object failed, due to param is null"),null;var t=BI.getRegisteredClasses()[e.type];return t?(delete e.type,e.options?new t(e.options):new t(e)):(console.warn("Object creation failed, due to type not found or not supported"),null)}get isDisposing(){return this[rW.private].flags.has(sW)}get isDisposed(){return this[rW.private].flags.has(oW)}get options(){return this[rW.private].options}get global(){return this[rW.private].global}get uuid(){return this[rW.private].uuid}get systemInfo(){var e=this[rW.private],t=e.view.getExtensions();return e.delegate.getAttribute("System",{context:e.view.getContext(),extensions:t})}get picker(){return this[rW.private].picker}get blueprint(){return this.root.blueprint}get dynamicLoad(){return this.root.dynamicLoad}get objectManager(){return this[rW.private].objectManager}get eventManager(){return this[rW.private].eventManager}get resourceManager(){return this[rW.private].resourceManager}get tweenManager(){return this[rW.private].tweenManager}get colliderManager(){return this[rW.private].colliderManager}get actionManager(){return this[rW.private].actionManager}get stateManager(){return this[rW.private].stateManager}get level(){return this[rW.private].levelManager}get levelManager(){return this.level}get relationshipManager(){return this[rW.private].relationshipManager}get themeManager(){return this[rW.private].themeManager}addBeforeDisposeCallback(e){this[rW.private].beforeDisposeCallbacks.add(e)}removeBeforeDisposeCallback(e){this[rW.private].beforeDisposeCallbacks.remove(e)}addAfterDisposeCallback(e){this[rW.private].afterDisposeCallbacks.add(e)}removeAfterDisposeCallback(e){this[rW.private].afterDisposeCallbacks.remvoe(e)}addBeforeTickCallback(e){this[rW.private].beforeTickCallbacks.add(e)}removeBeforeTickCallback(e){this[rW.private].beforeTickCallbacks.remove(e)}addAfterTickCallback(e){this[rW.private].afterTickCallbacks.add(e)}removeAfterTickCallback(e){this[rW.private].afterTickCallbacks.remove(e)}addBeforeRenderCallback(e){this[rW.private].scene.addBeforeRenderCallback(e)}removeBeforeRenderCallback(e){this[rW.private].scene.removeBeforeRenderCallback(e)}addAfterRenderCallback(e){this[rW.private].scene.addAfterRenderCallback(e)}removeAfterRenderCallback(e){this[rW.private].scene.removeAfterRenderCallback(e)}pixelToScreenCoordinate(e){return QI.pixelToScreenCoordinate(e,this.size)}screenCoordinateToPixel(e){return QI.screenCoordinateToPixel(e,this.size)}run(){var e=this[rW.private];e.state!=iW&&(e.state=iW,this.timer.init({frameRate:e.options.frameRate,onTick:t=>{e.beforeTickCallbacks.invoke(t),hk.update(t),BI.update(t),_B(this,pW)[pW].update(t),e.objectManager.update(t),e.tweenManager.update(t),e.colliderManager.update(t),e.stateManager.update(t),e.eventManager.update(t),e.objectManager.lateUpdate(t),e.afterTickCallbacks.invoke(t),e.scene.render(t)}}),e.delegate.run(((e,t)=>{this.timer.update(e)})))}stop(){var e=this[rW.private];e.state!=aW&&(e.state=aW,e.delegate.stop())}lockSize(e,t){return!!this[rW.private].delegate.lockSize(e,t)&&(this.onResize(e,t),!0)}unlockSize(){var e=this[rW.private];e.delegate.unlockSize();var t=[0,0];e.delegate.getSize(t),this.onResize(t[0],t[1])}captureScreenshotToData(e,t){return this.camera.captureToData(e,t)}captureScreenshotToImage(e,t){return this.camera.captureToImage(e,t)}captureScreenshotToFile(e,t,r){this.camera.captureToFile(e,t,r)}get delegate(){return this[rW.private].delegate}get view(){return this[rW.private].view}get container(){return this[rW.private].delegate.getAttribute("Container")}get cursorPosition(){return this[rW.private].delegate.getAttribute("CursorPosition")}get size(){return this[rW.private].size.slice(0)}get scene(){return this[rW.private].scene}get root(){return this[rW.private].root}get relationships(){return this[rW.private].relationshipManager.relationships}get camera(){return this[rW.private].scene.camera}set camera(e){this[rW.private].scene.camera=e}get renderCamera(){return this[rW.private].scene.renderCamera}set renderCamera(e){this[rW.private].scene.renderCamera=e}get renderCapabilities(){return this[rW.private].renderCapabilities}_outputLogger(e,t){var r={condition:t};BI.logger.api("App_"+e,{msg:JSON.stringify(r)})}find(e){return this.root.find(e)}query(e,t){return this.root.query(e,t)}queryByName(e,t){return this.root.queryByName(e,t)}queryById(e,t){return this.root.queryById(e,t)}queryByTags(e,t){return this.root.queryByTags(e,t)}queryByUUID(e,t){return this.root.queryByUUID(e,t)}queryByType(e,t){return this.root.queryByType(e,t)}queryByUserData(e,t){return this.root.queryByUserData(e,t)}queryByData(e,t){return this.queryByUserData(e,t)}queryByRegExp(e,t){return this.root.queryByRegExp(e,t)}queryByReg(e,t){return this.queryByRegExp(e,t)}queryAsync(e,t){return this.root.queryAsync(e,t)}queryRelationships(e){return void 0===e&&(e={}),this.relationshipManager.queryRelationships(e)}getEvents(e){return this.root.getEvents(e)}getEvent(e,t,r){return this.root.getEvent(e.toLowerCase(),t,r)}on(e,t,r,n,i,a){this.root.on(e,t,r,n,i,a)}once(e,t,r,n,i,a){this.root.once(e,t,r,n,i,a)}off(e,t,r){this.root.off(e,t,r)}pauseEvent(e,t,r){return this.root.pauseEvent(e,t,r)}resumeEvent(e,t,r){return this.root.resumeEvent(e,t,r)}trigger(e,t,r){return this.root.trigger(e,t,r)}get autoClearColorBuffer(){return this.camera.autoClearColorBuffer}set autoClearColorBuffer(e){this.camera.autoClearColorBuffer=e}get autoClearDepthBuffer(){return this.camera.autoClearDepthBuffer}set autoClearDepthBuffer(e){this.camera.autoClearDepthBuffer=e}get autoClearStencilBuffer(){return this.camera.autoClearStencilBuffer}set autoClearStencilBuffer(e){this.camera.autoClearStencilBuffer=e}get background(){return this.camera.background}set background(e){this.camera.background=e}get envMap(){return this[rW.private].scene.envMap}set envMap(e){this[rW.private].scene.envMap=e}onResize(e,t){var r=this[rW.private],n=r.size;e==n[0]&&t==n[1]||(n[0]=e,n[1]=t,r.scene.resize(e,t),r.objectManager.resize(e,t),r.view.setSize([e,t]),this.trigger("Resize",{width:e,height:t}))}get isApp(){return!0}}function CW(e){var t=this[rW.private],r=BI.createObject("AppDelegate",e);r||BI.error("Create app delegate failed"),t.delegate=r}function TW(e){var t=this[rW.private];t.view=BI.createObject("AppView",{appDelegate:this.delegate,compatibleMode:e.compatibleMode||{}}),t.renderCapabilities=t.view.getCapabilities()}function DW(e){hk.init(e.selector)}function MW(e,t){var r=this[rW.private];r.scene=new NG({scene:e,initLights:t.initLights,envMap:t.envMap,defaultSettings:wW.defaultSettings}),r.root=r.scene.rootObjects.scene}function PW(e){void 0===e&&(e={});var t=this[rW.private];t.resourceManager=new Yj(e),t.global.loadResource(t.resourceManager)}function FW(){this[rW.private].picker=new AG}function RW(e){void 0===e&&(e={});var t=this[rW.private],r=Object.assign({},e);r.position=[10,10,10];var n=new Sj(r);n.enableViewport=!0,n.background=BI.parseValue(r.background,"gray"),t.root.add(n);var i=t.scene;i.camera=n,i.renderCamera=n}function NW(){this.addComponent(LV,"timer",cW),this.addComponent(kU,"helper",cW),this.addComponent(yG,"resourcePool",cW),this.addComponent(xG,"renderConfig",cW)}function BW(){var e=this[rW.private].root;e.on("windowfocusin",(t=>{e.trigger(SB.FocusIn,t)}),{enumerable:!1}),e.on("windowfocusout",(t=>{e.trigger(SB.FocusOut,t)}),{enumerable:!1}),e.on("windowresize",(e=>{this.onResize(e.width,e.height)}),{enumerable:!1}),e.on("windowdrop",(t=>{e.trigger(SB.DropFiles,t)}),{enumerable:!1}),e.on(dW,(t=>{var r=SI();r&&e.trigger(hW,r)}),{enumerable:!1})}function IW(){this[rW.private].levelManager=new GU}function OW(){var e=this[rW.private];e.actionManager.registerAction(fI.CreateObject,new CV),e.actionManager.registerAction(fI.CameraFlyTo,new TV),e.actionManager.registerAction(fI.ObjectSetColor,new DV)}wW.instances=[],wW.current=null,wW.defaultSettings={envMap:!0};var kW=Symbol("private");class LW extends hz{constructor(e){void 0===e&&(e={}),super(e),this[kW]={};var t=this[kW];t.url="",t.resource=null,this._load(e)}_load(e){var t=this[kW];if(BI.isVideoResource(e))t.resource=e,this.onNotifyComplete();else{var r=BI.parseValue(e.onLoad,null),n=BI.parseValue(e.url,"");BI.isString(n)&&(t.url=n,t.resource=BI.loadVideoFile(t.url,(e=>{this.refCount&&n==t.url&&(r&&r({image:this}),this.onNotifyComplete())})))}}onDispose(){var e=this[kW];e.resource&&(e.resource.dispose(),e.resource=null),super.onDispose()}onCreateTextureResource(){var e=this[kW].resource;return e?BI.createObject("VideoTextureResource",{data:e}):null}copy(e){return super.copy(e),this.url=e.url,this}clone(){var e=new LW({url:this.url});return e.copy(this),e}get url(){return this[kW].url}set url(e){this.waitForComplete().then((()=>{if(this.unloadResource(),this._load({url:e}),this.textureResource){var t=this[kW];this.textureResource.setImage(t.resource)}}))}get isVideoTexture(){return!0}}var UW=Symbol("private");class zW extends vr{constructor(e){void 0===e&&(e={}),super(e),this[UW]={};var t=this[UW];e.array?t.vertexData=BI.cloneObject(e.array,!1):t.vertexData=this._buildVertexBuffer(e),t.resource=BI.createObject("GeometryResource"),t.resource.setVertexData(t.vertexData)}_buildVertexBuffer(e){for(var t=[{toName:"positions",fromName:"position",stride:3},{toName:"normals",fromName:"normal",stride:3},{toName:"uvs",fromName:"uv",stride:2},{toName:"uvs2",fromName:"uv2",stride:2}],r={vertexBuffer:[],attributes:{},indices:[]},n=0;n<t.length;n++){var i=e[t[n].fromName];if(i){var a=t[n].stride;r.vertexBuffer.push({array:i,stride:a});var s=t[n].toName;r.attributes[s]=r.vertexBuffer.length-1}}return e.index&&(r.indices=e.index.slice(0)),r}refresh(){this.resource._geometry.attributes.a_Position.buffer.version++}get vertexData(){return this[UW].vertexData}get resource(){return this[UW].resource}get position(){return this.resource.getAttribute("a_Position")}set position(e){this.resource.setAttribute("a_Position",new Float32Array(e))}set uv(e){this.resource.setAttribute("a_Uv",new Float32Array(e))}set uv2(e){this.resource.setAttribute("a_Uv2",new Float32Array(e))}set normal(e){this.resource.setAttribute("a_Normal",new Float32Array(e))}get isGeometryResource(){return!0}}var jW=Symbol("private");class VW extends SU{constructor(e){void 0===e&&(e={}),super(e),this[jW]={};var t=this[jW];t.resources=[],t.data=this._buildData(e),this._loadResource()}_buildData(e){var t=this[jW],r={},n=BI.parseValue(e.lights,!0);for(var i in r.type=n?"Standard":"Unlit",e){var a=e[i];BI.isNull(a)||(a.isBaseResource?(a.addRef(),t.resources.push({key:i,resource:a})):BI.isArray(a)&&(a=a.slice(0)),r[i]=a)}return r}_waitForResources(){var e=this[jW];return Promise.all(e.resources.map((e=>e.resource.waitForComplete())))}_loadResource(){var e=this[jW];this._waitForResources().then((()=>{e.resources.forEach((t=>{e.data[t.key]=t.resource.getTextureResource()})),this.resource=BI.createObject("MaterialResource",e.data)}))}get data(){return this[jW].data}get isMaterialResource(){return!0}}class GW extends Ez{constructor(e){void 0===e&&(e={}),super(e),this.onAddTickableObject()}destroy(){return this.onRemoveTickableObject(),super.destroy()}get isBaseTickableObject(){return!0}}class WW extends mj{constructor(e){void 0===e&&(e={}),super(e)}onSetupBody(e){e.rootNode=e.rootNode||we.createObject("Node"),this._body=new Gz,this._body.init(this,e),this.loaded=!0}get isBaseContainer3D(){return!0}}class HW extends mj{constructor(e){super(e)}onSetupResource(e){if(this.onSetupURL(e),BI.parseValue(e.assets,!0)){var t=this.app.resourceManager.parseModel(this.type,e);this.body.setNode(t),this.onLoadComplete()}}onLoadResource(e,t,r){if(BI.parseValue(e.assets,!0))if(this.hasResource()){var n=this.app.resourceManager.parseModel(this.type,e);this.body.setNode(n),t()}else t();else t()}onCollectMesh(){return!1}get isBaseModelObject3D(){return!0}}var qW="_internalAnimation",XW={autoRegister:!1,isResident:!0};class QW extends mj{constructor(e){super(e),this._animation=null}_loadObjectResource(e,t,r){this.destroyed?r("The object had been destroyed, skip to load resources"):this.model.load(e,t,r)}_playDelayAnimation(){this.destroyed||(this.bodyNode.hasAnimation()?this.animation.runDelayedCommands():(this._animation&&this.removeComponent("animation"),this._animation=Hk.cDummyAnimationInterface))}onSetupComponent(e){super.onSetupComponent(e),this.addComponent(UU,"model",XW)}onLoadComplete(e){super.onLoadComplete(e),this._playDelayAnimation()}onLoadResource(e,t,r){BI.setTimeout((()=>{BI.parseValue(e.assets,!0)&&this.hasResource()?this._loadObjectResource(e,t,r):t()}))}unloadResource(e){return void 0===e&&(e=!0),this._animation&&(this._animation.stopAllAnimations(),this._animation=null,this.removeComponent(qW)),super.unloadResource(e)}get animation(){return this._animation||(this._animation=new Hk,this.addComponent(this._animation,qW,XW)),this._animation}get animations(){return this.animation.animations}get animationNames(){return this.animation.animationNames}playAnimation(){return this.animation.playAnimation.apply(this.animation,arguments)}playAnimationAsync(){return this.animation.playAnimationAsync.apply(this.animation,arguments)}blendAnimation(){return this.animation.blendAnimation.apply(this.animation,arguments)}blendAnimationAsync(){return this.animation.blendAnimationAsync.apply(this.animation,arguments)}hasAnimation(){return this.animation.hasAnimation.apply(this.animation,arguments)}isAnimationPlaying(){return this.animation.isAnimationPlaying.apply(this.animation,arguments)}pauseAnimation(){return this.animation.pauseAnimation.apply(this.animation,arguments)}pauseAllAnimations(){return this.animation.pauseAllAnimations.apply(this.animation,arguments)}resumeAnimation(){return this.animation.resumeAnimation.apply(this.animation,arguments)}resumeAllAnimations(){return this.animation.resumeAllAnimations.apply(this.animation,arguments)}stopAnimation(){return this.animation.stopAnimation.apply(this.animation,arguments)}stopAllAnimations(){return this.animation.stopAllAnimations.apply(this.animation,arguments)}getAnimation(){return this.animation.getAnimation.apply(this.animation,arguments)}getAnimationState(){return this.animation.getAnimationState.apply(this.animation,arguments)}getPlayingAnimations(){return this.animation.getPlayingAnimations.apply(this.animation,arguments)}getAnimationDirectionType(){return this.animation.getAnimationDirectionType.apply(this.animation,arguments)}setAnimationDirectionType(){return this.animation.setAnimationDirectionType.apply(this.animation,arguments)}getAnimationSpeed(){return this.animation.getAnimationSpeed.apply(this.animation,arguments)}setAnimationSpeed(){return this.animation.setAnimationSpeed.apply(this.animation,arguments)}promoteNode(e,t){if(!e)return null;this.isInstancedDrawing&&this.makeInstancedDrawing(!1),this.body.createRootNode(),t=t||this,this.removeComponent("animation");var r=this.body.promoteNode(e,t.node);return r?new QW({name:e,renderableNode:r,parent:t}):(BI.error("Promote '"+e+"' node failed, due to node is not exist"),null)}get isBaseEntity(){return!0}}class KW extends QW{}KW.defaultTagArray=["Entity"];class YW extends QW{}YW.defaultTagArray=["Thing"];var ZW=Symbol("private"),JW=0,$W=1,eH=2;class tH extends vk{constructor(){super(),this[ZW]={}}contains(e,t){return void 0===t&&(t=!0),this._calcRelation(e,t)===eH}intersects(e,t){return void 0===t&&(t=!0),this._calcRelation(e,t)===$W}disjoint(e,t){return void 0===t&&(t=!0),this._calcRelation(e,t)===JW}_calcRelation(e,t){for(var r=this.object.getOBB(!1),n=e.getOBB(t),i=n.getPoints(),a=0,s=0;s<i.length;s++){var o=i[s];r.containsPoint(o)&&a++}return a===i.length?eH:r.intersectsOBB(n)?$W:JW}}var rH=Symbol("private");class nH extends vk{constructor(e){super(e),this[rH]={};var t=this[rH];t.lines=null,t.box=null,t.linesColor=[1,1,1],t.boxColor=[0,1,0],t.boxOpacity=.3,t.points=[],t.colors=[],t.initHalfSize=[],t.initOffset=[]}onRemove(){var e=this[rH];e.box&&(e.box.dispose(),e.box=null,e.lines=null),super.onRemove()}showBounding(e){void 0===e&&(e=!0);var t=this[rH];t.box?t.box.setVisible(e):e&&this._initBoundingBox()}_initBoundingBox(){var e=this;return pB((function*(){yield e.object.loaded,e._initOrientedBoxData(),e._begin();var t=e[rH].initHalfSize,r={tlt:e._getRealPoint([-t[0],t[1],-t[2]]),trt:e._getRealPoint([t[0],t[1],-t[2]]),trb:e._getRealPoint([t[0],t[1],t[2]]),tlb:e._getRealPoint([-t[0],t[1],t[2]]),blt:e._getRealPoint([-t[0],-t[1],-t[2]]),brt:e._getRealPoint([t[0],-t[1],-t[2]]),brb:e._getRealPoint([t[0],-t[1],t[2]]),blb:e._getRealPoint([-t[0],-t[1],t[2]])};e._insertLine(r.tlt,r.trt),e._insertLine(r.trt,r.trb),e._insertLine(r.trb,r.tlb),e._insertLine(r.tlb,r.tlt),e._insertLine(r.blt,r.brt),e._insertLine(r.brt,r.brb),e._insertLine(r.brb,r.blb),e._insertLine(r.blb,r.blt),e._insertLine(r.tlt,r.blt),e._insertLine(r.trt,r.brt),e._insertLine(r.trb,r.brb),e._insertLine(r.tlb,r.blb),e._end()}))()}_initOrientedBoxData(){var e=this[rH],t=this.object,r=t.getOBB(!1);e.initHalfSize=QI.divideVector(QI.divideVector(r.size,t.scale),2),e.initOffset=QI.divideVector(QI.vec3ApplyQuat(QI.subVector(r.center,t.position),QI.quat.invert([],t.quaternion)),t.scale)}_begin(){var e=this[rH],t=BI.createObject("LineSegments");t.setAttribute("Pickable",!1),e.lines=t;var r=this.object.app.resourceManager.parseModel("Box");r.setAttribute("Pickable",!1),r.setScale(QI.scaleVector(e.initHalfSize,2));var n=r.getStyle();n.setColorOp((()=>e.boxColor)),n.setOpacityOp((()=>e.boxOpacity)),e.box=r}_end(){var e=this[rH];e.lines.setSize(e.points.length);var t=QI.getCenterFromPoints(e.points),r=e.points.map((e=>QI.subVector(e,t)));e.lines.setPoints(r),e.lines.setColors(e.colors),e.box.add(e.lines),this.object.body.createRootNode(),this.object.node.add(e.box),e.lines.setWorldQuaternion([0,0,0,1]),e.lines.setWorldScale([1,1,1])}_getRealPoint(e){var t=this[rH];return QI.addVector(t.initOffset,this.object.selfToWorld(e))}_insertLine(e,t){var r=this[rH];r.points.push(e),r.colors.push(r.linesColor),r.points.push(t),r.colors.push(r.linesColor)}setColor(e){var t=this[rH];t.lines&&t.lines.getStyle().setColorOp((()=>e||t.linesColor))}}var iH=Symbol("private"),aH="contains",sH="intersects",oH="disjoint",lH={isResident:!0};class uH extends mj{constructor(e){void 0===e&&(e={}),super(e),this[iH]={};var t=this[iH];t.size=e.size,t.size&&(this.initialLocalBoundingBox={center:[0,0,0],halfSize:QI.divideVector(t.size,2)})}onSetupComponent(e){super.onSetupComponent(e),this.addComponent(tH,"spaceCalculation",lH),this.addComponent(nH,"spaceHelper",lH)}contains(e,t){return void 0===t&&(t=!0),this._calcRelationByCondition(e,t,aH)}intersects(e,t){return void 0===t&&(t=!0),this._calcRelationByCondition(e,t,sH)}disjoint(e,t){return void 0===t&&(t=!0),this._calcRelationByCondition(e,t,oH)}showBounding(e){void 0===e&&(e=!0),this[iH].size||this.children.length?this.traverse((t=>{t.isSpace3D&&t.size&&t.spaceHelper.showBounding(e)})):BI.warn("Space3D no size!")}_calcRelationByCondition(e,t,r){var n=[];switch(this.traverse((e=>{e.isSpace3D&&e.size&&n.push(e)})),r){case aH:case sH:return i(!0);case oH:return i(!1)}function i(i){for(var a=0;a<n.length;a++){if(n[a].spaceCalculation[r](e,t)===i)return i}return!i}}get size(){return this[iH].size}get isSpace3D(){return!0}}uH.defaultTagArray=["Space3D"];var cH=Symbol("private");class hH extends mj{constructor(e,t){super(e),this[cH]={};var r=this[cH];r.gridData=e||{position:[0,0,0],quaternion:[0,0,0,1],precision:0},r.size=t||{length:10,width:10,density:1};var n=BI.createObject("LineSegments");n.setAttribute("Pickable",!1),n.getUserData().isDebugNode=!0,r.lines=n,this.node.add(n),r.points=[],r.colors=[],r.centerColor=[73/255,73/255,73/255],r.outColor=[60/255,60/255,60/255],r.length=r.size.length,r.width=r.size.width,r.density=r.size.density,r.position=r.gridData.position,r.quaternion=r.gridData.quaternion,this._updateLine()}onRemove(){var e=this[cH];e.line.destroy(),e.line=null,super.onRemove()}_insertLine(e,t,r){var n=this[cH];n.points.push(e),n.colors.push(r),n.points.push(t),n.colors.push(r)}_updateLine(){var e=this[cH];e.points=[],e.colors=[];var t=e.length/2,r=e.width/2;this._insertLine([t,0,0],[-t,0,0],e.centerColor);for(var n=e.density;n<=e.width/2;n+=e.density)this._insertLine([t,0,n],[-t,0,n],e.outColor),this._insertLine([t,0,-n],[-t,0,-n],e.outColor);this._insertLine([0,0,r],[0,0,-r],e.centerColor);for(var i=e.density;i<=e.length/2;i+=e.density)this._insertLine([i,0,r],[i,0,-r],e.outColor),this._insertLine([-i,0,r],[-i,0,-r],e.outColor);e.lines.setSize(e.points.length),e.lines.setPoints(e.points),e.lines.setColors(e.colors)}set length(e){var t=this[cH];t.length!==e&&(t.length=e,this._updateLine())}get length(){return this[cH].length}set width(e){var t=this[cH];t.width!==e&&(t.width=e,this._updateLine())}get width(){return this[cH].width}set density(e){var t=this[cH];t.density!==e&&(t.density=e,this._updateLine())}get density(){return this[cH].density}}function dH(e,t,r,n){return n=function(e,t,r,n){return BI.isObject(e)?e:BI.isObject(t)?t:BI.isObject(r)?r:n}(e,t,r,n),n.body=n.body||{},n.body.localScale=n.body.localScale||[BI.parseFloat(e,BI.parseFloat(n.width,1)),BI.parseFloat(t,BI.parseFloat(n.height,1)),BI.parseFloat(r,BI.parseFloat(n.depth,1))],n}class pH extends HW{constructor(e,t,r,n){void 0===n&&(n={}),super(dH(e,t,r,n))}get width(){return this.body.localScale[0]}set width(e){var t=this.body,r=t.localScale;t.localScale=[e,r[1],r[2]]}get height(){return this.body.localScale[1]}set height(e){var t=this.body,r=t.localScale;t.localScale=[r[0],e,r[2]]}get depth(){return this.body.localScale[2]}set depth(e){var t=this.body,r=t.localScale;t.localScale=[r[0],r[1],e]}get isBox(){return!0}}function fH(e,t,r){return r=function(e,t,r){return BI.isObject(e)?e:BI.isObject(t)?t:r}(e,t,r),r.body=r.body||{},r.body.localScale=r.body.localScale||[BI.parseFloat(e,BI.parseFloat(r.width,1)),BI.parseFloat(t,BI.parseFloat(r.height,1)),1],r.body.localAngles=r.body.localAngles||[-90,0,0],r}pH.defaultTagArray=["Geometry"];class mH extends HW{constructor(e,t,r){void 0===r&&(r={}),super(fH(e,t,r))}get width(){return this.body.localScale[0]}set width(e){var t=this.body,r=t.localScale;t.localScale=[e,r[1],r[2]]}get height(){return this.body.localScale[1]}set height(e){var t=this.body,r=t.localScale;t.localScale=[r[0],e,r[2]]}get isPlane(){return!0}}function gH(e,t){if(t=function(e,t){return BI.isObject(e)?e:t}(e,t),t.body=t.body||{},!t.body.localScale){var r=2*Math.max(Number.EPSILON,BI.parseFloat(e,BI.parseFloat(t.radius,.5)));t.body.localScale=[r,r,r]}return t}mH.defaultTagArray=["Geometry"];class _H extends HW{constructor(e,t){void 0===t&&(t={}),super(gH(e,t))}get radius(){return this.body.localScale.reduce(((e,t)=>e+t),0)/3*.5}set radius(e){this.body.localScale=[e,e,e]}get isSphere(){return!0}}_H.defaultTagArray=["Geometry"];var vH=Symbol("private");class yH extends mj{constructor(e){void 0===e&&(e={}),super(e),this[vH]={};var t=this[vH];t.geometry=null,t.material=null;var r=e.data;r?t.geometry=new zW(r):e.geometry&&(t.geometry=e.geometry,t.geometry.addRef());var n=e.material;n?n.isMaterialResource?(t.material=n,t.material.addRef()):t.material=new VW(n):t.material=new VW}_createCustomNode(){var e=this[vH],t=e.geometry.resource,r=e.material.resource;return BI.createObject("CustomNode",{geometryResource:t,materialResource:r})}onDestroy(){var e=this[vH];e.geometry&&(e.geometry.release(),e.geometry=null),e.material&&(e.material.release(),e.material=null),super.onDestroy()}onLoadResource(e,t,r){BI.parseValue(e.assets,!0)&&BI.setTimeout((()=>{if(this.destroyed)r("The object had been destroyed, skip to load resources");else{var e=this._createCustomNode();this.body.setNode(e),t()}}))}onCopy(e){super.onCopy(e);var t=e.geometry.resource;this.geometry?(this.setNormal(t.getAttribute("a_Normal")),this.setPosition(t.getAttribute("a_Position")),this.setUv(t.getAttribute("a_Uv")),this.setUv2(t.getAttribute("a_Uv2"))):this.geometry=new zW({array:t._vertexData})}setPosition(e){1==this.geometry.refCount&&(e instanceof Array&&(e=new Float32Array(e)),this.geometry.resource.setAttribute("a_Position",e))}setUv(e){1==this.geometry.refCount&&(e instanceof Array&&(e=new Float32Array(e)),this.geometry.resource.setAttribute("a_Uv",e))}setUv2(e){1==this.geometry.refCount&&(e instanceof Array&&(e=new Float32Array(e)),this.geometry.resource.setAttribute("a_Uv2",e))}setNormal(e){1==this.geometry.refCount&&(e instanceof Array&&(e=new Float32Array(e)),this.geometry.resource.setAttribute("a_Normal",e))}get data(){var e=this[vH];return{geometryData:e.geometry.vertexData,materialData:e.material.data}}get geometry(){return this[vH].geometry}set geometry(e){this[vH].geometry=e}get isMesh(){return!0}}yH.defaultTagArray=["Geometry"];class xH{static createPlane(e,t,r,n){void 0===e&&(e=1),void 0===t&&(t=1),void 0===r&&(r=1),void 0===n&&(n=1);for(var i={position:[],normal:[],uv:[],index:[]},a=e/r,s=t/n,o=0;o<=n;o++)for(var l=o*s-t/2,u=0;u<=r;u++){var c=u*a-e/2;i.position.push(c,l,0),i.normal.push(0,0,1),i.uv.push(u/r,o/n)}for(var h=0;h<n;h++)for(var d=0;d<r;d++){var p=d+(r+1)*h,f=d+(r+1)*(h+1),m=p+1,g=f+1;i.index.push(p,f,m),i.index.push(f,g,m)}return i}static createCircle(e){var{radius:t=1,segments:r=64,startRad:n=0}=void 0===e?{}:e,i={position:[],normal:[],uv:[],index:[]};i.position.push(0,0,0),i.normal.push(0,0,1),i.uv.push(.5,.5);for(var a=0,s=3;a<=r;a++,s+=3){var o=n+a/r*QI.PI*2;i.position.push(t*QI.cos(o),t*QI.sin(o),0),i.normal.push(0,0,1),i.uv.push((i.position[s]/t+1)/2,(i.position[s+1]/t+1)/2)}for(var l=1;l<=r;l++)i.index.push(l,l+1,0);return i}static createCylinder(e){var{radiusTop:t=1,radiusBottom:r=1,height:n=2,radialSegments:i=64,heightSegments:a=1,openEnded:s=!1,thetaStart:o=0,thetaLength:l=2*QI.PI,poslength:u=0}=void 0===e?{}:e,c={position:[],normal:[],uv:[],index:[]};i=QI.floor(i),a=QI.floor(a);var h=0,d=[],p=n/2;function f(e){for(var n=h,a=!0===e?t:r,s=!0===e?1:-1,d=1;d<=i;d++)c.position.push(0,p*s,0),c.normal.push(0,s,0),c.uv.push(.5,.5),h++;for(var f=h,m=0;m<=i;m++){var g=m/i*l+o,_=QI.cos(g),v=QI.sin(g);c.position.push(a*v,p*s,a*_),c.normal.push(0,s,0),c.uv.push(.5*v+.5,-.5*_*s+.5),h++}for(var y=0;y<i;y++){var x=n+y,b=f+y;!0===e?c.index.push(b+u,b+1+u,x+u):c.index.push(b+1+u,b+u,x+u)}}return function(){for(var e=(r-t)/n,s=0;s<=a;s++){for(var f=[],m=s/a,g=m*(r-t)+t,_=0;_<=i;_++){var v=_/i,y=v*l+o,x=QI.sin(y),b=QI.cos(y),A=QI.normalizeVector([x,e,b]);c.position.push(g*x,-m*n+p,g*b),c.normal.push(A[0],A[1],A[2]),c.uv.push(v,1-m),f.push(h++)}d.push(f)}for(var S=0;S<i;S++)for(var E=0;E<a;E++){var w=d[E][S],C=d[E+1][S],T=d[E+1][S+1],D=d[E][S+1];c.index.push(w+u,C+u,D+u),c.index.push(C+u,T+u,D+u)}}(),!1===s&&(t>0&&f(!0),r>0&&f(!1)),c}static createTorus(e){var{radius:t=.8,tube:r=.2,radialSegments:n=64,tubularSegments:i=64,arc:a=2*QI.PI}=void 0===e?{}:e,s={position:[],normal:[],uv:[],index:[]};n=QI.floor(n),i=QI.floor(i);for(var o=[],l=[],u=[],c=0;c<=n;c++)for(var h=0;h<=i;h++){var d=h/i*a,p=c/n*QI.PI*2;l=[(t+r*QI.cos(p))*QI.cos(d),(t+r*QI.cos(p))*QI.sin(d),r*QI.sin(p)],s.position.push((t+r*QI.cos(p))*QI.cos(d),(t+r*QI.cos(p))*QI.sin(d),r*QI.sin(p)),o=[t*QI.cos(d),t*QI.sin(d),0],u=QI.normalizeVector(QI.subVector(l,o)),s.normal.push(u[0],u[1],u[2]),s.uv.push(h/i),s.uv.push(c/n)}for(var f=1;f<=n;f++)for(var m=1;m<=i;m++){var g=(i+1)*f+m-1,_=(i+1)*(f-1)+m-1,v=(i+1)*(f-1)+m,y=(i+1)*f+m;s.index.push(g,_,y),s.index.push(_,v,y)}return s}static createCapsule(e){var{radius:t=.5,cylinderHeight:r=1,widthSegments:n=64,heightSegments:i=64}=void 0===e?{}:e,a={position:[],normal:[],uv:[],index:[]},s=u(t,n,i,0,2*-QI.PI,-QI.PI/2,QI.PI,r/2),o=u(t,n,i,0,2*-QI.PI,QI.PI/2,QI.PI,-r/2,s.position.length/3),l=this.createCylinder({radiusTop:t,radiusBottom:t,height:r,radialSegments:i,heightSegments:1,openEnded:!0,thetaStart:-QI.PI/4*2,thetaLength:2*QI.PI,poslength:s.position.length/3+o.position.length/3});function u(e,t,r,n,i,a,s,o,l){void 0===e&&(e=10),void 0===t&&(t=8),void 0===r&&(r=8),void 0===n&&(n=0),void 0===i&&(i=2*QI.PI),void 0===a&&(a=QI.PI),void 0===s&&(s=QI.PI),void 0===o&&(o=0),void 0===l&&(l=0);var u={position:[],normal:[],uv:[],index:[]};t=QI.max(3,QI.floor(t)),r=QI.max(2,QI.floor(r));QI.min(a+s,QI.PI);for(var c=0,h=[],d=0;d<=r;d++){var p=[],f=d/r;0==d&&0==a||d==r&&QI.PI;for(var m=0;m<=t;m++){var g=m/t;u.position.push(-e*QI.cos(n+g*i)*QI.sin(a+f*s),e*QI.cos(a+f*s)+o,e*QI.sin(n+g*i)*QI.sin(a+f*s));var _=[-e*QI.cos(n+g*i)*QI.sin(a+f*s),e*QI.cos(a+f*s),e*QI.sin(n+g*i)*QI.sin(a+f*s)];_=QI.normalizeVector(_),u.normal.push(_[0],_[1],_[2]),a>0?u.uv.push(-g,-f):u.uv.push(-g,f),p.push(c++)}h.push(p)}for(var v=0;v<r/2;v++)for(var y=0;y<t;y++){var x=h[v][y+1],b=h[v][y],A=h[v+1][y],S=h[v+1][y+1];a>0?(u.index.push(x+l,S+l,b+l),u.index.push(b+l,S+l,A+l)):(u.index.push(b+l,A+l,S+l),u.index.push(b+l,S+l,x+l))}return u}return a.position=[...s.position,...o.position,...l.position],a.normal=[...s.normal,...o.normal,...l.normal],a.uv=[...s.uv,...o.uv,...l.uv],a.index=[...s.index,...o.index,...l.index],a}static createSphere(e){var{radius:t=1,widthSegments:r=32,heightSegments:n=16,phiStart:i=0,phiLength:a=2*QI.PI,thetaStart:s=0,thetaLength:o=QI.PI}=void 0===e?{}:e,l={position:[],normal:[],uv:[],index:[]};r=QI.max(3,QI.floor(r)),n=QI.max(2,QI.floor(n));for(var u=QI.min(s+o,QI.PI),c=0,h=[],d=0;d<=n;d++){var p=[],f=d/n,m=0;0==d&&0==s?m=.5/r:d==n&&u==QI.PI&&(m=-.5/r);for(var g=0;g<=r;g++){var _=g/r,v=[-t*QI.cos(i+_*a)*QI.sin(s+f*o),t*QI.cos(s+f*o),t*QI.sin(i+_*a)*QI.sin(s+f*o)];l.position.push(...v);var y=QI.normalizeVector(v);l.normal.push(...y),l.uv.push(_+m,1-f),p.push(c++)}h.push(p)}for(var x=0;x<n;x++)for(var b=0;b<r;b++){var A=h[x][b+1],S=h[x][b],E=h[x+1][b],w=h[x+1][b+1];(0!==x||s>0)&&l.index.push(A,S,w),(x!==n-1||u<Math.PI)&&l.index.push(S,E,w)}return l}static createRing(e){var{innerRadius:t=.5,outerRadius:r=1,thetaSegments:n=32,phiSegments:i=1,thetaStart:a=0,thetaLength:s=2*Math.PI}=void 0===e?{}:e,o={position:[],normal:[],uv:[],index:[]};n=QI.max(3,QI.floor(n));for(var l=t,u=(r-t)/(i=QI.max(2,QI.floor(i))),c=0;c<=i;c++){for(var h=0;h<=n;h++){var d=a+h/n*s,p=[l*QI.cos(d),l*QI.sin(d),0];o.position.push(...p),o.normal.push(0,0,1);var f=[(p[0]/r+1)/2,(p[1]/r+1)/2];o.uv.push(...f)}l+=u}for(var m=0;m<i;m++)for(var g=m*(n+1),_=0;_<n;_++){var v=_+g,y=v,x=v+n+1,b=v+n+2,A=v+1;o.index.push(y,x,A),o.index.push(x,b,A)}return o}}class bH extends yH{constructor(e){void 0===e&&(e={}),e.data=xH.createTorus(e),super(e)}}class AH extends yH{constructor(e){void 0===e&&(e={}),e.data=xH.createCylinder(e),super(e)}}class SH extends yH{constructor(e){void 0===e&&(e={}),e.data=xH.createCircle(e),super(e)}}class EH extends yH{constructor(e){void 0===e&&(e={}),e.data=xH.createCapsule(e),super(e)}}var wH=Symbol("private"),CH=QI.createVec3(),TH=QI.createVec3(),DH=QI.createMat3(),MH=QI.createMat4();class PH extends JV{constructor(e){super(e),this[wH]={};var t=this[wH];t.lastMat4=null,t.resources=[],t.planes=null,t.worldPlanes=null;var r=e.planes;r&&(this.planes=r)}_updatePlanes(e){var t=this[wH];if(this.node.getMatrixWorld(MH),!e)if(t.lastMat4){if(QI.mat4.equals(MH,t.lastMat4))return}else t.lastMat4=QI.createMat4();t.lastMat4&&QI.mat4.copy(t.lastMat4,MH),t.worldPlanes=t.planes.map((e=>function(e,t){var r=QI.vec3.copy(CH,e.direction),n=QI.vec3.copy(TH,e.direction),i=QI.mat3.normalFromMat4(DH,t),a=QI.vec3.transformMat4(r,QI.vec3.scale(r,r,-e.height),t),s=QI.vec3.normalize(n,QI.vec3.transformMat3(n,n,i)),o=-QI.vec3.dot(a,s);return{direction:s.slice(0),height:o}}(e,MH))),t.resources.forEach((e=>{e.setClippingPlanes(t.worldPlanes)}))}onUpdate(e){super.onUpdate(e);var t=this[wH];t.planes&&t.resources.length&&this._updatePlanes()}addStyleResource(e){var t=this[wH];-1===t.resources.indexOf(e)&&(t.resources.push(e),e.setClippingPlanes(t.worldPlanes))}removeStyleResource(e){var t=this[wH],r=t.resources.indexOf(e);-1!==r&&(t.resources.splice(r,1),e.setClippingPlanes(null))}get planes(){return this[wH].planes}set planes(e){this[wH].planes=e.map((e=>({direction:e.direction.slice(0),height:e.height}))),this._updatePlanes(!0)}get isClippingPlanes(){return!0}}class FH extends QU{constructor(){super()}_getTargetPosition(){var e=this.object,t=e.bodyNode;return zu.getPositionOnDirection(e.position,e.forward,-t.getDistance())}onUpdate(e){var t=this.object.bodyNode,r=t.getDistance(),n=r||1e3,i=n*Math.tan(t.getAngle());this.lineSegments.setScale([i,i,n]),this.lineSegments.getStyle().setColorOp((()=>BI.parseColor(this.object.color)))}onAdd(e){super.onAdd(e);for(var t=[[0,0,0],[0,0,-1],[0,0,0],[1,0,-1],[0,0,0],[-1,0,-1],[0,0,0],[0,1,-1],[0,0,0],[0,-1,-1]],r=0,n=1;r<32;r++,n++){var i=r/32*Math.PI*2,a=n/32*Math.PI*2;t.push([Math.cos(i),Math.sin(i),-1]),t.push([Math.cos(a),Math.sin(a),-1])}this.begin();for(var s=0;s<t.length;s+=2)this.addLine(t[s],t[s+1],[1,1,1,1]);this.end()}}var RH={isResident:!0};class NH extends lG{constructor(e){void 0===e&&(e={}),super(e)}onCopy(e){super.onCopy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("SpotLight"),super.onBeforeSetup(e)}onSetupComponent(e){super.onSetupComponent(e),this.addComponent(FH,"helper",RH)}onSetupComplete(e){super.onSetupComplete(e),BI.syncOptions(this,["distance","angle","penumbra","decay"],e,e.extras||e.external)}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"distance",this),BI.setAttributeIfExist(e,"angle",this),BI.setAttributeIfExist(e,"penumbra",this),BI.setAttributeIfExist(e,"decay",this),e}get distance(){return this.bodyNode.getDistance()}set distance(e){this.bodyNode.setDistance(e)}get angle(){return QI.radToDeg(this.bodyNode.getAngle())}set angle(e){this.bodyNode.setAngle(QI.degToRad(e))}get penumbra(){return this.bodyNode.getPenumbra()}set penumbra(e){this.bodyNode.setPenumbra(e)}get decay(){return this.bodyNode.getDecay()}set decay(e){this.bodyNode.setDecay(e)}get isSpotLight(){return!0}}class BH extends mj{constructor(e){void 0===e&&(e={}),super(e),this._selfPoints=[],this._autoAdjustPosition=!1}_adjustPosition(e){var t=QI.getCenterFromPoints(e);this.position=t}onSyncOptions(e){BI.syncOptions(this,["autoAdjustPosition","selfPoints","points"],e,e.extras||e.external)}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"autoAdjustPosition",this),BI.setAttributeIfExist(e,"selfPoints",this),e}onSetupPosition(e){if(e.localPosition||e.position)super.onSetupPosition(e);else if(e.points){var t=QI.getCenterFromPoints(e.points);this.position=t}else super.onSetupPosition(e)}onGetSelfPoints(e){return e}onBeforeSetBodyPoints(e){}onAfterSetBodyPoints(){}onRefresh(){this.onRefreshPoints(),this.onRefreshAttributes()}onRefreshPoints(){this.onBeforeSetBodyPoints(this._selfPoints);var e=this.onGetSelfPoints(this._selfPoints);return this.bodyNode.setPoints(e),this.onAfterSetBodyPoints(),e}onRefreshAttributes(){}clearPoints(){this._selfPoints=[],this.bodyNode.setPoints([])}insertPoint(e,t){this._selfPoints._insert(e,this.worldToSelf(t)),this.onRefreshPoints()}addPoint(e){this._selfPoints.push(this.worldToSelf(e)),this.onRefreshPoints()}addPoints(e){var t=this._selfPoints;e.forEach((e=>{t.push(this.worldToSelf(e))})),this.onRefreshPoints()}removePoint(e){this._selfPoints._removeAt(e),this.onRefreshPoints()}setPoint(e,t){this._selfPoints[e]=this.worldToSelf(t),this.onRefreshPoints()}get number(){return this.points.length}get autoAdjustPosition(){return this._autoAdjustPosition}set autoAdjustPosition(e){this._autoAdjustPosition=e}get selfPoints(){return this._selfPoints}set selfPoints(e){this._selfPoints=e?e.slice(0):[],this.onRefreshPoints()}get points(){return this._selfPoints.map((e=>this.selfToWorld(e)))}set points(e){e?(this._autoAdjustPosition&&this._adjustPosition(e),this._selfPoints=e.map((e=>this.worldToSelf(e))),this.onRefreshPoints()):this.clearPoints()}get localPoints(){return this._selfPoints.map((e=>this.selfToLocal(e)))}set localPoints(e){e?(this._selfPoints=e.map((e=>this.localToSelf(e))),this.onRefreshPoints()):this.clearPoints()}get length(){return QI.getDistanceFromPoints(this.points)}}class IH extends BH{constructor(e){void 0===e&&(e={}),super(e)}onRefresh(){var e=this.bodyNode;e.begin(),super.onRefresh(),e.end()}onSyncOptions(e){super.onSyncOptions(e)}begin(){this.bodyNode.begin()}end(){this.bodyNode.end()}get isBaseDynamicPoints(){return!0}}var OH=65536;class kH extends IH{constructor(e){void 0===e&&(e={}),super(e),this._uvModeType=ZB.Tile,this._groups=[],this._groupPickedIds=[],this._flags.enable(OH,BI.parseValue(e.closure,!1))}onSyncOptions(e){super.onSyncOptions(e),BI.syncOptions(this,["closure","progress","uvModeType","groups","groupPickedIds"],e,e.extras||e.external)}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"closure",this),BI.setAttributeIfExist(e,"progress",this),BI.setAttributeIfExist(e,"uvModeType",this),BI.setAttributeIfExist(e,"groups",this),BI.setAttributeIfExist(e,"groupPickedIds",this),e}onRefreshPoints(){super.onRefreshPoints();var e=this.bodyNode;this._groups.length&&e.setGroups(this._groups),e.setUVMode(this._uvModeType),e.setAttribute("Closure",this._flags.has(OH))}get uvModeType(){return this._uvModeType}set uvModeType(e){this._uvModeType!=e&&(this._uvModeType=e,this.onRefreshPoints())}get groups(){return this._groups}set groups(e){this._groups=e?e.slice(0):[],this.onRefreshPoints()}get groupPickedIds(){return this._groupPickedIds}set groupPickedIds(e){e?this._groupPickedIds=e.slice(0):this._groupPickedIds.length=0,this.bodyNode.setGroupPickedIds(this._groupPickedIds)}get closure(){return this._flags.has(OH)}set closure(e){this._flags.enable(OH,e)&&this.onRefreshPoints()}get isLine(){return!0}}kH.defaultTagArray=["Line"];class LH extends kH{constructor(e){void 0===e&&(e={}),super(e),this._syncOptions(e)}_syncOptions(e){super.onSyncOptions(e)}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("PixelLine"),super.onBeforeSetup(e)}get isPixelLine(){return!0}}LH.defaultTagArray=["Line"];class UH extends kH{constructor(e){void 0===e&&(e={}),super(e),this._width=1,this._cornerThreshold=.4,this._syncOptions(e)}_syncOptions(e){this.begin(),super.onSyncOptions(e),BI.syncOptions(this,["width","cornerThreshold"],e,e.extras||e.external),this.end()}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("FatLine"),super.onBeforeSetup(e)}onAfterSetup(e){super.onAfterSetup(e)}onRefreshAttributes(){var e=this.bodyNode;e.setWidth(this._width),e.setCornerThreshold(this._cornerThreshold)}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"width",this),BI.setAttributeIfExist(e,"cornerThreshold",this),e}get width(){return this._width}set width(e){this._width=e,this.bodyNode.setWidth(this._width)}get cornerThreshold(){return this._cornerThreshold}set cornerThreshold(e){this._cornerThreshold=QI.clamp(e,.1,1),this.bodyNode.setCornerThreshold(this._cornerThreshold)}get isFatLine(){return!0}}UH.defaultTagArray=["Line"];class zH extends kH{constructor(e){void 0===e&&(e={}),super(e),this._width=1,this._cornerRadius=.3,this._cornerSplit=10,this._arrow=!1,this._syncOptions(e)}_syncOptions(e){this.begin(),super.onSyncOptions(e),BI.syncOptions(this,["width","cornerRadius","cornerSplit","arrow"],e,e.extras||e.external),this.end()}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("RouteLine"),super.onBeforeSetup(e)}onAfterSetup(e){super.onAfterSetup(e)}onRefreshAttributes(){var e=this.bodyNode;e.setWidth(this._width),e.setCornerRadius(this._cornerRadius),e.setCornerSplit(this._cornerSplit),e.setArrow(this._arrow)}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"width",this),BI.setAttributeIfExist(e,"cornerRadius",this),BI.setAttributeIfExist(e,"cornerSplit",this),BI.setAttributeIfExist(e,"arrow",this),e}get facingDirection(){return this.bodyNode.getUpDirection([0,0,0])}set facingDirection(e){this.bodyNode.setUpDirection(e)}get width(){return this._width}set width(e){this._width=e,this.bodyNode.setWidth(this._width)}get cornerRadius(){return this._cornerRadius}set cornerRadius(e){this._cornerRadius=e,this.bodyNode.setCornerRadius(this._cornerRadius)}get cornerSplit(){return this._cornerSplit}set cornerSplit(e){this._cornerSplit=QI.toInteger(e),this.bodyNode.setCornerSplit(this._cornerSplit)}get arrow(){return this._arrow}set arrow(e){this._arrow=e,this.bodyNode.setArrow(this._arrow)}get isRouteLine(){return!0}}zH.defaultTagArray=["Line"];class jH extends kH{constructor(e){void 0===e&&(e={}),super(e),this._radius=.5,this._cornerRadius=.3,this._cornerSplit=10,this._radialSegments=8,this._startDegree=0,this._syncOptions(e)}_syncOptions(e){this.begin(),super.onSyncOptions(e),BI.syncOptions(this,["radius","cornerRadius","cornerSplit","radialSegments","startDegree"],e,e.extras||e.external),this.end()}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("PolygonLine"),super.onBeforeSetup(e)}onAfterSetup(e){super.onAfterSetup(e)}onRefreshAttributes(){var e=this.bodyNode;e.setRadius(this._radius),e.setCornerRadius(this._cornerRadius),e.setCornerSplit(this._cornerSplit),e.setRadialSegments(this._radialSegments),e.setStartRad(QI.degToRad(this._startDegree))}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"radius",this),BI.setAttributeIfExist(e,"cornerRadius",this),BI.setAttributeIfExist(e,"cornerSplit",this),BI.setAttributeIfExist(e,"radialSegments",this),BI.setAttributeIfExist(e,"startDegree",this),e}get radius(){return this._radius}set radius(e){this._radius=e,this.bodyNode.setRadius(this._radius)}get cornerRadius(){return this._cornerRadius}set cornerRadius(e){this._cornerRadius=e,this.bodyNode.setCornerRadius(this._cornerRadius)}get cornerSplit(){return this._cornerSplit}set cornerSplit(e){this._cornerSplit=QI.toInteger(e),this.bodyNode.setCornerSplit(this._cornerSplit)}get radialSegments(){return this._radialSegments}set radialSegments(e){this._radialSegments=e,this.bodyNode.setRadialSegments(this._radialSegments)}get startDegree(){return this._startDegree}set startDegree(e){this._startDegree=e,this.bodyNode.setStartRad(QI.degToRad(this._startDegree))}get isPolygonLine(){return!0}}jH.defaultTagArray=["Line"];class VH extends BH{constructor(e){void 0===e&&(e={}),super(e),this._syncOptions(e)}_updateSize(e){var t=this.bodyNode;t.getSize()<e.length&&t.setSize(2*e.length)}_syncOptions(e){super.onSyncOptions(e)}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("LineSegments"),super.onBeforeSetup(e)}onAfterSetup(e){super.onAfterSetup(e)}onGetSelfPoints(e){return this._updateSize(e),e}onRefreshPoints(){var e=super.onRefreshPoints();this._updateSize(e),this.bodyNode.setColors(e.map((e=>[1,1,1])))}get isPixelLineSegments(){return!0}}VH.defaultTagArray=["Line"];class GH extends BH{constructor(e){void 0===e&&(e={}),super(e),this._imageRatio=1,this._size=1,this._sizeAttenuation=!1,this._pickedIds=[],this._syncOptions(e)}_syncOptions(e){super.onSyncOptions(e),BI.syncOptions(this,["size","imageRatio","pickedIds"],e,e.extras||e.external)}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("Points"),super.onBeforeSetup(e)}onAfterSetup(e){super.onAfterSetup(e)}onSetupStyle(e){var t=e.style;t?void 0===t.transparent&&(t.transparent=!0):e.style={transparent:!0},super.onSetupStyle(e)}onRefreshPoints(){super.onRefreshPoints();var e=this.bodyNode;e.setSize(this._size),e.setSizeAttenuation(this._sizeAttenuation)}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"size",this),BI.setAttributeIfExist(e,"imageRatio",this),BI.setAttributeIfExist(e,"pickedIds",this),e}get size(){return this._size}set size(e){this._size=e,this.bodyNode.setSize(e)}get imageRatio(){return this._imageRatio}set imageRatio(e){this._imageRatio=e,this.bodyNode.setImageRatio(e)}get sizeAttenuation(){return this._sizeAttenuation}set sizeAttenuation(e){this._sizeAttenuation=e,this.bodyNode.setSizeAttenuation(e)}get pickedIds(){return this._pickedIds}set pickedIds(e){e?this._pickedIds=e.slice(0):this._pickedIds.length=0,this.bodyNode.setPickedIds(this._pickedIds)}get isPoints(){return!0}}var WH=[0,0,0,1];class HH extends IH{constructor(e){void 0===e&&(e={}),super(e),this._selfHoles=[],this._height=0,this._syncOptions(e)}_refreshHoles(){var e=this.selfPlaneHoles;this.bodyNode.setHoles(e)}_syncOptions(e){var t=this.bodyNode;t.begin(),super.onSyncOptions(e),BI.syncOptions(this,["selfPlanePoints","selfPlaneHoles","selfHoles","holes","height"],e,e.extras||e.external),t.end()}onBeforeSetup(e){e.renderableNode||(e.renderableNode=BI.createObject("ExtrudeShape"),e.renderableNode.setQuaternion(WH)),super.onBeforeSetup(e)}onAfterSetup(e){super.onAfterSetup(e)}onGetSelfPoints(e){return e.map((e=>[e[0],e[2]]))}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"selfPlanePoints",this),BI.setAttributeIfExist(e,"selfPlaneHoles",this),BI.setAttributeIfExist(e,"selfHoles",this),BI.setAttributeIfExist(e,"height",this),e}get selfPlanePoints(){return this.points.map((e=>{var t=this.worldToSelf(e);return[t[0],t[2]]}))}set selfPlanePoints(e){void 0===e&&(e=[]),this.points=QI.makeClockWisePoints(e).map((e=>this.selfToWorld([e[0],0,e[1]])))}get selfPlaneHoles(){return this._selfHoles.map((e=>e.map((e=>[e[0],e[2]]))))}set selfPlaneHoles(e){this._selfHoles=e.map((e=>e.map((e=>[e[0],0,e[1]])))),this._refreshHoles()}get selfHoles(){return this._selfHoles}set selfHoles(e){void 0===e&&(e=[]),this._selfHoles=e.slice(0),this._refreshHoles()}get holes(){return this._selfHoles.map((e=>e.map((e=>this.selfToWorld(e)))))}set holes(e){void 0===e&&(e=[]),this._selfHoles=e.map((e=>e.map((e=>this.worldToSelf(e))))),this._refreshHoles()}get height(){return this._height}set height(e){this._height=e,this.bodyNode.setHeight(e)}get isExtrudeShape(){return!0}}HH.defaultTagArray=["Geometry"];class qH extends QU{constructor(e){super()}_addLines(e,t){if(e.length){for(var r=[e[0][0],0,e[0][1]],n=r,i=1;i<e.length;i++){var a=e[i],s=[a[0],0,a[1]];this.addLine(n,s,t),n=s}this.addLine(n,r,t)}}onAdd(e){super.onAdd(e)}refresh(){this.begin(),this.lineSegments.setPosition([0,.001,0]),this.object.selfPlaneHoles.forEach((e=>{this._addLines(e,[1,0,0])})),this._addLines(this.object.localPoints,[0,1,0]),this.end()}get visible(){return this.lineSegments.getVisible()}set visible(e){this.lineSegments.setVisible(e),this.refresh()}}var XH={isResident:!0};class QH extends IH{constructor(e){void 0===e&&(e={}),super(e),this._selfHoles=[]}_refreshHoles(){var e=this.selfPlaneHoles;this.bodyNode.setHoles(e),this.hasComponent("helper")&&this.helper.refresh()}_getOutlinePoints(){var e=this.onGetSelfPoints(this.selfPoints);return QI.getOutlinePoints(e)}onSyncOptions(e){super.onSyncOptions(e),BI.syncOptions(this,["selfPlanePoints","selfPlaneHoles","selfHoles","holes"],e,e.extras||e.external)}onExportExternalData(){var e=Object.assign({},super.onExportExternalData());return BI.setAttributeIfExist(e,"selfPlanePoints",this),BI.setAttributeIfExist(e,"selfPlaneHoles",this),BI.setAttributeIfExist(e,"selfHoles",this),e}onSetupComponent(e){super.onSetupComponent(e),this.addComponent(qH,"helper",XH)}onSetupTransform(e){if(!(e.position||e.localPosition)){var t=e.points;if(t&&t.length){var r=t.reduce(((e,t)=>e+t[1]),0)/t.length;e.position=QI.getLabelPosition(t,e.holes,r)}}super.onSetupTransform(e)}onGetSelfPoints(e){return e.map((e=>[e[0],e[2]]))}onBeforeSetBodyPoints(e){}onRefresh(){this._refreshHoles(),super.onRefresh()}get selfPlaneHoles(){return this._selfHoles.map((e=>e.map((e=>[e[0],e[2]]))))}set selfPlaneHoles(e){this._selfHoles=e.map((e=>e.map((e=>[e[0],0,e[1]])))),this._refreshHoles()}get selfHoles(){return this._selfHoles}set selfHoles(e){void 0===e&&(e=[]),this._selfHoles=e.slice(0),this._refreshHoles()}get holes(){return this._selfHoles.map((e=>e.map((e=>this.selfToWorld(e)))))}set holes(e){void 0===e&&(e=[]),this._selfHoles=e.map((e=>e.map((e=>this.worldToSelf(e))))),this._refreshHoles()}get selfPlanePoints(){return this.points.map((e=>{var t=this.worldToSelf(e);return[t[0],t[2]]}))}set selfPlanePoints(e){void 0===e&&(e=[]),this.points=QI.makeClockWisePoints(e).map((e=>this.selfToWorld([e[0],0,e[1]])))}get area(){var e=this._getOutlinePoints(),t=Math.abs(QI.getArea(e));return this.selfPlaneHoles.forEach((e=>{var r=QI.getArea(e);t-=r})),t}get perimeter(){var e=this.outlinePoints;return QI.getDistanceFromPoints(e,!0)}get labelPosition(){var e=this._getOutlinePoints(),t=QI.getLabelPosition(e);return this.selfToWorld(t)}get outlinePoints(){return this._getOutlinePoints().map((e=>this.selfToWorld([e[0],0,e[1]])))}}var KH=Symbol("private");class YH extends QH{constructor(e){void 0===e&&(e={}),super(e),this[KH]={};var t=this[KH];t.flowOffset=[0,0],t.flowSpeed=BI.parseValue(e.flowSpeed,[0,0]),t.flowWeight=.5,t.reflectDistortion=2,t.noiseTimeScale=1;var r=this.app.global.cache.images.water_normal_image;this.style.normalMap=r,this._syncOptions(e)}_syncOptions(e){super.onSyncOptions(e)}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("Water"),super.onBeforeSetup(e)}onCreateBodyNode(){var e=BI.createObject("Water");return e||null}onRefreshAttributes(){var e=this[KH],t=this.bodyNode;t.setFlowWeight(e.flowWeight),t.setReflectDistortion(e.reflectDistortion),t.setNoiseTimeScale(e.noiseTimeScale)}onUpdate(e){var t=this[KH];if(t.flowSpeed[0]||t.flowSpeed[1]){var r=e,n=t.flowOffset,i=t.flowSpeed,a=[i[0]*r,i[1]*r];n[0]+=a[0],n[1]+=a[1],this.bodyNode.setFlowOffset(n)}this.bodyNode.update(e)}onCreate(e){super.onCreate(e),this.onAddTickableObject()}destroy(){return this.onRemoveTickableObject(),super.destroy()}get flowSpeed(){return this[KH].flowSpeed}set flowSpeed(e){this[KH].flowSpeed=e.concat()}get flowWeight(){return this[KH].flowWeight}set flowWeight(e){this[KH].flowWeight=e,this.bodyNode.setFlowWeight(e)}get reflectDistortion(){return this[KH].reflectDistortion}set reflectDistortion(e){this[KH].reflectDistortion=e,this.bodyNode.setReflectDistortion(e)}get noiseTimeScale(){return this[KH].noiseTimeScale}set noiseTimeScale(e){this[KH].noiseTimeScale=e,this.bodyNode.setNoiseTimeScale(e)}get isWater(){return!0}}YH.defaultTagArray=["Region"];var ZH=[0,0,0,1];class JH extends QH{constructor(e){void 0===e&&(e={}),super(e),this._syncOptions(e)}_syncOptions(e){var t=this.bodyNode;t.begin(),super.onSyncOptions(e),t.end()}onBeforeSetup(e){e.renderableNode||(e.renderableNode=BI.createObject("ExtrudeShape"),e.renderableNode.setQuaternion(ZH)),super.onBeforeSetup(e)}onCreateBodyNode(){var e=BI.createObject("ExtrudeShape");return e?(e.setHeight(Number.MIN_VALUE),e):null}get isPlaneRegion(){return!0}}JH.defaultTagArray=["Region"];var $H=Le.toText("129,141,38,43,110,33"),eq={renderLayer:1,envMap:!1,lights:!1};class tq extends mj{constructor(e){void 0===e&&(e={}),super(e),this._autoFitBodyScale=BI.parseValue(e.autoFitBodyScale,!1),this._scaleFactor=BI.parseValue(e.scaleFactor,.01),this._renderType=BI.parseValue(e.renderType,kB.Sprite),this._pivotMode=BI.parseValue(e.pivotMode||e.pivotModeType,LB.Auto),this._spriteRotation=BI.parseValue(e.spriteRotation,0);var t=e.pivot;t&&this._updatePivot(t)}_useSpriteCenterAsPivot(){return this.renderType==kB.Sprite&&this.pivotMode==LB.Auto}_fitBodyScale(){var e=this.style.image;e&&e.waitForComplete().then((()=>{var t=e.width,r=e.height;if(t&&r){var n=this._scaleFactor;t*=n,r*=n;var i=this.parent;if(i){var a=i.scale;t/=a[0],r/=a[1]}this.body.localScale=[t,r,1];var s=this.transform.keepSizeInfo;s&&s.refresh()}}))}_updatePivot(e){this.clearPivot();var t=this.bodyNode;this._useSpriteCenterAsPivot()?(e&&t.setAttribute("Center",[e[0],e[1]]),t.setAttribute("Rotation",QI.degToRad(this._spriteRotation)),t.setWorldPosition(this.position)):e&&(this.pivot=e),this._autoFitBodyScale&&this._fitBodyScale()}_refreshRenderableNode(e){var t=this.renderType;if(t==kB.Sprite){if(!e.renderableNode&&this.bodyNode.getType()!=$H){var r=BI.createObject($H,this.external);this.body.setNode(r)}var n=e.spriteRotation;n&&this.bodyNode.setAttribute("Rotation",QI.degToRad(n))}else if(t==kB.Plane){if(!e.renderableNode&&"Node"!=this.bodyNode.getType()){var i=this.app.resourceManager.parseModel("Plane",eq);this.body.setNode(i)}}var a=e.pivot;a&&this._updatePivot(a)}onBeforeSetup(e){var t=e.renderableNode;if(!t){switch(BI.parseValue(e.renderType,kB.Sprite)){case kB.Sprite:t=BI.createObject($H,e.extras||e.external);break;case kB.Plane:t=this.app.resourceManager.parseModel("Plane",eq)}e.renderableNode=t}}onSetupStyle(e){var t=e.style;t?(void 0===t.transparent&&(t.transparent=!0),void 0===t.sideType&&(t.sideType=OB.Double),void 0===t.lights&&(t.lights=!1)):e.style={transparent:!0,sideType:OB.Double},super.onSetupStyle(e)}onCopy(e){super.onCopy(e),this._autoFitBodyScale=e.autoFitBodyScale,this._scaleFactor=e.scaleFactor,this._renderType=e.renderType,this._pivotMode=e.pivotMode,this._spriteRotation=e.spriteRotation,this.onRefresh()}onRefresh(){this._autoFitBodyScale&&this._fitBodyScale(),super.onRefresh()}onLoadResource(e,t,r){BI.parseValue(e.assets,!0)?BI.setTimeout((()=>{this.destroyed||(this._refreshRenderableNode(e),t())})):BI.setTimeout((()=>{t()}))}onCreateBodyNode(e){var t;switch(this.renderType){case kB.Sprite:t=BI.createObject($H,this.external);break;case kB.Plane:t=this.app.resourceManager.parseModel("Plane",eq);break;default:t=super.onCreateBodyNode(e)}return t}onGetPivot(){if(this._useSpriteCenterAsPivot()){var e=this.bodyNode.getAttribute("Center");return[e[0],e[1],.5]}return super.onGetPivot()}onSetPivot(e){this._useSpriteCenterAsPivot()?this.bodyNode.setAttribute("Center",[e[0],e[1]]):super.onSetPivot(e)}onChangeImage(){this.waitForComplete().then((()=>{this._autoFitBodyScale&&this._fitBodyScale()}))}get autoFitBodyScale(){return this._autoFitBodyScale}set autoFitBodyScale(e){this._autoFitBodyScale=e,this._autoFitBodyScale&&this._fitBodyScale()}get scaleFactor(){return this._scaleFactor}set scaleFactor(e){this._scaleFactor=e,this._autoFitBodyScale&&this._fitBodyScale()}get renderType(){return void 0!==this._renderType?this._renderType:"Sprite"===this.bodyNode.getType()?kB.Sprite:kB.Plane}set renderType(e){var t=this.pivot;this._renderType=e,this.reloadResource(!1,{pivot:t})}get pivotMode(){return this._pivotMode}set pivotMode(e){this._pivotMode!=e&&(this._pivotMode=e,this.onSetPivot(this.pivot))}get pivotModeType(){return this.pivotMode}set pivotModeType(e){this.pivotMode=e}get spriteRotation(){return this._spriteRotation}set spriteRotation(e){this._spriteRotation=e,this.loaded&&this.renderType==kB.Sprite&&this.bodyNode.setAttribute("Rotation",QI.degToRad(e))}get isMarker(){return!0}}var rq=Symbol("private");let nq=class{constructor(e){void 0===e&&(e={}),this[rq]={};var t=this[rq];t.renderer=null;var r=e.width||1,n=e.height||1,i=BI.createObject("CanvasRenderer");i.resize(r,n),t.renderer=i}_limitSize(e){var t=BI.getCurrentApp().renderCapabilities.maxTextureSize,r=e[0],n=e[1];return(r>t||n>t)&&(r>n?(r=Math.min(t,QI.ceilPowerOfTwo(r)),n=Math.floor(n*(r/e[0]))):(n=Math.min(t,QI.ceilPowerOfTwo(n)),r=Math.floor(r*(n/e[1])))),[r,n]}_scaleRow(e,t){e.height*=t;var r=e.metrics;r.actualBoundingBoxAscent&&(r.actualBoundingBoxAscent*=t),r.actualBoundingBoxDescent&&(r.actualBoundingBoxDescent*=t),r.fontBoundingBoxAscent&&(r.fontBoundingBoxAscent*=t),r.fontBoundingBoxDescent&&(r.fontBoundingBoxDescent*=t),r.actualBoundingBoxLeft&&(r.actualBoundingBoxLeft*=t),r.actualBoundingBoxRight&&(r.actualBoundingBoxRight*=t),r.width&&(r.width*=t),e.options.size*=t}clear(){this[rq].renderer.clear()}resize(e,t){this[rq].renderer.resize(e,t)}drawText(e,t){var r=this[rq].renderer,n=r.getTextRows(e,t);if(!n)return!1;var i=this._limitSize(n.size);if(i[0]!=n.size[0]||i[1]!=n.size[1]){var a=i[0]/n.size[0];n.rows.forEach((e=>{this._scaleRow(e,a)})),n.size=i}r.resize(i[0],i[1]);var s=Object.assign({},t);return r.drawText(n,s),!0}fillRect(e,t,r,n,i){this[rq].renderer.fillRect(e,t,r,n,BI.parseColor(i))}convertToImage(e,t){return this[rq].renderer.convertToImage(e,t)}saveAsImage(e,t,r){var n=this.convertToImage(t,r);return!!n&&BI.saveAsFile(e,n)}getContext(){return this[rq].renderer.getContext()}getImageData(){var e=this[rq],t=e.renderer.getContext(),r=e.renderer.getImageData(0,0,t.width,t.height);return{width:t.width,height:t.height,data:r}}get isCanvasRenderer(){return!0}};var iq=Symbol("private");class aq extends tq{constructor(e){void 0===e&&(e={}),super(e),aq.canvasRenderer=aq.canvasRenderer||new nq,this[iq]={};var t=this[iq];t.text="",t.fontInfo={},t.image=new DU,t.image.wrapType=tI.ClampToEdge,t.fontInfo={type:"Arial",size:10,lineWidth:1/0,lineHeight:0,color:"#FFFFFF",shadowColor:"#000000",shadowAlpha:1,shadowAngle:45,shadowBlur:1,shadowDistance:1,alignType:IB.Center,richText:!1,fontWeight:hI.Normal},t.text=BI.parseValue(e.fontText,t.text);var r=t.fontInfo;r.type=BI.parseValue(e.fontType,r.type),r.size=BI.parseValue(e.fontSize,r.size),r.lineWidth=BI.parseValue(e.fontLineWidth,r.lineWidth),r.lineHeight=BI.parseValue(e.fontLineHeight,r.lineHeight),r.color=BI.parseColor(e.fontColor,r.color),r.shadowColor=BI.parseColor(e.fontShadowColor,r.shadowColor),r.shadowAlpha=BI.parseValue(e.fontShadowAlpha,r.shadowAlpha),r.shadowAngle=BI.parseValue(e.fontShadowAngle,r.shadowAngle),r.shadowBlur=BI.parseValue(e.fontShadowBlur,r.shadowBlur),r.shadowDistance=BI.parseValue(e.fontShadowDistance,r.shadowDistance),r.alignType=BI.parseValue(e.fontAlignType,r.alignType),r.richText=BI.parseValue(e.richText,r.richText),r.fontWeight=BI.parseValue(e.fontWeight,r.fontWeight),BI.isNull(e.renderOrder)&&(this.renderOrder=1e6),this.autoFitBodyScale=BI.parseValue(e.autoFitBodyScale,!0),this.scaleFactor=BI.parseValue(e.scaleFactor,.035)}onCopy(e){super.onCopy(e);var t=this[iq];t.text=e.fontText,Object.assign(t.fontInfo,e.fontInfo),this.onRefresh()}onLoadResource(e,t,r){super.onLoadResource(e,(()=>{this.onRefresh(),t()}),r)}onRefresh(){var e=this[iq];if(e.text){var t=aq.canvasRenderer;t.drawText(e.text,e.fontInfo),e.image.resource=t.getImageData(),this.style.image!=e.image&&(this.style.image=e.image)}super.onRefresh()}get fontText(){return this[iq].text}set fontText(e){this[iq].text=e,this.setDirty()}get fontInfo(){return this[iq].fontInfo}get fontType(){return this[iq].fontInfo.type}set fontType(e){this[iq].fontInfo.type=e,this.setDirty()}get fontSize(){return this[iq].fontInfo.size}set fontSize(e){this[iq].fontInfo.size=e,this.setDirty()}get fontLineWidth(){return this[iq].fontInfo.lineWidth}set fontLineWidth(e){this[iq].fontInfo.lineWidth=e,this.setDirty()}get fontLineHeight(){return this[iq].fontInfo.lineHeight}set fontLineHeight(e){this[iq].fontInfo.lineHeight=e,this.setDirty()}get fontColor(){var e=this[iq];return BI.colorToHexString(e.fontInfo.color)}set fontColor(e){this[iq].fontInfo.color=BI.parseColor(e),this.setDirty()}get fontShadowColor(){var e=this[iq];return BI.colorToHexString(e.fontInfo.shadowColor)}set fontShadowColor(e){this[iq].fontInfo.shadowColor=BI.parseColor(e),this.setDirty()}get fontShadowAlpha(){return this[iq].fontInfo.shadowAlpha}set fontShadowAlpha(e){this[iq].fontInfo.shadowAlpha=e,this.setDirty()}get fontShadowAngle(){return this[iq].fontInfo.shadowAngle}set fontShadowAngle(e){this[iq].fontInfo.shadowAngle=e,this.setDirty()}get fontShadowBlur(){return this[iq].fontInfo.shadowBlur}set fontShadowBlur(e){this[iq].fontInfo.shadowBlur=e,this.setDirty()}get fontShadowDistance(){return this[iq].fontInfo.shadowDistance}set fontShadowDistance(e){this[iq].fontInfo.shadowDistance=e,this.setDirty()}get fontAlignType(){return this[iq].fontInfo.alignType}set fontAlignType(e){this[iq].fontInfo.alignType=e,this.setDirty()}get richText(){return this[iq].fontInfo.richText}set richText(e){this[iq].fontInfo.richText=e,this.setDirty()}get isLabel(){return!0}get fontWeight(){return this[iq].fontInfo.fontWeight}set fontWeight(e){this[iq].fontInfo.fontWeight=e,this.setDirty()}}aq.canvasRenderer=null;var sq=Symbol("private"),oq=[1,1,1],lq=Le.toText("129,141,38,43,110,33"),uq={isResident:!0};class cq extends mj{constructor(e){void 0===e&&(e={}),super(e),this[sq]={};var t=this[sq];t.iframeComponent=null,t.domScale=[1,1],t.style=null,t.regionNode=null,t.renderableNode=null,t.renderableNodeOpacity=0,t.iframeComponent=BI.createObject("WebViewComponent"),this.addComponent(t.iframeComponent,"iframe",uq),t.iframeComponent.url=BI.parseValue(e.url,""),t.iframeComponent.domWidth=BI.parseValue(e.domWidth,1920),t.iframeComponent.domHeight=BI.parseValue(e.domHeight,1080),t.iframeComponent.interactive=BI.parseValue(e.interactive,!1),t.iframeComponent.enableEventProxy=!0,this._registerEvents();var r=BI.createObject("Style");r.setTransparent(!1),r.setSideType("Double"),r.setBlendingType("NoBlending"),r.setOpacityOp((()=>t.renderableNodeOpacity)),r.setColorOp((()=>[0,0,0])),t.style=r,t.regionNode=BI.createObject("Node"),this.bodyNode.add(t.regionNode),this._createRenderableNode(),this.renderType=BI.parseValue(e.renderType,kB.Plane),e.domScale&&(this.domScale=e.domScale)}_updateRgionNodeScale(){var e=this[sq];BI.isArray(e.domScale)?(oq[0]=e.domScale[0],oq[1]=e.domScale[1]):(oq[0]=this.domWidth*e.domScale,oq[1]=this.domHeight*e.domScale),e.regionNode.setScale(oq)}_createRenderableNode(){var e=this[sq];this.app.global.waitForComplete().then((()=>{e.renderableNode&&(e.renderableNode.dispose(),e.renderableNode=null),this.renderType==kB.Plane?e.renderableNode=this.app.global.cache.models.plane.clone():e.renderableNode=BI.createObject(lq),e.renderableNode.setAttribute("SkipParentStyleChange",!0),e.renderableNode.setStyle(e.style);var t=.995;e.renderableNode.setScale([t,t,t]),e.renderableNode.setVisible(!0),e.regionNode.add(e.renderableNode),this._updateRgionNodeScale(),e.iframeComponent.regionNode=e.regionNode}))}_registerEvents(){this.on("mousemove",(e=>{this.app.camera.control.stop()}))}getRenderableNodeOpacity(){return this[sq].renderableNodeOpacity}setRenderableNodeOpacity(e){var t=this[sq];t.renderableNodeOpacity=e,t.renderableNode&&t.renderableNode.getStyle().setOpacityOp((()=>t.renderableNodeOpacity))}get regionNode(){return this[sq].regionNode}get renderableNode(){return this[sq].renderableNode}get iframeComponent(){return this[sq].iframeComponent}get renderType(){return this[sq].iframeComponent.renderType}set renderType(e){var t=this[sq];t.iframeComponent.renderType!=e&&(t.iframeComponent.renderType=e,this._createRenderableNode())}get url(){return this[sq].iframeComponent.url}set url(e){this[sq].iframeComponent.url=e}get domWidth(){return this[sq].iframeComponent.domWidth}set domWidth(e){this[sq].iframeComponent.domWidth=e}get domHeight(){return this[sq].iframeComponent.domHeight}set domHeight(e){this[sq].iframeComponent.domHeight=e}get domScale(){return this[sq].domScale}set domScale(e){var t=this[sq];BI.isArray(e)?t.domScale=e.slice(0):t.domScale=e,t.regionNode&&this._updateRgionNodeScale()}get interactive(){return this[sq].iframeComponent.interactive}set interactive(e){this[sq].iframeComponent.interactive=e}get isWebView(){return!0}}var hq=Symbol("private");class dq extends JV{constructor(e){void 0===e&&(e={}),super(e),this._offset=this._offset||null,this[hq]={},this[hq].object=null,this._getRootNode().add(this.node),this._offset||(this._offset=this.parent.worldToSelf(this.position))}_getRootNode(){var e=this.app.scene;return e?e.rootObjects.attachedPoint.node:null}onLoadResource(e,t,r){t()}onUpdate(e){this.position=this.parent.selfToWorld(this._offset),super.onUpdate(e)}onAddToParentNode(e,t,r){t.add(e)}onSetParent(e){super.onSetParent(e,(()=>{this._offset&&(this._offset=e.worldToSelf(this.position))}))}get localPosition(){return this._offset}set localPosition(e){this._offset=e.slice(0)}get isAttachedPoint(){return!0}}dq.defaultTagArray=["Dummy"];class pq extends mj{constructor(e){void 0===e&&(e={}),super(e)}onBeforeSetup(e){e.renderableNode=e.renderableNode||BI.createObject("Lensflare"),super.onBeforeSetup(e)}get occlusionScale(){return this.bodyNode.getOcclusionScale()}set occlusionScale(e){this.bodyNode.setOcclusionScale(e)}addElement(e){e.imageTexture=e.imageTexture.getTextureResource(),this.bodyNode.addElement(e)}removeElement(e){this.bodyNode.removeElement(e)}clearElements(){this.bodyNode.clearElements()}getAllElements(){return this.bodyNode.getAllElements()}get isLensflare(){return!0}}class fq{constructor(e){}onEnter(e){}onLeave(){}get app(){return BI.getCurrentApp()}}var mq={private:Symbol("private")};function gq(e){return!e._startsWith("http://")&&!e._startsWith("https://")}function _q(e,t){var r=e.url;r&&t({url:r});var n=e.children;n&&n.forEach((e=>{_q(e,t)}))}var vq=yB("collectUUID"),yq=yB("collectModel"),xq=yB("getModelVersion"),bq=yB("buildModels"),Aq=yB("exportBody");class Sq{constructor(){Object.defineProperty(this,Aq,{value:Dq}),Object.defineProperty(this,bq,{value:Tq}),Object.defineProperty(this,xq,{value:Cq}),Object.defineProperty(this,yq,{value:wq}),Object.defineProperty(this,vq,{value:Eq}),this[mq.private]={};var e=this[mq.private];e.models=new Map,e.uuids=[],e.options={}}begin(e){void 0===e&&(e={});var t=this[mq.private];t.models.clear(),t.uuids.length=0,t.options=Object.assign({},e),t.options.externalComponents=BI.parseValue(t.options.externalComponents,!0)}end(){}collectObject(e){_B(this,vq)[vq](e),_B(this,yq)[yq](e)}getResources(){var e=this[mq.private],t=e.options.rootPath||{model:"http://model.3dmomoda.com/models",texture:"http://static.3dmomoda.com/textures"};return{rootPath:t,models:_B(this,bq)[bq](t.model),uuids:e.uuids}}buildObject(e){var t=this[mq.private],r={};BI.setAttributeIfExist(r,"type",e),BI.setAttributeIfExist(r,"id",e,(e=>""!=e)),BI.setAttributeIfExist(r,"name",e,(e=>""!=e)),BI.setAttributeIfExist(r,"position",e,(e=>0!=e[0]||0!=e[1]||0!=e[2]),"localPosition"),BI.setAttributeIfExist(r,"scale",e,(e=>1!=e[0]||1!=e[1]||1!=e[2]),"localScale"),BI.setAttributeIfExist(r,"quaternion",e,(e=>0!=e[0]||0!=e[1]||0!=e[2]||1!=e[3]),"localQuaternion"),BI.setAttributeIfExist(r,"userData",e,(e=>!!Object.keys(e).length)),BI.setAttributeIfExist(r,"tags",e,(e=>!!e.length));var n=t.uuids.indexOf(e.uuid);if(-1!==n&&(r.uuid=n),e.body.style){var i=function(e){var t=e.body.style.getDiffValues();return BI.isEmptyObject(t)?null:t}(e);i&&(r.style=function(e){var t=e.images;if(t){for(var r in t){var n=t[r].url;n&&(e[r]=n)}delete e.images}return e}(i))}var a=e.onExportComponents(t.options);if(a&&a.length&&(r.components=a),t.options.externalComponents){var s=e.onExportExternalComponents();s&&(r.externalComponents=s)}var o=_B(this,Aq)[Aq](e.resource);BI.isEmptyObject(o)||(r.body=o);var l=e.onExportExternalData();return l&&(r.external=l),r}}function Eq(e){e.isSubObject||this[mq.private].uuids.push(e.uuid)}function wq(e){if(e.onCollectMesh()){var t=e.resource;if(t){var r=this[mq.private];_q(t,(t=>{var n=t.url;if(!r.models.get(n)){var i={index:r.models.size,local:gq(n)},a=e.body.getLocalBoundingBox().halfSize;a&&(i.size=QI.scaleVector(a,2)),r.models.set(n,i)}}))}}}function Cq(e){for(var t=e.split("/"),r=1;r<t.length;r++){var n=t[r],i=Number(n);if(!isNaN(i))return i}return 0}function Tq(e){var t=this[mq.private],r=[];return t.models.forEach(((t,n)=>{if(n._startsWith("."))r.push({url:n,size:t.size,local:t.local});else{n._startsWith(e)&&(n=n._replaceAll(e,"")._trimLeft("/")._getRootPath());var i={url:n,version:_B(this,xq)[xq](n),size:t.size,local:t.local};r.push(i)}})),r}function Dq(e){var t=this[mq.private],r={},n=e.localPosition;n&&(r.position=n);var i=e.localAngles;i&&(r.quaternion=QI.getQuatFromAngles(i));var a=e.localScale;a&&(r.scale=a);var s=t.models.get(e.url);s&&(r.id=s.index);var o=e.children;return o&&(r.children=[],o.forEach((e=>{r.children.push(_B(this,Aq)[Aq](e))}))),r}var Mq=Symbol("private");class Pq{constructor(){this[Mq]={},this[Mq].sceneExporter=new Sq}_exportObjects(e,t){var r=this[Mq],n=t.onGetParentId||function(e){return e.uuid},i=[];return e.forEach((e=>{var t=r.sceneExporter.buildObject(e);t.external=t.external||{},t.external.parent=n(e.parent),i.push(t)})),i}output(e,t){void 0===t&&(t={});var r=this[Mq],n={version:"1.0.0"};n.id=QI.generateUUID();var i=r.sceneExporter;return i.begin(t),e.forEach((e=>{i.collectObject(e)})),n.objects=this._exportObjects(e,t),n.resources=i.getResources(),i.end(),n}}var Fq=Symbol("private");class Rq{constructor(){this[Fq]={},this[Fq].sceneExporter=new Sq}_exportRootObject(e,t){var r=this[Fq].sceneExporter.buildObject(t),n=["type","position","quaterion","scale"];for(var i in r)-1===n.indexOf(i)&&(e[i]=r[i])}_exportObjects(e,t){if(!function(e,t){var r=BI.parseValue(t.lights,!1),n=BI.parseValue(t.camera,!1);return!(e.isSubObject||!r&&e.isLight||!n&&e.isCamera)}(e,t))return null;var r=this[Fq].sceneExporter.buildObject(e);if(e.children.length){var n=[];e.children.forEach((e=>{var r=this._exportObjects(e,t);r&&n.push(r)})),n.length&&(r.children=n)}return r}output(e,t){void 0===t&&(t={});var r=this[Fq],n=t.includeSelf,i={version:"1.0.0"};i.id=QI.generateUUID();var a=r.sceneExporter;a.begin(t),n&&a.collectObject(e),e.children.traverse((e=>{a.collectObject(e)})),n&&this._exportRootObject(i,e);var s=this._exportObjects(e,t);return i.children=s.children,i.resources=a.getResources(),a.end(),i}}var Nq=Symbol("private");class Bq{constructor(e){void 0===e&&(e={}),this[Nq]={};var t=this[Nq];t.app=BI.getCurrentApp();var r=this._checkObject(e.source),n=this._checkObject(e.target);this._type=e.type,this._name=BI.parseValue(e.name,""),this._source=r,this._target=n,this._uuid=e.uuid||QI.generateUUID(),this._queryDirection=BI.parseValue(e.queryDirection,dI.Out),t.app.relationshipManager.addRelationship(this)}_checkObject(e){return BI.isNull(e)?null:e.isSelector?[...new Set(e.objects)]:BI.isArray(e)?[...new Set(e)]:e.isBaseObject?e:(BI.error("The object is not an allowed value."),null)}test(e){void 0===e&&(e={});var t=e.type,r=e.name;return t?r?this.type==t&&this.name==r:this.type==t:!!r&&this.name==r}queryObjects(e,t){var r=this.target,n=this.source,i=new hk;switch(t=BI.parseValue(t,this.queryDirection)){case dI.Out:this._includeObject(n,e)&&i.push(r);break;case dI.In:this._includeObject(r,e)&&i.push(n);break;case dI.InOut:this._includeObject(n,e)&&i.push(r),this._includeObject(r,e)&&i.push(n);break;case dI.None:this._includeObject(n,e)&&i.push(n),this._includeObject(r,e)&&i.push(r)}return i}_includeObject(e,t){return!BI.isNull(e)&&(BI.isArray(e)?e.includes(t):e.isBaseObject?e==t:void 0)}onDestroy(){this[Nq].app.relationshipManager.removeRelationship(this)}destroy(){this.onDestroy(),this._type=null,this._name=null,this._uuid=null,this._source=null,this._target=null,this._queryDirection=null}releaseObject(e){var t=this.source,r=this.target;e==r?this.destroy():BI.isArray(r)&&-1!==r.indexOf(e)?(BI.removeFromArray(r,e),(0==r.length||r.length<=1&&!t)&&this.destroy()):e==t?this.destroy():BI.isArray(t)&&-1!==t.indexOf(e)&&(BI.removeFromArray(t,e),(0==t.length||t.length<=1&&!r)&&this.destroy())}get type(){return this._type}set type(e){this._type=e}get name(){return this._name}set name(e){this._name=e}get uuid(){return this._uuid}set uuid(e){this._uuid=e}get source(){return this._source}set source(e){var t=this[Nq];e=this._checkObject(e),t.app.relationshipManager.notifyObjectRemoveRelationship(this._source,this),t.app.relationshipManager.notifyObjectAddRelationship(e,this),this._source=e}get target(){return this._target}set target(e){var t=this[Nq];e=this._checkObject(e),t.app.relationshipManager.notifyObjectRemoveRelationship(this._target,this),t.app.relationshipManager.notifyObjectAddRelationship(e,this),this._target=e}get queryDirection(){return this._queryDirection}set queryDirection(e){this._queryDirection=e}}var Iq=null;function Oq(e,t){if(Iq)return Iq;BI.loadFile(e,{load:function(){if(void 0!==THING.DEBUG){if(BI.addFactory(new THING.DEBUG.Factory,"thing.debugger.factory"),t.onError=t.onError||function(e){BI.onError(e),t.breakOnError&&BI._break()},t.getASelector=function(){return new THING.Selector},Iq=new THING.DEBUG.AppDebugger(t),!(t.profile||!1)){var e=t.devtools||!1;Iq.load(e)}}else BI.error("Load debugger factory failed")},error:function(e){BI.onError(e)}})}var kq=function(e){void 0===e&&(e={});var t=function(e){e=e||"";var t,r=BI.getCurrentApp().view.getAttribute("RendererType");return"T3D"===r?t=[e._appendPath("thing.debugger.js"),e._appendPath("thing.t3d.debugger.js")]:"THREE"===r&&(t=[e._appendPath("thing.debugger.js"),e._appendPath("thing.three.debugger.js")]),t}(e.rootPath||"https://thingjs-static.oss-cn-beijing.aliyuncs.com/debugger2/");Oq(t,e)};var Lq=function(e){void 0===e&&(e={}),Oq(function(){var e,t=BI.getCurrentApp().view.getAttribute("RendererType");return"T3D"===t?e=["./js/thing.debugger.dist/thing.debugger.js","./js/thing.t3d.debugger.dist/thing.t3d.debugger.js"]:"THREE"===t&&(e=["./js/thing.debugger.dist/thing.debugger.js","./js/thing.three.debugger.dist/thing.three.debugger.js"]),e}(),e)},Uq=mj,zq="2.5.3",jq="Mon, 05 Jun 2023 06:13:00 GMT";void 0!==bB&&(bB.className="System"),void 0!==OI&&(OI.className="ThreadWorker"),void 0!==kI&&(kI.className="BaseState"),void 0!==jI&&(jI.className="TinyQueue"),void 0!==aO&&(aO.className="ObjectExpression"),void 0!==oO&&(oO.className="AsyncSelector"),void 0!==ek&&(ek.className="Style"),void 0!==nk&&(nk.className="StyleSelector"),void 0!==ak&&(ak.className="InheritSelector"),void 0!==hk&&(hk.className="Selector"),void 0!==fk&&(fk.className="ActionManager"),void 0!==_k&&(_k.className="DynamicSelector"),void 0!==vk&&(vk.className="BaseComponent"),void 0!==Sk&&(Sk.className="Component"),void 0!==Ck&&(Ck.className="BaseComponentGroup"),void 0!==Dk&&(Dk.className="BaseHelper"),void 0!==Mk&&(Mk.className="BaseBoxHelper"),void 0!==Fk&&(Fk.className="ObjectBoxHelper"),void 0!==Rk&&(Rk.className="ObjectOrientedBoxHelper"),void 0!==Bk&&(Bk.className="HelperComponent"),void 0!==Vk&&(Vk.className="BoundingComponent"),void 0!==Hk&&(Hk.className="ModelAnimationComponent"),void 0!==aL&&(aL.className="TransformComponent"),void 0!==fL&&(fL.className="RenderComponent"),void 0!==_L&&(_L.className="LevelComponent"),void 0!==SL&&(SL.className="ActionQueue"),"undefined"!=typeof ActionProcessor&&(ActionProcessor.className="ActionProcessor"),void 0!==wL&&(wL.className="ActionGroupComponent"),void 0!==jL&&(jL.className="LerpComponent"),void 0!==GL&&(GL.className="BlueprintComponent"),void 0!==XL&&(XL.className="DynamicLoadComponent"),void 0!==xU&&(xU.className="CameraControlComponent"),void 0!==SU&&(SU.className="BaseResource"),void 0!==wU&&(wU.className="BaseTexture"),void 0!==CU&&(CU.className="BaseImageTexture"),void 0!==TU&&(TU.className="CubeTexture"),"undefined"!=typeof ImageTexture&&(ImageTexture.className="ImageTexture"),void 0!==PU&&(PU.className="CameraResourceControllerComponent"),void 0!==RU&&(RU.className="CameraPostEffectComponent"),void 0!==OU&&(OU.className="CameraPickerComponent"),void 0!==kU&&(kU.className="AppHelperComponent"),void 0!==UU&&(UU.className="ModelResourceComponent"),void 0!==GU&&(GU.className="LevelManager"),void 0!==WU&&(WU.className="CameraTransformComponent"),void 0!==qU&&(qU.className="CameraLerpComponent"),void 0!==QU&&(QU.className="BaseLineSegmentsHelperComponent"),void 0!==$U&&($U.className="CameraHelperComponent"),void 0!==nz&&(nz.className="CameraBoundingComponent"),void 0!==sz&&(sz.className="CameraEffectComponent"),void 0!==lz&&(lz.className="CameraFogComponent"),void 0!==cz&&(cz.className="CameraControlEventDispatcherComponent"),void 0!==hz&&(hz.className="BaseStaticTexture"),void 0!==pz&&(pz.className="RenderTexture"),void 0!==Ez&&(Ez.className="BaseObject"),void 0!==Nz&&(Nz.className="NodeObject"),void 0!==Bz&&(Bz.className="StyleModifier"),void 0!==Gz&&(Gz.className="BodyObject"),void 0!==Hz&&(Hz.className="ObjectColliderBoxHelper"),void 0!==qz&&(qz.className="BaseSphereHelper"),void 0!==Qz&&(Qz.className="ObjectColliderSphereHelper"),void 0!==aj&&(aj.className="ColliderComponent"),void 0!==oj&&(oj.className="RelationshipComponent"),void 0!==mj&&(mj.className="Object3D"),void 0!==Sj&&(Sj.className="Camera"),void 0!==Mj&&(Mj.className="BaseTextureManager"),void 0!==Rj&&(Rj.className="TextureManager"),void 0!==Bj&&(Bj.className="CompressedTextureManager"),void 0!==Oj&&(Oj.className="BlueprintManager"),void 0!==Gj&&(Gj.className="StyleGroupPool"),void 0!==Yj&&(Yj.className="ResourceManager"),void 0!==pV&&(pV.className="EventTrigger"),void 0!==_V&&(_V.className="EventManager"),void 0!==yV&&(yV.className="ObjectManager"),void 0!==EV&&(EV.className="TweenManager"),void 0!==wV&&(wV.className="BaseAction"),void 0!==CV&&(CV.className="CreateObjectAction"),void 0!==TV&&(TV.className="CameraFlyToAction"),void 0!==DV&&(DV.className="ObjectSetColorAction"),void 0!==PV&&(PV.className="StateManager"),void 0!==RV&&(RV.className="FPSTimer"),void 0!==BV&&(BV.className="ColliderManager"),void 0!==OV&&(OV.className="RelationshipManager"),void 0!==LV&&(LV.className="AppTimerComponent"),void 0!==WV&&(WV.className="SceneObjectParser"),void 0!==qV&&(qV.className="SceneLayoutParser"),void 0!==KV&&(KV.className="SceneLoader"),void 0!==ZV&&(ZV.className="DirectionalLightHelperComponent"),void 0!==JV&&(JV.className="BaseTickableObject3D"),void 0!==$V&&($V.className="BaseLight"),void 0!==tG&&(tG.className="ShadowLightTransformComponent"),void 0!==nG&&(nG.className="LightAdapterComponent"),void 0!==aG&&(aG.className="ShadowLightAdapterComponent"),void 0!==lG&&(lG.className="BaseShadowLight"),void 0!==cG&&(cG.className="DirectionalLight"),void 0!==hG&&(hG.className="HemisphereLight"),void 0!==_G&&(_G.className="SceneModelLoader"),void 0!==yG&&(yG.className="AppResourcePoolComponent"),void 0!==xG&&(xG.className="AppRenderConfigComponent"),void 0!==AG&&(AG.className="Picker"),void 0!==SG&&(SG.className="EmptyTexture"),void 0!==CG&&(CG.className="Global"),void 0!==DG&&(DG.className="RootObject"),void 0!==MG&&(MG.className="AmbientLight"),void 0!==NG&&(NG.className="Scene"),void 0!==UG&&(UG.className="Logo"),void 0!==VG&&(VG.className="ParticleEmitter"),void 0!==GG&&(GG.className="ParticleGroup"),void 0!==WG&&(WG.className="ParticleSystem"),void 0!==HG&&(HG.className="EffectGroundObject"),void 0!==QG&&(QG.className="ThemeManager"),void 0!==wW&&(wW.className="App"),void 0!==LW&&(LW.className="VideoTexture"),void 0!==zW&&(zW.className="GeometryResource"),void 0!==VW&&(VW.className="MaterialResource"),void 0!==GW&&(GW.className="BaseTickableObject"),void 0!==WW&&(WW.className="BaseContainer3D"),void 0!==HW&&(HW.className="BaseModelObject3D"),void 0!==QW&&(QW.className="BaseEntity"),void 0!==KW&&(KW.className="Entity"),void 0!==YW&&(YW.className="Thing"),void 0!==tH&&(tH.className="SpaceRelationComponent"),void 0!==nH&&(nH.className="SpaceHelperComponent"),void 0!==uH&&(uH.className="Space3D"),void 0!==hH&&(hH.className="Grid"),void 0!==pH&&(pH.className="Box"),void 0!==mH&&(mH.className="Plane"),void 0!==_H&&(_H.className="Sphere"),void 0!==yH&&(yH.className="Mesh"),void 0!==xH&&(xH.className="MeshBuilder"),void 0!==bH&&(bH.className="Torus"),void 0!==AH&&(AH.className="Cylinder"),void 0!==SH&&(SH.className="Circle"),void 0!==EH&&(EH.className="Capsule"),void 0!==PH&&(PH.className="ClippingPlanes"),void 0!==FH&&(FH.className="SpotLightHelperComponent"),void 0!==NH&&(NH.className="SpotLight"),void 0!==BH&&(BH.className="BasePoints"),void 0!==IH&&(IH.className="BaseDynamicPoints"),void 0!==kH&&(kH.className="BaseLine"),void 0!==LH&&(LH.className="PixelLine"),void 0!==UH&&(UH.className="FatLine"),void 0!==zH&&(zH.className="RouteLine"),void 0!==jH&&(jH.className="PolygonLine"),void 0!==VH&&(VH.className="PixelLineSegments"),void 0!==GH&&(GH.className="Points"),void 0!==HH&&(HH.className="ExtrudeShape"),void 0!==qH&&(qH.className="PlanePointsHelperComponent"),void 0!==QH&&(QH.className="BasePlanePoints"),void 0!==YH&&(YH.className="Water"),void 0!==JH&&(JH.className="PlaneRegion"),void 0!==tq&&(tq.className="Marker"),void 0!==nq&&(nq.className="CanvasRenderer"),void 0!==aq&&(aq.className="Label"),void 0!==cq&&(cq.className="WebView"),void 0!==dq&&(dq.className="AttachedPoint"),void 0!==pq&&(pq.className="Lensflare"),void 0!==fq&&(fq.className="BaseLevelControl"),void 0!==Sq&&(Sq.className="SceneExporter"),void 0!==Pq&&(Pq.className="SceneLayoutExporter"),void 0!==Rq&&(Rq.className="SceneObjectExporter"),void 0!==Bq&&(Bq.className="Relationship");var Vq=Object.freeze({__proto__:null,ActionGroupComponent:wL,ActionQueueType:sI,ActionType:fI,AlignType:IB,AmbientLight:MG,AnimationDirectionType:HB,App:wW,AppHelperComponent:kU,AttachedPoint:dq,AxisType:FB,BaseAction:wV,BaseComponent:vk,BaseComponentGroup:Ck,BaseContainer3D:WW,BaseDynamicPoints:IH,BaseEntity:QW,BaseLevelControl:fq,BaseLight:$V,BaseLine:kH,BaseModelObject3D:HW,BaseObject:Ez,BaseObject3D:Uq,BasePoints:BH,BaseState:kI,BaseTickableObject:GW,BaseTickableObject3D:JV,BlendingType:KB,BlueprintComponent:GL,BoundingComponent:Vk,Box:pH,BoxHelperModeType:QB,COMPILETIME:jq,Camera:Sj,CameraControlComponent:xU,CameraPickerComponent:OU,CameraPostEffectComponent:RU,CameraResourceControllerComponent:PU,CanvasRenderer:nq,Capsule:EH,Circle:SH,ClippingPlanes:PH,CodeType:DB,ColliderType:oI,Component:Sk,CubeTexture:TU,Cylinder:AH,DirectionalLight:cG,DynamicLoadComponent:XL,DynamicSelector:_k,EffectGroundObject:HG,Empty:cI,EmptyTexture:SG,Entity:KW,EventDispatcher:Ut,EventType:SB,ExtrudeShape:HH,FatLine:UH,FilterResultType:pI,Flags:Wt,FogType:VB,FontWeight:hI,GeometryResource:zW,Grid:hH,HelperComponent:Bk,HemisphereLight:hG,ImageColorFormat:$B,ImageCompressionType:eI,ImageFilterType:nI,ImageMappingType:rI,ImageSlotType:JB,ImageTexture:DU,ImageWrapType:tI,InheritActionType:XB,InheritType:qB,KeyCodeType:MB,Label:aq,Lensflare:pq,LerpComponent:jL,LerpType:EB,LevelComponent:_L,LevelManager:GU,LightSphereModeType:aI,LoopType:wB,Marker:tq,MaterialResource:VW,Math:QI,MathUtils:QI,Mesh:yH,MeshBuilder:xH,ModelAnimationComponent:Hk,ModelResourceComponent:UU,MouseButtonType:CB,NodeUserDataType:AB,Object3D:mj,ObjectProxy:ur,PRO:false,ParticleEmitter:VG,ParticleGroup:GG,ParticleSystem:WG,PickMode:jB,PickType:zB,Picker:AG,PivotMode:LB,PivotModeType:UB,PixelLine:LH,PixelLineSegments:VH,Plane:mH,PlaneRegion:JH,PlayState:GB,PlayStateType:WB,Points:GH,PolygonLine:jH,ProjectionType:RB,RandomGenerator:ko,Relationship:Bq,RelationshipDirection:dI,RenderComponent:fL,RenderTexture:pz,RenderType:kB,ResolvablePromise:Rt,ResourceType:lI,RootObject:DG,RotationOrdersType:PB,RouteLine:zH,Scene:NG,SceneLayoutExporter:Pq,SceneLoader:KV,SceneObjectExporter:Rq,SceneResourceType:uI,Selector:hk,ShadowQualityType:iI,SideType:OB,Space3D:uH,SpaceType:TB,Sphere:_H,SpotLight:NH,Style:ek,Thing:YW,ThreadWorker:OI,Torus:bH,TransformComponent:aL,TypeChecker:Lo,UVMode:YB,UVModeType:ZB,Utils:BI,VERSION:zq,VideoTexture:LW,ViewMode:NB,ViewModeType:BB,Water:YH,WebView:cq,loadDebugger:kq,loadLocalDebugger:Lq}),Gq=window.THING;function Wq(e,t,r,n,i,a,s){try{var o=e[a](s),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,i)}function Hq(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){Wq(a,n,i,s,o,"next",e)}function o(e){Wq(a,n,i,s,o,"throw",e)}s(void 0)}))}}function qq(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}we.registerClasses(Vq,Gq),window.BASE=window.BASE||{},window.BASE.THING=window.BASE.THING||{},we.registerClasses(gc,window.BASE.THING),window.THING=Gq;var Xq=0;function Qq(e){return"__private_"+Xq+++"_"+e}var Kq={},Yq={},Zq=1;window.__loadCodeComplete=function(e){Yq[e]={result:!0}},window.__catchError=function(e,t){Yq[e]={result:!1,error:t}};var Jq=function(e){var t="mark_"+e+"_start",r="mark_"+e+"_end";return window.performance.measure(e,t,r),function(e){var t=window.performance.getEntriesByName(e),r=t[t.length-1];return r&&"measure"===r.entryType?r.duration:-1}(e)},$q=window.performance&&!!window.performance.getEntriesByType&&!!window.performance.now&&!!window.performance.mark,eX=function(e){return-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime()},tX=function(e,t,r){for(var n=document.getElementsByTagName(e),i=0;i<n.length;i++){var a=n[i];if(a){var s=a.getAttribute(t);if(s)s._removeSearchName()==r&&(a.parentNode.removeChild(a),i--)}}};function rX(e,t,r,n){tX("script","src",e),t||(e=eX(e));var i=document.createElement("script");i.type="text/javascript",i.src=e,i.onload=function(){r&&r({script:i})},i.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||r&&r({script:i})},i.onerror=function(){n&&n()},document.getElementsByTagName("head")[0].appendChild(i)}function nX(e,t,r,n){tX("link","href",e),t||(e=eX(e));var i=document.getElementsByTagName("head")[0],a=document.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=e,i.appendChild(a),a.onreadystatechange=function(){"complete"==css.readyState&&r&&r()},a.onload=function(){r&&r()},a.onerror=function(){n&&n()}}var iX=function(e,t,r,n){if(e){var i,a=e._getExtension();"js"==a?i=rX:"css"==a&&(i=nX),i&&i(e,t,r,n)}},aX=Qq("options");let sX=class e extends we{static init(t){void 0===t&&(t={}),qq(e,aX)[aX]=e.cloneObject(t,!1)}static getOptions(){return qq(e,aX)[aX]}static parseCSSColor(t,r){if(e.isNull(t))return r;if(e.isString(t)&&t._startsWith("#"))return t;var n=e.parseColor(t,r);return"#"+("000000"+(255*n[0]<<16^255*n[1]<<8^255*n[2]<<0).toString(16)).slice(-6)}static parseMouseEventType(e,t){var r=t||e.type;switch(r){case"pointerdown":r="mousedown";break;case"pointermove":r="mousemove";break;case"pointerup":r="mouseup"}return r}static buildKeyboardEvent(t){var r;return r=t.key>="a"&&t.key<="z"?e.atoi(t.key):t.keyCode||t.which||t.charCode,{type:t.type,keyCode:r,code:t.code,location:t.location,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey}}static buildMouseEvent(t,r,n,i){var a=i||e.getMousePosition(t,r),s={type:e.parseMouseEventType(r,n),x:a.x,y:a.y,button:r.button||0,buttons:r.buttons||0,altKey:r.altKey,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey};return e.isValid(r.pointerId)&&(s.pointerId=r.pointerId),e.isValid(r.pointerType)&&(s.pointerType=r.pointerType),s}static buildTouchEvent(t,r){for(var n=function(t,n){var i=e.getMousePosition(t,n);return{identifier:n.identifier,force:n.force,x:i.x,y:i.y,altKey:r.altKey,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey}},i={type:r.type,altKey:r.altKey,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey,changedTouches:[]},a=0;a<r.changedTouches.length;a++){var s=r.changedTouches[a];i.changedTouches.push(n(t,s))}i.targetTouches=[];for(var o=0;o<r.targetTouches.length;o++){var l=r.targetTouches[o];i.targetTouches.push(n(t,l))}i.touches=[];for(var u=0;u<r.touches.length;u++){var c=r.touches[u];i.touches.push(n(t,c))}return i}static getMousePosition(e,t,r){var n,i;if(e){var a=e.currentStyle||window.getComputedStyle(e,null),s=r?r[0]:parseInt(a.borderLeftWidth,10),o=r?r[1]:parseInt(a.borderTopWidth,10),l=e.getBoundingClientRect();n=t.clientX-s-l.left,i=t.clientY-o-l.top}else t.layerX||0==t.layerX?(n=t.layerX,i=t.layerY):t.offsetX||0==t.offsetX?(n=t.offsetX,i=t.offsetY):(t.clientX||0==t.clientX)&&(n=t.clientX,i=t.clientY);return{x:Math.round(n),y:Math.round(i)}}static startMark(e){$q&&window.performance.mark("mark_"+e+"_start")}static endMark(e){if($q)return window.performance.mark("mark_"+e+"_end"),Jq(e)}static resolveURL(e){if(void 0===e&&(e=""),e._startsWith("http"))return e;if(e._startsWith("/"))return window.location.origin+e;e._startsWith("./")&&(e=e.substring(2));var t,r,n=window.location.origin,i=window.location.pathname;return r=(t=n+i).indexOf("\\")>=0?t.lastIndexOf("\\"):t.lastIndexOf("/"),t.substring(0,r)+"/"+e}static getUserAngent(){return window.navigator?navigator.userAgent.toLowerCase():""}static isDom(e){return"object"==typeof e&&"number"==typeof e.nodeType&&"object"==typeof e.ownerDocument}static isMobileDevice(){var e=this.getUserAngent();return-1!=e.indexOf("mobile")||-1!=e.indexOf("android")||-1!=e.indexOf("iphone")}static loadImage(e,t,r){var n=document.createElementNS("http://www.w3.org/1999/xhtml","img");function i(){n.removeEventListener("load",i,!1),n.removeEventListener("error",a,!1),t&&t(this)}function a(e){n.removeEventListener("load",i,!1),n.removeEventListener("error",a,!1),r&&r(e)}return n.crossOrigin="anonymous",n.addEventListener("load",i,!1),n.addEventListener("error",a,!1),n.src=e,n}static imageToBase64(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")}static base64ToImage(e){var t=new Image;return t.src=e,t}static loadBitmapImageFromBase64Async(e){var t=function(e){for(var t=e.split(",")[0].split(":")[1].split(";")[0],r=atob(e.split(",")[1]),n=new ArrayBuffer(r.length),i=new Uint8Array(n),a=0;a<r.length;a++)i[a]=r.charCodeAt(a);return new Blob([i],{type:t})}(e);return createImageBitmap(t,{imageOrientation:"flipY"})}static loadBitmapImageFromUrlAsync(e,t){return void 0===t&&(t=Kq),new Promise(Hq((function*(r,n){try{var i=yield fetch(e,{mode:"cors"}),a=yield i.blob(),s={premultiplyAlpha:"none",colorSpaceConversion:"none"};t.flipY&&(s.imageOrientation="flipY"),t.premultiplyAlpha&&(s.premultiplyAlpha="premultiply"),r(yield createImageBitmap(a,s))}catch(e){n(e)}})))}static canvasToDataURL(e,t,r){return e.toDataURL(t||"image/jpeg",r||1)}static dataURLToCanvas(e,t){var r=document.createElement("CANVAS"),n=r.getContext("2d"),i=new Image;i.onload=function(){r.width=i.width,r.height=i.height,n.drawImage(i,0,0),t(r)},i.src=e}static imageToCanvas(e,t){var r=document.createElement("CANVAS"),n=r.getContext("2d"),i=new Image;i.src=e,i.onload=function(){r.width=i.width,r.height=i.height,n.drawImage(i,0,0),t(r)}}static canvasToImage(e){var t=new Image;return t.src=e.toDataURL("image/jpeg",1),t}static fileOrBlobToDataURL(e,t){var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){t(e.target.result)}}static dataURLToBlob(e){for(var t=e.split(","),r=t[0].match(/:(.*?);/)[1],n=atob(t[1]),i=n.length,a=new Uint8Array(i);i--;)a[i]=n.charCodeAt(i);return new Blob([a],{type:r})}static blobToImage(t,r){e.fileOrBlobToDataURL(t,(function(e){var t=new Image;t.src=e,r(t)}))}static imageToBlob(t,r){e.imageToCanvas(t,(function(t){r(e.dataURLToBlob(e.canvasToDataURL(t)))}))}static blobToCanvas(t,r){e.fileOrBlobToDataURL(t,(function(t){e.dataURLToCanvas(t,r)}))}static canvasToBlob(t,r){r(e.dataURLToBlob(e.canvasToDataURL(t)))}static imageToDataURL(t,r){e.imageToCanvas(t,(function(t){r(e.canvasToDataURL(t))}))}static dataURLToImage(e){var t=new Image;return t.src=e,t}static dataToImage(e,t){var r=new Image;return r.src=URL.createObjectURL(new Blob([t.buffer],{type:"image/"+e})),r}static loadJSCode(e,t){void 0===t&&(t={});try{var r=t.es6Mode,n=t.onLoad||t.load,i=t.onError||t.error,a=document.createElement("script");if(r){var s=t.sourceURL||zu.generateUUID(),o="//# sourceURL="+(s+="_"+Zq++)+"\n";o+="try { \n",o+=e,o+="\n\n__loadCodeComplete('"+s+"');\n",o+="} \n catch (ex) { \n __catchError('"+s+"', ex); }",a.type="module",a.text=o,document.head.appendChild(a);var l=setInterval((()=>{var e=Yq[s];e&&(clearInterval(l),e.result?n&&n():i&&i(e.error),delete Yq[s])}),5)}else a.onload=function(){n&&n()},a.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||n&&n()},a.onerror=function(){i&&i()},a.type="text/javascript",a.src="data:text/javascript;charset=utf-8,"+escape(e),document.head.appendChild(a)}catch(e){console.error(e)}}static loadFile(t,r){void 0===r&&(r={});var n=e.parseValue(r.cache,!0),i=e.parseValue(r.inOrder,!0),a=e.parseValue(r.onLoad,r.load),s=e.parseValue(r.onError,r.error),o=[];if(e.isArray(t)?o=t:e.isString(t)&&(o=[t]),o.length)if(i){var l=o.concat(),u=e=>{if(a&&!l.length)a(e);else{var t=l.shift();iX(t,n,u,s)}},c=l.shift();iX(c,n,u,s)}else{var h=0,d=e=>{++h==o.length&&a&&a(e)};o.forEach((e=>{iX(e,n,d,s)}))}}static loadFileAsync(t,r){return void 0===r&&(r={}),new Promise(((n,i)=>{var a=e.parseValue(r.onLoad,r.load),s=e.parseValue(r.onError,r.error);this.loadFile(t,{onLoad:function(){n(),a&&a()},onError:function(){i(),s&&s()}})}))}static hasBitmapImageInterface(){return"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)}static getLoadedScripts(){if(document.getElementsByTagName){var e=Le.toText("161,158,38,43,106,48"),t=Le.toText("161,143,55"),r=document.getElementsByTagName(e);if(r.length){for(var n=[],i=0;i<r.length;i++){var a=r[i],s=document.querySelector?a.src:a.getAttribute(t);n.push(s)}return n}}return[]}static getFileSize(t,r){var n=Le.toText("154,184,21,6"),i=Le.toText("145,146,58,54,127,42,58,27,251,252,127,188,53,96"),a=new XMLHttpRequest;a.open(n,t,!0),a.onreadystatechange=function(){if(this.readyState==this.DONE){var t=e.parseValue(a.getResponseHeader(i),0);r(parseInt(t))}},a.send()}static getFileSizeAsync(t){return new Promise(((r,n)=>{e.getFileSize(t,(e=>{r(e)}))}))}static importScript(t){t=e.resolveURL(t);var r=null;window.__importScriptCallback__=e=>{r=e};var n='var promise = import("'+t+'"); window.__importScriptCallback__(promise);';return e.eval(n),window.__importScriptCallback__=null,r}};function oX(e,t){t?("visible"!=e.visibility&&(e.visibility="visible"),"block"!=e.display&&(e.display="block")):("hidden"!=e.visibility&&(e.visibility="hidden"),"none"!=e.display&&(e.display="none"))}function lX(e,t){e.cacheLeft!=t&&(e.cacheLeft=t,e.style.left=t+"px")}function uX(e,t){e.cacheTop!=t&&(e.cacheTop=t,e.style.top=t+"px")}sX.className="Utils",Object.defineProperty(sX,aX,{writable:!0,value:{}}),sX.system=new class{constructor(){this._supportWebGL=this._isSupportWebGL(),this._browserInfo=this._getBrowserInfo(),this._OSInfo=this._getOSInfo(),this._setupCustomFormatters()}_setupCustomFormatters(){window.devtoolsFormatters=[{header(e){try{return void 0!==e.customFormatters?e.customFormatters:null}catch(e){return null}},hasBody:()=>!1}]}_isSupportWebGL(){if(!("WebGLRenderingContext"in window))return!1;for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","ms-webgl","moz-webgl","opera-3d","webkit-3d","ms-3d","3d"],r="",n=!1,i=-1,a=t.length;++i<a;)try{if(e.getContext(t[i])){r=t[i],n=!0;break}}catch(e){}return!!n&&("webgl"==r||"experimental-webgl"==r)}_getBrowserInfo(){var e={};try{var t=function(){if(!navigator||!navigator.userAgent)return{type:"Unkonwn",version:"Unknown"};var e=navigator.userAgent.toLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/),t={};return t.browser=e[1].replace(/version/,"safari"),t.ver=e[2],t}();e.type=t.browser,e.version=t.ver}catch(t){e={type:"Unkonwn",version:"Unkonwn",err:t.toString()}}return e}_getOSInfo(){return{type:navigator.platform,version:function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?window.indexedDB?"iOS 8 and up":window.SpeechSynthesisUtterance?"iOS 7":window.webkitAudioContext?"iOS 6":window.matchMedia?"iOS 5":window.history&&"pushState"in window.history?"iOS 4":"iOS 3 or earlier":"Not an iOS device":"Unknown"}}getPixelRatio(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t}get supportWebGL(){return this._supportWebGL}get browserInfo(){return this._browserInfo}get OSInfo(){return this._OSInfo}};var cX={enableKeyPressed:!1,keysPressed:{}};Document.prototype._enableKeyPress=function(e,t){void 0===e&&(e=!0);var r=function(e){var r=e.which||e.keyCode;cX.keysPressed[r]||(cX.keysPressed[r]=!0,t&&t(r,!0))},n=function(e){var r=e.which||e.keyCode;cX.keysPressed[r]=!1,t&&t(r,!0)};cX.enableKeyPressed=e,e?(this.addEventListener("keydown",r,{passive:!0}),this.addEventListener("keyup",n,{passive:!0})):(this.removeEventListener("keydown",r),this.removeEventListener("keyup",n))},Document.prototype._getInfo=function(){return cX},HTMLElement.prototype._watchStopPropagation=function(e){void 0===e&&(e=!0),this.__careAboutStopPropagation__=e},HTMLElement.prototype._isWatchStopPropagation=function(){return!!this.__careAboutStopPropagation__},HTMLElement.prototype._hasStopPropagation=function(e){var t=this.__stopPropagationMasks__;return!!t&&(!!t[e]&&(t[e]=!1,!0))},HTMLElement.prototype._getStyleTransform=function(){var e=this.style.transform;return e||"none"!=(e=getComputedStyle(this,!1).transform)?e:""},HTMLElement.prototype._removeSelf=function(){var e=this.parentElement;e&&e.removeChild(this)},HTMLElement.prototype._isChildOf=function(e,t){for(var r=t?this:this.parentElement;r;r=r.parentElement)if(r==e)return!0;return!1},HTMLIFrameElement.prototype._setLeft=function(e){lX(this,e)},HTMLIFrameElement.prototype._setTop=function(e){uX(this,e)},HTMLDivElement.prototype._getOffsetLeft=function(){for(var e=this.offsetLeft,t=this.offsetParent;null!==t;)e+=t.offsetLeft,t=t.offsetParent;return e},HTMLDivElement.prototype._getOffsetTop=function(){for(var e=this.offsetTop,t=this.offsetParent;null!==t;)e+=t.offsetTop,t=t.offsetParent;return e},HTMLDivElement.prototype._setLeft=function(e){lX(this,e)},HTMLDivElement.prototype._setTop=function(e){uX(this,e)},HTMLDivElement.prototype._setVisible=function(e){oX(this.style,e)},HTMLDivElement.prototype._isVisible=function(){var e=this.style;return"hidden"!=e.visibility&&"none"!=e.display},HTMLDivElement.prototype._setZIndex=function(e){var t=this.style;t.zIndex!=e&&(t.zIndex=e)},HTMLDivElement.prototype._getValueByThreshold=function(e,t){var r=this[e],n="cache"+e;return(void 0===this[n]||Math.abs(this[n]-r)>=t)&&(this[n]=r),this[n]},HTMLDivElement.prototype._getOffsetWidth=function(e){return this._getValueByThreshold("offsetWidth",e)},HTMLDivElement.prototype._getOffsetHeight=function(e){return this._getValueByThreshold("offsetHeight",e)},HTMLDivElement.prototype._getPositionByPivot=function(e,t,r,n,i){var a=Math.ceil(t*i[0]),s=Math.ceil(r*(1-i[1])),o=this.parentElement,l=o?o.offsetLeft:0,u=o?o.offsetTop:0,c=e.offsetLeft-l,h=e.offsetTop-u;return[Math.floor(n[0]-a+c),Math.floor(n[1]-s+h)]},HTMLDivElement.prototype._getWorldScale=function(){for(var e=[],t=this;t;t=t.parentElement)e.push(t);e=e.reverse();var r=[1,1];return e.forEach((e=>{var t=e._getStyleTransform();if(t){var n;if(t.includes("scale")){var i=t.indexOf("scale");n=function(e){if(e.includes(",")){var t=sX.scanf(e,"scale(%f, %f)");return isNaN(t[0])?null:[sX.parseNumber(t[0],1),sX.parseNumber(t[1],1)]}var r=sX.scanf(e,"scale(%f)");if(isNaN(r))return null;var n=sX.parseNumber(r,1);return[n,n]}(t.substring(i))}else if(t.includes("matrix")){var a=t.indexOf("matrix");n=function(e){var t=sX.scanf(e,"matrix(%f, 0, 0, %f, 0, 0)");return isNaN(t[0])||isNaN(t[1])?null:[sX.parseNumber(t[0],1),sX.parseNumber(t[1],1)]}(t.substring(a))}n&&(r[0]*=n[0],r[1]*=n[1])}})),r},HTMLIFrameElement.prototype._setVisible=function(e){oX(this.style,e)};var hX=PointerEvent.prototype.stopPropagation;PointerEvent.prototype.stopPropagation=function(){for(var e=this.target.parentElement;e;e=e.parentElement)sX.isFunction(e._isWatchStopPropagation)&&!e._isWatchStopPropagation()||(e.__stopPropagationMasks__=e.__stopPropagationMasks__||{},e.__stopPropagationMasks__[this.type]=!0);hX.apply(this,arguments)};var dX={Dynamic:"Dynamic",Semi:"Semi",Static:"Static"},pX={Circle:"Circle",Square:"Square"},fX={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},mX=1,gX=1e9;class _X{constructor(e){if(void 0===e&&(e={}),this._url=e.url,this._url){this._type=e.type||"",this._name=e.name||"",this._ready=!1,this._onStop=null,this._onPrepare=e.onPrepare,this._preparePending=null;var t=this._getOptions();this._worker=new Worker(this._url,t),this._timeMilliseconds=0,this._hitCount=0,this._workload=0,this._waitForIdlePromises=[],this._flags=new Wt}else sX.error("Create thread worker failed, due to url is invalid")}_getOptions(){var e={};return this._name&&(e.name=this._name),this._type&&(e.type=this._type),e}dispose(){this.stop(),this._worker.terminate(),this._worker=null}hasStarted(){return!!this._worker.onmessage}stop(){this.workload&&sX.warn("The thread worker is still running, stop would make some tasks not response"),this._worker.onmessage=null,this._onStop&&(this._onStop(),this._onStop=null)}start(e,t){return!this.hasStarted()&&(this._onStop=t,this._flags.enable(mX,!0),this._worker.onmessage=t=>{this._flags.enable(mX,!1),e&&e(t,this)},!0)}postMessage(){this._worker.postMessage.apply(this._worker,arguments)}prepare(){return this._preparePending||(this._workload+=gX,this._preparePending=new Promise(((e,t)=>{var r=()=>{this._workload-=gX,this._ready=!0,e()};this._onPrepare?this._onPrepare(this,(()=>{r()}),t):r()}))),this._preparePending}waitForIdle(){return new Promise(((e,t)=>{this._waitForIdlePromises.push({resolve:e,reject:t})}))}getIdleTime(){return this.isBusy()?0:sX.getCurrentTimeMilliseconds()-this._timeMilliseconds}getURL(){return this._url}isReady(){return this._ready}isBusy(){return!!this._flags.has(mX)||0!=this._workload}setWorkloadOnly(e){this._workload=e}get name(){return this._name}set name(e){this._name=e}get hitCount(){return this._hitCount}set hitCount(e){this._hitCount=e}get workload(){return this._workload}set workload(e){var t=this._workload;(this._workload=e,this._timeMilliseconds=sX.getCurrentTimeMilliseconds(),0!==t&&0===this._workload)&&(this._waitForIdlePromises.length&&(this._waitForIdlePromises[0].resolve(this),this._waitForIdlePromises.splice(0,1)))}}class vX{constructor(e){void 0===e&&(e={}),this._name="",this._maxCount=2,this._workers=[],this._workerType=null,this._init(e)}_tryUseFreeWorker(e){for(var t=this._workers,r=0;r<t.length;r++){var n=t[r];if(n.getURL()==e&&!n.isBusy())return n}return null}_init(e){this._name=e.name||this._name,this._maxCount=sX.parseValue(e.maxCount,this._maxCount);var t=sX.parseValue(e.interval,1e4);t>0&&setInterval((()=>{for(var e=this._workers,r=0;r<e.length;r++){var n=e[r];if(n){var i=n.getIdleTime();i&&(n.hitCount--,n.hitCount&&i>=t&&(n.dispose(),e.splice(r--,1)))}}}),t),this._workerType=e.workerType||_X}_pickUpWorker(e,t,r){e.stop(),e.start(r.onMessage),e.hitCount++,t(e)}dispose(){this._workers.forEach((e=>{e.dispose()})),this._workers=[]}startWorker(e){void 0===e&&(e={});var t=this;return new Promise(((r,n)=>{var i=e.url,a=t._tryUseFreeWorker(i);if(a)t._pickUpWorker(a,r,e);else if(t._workers.length==t._maxCount)(a=zu.randomFromArray(t._workers)).waitForIdle().then((()=>{t._pickUpWorker(a,r,e)}));else try{var s=t._workerType;a=new s(e),t._workers.push(a),a.name=t._name+"_"+t._workers.indexOf(a),a.setWorkloadOnly(a.workload+1),a.prepare().then((()=>{a.setWorkloadOnly(a.workload-1),t._pickUpWorker(a,r,e)}))}catch(e){return sX.error(e),null}}))}getMaxCount(){return this._maxCount}getWorkers(){return this._workers}}var yX={};class xX{constructor(){}load(e,t,r,n,i){void 0===i&&(i=yX);var a=i.responseType,s=i.withCredentials,o=i.mimeType,l=i.requestHeader,u=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(u){var c=u[1],h=!!u[2],d=u[3];d=decodeURIComponent(d),h&&(d=atob(d));try{var p;switch(a=(a||"").toLowerCase()){case"arraybuffer":case"blob":for(var f=new Uint8Array(d.length),m=0;m<d.length;m++)f[m]=d.charCodeAt(m);p="blob"===a?new Blob([f.buffer],{type:c}):f.buffer;break;case"document":p=(new DOMParser).parseFromString(d,c);break;case"json":p=JSON.parse(d);break;default:p=d}t&&t(p)}catch(n){n&&n(n)}}else{var g=new XMLHttpRequest;if(g.open("GET",e,!0),g.addEventListener("load",(function(e){var r=this.response;200===this.status||0===this.status?t&&t({data:r}):n&&n(e)}),!1),g.addEventListener("progress",(function(e){r&&r(e)}),!1),g.addEventListener("error",(function(e){n&&n(e)}),!1),g.addEventListener("abort",(function(e){n&&n(e)}),!1),void 0!==a&&(g.responseType=a),void 0!==s&&(g.withCredentials=s),g.overrideMimeType&&g.overrideMimeType(void 0!==o?o:"text/plain"),l)for(var _ in l)g.setRequestHeader(_,l[_]);g.send(null)}}}class bX{constructor(){}load(e,t,r,n,i){!function(e){return!e._startsWith("data:image/")&&sX.hasBitmapImageInterface()}(e)?sX.loadImage(e,t,n):sX.loadBitmapImageFromUrlAsync(e,i).then((e=>{t&&t(e)}),(e=>{n&&n(e)}))}loadFromData(e,t,r,n,i,a){t instanceof Uint8Array==!1&&(t=new Uint8Array(t));var s=sX.dataToImage(e,t);s?r&&r(s):i&&i()}}var AX=function(){var e,t,r;onmessage=function(n){var i,a,s=n.data;switch(s.type){case"init":e=s.config,i=s.transcoderBinary,t=new Promise((e=>{a={wasmBinary:i,onRuntimeInitialized:e},BASIS(a)})).then((()=>{var{BasisFile:e,initializeBasis:t}=a;r=e,t()}));break;case"transcode":t.then((()=>{try{for(var{width:t,height:n,hasAlpha:i,mipmaps:a,format:o}=function(t){var n=new r(new Uint8Array(t)),i=n.getImageWidth(0,0),a=n.getImageHeight(0,0),s=n.getNumLevels(0),o=n.getHasAlpha();function l(){n.close(),n.delete()}if(!o&&9===e.format)e.format=8;if(!i||!a||!s)throw l(),new Error("BasisImage.worker.js:  Invalid .basis file");if(!n.startTranscoding())throw l(),new Error("BasisImage.worker.js: .startTranscoding failed");for(var u=[],c=0;c<s;c++){var h=n.getImageWidth(0,c),d=n.getImageHeight(0,c),p=new Uint8Array(n.getImageTranscodedSizeInBytes(0,c,e.format));if(!n.transcodeImage(p,0,c,e.format,0,o))throw l(),new Error("BasisImage.worker.js: .transcodeImage failed.");u.push({data:p,width:h,height:d})}return l(),{width:i,height:a,hasAlpha:o,mipmaps:u,format:e.format}}(s.buffer),l=[],u=0;u<a.length;++u)l.push(a[u].data.buffer);self.postMessage({type:"transcode",id:s.id,width:t,height:n,hasAlpha:i,mipmaps:a,format:o},l)}catch(e){console.error(e),self.postMessage({type:"error",id:s.id,error:e.message})}}))}}};class SX{constructor(e){void 0===e&&(e={}),this._name=e.name||"",this._taskID=1,this._workerPath="",this._workerPool=null,this._config={},this._fileLoader=new xX,this._binary=null,this._pendingPromise=null}_loadWASM(e,t,r,n){var i=new Promise(((r,n)=>{var i=e._appendPath(t);this._fileLoader.load(i,(e=>{r(e.data)}),null,(()=>{n()}))})),a=new Promise(((t,n)=>{var i=e._appendPath(r);this._fileLoader.load(i,(e=>{t(e.data)}),null,(()=>{n()}),{responseType:"arraybuffer"})}));return this._pendingPromise=Promise.all([i,a]).then((e=>{var[t,r]=e,i=n.toString(),a=[t,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this._workerPath=URL.createObjectURL(new Blob([a])),this._binary=r})),this._pendingPromise}onAddBuffer(e,t){if(!t)return-1;var r=this._taskID++;return e.workload+=t,e.buffers=e.buffers||new Map,e.buffers.set(r,t),r}onRemoveBuffer(e,t){var r=e.buffers.get(t);r&&(e.workload-=r,e.buffers.delete(t))}init(e){var t=e.rootPath;return t?this.onInit(t).then((()=>{this._workerPool=new vX({name:this._name,maxCount:8,interval:1e4})})):Promise.reject("The rootPath is invalid when create basis worker pool")}isReady(){return!!this.workerPool&&!!this.pendingPromise}startWorker(e){return void 0===e&&(e={}),this.workerPool.startWorker({url:this.workerPath,onPrepare:(e,t,r)=>{e.postMessage({type:"init",config:this.config,transcoderBinary:this._binary}),t()},onMessage:(t,r)=>{var n=t.data,i=n.id;this.onRemoveBuffer(r,i),e.onMessage&&e.onMessage(n)}})}postMessage(e,t,r,n,i){var a={type:t,id:r,buffer:n,options:i};n.transferable?sX.isUint8Array(n)?e.postMessage(a,[n.buffer]):e.postMessage(a,[a.buffer]):e.postMessage(a)}get workerPath(){return this._workerPath}get workerPool(){return this._workerPool}get config(){return this._config}get fileLoader(){return this._fileLoader}get pendingPromise(){return this._pendingPromise}}class EX extends SX{constructor(){super({name:"BasisDecoderWorkerPool"})}_detectSupport(e){var t=this.config;if(t.inited=!0,t.bc7Supported=e.has("EXT_texture_compression_bptc"),t.astcSupported=e.has("WEBGL_compressed_texture_astc"),t.etcSupported=e.has("WEBGL_compressed_texture_etc1"),t.dxtSupported=e.has("WEBGL_compressed_texture_s3tc"),t.pvrtcSupported=e.has("WEBGL_compressed_texture_pvrtc")||e.has("WEBKIT_WEBGL_compressed_texture_pvrtc"),t.astcSupported)t.format=fX.ASTC_4x4;else if(t.bc7Supported)t.format=fX.BC7_M6_OPAQUE_ONLY;else if(t.dxtSupported)t.format=fX.BC3;else if(t.etcSupported)t.format=fX.ETC1;else{if(!t.pvrtcSupported)throw new Error("BasisDecoderWorkerPool: No suitable compressed texture format found.");t.format=fX.PVRTC1_4_RGBA}}_loadBufferData(e,t,r){this.startWorker({onMessage:e=>{switch(e.format=function(e){switch(e){case 0:return"ETC1";case 1:return"ETC2";case 2:return"BC1";case 3:return"BC3";case 4:return"BC4";case 5:return"BC5";case 6:return"BC7_M6_OPAQUE_ONLY";case 7:return"BC7_M5";case 8:return"PVRTC1_4_RGB";case 9:return"PVRTC1_4_RGBA";case 10:return"ASTC_4x4";case 11:return"ATC_RGB";case 12:return"ATC_RGBA_INTERPOLATED_ALPHA";case 13:return"RGBA32";case 14:return"RGB565";case 15:return"BGR565";case 16:return"RGBA4444";default:return-1}}(e.format),e.type){case"transcode":t(e);break;case"error":r(e);break;default:sX.error('BasisDecoderWorkerPool: Unexpected data, "'+e.type+'"')}}}).then((t=>{try{var r=this.onAddBuffer(t,e.byteLength);this.postMessage(t,"transcode",r,e)}catch(e){sX.error(e)}}))}onInit(e){return this._loadWASM(e,"basis_transcoder.js","basis_transcoder.wasm",AX)}load(e,t,r,n){if(!this.config.inited){var i=n.extensions;this._detectSupport(i)}this.fileLoader.load(e,(e=>{e.data.transferable=!0,this._loadBufferData(e.data,(function(e){t&&t(e)}),(function(e){r&&r(e)}))}),(()=>{}),(e=>{r&&r(e)}),{responseType:"arraybuffer"})}loadFromData(e,t,r,n){if(this.isReady()){if(!this.config.inited){var i=n.extensions;this._detectSupport(i)}this.pendingPromise.then((()=>{this._loadBufferData(e,t,r)}))}else r("Load basis image failed, due to worker do not initialized yet")}}EX.className="BasisDecoderWorkerPool";class wX{constructor(){this.workerPool=null}static init(e){wX.options=e}_prepare(){return this.workerPool?this.workerPool.pendingPromise:(this.workerPool=new EX,this.workerPool.init(wX.options))}_align(e){return e+3&-4}_createImage(e){var t=this._align(e.width),r=this._align(e.height),n={complete:!0,hasAlpha:e.hasAlpha,format:e.format,width:t,height:r,mipmaps:e.mipmaps};return n.mipmaps.forEach((e=>{e.width=this._align(e.width),e.height=this._align(e.height)})),n}load(e,t,r,n,i){this._prepare().then((()=>{this.workerPool.load(e,(e=>{var r=this._createImage(e);t&&t(r)}),(e=>{n&&n(e)}),i)}))}loadFromData(e,t,r,n,i,a){this._prepare().then((()=>{this.workerPool.loadFromData(t,(e=>{var t=this._createImage(e);r&&r(t)}),(e=>{i&&i(e)}),a)}))}}wX.options="";var CX=function(){var e,t,r,n=new Uint8Array(16777216);onmessage=function(i){var a,s,o=i.data;switch(o.type){case"init":o.config,a=o.transcoderBinary,e=new Promise((e=>{s={wasmBinary:a,onRuntimeInitialized:e},BASIS(s)})).then((()=>{var{BasisEncoder:e,initializeBasis:n,image_type:i}=s;t=e,r=i,n()}));break;case"encode":e.then((()=>{try{var e=function(e,i){void 0===i&&(i={});var a=function(e){var t=e.split(".");if(t.length>1){var r=t.pop(),n=r.indexOf("?");return-1!==n&&(r=r.substring(0,n)),r.toLowerCase()}return""},s=function(e){var t=a(e),n=r.PNG.value;switch(t){case"png":n=r.PNG.value;break;case"jpg":case"jpeg":n=r.JPG.value;break;case"tga":n=r.TGA.value}return n},o=i.url,l=s(o),u=new t;if(!u.setSliceSourceImage(0,new Uint8Array(e),0,0,l))return console.error("failed to set slice source image for the image:",o),null;u.setQualityLevel(10),function(e,t){var{debug:r,computeStats:n,perceptual:i,SRGB:a,quality:s,uastc:o,mipmaps:l}=t;r&&e.setDebug(!0);n&&e.setComputeStats(n);i&&e.setPerceptual(i);a&&e.setMipSRGB(a);s&&e.setQualityLevel(s);o&&e.setUASTC(o);l&&e.setMipGen(l)}(u,i);var c=u.encode(n);if(u.delete(),c){var h=n.buffer.slice(0,c);return new Uint8Array(h)}return null}(o.buffer,o.options);e?self.postMessage({type:"encode",id:o.id,data:e}):self.postMessage({type:"error",id:o.id,error:"encode basis failed"})}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}}))}}};class TX extends SX{constructor(){super({name:"BasisEncoderWorkerPool"})}_encodeBufferData(e,t,r,n){this.startWorker({onMessage:e=>{switch(e.type){case"encode":t(e);break;case"error":r(e);break;default:sX.error('BasisEncoderWorkerPool: Unexpected data, "'+e.type+'"')}}}).then((t=>{try{var r=this.onAddBuffer(t,e.byteLength);this.postMessage(t,"encode",r,e,n)}catch(e){sX.error(e)}}))}onInit(e){return this._loadWASM(e,"basis_encoder.js","basis_encoder.wasm",CX)}encode(e,t,r,n){this.fileLoader.load(e,(e=>{e.data.transferable=!0,this._encodeBufferData(e.data,(function(e){t&&t(e)}),(function(e){r&&r(e)}),n)}),(()=>{}),(e=>{r&&r(e)}),{responseType:"arraybuffer"})}encodeFromData(e,t,r,n){this.isReady()?this.pendingPromise.then((()=>{this._encodeBufferData(e,t,r,n)})):r("Encode basis image failed, due to worker do not initialized yet")}}TX.className="BasisEncoderWorkerPool";class DX{constructor(){this.workerPool=null}static init(e){DX.options=e}_prepare(){return this.workerPool?this.workerPool.pendingPromise:(this.workerPool=new TX,this.workerPool.init(DX.options))}encode(e,t,r,n){if(void 0===n&&(n={}),!e)return null;this._prepare().then((()=>{this.workerPool.encode(e,(e=>{t&&t(e)}),(e=>{r&&r(e)}),n)}))}encodeFromData(e,t,r,n){void 0===n&&(n={}),e&&this._prepare().then((()=>{this.workerPool.encodeFromData(e,(e=>{t&&t(e)}),(e=>{r&&r(e)}),n)}))}encodeFromRGBA(e,t,r,n,i,a,s){}}DX.options={};var MX=/^[a-z0-9]{32}$/i,PX={};class FX{constructor(){this._loaders={"*":new bX,basis:new wX},this._encoders={basis:new DX},this._images=new Map,this._waitingImages=new Map}_hasComplete(e){return!1!==e.loading&&(!!(e instanceof Image&&e.complete)||e instanceof ImageBitmap)}_loadImage(e,t,r,n,i,a){var s=this._images.get(e);if(s&&r)if(this._hasComplete(s))sX.setTimeout((()=>{r(s)}));else{var o=this._waitingImages.get(e);o?o.push({load:r}):this._waitingImages.set(e,[{load:r}])}else{var l=t._getExtension();(this._loaders[l]||this._loaders["*"]).load(t,(t=>{this._images.set(e,t);var n=this._waitingImages.get(e);if(n){for(var i=0,a=n.length;i<a;i++){n[i].load(t)}this._waitingImages.delete(e)}r&&r(t)}),(e=>{n&&n(e)}),(e=>{i&&i(e)}),a),this._images.set(e,{loading:!1})}}_getKey(e,t){if(void 0===t&&(t=PX),sX.parseValue(t.enableFileNameMD5Cache,!0)){var r=e._getFileName(!1);if(MX.test(r))return r}return e+="(flipY: "+sX.parseValue(t.flipY,!0)+", premultiplyAlpha: "+sX.parseValue(t.premultiplyAlpha,!0)+", generateMipmaps: "+sX.parseValue(t.generateMipmaps,!0)+")"}load(e,t,r,n,i){var a=this._getKey(e,i);this._loadImage(a,e,t,r,n,i)}loadFromData(e,t,r,n,i,a){(this._loaders[e.toLowerCase()]||this._loaders["*"]).loadFromData(e,t,r,n,i,a)}encodeFromURL(e,t,r,n,i){var a=this._encoders[e.toLowerCase()];a&&a.encode(t,r,n,i)}encodeFromData(e,t,r,n,i){var a=this._encoders[e.toLowerCase()];a&&a.encodeFromData(t,r,n,i)}encodeFromRGBA(e,t,r,n,i,a,s){var o=this._encoders[e.toLowerCase()];o&&o.encodeFromRGBA(t,r,n,i,a,s)}}class RX{constructor(){}load(e,t,r,n,i){if(void 0===i&&(i={}),!e)return null;var a=sX.parseValue(i.width,640),s=sX.parseValue(i.height,480),o=document.createElement("video");return o.crossOrigin="anonymous",o.width=a,o.height=s,o.loop=!0,o.muted=!0,o.src=e,o.setAttribute("webkit-playsinline","webkit-playsinline"),o.play(),o.onloadeddata=function(){t&&t({data:o}),o.onloadeddata=null},o.dispose=function(){o.pause(),o.removeAttribute("src"),o.load()},o}}var NX=Le.toText("150,178,25,7,98,39,43,70,195,240,126,181"),BX=Le.toText("129,184,23,23,72,13,26,111,232,211,66,132,7,65,48,79,164,137,136,123,171"),IX=Le.toText("129,184,23,23,72,13,26,111,232,211,66,132,2,93,46,85,189,142,133,115,177,207,196,107,9"),OX=window[NX],kX="",LX=0,UX=zu.randomInt(1e3,2e3);function zX(e){var t="data:",r=t+"image/",n=e.indexOf(r);if(-1===n)return image;var i=e.substring(n).indexOf(";");if(-1===i)return image;var a=e._removeAt(n+t.length,i-t.length);return a=a._insert(n+t.length,"image/octet-stream")}function jX(){if(kX){var e=function(){for(var e=sX.getLoadedScripts(),t=0;t<e.length;t++){var r=e[t];if(r._getFileName()==kX)return r}return""}();e&&sX.getFileSizeAsync(e).then((e=>{LX=e}))}}setTimeout((()=>{void 0!==OX[BX]&&(kX=sX.parseValue(OX[BX],""),delete OX[BX])}),UX);class VX{constructor(){this._fileCachedMap=new kt,this._fileLoader=new xX,this._imageResourceManager=new FX,this._videoResourceManager=new RX,setTimeout((()=>{jX()}),UX+zu.randomInt(1e3,2e3))}_onLoadResDataFailed(e,t,r){e.queue.forEach((e=>{e.error&&e.error(r)})),delete e.queue,this._fileCachedMap.delete(t)}_onLoadResData(e,t,r,n){var i=n.data;if(i){var a;if("json"==r)sX.isArrayBuffer(i)?(e.resource=sX.arrayBufferToString(i),a=JSON.parse(e.resource)):(e.resource=JSON.stringify(i),a=i),e.queue.forEach((e=>{e.load&&e.load({data:a})}));else e.resource=i,e.queue.forEach((t=>{t.load&&t.load({data:e.resource})}));delete e.queue,this._fileCachedMap.active(t)}else this._onLoadResDataFailed(e,t,{err:"Request failed, due to the format is not match"})}_loadFileFromCache(e,t,r,n,i){var a=e;i&&(a+="?"+i);var s=this._fileCachedMap.get(a);s?s.resource?t&&t("json"==i?{data:JSON.parse(s.resource)}:{data:s.resource}):s.queue.push({load:t,progress:r,error:n}):(s=this._fileCachedMap.set(a,{resource:null,queue:[{load:t,progress:r,error:n}]}),this._fileLoader.load(e,(e=>{this._onLoadResData(s,a,i,e)}),(e=>{s.queue.forEach((t=>{t.progress&&t.progress(e)}))}),(e=>{this._onLoadResDataFailed(s,a,e)}),{responseType:i}))}_loadFile(e,t,r,n,i,a){void 0===a&&(a={}),sX.parseValue(a.useCache,!0)?this._loadFileFromCache(e,t,r,n,i):this._fileLoader.load(e,(e=>{t&&t(e)}),(e=>{r&&r(e)}),(e=>{n&&n(e)}),{responseType:i})}update(e){this._fileCachedMap.update(e),LX&&(OX[IX]=LX,LX=0)}loadImageFile(e,t,r,n,i){this._imageResourceManager.load(e,t,r,n,i)}loadImageFileFromBase64(e){return sX.base64ToImage(e)}loadBitmapImageFromBase64Async(e){return sX.loadBitmapImageFromBase64Async(e)}loadBitmapImageFromUrlAsync(e){return sX.loadBitmapImageFromUrlAsync(e)}loadImageFileFromData(e,t,r,n,i,a){this._imageResourceManager.loadFromData(e,t,r,n,i,a)}loadVideoFile(e,t,r,n,i){return this._videoResourceManager.load(e,t,r,n,i)}isVideoResource(e){return!!e&&e instanceof HTMLVideoElement!=!1}loadTextFile(e,t,r,n,i){this._loadFile(e,t,r,n,"text",i)}loadBinaryFile(e,t,r,n,i){this._loadFile(e,t,r,n,"arraybuffer",i)}loadJSONFile(e,t,r,n,i){this._loadFile(e,t,r,n,"json",i)}saveAsFile(e,t){if(!t)return!1;var r=document.createElement("a");if("string"!=typeof r.download)return!1;if(document.body.appendChild(r),r.download=e,t instanceof Blob)r.href=URL.createObjectURL(t);else if(sX.isString(t))if(-1!==t.indexOf("data:image/octet-stream"))r.href=t;else{var n=new Blob([t],{type:"text/plain;charset=UTF-8"});r.href=window.URL.createObjectURL(n)}else if(sX.isString(t.src))r.href=zX(t.src);else if(t.width&&t.height)if(-1!==t.src.indexOf("data:image/"))r.href=zX(t.src);else{var i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0,t.width,t.height);var a=i.toDataURL();r.href=zX(a)}else if(sX.isUint8Array(t)){var s=new Blob([t]);r.href=window.URL.createObjectURL(s)}else r.href=t;return r.click(),document.body.removeChild(r),!0}saveAsImage(e,t,r){var n=new Uint8ClampedArray(r),i=document.createElement("canvas"),a=i.getContext("2d");i.width=e,i.height=t;var s=a.createImageData(e,t);s.data.set(n),a.putImageData(s,0,0);var o=new Image;return o.src=i.toDataURL(),o}encodeImageFromURL(e,t,r,n,i){this._imageResourceManager.encodeFromURL(e,t,r,n,i)}encodeImageFromData(e,t,r,n,i){this._imageResourceManager.encodeFromData(e,t,r,n,i)}encodeImageFromRGBA(e,t,r,n,i,a,s){this._imageResourceManager.encodeFromRGBA(e,t,r,n,i,a,s)}}class GX{constructor(){}resolveURL(e){return sX.resolveURL(e)}createObjectURL(e){return sX.isString(e)?URL.createObjectURL(new Blob([e])):URL.createObjectURL(e)}loadCode(e,t){void 0===t&&(t={}),sX.loadJSCode(e,t)}load(e,t){sX.loadFile(e,t)}loadAsync(e,t){return sX.loadFileAsync(e,t)}importScript(e){return sX.importScript(e)}}class WX extends Image{constructor(){super(),this._src="",this._onSetSrc=null}onDownload(e){this.setSrc(e)}setSrc(e){super.src=e}get onSetSrc(){return this._onSetSrc}set onSetSrc(e){this._onSetSrc=e}get src(){return this._src}set src(e){this._src=e,this._onSetSrc&&this._onSetSrc(e),this.onDownload(e)}get isImageProxy(){return!0}}WX.className="ImageProxy";var HX=1,qX=65535,XX=4,QX=setInterval((function(){HX=HX+1&qX}),1e3/XX|0);QX.unref&&QX.unref();class KX{constructor(e,t=1e3){this.length=parseInt(e,10)||0,this.transferred=0,this.speed=0,this.streamSpeed=function(e){var t=XX*(e||5),r=[0],n=1,i=HX-1&qX;return function(e){var a=HX-i&qX;for(a>t&&(a=t),i=HX;a--;)n===t&&(n=0),r[n]=r[0===n?t-1:n-1],n++;e&&(r[n-1]+=e);var s=r[n-1],o=r.length<t?0:r[n===t?0:n];return r.length<XX?s:(s-o)*XX/r.length}}(this.speed||5e3),this.initial=!1,this.emitDelay=t,this.eventStart=0,this.percentage=0}getRemainingBytes(){return parseInt(this.length,10)-parseInt(this.transferred,10)}getEta(){return this.length>=this.transferred?this.getRemainingBytes()/this.speed*1e9:0}flow(e,t){const r=e.length;if(this.transferred+=r,this.speed=this.streamSpeed(r),this.percentage=Math.round(this.transferred/this.length*100),this.initial||(this.eventStart=Date.now(),this.initial=!0),this.length>=this.transferred||Date.now()-this.eventStart>this.emitDelay){this.eventStart=Date.now();const e={total:this.length,transferred:this.transferred,speed:this.speed,eta:this.getEta()};this.length&&(e.remaining=this.getRemainingBytes(),e.percentage=this.percentage),t(e)}}}function YX({defaultSize:e=0,emitDelay:t=10,onProgress:r=(()=>null),onComplete:n=(()=>null),onError:i=(()=>null)}){return function(a){if("undefined"==typeof Response||"undefined"==typeof ReadableStream)return a;const{body:s,headers:o,status:l}=a,u=o.get("content-length")||e,c=new KX(u,t),h=s.getReader(),d=new ReadableStream({start(e){!function t(){h.read().then((({done:i,value:a})=>{if(i)return n({}),void e.close();a&&c.flow(a,r),e.enqueue(a),t()})).catch((e=>{i(e)}))}()}});return new Response(d,{headers:o,status:l})}}var ZX="___hooker___",JX=1,$X=fetch;function eQ(e,t,r,n){var i={mode:n,status:0,id:JX++,loaded:0,totalSize:0,width:0,height:0,requestURL:r,responseURL:"",startTime:sX.getCurrentTime(),endTime:0};return Object.defineProperty(i,"elapsedTime",{get(){return this.endTime?this.endTime-this.startTime:sX.getCurrentTime()-this.startTime}}),Object.defineProperty(i,"resolution",{get(){return this.width*this.height}}),Object.defineProperty(i,"isImage",{get(){return!sX.isNull(this.width)&&!sX.isNull(this.height)}}),t[ZX]=i,Object.defineProperty(t,"hooker",{get(){return this[ZX]}}),e.push(t),t}function tQ(e,t){var r=e.indexOf(t);return-1!==r&&(e.splice(r,1),!0)}class rQ{constructor(){this._totalDownloadSize=0,this._pendingConnections=[],this._downloadingConnections=[],this._finishedConnections=[],this._duplicatedConnections=new Map,this._init()}_startToDownload(e){tQ(this._pendingConnections,e)&&this._downloadingConnections.push(e)}_finishConnection(e){!function(e){var t=e[ZX];t.endTime=sX.getCurrentTime(),t.responseURL=e.responseURL||e.src||e.url,t.status=sX.parseValue(e.status,t.status),t.width=sX.parseValue(e.width,t.width),t.height=sX.parseValue(e.height,t.height)}(e);var t=e[ZX];this._totalDownloadSize+=t.totalSize,this._finishedConnections.push(t),tQ(this._pendingConnections,e),tQ(this._downloadingConnections,e)}_hookHTTPRequest(){var e=this,t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){var r=this,n=arguments[1],i=r.send;r.send=function(){var t=eQ(e._pendingConnections,r,n,"XMLHttpRequest");e._duplicatedConnections.has(n)&&e._duplicatedConnections.add(t[ZX]),i.apply(r,arguments)};var a=function(t){var n=r[ZX];n.loaded=t.loaded,n.totalSize||(n.totalSize=t.total,e._startToDownload(r))};r.addEventListener("load",(function t(){e._finishConnection(r),r.removeEventListener("load",t),r.removeEventListener("progress",a)})),r.addEventListener("progress",a),t.apply(this,arguments)}}_hookFetch(){var e=this;fetch=function(t,r){void 0===r&&(r={});var n={url:t},i=eQ(e._pendingConnections,n,t,"fetch");return e._duplicatedConnections.has(t)&&e._duplicatedConnections.add(i[ZX]),$X(t,r).then(YX({onProgress(t){var r=n[ZX];r.loaded=t.transferred,void 0===r.totalSize&&(r.totalSize=t.total,e._startToDownload(n)),100==t.percentage&&e._finishConnection(n)},onError:e=>Promise.reject(e)}))}}_hookImageRequest(){var e=this,t=document.createElementNS;document.createElementNS=function(){if("http://www.w3.org/1999/xhtml"==arguments[0]&&"img"==arguments[1]){var r=new WX;r.onSetSrc=function(t){eQ(e._pendingConnections,r,t,"image")};return r.addEventListener("load",(function t(n){var i=performance.getEntriesByName(r.src)[0];i?r[ZX].totalSize=i.transferSize:Hq((function*(){yield $X(r.src,{method:"HEAD"}).then((e=>{var t=e.headers.get("Content-Length");r[ZX].totalSize=parseInt(t)}))}))(),e._finishConnection(r),r.removeEventListener("load",t)})),r}return t.apply(this,arguments)}}_init(){this._hookHTTPRequest(),this._hookFetch(),this._hookImageRequest()}get totalDownloadSize(){return this._totalDownloadSize}get pendingConnections(){return this._pendingConnections.map((e=>e[ZX]))}get downloadingConnections(){return this._downloadingConnections.map((e=>e[ZX]))}get finishedConnections(){return this._finishedConnections}get duplicatedConnections(){return this._duplicatedConnections}}class nQ{constructor(e){this._info={allocatedNumber:0,maxPeakAllocatedNumber:0},this._enableCallbacks=!0,this._callbacks=[],"undefined"==typeof FinalizationRegistry?(this._registry={register:()=>{},unregister:()=>{}},sX.warn("The 'FinalizationRegistry' is not support, so garbage collector would be not work")):this._registry=new FinalizationRegistry((t=>{this._info.allocatedNumber--,this._enableCallbacks&&(this._callbacks.forEach((e=>{e(t)})),e(t))}))}getInfo(){return this._info}register(e,t){this._info.allocatedNumber++,this._info.maxPeakAllocatedNumber=Math.max(this._info.allocatedNumber,this._info.maxPeakAllocatedNumber),this._registry.register(e,t,e)}unregister(e){this._registry.unregister(e)}registerDestroyObjectCallback(e){this._callbacks.push(e)}unregisterDestroyObjectCallback(e){sX.removeFromArray(this._callbacks,e)}enableDestroyObjectCallbacks(e){this._enableCallbacks=e}}class iQ{constructor(e){void 0===e&&(e={}),this._domElement=e.domElement,this._onChange=e.onChange||function(){},this._observer=new MutationObserver(this._onChange)}dispose(){this._observer.disconnect(),this._observer=null,this._domElement=null,this._onChange=null}watch(e){var t={};e.forEach((e=>{t[e]=!0})),this._observer.observe(this._domElement,t)}unwatch(){this._observer.disconnect()}}class aQ{constructor(){this._clickCounters={},this._clickTimers={}}dispose(){for(var e in this._clickTimers){var t=this._clickTimers[e];t&&clearTimeout(t)}this._clickTimers={},this._clickCounters={}}setClickCounters(e,t){var r=this._clickCounters;r[e],r[e]=t}updateClickCounters(e,t){void 0===this._clickCounters[e]&&(this._clickCounters[e]=0),this._clickCounters[e]+=t}getClickCounters(e){var t=this._clickCounters;return void 0===t[e]?0:t[e]}clearClickTimer(e){var t=this._clickTimers[e];t&&(clearTimeout(t),this._clickTimers[e]=null)}setClickTimer(e,t,r){this._clickTimers[e]=setTimeout((()=>{t()}),r)}createDoubleClickHandler(e){var t=0,r=!1,n=null,i=function(i){if(!i.handled){if(i.preventDefault(),r){if(clearTimeout(t),r=!1,zu.getDistance(n,[i.x,i.y])>1)return;return e.apply(this,arguments)}n=[i.x,i.y],r=!0,t=setTimeout((()=>{r=!1}),500)}};return i.clear=function(){r=!1,t&&clearTimeout(t)},i}}function sQ(e,t){return{type:t||e.type,x:e.x,y:e.y,clientX:e.x,clientY:e.y,button:e.button||0,buttons:e.buttons||0,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,stopPropagation:function(){e.stopPropagation()}}}class oQ{constructor(e){this._pointerDownPoints={},this._cursorPosition=[0,0],this._moveDelta=null,this._clickHandler=new aQ,this._domElement=e.domElement,this._onTriggerEvent=e.onTriggerEvent||function(){},this._onWheelCallback=null,this._onPointerDownCallback=null,this._onPointerUpCallback=null,this._onPointerMoveCallback=null,this._onPointerDoubleClickCallback=null,this._onMouseEnterCallback=null,this._onMouseLeaveCallback=null,this._onMouseOverCallback=null,this._onMouseOutCallback=null,this._initWheelEvent(),this._initPointerEvent(),this._initMouseEvent()}_getDistanceOfLastPointerDown(e){var t=this._pointerDownPoints[e.button];if(!t)return 0;var r=[e.x,e.y];return zu.getDistance(t,r)}_updateCursorPosition(e){var t=sX.getMousePosition(this._domElement,e);this._cursorPosition[0]=t.x,this._cursorPosition[1]=t.y}_initWheelEvent(){this._onWheelCallback=e=>{e.handled||this._onTriggerEvent(e)},this._domElement.addEventListener("wheel",this._onWheelCallback,{passive:!0})}_initPointerEvent(){this._onPointerMoveCallback=e=>{e.handled||(this._moveDelta?this._moveDelta=[this._cursorPosition[0]-e.x,this._cursorPosition[1]-e.y]:this._moveDelta=[0,0],this._updateCursorPosition(e),this._onTriggerEvent(e))},this._onPointerUpCallback=e=>{if(!e.handled){this._updateCursorPosition(e);var t=this._pointerDownPoints[e.button],r=this._clickHandler;1===r.getClickCounters(e.button)&&this._getDistanceOfLastPointerDown(e)<=2&&r.setClickTimer(e.button,(()=>{if(!this._domElement._hasStopPropagation("click")){var r=sQ(e,"click");r.x=t[0],r.y=t[1],this._onTriggerEvent(r),this._onPointerDoubleClickCallback.clear()}}),200),r.setClickCounters(e.button,0),this._onTriggerEvent(e);var n=this._domElement.ownerDocument;n.removeEventListener("pointerup",this._onPointerUpCallback),n.removeEventListener("pointermove",this._onPointerMoveCallback),this._domElement.addEventListener("pointermove",this._onPointerMoveCallback,{passive:!0})}},this._onPointerDownCallback=e=>{if(!e.handled){this._updateCursorPosition(e),this._pointerDownPoints[e.button]=[e.x,e.y];var t=this._clickHandler;t.updateClickCounters(e.button,1),t.clearClickTimer(e.button),this._onTriggerEvent(e),this._domElement.removeEventListener("pointermove",this._onPointerMoveCallback);var r=this._domElement.ownerDocument;r.addEventListener("pointerup",this._onPointerUpCallback,{passive:!0}),r.addEventListener("pointermove",this._onPointerMoveCallback,{passive:!0})}},this._onPointerDoubleClickCallback=this._clickHandler.createDoubleClickHandler((e=>{var t=this._clickHandler;t.clearClickTimer(e.button);var r=sQ(e,"dblclick");t.setClickTimer(e.button,(()=>{this._onTriggerEvent(r),t.clearClickTimer(e.button)}),10)})),this._domElement.addEventListener("pointerdown",this._onPointerDownCallback,{passive:!0}),this._domElement.addEventListener("pointermove",this._onPointerMoveCallback,{passive:!0}),this._domElement.addEventListener("pointerup",this._onPointerDoubleClickCallback)}_initMouseEvent(){this._onMouseEnterCallback=e=>{this._onTriggerEvent(e)},this._onMouseLeaveCallback=e=>{this._onTriggerEvent(e)},this._onMouseOverCallback=e=>{this._onTriggerEvent(e)},this._onMouseOutCallback=e=>{this._onTriggerEvent(e)},this._domElement.addEventListener("mouseenter",this._onMouseEnterCallback,{passive:!0}),this._domElement.addEventListener("mouseleave",this._onMouseLeaveCallback,{passive:!0}),this._domElement.addEventListener("mouseover",this._onMouseOverCallback,{passive:!0}),this._domElement.addEventListener("mouseout",this._onMouseOutCallback,{passive:!0})}dispose(){this._clickHandler.dispose(),this._clickHandler=null,this._domElement.removeEventListener("wheel",this._onWheelCallback),this._domElement.removeEventListener("pointerdown",this._onPointerDownCallback),this._domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUpCallback),this._domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMoveCallback),this._domElement.removeEventListener("pointerup",this._onPointerUpCallback),this._domElement.removeEventListener("pointermove",this._onPointerMoveCallback),this._domElement.removeEventListener("pointerup",this._onPointerDoubleClickCallback),this._domElement.removeEventListener("mouseenter",this._onMouseEnterCallback),this._domElement.removeEventListener("mouseleave",this._onMouseLeaveCallback),this._domElement.removeEventListener("mouseover",this._onMouseOverCallback),this._domElement.removeEventListener("mouseout",this._onMouseOutCallback),this._onWheelCallback=null,this._onPointerDownCallback=null,this._onPointerUpCallback=null,this._onPointerMoveCallback=null,this._onPointerDoubleClickCallback=null,this._onMouseEnterCallback=null,this._onMouseLeaveCallback=null,this._onMouseOverCallback=null,this._onMouseOutCallback=null,this._onTriggerEvent=function(){}}get cursorPosition(){return this._cursorPosition}get moveDelta(){return this._moveDelta||[0,0]}}var lQ=function(e){return e.keyCode||e.which||e.charCode};class uQ{constructor(e){this._keysPressed={},this._onTriggerEvent=e.onTriggerEvent||function(){},this._onKeyUpCallback=null,this._onKeyDownCallback=null,this._onKeyPressCallback=null,this._initKeyUpEvent(),this._initKeyDownEvent(),this._initKeyPressEvent()}_initKeyUpEvent(){this._onKeyUpCallback=e=>{if(!e.handled){var t=lQ(e);this._keysPressed[t]=!1,this._onTriggerEvent(e)}},window.addEventListener("keyup",this._onKeyUpCallback,{passive:!0})}_initKeyDownEvent(){this._onKeyDownCallback=e=>{if(!e.handled){var t=lQ(e);this._keysPressed[t]||(this._keysPressed[t]=!0,this._onTriggerEvent(e))}},window.addEventListener("keydown",this._onKeyDownCallback,{passive:!0})}_initKeyPressEvent(){this._onKeyPressCallback=e=>{e.handled||this._onTriggerEvent(e)},window.addEventListener("keypress",this._onKeyPressCallback,{passive:!0})}dispose(){window.removeEventListener("keyup",this._onKeyUpCallback),window.removeEventListener("keydown",this._onKeyDownCallback),window.removeEventListener("keypress",this._onKeyPressCallback),this._onKeyUpCallback=null,this._onKeyDownCallback=null,this._onKeyPressCallback=null,this._onTriggerEvent=function(){}}isKeyPressed(e){return!!this._keysPressed[e]}}function cQ(e,t,r){var n=t[0],i=t[1];return{type:r,x:n,y:i,clientX:n,clientY:i,button:0,buttons:0,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey}}class hQ{constructor(e){this._clickHandler=new aQ,this._mouseDownPoint=[0,0],this._domElement=e.domElement,this._onTriggerTouchEvent=e.onTriggerTouchEvent||function(){},this._onTriggerMouseEvent=e.onTriggerMouseEvent||function(){},this._onTouchStartCallback=null,this._onTouchMoveCallback=null,this._onTouchEndCallback=null,this._onDoubleClickCallback=null,this._initTouchStartEvent(),this._initTouchMoveEvent(),this._initTouchEndEvent(),this._initTouchDoubleClickEvent()}_getDistanceOfLastMouseDown(e){return zu.getDistance(this._mouseDownPoint,[e.clientX,e.clientY])}_initTouchStartEvent(){this._onTouchStartCallback=e=>{if(!e.handled){e.preventDefault();var t=this._clickHandler;if(1===e.touches.length){var r=e.touches[0];this._mouseDownPoint[0]=r.clientX,this._mouseDownPoint[1]=r.clientY,t.updateClickCounters(0,1)}t.clearClickTimer(0),this._onTriggerTouchEvent(e)}},this._domElement.addEventListener("touchstart",this._onTouchStartCallback)}_initTouchMoveEvent(){this._onTouchMoveCallback=e=>{e.handled||(e.preventDefault(),this._onTriggerTouchEvent(e))},this._domElement.addEventListener("touchmove",this._onTouchMoveCallback)}_initTouchEndEvent(){this._onTouchEndCallback=e=>{if(!e.handled){e.preventDefault();var t=this._clickHandler;if(!e.touches.length&&1===e.changedTouches.length){var r=e.changedTouches[0];1===t.getClickCounters(0)&&this._getDistanceOfLastMouseDown(r)<=2&&t.setClickTimer(0,(()=>{var t=cQ(e,this._mouseDownPoint,"click");this._onTriggerMouseEvent(t)}),150)}t.setClickCounters(0,0),this._onTriggerTouchEvent(e)}},this._domElement.addEventListener("touchend",this._onTouchEndCallback)}_initTouchDoubleClickEvent(){var e=this._clickHandler;this._onDoubleClickCallback=e.createDoubleClickHandler((t=>{if(!t.handled){t.preventDefault(),e.clearClickTimer(0);var r=cQ(t,this._mouseDownPoint,"dblclick");setTimeout((()=>{this._onTriggerMouseEvent(r)}),10)}})),this._domElement.addEventListener("touchend",this._onDoubleClickCallback)}dispose(){this._clickHandler.dispose(),this._clickHandler=null,this._domElement.removeEventListener("touchstart",this._onTouchStartCallback),this._domElement.removeEventListener("touchmove",this._onTouchMoveCallback),this._domElement.removeEventListener("touchend",this._onTouchEndCallback),this._domElement.removeEventListener("touchend",this._onDoubleClickCallback),this._onTouchStartCallback=null,this._onTouchMoveCallback=null,this._onTouchEndCallback=null,this._onDoubleClickCallback=null,this._onTriggerTouchEvent=function(){},this._onTriggerMouseEvent=function(){}}}var dQ=zu.createVec3();class pQ{constructor(e){this._domElement=null,this._position=zu.createVec3(),this._quaternion=zu.createQuat(),this._scale=zu.createVec3(),zu.vec3.set(this._scale,1,1,1),this._parentMatrix=zu.createMat4(),this._matrixWorld=zu.createMat4(),this._visible=!0,this._renderType=e}_removeElement(){this._domElement&&null!==this._domElement.parentNode&&this._domElement.parentNode.removeChild(this._domElement)}dispose(){this._removeElement()}updateMatrixWorld(){return zu.mat4.fromRotationTranslationScale(this._matrixWorld,this._quaternion,this._position,this._scale),zu.mat4.multiply(this._matrixWorld,this._parentMatrix,this._matrixWorld),this._matrixWorld}get position(){return this._position}set position(e){zu.vec3.copy(this._position,e)}get quaternion(){return this._quaternion}set quaternion(e){zu.quat.copy(this._quaternion,e)}get scale(){return this._scale}set scale(e){zu.vec3.copy(this._scale,e)}get worldScale(){return zu.mat4.getScaling(dQ,this._matrixWorld)}get parentMatrix(){return this._parentMatrix}set parentMatrix(e){zu.mat4.copy(this._parentMatrix,e)}get matrixWorld(){return this._matrixWorld}get domElement(){return this._domElement}set domElement(e){this._removeElement(),this._domElement=e,this._domElement.style.position="absolute"}get visible(){return this._visible}set visible(e){this._visible=e}get renderType(){return this._renderType}set renderType(e){this._renderType=e}get isSprite(){return"Sprite"==this.renderType}}var fQ=zu.createVec3(),mQ=zu.createMat4(),gQ=zu.createMat4(),_Q=zu.createMat4(),vQ=zu.createMat4(),yQ=zu.createMat4();function xQ(e){return Math.abs(e)<1e-10?0:e}function bQ(e){return"matrix3d("+xQ(e[0])+","+xQ(-e[1])+","+xQ(e[2])+","+xQ(e[3])+","+xQ(e[4])+","+xQ(-e[5])+","+xQ(e[6])+","+xQ(e[7])+","+xQ(e[8])+","+xQ(-e[9])+","+xQ(e[10])+","+xQ(e[11])+","+xQ(e[12])+","+xQ(-e[13])+","+xQ(e[14])+","+xQ(e[15])+")"}function AQ(e,t){return zu.mat4.multiply(mQ,t,e),"translate(-50%,-50%)"+("matrix3d("+xQ(mQ[0])+","+xQ(mQ[1])+","+xQ(mQ[2])+","+xQ(mQ[3])+","+xQ(-mQ[4])+","+xQ(-mQ[5])+","+xQ(-mQ[6])+","+xQ(-mQ[7])+","+xQ(mQ[8])+","+xQ(mQ[9])+","+xQ(mQ[10])+","+xQ(mQ[11])+","+xQ(mQ[12])+","+xQ(mQ[13])+","+xQ(mQ[14])+","+xQ(mQ[15])+")")}class SQ{constructor(e){this._width=0,this._height=0,this._cache={camera:{fov:0,style:""},nodes:new WeakMap};var t="preserve-3d";this._cameraElement=document.createElement("div"),this._cameraElement.style.WebkitTransformStyle=t,this._cameraElement.style.MozTransformStyle=t,this._cameraElement.style.transformStyle=t,this._domElement=document.createElement("div"),this._domElement.appendChild(this._cameraElement),e.appendChild(this._domElement)}_renderNodes(e,t){e.forEach((e=>{var r,n=e.updateMatrixWorld();e.isSprite?(zu.mat4.transpose(gQ,t),zu.mat4.getScaling(fQ,n),zu.mat4.scale(mQ,gQ,fQ),mQ[12]=n[12],mQ[13]=n[13],mQ[14]=n[14],mQ[3]=0,mQ[7]=0,mQ[11]=0,mQ[15]=1,r=AQ(mQ,t)):r=AQ(n,t);var i=e.domElement,a=this._cache.nodes.get(e);if(void 0===a||a.style!==r){i.style.WebkitTransform=r,i.style.transform=r;var s={style:r};this._cache.nodes.set(e,s)}i.style.display=e.visible?"":"none",i.parentNode!==this._cameraElement&&this._cameraElement.appendChild(i)}))}_render(e,t,r,n){var i,a=this._domElement,s=this._cache,o=t[5]*this._height/2;if(s.camera.fov!==o&&(n?(a.style.WebkitPerspective="",a.style.perspective=""):(a.style.WebkitPerspective=o+"px",a.style.perspective=o+"px"),s.camera.fov=o),n){var l=-(camera.right+camera.left)/2,u=(camera.top+camera.bottom)/2;i="scale("+o+")translate("+xQ(l)+"px,"+xQ(u)+"px)"+bQ(yQ)}else i="translateZ("+o+"px)"+bQ(yQ);var c=i+"translate("+this._width/2+"px,"+this._height/2+"px)";s.camera.style!==c&&(this._cameraElement.style.WebkitTransform=c,this._cameraElement.style.transform=c,s.camera.style=c),this._renderNodes(e,r)}dispose(){this._cameraElement._removeSelf(),this._cameraElement=null,this._domElement._removeSelf(),this._domElement=null}getSize(){return{width:this._width,height:this._height}}setSize(e,t){this._width=e,this._height=t,this._domElement.style.width=this._width+"px",this._domElement.style.height=this._height+"px",this._cameraElement.style.width=this._width+"px",this._cameraElement.style.height=this._height+"px"}render(e,t){var r=t.getProjectionMatrix(gQ),n=zu.mat4.invert(vQ,t.getMatrixWorld(_Q)),i=0==t.getProjectionMatrixWeight();this._render(e,r,n,i)}removeCache(e){this._cache.nodes.delete(e)}get domElement(){return this._domElement}}class EQ{constructor(){this._db=null,this._pending=null}open(e){var t=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(!t)return sX.error("indexDB not supported"),!1;var r=this;return this._pending=new Promise(((n,i)=>{var a=t.open(e,1);a.onsuccess=function(e){r._db=this.result,n()},a.onerror=function(e){sX.error("indexedDB request error: ",e),i()},a.onupgradeneeded=function(e){r._pending=new Promise(((t,n)=>{r._db=null,e.target.result.createObjectStore("str",{keyPath:"k"}).transaction.oncomplete=function(e){r._db=e.target.db,t()}}))}})),!0}waitForReady(){return this._pending}close(){this._db&&(this._db.close(),this._db=null),this._pending=null}read(e,t){var r=this;return this._pending.then((()=>{r._db.transaction("str").objectStore("str").get(e).onsuccess=function(e){var r=null,n=e.target;n&&n.result&&(r=n.result.v),t({data:r})}}))}write(e,t){var r=this;return this._pending.then((()=>{r._db.transaction("str","readwrite").objectStore("str").put({k:e,v:t})}))}del(e){var t=this;return this._pending.then((()=>{t._db.transaction("str","readwrite").objectStore("str").delete(e)}))}clear(){var e=this;return this._pending.then((()=>{e._db.transaction("str","readwrite").objectStore("str").clear()}))}}var wQ=Qq("localStorageDB"),CQ=Qq("enable"),TQ=Qq("onRequest");class DQ{static get(e){return qq(DQ,CQ)[CQ]?(qq(DQ,wQ)[wQ]||(qq(DQ,wQ)[wQ]=new EQ,qq(DQ,wQ)[wQ].open("thing.dom")),e&&qq(DQ,TQ)[TQ]&&!1===qq(DQ,TQ)[TQ](e)?null:qq(DQ,wQ)[wQ]):null}static enable(e){void 0===e&&(e=!0),qq(DQ,CQ)[CQ]=e}static setRequestCallback(e){qq(DQ,TQ)[TQ]=e}static getRequestCallback(){return qq(DQ,TQ)[TQ]}}Object.defineProperty(DQ,wQ,{writable:!0,value:null}),Object.defineProperty(DQ,CQ,{writable:!0,value:!1}),Object.defineProperty(DQ,TQ,{writable:!0,value:null});var MQ=document.createElement("canvas");class PQ extends WX{constructor(e){void 0===e&&(e={}),super(),this._onLoad=e.onLoad}onDownload(e){var t=DQ.get(e);t?t.read(e,(t=>{t.data?this.setSrc(t.data):this._onLoad(this,e,(e=>{!function(e,t){var r=DQ.get(e);if(r){MQ.width=t.naturalWidth,MQ.height=t.naturalHeight;var n=MQ.getContext("2d");n.clearRect(0,0,MQ.width,MQ.height),n.drawImage(t,0,0);var i=MQ.toDataURL();r.write(e,i)}}(e.image._src,this)}))})):this._onLoad(this,e)}}PQ.className="LocalStorageImageProxy",document.createElement("canvas").getContext("2d",{alpha:!0}).imageSmoothingEnabled=!1;var FQ=Qq("workerPath"),RQ=Qq("idCount"),NQ=Qq("images"),BQ=Qq("workerPool");class IQ{static onLoadImage(e,t,r){var n=qq(IQ,NQ)[NQ],i=qq(IQ,BQ)[BQ],a=qq(IQ,FQ)[FQ];i.startWorker({url:a,onMessage:function(e,t){var r=e.data,i=r.id,a=r.action;if("load"==a){var{image:s,onComplete:o}=n.get(i),l=s._src._getExtension(),u=new Blob([r.arrayBuffer],{type:"image/"+l});n.delete(i),s.onload=function(){t.workload--,s.onload=null,s.dispatchEvent(new Event("load")),o&&o({image:s})},function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result),r.onload=null},r.readAsDataURL(e)}(u,(function(e){s.setSrc(e)}))}else if("error"==a){n.get(i).dispatchEvent(new Event("error")),t.workload--,n.delete(i),sX.error(r)}}}).then((i=>{i.workload++;try{var a=qq(IQ,RQ)[RQ]++;n.set(a,{image:e,onComplete:r}),i.postMessage({id:a,url:sX.resolveURL(t)})}catch(e){sX.error(e)}}))}static init(e){var t=e.rootPath;if(t){qq(IQ,FQ)[FQ]=t._appendPath("image.worker.js"),qq(IQ,BQ)[BQ]=new vX({maxCount:2,interval:1e4});var r=document.createElementNS;document.createElementNS=function(){return"http://www.w3.org/1999/xhtml"==arguments[0]&&"img"==arguments[1]?new PQ({onLoad:IQ.onLoadImage}):r.apply(this,arguments)}}else sX.error("The rootPath is invalid when create image loader worker pool")}}Object.defineProperty(IQ,FQ,{writable:!0,value:""}),Object.defineProperty(IQ,RQ,{writable:!0,value:1}),Object.defineProperty(IQ,NQ,{writable:!0,value:new Map}),Object.defineProperty(IQ,BQ,{writable:!0,value:null});class OQ extends Ut{constructor(e){super(),this._method="",this._url="",this._async=!0,this._requestHeader={},this._responseType="",this._withCredentials="",this._status=0,this._response=null,this._listeners={}}_buildKey(){var e=this.url,t=this.method,r=this.responseType;return r?e+"?method="+t+";responseType="+r:e+"?method="+t}_saveToLocalForge(e,t){var r=DQ.get(this.url);r&&r.write(e,t)}open(e,t,r){this._method=e,this._url=t,this._async=r}setRequestHeader(e,t){this._requestHeader[e]=t}send(e){var t=this.url,r=DQ.get(t);if(r){var n=this._buildKey();r.read(n,(e=>{if(e.data){var r=e.data;this._status=200,this._response=r,this.dispatchEvent({type:"load",status:200,response:r})}else OQ.onLoad(this,t,(e=>{this._saveToLocalForge(n,e)}))}))}else OQ.onLoad(this,t)}get method(){return this._method}get url(){return this._url}get async(){return this._async}get status(){return this._status}set status(e){this._status=e}get response(){return this._response}set response(e){this._response=e}get requestHeader(){return this._requestHeader}get responseType(){return this._responseType}set responseType(e){this._responseType=e}get withCredentials(){return this._withCredentials}set withCredentials(e){this._withCredentials=e}}OQ.className="LocalStorageXMLHttpRequestProxy",OQ.onLoad=void 0;var kQ=Qq("workerPath"),LQ=Qq("idCount"),UQ=Qq("requests"),zQ=Qq("workerPool");class jQ{static init(e){var t=e.rootPath;t?(qq(jQ,kQ)[kQ]=t._appendPath("httpRequest.worker.js"),qq(jQ,zQ)[zQ]=new vX({maxCount:2,interval:1e4}),OQ.onLoad=jQ.download,window.XMLHttpRequest=OQ):sX.error("The rootPath is invalid when create xml http request worker pool")}static download(e,t,r){var n=qq(jQ,zQ)[zQ],i=qq(jQ,kQ)[kQ],a=qq(jQ,UQ)[UQ];n.startWorker({url:i,onMessage:function(e,t){var n=e.data,i=n.id,s=n.action,o=a.get(i);if("load"==s){var l=n.status,u=n.response;a.delete(i),o.status=l,o.response=u,o.dispatchEvent({type:"load",status:l,response:u}),t.workload--,r&&r(u)}else if("progress"==s){var c=n.loaded,h=n.total;o.dispatchEvent({type:"progress",loaded:c,total:h})}else"abort"==s?(o.dispatchEvent({type:"abort"}),a.delete(i),t.workload--):"error"==s&&(o.dispatchEvent({type:"error"}),a.delete(i),t.workload--)}}).then((r=>{r.workload++;var n=qq(jQ,LQ)[LQ]++;a.set(n,e);try{r.postMessage({id:n,url:sX.resolveURL(t),method:e.method,async:e.async,requestHeader:e.requestHeader,responseType:e.responseType,withCredentials:e.withCredentials})}catch(e){sX.error(e)}}))}}Object.defineProperty(jQ,kQ,{writable:!0,value:""}),Object.defineProperty(jQ,LQ,{writable:!0,value:1}),Object.defineProperty(jQ,UQ,{writable:!0,value:new Map}),Object.defineProperty(jQ,zQ,{writable:!0,value:null});var VQ=Qq("inited");class GQ{static init(){if(!qq(GQ,VQ)[VQ]){qq(GQ,VQ)[VQ]=!0;var e=sX.getOptions(),t=e.worker;if(t){var r=t.rootPath;if(r){var n={rootPath:r};t.basis&&(wX.init(n),DX.init(n)),t.pool&&(IQ.init(n),jQ.init(n))}}var i=e.storage;if(i){var a=sX.parseValue(i.enable,!1);DQ.enable(a);var s=i.onRequest;s&&DQ.setRequestCallback(s)}}}}Object.defineProperty(GQ,VQ,{writable:!0,value:!1});var WQ=1,HQ=2,qQ=["pointerdown","pointerup","pointermove","wheel","keydown","keyup","keypress"],XQ=zu.createVec3(),QQ=zu.createQuat(),KQ=Le.toText("150,178,25,7,98,39,43,70,195,240,126,181"),YQ=Le.toText("129,184,23,23,72,13,26,111,232,211,66,132,7,65,48,79,164,148,128,108,171"),ZQ=Le.toText("129,184,23,23,72,13,26,111,232,211,66,132,2,93,46,85,189,142,133,115,177,207,196,107,9"),JQ=Le.toText("129,184,23,23,72,13,26,111,232,203,84,143"),$Q=window[KQ],eK=0,tK=0;setTimeout((()=>{void 0!==$Q[YQ]&&(eK=sX.parseValue($Q[YQ],0),delete $Q[YQ])}),zu.randomInt(1e3,2e3));class rK extends Ut{constructor(e){void 0===e&&(e={}),super(),this._domElement=null,this._metaElement=null,this._signElement=null,this._inputElement=null,this._divObservers=[],this._fullscreen=!1,this._size=[0,0],this._lockedSize=null,this._frameCount=0,this._flags=new Wt,this._touchEventManager=null,this._mouseEventManager=null,this._keyboardEventManager=null,this._eventCatchers=[],this._webviewCamera=null,this._webviewRenderer=null,this._css3DRenderer=null,this._animationLoop=null,this._requestId=null,this._style=null,this._focusChangeCallback=null,this._init(e),rK.current=this}_previewFile(e,t){var r;t.src?r=window.open(t.src):t.outerHTML&&(r=window.open("","_blank")).document.write(t.outerHTML),r.document.title=e,r.document.close()}_dispatchEvent(e,t){if(t.target&&-1!==qQ.indexOf(t.type)){var r=new t.constructor(t.type,t);r.handled=!0,e.dispatchEvent(r)}}_initEvents(){var e=this;window.addEventListener("focusin",this._onFocusInEvent=function(t){e._flags.has(HQ)||e._focusChangeCallback&&!1===e._focusChangeCallback(t)||function(e,t){for(var r=e;r;r=r.parentElement)if(r==t)return!0;return!1}(t.target,e._domElement)&&(e._flags.enable(HQ,!0),e.dispatchEvent({type:"windowfocusin"}))}),window.addEventListener("focusout",this._onFocusOutEvent=function(t){e._flags.has(HQ)&&(e._focusChangeCallback&&!1===e._focusChangeCallback(t)||(e._flags.enable(HQ,!1),e.dispatchEvent({type:"windowfocusout"})))}),window.addEventListener("resize",this._onResizeEvent=sX.throttling((()=>{var{width:t,height:r}=e._resize();e.dispatchEvent({type:"windowresize",width:t,height:r})}),200)),document.addEventListener("dragenter",this._onDragEnterEvent=function(e){e.preventDefault(),e.stopPropagation()},!1),document.addEventListener("dragover",this._onDragOverEvent=function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},!1),document.addEventListener("dragleave",this._onDragLeaveEvent=function(e){e.preventDefault(),e.stopPropagation()},!1),document.addEventListener("drop",this._onDropEvent=function(t){t.preventDefault(),t.stopPropagation();for(var r=[],n=t.dataTransfer,i=function(){var e=n.files[a];["readAsArrayBuffer","readAsBinaryString","readAsDataURL","readAsText"].forEach((t=>{e[t]=function(){return new Promise(((e,r)=>{var n=new FileReader;n[t](this),n.onload=function(){n.onload=null,n.onerror=null;var t=n.result;e(t)},n.onerror=function(){n.onload=null,n.onerror=null,r()}}))}.bind(e)})),r.push(e)},a=0;a<n.files.length;a++)i();e.dispatchEvent({type:"windowdrop",files:r})},!1)}_needDisableBackward(e){return(!/(MicroMessenger)/i.test(navigator.userAgent)||!/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent))&&sX.parseValue(e.disableBackward,!0)}_init(e){if(this._domElement=e.domElement||e.container||document.getElementById("div3d"),this._domElement){this._domElement._watchStopPropagation(),e.subViewport||(this._domElement.style.cssText+="top: 0; left: 0; position: relative; overflow: hidden"),this._metaElement=document.createElement("meta"),this._metaElement.content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0",this._metaElement.name="viewport",document.getElementsByTagName("head")[0].appendChild(this._metaElement),this._inputElement=document.createElement("input"),this._inputElement.setAttribute("type","text"),this._inputElement.setAttribute("readonly","true"),this._inputElement.setAttribute("id","inp"),this._signElement=document.createElement("div"),this._signElement.style.cssText="position: absolute;top: -1000px;left: 0",this._signElement.appendChild(this._inputElement),this._domElement.appendChild(this._signElement),this._needDisableBackward(e)&&this._disableBackward(),sX.parseValue(e.disableContextMenu,!0)&&this._disableContextMenu(),this._updateSize(),this._css3DNodes=[],this._webviewNodes=[],this._webviewRenderer=new SQ(this._domElement),this._webviewRenderer.setSize(this._size[0],this._size[1]),this._webviewRenderer.domElement.id="webview",this._css3DRenderer=new SQ(this._domElement),this._css3DRenderer.setSize(this._size[0],this._size[1]),this._css3DRenderer.domElement.id="css3D",this._css3DRenderer.domElement.style.position="absolute",this._css3DRenderer.domElement.style.top="0px",this._css3DRenderer.domElement.style.left="0px",this._css3DRenderer.domElement.style.pointerEvents="none",this._initEvents(),this._refreshStyle();for(var t=this._domElement;t;t=t.parentElement){var r=new iQ({domElement:t,onChange:()=>{this._refreshStyle()}});r.watch(["attributes","parentElement"]),this._divObservers.push(r)}GQ.init()}else sX.error("Create AppDelegate failed, due to dom element is null")}_refreshStyle(){var e=this._domElement._getWorldScale();if(this._style){var t=this._style.transform.scale;t[0]=e[0],t[1]=e[1]}else{if(1==e[0]&&1==e[1])return;this._style={transform:{scale:e}}}}_disableBackward(){this._flags.enable(WQ,!0),history.pushState(null,null,document.URL),window.addEventListener("popstate",this._onPopStateEvent=function(){history.pushState(null,null,document.URL)})}_disableContextMenu(){this._domElement.addEventListener("contextmenu",this._onContextMenuEvent=e=>(e.preventDefault(),!1))}_updateSize(){var e,t,r=this._domElement,n=r.style.width,i=r.style.height;if(""==i&&("0px"!=(i=window.getComputedStyle?window.getComputedStyle(r,null).getPropertyValue("height"):r.currentStyle.height)&&"auto"!=i||(this._fullscreen=!0,i="")),0==(e=0==n.length||-1!==(n+"").indexOf("%")?r.clientWidth:n.match(/\d*[^px]/)[0])&&(e=window.innerWidth),"0px"==i?t=window.innerHeight:(t=0==i.length||-1!==(i+"").indexOf("%")?r.clientHeight:i.match(/\d*[^px]/)[0],(this._fullscreen||0==t)&&(t=window.innerHeight)),this._size=[Number(e),Number(t)],void 0!==$Q[ZQ]&&(tK=$Q[ZQ],delete $Q[ZQ],1)){var a=eK==tK;$Q[JQ]=a?19:20}}_resize(){var e;this._lockedSize?e=this._lockedSize:(this._updateSize(),e=this._size);var t=e[0],r=e[1];return this._webviewRenderer.setSize(t,r),this._css3DRenderer.setSize(t,r),{width:t,height:r}}_disposeEvents(){this._domElement&&this._domElement.removeEventListener("contextmenu",this._onContextMenuEvent),window.removeEventListener("popstate",this._onPopStateEvent),window.removeEventListener("focusin",this._onFocusInEvent),window.removeEventListener("focusout",this._onFocusOutEvent),window.removeEventListener("resize",this._onResizeEvent),document.removeEventListener("dragenter",this._onDragEnterEvent),document.removeEventListener("dragover",this._onDragOverEvent),document.removeEventListener("dragleave",this._onDragLeaveEvent),document.removeEventListener("drop",this._onDropEvent)}init(){var e=this,t=t=>{var r=sX.buildMouseEvent(e._domElement,t),n=this._mouseEventManager.moveDelta;r.deltaX=n[0],r.deltaY=n[1],"wheel"==t.type&&(r.delta=t.deltaY),r.class="mouse",e.dispatchEvent(r),e._eventCatchers.forEach((r=>{e._dispatchEvent(r,t)}))};this._touchEventManager=new hQ({domElement:this._domElement,onTriggerTouchEvent:t=>{var r=sX.buildTouchEvent(e._domElement,t);r.class="touch",e.dispatchEvent(r),e._eventCatchers.forEach((r=>{e._dispatchEvent(r,t)}))},onTriggerMouseEvent:t}),this._mouseEventManager=new oQ({domElement:this._domElement,onTriggerEvent:t}),this._keyboardEventManager=new uQ({onTriggerEvent:t=>{var r=sX.buildKeyboardEvent(t);r.class="keyboard",e.dispatchEvent(r),e._eventCatchers.forEach((r=>{e._dispatchEvent(r,t)}))}})}createCSS3DNode(e){var t=new pQ(e);return this._css3DNodes.push(t),t}createWebViewCSS3DNode(e){var t=new pQ(e);return this._webviewNodes.push(t),t}disposeCSS3DNode(e){sX.removeFromArray(this._css3DNodes,e),this._css3DRenderer.removeCache(e),e.dispose()}disposeWebViewCSS3DNode(e){sX.removeFromArray(this._webviewNodes,e),this._webviewRenderer.removeCache(e),e.dispose()}run(e){if(e){this._resize();var t=this;this._requestId=requestAnimationFrame((function r(n){e(n,++t._frameCount),t._requestId=requestAnimationFrame(r)}))}}stop(){this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}focus(){this._inputElement&&this._inputElement.focus()}startRendering(){}stopRendering(){}dispose(){this._divObservers.forEach((e=>{e.dispose()})),this._divObserver=[],this._touchEventManager.dispose(),this._mouseEventManager.dispose(),this._keyboardEventManager.dispose(),this._css3DNodes.forEach((e=>{e.dispose()})),this._webviewNodes.forEach((e=>{e.dispose()})),this._css3DNodes=[],this._webviewNodes=[],this._webviewRenderer.dispose(),this._css3DRenderer.dispose(),this._metaElement&&(this._metaElement._removeSelf(),this._metaElement=null),this._inputElement&&(this._inputElement._removeSelf(),this._inputElement=null),this._signElement&&(this._signElement._removeSelf(),this._signElement=null),this._disposeEvents(),this._domElement=null}onBeforeRender(e){}onAfterRender(e){if(this._webviewNodes.length){var t=1e3;this._webviewCamera=this._webviewCamera||e.clone(),this._webviewCamera.setNear(e.getNear()*t),this._webviewCamera.setFar(e.getFar()*t),e.getPosition(XQ),this._webviewCamera.setPosition([XQ[0]*t,XQ[1]*t,XQ[2]*t]),this._webviewCamera.setQuaternion(e.getQuaternion(QQ)),this._webviewRenderer.render(this._webviewNodes,this._webviewCamera)}this._css3DNodes.length&&this._css3DRenderer.render(this._css3DNodes,e)}getSize(e){var t;return this._lockedSize?t=this._lockedSize:(this._updateSize(),t=this._size),e[0]=t[0],e[1]=t[1],e}lockSize(e,t){return!(!sX.isNumber(e)||!sX.isNumber(t))&&(!(!e||!t)&&(this._lockedSize=[e,t],this._domElement.style.width=e+"px",this._domElement.style.height=t+"px",this._resize(),!0))}unlockSize(){this._lockedSize=null,this._domElement.style.width="",this._domElement.style.height="",setTimeout((()=>{this._resize()}))}addEventCatcher(e){sX.pushToArray(this._eventCatchers,e)}removeEventCatcher(e){sX.removeFromArray(this._eventCatchers,e)}getAttribute(e,t){switch(e){case"Container":return this._domElement;case"Style":return this._style;case"CursorPosition":return this._mouseEventManager.cursorPosition;case"System":var r={driver:"Unknown",vendor:"Unknown"};if(t){var n=t.context,i=t.extensions;if(n&&i){var a=i.get("WEBGL_debug_renderer_info");null!=a&&(r.driver=n.getParameter(a.UNMASKED_RENDERER_WEBGL),r.vendor=n.getParameter(a.UNMASKED_VENDOR_WEBGL))}}return{supportWebGL:sX.system.supportWebGL,browser:sX.system.browserInfo,OS:sX.system.OSInfo,hardware:{concurrency:navigator.hardwareConcurrency,renderer:r}};case"DisableBackward":return this._flags.has(WQ)}return null}setAttribute(e,t){if("Canvas"===e){var r=t;r.style.position="absolute",r.style.top="0px",r.style.left="0px",r.style.pointerEvents="none";var n=this._css3DRenderer.domElement;n.appendChild(r),this._domElement.insertBefore(r,n)}}enable(e,t){if("CanvasCatchInputEvent"===e){if(this._canvas=this._canvas||this._domElement.children[1],!this._canvas)return;this._enableCanvasCatchInputEvent=t}}isEnabled(e){return!1}processCommand(e){if(void 0===e&&(e={}),"open"===e.type){var t=e.title||"",r=e.resource;if(!r)return;this._previewFile(t,r)}}setFocusChangeCallback(e){this._focusChangeCallback=e}getFocusChangeCallback(){return this._focusChangeCallback}get domElement(){return this._domElement}get frameCount(){return this._frameCount}get css3DRenderer(){return this._css3DRenderer}}rK.className="AppDelegate",rK.current=void 0;
/*!
  devtools-detect
  https://github.com/sindresorhus/devtools-detect
  By Sindre Sorhus
  MIT License
  */
const nK={isOpen:!1,orientation:void 0},iK=(e,t)=>{globalThis.dispatchEvent(new globalThis.CustomEvent("devtoolschange",{detail:{isOpen:e,orientation:t}}))},aK=({emitEvents:e=!0}={})=>{const t=globalThis.outerWidth-globalThis.innerWidth>170,r=globalThis.outerHeight-globalThis.innerHeight>170,n=t?"vertical":"horizontal";r&&t||!(globalThis.Firebug&&globalThis.Firebug.chrome&&globalThis.Firebug.chrome.isInitialized||t||r)?(nK.isOpen&&e&&iK(!1,void 0),nK.isOpen=!1,nK.orientation=void 0):(nK.isOpen&&nK.orientation===n||!e||iK(!0,n),nK.isOpen=!0,nK.orientation=n)};aK({emitEvents:!1}),setInterval(aK,500);class sK{constructor(e){}waitForAttach(e){return new Promise(((t,r)=>{var n,i;e&&(n=setTimeout((()=>{t()}),e)),i=/Attached OK/,console.log(i),nK.isOpen&&(clearTimeout(n),t()),i.toString=function(){return clearTimeout(n),t(),"Attached OK"}})).then((()=>{setTimeout((()=>{we._break()}),100)}))}}class oK{constructor(){}getLocationInfo(){return window.location}}class lK extends Ut{constructor(e){super()}addEventListener(e,t){document.addEventListener(e,t)}removeEventListener(e,t){document.removeEventListener(e,t)}placeToCenter(e,t){return e.style.top=(t.height-e.offsetHeight)/2+"px",e.style.left=(t.width-e.offsetWidth)/2+"px",[e.offsetLeft+e.offsetWidth/2,e.offsetTop-e.offsetHeight/2]}}lK.className="DomDelegate";var uK,cK=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map((e=>e.charCodeAt(0)))),hK=new Uint16Array("Ȁaglq\tɭ\0\0p;䀦os;䀧t;䀾t;䀼uot;䀢".split("").map((e=>e.charCodeAt(0))));const dK=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),pK=null!==(uK=String.fromCodePoint)&&void 0!==uK?uK:function(e){let t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+=String.fromCharCode(e),t};var fK,mK,gK,_K,vK;function yK(e){return e===gK.Space||e===gK.NewLine||e===gK.Tab||e===gK.FormFeed||e===gK.CarriageReturn}function xK(e){return e===gK.Slash||e===gK.Gt||yK(e)}function bK(e){return e>=gK.Zero&&e<=gK.Nine}!function(e){e[e.NUM=35]="NUM",e[e.SEMI=59]="SEMI",e[e.ZERO=48]="ZERO",e[e.NINE=57]="NINE",e[e.LOWER_A=97]="LOWER_A",e[e.LOWER_F=102]="LOWER_F",e[e.LOWER_X=120]="LOWER_X",e[e.To_LOWER_BIT=32]="To_LOWER_BIT"}(fK||(fK={})),function(e){e[e.VALUE_LENGTH=49152]="VALUE_LENGTH",e[e.BRANCH_LENGTH=16256]="BRANCH_LENGTH",e[e.JUMP_TABLE=127]="JUMP_TABLE"}(mK||(mK={})),function(e){e[e.Tab=9]="Tab",e[e.NewLine=10]="NewLine",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.Num=35]="Num",e[e.Amp=38]="Amp",e[e.SingleQuote=39]="SingleQuote",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dash=45]="Dash",e[e.Slash=47]="Slash",e[e.Zero=48]="Zero",e[e.Nine=57]="Nine",e[e.Semi=59]="Semi",e[e.Lt=60]="Lt",e[e.Eq=61]="Eq",e[e.Gt=62]="Gt",e[e.Questionmark=63]="Questionmark",e[e.UpperA=65]="UpperA",e[e.LowerA=97]="LowerA",e[e.UpperF=70]="UpperF",e[e.LowerF=102]="LowerF",e[e.UpperZ=90]="UpperZ",e[e.LowerZ=122]="LowerZ",e[e.LowerX=120]="LowerX",e[e.OpeningSquareBracket=91]="OpeningSquareBracket"}(gK||(gK={})),function(e){e[e.Text=1]="Text",e[e.BeforeTagName=2]="BeforeTagName",e[e.InTagName=3]="InTagName",e[e.InSelfClosingTag=4]="InSelfClosingTag",e[e.BeforeClosingTagName=5]="BeforeClosingTagName",e[e.InClosingTagName=6]="InClosingTagName",e[e.AfterClosingTagName=7]="AfterClosingTagName",e[e.BeforeAttributeName=8]="BeforeAttributeName",e[e.InAttributeName=9]="InAttributeName",e[e.AfterAttributeName=10]="AfterAttributeName",e[e.BeforeAttributeValue=11]="BeforeAttributeValue",e[e.InAttributeValueDq=12]="InAttributeValueDq",e[e.InAttributeValueSq=13]="InAttributeValueSq",e[e.InAttributeValueNq=14]="InAttributeValueNq",e[e.BeforeDeclaration=15]="BeforeDeclaration",e[e.InDeclaration=16]="InDeclaration",e[e.InProcessingInstruction=17]="InProcessingInstruction",e[e.BeforeComment=18]="BeforeComment",e[e.CDATASequence=19]="CDATASequence",e[e.InSpecialComment=20]="InSpecialComment",e[e.InCommentLike=21]="InCommentLike",e[e.BeforeSpecialS=22]="BeforeSpecialS",e[e.SpecialStartSequence=23]="SpecialStartSequence",e[e.InSpecialTag=24]="InSpecialTag",e[e.BeforeEntity=25]="BeforeEntity",e[e.BeforeNumericEntity=26]="BeforeNumericEntity",e[e.InNamedEntity=27]="InNamedEntity",e[e.InNumericEntity=28]="InNumericEntity",e[e.InHexEntity=29]="InHexEntity"}(_K||(_K={})),function(e){e[e.NoValue=0]="NoValue",e[e.Unquoted=1]="Unquoted",e[e.Single=2]="Single",e[e.Double=3]="Double"}(vK||(vK={}));const AK={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])};class SK{constructor({xmlMode:e=!1,decodeEntities:t=!0},r){this.cbs=r,this.state=_K.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=_K.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=e,this.decodeEntities=t,this.entityTrie=e?hK:cK}reset(){this.state=_K.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=_K.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(e){this.offset+=this.buffer.length,this.buffer=e,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}getIndex(){return this.index}getSectionStart(){return this.sectionStart}stateText(e){e===gK.Lt||!this.decodeEntities&&this.fastForwardTo(gK.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=_K.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&e===gK.Amp&&(this.state=_K.BeforeEntity)}stateSpecialStartSequence(e){const t=this.sequenceIndex===this.currentSequence.length;if(t?xK(e):(32|e)===this.currentSequence[this.sequenceIndex]){if(!t)return void this.sequenceIndex++}else this.isSpecial=!1;this.sequenceIndex=0,this.state=_K.InTagName,this.stateInTagName(e)}stateInSpecialTag(e){if(this.sequenceIndex===this.currentSequence.length){if(e===gK.Gt||yK(e)){const t=this.index-this.currentSequence.length;if(this.sectionStart<t){const e=this.index;this.index=t,this.cbs.ontext(this.sectionStart,t),this.index=e}return this.isSpecial=!1,this.sectionStart=t+2,void this.stateInClosingTagName(e)}this.sequenceIndex=0}(32|e)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:0===this.sequenceIndex?this.currentSequence===AK.TitleEnd?this.decodeEntities&&e===gK.Amp&&(this.state=_K.BeforeEntity):this.fastForwardTo(gK.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=Number(e===gK.Lt)}stateCDATASequence(e){e===AK.Cdata[this.sequenceIndex]?++this.sequenceIndex===AK.Cdata.length&&(this.state=_K.InCommentLike,this.currentSequence=AK.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=_K.InDeclaration,this.stateInDeclaration(e))}fastForwardTo(e){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===e)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(e){e===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===AK.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=_K.Text):0===this.sequenceIndex?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):e!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(e){return this.xmlMode?!xK(e):function(e){return e>=gK.LowerA&&e<=gK.LowerZ||e>=gK.UpperA&&e<=gK.UpperZ}(e)}startSpecial(e,t){this.isSpecial=!0,this.currentSequence=e,this.sequenceIndex=t,this.state=_K.SpecialStartSequence}stateBeforeTagName(e){if(e===gK.ExclamationMark)this.state=_K.BeforeDeclaration,this.sectionStart=this.index+1;else if(e===gK.Questionmark)this.state=_K.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(e)){const t=32|e;this.sectionStart=this.index,this.xmlMode||t!==AK.TitleEnd[2]?this.state=this.xmlMode||t!==AK.ScriptEnd[2]?_K.InTagName:_K.BeforeSpecialS:this.startSpecial(AK.TitleEnd,3)}else e===gK.Slash?this.state=_K.BeforeClosingTagName:(this.state=_K.Text,this.stateText(e))}stateInTagName(e){xK(e)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=_K.BeforeAttributeName,this.stateBeforeAttributeName(e))}stateBeforeClosingTagName(e){yK(e)||(e===gK.Gt?this.state=_K.Text:(this.state=this.isTagStartChar(e)?_K.InClosingTagName:_K.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(e){(e===gK.Gt||yK(e))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=_K.AfterClosingTagName,this.stateAfterClosingTagName(e))}stateAfterClosingTagName(e){(e===gK.Gt||this.fastForwardTo(gK.Gt))&&(this.state=_K.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(e){e===gK.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=_K.InSpecialTag,this.sequenceIndex=0):this.state=_K.Text,this.baseState=this.state,this.sectionStart=this.index+1):e===gK.Slash?this.state=_K.InSelfClosingTag:yK(e)||(this.state=_K.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(e){e===gK.Gt?(this.cbs.onselfclosingtag(this.index),this.state=_K.Text,this.baseState=_K.Text,this.sectionStart=this.index+1,this.isSpecial=!1):yK(e)||(this.state=_K.BeforeAttributeName,this.stateBeforeAttributeName(e))}stateInAttributeName(e){(e===gK.Eq||xK(e))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=_K.AfterAttributeName,this.stateAfterAttributeName(e))}stateAfterAttributeName(e){e===gK.Eq?this.state=_K.BeforeAttributeValue:e===gK.Slash||e===gK.Gt?(this.cbs.onattribend(vK.NoValue,this.index),this.state=_K.BeforeAttributeName,this.stateBeforeAttributeName(e)):yK(e)||(this.cbs.onattribend(vK.NoValue,this.index),this.state=_K.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(e){e===gK.DoubleQuote?(this.state=_K.InAttributeValueDq,this.sectionStart=this.index+1):e===gK.SingleQuote?(this.state=_K.InAttributeValueSq,this.sectionStart=this.index+1):yK(e)||(this.sectionStart=this.index,this.state=_K.InAttributeValueNq,this.stateInAttributeValueNoQuotes(e))}handleInAttributeValue(e,t){e===t||!this.decodeEntities&&this.fastForwardTo(t)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(t===gK.DoubleQuote?vK.Double:vK.Single,this.index),this.state=_K.BeforeAttributeName):this.decodeEntities&&e===gK.Amp&&(this.baseState=this.state,this.state=_K.BeforeEntity)}stateInAttributeValueDoubleQuotes(e){this.handleInAttributeValue(e,gK.DoubleQuote)}stateInAttributeValueSingleQuotes(e){this.handleInAttributeValue(e,gK.SingleQuote)}stateInAttributeValueNoQuotes(e){yK(e)||e===gK.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(vK.Unquoted,this.index),this.state=_K.BeforeAttributeName,this.stateBeforeAttributeName(e)):this.decodeEntities&&e===gK.Amp&&(this.baseState=this.state,this.state=_K.BeforeEntity)}stateBeforeDeclaration(e){e===gK.OpeningSquareBracket?(this.state=_K.CDATASequence,this.sequenceIndex=0):this.state=e===gK.Dash?_K.BeforeComment:_K.InDeclaration}stateInDeclaration(e){(e===gK.Gt||this.fastForwardTo(gK.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=_K.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(e){(e===gK.Gt||this.fastForwardTo(gK.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=_K.Text,this.sectionStart=this.index+1)}stateBeforeComment(e){e===gK.Dash?(this.state=_K.InCommentLike,this.currentSequence=AK.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=_K.InDeclaration}stateInSpecialComment(e){(e===gK.Gt||this.fastForwardTo(gK.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=_K.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(e){const t=32|e;t===AK.ScriptEnd[3]?this.startSpecial(AK.ScriptEnd,4):t===AK.StyleEnd[3]?this.startSpecial(AK.StyleEnd,4):(this.state=_K.InTagName,this.stateInTagName(e))}stateBeforeEntity(e){this.entityExcess=1,this.entityResult=0,e===gK.Num?this.state=_K.BeforeNumericEntity:e===gK.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=_K.InNamedEntity,this.stateInNamedEntity(e))}stateInNamedEntity(e){if(this.entityExcess+=1,this.trieIndex=function(e,t,r,n){const i=(t&mK.BRANCH_LENGTH)>>7,a=t&mK.JUMP_TABLE;if(0===i)return 0!==a&&n===a?r:-1;if(a){const t=n-a;return t<0||t>=i?-1:e[r+t]-1}let s=r,o=s+i-1;for(;s<=o;){const t=s+o>>>1,r=e[t];if(r<n)s=t+1;else{if(!(r>n))return e[t+i];o=t-1}}return-1}(this.entityTrie,this.trieCurrent,this.trieIndex+1,e),this.trieIndex<0)return this.emitNamedEntity(),void this.index--;this.trieCurrent=this.entityTrie[this.trieIndex];const t=this.trieCurrent&mK.VALUE_LENGTH;if(t){const r=(t>>14)-1;if(this.allowLegacyEntity()||e===gK.Semi){const e=this.index-this.entityExcess+1;e>this.sectionStart&&this.emitPartial(this.sectionStart,e),this.entityResult=this.trieIndex,this.trieIndex+=r,this.entityExcess=0,this.sectionStart=this.index+1,0===r&&this.emitNamedEntity()}else this.trieIndex+=r}}emitNamedEntity(){if(this.state=this.baseState,0===this.entityResult)return;switch((this.entityTrie[this.entityResult]&mK.VALUE_LENGTH)>>14){case 1:this.emitCodePoint(this.entityTrie[this.entityResult]&~mK.VALUE_LENGTH);break;case 2:this.emitCodePoint(this.entityTrie[this.entityResult+1]);break;case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}stateBeforeNumericEntity(e){(32|e)===gK.LowerX?(this.entityExcess++,this.state=_K.InHexEntity):(this.state=_K.InNumericEntity,this.stateInNumericEntity(e))}emitNumericEntity(e){const t=this.index-this.entityExcess-1;t+2+Number(this.state===_K.InHexEntity)!==this.index&&(t>this.sectionStart&&this.emitPartial(this.sectionStart,t),this.sectionStart=this.index+Number(e),this.emitCodePoint(function(e){var t;return e>=55296&&e<=57343||e>1114111?65533:null!==(t=dK.get(e))&&void 0!==t?t:e}(this.entityResult))),this.state=this.baseState}stateInNumericEntity(e){e===gK.Semi?this.emitNumericEntity(!0):bK(e)?(this.entityResult=10*this.entityResult+(e-gK.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}stateInHexEntity(e){e===gK.Semi?this.emitNumericEntity(!0):bK(e)?(this.entityResult=16*this.entityResult+(e-gK.Zero),this.entityExcess++):!function(e){return e>=gK.UpperA&&e<=gK.UpperF||e>=gK.LowerA&&e<=gK.LowerF}(e)?(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--):(this.entityResult=16*this.entityResult+((32|e)-gK.LowerA+10),this.entityExcess++)}allowLegacyEntity(){return!this.xmlMode&&(this.baseState===_K.Text||this.baseState===_K.InSpecialTag)}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===_K.Text||this.state===_K.InSpecialTag&&0===this.sequenceIndex?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):this.state!==_K.InAttributeValueDq&&this.state!==_K.InAttributeValueSq&&this.state!==_K.InAttributeValueNq||(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const e=this.buffer.charCodeAt(this.index-this.offset);this.state===_K.Text?this.stateText(e):this.state===_K.SpecialStartSequence?this.stateSpecialStartSequence(e):this.state===_K.InSpecialTag?this.stateInSpecialTag(e):this.state===_K.CDATASequence?this.stateCDATASequence(e):this.state===_K.InAttributeValueDq?this.stateInAttributeValueDoubleQuotes(e):this.state===_K.InAttributeName?this.stateInAttributeName(e):this.state===_K.InCommentLike?this.stateInCommentLike(e):this.state===_K.InSpecialComment?this.stateInSpecialComment(e):this.state===_K.BeforeAttributeName?this.stateBeforeAttributeName(e):this.state===_K.InTagName?this.stateInTagName(e):this.state===_K.InClosingTagName?this.stateInClosingTagName(e):this.state===_K.BeforeTagName?this.stateBeforeTagName(e):this.state===_K.AfterAttributeName?this.stateAfterAttributeName(e):this.state===_K.InAttributeValueSq?this.stateInAttributeValueSingleQuotes(e):this.state===_K.BeforeAttributeValue?this.stateBeforeAttributeValue(e):this.state===_K.BeforeClosingTagName?this.stateBeforeClosingTagName(e):this.state===_K.AfterClosingTagName?this.stateAfterClosingTagName(e):this.state===_K.BeforeSpecialS?this.stateBeforeSpecialS(e):this.state===_K.InAttributeValueNq?this.stateInAttributeValueNoQuotes(e):this.state===_K.InSelfClosingTag?this.stateInSelfClosingTag(e):this.state===_K.InDeclaration?this.stateInDeclaration(e):this.state===_K.BeforeDeclaration?this.stateBeforeDeclaration(e):this.state===_K.BeforeComment?this.stateBeforeComment(e):this.state===_K.InProcessingInstruction?this.stateInProcessingInstruction(e):this.state===_K.InNamedEntity?this.stateInNamedEntity(e):this.state===_K.BeforeEntity?this.stateBeforeEntity(e):this.state===_K.InHexEntity?this.stateInHexEntity(e):this.state===_K.InNumericEntity?this.stateInNumericEntity(e):this.stateBeforeNumericEntity(e),this.index++}this.cleanup()}finish(){this.state===_K.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const e=this.buffer.length+this.offset;this.state===_K.InCommentLike?this.currentSequence===AK.CdataEnd?this.cbs.oncdata(this.sectionStart,e,0):this.cbs.oncomment(this.sectionStart,e,0):this.state===_K.InNumericEntity&&this.allowLegacyEntity()||this.state===_K.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===_K.InTagName||this.state===_K.BeforeAttributeName||this.state===_K.BeforeAttributeValue||this.state===_K.AfterAttributeName||this.state===_K.InAttributeName||this.state===_K.InAttributeValueSq||this.state===_K.InAttributeValueDq||this.state===_K.InAttributeValueNq||this.state===_K.InClosingTagName||this.cbs.ontext(this.sectionStart,e)}emitPartial(e,t){this.baseState!==_K.Text&&this.baseState!==_K.InSpecialTag?this.cbs.onattribdata(e,t):this.cbs.ontext(e,t)}emitCodePoint(e){this.baseState!==_K.Text&&this.baseState!==_K.InSpecialTag?this.cbs.onattribentity(e):this.cbs.ontextentity(e)}}const EK=new Set(["input","option","optgroup","select","button","datalist","textarea"]),wK=new Set(["p"]),CK=new Set(["thead","tbody"]),TK=new Set(["dd","dt"]),DK=new Set(["rt","rp"]),MK=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",wK],["h1",wK],["h2",wK],["h3",wK],["h4",wK],["h5",wK],["h6",wK],["select",EK],["input",EK],["output",EK],["button",EK],["datalist",EK],["textarea",EK],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",TK],["dt",TK],["address",wK],["article",wK],["aside",wK],["blockquote",wK],["details",wK],["div",wK],["dl",wK],["fieldset",wK],["figcaption",wK],["figure",wK],["footer",wK],["form",wK],["header",wK],["hr",wK],["main",wK],["nav",wK],["ol",wK],["pre",wK],["section",wK],["table",wK],["ul",wK],["rt",DK],["rp",DK],["tbody",CK],["tfoot",CK]]),PK=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),FK=new Set(["math","svg"]),RK=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),NK=/\s|\//;class BK{constructor(e,t={}){var r,n,i,a,s;this.options=t,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=null!=e?e:{},this.lowerCaseTagNames=null!==(r=t.lowerCaseTags)&&void 0!==r?r:!t.xmlMode,this.lowerCaseAttributeNames=null!==(n=t.lowerCaseAttributeNames)&&void 0!==n?n:!t.xmlMode,this.tokenizer=new(null!==(i=t.Tokenizer)&&void 0!==i?i:SK)(this.options,this),null===(s=(a=this.cbs).onparserinit)||void 0===s||s.call(a,this)}ontext(e,t){var r,n;const i=this.getSlice(e,t);this.endIndex=t-1,null===(n=(r=this.cbs).ontext)||void 0===n||n.call(r,i),this.startIndex=t}ontextentity(e){var t,r;const n=this.tokenizer.getSectionStart();this.endIndex=n-1,null===(r=(t=this.cbs).ontext)||void 0===r||r.call(t,pK(e)),this.startIndex=n}isVoidElement(e){return!this.options.xmlMode&&PK.has(e)}onopentagname(e,t){this.endIndex=t;let r=this.getSlice(e,t);this.lowerCaseTagNames&&(r=r.toLowerCase()),this.emitOpenTag(r)}emitOpenTag(e){var t,r,n,i;this.openTagStart=this.startIndex,this.tagname=e;const a=!this.options.xmlMode&&MK.get(e);if(a)for(;this.stack.length>0&&a.has(this.stack[this.stack.length-1]);){const e=this.stack.pop();null===(r=(t=this.cbs).onclosetag)||void 0===r||r.call(t,e,!0)}this.isVoidElement(e)||(this.stack.push(e),FK.has(e)?this.foreignContext.push(!0):RK.has(e)&&this.foreignContext.push(!1)),null===(i=(n=this.cbs).onopentagname)||void 0===i||i.call(n,e),this.cbs.onopentag&&(this.attribs={})}endOpenTag(e){var t,r;this.startIndex=this.openTagStart,this.attribs&&(null===(r=(t=this.cbs).onopentag)||void 0===r||r.call(t,this.tagname,this.attribs,e),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(e){this.endIndex=e,this.endOpenTag(!1),this.startIndex=e+1}onclosetag(e,t){var r,n,i,a,s,o;this.endIndex=t;let l=this.getSlice(e,t);if(this.lowerCaseTagNames&&(l=l.toLowerCase()),(FK.has(l)||RK.has(l))&&this.foreignContext.pop(),this.isVoidElement(l))this.options.xmlMode||"br"!==l||(null===(n=(r=this.cbs).onopentagname)||void 0===n||n.call(r,"br"),null===(a=(i=this.cbs).onopentag)||void 0===a||a.call(i,"br",{},!0),null===(o=(s=this.cbs).onclosetag)||void 0===o||o.call(s,"br",!1));else{const e=this.stack.lastIndexOf(l);if(-1!==e)if(this.cbs.onclosetag){let t=this.stack.length-e;for(;t--;)this.cbs.onclosetag(this.stack.pop(),0!==t)}else this.stack.length=e;else this.options.xmlMode||"p"!==l||(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=t+1}onselfclosingtag(e){this.endIndex=e,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=e+1):this.onopentagend(e)}closeCurrentTag(e){var t,r;const n=this.tagname;this.endOpenTag(e),this.stack[this.stack.length-1]===n&&(null===(r=(t=this.cbs).onclosetag)||void 0===r||r.call(t,n,!e),this.stack.pop())}onattribname(e,t){this.startIndex=e;const r=this.getSlice(e,t);this.attribname=this.lowerCaseAttributeNames?r.toLowerCase():r}onattribdata(e,t){this.attribvalue+=this.getSlice(e,t)}onattribentity(e){this.attribvalue+=pK(e)}onattribend(e,t){var r,n;this.endIndex=t,null===(n=(r=this.cbs).onattribute)||void 0===n||n.call(r,this.attribname,this.attribvalue,e===vK.Double?'"':e===vK.Single?"'":e===vK.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(e){const t=e.search(NK);let r=t<0?e:e.substr(0,t);return this.lowerCaseTagNames&&(r=r.toLowerCase()),r}ondeclaration(e,t){this.endIndex=t;const r=this.getSlice(e,t);if(this.cbs.onprocessinginstruction){const e=this.getInstructionName(r);this.cbs.onprocessinginstruction(`!${e}`,`!${r}`)}this.startIndex=t+1}onprocessinginstruction(e,t){this.endIndex=t;const r=this.getSlice(e,t);if(this.cbs.onprocessinginstruction){const e=this.getInstructionName(r);this.cbs.onprocessinginstruction(`?${e}`,`?${r}`)}this.startIndex=t+1}oncomment(e,t,r){var n,i,a,s;this.endIndex=t,null===(i=(n=this.cbs).oncomment)||void 0===i||i.call(n,this.getSlice(e,t-r)),null===(s=(a=this.cbs).oncommentend)||void 0===s||s.call(a),this.startIndex=t+1}oncdata(e,t,r){var n,i,a,s,o,l,u,c,h,d;this.endIndex=t;const p=this.getSlice(e,t-r);this.options.xmlMode||this.options.recognizeCDATA?(null===(i=(n=this.cbs).oncdatastart)||void 0===i||i.call(n),null===(s=(a=this.cbs).ontext)||void 0===s||s.call(a,p),null===(l=(o=this.cbs).oncdataend)||void 0===l||l.call(o)):(null===(c=(u=this.cbs).oncomment)||void 0===c||c.call(u,`[CDATA[${p}]]`),null===(d=(h=this.cbs).oncommentend)||void 0===d||d.call(h)),this.startIndex=t+1}onend(){var e,t;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let e=this.stack.length;e>0;this.cbs.onclosetag(this.stack[--e],!0));}null===(t=(e=this.cbs).onend)||void 0===t||t.call(e)}reset(){var e,t,r,n;null===(t=(e=this.cbs).onreset)||void 0===t||t.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,null===(n=(r=this.cbs).onparserinit)||void 0===n||n.call(r,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(e){this.reset(),this.end(e)}getSlice(e,t){for(;e-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let r=this.buffers[0].slice(e-this.bufferOffset,t-this.bufferOffset);for(;t-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),r+=this.buffers[0].slice(0,t-this.bufferOffset);return r}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(e){var t,r;this.ended?null===(r=(t=this.cbs).onerror)||void 0===r||r.call(t,new Error(".write() after done!")):(this.buffers.push(e),this.tokenizer.running&&(this.tokenizer.write(e),this.writeIndex++))}end(e){var t,r;this.ended?null===(r=(t=this.cbs).onerror)||void 0===r||r.call(t,Error(".end() after done!")):(e&&this.write(e),this.ended=!0,this.tokenizer.end())}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(e){this.write(e)}done(e){this.end(e)}}var IK;!function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"}(IK||(IK={})),IK.Root,IK.Text,IK.Directive,IK.Comment,IK.Script,IK.Style,IK.Tag,IK.CDATA,IK.Doctype;class OK{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(e){this.parent=e}get previousSibling(){return this.prev}set previousSibling(e){this.prev=e}get nextSibling(){return this.next}set nextSibling(e){this.next=e}cloneNode(e=!1){return qK(this,e)}}class kK extends OK{static className="DataNode";constructor(e){super(),this.data=e}get nodeValue(){return this.data}set nodeValue(e){this.data=e}}class LK extends kK{static className="Text";constructor(){super(...arguments),this.type=IK.Text}get nodeType(){return 3}}class UK extends kK{static className="Comment";constructor(){super(...arguments),this.type=IK.Comment}get nodeType(){return 8}}class zK extends kK{static className="ProcessingInstruction";constructor(e,t){super(t),this.name=e,this.type=IK.Directive}get nodeType(){return 1}}class jK extends OK{static className="NodeWithChildren";constructor(e){super(),this.children=e}get firstChild(){var e;return null!==(e=this.children[0])&&void 0!==e?e:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(e){this.children=e}}class VK extends jK{static className="CDATA";constructor(){super(...arguments),this.type=IK.CDATA}get nodeType(){return 4}}let GK=class extends jK{static className="Document";constructor(){super(...arguments),this.type=IK.Root}get nodeType(){return 9}};class WK extends jK{static className="Element";constructor(e,t,r=[],n=("script"===e?IK.Script:"style"===e?IK.Style:IK.Tag)){super(r),this.name=e,this.attribs=t,this.type=n}get nodeType(){return 1}get tagName(){return this.name}set tagName(e){this.name=e}get attributes(){return Object.keys(this.attribs).map((e=>{var t,r;return{name:e,value:this.attribs[e],namespace:null===(t=this["x-attribsNamespace"])||void 0===t?void 0:t[e],prefix:null===(r=this["x-attribsPrefix"])||void 0===r?void 0:r[e]}}))}}function HK(e){return(t=e).type===IK.Tag||t.type===IK.Script||t.type===IK.Style;var t}function qK(e,t=!1){let r;if(function(e){return e.type===IK.Text}(e))r=new LK(e.data);else if(function(e){return e.type===IK.Comment}(e))r=new UK(e.data);else if(HK(e)){const n=t?XK(e.children):[],i=new WK(e.name,{...e.attribs},n);n.forEach((e=>e.parent=i)),null!=e.namespace&&(i.namespace=e.namespace),e["x-attribsNamespace"]&&(i["x-attribsNamespace"]={...e["x-attribsNamespace"]}),e["x-attribsPrefix"]&&(i["x-attribsPrefix"]={...e["x-attribsPrefix"]}),r=i}else if(function(e){return e.type===IK.CDATA}(e)){const n=t?XK(e.children):[],i=new VK(n);n.forEach((e=>e.parent=i)),r=i}else if(function(e){return e.type===IK.Root}(e)){const n=t?XK(e.children):[],i=new GK(n);n.forEach((e=>e.parent=i)),e["x-mode"]&&(i["x-mode"]=e["x-mode"]),r=i}else{if(!function(e){return e.type===IK.Directive}(e))throw new Error(`Not implemented yet: ${e.type}`);{const t=new zK(e.name,e.data);null!=e["x-name"]&&(t["x-name"]=e["x-name"],t["x-publicId"]=e["x-publicId"],t["x-systemId"]=e["x-systemId"]),r=t}}return r.startIndex=e.startIndex,r.endIndex=e.endIndex,null!=e.sourceCodeLocation&&(r.sourceCodeLocation=e.sourceCodeLocation),r}function XK(e){const t=e.map((e=>qK(e,!0)));for(let e=1;e<t.length;e++)t[e].prev=t[e-1],t[e-1].next=t[e];return t}const QK={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class KK{constructor(e,t,r){this.dom=[],this.root=new GK(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,"function"==typeof t&&(r=t,t=QK),"object"==typeof e&&(t=e,e=void 0),this.callback=null!=e?e:null,this.options=null!=t?t:QK,this.elementCB=null!=r?r:null}onparserinit(e){this.parser=e}onreset(){this.dom=[],this.root=new GK(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(e){this.handleCallback(e)}onclosetag(){this.lastNode=null;const e=this.tagStack.pop();this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(e)}onopentag(e,t){const r=this.options.xmlMode?IK.Tag:void 0,n=new WK(e,t,void 0,r);this.addNode(n),this.tagStack.push(n)}ontext(e){const{lastNode:t}=this;if(t&&t.type===IK.Text)t.data+=e,this.options.withEndIndices&&(t.endIndex=this.parser.endIndex);else{const t=new LK(e);this.addNode(t),this.lastNode=t}}oncomment(e){if(this.lastNode&&this.lastNode.type===IK.Comment)return void(this.lastNode.data+=e);const t=new UK(e);this.addNode(t),this.lastNode=t}oncommentend(){this.lastNode=null}oncdatastart(){const e=new LK(""),t=new VK([e]);this.addNode(t),e.parent=t,this.lastNode=e}oncdataend(){this.lastNode=null}onprocessinginstruction(e,t){const r=new zK(e,t);this.addNode(r)}handleCallback(e){if("function"==typeof this.callback)this.callback(e,this.dom);else if(e)throw e}addNode(e){const t=this.tagStack[this.tagStack.length-1],r=t.children[t.children.length-1];this.options.withStartIndices&&(e.startIndex=this.parser.startIndex),this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),t.children.push(e),r&&(e.prev=r,r.next=e),e.parent=t,this.lastNode=null}}var YK=function(){var e=function(){var e=document.createElement("canvas"),t=e.getContext("2d");return{canvas:!!t,imageData:!!t.getImageData,dataURL:!!e.toDataURL,btoa:!!window.btoa}}(),t="image/octet-stream";function r(e,t,r){var n=e.width,i=e.height;void 0===t&&(t=n),void 0===r&&(r=i);var a=document.createElement("canvas"),s=a.getContext("2d");return a.width=t,a.height=r,s.drawImage(e,0,0,n,i,0,0,t,r),a}function n(e,t,n,i){return(e=r(e,n,i)).toDataURL(t)}function i(e,t,r){void 0===r&&(r="name");var n=document.createElement("a");n.download=r+"."+t,n.href=e,n.click()}function a(e){var t=document.createElement("img");return t.src=e,t}function s(e){return"image/"+(e=e.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function o(e){if(!window.btoa)throw"btoa undefined";var t="";if("string"==typeof e)t=e;else for(var r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function l(e){var t=e.width,r=e.height;return e.getContext("2d").getImageData(0,0,t,r)}function u(e,t){return"data:"+t+";base64,"+e}var c=function(e){var t=e.width,r=e.height,n=t*r*3,i=n+54,a=[66,77,255&i,i>>8&255,i>>16&255,i>>24&255,0,0,0,0,54,0,0,0],s=[40,0,0,0,255&t,t>>8&255,t>>16&255,t>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,1,0,24,0,0,0,0,0,255&n,n>>8&255,n>>16&255,n>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=(4-3*t%4)%4,u=e.data,c="",h=t<<2,d=r,p=String.fromCharCode;do{for(var f=h*(d-1),m="",g=0;g<t;g++){var _=g<<2;m+=p(u[f+_+2])+p(u[f+_+1])+p(u[f+_])}for(var v=0;v<l;v++)m+=String.fromCharCode(0);c+=m}while(--d);return o(a.concat(s))+o(c)},h=function(a,o,h,d,p){var f=d;if(e.canvas&&e.dataURL)if("string"==typeof a&&(a=document.getElementById(a)),void 0===d&&(d="png"),d=s(d),/bmp/.test(d)){var m=l(r(a,o,h));i(u(c(m),t),f,p)}else{i(n(a,d,o,h).replace(d,t),f,p)}},d=function(t,i,o,h){if(e.canvas&&e.dataURL){if("string"==typeof t&&(t=document.getElementById(t)),void 0===h&&(h="png"),h=s(h),/bmp/.test(h)){var d=l(r(t,i,o));return a(u(c(d),"image/bmp"))}return a(n(t,h,i,o))}};return{saveAsImage:h,saveAsPNG:function(e,t,r,n){return h(e,t,r,"png",n)},saveAsJPEG:function(e,t,r,n){return h(e,t,r,"jpeg",n)},saveAsGIF:function(e,t,r,n){return h(e,t,r,"gif",n)},saveAsBMP:function(e,t,r,n){return h(e,t,r,"bmp",n)},convertToImage:d,convertToPNG:function(e,t,r){return d(e,t,r,"png")},convertToJPEG:function(e,t,r){return d(e,t,r,"jpeg")},convertToGIF:function(e,t,r){return d(e,t,r,"gif")},convertToBMP:function(e,t,r){return d(e,t,r,"bmp")}}}(),ZK=["actualBoundingBoxAscent","actualBoundingBoxDescent","actualBoundingBoxLeft","actualBoundingBoxRight","fontBoundingBoxAscent","fontBoundingBoxDescent","width"],JK=Qq("htmlParser");class $K{constructor(e){void 0===e&&(e={}),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d");var t=e.width||1,r=e.height||1;this.resize(t,r)}_setupContext(e){var t=sX.parseValue(e.fontWeight,"Normal"),r=sX.parseValue(e.type,"Arial"),n=sX.parseCSSColor(e.color),i=e.shadowColor,a=this._context,s=e.size;if(s&&(a.font=t+" "+s.toString(10)+"px "+r),a.fillStyle=n,i){var o=sX.parseValue(e.shadowAlpha,1),l=sX.parseValue(e.shadowAngle,0),u=sX.parseValue(e.shadowDistance,0),c=sX.parseValue(e.shadowBlur,1),h=zu.degToRad(l),d=sX.parseColor(i);a.shadowColor="rgba("+255*d[0]+","+255*d[1]+","+255*d[2]+","+o+")",a.shadowBlur=c,a.shadowOffsetX=Math.cos(h)*u,a.shadowOffsetY=Math.sin(h)*u}else a.shadowColor=0,a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0;a.textAlign=sX.parseValue(e.textAlign,a.textAlign),a.textBaseline=sX.parseValue(e.textBaseline,a.textBaseline)}_setupContextAlign(){var e=this._context;e.textAlign="center",e.textBaseline="middle"}_getStartX(e){return"Left"==e?0:"Right"==e?this._canvas.width:this._canvas.width/2}_getRowHeight(e,t,r,n){var i=this._getFontHeight(e,t);return Math.max(i+n,r)}_createMetrics(e){var t={};return ZK.forEach((r=>{sX.isValid(e[r])&&(t[r]=e[r])})),t}_createTextRow(e,t,r,n){var i={text:e,lineNumber:t,metrics:this._createMetrics(r)};return n&&Object.keys(n).length&&(i.options=Object.assign({},n)),i}_createTextRows(e,t){this._setupContext(t),this._setupContextAlign();for(var r=sX.parseValue(t.lineWidth,1/0),n=e.split(""),i="",a=[],s=0;s<n.length;s++){var o=n[s],l=this._context.measureText(i);"\n"==o||l.width>=r?(a.push(this._createTextRow(i,this._lineNumber++,l,t)),i=""):i+=o}var u=this._context.measureText(i);return a.push(this._createTextRow(i,this._lineNumber,u,t)),a}_createRichTextRowOptions(e){if(!e)return null;var t=e.style;if(!t)return null;var r={};return t.split(";").forEach((e=>{if(!e._isBlank()){var t=e.split(":"),n=t[0],i=t[1];if(n){if(n=n._trimBoth(" \t"),i=i._trimBoth(" \t"),"font-size"===n)n="size",i=Number(i._trimRight(" px"));r[n]=i}}})),r}_createRichTextRows(e,t,r){var n=this._createRichTextRowOptions(t.attribs);if(n){for(var i in r)void 0===n[i]&&(n[i]=r[i]);r=n}"text"==t.type&&(this._setupContext(r),this._setupContextAlign(),this._createTextRows(t.data,r).forEach((t=>{e.push(t)})));var a=t.children;a&&a.forEach((t=>{this._createRichTextRows(e,t,r)}))}_getRichTextRows(e,t){var r=this,n=t.size||10,i=sX.parseValue(t.lineHeight,n),a=sX.parseValue(t.shadowDistance,0),s=sX.parseValue(t.shadowAngle,0),o=zu.degToRad(s),l=Math.sin(o)*a,u=qq($K,JK)[JK].parse(e),c=[];if(u.forEach((e=>{this._createRichTextRows(c,e,t)})),c.length){for(var h={},d=0;d<c.length;d++){var p=c[d];h[p.lineNumber]=h[p.lineNumber]||[],h[p.lineNumber].push(p)}var f=function(){var e=h[m];if(e.length>1){var t=0,a=0,s=0;e.forEach((e=>{var o=e.metrics;t+=o.width,a=Math.max(a,r._getRowHeight(o,n,i,l)),s=Math.max(s,o.fontBoundingBoxDescent),e.options.textAlign="left"})),e[0].offsetX=-t/2,e.forEach((e=>{e.height=a}))}else e[0].height=r._getRowHeight(e[0].metrics,n,i,l)};for(var m in h)f()}return c}_getTextRows(e,t){var r=t.size||10,n=sX.parseValue(t.lineHeight,r),i=sX.parseValue(t.shadowDistance,0),a=sX.parseValue(t.shadowAngle,0),s=zu.degToRad(a),o=Math.sin(s)*i,l=this._createTextRows(e,t);return l.length&&l.forEach((e=>{e.height=this._getRowHeight(e.metrics,r,n,o)})),l}_getFontHeight(e,t){return void 0!==e.fontBoundingBoxAscent&&void 0!==e.fontBoundingBoxDescent?e.fontBoundingBoxAscent+e.fontBoundingBoxDescent:void 0!==e.actualBoundingBoxAscent&&void 0!==e.actualBoundingBoxDescent?e.actualBoundingBoxAscent+e.actualBoundingBoxDescent:t}_getRenderSize(e,t){if(!e.length)return[0,0];var r=t.size||10,n=t.powerOfTwo,i=2*sX.fontSizeToPixelSize(r),a=Math.max(64,zu.ceilPowerOfTwo(i)),s=1,o=[0,0];return e.forEach((e=>{var t=e.metrics,r=e.height;o[1]?s!=e.lineNumber?(s=e.lineNumber,o[0]=Math.max(o[0],t.width),o[1]+=r):o[0]=Math.max(o[0],o[0]+t.width):(o[0]=Math.max(o[0],t.width),o[1]+=r)})),o=n?[Math.max(a,zu.ceilPowerOfTwo(o[0])),Math.max(a,zu.ceilPowerOfTwo(o[1]))]:[Math.ceil(o[0]),Math.ceil(o[1])]}dispose(){this._canvas=null,this._context=null}getContext(){return this._canvas}getImageData(e,t,r,n){var i=this._canvas.getContext("2d");return new Uint8Array(i.getImageData(e,t,r,n).data.buffer)}resize(e,t){var r=this._canvas;r.width=e,r.height=t,r.style.width=e+"px",r.style.height=t+"px"}clear(){var e=this._canvas;e.getContext("2d").clearRect(0,0,e.width,e.height)}getTextRows(e,t){void 0===t&&(t={});var r=t.richText;this._lineNumber=1;var n=[];return{rows:n=r?this._getRichTextRows(e,t):this._getTextRows(e,t),size:this._getRenderSize(n,t)}}drawText(e,t){var r=e.rows;if(r.length){var n=t.alignType||"Center",i=sX.parseValue(t.stroke,!1),a=this._context,s=a[i?"strokeText":"fillText"];this._setupContext(t),this._setupContextAlign(n);for(var o=this._getStartX(n),l=r[0].height/2,u=r[0].lineNumber,c=0,h=r.length;c<h;c++){var d=r[c],p=d.text,f=d.options;f&&this._setupContext(f),d.offsetX&&(o+=d.offsetX),s.call(a,p,o,l),c!=h-1&&r[c+1].lineNumber!=u?(o=this._getStartX(n),l+=r[c+1].height,u++):o+=d.metrics.width}}}fillRect(e,t,r,n,i){this._context.fillStyle=sX.parseCSSColor(i),this._context.fillRect(e,t,r,n)}convertToImage(e,t){var r=this._canvas,n=e||r.width,i=t||r.height;return YK.convertToImage(r,n,i)}}Object.defineProperty($K,JK,{writable:!0,value:new class{constructor(e){this._dom=null;var t=new KK(((e,t)=>{this._dom=t}));this._parser=new BK(t,{recognizeCDATA:!0})}parse(e){return this._parser.parseComplete(e),this._dom}}});class eY{constructor(){}imageToBase64(e){return sX.imageToBase64(e)}base64ToImage(e){return sX.base64ToImage(e)}}class tY{constructor(e){void 0===e&&(e={}),this._instance=null,this._exports=null,this._memory=null,this._registers={},this._bufferAllocator=null,this._onError=e.onError||function(){we.error.apply(console,arguments)},function(){var e=!1;try{var t=new Uint8Array([0,97,115,109,1,0,0,0,1,7,1,96,2,127,127,1,127,3,2,1,0,7,7,1,3,88,79,82,0,0,10,9,1,7,0,32,0,32,1,115,11]),r=new WebAssembly.Instance(new WebAssembly.Module(t)).exports.XOR;if(57005!==r(65280,8621)||48879!==r(43605,5306))throw!1;e=!0}catch(t){e=!1}return e}()||this._onError({error:"WASM is not support"})}_utf8ToString(e){for(var t=new Uint8Array(this._memory.buffer,e),r=0,n=0;n<t.length&&0!=t[n];n++,r++);return(new TextDecoderLite).decode(new Uint8Array(this._memory.buffer,e,r))}_nativeToJSBuffer(e){for(var t=this._bufferAllocator.getBlockSize(e),r=new Uint8Array(this._memory.buffer,e,t),n=new Uint8Array(t),i=0;i<t;i++)n[i]=r[i];return n}_pushStringArgument(e){for(var t=we.bufferToString(e),r=t.length,n=this._bufferAllocator.malloc(r+1),a=new Uint8Array(this._memory.buffer,n,r+1),s=0;s<r;s++)a[s]=t[s];return a[i]=0,{value:n,needRelease:!0}}_pushBufferArgument(e){var t=e.length?e.length:e.byteLength,r=this._bufferAllocator.malloc(t),n=new Uint8Array(this._memory.buffer,r,t);e=e instanceof ArrayBuffer?new Uint8Array(e):e;for(var i=0;i<t;i++)n[i]=e[i];return{value:r,needRelease:!0}}_pushNumberArgument(e){return{value:e}}_pushArguments(e,t,r,n){for(var i=0;i<e.args.length;i++){var a=e.args[i],s=a.type,o=a.defaultValue,l=void 0;void 0===(l=i+t<r.length?r[i+t]:o)&&(this._onError('Input invalid argument"index:('+i+")please check it"),l=0);var u=0;"string"==s?u=this._pushStringArgument(l):"buffer"==s?u=this._pushBufferArgument(l):"int"==s?u=this._pushNumberArgument(l):this._onError("Invalid argument type: '"+s+"'"),n.push(u)}}_getRetValue(e,t){var r=e.retType,n=null;return r.startsWith("string")?n=this._utf8ToString(t):r.startsWith("buffer")?n=this._toBuffer(t):r.startsWith("int")?n=t:r.startsWith("void")?n=void 0:this._onError("Get asm return value failed, due to unknown '"+r+"' type"),-1!==r.indexOf("*")&&this._bufferAllocator.free(t),n}_callNativeFunction(e,t){var r=this._exports[e];if(r){var n=t.map((e=>e.value)),i=r.apply(n);return t.forEach((e=>{e.needRelease&&this._bufferAllocator.free(e.value)})),i}this._onError("Failed to call WASM Function '"+e+"', due to it's not existing")}_buildDefaultJSFunctions(){var e=this;return{exit:function(e){},malloc:function(t){return e._bufferAllocator.malloc(t)},free:function(t){e._bufferAllocator.free(t)},printLog:function(t,r){if(void 0===r)we.log(t);else{var n=new Uint8Array(e._memory.buffer,t,r);we.log(we.bufferToString(n))}}}}_loadFromByteCode(e,t){var r=this;new Promise((function(t,r){t(WebAssembly.compile(e))})).then((function(e){new Promise((function(t,n){var i=r._buildDefaultJSFunctions();t(WebAssembly.instantiate(e,i))})).then((function(e){t(e)}))}))}_loadFromURL(e,t){var r={env:{abort(e,t,r,n){we.error(e,"abort called at '"+t+"':"+r+":"+n)}}},n=new XMLHttpRequest;n.open("GET",e),n.responseType="arraybuffer",n.send(),n.onload=function(){var e=n.response;WebAssembly.instantiate(e,r).then((e=>{t(e.instance)})),n.onload=null}}_init(e){this._instance=e,this._exports=this._instance.exports,this._memory=this._exports.memory,this._bufferAllocator=new tr({memory:this._memory})}loadFromURL(e,t){var r=this;this._loadFromURL(e,(e=>{r._init(e),t&&t({object:r})}))}loadFromByteCode(e,t){var r=this;this._loadFromByteCode(e,(e=>{r._init(e),t&&t({object:r})}))}register(e,t){var r=function(e,t){var r=function(e){var t=e.indexOf("(");return-1===t?null:e.substring(0,t)}(t=(t=t._replaceAll(" ",""))._replaceAll("\t","")),n=function(e){if(-1===e.indexOf("("))return null;if(-1===e.indexOf(")"))return null;for(var t=[],r=0;r<t.length;r++){var n=t[r];if(-1!==n.indexOf(":")){var i=n.split(":"),a=i[1];"true"==a?a=!0:"false"==a&&(a=!1),t.push({type:i[0],defaultValue:a})}else t.push({type:n})}return t}(t);return{retType:r,args:n,funcName:e}}(e,t);if(!r)return this._onError("WASM register function failed, due to (name:'"+e+"', decl:'"+t+"') is invalid"),!1;this._registers[e]=r;var n=this;return this[funcName]=function(){var t=[];n._pushArguments(r,0,arguments,t);var i=n._callNativeFunction(e,t);return n._getRetValue(r,i)},!0}getExports(){return this._exports}}class rY{constructor(){this._object=null,this._domElement=null,this._enable=!0,this._enablePropagation=!0,this._mouseEventManager=null,this._delta=null,this._onTriggerEvent=null}_unregisterEvents(){this._mouseEventManager&&(this._mouseEventManager.dispose(),this._mouseEventManager=null)}_registerEvents(){var e=this._domElement;this._mouseEventManager=new oQ({domElement:e,onTriggerEvent:t=>{if(this._enable){var r=sX.buildMouseEvent(e,t),n=this._mouseEventManager.moveDelta;r.deltaX=n[0],r.deltaY=n[1],this._onTriggerEvent&&this._onTriggerEvent(r),this._enablePropagation||t.stopPropagation()}}})}onAdd(e){this._object=e}onRemove(){this._unregisterEvents()}get object(){return this._object}get enable(){return this._enable}set enable(e){this._enable=e}get enablePropagation(){return this._enablePropagation}set enablePropagation(e){this._enablePropagation=e}get domElement(){return this._domElement}set domElement(e){this._unregisterEvents(),this._domElement=e;var t=this._domElement.style;t.cursor="default",t.pointerEvents="all",this._registerEvents()}get onTriggerEvent(){return this._onTriggerEvent}set onTriggerEvent(e){this._onTriggerEvent=e}}class nY extends rY{constructor(){super(),this._enableEventProxy=!1,this.onTriggerEvent=e=>{var t=this._domElement,r=rK.current,n=e.type;this._enableEventProxy?this._object.trigger(n,e):"mouseenter"==n?r.dispatchEvent({type:"domenter",domElement:t}):"mouseleave"==n&&r.dispatchEvent({type:"domleave",domElement:t})},this._active=!0,this._zIndex=null,this._visible=null}updateDomElementVisibility(e){void 0===e&&(e=!0);var t=!1;return null===this._visible?e&&this._object.visible&&(t=!0):e&&(t=this._visible),this._domElement._setVisible(t),t}onVisibleChange(e){this._domElement&&null===this._visible&&this._domElement._setVisible(e)}get active(){return this._active}set active(e){this._active!=e&&(this._active=e,e||this.updateDomElementVisibility(!1))}get enableEventProxy(){return this._enableEventProxy}set enableEventProxy(e){this._enableEventProxy=e}get visible(){return this._visible}set visible(e){this._visible=e}get zIndex(){return sX.isValid(this._zIndex)?this._zIndex:this._domElement?this._domElement.style.zIndex:null}set zIndex(e){this._zIndex=e,sX.isValid(e)&&this._domElement&&(this._domElement.style.zIndex=e)}get interactive(){return"all"==this.domElement.style.pointerEvents}set interactive(e){this.domElement.style.pointerEvents=e?"all":"none"}get domElement(){return super.domElement}set domElement(e){super.domElement=e;var t=this._domElement;null!==this._visible&&t._setVisible(this._visible),null!==this._zIndex&&(t.style.zIndex=this._zIndex)}}nY.className="BaseCSSComponent";var iY=zu.createVec3(),aY=zu.createVec3();class sY extends nY{constructor(){super(),this._offset=null,this._pivot=[.5,.5],this._autoRemove=!0}_isVisible(e){return!(e[2]>1)}onRemove(){if(this._domElement&&this._autoRemove){var e=this._domElement.parentNode;e&&e.removeChild(this._domElement)}this._domElement=null,super.onRemove()}onRender(e){var t=this._domElement;if(t){var r;r=this._offset?e.selfToWorld(this._offset,!1,iY):e.getCenter(iY);var n=e.worldToScreen(r,aY),i=this._isVisible(n);if(this.updateDomElementVisibility(i)){if(sX.isNull(this._zIndex)){var a=1e3-Math.ceil(1e4*n[2]-9900);t._setZIndex(a)}var s=t._getOffsetWidth(1.5),o=t._getOffsetHeight(1.5),l=t._getPositionByPivot(rK.current.domElement,s,o,n,this._pivot);t._setLeft(l[0]),t._setTop(l[1])}}}get autoRemove(){return this._autoRemove}set autoRemove(e){this._autoRemove=e}get offset(){return this._offset}set offset(e){this._offset=e?e.slice(0):null}get pivot(){return this._pivot}set pivot(e){this._pivot=e?e.slice(0):[.5,.5]}}sY.className="CSS2DComponent";var oY=zu.createMat4();class lY extends nY{constructor(){super(),this._renderType="Sprite",this._pivot=null,this._offset=[0,0,0],this._css3DNode=null,this._cssFactor=1/30,this._waitingCommands=[]}_updateCSS3DObjectScale(){var e=this._cssFactor;this._css3DNode.scale=[e,e,1]}_updateCSS3DObjectQuaternion(){}_updateCSS3DObjectPositionByPivot(e,t,r){var n=this._domElement,i=this._css3DNode,a=i.isSprite?i.worldScale:i.scale,s=t*a[0],o=r*a[1],l=(.5-e[0])*s,u=(.5-e[1])*o,c=Math.round(l),h=Math.round(u);i.isSprite?(n._setLeft(c),n._setTop(h),i.position=[0,0,0]):(n._setLeft(0),n._setTop(0),i.position=[c,h,0])}_processWaitingCommands(){var e=this._waitingCommands;if(e.length){var t=this.domElement;t.scrollWidth&&t.scrollHeight&&(e.forEach((e=>{e.onProcess()})),e.length=0)}}onRemove(){this._css3DNode&&(this.onDisposeCSS3DNode(this._css3DNode),this._css3DNode=null),super.onRemove()}onVisibleChange(e){var t=this._css3DNode;t&&(t.visible=e)}onRender(){var e=this._css3DNode;if(e){var t=null===this._visible||this._visible;if(e.visible=t,this.updateDomElementVisibility(t)){var r=this._object.node.getMatrixWorld(oY);r[12]+=this._offset[0],r[13]+=this._offset[1],r[14]+=this._offset[2],e.parentMatrix=r;var n=this.domElement,i=n.scrollWidth,a=n.scrollHeight;if(i&&a){this._updateCSS3DObjectScale(),this._updateCSS3DObjectQuaternion();var s=this._pivot;s&&this._updateCSS3DObjectPositionByPivot(s,i,a)}else if(e.visible){var o=1e-8;this._css3DNode.scale=[o,o,o]}}this._processWaitingCommands()}}onCreateCSS3DNode(){return rK.current.createCSS3DNode(this._renderType)}onDisposeCSS3DNode(e){rK.current.disposeCSS3DNode(e)}get css3DNode(){return this._css3DNode}get domElement(){return super.domElement}set domElement(e){super.domElement=e,this._css3DNode?this._css3DNode.domElement!=e&&(this._css3DNode.domElement=e,rK.current.css3DRenderer.removeCache(this._css3DNode)):(this._css3DNode=this.onCreateCSS3DNode(),this._css3DNode.visible=this._object.visible,this._css3DNode.domElement=e)}get pivot(){return this._pivot?this._pivot:[.5,.5]}set pivot(e){if(e)this._pivot=e.slice(0);else{this._pivot=null;var t=this.domElement,r=t.scrollWidth,n=t.scrollHeight;r&&n&&this._updateCSS3DObjectPositionByPivot([.5,.5],r,n)}}get offset(){return this._offset}set offset(e){this._offset=e?e.slice(0):[0,0,0]}get factor(){return this._cssFactor}set factor(e){this._cssFactor=e}get renderType(){var e=this._css3DNode;return e?e.renderType:this._renderType}set renderType(e){this._renderType=e;var t=this.domElement;if(t){this._css3DNode.renderType=e;var r=t.scrollWidth,n=t.scrollHeight;r&&n||(this._css3DNode.scale=[1/0,1/0,1/0])}else this._waitingCommands.push({onProcess:()=>{this.renderType=e}})}}lY.className="CSS3DComponent";var uY=zu.createVec3(),cY=zu.createQuat();class hY extends lY{constructor(){super(),this._cssFactor=1e3,this._url="",this._domWidth=0,this._domHeight=0,this._regionNode=null}_updateCSS3DObjectPosition(){this._regionNode.getWorldPosition(uY);var e=this._cssFactor;this._css3DNode.position=[uY[0]*e,uY[1]*e,uY[2]*e]}_updateCSS3DObjectQuaternion(){this._regionNode.getWorldQuaternion(cY),this._css3DNode.quaternion=cY}_updateCSS3DObjectScale(){var e=this.domElement,t=e.scrollWidth,r=e.scrollHeight;if(t&&r){this._regionNode.getWorldScale(uY);var n=this._cssFactor,i=n/(t/uY[0]),a=n/(r/uY[1]);this._css3DNode.scale=[i,a,1]}}onRender(){this._regionNode&&this.updateDomElementVisibility()&&(this._updateCSS3DObjectScale(),this._updateCSS3DObjectQuaternion(),this._updateCSS3DObjectPosition(),this._processWaitingCommands())}onCreateCSS3DNode(){return rK.current.createWebViewCSS3DNode(this._renderType)}onDisposeCSS3DNode(){rK.current.disposeWebViewCSS3DNode(this._css3DNode)}get regionNode(){return this._regionNode}set regionNode(e){this._regionNode=e}get url(){return this._url}set url(e){this._url=e,this.domElement=document.createElement("iframe"),this.domElement.src=e,this.domElement.style.border="none",this.domElement.style.width=this._domWidth,this.domElement.style.height=this._domHeight,this.domElement.style.width=this._domWidth+"px",this.domElement.style.height=this._domHeight+"px"}get domWidth(){return this._domWidth}set domWidth(e){this._domWidth=e,this.domElement&&(this.domElement.style.width=this._domWidth,this.domElement.style.width=this._domWidth+"px")}get domHeight(){return this._domHeight}set domHeight(e){this._domHeight=e,this.domElement&&(this.domElement.style.height=this._domHeight,this.domElement.style.height=this._domHeight+"px")}}hY.className="WebViewComponent";var dY="__xhr",pY=["load","loadend","timeout","error","readystatechange","abort"];function fY(e,t){var r={};for(var n in e)r[n]=e[n];return r.target=r.currentTarget=t,r}var mY=pY[0],gY=pY[1],_Y=pY[2],vY=pY[3],yY=pY[4],xY=pY[5],bY="prototype";function AY(e,t){if((t=t||window).__xhr)throw"Ajax is already hooked.";return function(e,t){var r=e.onRequest,n=e.onResponse,i=e.onError;function a(e,t){var r=new MY(e),i={response:t.response||t.responseText,status:t.status,statusText:t.statusText,config:e.config,headers:e.resHeader||e.getAllResponseHeaders().split("\r\n").reduce((function(e,t){if(""===t)return e;var r=t.split(":");return e[r.shift()]=function(e){return e.replace(/^\s+|\s+$/g,"")}(r.join(":")),e}),{})};if(!n)return r.resolve(i);n(i,r)}function s(e,t,r,n){var a=new PY(e);r={config:e.config,error:r,type:n},i?i(r,a):a.next(r)}function o(){return!0}function l(e){return function(t,r){return s(t,this,r,e),!0}}function u(e,t){return 4===e.readyState&&0!==e.status?a(e,t):4!==e.readyState&&wY(e,yY),!0}return function(e,t){function r(t){return function(){var r=this.hasOwnProperty(t+"_")?this[t+"_"]:this.xhr[t],n=(e[t]||{}).getter;return n&&n(r,this)||r}}function n(t){return function(r){var n=this.xhr,i=this,a=e[t];if("on"===t.substring(0,2))i[t+"_"]=r,n[t]=function(a){a=fY(a,i),e[t]&&e[t].call(i,n,a)||r.call(i,a)};else{var s=(a||{}).setter;r=s&&s(r,i)||r,this[t+"_"]=r;try{n[t]=r}catch(e){}}}}function i(t){return function(){var r=[].slice.call(arguments);if(e[t]){var n=e[t].call(this,r,this.xhr);if(n)return n}return this.xhr[t].apply(this.xhr,r)}}return(t=t||window)[dY]=t[dY]||t.XMLHttpRequest,t.XMLHttpRequest=function(){for(var e=new t[dY],a=0;a<pY.length;++a){var s="on"+pY[a];void 0===e[s]&&(e[s]=null)}for(var o in e){var l="";try{l=typeof e[o]}catch(e){}"function"===l?this[o]=i(o):Object.defineProperty(this,o,{get:r(o),set:n(o),enumerable:!0})}var u=this;e.getProxy=function(){return u},this.xhr=e},Object.assign(t.XMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}),t[dY]}({onload:o,onloadend:o,onerror:l(vY),ontimeout:l(_Y),onabort:l(xY),onreadystatechange:function(e){return u(e,this)},open:function(e,t){var n=this,i=t.config={headers:{}};i.method=e[0],i.url=e[1],i.async=e[2],i.user=e[3],i.password=e[4],i.xhr=t;var a="on"+yY;if(t[a]||(t[a]=function(){return u(t,n)}),r)return!0},send:function(e,t){var n=t.config;if(n.withCredentials=t.withCredentials,n.body=e[0],r){var i=function(){r(n,new DY(t))};return!1===n.async?i():setTimeout(i),!0}},setRequestHeader:function(e,t){if(t.config.headers[e[0].toLowerCase()]=e[1],r)return!0},addEventListener:function(e,t){var r=this;if(-1!==pY.indexOf(e[0])){var n=e[1];return EY(t).addEventListener(e[0],(function(t){var i=fY(t,r);i.type=e[0],i.isTrusted=!0,n.call(r,i)})),!0}},getAllResponseHeaders:function(e,t){var r=t.resHeader;if(r){var n="";for(var i in r)n+=i+": "+r[i]+"\r\n";return n}},getResponseHeader:function(e,t){var r=t.resHeader;if(r)return r[(e[0]||"").toLowerCase()]}},t)}(e,t)}function SY(e){!function(e){(e=e||window)[dY]&&(e.XMLHttpRequest=e[dY]),e[dY]=void 0}(e)}function EY(e){return e.watcher||(e.watcher=document.createElement("a"))}function wY(e,t){var r,n=e.getProxy(),i="on"+t+"_",a=fY({type:t},n);n[i]&&n[i](a),"function"==typeof Event?r=new Event(t,{bubbles:!1}):(r=document.createEvent("Event")).initEvent(t,!1,!0),EY(e).dispatchEvent(r)}function CY(e){this.xhr=e,this.xhrProxy=e.getProxy()}function TY(e){function t(e){CY.call(this,e)}return t[bY]=Object.create(CY[bY]),t[bY].next=e,t}CY[bY]=Object.create({resolve:function(e){var t=this.xhrProxy,r=this.xhr;t.readyState=4,r.resHeader=e.headers,t.response=t.responseText=e.response,t.statusText=e.statusText,t.status=e.status,wY(r,yY),wY(r,mY),wY(r,gY)},reject:function(e){this.xhrProxy.status=0,wY(this.xhr,e.type),wY(this.xhr,gY)}});var DY=TY((function(e){var t=this.xhr;for(var r in e=e||t.config,t.withCredentials=e.withCredentials,t.open(e.method,e.url,!1!==e.async,e.user,e.password),e.headers)t.setRequestHeader(r,e.headers[r]);t.send(e.body)})),MY=TY((function(e){this.resolve(e)})),PY=TY((function(e){this.reject(e)}));class FY{constructor(){}proxy(e){return AY(e)}unProxy(){SY()}}class RY{constructor(){this._originalFetch=window.fetch.bind(window),this._options={}}setOptions(e){this._options=e}getOptions(){return this._options}proxy(e){var t=e.onRequest,r=e.onError,n=e.onResponse,i=this;window.fetch=function(e,a){void 0===a&&(a={});var s="";return e instanceof Request?(s=e.url,a.method=a.method||e.method,a.headers=a.headers||e.headers):sX.isString(e)&&(s=e),new Promise(((e,o)=>{var l=a.method||"GET",u=a.body||"",c={url:s,method:l,body:u,fetch:{onload:function(t){var r,n=t.target,a=200==n.status,o=n.response.slice(0),c={url:s,method:l,body:u,ok:a,status:n.status,statusText:n.statusText,clone:function(){return this},arrayBuffer:function(){return sX.isArrayBuffer(o)?o:sX.isArray(o)||sX.isUint8Array(o)?o.buffer:o},text:function(){if(sX.isArrayBuffer(o)){var e=i._options.onArrayBufferToString||sX.arrayBufferToString;return Promise.resolve(e(o))}if(sX.isArray(o)||sX.isUint8Array(o)){var t=i._options.onUint8ArrayToString||sX.uint8ArrayToString;return Promise.resolve(t(o))}return Promise.resolve(o)},json:function(){return sX.isArrayBuffer(o)?Promise.resolve(JSON.parse(sX.arrayBufferToString(o))):sX.isArray(o)||sX.isUint8Array(o)?Promise.resolve(JSON.parse(sX.bufferToString(o))):sX.isString(o)?Promise.resolve(JSON.parse(o)):Promise.resolve(o)},blob:function(){var e=this.headers["content-type"];return sX.isArrayBuffer(o)?Promise.resolve(sX.arrayBufferToBlob(o,{type:e})):sX.isArray(o)||sX.isUint8Array(o)?Promise.resolve(sX.bufferToBlob(o,{type:e})):Promise.resolve(o)}};Object.defineProperties(c,{headers:{get:function(){return r=r||function(e){var t=new Headers;for(var r in e)t.append(r,e[r]);return t}(n.responseHeaders),r}}}),e(c)},onerror:function(t){sX.error(t),e({url:s,method:l,body:u,ok:!1,status:this.status,statusText:this.statusText,text:function(){return Promise.resolve("")},json:function(){return Promise.resolve({})},blob:function(){return new Blob}})}}},h=a.headers;h&&function(e,t){if(e.headers={},sX.isFunction(t.key))for(var r of t.keys())e.headers[r]=t.get(r);else sX.isObject(t)&&(e.headers=Object.assign(e.headers,t))}(c,h);var d={next:function(t){i._originalFetch(s,a).then((t=>{e(t),n&&n(t)})).catch((e=>{r&&r(e),o(e)}))}},p=a.timeout;sX.isValid(p)&&(c.timeout=p),t&&t(c,d)}))}}unProxy(){window.fetch=this._originalFetch}}class NY{constructor(){this._options={},this._sums={},this._apiCollector=null}dispose(){this._options={},this._sums={}}setOptions(e){this._options=e}getOptions(){return this._options}api(e,t){sX.log("Logger:",e)}error(e,t){sX.error("Logger:",e)}sum(e,t){void 0===t&&(t=1),this._sums[e]=this._sums[e]||0,this._sums[e]+=t,sX.log("Logger-sum:",e,t)}setApiCollector(e){this._apiCollector=e}getApiCollector(){return this._apiCollector}}var BY=function(){var e=30,t=e,r=document.createElement("div");r.id="stats",r.style.cssText="width:80px;height:48px;opacity:0.9;cursor:pointer;overflow:hidden;z-index:10000;will-change:transform;";var n=document.createElement("div");n.id="ms",n.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;",r.appendChild(n);var i=document.createElement("div");i.id="msText",i.style.cssText="color:rgb(0,220,0);font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",i.innerHTML="Memory",n.appendChild(i);var a=document.createElement("div");for(a.id="msGraph",a.style.cssText="position:relative;width:74px;height:30px;background-color:rgb(0,220,0)",n.appendChild(a);a.children.length<74;){var s=document.createElement("span");s.style.cssText="width:1px;height:30px;float:left;background-color:rgb(0,220,0)",a.appendChild(s)}window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),0===performance.memory.totalJSHeapSize&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var o,l,u=["Bytes","KB","MB","GB","TB"];var c=Date.now(),h=performance.memory.usedJSHeapSize,d=0,p="#131",f=0,m=0,g=0;return{domElement:r,update:function(){var r,n,s,_,v;Date.now()-c<1e3/30||(c=Date.now(),d=performance.memory.usedJSHeapSize-h,h=performance.memory.usedJSHeapSize,p=d<0?"#830":"#131",f=h,i.textContent="Mem: "+(n=2,0===(r=f)?"n/a":(n=void 0!==n?n:0,o=Math.pow(10,n),l=Math.floor(Math.log(r)/Math.log(1024)),Math.round(r*o/Math.pow(1024,l))/o+" "+u[l])),(m=f/1048576)>t&&(s=a,_=e/t,v=e/(g=e*((m-m%e)/e+1)),[].forEach.call(s.children,(function(t){var r=t.style.height.substring(0,t.style.height.length-2),n=e-(e-r)/_*v;t.style.height=n+"px"})),t=g),function(e,t,r){var n=e.appendChild(e.firstChild);n.style.height=t+"px",r&&(n.style.backgroundColor=r)}(a,e-m*(e/t),p))},getInfo:function(){return{memory:f}}}},IY=function(){var e=30,t=e,r=document.createElement("div");r.id="stats",r.style.cssText="width:80px;height:48px;opacity:0.9;cursor:pointer;overflow:hidden;z-index:10000;will-change:transform;";var n=document.createElement("div");n.id="ms",n.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;",r.appendChild(n);var i=document.createElement("div");i.id="msText",i.style.cssText="color:rgb(238,130,68);font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",i.innerHTML="CPU",n.appendChild(i);var a=document.createElement("div");for(a.id="msGraph",a.style.cssText="position:relative;width:74px;height:30px;background-color:rgb(238,130,68)",n.appendChild(a);a.children.length<74;){var s=document.createElement("span");s.style.cssText="width:1px;height:30px;float:left;background-color:#131",a.appendChild(s)}var o=function(){return performance&&performance.now?performance.now():Date.now()},l=o(),u=!1,c=0,h=o(),d=0,p=100,f=0,m=0,g=function(){var e=o();u&&(c+=e-l),u=!u,l=e};return{domElement:r,begin:function(){g()},end:function(){g()},nextFrame:function(){d++;var r,n,s,l=o();if(d<=1)h=l;else{var u=l-h;u>=1e3&&(p=100*(f=c/u),c=0,h=l,i.textContent="CPU: "+f.toFixed(2)+"%")}p>t&&(r=a,n=e/t,s=e/(m=e*((p-p%e)/e+1)),[].forEach.call(r.children,(function(t){var r=t.style.height.substring(0,t.style.height.length-2),i=e-(e-r)/n*s;t.style.height=i+"px"})),t=m),function(e,t,r){var n=e.appendChild(e.firstChild);n.style.height=t+"px",r&&(n.style.backgroundColor=r)}(a,e-p*(e/t),"#131")},getInfo:function(){return{cpu:f}}}};class OY{constructor(e){if(void 0===e&&(e={}),this._div=document.createElement("div"),e.styleText)this._div.style.cssText=paramStyle;else{this._div.style.cssText="pointer-events: none;position: absolute;left: 0;top: 0;width: 0;height: 0;padding: 0px;margin: 0px;border: 1px solid rgb(254, 127, 11);background-color: rgba(254, 127, 11, 0.2);"}this._div.className=e.className?e.className:void 0,e.parentNode?e.parentNode.appendChild(this._div):document.body.appendChild(this._div)}dispose(){this._div&&(this._div.remove(),this._div=null)}updateStyle(e){this._div.style.cssText=e}getContext(){return this._div}setLeft(e){this._div.style.left=e}getLeft(){return this._div.style.left}setTop(e){this._div.style.top=e}getTop(){return this._div.style.top}setWidth(e){this._div.style.width=e}getWidth(){return this._div.style.width}setHeight(e){this._div.style.height=e}getHeight(){return this._div.style.height}}class kY{constructor(){}createObject(e,t){var r=function(e,t){switch(e){case"ThreadWorker":return new _X(t);case"ThreadWorkerPool":return new vX(t);case"FileManager":return new VX(t);case"ScriptLoader":return new GX(t);case"ImageProxy":return new WX(t);case"GarbageCollector":return new nQ(t);case"AppDelegate":return new rK(t);case"DevDebugger":return new sK(t);case"System":return new oK(t);case"DomDelegate":return new lK(t);case"NetworkDebugger":return new rQ(t);case"CanvasRenderer":return new $K(t);case"ImageRenderer":return new eY(t);case"WASMBridge":return new tY(t);case"CSS2DComponent":return new sY(t);case"CSS3DComponent":return new lY(t);case"WebViewComponent":return new hY(t);case"LocalStorageDB":return new EQ(t);case"AjaxHook":return new FY(t);case"FetchHook":return new RY(t);case"Logger":return new NY(t);case"MemoryStats":return new BY;case"CPUStats":return new IY;case"CustomDiv":return new OY(t);default:return null}}(e,t);return r||null}}const LY=(e,t)=>{const r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)},UY=e=>e*(Math.PI/180),zY=e=>e*(180/Math.PI),jY=new Map,VY=e=>{jY.has(e)&&clearTimeout(jY.get(e)),jY.set(e,setTimeout(e,100))},GY=(e,t,r)=>{const n=t.split(/[ ,]+/g);let i;for(let t=0;t<n.length;t+=1)i=n[t],e.addEventListener?e.addEventListener(i,r,!1):e.attachEvent&&e.attachEvent(i,r)},WY=(e,t,r)=>{const n=t.split(/[ ,]+/g);let i;for(let t=0;t<n.length;t+=1)i=n[t],e.removeEventListener?e.removeEventListener(i,r):e.detachEvent&&e.detachEvent(i,r)},HY=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),qY=()=>({x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}),XY=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},QY=(e,t,r)=>{const n=KY(e);for(let e in n)if(n.hasOwnProperty(e))if("string"==typeof t)n[e]=t+" "+r;else{let i="";for(let e=0,n=t.length;e<n;e+=1)i+=t[e]+" "+r+", ";n[e]=i.slice(0,-2)}return n},KY=e=>{const t={};t[e]="";return["webkit","Moz","o"].forEach((function(r){t[r+e.charAt(0).toUpperCase()+e.slice(1)]=""})),t},YY=(e,t)=>{for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},ZY=(e,t)=>{if(e.length)for(let r=0,n=e.length;r<n;r+=1)t(e[r]);else t(e)};var JY,$Y=!!("ontouchstart"in window),eZ=!!window.PointerEvent,tZ=!!window.MSPointerEvent,rZ={start:"mousedown",move:"mousemove",end:"mouseup"},nZ={};function iZ(){}function aZ(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=aZ.id,aZ.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function sZ(e,t){var r=this;r.nipples=[],r.idles=[],r.actives=[],r.ids=[],r.pressureIntervals={},r.manager=e,r.id=sZ.id,sZ.id+=1,r.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},r.config(t),"static"!==r.options.mode&&"semi"!==r.options.mode||(r.options.multitouch=!1),r.options.multitouch||(r.options.maxNumberOfNipples=1);const n=getComputedStyle(r.options.zone.parentElement);return n&&"flex"===n.display&&(r.parentIsFlex=!0),r.updateBox(),r.prepareNipples(),r.bindings(),r.begin(),r.nipples}function oZ(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=qY(),t.config(e),t.prepareCollections();var r=function(){var e;t.collections.forEach((function(r){r.forEach((function(r){e=r.el.getBoundingClientRect(),r.position={x:t.scroll.x+e.left,y:t.scroll.y+e.top}}))}))};GY(window,"resize",(function(){VY(r)}));var n=function(){t.scroll=qY()};return GY(window,"scroll",(function(){VY(n)})),t.collections}eZ?JY={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:tZ?JY={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:$Y?(JY={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},nZ=rZ):JY=rZ,iZ.prototype.on=function(e,t){var r,n=this,i=e.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var a=0;a<i.length;a+=1)r=i[a],n._handlers_[r]=n._handlers_[r]||[],n._handlers_[r].push(t);return n},iZ.prototype.off=function(e,t){var r=this;return r._handlers_=r._handlers_||{},void 0===e?r._handlers_={}:void 0===t?r._handlers_[e]=null:r._handlers_[e]&&r._handlers_[e].indexOf(t)>=0&&r._handlers_[e].splice(r._handlers_[e].indexOf(t),1),r},iZ.prototype.trigger=function(e,t){var r,n=this,i=e.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var a=0;a<i.length;a+=1)r=i[a],n._handlers_[r]&&n._handlers_[r].length&&n._handlers_[r].forEach((function(e){e.call(n,{type:r,target:n},t)}))},iZ.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=((e,t)=>{const r={};for(let n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?r[n]=t[n]:e.hasOwnProperty(n)&&(r[n]=e[n]);return r})(t.options,e))},iZ.prototype.bindEvt=function(e,t){var r=this;return r._domHandlers_=r._domHandlers_||{},r._domHandlers_[t]=function(){"function"==typeof r["on"+t]?r["on"+t].apply(r,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},GY(e,JY[t],r._domHandlers_[t]),nZ[t]&&GY(e,nZ[t],r._domHandlers_[t]),r},iZ.prototype.unbindEvt=function(e,t){var r=this;return r._domHandlers_=r._domHandlers_||{},WY(e,JY[t],r._domHandlers_[t]),nZ[t]&&WY(e,nZ[t],r._domHandlers_[t]),delete r._domHandlers_[t],this},aZ.prototype=new iZ,aZ.constructor=aZ,aZ.id=0,aZ.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},aZ.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=((e,t)=>{const r=KY(e);for(let e in r)r.hasOwnProperty(e)&&(r[e]=t);return r})("borderRadius","50%"),r=QY("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},YY(n.el,r),"circle"===this.options.shape&&YY(n.back,t),YY(n.front,t),this.applyStyles(n),this},aZ.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var r in e[t])this.ui[t].style[r]=e[t][r];return this},aZ.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},aZ.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},aZ.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},aZ.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout((function(){t.ui.el.style.opacity=1}),0),t.showTimeout=setTimeout((function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)}),t.options.fadeTime)),t},aZ.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout((function(){var r="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=r,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)}),t.options.fadeTime),t.options.restJoystick){const r=t.options.restJoystick,n={};n.x=!0===r||!1!==r.x?0:t.instance.frontPosition.x,n.y=!0===r||!1!==r.y?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t},aZ.prototype.setPosition=function(e,t){var r=this;r.frontPosition={x:t.x,y:t.y};var n=r.options.fadeTime+"ms",i={};i.front=QY("transition",["transform"],n);var a={front:{}};a.front={transform:"translate("+r.frontPosition.x+"px,"+r.frontPosition.y+"px)"},r.applyStyles(i),r.applyStyles(a),r.restTimeout=setTimeout((function(){"function"==typeof e&&e.call(r),r.restCallback()}),r.options.fadeTime)},aZ.prototype.restCallback=function(){var e=this,t={};t.front=QY("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)},aZ.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},aZ.prototype.computeDirection=function(e){var t,r,n,i=e.angle.radian,a=Math.PI/4,s=Math.PI/2;if(i>a&&i<3*a&&!e.lockX?t="up":i>-a&&i<=a&&!e.lockY?t="left":i>3*-a&&i<=-a&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(r=i>-s&&i<s?"left":"right"),e.lockX||(n=i>0?"up":"down"),e.force>this.options.threshold){var o,l={};for(o in this.direction)this.direction.hasOwnProperty(o)&&(l[o]=this.direction[o]);var u={};for(o in this.direction={x:r,y:n,angle:t},e.direction=this.direction,l)l[o]===this.direction[o]&&(u[o]=!0);if(u.x&&u.y&&u.angle)return e;u.x&&u.y||this.trigger("plain",e),u.x||this.trigger("plain:"+r,e),u.y||this.trigger("plain:"+n,e),u.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e},sZ.prototype=new iZ,sZ.constructor=sZ,sZ.id=0,sZ.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(e){if(void 0===e)return t[0];for(var r=0,n=t.length;r<n;r+=1)if(t[r].identifier===e)return t[r];return!1}},sZ.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},sZ.prototype.begin=function(){var e=this,t=e.options;if("static"===t.mode){var r=e.createNipple(t.position,e.manager.getIdentifier());r.add(),e.idles.push(r)}},sZ.prototype.createNipple=function(e,t){var r=this,n=r.manager.scroll,i={},a=r.options,s=r.parentIsFlex?n.x:n.x+r.box.left,o=r.parentIsFlex?n.y:n.y+r.box.top;if(e.x&&e.y)i={x:e.x-s,y:e.y-o};else if(e.top||e.right||e.bottom||e.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=e.top,l.style.right=e.right,l.style.bottom=e.bottom,l.style.left=e.left,l.style.position="absolute",a.zone.appendChild(l);var u=l.getBoundingClientRect();a.zone.removeChild(l),i=e,e={x:u.left+n.x,y:u.top+n.y}}var c=new aZ(r,{color:a.color,size:a.size,threshold:a.threshold,fadeTime:a.fadeTime,dataOnly:a.dataOnly,restJoystick:a.restJoystick,restOpacity:a.restOpacity,mode:a.mode,identifier:t,position:e,zone:a.zone,frontPosition:{x:0,y:0},shape:a.shape});return a.dataOnly||(XY(c.ui.el,i),XY(c.ui.front,c.frontPosition)),r.nipples.push(c),r.trigger("added "+c.identifier+":added",c),r.manager.trigger("added "+c.identifier+":added",c),r.bindNipple(c),c},sZ.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},sZ.prototype.bindNipple=function(e){var t,r=this,n=function(e,n){t=e.type+" "+n.id+":"+e.type,r.trigger(t,n)};e.on("destroyed",r.onDestroyed.bind(r)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},sZ.prototype.pressureFn=function(e,t,r){var n=this,i=0;clearInterval(n.pressureIntervals[r]),n.pressureIntervals[r]=setInterval(function(){var r=e.force||e.pressure||e.webkitForce||0;r!==i&&(t.trigger("pressure",r),n.trigger("pressure "+t.identifier+":pressure",r),i=r)}.bind(n),100)},sZ.prototype.onstart=function(e){var t=this,r=t.options,n=e;e=HY(e),t.updateBox();return ZY(e,(function(i){t.actives.length<r.maxNumberOfNipples?t.processOnStart(i):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach((function(r){if(Object.values(n.touches).findIndex((function(e){return e.identifier===r}))<0){var i=[e[0]];i.identifier=r,t.processOnEnd(i)}})),t.actives.length<r.maxNumberOfNipples&&t.processOnStart(i))})),t.manager.bindDocument(),!1},sZ.prototype.processOnStart=function(e){var t,r=this,n=r.options,i=r.manager.getIdentifier(e),a=e.force||e.pressure||e.webkitForce||0,s={x:e.pageX,y:e.pageY},o=r.getOrCreate(i,s);o.identifier!==i&&r.manager.removeIdentifier(o.identifier),o.identifier=i;var l=function(t){t.trigger("start",t),r.trigger("start "+t.id+":start",t),t.show(),a>0&&r.pressureFn(e,t,t.identifier),r.processOnMove(e)};if((t=r.idles.indexOf(o))>=0&&r.idles.splice(t,1),r.actives.push(o),r.ids.push(o.identifier),"semi"!==n.mode)l(o);else{if(!(LY(s,o.position)<=n.catchDistance))return o.destroy(),void r.processOnStart(e);l(o)}return o},sZ.prototype.getOrCreate=function(e,t){var r,n=this,i=n.options;return/(semi|static)/.test(i.mode)?(r=n.idles[0])?(n.idles.splice(0,1),r):"semi"===i.mode?n.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):r=n.createNipple(t,e)},sZ.prototype.processOnMove=function(e){var t=this,r=t.options,n=t.manager.getIdentifier(e),i=t.nipples.get(n),a=t.manager.scroll;if((e=>isNaN(e.buttons)?0!==e.pressure:0!==e.buttons)(e)){if(!i)return console.error("Found zombie joystick with ID "+n),void t.manager.removeIdentifier(n);if(r.dynamicPage){var s=i.el.getBoundingClientRect();i.position={x:a.x+s.left,y:a.y+s.top}}i.identifier=n;var o=i.options.size/2,l={x:e.pageX,y:e.pageY};r.lockX&&(l.y=i.position.y),r.lockY&&(l.x=i.position.x);var u,c,h=LY(l,i.position),d=((e,t)=>{const r=t.x-e.x,n=t.y-e.y;return zY(Math.atan2(n,r))})(l,i.position),p=UY(d),f=h/o,m={distance:h,position:l};if("circle"===i.options.shape?(u=Math.min(h,o),c=((e,t,r)=>{const n={x:0,y:0};return r=UY(r),n.x=e.x-t*Math.cos(r),n.y=e.y-t*Math.sin(r),n})(i.position,u,d)):(c=((e,t,r)=>({x:Math.min(Math.max(e.x,t.x-r),t.x+r),y:Math.min(Math.max(e.y,t.y-r),t.y+r)}))(l,i.position,o),u=LY(c,i.position)),r.follow){if(h>o){let e=l.x-c.x,r=l.y-c.y;i.position.x+=e,i.position.y+=r,i.el.style.top=i.position.y-(t.box.top+a.y)+"px",i.el.style.left=i.position.x-(t.box.left+a.x)+"px",h=LY(l,i.position)}}else l=c,h=u;var g=l.x-i.position.x,_=l.y-i.position.y;i.frontPosition={x:g,y:_},r.dataOnly||(i.ui.front.style.transform="translate("+g+"px,"+_+"px)");var v={identifier:i.identifier,position:l,force:f,pressure:e.force||e.pressure||e.webkitForce||0,distance:h,angle:{radian:p,degree:d},vector:{x:g/o,y:-_/o},raw:m,instance:i,lockX:r.lockX,lockY:r.lockY};(v=i.computeDirection(v)).angle={radian:UY(180-d),degree:180-d},i.trigger("move",v),t.trigger("move "+i.id+":move",v)}else this.processOnEnd(e)},sZ.prototype.processOnEnd=function(e){var t=this,r=t.options,n=t.manager.getIdentifier(e),i=t.nipples.get(n),a=t.manager.removeIdentifier(i.identifier);i&&(r.dataOnly||i.hide((function(){"dynamic"===r.mode&&(i.trigger("removed",i),t.trigger("removed "+i.id+":removed",i),t.manager.trigger("removed "+i.id+":removed",i),i.destroy())})),clearInterval(t.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),t.trigger("end "+i.id+":end",i),t.ids.indexOf(i.identifier)>=0&&t.ids.splice(t.ids.indexOf(i.identifier),1),t.actives.indexOf(i)>=0&&t.actives.splice(t.actives.indexOf(i),1),/(semi|static)/.test(r.mode)?t.idles.push(i):t.nipples.indexOf(i)>=0&&t.nipples.splice(t.nipples.indexOf(i),1),t.manager.unbindDocument(),/(semi|static)/.test(r.mode)&&(t.manager.ids[a.id]=a.identifier))},sZ.prototype.onDestroyed=function(e,t){var r=this;r.nipples.indexOf(t)>=0&&r.nipples.splice(r.nipples.indexOf(t),1),r.actives.indexOf(t)>=0&&r.actives.splice(r.actives.indexOf(t),1),r.idles.indexOf(t)>=0&&r.idles.splice(r.idles.indexOf(t),1),r.ids.indexOf(t.identifier)>=0&&r.ids.splice(r.ids.indexOf(t.identifier),1),r.manager.removeIdentifier(t.identifier),r.manager.unbindDocument()},sZ.prototype.destroy=function(){var e=this;for(var t in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach((function(e){e.destroy()})),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()},oZ.prototype=new iZ,oZ.constructor=oZ,oZ.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var r;return e.collections.every((function(e){return!(r=e.get(t))})),r}},oZ.prototype.create=function(e){return this.createCollection(e)},oZ.prototype.createCollection=function(e){var t=this,r=new sZ(t,e);return t.bindCollection(r),t.collections.push(r),r},oZ.prototype.bindCollection=function(e){var t,r=this,n=function(e,n){t=e.type+" "+n.id+":"+e.type,r.trigger(t,n)};e.on("destroyed",r.onDestroyed.bind(r)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},oZ.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},oZ.prototype.unbindDocument=function(e){var t=this;Object.keys(t.ids).length&&!0!==e||(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)},oZ.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},oZ.prototype.removeIdentifier=function(e){var t={};for(var r in this.ids)if(this.ids[r]===e){t.id=r,t.identifier=this.ids[r],delete this.ids[r];break}return t},oZ.prototype.onmove=function(e){return this.onAny("move",e),!1},oZ.prototype.onend=function(e){return this.onAny("end",e),!1},oZ.prototype.oncancel=function(e){return this.onAny("end",e),!1},oZ.prototype.onAny=function(e,t){var r,n=this,i="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=HY(t);var a=function(e,t,r){r.ids.indexOf(t)>=0&&(r[i](e),e._found_=!0)};return ZY(t,(function(e){r=n.getIdentifier(e),ZY(n.collections,a.bind(null,e,r)),e._found_||n.removeIdentifier(r)})),!1},oZ.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach((function(e){e.destroy()})),e.off()},oZ.prototype.onDestroyed=function(e,t){var r=this;if(r.collections.indexOf(t)<0)return!1;r.collections.splice(r.collections.indexOf(t),1)};const lZ=new oZ;var uZ=function(e){return lZ.create(e)};function cZ(){this._moveData={direction:{angle:"",x:"",y:""}},this._prevMoveData=null,this._deltaMoveData=null}function hZ(){this._moveData=null,this._prevMoveData=null,this._deltaMoveData=null}function dZ(e,t){var r=this._moveData.direction,n=t.direction;r.angle=sX.parseValue(n.angle,""),r.x=sX.parseValue(n.x,""),r.y=sX.parseValue(n.y,"")}sX.addFactory(new kY,"thing.dom.factory"),window.global=window.global||window.globalThis,window.globalThis=window.globalThis||window.global;var pZ=Object.freeze({__proto__:null,AppDelegate:rK,BasisFormatType:fX,CSS2DComponent:sY,CSS3DComponent:lY,EncoderType:{Basis:"Basis"},EventCaptureComponent:rY,Factory:kY,Joystick:class{constructor(e){void 0===e&&(e={}),this._joystick=uZ({zone:e.domElement,position:e.position,color:sX.parseValue(e.color,"white"),size:sX.parseValue(e.size,100),threshold:sX.parseValue(e.threshold,.1),multitouch:sX.parseValue(e.multitouch,!1),catchDistance:sX.parseValue(e.catchDistance,200),lockX:sX.parseValue(e.lockX,!1),lockY:sX.parseValue(e.lockY,!1),mode:sX.parseValue(e.mode,dX.Dynamic).toLowerCase(),shape:sX.parseValue(e.shape,pX.Circle).toLowerCase()}),this._onStart=null,this._onEnd=null,this._onMove=null,this._moveData=null,this._prevMoveData=null,this._deltaMoveData=null,this._initEvents()}_initEvents(){this._joystick.on("start",cZ.bind(this)),this._joystick.on("end",hZ.bind(this)),this._joystick.on("dir:up plain:up dir:left plain:left dir:down plain:down dir:right plain:right",dZ.bind(this))}dispose(){this._joystick.off("start",cZ),this._joystick.off("end",hZ),this._joystick.on("dir:up plain:up dir:left plain:left dir:down plain:down dir:right plain:right",dZ),this._joystick.destroy(),this._joystick=null}get onStart(){return this._onStart}set onStart(e){this._onStart=e;var t=this;function r(){t._onStart()}e?this._joystick.on("start",r):this._joystick.off("start",r)}get onEnd(){return this._onEnd}set onEnd(e){this._onEnd=e;var t=this;function r(){t._onEnd()}e?this._joystick.on("end",r):this._joystick.off("end",r)}get onMove(){return this._onMove}set onMove(e){this._onMove=e;var t=this;function r(e,r){var n={angle:r.angle,force:r.force,distance:r.distance,position:[r.position.x,r.position.y],pressure:r.pressure};if(t._deltaMoveData){var i=t._prevMoveData;t._deltaMoveData={angle:{radian:r.angle.radian-i.angle.radian,degree:r.angle.degree-i.angle.degree},force:r.force-i.force,distance:r.distance-i.distance,position:[r.position.x-i.position.x,r.position.y-i.position.y],pressure:r.pressure-i.pressure}}else t._deltaMoveData={angle:{radian:0,degree:0},force:0,distance:0,position:[0,0],pressure:0};t._prevMoveData=n;var a=t._deltaMoveData;t._onMove({data:{angle:r.angle,force:r.force,distance:r.distance,position:[r.position.x,r.position.y],pressure:r.pressure},delta:{angle:a.angle,force:a.force,distance:a.distance,position:[a.position.x,a.position.y],pressure:a.pressure},direction:t._moveData.direction})}e?this._joystick.on("move",r):this._joystick.off("move",r)}get visible(){return this._joystick.get().el._isVisible()}set visible(e){this._joystick.get().el._setVisible(e)}},JoystickDirectionType:{Left:"Left",Right:"Right",Up:"Up",down:"Down"},JoystickModeType:dX,JoystickShapeType:pX,ThreadWorker:_X,ThreadWorkerPool:vX,Utils:sX,WebViewComponent:hY}),fZ=Le.toText("150,178,25,7,98,39,43,70,195,240,126,181"),mZ=Le.toText("129,184,23,23,72,13,26,111,232,211,66,132,7,65,48,79,164,137,136,123,171"),gZ=Le.toText("129,184,23,23,72,13,26,111,232,211,66,132,7,65,48,79,164,148,128,108,171"),_Z=window[fZ];_Z[mZ]=Le.toText([166,149,61,44,125,106,59,91,211,183,123,168]),_Z[gZ]=1904370564^parseInt(0x71a5e4d5),"undefined"!=typeof window&&(window.loadThingModules=function(){return Promise.resolve()}),t.ActionGroupComponent=wL,t.ActionQueueType=sI,t.ActionType=fI,t.AlignType=IB,t.AmbientLight=MG,t.AnimationDirectionType=HB,t.App=wW,t.AppHelperComponent=kU,t.AttachedPoint=dq,t.AxisType=FB,t.BASE=gc,t.BaseAction=wV,t.BaseComponent=vk,t.BaseComponentGroup=Ck,t.BaseContainer3D=WW,t.BaseDynamicPoints=IH,t.BaseEntity=QW,t.BaseLevelControl=fq,t.BaseLight=$V,t.BaseLine=kH,t.BaseModelObject3D=HW,t.BaseObject=Ez,t.BaseObject3D=Uq,t.BasePoints=BH,t.BaseState=kI,t.BaseTickableObject=GW,t.BaseTickableObject3D=JV,t.BlendingType=KB,t.BlueprintComponent=GL,t.BoundingComponent=Vk,t.Box=pH,t.BoxHelperModeType=QB,t.COMPILETIME=jq,t.Camera=Sj,t.CameraControlComponent=xU,t.CameraPickerComponent=OU,t.CameraPostEffectComponent=RU,t.CameraResourceControllerComponent=PU,t.CanvasRenderer=nq,t.Capsule=EH,t.Circle=SH,t.ClippingPlanes=PH,t.CodeType=DB,t.ColliderType=oI,t.Component=Sk,t.CubeTexture=TU,t.Cylinder=AH,t.DOM=pZ,t.DirectionalLight=cG,t.DynamicLoadComponent=XL,t.DynamicSelector=_k,t.EffectGroundObject=HG,t.Empty=cI,t.EmptyTexture=SG,t.Entity=KW,t.EventDispatcher=Ut,t.EventType=SB,t.ExtrudeShape=HH,t.FatLine=UH,t.FilterResultType=pI,t.Flags=Wt,t.FogType=VB,t.FontWeight=hI,t.GeometryResource=zW,t.Grid=hH,t.HelperComponent=Bk,t.HemisphereLight=hG,t.ImageColorFormat=$B,t.ImageCompressionType=eI,t.ImageFilterType=nI,t.ImageMappingType=rI,t.ImageSlotType=JB,t.ImageTexture=DU,t.ImageWrapType=tI,t.InheritActionType=XB,t.InheritType=qB,t.KeyCodeType=MB,t.Label=aq,t.Lensflare=pq,t.LerpComponent=jL,t.LerpType=EB,t.LevelComponent=_L,t.LevelManager=GU,t.LightSphereModeType=aI,t.LoopType=wB,t.Marker=tq,t.MaterialResource=VW,t.Math=QI,t.MathUtils=QI,t.Mesh=yH,t.MeshBuilder=xH,t.ModelAnimationComponent=Hk,t.ModelResourceComponent=UU,t.MouseButtonType=CB,t.NodeUserDataType=AB,t.Object3D=mj,t.ObjectProxy=ur,t.PRO=false,t.ParticleEmitter=VG,t.ParticleGroup=GG,t.ParticleSystem=WG,t.PickMode=jB,t.PickType=zB,t.Picker=AG,t.PivotMode=LB,t.PivotModeType=UB,t.PixelLine=LH,t.PixelLineSegments=VH,t.Plane=mH,t.PlaneRegion=JH,t.PlayState=GB,t.PlayStateType=WB,t.Points=GH,t.PolygonLine=jH,t.ProjectionType=RB,t.RandomGenerator=ko,t.Relationship=Bq,t.RelationshipDirection=dI,t.RenderComponent=fL,t.RenderTexture=pz,t.RenderType=kB,t.ResolvablePromise=Rt,t.ResourceType=lI,t.RootObject=DG,t.RotationOrdersType=PB,t.RouteLine=zH,t.Scene=NG,t.SceneLayoutExporter=Pq,t.SceneLoader=KV,t.SceneObjectExporter=Rq,t.SceneResourceType=uI,t.Selector=hk,t.ShadowQualityType=iI,t.SideType=OB,t.Space3D=uH,t.SpaceType=TB,t.Sphere=_H,t.SpotLight=NH,t.Style=ek,t.T3D=MP,t.T3D_EXTEND=hB,t.Thing=YW,t.ThreadWorker=OI,t.Torus=bH,t.TransformComponent=aL,t.TypeChecker=Lo,t.UVMode=YB,t.UVModeType=ZB,t.Utils=BI,t.VERSION=zq,t.VideoTexture=LW,t.ViewMode=NB,t.ViewModeType=BB,t.Water=YH,t.WebView=cq,t.loadDebugger=kq,t.loadLocalDebugger=Lq}));
